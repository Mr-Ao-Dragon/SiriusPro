(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7567],{4157:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(sn){try{let ye=function(){X||(X=!0,y())},ot=function(){try{Ie.documentElement.doScroll("left")}catch(ct){return void setTimeout(ot,50)}ye()};var se=ye,rt=ot,pe=(pe=document.getElementsByTagName("script"))[pe.length-1],ee=pe.getAttribute("data-injectcss"),pe=pe.getAttribute("data-disable-injectsvg");if(!pe){var Le,Te,y,Ie,X,Se=function(bt,Ot){Ot.parentNode.insertBefore(bt,Ot)};if(ee&&!sn.__iconfont__svg__cssinject__){sn.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(ct){console&&console.log(ct)}}Le=function(){var bt,Ot=document.createElement("div");Ot.innerHTML=sn._iconfont_svg_string_3580659,(Ot=Ot.getElementsByTagName("svg")[0])&&(Ot.setAttribute("aria-hidden","true"),Ot.style.position="absolute",Ot.style.width=0,Ot.style.height=0,Ot.style.overflow="hidden",Ot=Ot,(bt=document.body).firstChild?Se(Ot,bt.firstChild):bt.appendChild(Ot))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(Le,0):(Te=function(){document.removeEventListener("DOMContentLoaded",Te,!1),Le()},document.addEventListener("DOMContentLoaded",Te,!1)):document.attachEvent&&(y=Le,Ie=sn.document,X=!1,ot(),Ie.onreadystatechange=function(){Ie.readyState=="complete"&&(Ie.onreadystatechange=null,ye())})}}catch(ye){}}(window)},66213:function(sn,pe,ee){"use strict";ee.d(pe,{Z:function(){return y}});var Le=ee(77608);function Te(Ie,X){for(;!Object.prototype.hasOwnProperty.call(Ie,X)&&(Ie=(0,Le.Z)(Ie),Ie!==null););return Ie}function y(){return typeof Reflect!="undefined"&&Reflect.get?y=Reflect.get.bind():y=function(X,Se,se){var rt=Te(X,Se);if(!!rt){var ye=Object.getOwnPropertyDescriptor(rt,Se);return ye.get?ye.get.call(arguments.length<3?X:se):ye.value}},y.apply(this,arguments)}},59591:function(sn,pe,ee){var Le=ee(50008).default;function Te(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */sn.exports=Te=function(){return y},sn.exports.__esModule=!0,sn.exports.default=sn.exports;var y={},Ie=Object.prototype,X=Ie.hasOwnProperty,Se=Object.defineProperty||function(Y,ce,ue){Y[ce]=ue.value},se=typeof Symbol=="function"?Symbol:{},rt=se.iterator||"@@iterator",ye=se.asyncIterator||"@@asyncIterator",ot=se.toStringTag||"@@toStringTag";function ct(Y,ce,ue){return Object.defineProperty(Y,ce,{value:ue,enumerable:!0,configurable:!0,writable:!0}),Y[ce]}try{ct({},"")}catch(Y){ct=function(ue,Xe,lt){return ue[Xe]=lt}}function bt(Y,ce,ue,Xe){var lt=ce&&ce.prototype instanceof Ft?ce:Ft,_t=Object.create(lt.prototype),Xt=new Ir(Xe||[]);return Se(_t,"_invoke",{value:pt(Y,ue,Xt)}),_t}function Ot(Y,ce,ue){try{return{type:"normal",arg:Y.call(ce,ue)}}catch(Xe){return{type:"throw",arg:Xe}}}y.wrap=bt;var vr={};function Ft(){}function gr(){}function qt(){}var It={};ct(It,rt,function(){return this});var Zt=Object.getPrototypeOf,br=Zt&&Zt(Zt(ae([])));br&&br!==Ie&&X.call(br,rt)&&(It=br);var J=qt.prototype=Ft.prototype=Object.create(It);function Et(Y){["next","throw","return"].forEach(function(ce){ct(Y,ce,function(ue){return this._invoke(ce,ue)})})}function Ct(Y,ce){function ue(lt,_t,Xt,hr){var Yr=Ot(Y[lt],Y,_t);if(Yr.type!=="throw"){var Hr=Yr.arg,vi=Hr.value;return vi&&Le(vi)=="object"&&X.call(vi,"__await")?ce.resolve(vi.__await).then(function(Vn){ue("next",Vn,Xt,hr)},function(Vn){ue("throw",Vn,Xt,hr)}):ce.resolve(vi).then(function(Vn){Hr.value=Vn,Xt(Hr)},function(Vn){return ue("throw",Vn,Xt,hr)})}hr(Yr.arg)}var Xe;Se(this,"_invoke",{value:function(_t,Xt){function hr(){return new ce(function(Yr,Hr){ue(_t,Xt,Yr,Hr)})}return Xe=Xe?Xe.then(hr,hr):hr()}})}function pt(Y,ce,ue){var Xe="suspendedStart";return function(lt,_t){if(Xe==="executing")throw new Error("Generator is already running");if(Xe==="completed"){if(lt==="throw")throw _t;return Ze()}for(ue.method=lt,ue.arg=_t;;){var Xt=ue.delegate;if(Xt){var hr=Ht(Xt,ue);if(hr){if(hr===vr)continue;return hr}}if(ue.method==="next")ue.sent=ue._sent=ue.arg;else if(ue.method==="throw"){if(Xe==="suspendedStart")throw Xe="completed",ue.arg;ue.dispatchException(ue.arg)}else ue.method==="return"&&ue.abrupt("return",ue.arg);Xe="executing";var Yr=Ot(Y,ce,ue);if(Yr.type==="normal"){if(Xe=ue.done?"completed":"suspendedYield",Yr.arg===vr)continue;return{value:Yr.arg,done:ue.done}}Yr.type==="throw"&&(Xe="completed",ue.method="throw",ue.arg=Yr.arg)}}}function Ht(Y,ce){var ue=ce.method,Xe=Y.iterator[ue];if(Xe===void 0)return ce.delegate=null,ue==="throw"&&Y.iterator.return&&(ce.method="return",ce.arg=void 0,Ht(Y,ce),ce.method==="throw")||ue!=="return"&&(ce.method="throw",ce.arg=new TypeError("The iterator does not provide a '"+ue+"' method")),vr;var lt=Ot(Xe,Y.iterator,ce.arg);if(lt.type==="throw")return ce.method="throw",ce.arg=lt.arg,ce.delegate=null,vr;var _t=lt.arg;return _t?_t.done?(ce[Y.resultName]=_t.value,ce.next=Y.nextLoc,ce.method!=="return"&&(ce.method="next",ce.arg=void 0),ce.delegate=null,vr):_t:(ce.method="throw",ce.arg=new TypeError("iterator result is not an object"),ce.delegate=null,vr)}function vt(Y){var ce={tryLoc:Y[0]};1 in Y&&(ce.catchLoc=Y[1]),2 in Y&&(ce.finallyLoc=Y[2],ce.afterLoc=Y[3]),this.tryEntries.push(ce)}function sr(Y){var ce=Y.completion||{};ce.type="normal",delete ce.arg,Y.completion=ce}function Ir(Y){this.tryEntries=[{tryLoc:"root"}],Y.forEach(vt,this),this.reset(!0)}function ae(Y){if(Y){var ce=Y[rt];if(ce)return ce.call(Y);if(typeof Y.next=="function")return Y;if(!isNaN(Y.length)){var ue=-1,Xe=function lt(){for(;++ue<Y.length;)if(X.call(Y,ue))return lt.value=Y[ue],lt.done=!1,lt;return lt.value=void 0,lt.done=!0,lt};return Xe.next=Xe}}return{next:Ze}}function Ze(){return{value:void 0,done:!0}}return gr.prototype=qt,Se(J,"constructor",{value:qt,configurable:!0}),Se(qt,"constructor",{value:gr,configurable:!0}),gr.displayName=ct(qt,ot,"GeneratorFunction"),y.isGeneratorFunction=function(Y){var ce=typeof Y=="function"&&Y.constructor;return!!ce&&(ce===gr||(ce.displayName||ce.name)==="GeneratorFunction")},y.mark=function(Y){return Object.setPrototypeOf?Object.setPrototypeOf(Y,qt):(Y.__proto__=qt,ct(Y,ot,"GeneratorFunction")),Y.prototype=Object.create(J),Y},y.awrap=function(Y){return{__await:Y}},Et(Ct.prototype),ct(Ct.prototype,ye,function(){return this}),y.AsyncIterator=Ct,y.async=function(Y,ce,ue,Xe,lt){lt===void 0&&(lt=Promise);var _t=new Ct(bt(Y,ce,ue,Xe),lt);return y.isGeneratorFunction(ce)?_t:_t.next().then(function(Xt){return Xt.done?Xt.value:_t.next()})},Et(J),ct(J,ot,"Generator"),ct(J,rt,function(){return this}),ct(J,"toString",function(){return"[object Generator]"}),y.keys=function(Y){var ce=Object(Y),ue=[];for(var Xe in ce)ue.push(Xe);return ue.reverse(),function lt(){for(;ue.length;){var _t=ue.pop();if(_t in ce)return lt.value=_t,lt.done=!1,lt}return lt.done=!0,lt}},y.values=ae,Ir.prototype={constructor:Ir,reset:function(ce){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(sr),!ce)for(var ue in this)ue.charAt(0)==="t"&&X.call(this,ue)&&!isNaN(+ue.slice(1))&&(this[ue]=void 0)},stop:function(){this.done=!0;var ce=this.tryEntries[0].completion;if(ce.type==="throw")throw ce.arg;return this.rval},dispatchException:function(ce){if(this.done)throw ce;var ue=this;function Xe(Hr,vi){return Xt.type="throw",Xt.arg=ce,ue.next=Hr,vi&&(ue.method="next",ue.arg=void 0),!!vi}for(var lt=this.tryEntries.length-1;lt>=0;--lt){var _t=this.tryEntries[lt],Xt=_t.completion;if(_t.tryLoc==="root")return Xe("end");if(_t.tryLoc<=this.prev){var hr=X.call(_t,"catchLoc"),Yr=X.call(_t,"finallyLoc");if(hr&&Yr){if(this.prev<_t.catchLoc)return Xe(_t.catchLoc,!0);if(this.prev<_t.finallyLoc)return Xe(_t.finallyLoc)}else if(hr){if(this.prev<_t.catchLoc)return Xe(_t.catchLoc,!0)}else{if(!Yr)throw new Error("try statement without catch or finally");if(this.prev<_t.finallyLoc)return Xe(_t.finallyLoc)}}}},abrupt:function(ce,ue){for(var Xe=this.tryEntries.length-1;Xe>=0;--Xe){var lt=this.tryEntries[Xe];if(lt.tryLoc<=this.prev&&X.call(lt,"finallyLoc")&&this.prev<lt.finallyLoc){var _t=lt;break}}_t&&(ce==="break"||ce==="continue")&&_t.tryLoc<=ue&&ue<=_t.finallyLoc&&(_t=null);var Xt=_t?_t.completion:{};return Xt.type=ce,Xt.arg=ue,_t?(this.method="next",this.next=_t.finallyLoc,vr):this.complete(Xt)},complete:function(ce,ue){if(ce.type==="throw")throw ce.arg;return ce.type==="break"||ce.type==="continue"?this.next=ce.arg:ce.type==="return"?(this.rval=this.arg=ce.arg,this.method="return",this.next="end"):ce.type==="normal"&&ue&&(this.next=ue),vr},finish:function(ce){for(var ue=this.tryEntries.length-1;ue>=0;--ue){var Xe=this.tryEntries[ue];if(Xe.finallyLoc===ce)return this.complete(Xe.completion,Xe.afterLoc),sr(Xe),vr}},catch:function(ce){for(var ue=this.tryEntries.length-1;ue>=0;--ue){var Xe=this.tryEntries[ue];if(Xe.tryLoc===ce){var lt=Xe.completion;if(lt.type==="throw"){var _t=lt.arg;sr(Xe)}return _t}}throw new Error("illegal catch attempt")},delegateYield:function(ce,ue,Xe){return this.delegate={iterator:ae(ce),resultName:ue,nextLoc:Xe},this.method==="next"&&(this.arg=void 0),vr}},y}sn.exports=Te,sn.exports.__esModule=!0,sn.exports.default=sn.exports},87757:function(sn,pe,ee){var Le=ee(59591)();sn.exports=Le;try{regeneratorRuntime=Le}catch(Te){typeof globalThis=="object"?globalThis.regeneratorRuntime=Le:Function("r","regeneratorRuntime = r")(Le)}},38163:function(sn){sn.exports=pe;function pe(Te,y){var Ie=Te&&Te.type,X;if(Ie==="FeatureCollection")for(X=0;X<Te.features.length;X++)pe(Te.features[X],y);else if(Ie==="GeometryCollection")for(X=0;X<Te.geometries.length;X++)pe(Te.geometries[X],y);else if(Ie==="Feature")pe(Te.geometry,y);else if(Ie==="Polygon")ee(Te.coordinates,y);else if(Ie==="MultiPolygon")for(X=0;X<Te.coordinates.length;X++)ee(Te.coordinates[X],y);return Te}function ee(Te,y){if(Te.length!==0){Le(Te[0],y);for(var Ie=1;Ie<Te.length;Ie++)Le(Te[Ie],!y)}}function Le(Te,y){for(var Ie=0,X=0,Se=0,se=Te.length,rt=se-1;Se<se;rt=Se++){var ye=(Te[Se][0]-Te[rt][0])*(Te[rt][1]+Te[Se][1]),ot=Ie+ye;X+=Math.abs(Ie)>=Math.abs(ye)?Ie-ot+ye:ye-ot+Ie,Ie=ot}Ie+X>=0!=!!y&&Te.reverse()}},75550:function(sn){"use strict";sn.exports=pe;function pe(ee,Le){this.x=ee,this.y=Le}pe.prototype={clone:function(){return new pe(this.x,this.y)},add:function(ee){return this.clone()._add(ee)},sub:function(ee){return this.clone()._sub(ee)},multByPoint:function(ee){return this.clone()._multByPoint(ee)},divByPoint:function(ee){return this.clone()._divByPoint(ee)},mult:function(ee){return this.clone()._mult(ee)},div:function(ee){return this.clone()._div(ee)},rotate:function(ee){return this.clone()._rotate(ee)},rotateAround:function(ee,Le){return this.clone()._rotateAround(ee,Le)},matMult:function(ee){return this.clone()._matMult(ee)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(ee){return this.x===ee.x&&this.y===ee.y},dist:function(ee){return Math.sqrt(this.distSqr(ee))},distSqr:function(ee){var Le=ee.x-this.x,Te=ee.y-this.y;return Le*Le+Te*Te},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(ee){return Math.atan2(this.y-ee.y,this.x-ee.x)},angleWith:function(ee){return this.angleWithSep(ee.x,ee.y)},angleWithSep:function(ee,Le){return Math.atan2(this.x*Le-this.y*ee,this.x*ee+this.y*Le)},_matMult:function(ee){var Le=ee[0]*this.x+ee[1]*this.y,Te=ee[2]*this.x+ee[3]*this.y;return this.x=Le,this.y=Te,this},_add:function(ee){return this.x+=ee.x,this.y+=ee.y,this},_sub:function(ee){return this.x-=ee.x,this.y-=ee.y,this},_mult:function(ee){return this.x*=ee,this.y*=ee,this},_div:function(ee){return this.x/=ee,this.y/=ee,this},_multByPoint:function(ee){return this.x*=ee.x,this.y*=ee.y,this},_divByPoint:function(ee){return this.x/=ee.x,this.y/=ee.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var ee=this.y;return this.y=this.x,this.x=-ee,this},_rotate:function(ee){var Le=Math.cos(ee),Te=Math.sin(ee),y=Le*this.x-Te*this.y,Ie=Te*this.x+Le*this.y;return this.x=y,this.y=Ie,this},_rotateAround:function(ee,Le){var Te=Math.cos(ee),y=Math.sin(ee),Ie=Le.x+Te*(this.x-Le.x)-y*(this.y-Le.y),X=Le.y+y*(this.x-Le.x)+Te*(this.y-Le.y);return this.x=Ie,this.y=X,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},pe.convert=function(ee){return ee instanceof pe?ee:Array.isArray(ee)?new pe(ee[0],ee[1]):ee}},38929:function(sn,pe,ee){sn.exports.VectorTile=ee(22779),ee(66024),ee(59701)},22779:function(sn,pe,ee){"use strict";var Le=ee(59701);sn.exports=Te;function Te(Ie,X){this.layers=Ie.readFields(y,{},X)}function y(Ie,X,Se){if(Ie===3){var se=new Le(Se,Se.readVarint()+Se.pos);se.length&&(X[se.name]=se)}}},66024:function(sn,pe,ee){"use strict";var Le=ee(75550);sn.exports=Te;function Te(se,rt,ye,ot,ct){this.properties={},this.extent=ye,this.type=0,this._pbf=se,this._geometry=-1,this._keys=ot,this._values=ct,se.readFields(y,this,rt)}function y(se,rt,ye){se==1?rt.id=ye.readVarint():se==2?Ie(ye,rt):se==3?rt.type=ye.readVarint():se==4&&(rt._geometry=ye.pos)}function Ie(se,rt){for(var ye=se.readVarint()+se.pos;se.pos<ye;){var ot=rt._keys[se.readVarint()],ct=rt._values[se.readVarint()];rt.properties[ot]=ct}}Te.types=["Unknown","Point","LineString","Polygon"],Te.prototype.loadGeometry=function(){var se=this._pbf;se.pos=this._geometry;for(var rt=se.readVarint()+se.pos,ye=1,ot=0,ct=0,bt=0,Ot=[],vr;se.pos<rt;){if(ot<=0){var Ft=se.readVarint();ye=Ft&7,ot=Ft>>3}if(ot--,ye===1||ye===2)ct+=se.readSVarint(),bt+=se.readSVarint(),ye===1&&(vr&&Ot.push(vr),vr=[]),vr.push(new Le(ct,bt));else if(ye===7)vr&&vr.push(vr[0].clone());else throw new Error("unknown command "+ye)}return vr&&Ot.push(vr),Ot},Te.prototype.bbox=function(){var se=this._pbf;se.pos=this._geometry;for(var rt=se.readVarint()+se.pos,ye=1,ot=0,ct=0,bt=0,Ot=Infinity,vr=-Infinity,Ft=Infinity,gr=-Infinity;se.pos<rt;){if(ot<=0){var qt=se.readVarint();ye=qt&7,ot=qt>>3}if(ot--,ye===1||ye===2)ct+=se.readSVarint(),bt+=se.readSVarint(),ct<Ot&&(Ot=ct),ct>vr&&(vr=ct),bt<Ft&&(Ft=bt),bt>gr&&(gr=bt);else if(ye!==7)throw new Error("unknown command "+ye)}return[Ot,Ft,vr,gr]},Te.prototype.toGeoJSON=function(se,rt,ye){var ot=this.extent*Math.pow(2,ye),ct=this.extent*se,bt=this.extent*rt,Ot=this.loadGeometry(),vr=Te.types[this.type],Ft,gr;function qt(br){for(var J=0;J<br.length;J++){var Et=br[J],Ct=180-(Et.y+bt)*360/ot;br[J]=[(Et.x+ct)*360/ot-180,360/Math.PI*Math.atan(Math.exp(Ct*Math.PI/180))-90]}}switch(this.type){case 1:var It=[];for(Ft=0;Ft<Ot.length;Ft++)It[Ft]=Ot[Ft][0];Ot=It,qt(Ot);break;case 2:for(Ft=0;Ft<Ot.length;Ft++)qt(Ot[Ft]);break;case 3:for(Ot=X(Ot),Ft=0;Ft<Ot.length;Ft++)for(gr=0;gr<Ot[Ft].length;gr++)qt(Ot[Ft][gr]);break}Ot.length===1?Ot=Ot[0]:vr="Multi"+vr;var Zt={type:"Feature",geometry:{type:vr,coordinates:Ot},properties:this.properties};return"id"in this&&(Zt.id=this.id),Zt};function X(se){var rt=se.length;if(rt<=1)return[se];for(var ye=[],ot,ct,bt=0;bt<rt;bt++){var Ot=Se(se[bt]);Ot!==0&&(ct===void 0&&(ct=Ot<0),ct===Ot<0?(ot&&ye.push(ot),ot=[se[bt]]):ot.push(se[bt]))}return ot&&ye.push(ot),ye}function Se(se){for(var rt=0,ye=0,ot=se.length,ct=ot-1,bt,Ot;ye<ot;ct=ye++)bt=se[ye],Ot=se[ct],rt+=(Ot.x-bt.x)*(bt.y+Ot.y);return rt}},59701:function(sn,pe,ee){"use strict";var Le=ee(66024);sn.exports=Te;function Te(X,Se){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=X,this._keys=[],this._values=[],this._features=[],X.readFields(y,this,Se),this.length=this._features.length}function y(X,Se,se){X===15?Se.version=se.readVarint():X===1?Se.name=se.readString():X===5?Se.extent=se.readVarint():X===2?Se._features.push(se.pos):X===3?Se._keys.push(se.readString()):X===4&&Se._values.push(Ie(se))}function Ie(X){for(var Se=null,se=X.readVarint()+X.pos;X.pos<se;){var rt=X.readVarint()>>3;Se=rt===1?X.readString():rt===2?X.readFloat():rt===3?X.readDouble():rt===4?X.readVarint64():rt===5?X.readVarint():rt===6?X.readSVarint():rt===7?X.readBoolean():null}return Se}Te.prototype.feature=function(X){if(X<0||X>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[X];var Se=this._pbf.readVarint()+this._pbf.pos;return new Le(this._pbf,Se,this.extent,this._keys,this._values)}},86582:function(sn,pe,ee){"use strict";ee.d(pe,{Z:function(){return Se}});var Le=ee(72560);function Te(se){if(Array.isArray(se))return(0,Le.Z)(se)}function y(se){if(typeof Symbol!="undefined"&&se[Symbol.iterator]!=null||se["@@iterator"]!=null)return Array.from(se)}var Ie=ee(64254);function X(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Se(se){return Te(se)||y(se)||(0,Ie.Z)(se)||X()}},70499:function(sn){sn.exports={activeChart:"activeChart___15gpK",activeChartGrid:"activeChartGrid___3PL4c",activeChartLegend:"activeChartLegend___2Ieyc",dashedLine:"dashedLine___2fgZX",line:"line___2cxqk"}},19134:function(sn){sn.exports={mapChart:"mapChart___4fQJB",pieCard:"pieCard___1ETZj"}},64838:function(sn,pe,ee){"use strict";ee.r(pe),ee.d(pe,{default:function(){return y8}});var Le={};ee.r(Le),ee.d(Le,{add:function(){return Gd},adjoint:function(){return Rc},clone:function(){return Jo},copy:function(){return Xs},create:function(){return Oa},determinant:function(){return Cl},equals:function(){return Mo},exactEquals:function(){return Ap},frob:function(){return Vv},fromQuat:function(){return bp},fromQuat2:function(){return Zh},fromRotation:function(){return rd},fromRotationTranslation:function(){return lf},fromRotationTranslationScale:function(){return xp},fromRotationTranslationScaleOrigin:function(){return id},fromScaling:function(){return td},fromTranslation:function(){return Nh},fromValues:function(){return ba},fromXRotation:function(){return uf},fromYRotation:function(){return gp},fromZRotation:function(){return zh},frustum:function(){return Ep},getRotation:function(){return _p},getScaling:function(){return yp},getTranslation:function(){return nd},identity:function(){return Iu},invert:function(){return wo},lookAt:function(){return Cp},mul:function(){return rc},multiply:function(){return Pu},multiplyScalar:function(){return Wd},multiplyScalarAndAdd:function(){return q0},ortho:function(){return wp},orthoNO:function(){return fh},orthoZO:function(){return hh},perspective:function(){return Sp},perspectiveFromFieldOfView:function(){return ad},perspectiveNO:function(){return Uh},perspectiveZO:function(){return Vh},rotate:function(){return of},rotateX:function(){return sf},rotateY:function(){return Bh},rotateZ:function(){return Bf},scale:function(){return Lc},set:function(){return Ic},str:function(){return jd},sub:function(){return K0},subtract:function(){return Hd},targetTo:function(){return jh},translate:function(){return tc},transpose:function(){return Pc}});var Te=ee(58024),y=ee(91894),Ie=ee(13062),X=ee(71230),Se=ee(89032),se=ee(15746),rt=ee(95300),ye=ee(7277),ot=ee(81910),ct=ee(40010),bt=ee(21349),Ot=ee(92077),vr=ee.n(Ot),Ft=ee(39428),gr=ee(2824),qt=ee(3182),It=ee(69610),Zt=ee(54941),br=ee(81306),J=ee(59206),Et=ee(67294),Ct=(0,Et.createContext)({});function pt(){return(0,Et.useContext)(Ct)}var Ht={},vt={},sr=function(i){return vt[i]},Ir=function(i,t){vt[i]=t},ae=function(i){return Ht[i]},Ze=function(i,t){Ht[i]=t},Y={},ce={},ue=34,Xe=10,lt=13;function _t(e){return new Function("d","return {"+e.map(function(i,t){return JSON.stringify(i)+": d["+t+'] || ""'}).join(",")+"}")}function Xt(e,i){var t=_t(e);return function(n,r){return i(t(n),r,e)}}function hr(e){var i=Object.create(null),t=[];return e.forEach(function(n){for(var r in n)r in i||t.push(i[r]=r)}),t}function Yr(e,i){var t=e+"",n=t.length;return n<i?new Array(i-n+1).join(0)+t:t}function Hr(e){return e<0?"-"+Yr(-e,6):e>9999?"+"+Yr(e,6):Yr(e,4)}function vi(e){var i=e.getUTCHours(),t=e.getUTCMinutes(),n=e.getUTCSeconds(),r=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Hr(e.getUTCFullYear(),4)+"-"+Yr(e.getUTCMonth()+1,2)+"-"+Yr(e.getUTCDate(),2)+(r?"T"+Yr(i,2)+":"+Yr(t,2)+":"+Yr(n,2)+"."+Yr(r,3)+"Z":n?"T"+Yr(i,2)+":"+Yr(t,2)+":"+Yr(n,2)+"Z":t||i?"T"+Yr(i,2)+":"+Yr(t,2)+"Z":"")}function Vn(e){var i=new RegExp('["'+e+`
\r]`),t=e.charCodeAt(0);function n(E,A){var T,L,F=r(E,function(z,H){if(T)return T(z,H-1);L=z,T=A?Xt(z,A):_t(z)});return F.columns=L||[],F}function r(E,A){var T=[],L=E.length,F=0,z=0,H,ne=L<=0,oe=!1;E.charCodeAt(L-1)===Xe&&--L,E.charCodeAt(L-1)===lt&&--L;function ke(){if(ne)return ce;if(oe)return oe=!1,Y;var ft,At=F,Nt;if(E.charCodeAt(At)===ue){for(;F++<L&&E.charCodeAt(F)!==ue||E.charCodeAt(++F)===ue;);return(ft=F)>=L?ne=!0:(Nt=E.charCodeAt(F++))===Xe?oe=!0:Nt===lt&&(oe=!0,E.charCodeAt(F)===Xe&&++F),E.slice(At+1,ft-1).replace(/""/g,'"')}for(;F<L;){if((Nt=E.charCodeAt(ft=F++))===Xe)oe=!0;else if(Nt===lt)oe=!0,E.charCodeAt(F)===Xe&&++F;else if(Nt!==t)continue;return E.slice(At,ft)}return ne=!0,E.slice(At,L)}for(;(H=ke())!==ce;){for(var De=[];H!==Y&&H!==ce;)De.push(H),H=ke();A&&(De=A(De,z++))==null||T.push(De)}return T}function o(E,A){return E.map(function(T){return A.map(function(L){return x(T[L])}).join(e)})}function u(E,A){return A==null&&(A=hr(E)),[A.map(x).join(e)].concat(o(E,A)).join(`
`)}function l(E,A){return A==null&&(A=hr(E)),o(E,A).join(`
`)}function p(E){return E.map(v).join(`
`)}function v(E){return E.map(x).join(e)}function x(E){return E==null?"":E instanceof Date?vi(E):i.test(E+="")?'"'+E.replace(/"/g,'""')+'"':E}return{parse:n,parseRows:r,format:u,formatBody:l,formatRows:p,formatRow:v,formatValue:x}}var Xn=Vn(","),ma=Xn.parse,Pi=Xn.parseRows,mi=Xn.format,ca=Xn.formatBody,Gi=Xn.formatRows,Si=Xn.formatRow,ei=Xn.formatValue,cr=ee(85061),mt=ee(28991),Wa=ee(38163),xa=ee.n(Wa),gt=63710088e-1,he={centimeters:gt*100,centimetres:gt*100,degrees:gt/111325,feet:gt*3.28084,inches:gt*39.37,kilometers:gt/1e3,kilometres:gt/1e3,meters:gt,metres:gt,miles:gt/1609.344,millimeters:gt*1e3,millimetres:gt*1e3,nauticalmiles:gt/1852,radians:1,yards:gt*1.0936},ie={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/gt,yards:1.0936133},_e={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function N(e,i,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=i||{},n.geometry=e,n}function qe(e,i,t){switch(t===void 0&&(t={}),e){case"Point":return Qt(i).geometry;case"LineString":return pr(i).geometry;case"Polygon":return Ye(i).geometry;case"MultiPoint":return Yn(i).geometry;case"MultiLineString":return tn(i).geometry;case"MultiPolygon":return jn(i).geometry;default:throw new Error(e+" is invalid")}}function Qt(e,i,t){if(t===void 0&&(t={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!le(e[0])||!le(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return N(n,i,t)}function Nr(e,i,t){return t===void 0&&(t={}),Wr(e.map(function(n){return Qt(n,i)}),t)}function Ye(e,i,t){t===void 0&&(t={});for(var n=0,r=e;n<r.length;n++){var o=r[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return N(l,i,t)}function Pt(e,i,t){return t===void 0&&(t={}),Wr(e.map(function(n){return Ye(n,i)}),t)}function pr(e,i,t){if(t===void 0&&(t={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return N(n,i,t)}function Pr(e,i,t){return t===void 0&&(t={}),Wr(e.map(function(n){return pr(n,i)}),t)}function Wr(e,i){i===void 0&&(i={});var t={type:"FeatureCollection"};return i.id&&(t.id=i.id),i.bbox&&(t.bbox=i.bbox),t.features=e,t}function tn(e,i,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:e};return N(n,i,t)}function Yn(e,i,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:e};return N(n,i,t)}function jn(e,i,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:e};return N(n,i,t)}function an(e,i,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:e};return N(n,i,t)}function gi(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,i||0);return Math.round(e*t)/t}function ci(e,i){i===void 0&&(i="kilometers");var t=he[i];if(!t)throw new Error(i+" units is invalid");return e*t}function fa(e,i){i===void 0&&(i="kilometers");var t=he[i];if(!t)throw new Error(i+" units is invalid");return e/t}function ka(e,i){return Ea(fa(e,i))}function Ua(e){var i=e%360;return i<0&&(i+=360),i}function Ea(e){var i=e%(2*Math.PI);return i*180/Math.PI}function Wi(e){var i=e%360;return i*Math.PI/180}function q(e,i,t){if(i===void 0&&(i="kilometers"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("length must be a positive number");return ci(fa(e,i),t)}function re(e,i,t){if(i===void 0&&(i="meters"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=_e[i];if(!n)throw new Error("invalid original units");var r=_e[t];if(!r)throw new Error("invalid final units");return e/n*r}function le(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Ce(e){return!!e&&e.constructor===Object}function Be(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!le(i))throw new Error("bbox must only contain numbers")})}function et(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function dt(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function me(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ge(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Ge(e[0]);throw new Error("coordinates must only contain numbers")}function Dt(e,i,t){if(!i||!t)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+t+": must be a "+i+", given "+e.type)}function Lr(e,i,t){if(!e)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+t+": must be a "+i+", given "+e.geometry.type)}function er(e,i,t){if(!e)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(var n=0,r=e.features;n<r.length;n++){var o=r[n];if(!o||o.type!=="Feature"||!o.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!o.geometry||o.geometry.type!==i)throw new Error("Invalid input to "+t+": must be a "+i+", given "+o.geometry.type)}}function tr(e){return e.type==="Feature"?e.geometry:e}function Fr(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function In(e,i,t){if(e!==null)for(var n,r,o,u,l,p,v,x=0,E=0,A,T=e.type,L=T==="FeatureCollection",F=T==="Feature",z=L?e.features.length:1,H=0;H<z;H++){v=L?e.features[H].geometry:F?e.geometry:e,A=v?v.type==="GeometryCollection":!1,l=A?v.geometries.length:1;for(var ne=0;ne<l;ne++){var oe=0,ke=0;if(u=A?v.geometries[ne]:v,u!==null){p=u.coordinates;var De=u.type;switch(x=t&&(De==="Polygon"||De==="MultiPolygon")?1:0,De){case null:break;case"Point":if(i(p,E,H,oe,ke)===!1)return!1;E++,oe++;break;case"LineString":case"MultiPoint":for(n=0;n<p.length;n++){if(i(p[n],E,H,oe,ke)===!1)return!1;E++,De==="MultiPoint"&&oe++}De==="LineString"&&oe++;break;case"Polygon":case"MultiLineString":for(n=0;n<p.length;n++){for(r=0;r<p[n].length-x;r++){if(i(p[n][r],E,H,oe,ke)===!1)return!1;E++}De==="MultiLineString"&&oe++,De==="Polygon"&&ke++}De==="Polygon"&&oe++;break;case"MultiPolygon":for(n=0;n<p.length;n++){for(ke=0,r=0;r<p[n].length;r++){for(o=0;o<p[n][r].length-x;o++){if(i(p[n][r][o],E,H,oe,ke)===!1)return!1;E++}ke++}oe++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(In(u.geometries[n],i,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Pn(e,i,t,n){var r=t;return In(e,function(o,u,l,p,v){u===0&&t===void 0?r=o:r=i(r,o,u,l,p,v)},n),r}function $t(e,i){var t;switch(e.type){case"FeatureCollection":for(t=0;t<e.features.length&&i(e.features[t].properties,t)!==!1;t++);break;case"Feature":i(e.properties,0);break}}function wn(e,i,t){var n=t;return $t(e,function(r,o){o===0&&t===void 0?n=r:n=i(n,r,o)}),n}function fn(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var t=0;t<e.features.length&&i(e.features[t],t)!==!1;t++);}function gn(e,i,t){var n=t;return fn(e,function(r,o){o===0&&t===void 0?n=r:n=i(n,r,o)}),n}function Ii(e){var i=[];return In(e,function(t){i.push(t)}),i}function xn(e,i){var t,n,r,o,u,l,p,v,x,E,A=0,T=e.type==="FeatureCollection",L=e.type==="Feature",F=T?e.features.length:1;for(t=0;t<F;t++){for(l=T?e.features[t].geometry:L?e.geometry:e,v=T?e.features[t].properties:L?e.properties:{},x=T?e.features[t].bbox:L?e.bbox:void 0,E=T?e.features[t].id:L?e.id:void 0,p=l?l.type==="GeometryCollection":!1,u=p?l.geometries.length:1,r=0;r<u;r++){if(o=p?l.geometries[r]:l,o===null){if(i(null,A,v,x,E)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(o,A,v,x,E)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(i(o.geometries[n],A,v,x,E)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}A++}}function Ni(e,i,t){var n=t;return xn(e,function(r,o,u,l,p){o===0&&t===void 0?n=r:n=i(n,r,o,u,l,p)}),n}function sa(e,i){xn(e,function(t,n,r,o,u){var l=t===null?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return i(N(t,r,{bbox:o,id:u}),n,0)===!1?!1:void 0}var p;switch(l){case"MultiPoint":p="Point";break;case"MultiLineString":p="LineString";break;case"MultiPolygon":p="Polygon";break}for(var v=0;v<t.coordinates.length;v++){var x=t.coordinates[v],E={type:p,coordinates:x};if(i(N(E,r),n,v)===!1)return!1}})}function Oi(e,i,t){var n=t;return sa(e,function(r,o,u){o===0&&u===0&&t===void 0?n=r:n=i(n,r,o,u)}),n}function Zi(e,i){sa(e,function(t,n,r){var o=0;if(!!t.geometry){var u=t.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var l,p=0,v=0,x=0;if(In(t,function(E,A,T,L,F){if(l===void 0||n>p||L>v||F>x){l=E,p=n,v=L,x=F,o=0;return}var z=lineString([l,E],t.properties);if(i(z,n,r,F,o)===!1)return!1;o++,l=E})===!1)return!1}}})}function Fi(e,i,t){var n=t,r=!1;return Zi(e,function(o,u,l,p,v){r===!1&&t===void 0?n=o:n=i(n,o,u,l,p,v),r=!0}),n}function yi(e,i){if(!e)throw new Error("geojson is required");sa(e,function(t,n,r){if(t.geometry!==null){var o=t.geometry.type,u=t.geometry.coordinates;switch(o){case"LineString":if(i(t,n,r,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<u.length;l++)if(i(lineString(u[l],t.properties),n,r,l)===!1)return!1;break}}})}function ha(e,i,t){var n=t;return yi(e,function(r,o,u,l){o===0&&t===void 0?n=r:n=i(n,r,o,u,l)}),n}function Xa(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var t=i.featureIndex||0,n=i.multiFeatureIndex||0,r=i.geometryIndex||0,o=i.segmentIndex||0,u=i.properties,l;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),u=u||e.features[t].properties,l=e.features[t].geometry;break;case"Feature":u=u||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var p=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=p.length+o-1),lineString([p[o],p[o+1]],u,i);case"Polygon":return r<0&&(r=p.length+r),o<0&&(o=p[r].length+o-1),lineString([p[r][o],p[r][o+1]],u,i);case"MultiLineString":return n<0&&(n=p.length+n),o<0&&(o=p[n].length+o-1),lineString([p[n][o],p[n][o+1]],u,i);case"MultiPolygon":return n<0&&(n=p.length+n),r<0&&(r=p[n].length+r),o<0&&(o=p[n][r].length-o-1),lineString([p[n][r][o],p[n][r][o+1]],u,i)}throw new Error("geojson is invalid")}function ga(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var t=i.featureIndex||0,n=i.multiFeatureIndex||0,r=i.geometryIndex||0,o=i.coordIndex||0,u=i.properties,l;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),u=u||e.features[t].properties,l=e.features[t].geometry;break;case"Feature":u=u||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var p=l.coordinates;switch(l.type){case"Point":return point(p,u,i);case"MultiPoint":return n<0&&(n=p.length+n),point(p[n],u,i);case"LineString":return o<0&&(o=p.length+o),point(p[o],u,i);case"Polygon":return r<0&&(r=p.length+r),o<0&&(o=p[r].length+o),point(p[r][o],u,i);case"MultiLineString":return n<0&&(n=p.length+n),o<0&&(o=p[n].length+o),point(p[n][o],u,i);case"MultiPolygon":return n<0&&(n=p.length+n),r<0&&(r=p[n].length+r),o<0&&(o=p[n][r].length-o),point(p[n][r][o],u,i)}throw new Error("geojson is invalid")}function zi(e,i){var t=i.x,n=i.y,r=i.x1,o=i.y1,u=i.coordinates,l=i.geometry,p=[];if(!Array.isArray(e))return{dataArray:[]};if(l)return e.filter(function(H){return H[l]&&H[l].type&&H[l].coordinates&&H[l].coordinates.length>0}).forEach(function(H,ne){var oe=xa()((0,mt.Z)({},H[l]),!0);sa(oe,function(ke){var De=me(ke),ft=(0,mt.Z)((0,mt.Z)({},H),{},{_id:ne,coordinates:De});p.push(ft)})}),{dataArray:p};for(var v=0;v<e.length;v++){var x=e[v],E=[];if(u){var A="Polygon";Array.isArray(u[0])||(A="Point"),Array.isArray(u[0])&&!Array.isArray(u[0][0])&&(A="LineString");var T=xa()({type:A,coordinates:(0,cr.Z)(x[u])},!0);E=T.coordinates}else if(t&&n&&r&&o){var L=[parseFloat(x[t]),parseFloat(x[n])],F=[parseFloat(x[r]),parseFloat(x[o])];E=[L,F]}else t&&n&&(E=[parseFloat(x[t]),parseFloat(x[n])]);var z=(0,mt.Z)((0,mt.Z)({},x),{},{_id:v,coordinates:E});p.push(z)}return{dataArray:p}}function Ji(e,i){var t=ma(e);return zi(t,i)}function Va(e){for(var i=e.toString(),t=5381,n=i.length;n;)t=t*33^i.charCodeAt(--n);return t>>>0}function tu(e,i){return i===void 0?null:e.properties[i]?e.properties[i]:e.properties&&e.properties[i]?Va(e.properties[i]+"")%1000019:null}function $a(e,i){var t=[],n={};return e.features?(e.features=e.features.filter(function(r){var o=r.geometry;return r!=null&&o&&o.type&&o.coordinates&&o.coordinates.length>0}),xa()(e,!0),e.features.length===0?{dataArray:[],featureKeys:n}:(sa(e,function(r,o){var u=tu(r,i==null?void 0:i.featureId);u===null&&(u=o);var l=u,p=me(r),v=(0,mt.Z)((0,mt.Z)({},r.properties),{},{coordinates:p,_id:l});t.push(v)}),{dataArray:t,featureKeys:n})):(e.features=[],{dataArray:[]})}function Fa(e){var i=131,t=137,n=0;e+="x";for(var r=Math.floor(9007199254740991/t),o=0;o<e.length;o++)n>r&&(n=Math.floor(n/t)),n=n*i+e.charCodeAt(o);return n}function Fs(e){e=e.toString();for(var i=5381,t=e.length;t;)i=i*33^e.charCodeAt(--t);return i>>>0}var $n=ee(28481),ur=ee(96486),$s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function uo(e){this.message=e}uo.prototype=new Error,uo.prototype.name="InvalidCharacterError";function Ja(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new uo("'atob' failed: The string to be decoded is not correctly encoded.");for(var t="",n=0,r,o,u=0;o=i.charAt(u++);~o&&(r=n%4?r*64+o:o,n++%4)?t+=String.fromCharCode(255&r>>(-2*n&6)):0)o=$s.indexOf(o);return t}function eo(e){e=String(e);for(var i,t,n,r,o="",u=0,l=e.length%3;u<e.length;){if((t=e.charCodeAt(u++))>255||(n=e.charCodeAt(u++))>255||(r=e.charCodeAt(u++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=t<<16|n<<8|r,o+=$s.charAt(i>>18&63)+$s.charAt(i>>12&63)+$s.charAt(i>>6&63)+$s.charAt(i&63)}return l?o.slice(0,l-3)+"===".substring(l):o}var wt=ee(6610),zt=ee(5991),rs=function(){function e(i,t){(0,wt.Z)(this,e),this.buffers=i,this.type=t}return(0,zt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(t,n,r){throw new Error("not implemented")}}]),e}(),du,Io=function(){return du||(du=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof ee.g!="undefined"?ee.g:{})};du=Io();var za;typeof window=="undefined"?za={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,t,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,t){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:za=window;var Sa=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,xo=Sa?my.getSystemInfoSync().pixelRatio:za.devicePixelRatio,Dr=ee(10379),Rr=ee(46070),Qe=ee(77608),Fu=(0,zt.Z)(function e(i,t){(0,wt.Z)(this,e),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),He=ee(63349);function fe(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Pe(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function Pe(e,i){if(!!e){if(typeof e=="string")return ht(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ht(e,i)}}function ht(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}var Kt=new WeakMap,en=function(){function e(){(0,wt.Z)(this,e),Kt.set(this,{})}return(0,zt.Z)(e,[{key:"addEventListener",value:function(t,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=Kt.get(this);o||(o={}),o[t]||(o[t]=[]),o[t].push(n),Kt.set(this,o),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=Kt.get(this);if(o){var u=o[t];if(u&&u.length>0){for(var l=u.length;l--;l>0)if(u[l]===n){u.splice(l,1);break}}}}},{key:"dispatchEvent",value:function(t){var n=Kt.get(this)[t.type];if(n){var r=fe(n),o;try{for(r.s();!(o=r.n()).done;){var u=o.value;u(t)}}catch(l){r.e(l)}finally{r.f()}}}}]),e}();function qn(e){var i=Ui();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function Ui(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lo=function(e){(0,Dr.Z)(t,e);var i=qn(t);function t(){var n;return(0,wt.Z)(this,t),n=i.call(this),n.childNodes=[],n}return(0,zt.Z)(t,[{key:"appendChild",value:function(r){this.childNodes.push(r)}},{key:"cloneNode",value:function(){var r=Object.create(this);return Object.assign(r,this),r}},{key:"removeChild",value:function(r){var o=this.childNodes.findIndex(function(u){return u===r});return o>-1?this.childNodes.splice(o,1):null}}]),t}(en);function Ya(e){var i=to();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function to(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $o=function(e){(0,Dr.Z)(t,e);var i=Ya(t);function t(){var n;return(0,wt.Z)(this,t),n=i.call(this),n.className="",n.children=[],n}return(0,zt.Z)(t,[{key:"setAttribute",value:function(r,o){this[r]=o}},{key:"getAttribute",value:function(r){return this[r]}},{key:"setAttributeNS",value:function(r,o){this[r]=o}},{key:"getAttributeNS",value:function(r){return this[r]}}]),t}(lo),Ms=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Vo,fs,hs,ys;if(Ms){var ks=my.getSystemInfoSync();Vo=ks.screenWidth,fs=ks.screenHeight,hs=ks.windowWidth,ys=ks.windowHeight}else{var ru=za.innerWidth,_s=za.innerHeight;Vo=ru,fs=_s,hs=ru,ys=_s}var ya={width:Vo,height:fs,availWidth:hs,availHeight:ys,availLeft:0,availTop:0},bo=ya.availWidth,Gu=ya.availHeight,fc={style:[]};function Hu(e,i){if(!("parentNode"in e)){var t;i===0?t=function(){return null}:i===1?t=function(){return fc}:t=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:t})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return fc}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function Bc(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:bo+"px",height:Gu+"px",margin:"0px",padding:"0px"})}function Il(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=bo,e.clientHeight=Gu),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function ol(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=bo,e.offsetHeight=Gu)}function vu(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=bo,e.scrollHeight=Gu)}function sl(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function b(e){var i=k();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function k(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Z(){}var R=function(e){(0,Dr.Z)(t,e);var i=b(t);function t(){var n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return(0,wt.Z)(this,t),n=i.call(this),n.className="",n.children=[],n.focus=Z,n.blur=Z,n.insertBefore=Z,n.appendChild=Z,n.removeChild=Z,n.remove=Z,n.innerHTML="",n.tagName=r.toUpperCase(),Hu((0,He.Z)(n),o),Bc((0,He.Z)(n)),sl((0,He.Z)(n)),Il((0,He.Z)(n)),ol((0,He.Z)(n)),vu((0,He.Z)(n)),n}return(0,zt.Z)(t)}($o);function te(e){var i=Me();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function Me(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var at=function(e){(0,Dr.Z)(t,e);var i=te(t);function t(n){return(0,wt.Z)(this,t),i.call(this,n)}return(0,zt.Z)(t,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),t}(R);function Rt(e){var i=Lt();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function Lt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ar=function(e){(0,Dr.Z)(t,e);var i=Rt(t);function t(){return(0,wt.Z)(this,t),i.call(this,"video")}return(0,zt.Z)(t)}(at),Tr={},Fn={};function Ai(e,i){Tr=e,Tr.id=i,"tagName"in Tr||(Tr.tagName="CANVAS"),Tr.type="canvas",Mixin.parentNode(Tr),Mixin.style(Tr),Mixin.classList(Tr),Mixin.clientRegion(Tr),Mixin.offsetRegion(Tr),Tr.focus=function(){},Tr.blur=function(){}}function _i(e,i){var t=1024,n=1024;Fn={width:t,height:n,clientWidth:t/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in Fn||(Fn.tagName="CANVAS"),Mixin.parentNode(Fn),Mixin.style(Fn),Mixin.classList(Fn),Mixin.clientRegion(Fn),Mixin.offsetRegion(Fn),Fn.getContext=function(r){if(r==="2d")return e},Fn.focus=function(){},Fn.blur=function(){}}function Di(){return Tr}function Ia(){return Fn}var Da=(0,zt.Z)(function e(){(0,wt.Z)(this,e);var i=Di(),t=i.createImage&&i.createImage()||{};return"tagName"in t||(t.tagName="IMG",t.__proto__=e.prototype),Hu(t),sl(t),Object.assign(t,{addEventListener:function(r,o){t["on".concat(r)]=o.bind(t)},removeEventListener:function(r){t["on".concat(r)]=null}}),t}),ea={href:"",protocol:"",host:""};function xs(e){var i=bu();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function bu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ul=function(e){(0,Dr.Z)(t,e);var i=xs(t);function t(){return(0,wt.Z)(this,t),i.call(this,"body",0)}return(0,zt.Z)(t,[{key:"addEventListener",value:function(r,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(r,o,u){}},{key:"dispatchEvent",value:function(r){}}]),t}(R),vf=function(e){(0,Dr.Z)(t,e);var i=xs(t);function t(){return(0,wt.Z)(this,t),i.call(this,"html",0)}return(0,zt.Z)(t,[{key:"addEventListener",value:function(r,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(r,o){}},{key:"dispatchEvent",value:function(r){}}]),t}(R),mu={},Ds={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:ea,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new Da:i==="video"?new Ar:new R(i)},createElementNS:function(i,t){return this.createElement(t)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,t){return this.getElementsByTagName(t)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,t,n){mu[i]||(mu[i]=[]),mu[i].push(t)},removeEventListener:function(i,t){var n=mu[i];if(n&&n.length>0){for(var r=n.length;r--;r>0)if(n[r]===t){n.splice(r,1);break}}},dispatchEvent:function(i){var t=i.type,n=mu[t];if(n)for(var r=0;r<n.length;r++)n[r](i);i.target&&typeof i.target["on"+t]=="function"&&i.target["on"+t](i)},createEvent:function(i){return new Fu(i)}};Ds.documentElement=new vf,Ds.head=new R("head"),Ds.body=new ul;var Du=Object,gu=ee(90484),Bu=function(){function e(){(0,wt.Z)(this,e);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,gu.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,zt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),Eo=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Nc,Is,ns;if(Eo){var hc=my.getSystemInfoSync();Nc=hc.system,Is=hc.platform,ns=hc.language}else{var Po={versions:function(){var e=za.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(za.navigator.browserLanguage||za.navigator.language).toLowerCase()};Po.versions.android?Is="android":Po.versions.trident?Is="IE":Po.versions.presto?Is="Opera":Po.versions.webKit?Is="webKit":Po.versions.gecko?Is="Firefox":Po.versions.mobile?Is="mobile":Po.versions.ios?Is="ios":Po.versions.iPhone?Is="iPhone":Po.versions.iPad?Is="ipad":Po.versions.webApp?Is="webApp":Po.versions.weixin?Is="weixin":Po.versions.qq&&(Is="qq"),Nc=za.navigator.userAgent,ns=Po.language}var nu=Nc.toLowerCase().indexOf("android")!==-1,zc=nu?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",ll="Mozilla/5.0 (".concat(zc,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(ns),Pa={platform:Is,language:ns,appVersion:"5.0 (".concat(zc,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:ll},Pl={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,t,n){return{duration:0}},now:function(){}},Gf=0,Wu=0;function Hf(e){var i=Date.now(),t=Math.max(Gf+23,i);return Wu=setTimeout(function(){e(Gf=t)},t-i),Wu}function tp(e){var i=Di();return i.requestAnimationFrame?i.requestAnimationFrame(e):Hf(e)}function Eh(e){var i=Di();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var mf=function(){function e(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,wt.Z)(this,e),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=t+i}return(0,zt.Z)(e,null,[{key:"createObjectURL",value:function(t){var n=t.buffers[0],r=t.type,o=pc(n),u="data:".concat(r,";base64, ");return u+o}}]),e}();function pc(e){for(var i="",t=new Uint8Array(e),n=t.byteLength,r=0;r<n;r++)i+=String.fromCharCode(t[r]);return eo(i)}var Rl={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},Ll={};function Ol(e){var i=cl();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function cl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xu=new Map,$u=new Map,iu=new Map,Wf={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function gf(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function Sh(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,gf.call(this,"readystatechange",i)}var Ys=function(e){(0,Dr.Z)(t,e);var i=Ol(t);function t(){var n;return(0,wt.Z)(this,t),n=i.call(this),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,Xu.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,zt.Z)(t,[{key:"responseType",set:function(r){this._responseType=r}},{key:"abort",value:function(){var r=iu.get("requestTask");r&&r.abort()}},{key:"getAllResponseHeaders",value:function(){var r=$u.get("responseHeader");return Object.keys(r).map(function(o){return"".concat(o,": ").concat(r[o])}).join(`
`)}},{key:"getResponseHeader",value:function(r){return $u.get("responseHeader")[r]}},{key:"open",value:function(r,o,u){this._method=r,this._url=o}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(r,o){var u=Xu.get("requestHeader");u[r]=o,Xu.set("requestHeader",u)}},{key:"addEventListener",value:function(r,o){var u=this;typeof o=="function"&&(this["on"+r]=function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};l.target=l.target||u,o.call(u,l)})}},{key:"removeEventListener",value:function(r,o){this["on"+r]===o&&(this["on"+r]=null)}}]),t}(en);Ys.UNSEND=0,Ys.OPENED=1,Ys.HEADERS_RECEIVED=2,Ys.LOADING=3,Ys.DONE=4;function dc(e){var i=Zc();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function Zc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yf=function(e){(0,Dr.Z)(t,e);var i=dc(t);function t(n){var r;return(0,wt.Z)(this,t),r=i.call(this,n),r.touches=[],r.targetTouches=[],r.changedTouches=[],r.target=Di(),r.currentTarget=Di(),r}return(0,zt.Z)(t)}(Fu);function Fl(e){var i=e||{},t=i.x,n=t===void 0?0:t,r=i.y,o=r===void 0?0:r,u=i.clientX,l=u===void 0?0:u,p=i.clientY,v=p===void 0?0:p;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=o):(e.x=l,e.y=v)}function _f(e){return function(i){var t=new yf(e);t.changedTouches=i.changedTouches,t.touches=i.touches,t.targetTouches=Array.prototype.slice.call(i.touches),t.timeStamp=i.timeStamp,t.changedTouches.forEach(function(n){return Fl(n)}),t.touches.forEach(function(n){return Fl(n)}),t.targetTouches.forEach(function(n){return Fl(n)}),Ds.dispatchEvent(t)}}function Uc(e){return function(i){i.type=e,Ds.dispatchEvent(i)}}var Dl=_f("touchstart"),Xf=_f("touchmove"),$f=_f("touchend"),Bl=Uc("mapCameaParams");function Yf(e){var i=qf();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function qf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Kf=function(e){(0,Dr.Z)(t,e);var i=Yf(t);function t(n){var r;return(0,wt.Z)(this,t),r=i.call(this,n),r.target=Di(),r.currentTarget=Di(),r}return(0,zt.Z)(t)}(Fu),fl=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],wh=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],Nl="touch";function ro(e,i,t){for(var n=new Kf(e),r=0;r<fl.length;r++){var o=fl[r];n[o]=i[o]||wh[r]}return n.type=e,n.target=Di(),n.currentTarget=Di(),n.buttons=vc(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=Nu(i),n.pointerType=Nl,n.altKey=t.altKey,n.ctrlKey=t.ctrlKey,n.metaKey=t.metaKey,n.shiftKey=t.shiftKey,t.preventDefault&&(n.preventDefault=function(){t.preventDefault()}),n}function vc(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var Eu=null;function Nu(e){return Eu===e.identifier}function aa(e){Eu===null&&(Eu=e.identifier)}function ja(e){Eu===e.identifier&&(Eu=null)}function bs(e){return function(i){for(var t=i.changedTouches,n=0;n<t.length;n++){var r=t[n];n===0&&e==="pointerdown"?aa(r):(e==="pointerup"||e==="pointercancel")&&ja(r);var o=ro(e,r,i);Ds.dispatchEvent(o)}}}var xf=bs("pointerdown"),hl=bs("pointermove"),bf=bs("pointerup");function rp(e){var i=np();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function np(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ef=function(e){(0,Dr.Z)(t,e);var i=rp(t);function t(n){return(0,wt.Z)(this,t),i.call(this,n)}return(0,zt.Z)(t)}(Fu);function zl(e){return function(i){i.type=e,Ds.dispatchEvent(i)}}var pl=zl("mousedown"),Yo=zl("mousemove"),Vc=zl("mouseup"),Zl=!1;function Ro(e){Zl=e}var Dn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,mo=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),jo=(Dn||mo)&&Zl,Ul={atob:Ja,btoa:eo,devicePixelRatio:xo,Blob:rs,document:Ds,Element:$o,Event:Fu,EventTarget:en,HTMLCanvasElement:Du,HTMLElement:R,HTMLMediaElement:at,HTMLVideoElement:Ar,Image:Da,ImageData:Bu,navigator:Pa,Node:lo,requestAnimationFrame:tp,cancelAnimationFrame:Eh,screen:ya,XMLHttpRequest:Ys,performance:Pl,URL:mf,WebGLRenderingContext:Rl,WebGL2RenderingContext:Ll,addEventListener:function(i,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Ds.addEventListener(i,t,n)},removeEventListener:function(i,t,n){Ds.removeEventListener(i,t)},dispatchEvent:function(i){Ds.dispatchEvent(i)},innerWidth:ya.availWidth,innerHeight:ya.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},Xi=jo?Ul:za,Bs=jo?Ys:za.XMLHttpRequest,Qf=jo?ea:za.location;function vn(e){var i=e;return typeof e=="string"&&(i=Xi.document.getElementById(e)),i}function jc(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Sf(e){return jc(e).split(/\s+/)}function dl(e){var i,t,n=Xi==null||(i=Xi.document)===null||i===void 0||(t=i.documentElement)===null||t===void 0?void 0:t.style;if(!n)return e[0];for(var r in e)if(e[r]&&e[r]in n)return e[r];return e[0]}function ri(e,i,t){var n=Xi.document.createElement(e);return i&&(n.className=i||""),t&&t.appendChild(n),n}function no(e){var i=e.parentNode;i&&i.removeChild(e)}function Ns(e,i){if(e.classList!==void 0)for(var t=Sf(i),n=0,r=t.length;n<r;n++)e.classList.add(t[n]);else if(!zs(e,i)){var o=wf(e);Su(e,(o?o+" ":"")+i)}}function Ps(e,i){e.classList!==void 0?e.classList.remove(i):Su(e,jc((" "+wf(e)+" ").replace(" "+i+" "," ")))}function zs(e,i){if(e.classList!==void 0)return e.classList.contains(i);var t=wf(e);return t.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(t)}function Su(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function wf(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Cf(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var Jf=dl(["transform","WebkitTransform"]);function Af(e,i){e.style[Jf]=i}function au(){if(typeof Event=="function")Xi.dispatchEvent(new Event("resize"));else{var e=Xi.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,Xi,0),Xi.dispatchEvent(e)}}function ou(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function Vi(){var e,i=Xi.document.querySelector('meta[name="viewport"]');if(!i)return 1;var t=(e=i.content)===null||e===void 0?void 0:e.split(","),n=t.find(function(r){var o=r.split("="),u=(0,$n.Z)(o,1),l=u[0];return l==="initial-scale"});return n?n.split("=")[1]*1:1}var Ra=Vi()<1?1:Xi.devicePixelRatio;function su(e,i){e.setAttribute("style","".concat(e.style.cssText).concat(i))}function qo(e){return e.split(";").map(function(i){return i.trim()}).filter(function(i){return i})}function Vl(e,i){var t,n=qo((t=e.getAttribute("style"))!==null&&t!==void 0?t:""),r=qo(i),o=ur.pull.apply(void 0,[n].concat((0,cr.Z)(r)));e.setAttribute("style",o.join(";"))}function vl(e){return Object.entries(e).map(function(i){var t=(0,$n.Z)(i,2),n=t[0],r=t[1];return"".concat(n,": ").concat(r)}).join(";")}function qs(e,i){return{left:e.left-i.left,top:e.top-i.top,right:i.left+i.width-e.left-e.width,bottom:i.top+i.height-e.top-e.height}}function ps(e,i){e.checked=i,i?e.setAttribute("checked","true"):e.removeAttribute("checked")}function Rs(e){e.innerHTML=""}function Qn(e){e.setAttribute("draggable","false")}function Bn(e,i){if(typeof i=="string"){var t=document.createElement("div");for(t.innerHTML=i;t.firstChild;)e.append(t.firstChild)}else Array.isArray(i)?e.append.apply(e,(0,cr.Z)(i)):e.append(i)}function Gc(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],t=1;t<e.length;t++)e[t]>i&&(i=e[t]);return i*1}function Es(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],t=1;t<e.length;t++)e[t]<i&&(i=e[t]);return i*1}function uu(e){if(e.length===0)return 0;for(var i=e[0]*1,t=1;t<e.length;t++)i+=e[t]*1;return i}function is(e){if(e.length===0)throw new Error("mean requires at least one data point");return uu(e)/e.length}function wu(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],t=NaN,n=0,r=1,o=1;o<e.length+1;o++)e[o]!==i?(r>n&&(n=r,t=i),r=1,i=e[o]):r++;return t*1}var mc={min:Es,max:Gc,mean:is,sum:uu,mode:wu};function jl(e,i){return e.map(function(t){return t[i]})}function wa(e,i){return mc[e](i)}var Ga=ee(14665);function eh(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var Gl=ee(51814);function Ks(e,i,t){return(0,Gl.Z)()?Ks=Reflect.construct.bind():Ks=function(r,o,u){var l=[null];l.push.apply(l,o);var p=Function.bind.apply(r,l),v=new p;return u&&(0,Ga.Z)(v,u.prototype),v},Ks.apply(null,arguments)}function lu(e){var i=typeof Map=="function"?new Map:void 0;return lu=function(n){if(n===null||!eh(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,r)}function r(){return Ks(n,arguments,(0,Qe.Z)(this).constructor)}return r.prototype=Object.create(n.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),(0,Ga.Z)(r,n)},lu(e)}function Ko(e){var i=Yu();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function Yu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cu=function(e){(0,Dr.Z)(t,e);var i=Ko(t);function t(n,r,o,u){var l;return(0,wt.Z)(this,t),l=i.call(this,"AJAXError: ".concat(r," (").concat(n,"): ").concat(o)),l.status=n,l.statusText=r,l.url=o,l.body=u,l}return(0,zt.Z)(t)}(lu(Error));function gc(e,i){var t=new Bs,n=Array.isArray(e.url)?e.url[0]:e.url;t.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(t.responseType="arraybuffer");for(var r in e.headers)e.headers.hasOwnProperty(r)&&t.setRequestHeader(r,e.headers[r]);return e.type==="json"&&(t.responseType="text",t.setRequestHeader("Accept","application/json")),t.withCredentials=e.credentials==="include",t.onerror=function(){i(new Error(t.statusText))},t.onload=function(){if((t.status>=200&&t.status<300||t.status===0)&&t.response!==null){var o=t.response;if(e.type==="json")try{o=JSON.parse(t.response)}catch(l){return i(l)}i(null,o,t.getResponseHeader("Cache-Control"),t.getResponseHeader("Expires"),t)}else{var u=new Blob([t.response],{type:t.getResponseHeader("Content-Type")});i(new Cu(t.status,t.statusText,n.toString(),u))}},t.send(e.body),t}function Hl(e){return new Promise(function(i,t){gc(e,function(n,r,o,u,l){n?t({err:n,data:null,xhr:l}):i({err:null,data:r,cacheControl:o,expires:u,xhr:l})})})}function ml(e,i){return gc(e,i)}var Tf=function(i,t){return ml((0,mt.Z)((0,mt.Z)({},i),{},{type:"json"}),t)},gl=function(i,t){return ml((0,mt.Z)((0,mt.Z)({},i),{},{type:"arrayBuffer"}),t)},yc=function(i,t){return ml(_objectSpread(_objectSpread({},i),{},{method:"POST"}),t)};function Ch(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var qu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function yl(e,i){var t=new Xi.Image,n=Xi.URL||Xi.webkitURL;t.crossOrigin="anonymous",t.onload=function(){i(null,t),n.revokeObjectURL(t.src),t.onload=null,window.requestAnimationFrame(function(){t.src=qu})},t.onerror=function(){return i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var r=new Blob([new Uint8Array(e)],{type:"image/png"});t.src=e.byteLength?n.createObjectURL(r):qu}function Mf(e,i){var t=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(t).then(function(n){i(null,n)}).catch(function(n){i(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var zu=function(i,t,n){var r=function(u,l){if(u)t(u);else if(l){var p=typeof createImageBitmap=="function",v=n?n(l):l;p?Mf(v,t):yl(v,t)}};return i.type==="json"?Tf(i,r):gl(i,r)};function Zs(e){return typeof e=="number"}function _c(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return In(e,function(t){i[0]>t[0]&&(i[0]=t[0]),i[1]>t[1]&&(i[1]=t[1]),i[2]<t[0]&&(i[2]=t[0]),i[3]<t[1]&&(i[3]=t[1])}),i}_c.default=_c;var Hc=_c,xc=2*Math.PI*6378137/2;function bc(e,i){var t=(0,$n.Z)(i,4),n=t[0],r=t[1],o=t[2],u=t[3];return e.lng>n&&e.lng<=o&&e.lat>r&&e.lat<=u}function f(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(t){var n=t.coordinates;d(i,n)}),i}function d(e,i){return Array.isArray(i[0])?i.forEach(function(t){d(e,t)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function h(e,i){return g(e,i)}function g(e,i){return Array.isArray(e[0])?e.map(function(t){return g(t,i)}):i(e)}function w(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=G(e,i);var n=e[0],r=e[1],o=n*xc/180,u=Math.log(Math.tan((90+r)*Math.PI/360))/(Math.PI/180);return u=u*xc/180,t.enable&&(o=Number(o.toFixed(t.decimal)),u=Number(u.toFixed(t.decimal))),e.length===3?[o,u,e[2]]:[o,u]}function M(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,t=e[0],n=e[1],r=t/xc*180,o=n/xc*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),i!=null&&(r=Number(r.toFixed(i)),o=Number(o.toFixed(i))),e.length===3?[r,o,e[2]]:[r,o]}function I(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function O(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function G(e,i){if(i===!1)return e;var t=I(e[0]),n=O(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[t,n,e[2]]:[t,n]}function Q(e){var i=85.0511287798,t=Math.max(Math.min(i,e[1]),-i),n=256<<20,r=Math.PI/180,o=e[0]*r,u=t*r;u=Math.log(Math.tan(Math.PI/4+u/2));var l=.5/Math.PI,p=.5,v=-.5/Math.PI;return r=.5,o=n*(l*o+p),u=n*(v*u+r),[Math.floor(o),Math.floor(u)]}function ge(e){var i=.5/Math.PI,t=.5,n=-.5/Math.PI,r=.5,o=256<<20,u=_slicedToArray(e,2),l=u[0],p=u[1];l=(l/o-t)/i,p=(p/o-r)/n,p=(Math.atan(Math.pow(Math.E,p))-Math.PI/4)*2,r=Math.PI/180;var v=p/r,x=l/r;return[x,v]}function xe(e,i){var t=85.0511287798,n=Math.PI/180,r=6378137;return i=Math.max(Math.min(t,i),-t),e*=n,i*=n,i=Math.log(Math.tan(Math.PI/4+i/2)),[e*r,i*r]}function Ee(e,i){var t=Math.PI/180,n=6378137,r=e/n/t,o=2*(Math.atan(Math.exp(i/n))-Math.PI/4)/t;return[r,o]}function je(e,i,t){var n=Wi(i[1]-e[1]),r=Wi(i[0]-e[0]),o=Wi(e[1]),u=Wi(i[1]),l=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(r/2),2)*Math.cos(o)*Math.cos(u);return ci(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),t="meters")}function Ve(e){var i=Math.PI/180,t=85.0511287798,n=6378137,r=Math.max(Math.min(t,e[1]),-t),o=Math.sin(r*i),u=n*e[0]*i,l=n*Math.log((1+o)/(1-o))/2;return[u,l]}function nt(e,i){var t=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-t],[e[1][0]+n,e[1][1]+t]]}function Fe(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function it(e){return[[e[0],e[1]],[e[2],e[3]]]}function yt(e){var i=Bt(e,[0,0]);return[e[0]/i,e[1]/i]}function Bt(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function fr(e,i){return e[0]*i[0]+e[1]*i[1]}function ir(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function mr(e,i){return Math.acos(fr(e,i)/(ir(e)*ir(i)))*180/Math.PI}function Or(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function on(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var t=[0,1],n=0,r=[],o=0;o<e.length-1;o++){var u=e[o],l=e[o+1],p=Bt(u,l);n+=p;var v=[u[0]-l[0],u[1]-l[1]],x=Or(t,v);if(o>0){var E=r[o-1].rotation;E-x>360-E+x&&(x=x+360)}r.push({start:u,end:l,dis:p,rotation:x,duration:0})}return r.map(function(A){A.duration=i*(A.dis/n)}),r}}function jr(e){if(Zs(e[0]))return e;if(Zs(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Zs(e[0][0][0])){var i=e,t=0,n=0,r=0;return i.forEach(function(o){o.forEach(function(u){t+=u[0],n+=u[1],r++})}),[t/r,n/r,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function Cn(e){for(var i=e[0],t=e[1],n=e[0],r=e[1],o=0,u=0,l=0,p=0;p<e.length;p+=2){var v=e[p],x=e[p+1];v&&x&&(i=Math.max(v,i),t=Math.max(x,t),n=Math.min(v,n),r=Math.min(x,r),o+=v,u+=x,l++)}return{center:[o/l,u/l],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(t-r,2))/2}}function ni(e){return Hc(Wr([pr(e)]))}var ii=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=arguments.length>1?arguments[1]:void 0;(0,wt.Z)(this,e),this.limit=i,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}return(0,zt.Z)(e,[{key:"clear",value:function(){var t=this;this.order.forEach(function(n){t.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(t){var n=this.cache[t];return n&&(this.deleteOrder(t),this.appendOrder(t)),n}},{key:"set",value:function(t,n){this.cache[t]?(this.delete(t),this.cache[t]=n,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=n,this.appendOrder(t))}},{key:"delete",value:function(t){var n=this.cache[t];n&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(n,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var n=this.order.findIndex(function(r){return r===t});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,n){return null}}]),e}();function oi(e,i){e.forEach(function(t){!i[t]||(i[t]=i[t].bind(i))})}var ta=null,An=ee(2650);function Ci(e){return typeof e=="string"?!!d3.color(e):!1}function En(e){var i=An.ZP(e),t=[0,0,0,0];return i!=null&&(t[0]=i.r/255,t[1]=i.g/255,t[2]=i.b/255,t[3]=i.opacity),t}function li(e){var i=e&&e[0],t=e&&e[1],n=e&&e[2],r=i+t*256+n*65536-1;return r}function Jn(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Ti(e){var i=Xi.document.createElement("canvas"),t=i.getContext("2d");i.width=256,i.height=1;for(var n=null,r=t.createLinearGradient(0,0,256,1),o=e.positions[0],u=e.positions[e.positions.length-1],l=0;l<e.colors.length;++l){var p=(e.positions[l]-o)/(u-o);r.addColorStop(p,e.colors[l])}if(t.fillStyle=r,t.fillRect(0,0,256,1),jo)return n=new Uint8ClampedArray(t.getImageData(0,0,256,1).data),i=null,t=null,{data:n,width:256,height:1};n=t.getImageData(0,0,256,1).data;for(var v=t.createImageData(256,1),x=0;x<v.data.length;x+=4)v.data[x+0]=n[x+0],v.data[x+1]=n[x+1],v.data[x+2]=n[x+2],v.data[x+3]=n[x+3];return i=null,t=null,v}function di(e,i){var t=Xi.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var r=n.createLinearGradient(0,0,256,1),o=i[1]-i[0],u=0;u<e.colors.length;++u){var l=Math.max((e.positions[u]-i[0])/o,0);console.log(l),r.addColorStop(l,e.colors[u])}n.fillStyle=r,n.fillRect(0,0,256,1);var p=n.getImageData(0,0,256,1).data,v=Oo(n,p);return t=null,n=null,v}function fi(e){var i=Xi.document.createElement("canvas"),t=i.getContext("2d");i.width=256,i.height=1;var n=t.createImageData(256,1);return n.data.fill(0),e.positions.forEach(function(r,o){var u=En(e.colors[o]);n.data[r*4+0]=u[0]*255,n.data[r*4+1]=u[1]*255,n.data[r*4+2]=u[2]*255,n.data[r*4+3]=u[3]*255}),i=null,t=null,n}function Lo(e){var i=Xi.document.createElement("canvas"),t=i.getContext("2d");t.globalAlpha=1,i.width=256,i.height=1;for(var n=256/e.colors.length,r=0;r<e.colors.length;r++)t.beginPath(),t.lineWidth=2,t.strokeStyle=e.colors[r],t.moveTo(r*n,0),t.lineTo((r+1)*n,0),t.stroke();var o=t.getImageData(0,0,256,1).data,u=Oo(t,o);return i=null,t=null,u}function co(e,i){var t=Xi.document.createElement("canvas"),n=t.getContext("2d");n.globalAlpha=1,t.width=256,t.height=1;var r=i[1]-i[0];e.positions.length-e.colors.length!=1&&console.warn("positions \u7684\u6570\u5B57\u4E2A\u6570\u5E94\u5F53\u6BD4 colors \u7684\u6837\u5F0F\u591A\u4E00\u4E2A,poisitions \u7684\u9996\u5C3E\u503C\u4E00\u822C\u4E3A\u6570\u636E\u7684\u6700\u5927\u6700\u65B0\u503C");for(var o=0;o<e.colors.length;o++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[o],n.moveTo((e.positions[o]-i[0])/r*255,0),n.lineTo((e.positions[o+1]-i[0])/r*255,0),n.stroke();var u=n.getImageData(0,0,256,1).data,l=Oo(n,u);return t=null,n=null,l}function Oo(e,i){for(var t=e.createImageData(256,1),n=0;n<t.data.length;n+=4)t.data[n+0]=i[n+0],t.data[n+1]=i[n+1],t.data[n+2]=i[n+2],t.data[n+3]=i[n+3];return t}function Fo(e){switch(e.type){case"cat":return[0,255];default:}}var qa;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right"})(qa||(qa={}));var io={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ls(e,i,t){var n=e.classList;for(var r in io)io.hasOwnProperty(r)&&n.remove("l7-".concat(t,"-anchor-").concat(r));n.add("l7-".concat(t,"-anchor-").concat(i))}function Hi(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}var Wt=ee(92137),Ss=ee(87757),be=ee.n(Ss);function ws(e,i){if(!e)throw new Error(i||"web worker helper assertion failed.")}var yu={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},Ec=yu.self||yu.window||{},Ku=yu.window||yu.self||{},Sc=yu.self||yu.window||{},Wc=yu.document||{},Au=typeof importScripts=="function",Wl=typeof window!="undefined"&&typeof window.orientation!="undefined",Tu=function(){function e(i,t){var n=this;this.name=i,this.workerThread=t,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(r,o){n.resolve=r,n.reject=o})}return e.prototype.postMessage=function(i,t){this.workerThread.postMessage({source:"Main thread",type:i,payload:t})},e.prototype.done=function(i){ws(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(i)},e.prototype.error=function(i){ws(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(i)},e}(),Do=Tu,_u=new Map;function Qu(e){ws(e.source&&!e.url||!e.source&&e.url);var i=_u.get(e.source||e.url);return i||(e.url&&(i=Ju(e.url),_u.set(e.url,i)),e.source&&(i=pa(e.source),_u.set(e.source,i))),ws(i),i}function Ju(e){if(!e.startsWith("http"))return e;var i=Qs(e);return pa(i)}function pa(e){var i=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(i)}function Qs(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function as(e,i,t){i===void 0&&(i=!0);var n=t||new Set;if(e){if(Zu(e))n.add(e);else if(Zu(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(i&&typeof e=="object")for(var r in e)as(e[r],i,n)}}return t===void 0?Array.from(n):[]}function Zu(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var Xl=function(){},Xc=function(){function e(i){this.terminated=!1,this.loadableURL="";var t=i.name,n=i.source,r=i.url;ws(n||r),this.name=t,this.source=n,this.url=r,this.onMessage=Xl,this.onError=function(o){return console.log(o)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=Xl,this.onError=Xl,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(i,t){t=t||as(i),this.worker.postMessage(i,t)},e.prototype.getErrorFromErrorEvent=function(i){var t="Failed to load ";return t+="worker "+this.name+" from "+this.url+". ",i.message&&(t+=i.message+" in "),i.lineno&&(t+=":"+i.lineno+":"+i.colno),new Error(t)},e.prototype.createBrowserWorker=function(){var i=this;this.loadableURL=Qu({source:this.source,url:this.url});var t=new Worker(this.loadableURL,{name:this.name});return t.onmessage=function(n){n.data?i.onMessage(n.data):i.onError(new Error("No data received"))},t.onerror=function(n){i.onError(i.getErrorFromErrorEvent(n)),i.terminated=!0},t.onmessageerror=function(n){return console.error("worker "+i.name+", message error: "+n)},t},e}(),$c=Xc,Os=function(){return Os=Object.assign||function(e){for(var i,t=1,n=arguments.length;t<n;t++){i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},Os.apply(this,arguments)},$l=function(e,i,t,n){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(E){u(E)}}function p(x){try{v(n.throw(x))}catch(E){u(E)}}function v(x){x.done?o(x.value):r(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},cu=function(e,i){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=v[0]&2?r.return:v[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,v[1])).done)return o;switch(r=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,r=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){t.label=v[1];break}if(v[0]===6&&t.label<o[1]){t.label=o[1],o=v;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(v);break}o[2]&&t.ops.pop(),t.trys.pop();continue}v=i.call(e,t)}catch(x){v=[6,x],r=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},_l=function(){function e(i){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=i.source,this.url=i.url,this.setProps(i)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(i){return i.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(i){this.props=Os(Os({},this.props),i),i.name!==void 0&&(this.name=i.name),i.maxConcurrency!==void 0&&(this.maxConcurrency=i.maxConcurrency),i.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=i.maxMobileConcurrency),i.reuseWorkers!==void 0&&(this.reuseWorkers=i.reuseWorkers),i.onDebug!==void 0&&(this.onDebug=i.onDebug)},e.prototype.startJob=function(i,t,n){return t===void 0&&(t=function(r,o,u){return r.done(u)}),n===void 0&&(n=function(r,o){return r.error(o)}),$l(this,void 0,void 0,function(){var r,o=this;return cu(this,function(u){switch(u.label){case 0:return r=new Promise(function(l){return o.jobQueue.push({name:i,onMessage:t,onError:n,onStart:l}),o}),this.startQueuedJob(),[4,r];case 1:return[2,u.sent()]}})})},e.prototype.startQueuedJob=function(){return $l(this,void 0,void 0,function(){var i,t,n;return cu(this,function(r){switch(r.label){case 0:if(!this.jobQueue.length)return[2];if(i=this.getAvailableWorker(),!i)return[2];if(t=this.jobQueue.shift(),!t)return[3,4];this.onDebug({message:"Starting job",name:t.name,backlog:this.jobQueue.length,workerThread:i}),n=new Do(t.name,i),i.onMessage=function(o){return t.onMessage(n,o.type,o.payload)},i.onError=function(o){return t.onError(n,o)},t.onStart(n),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,n.result];case 2:return r.sent(),[3,4];case 3:return this.returnWorkerToQueue(i),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(i){var t=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();t?(i.destroy(),this.count--):this.idleQueue.push(i),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var i=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new $c({name:i,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return Wl?this.maxMobileConcurrency:this.maxConcurrency},e}(),Yc=_l,Us=function(){return Us=Object.assign||function(e){for(var i,t=1,n=arguments.length;t<n;t++){i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},Us.apply(this,arguments)},Go=function(e){var i=typeof Symbol=="function"&&Symbol.iterator,t=i&&e[i],n=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},qc={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},th=function(){function e(i){this.workerPools=new Map,this.props=Us({},qc),this.setProps(i),this.workerPools=new Map}return e.isSupported=function(){return $c.isSupported()},e.getWorkerFarm=function(i){return i===void 0&&(i={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(i),e.workerFarm},e.prototype.destroy=function(){var i,t;try{for(var n=Go(this.workerPools.values()),r=n.next();!r.done;r=n.next()){var o=r.value;o.destroy()}}catch(u){i={error:u}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(i)throw i.error}}},e.prototype.setProps=function(i){var t,n;this.props=Us(Us({},this.props),i);try{for(var r=Go(this.workerPools.values()),o=r.next();!o.done;o=r.next()){var u=o.value;u.setProps(this.getWorkerPoolProps())}}catch(l){t={error:l}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.getWorkerPool=function(i){var t=i.name,n=i.source,r=i.url,o=this.workerPools.get(t);return o||(o=new Yc({name:t,source:n,url:r}),o.setProps(this.getWorkerPoolProps()),this.workerPools.set(t,o)),o},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),Ah=th,Kc=new Map,ip=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(i){self.onmessage=function(t){if(!!Yl(t)){var n=t.data,r=n.type,o=n.payload;i(r,o)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(i){var t=Kc.get(i);t||(t=function(n){if(!!Yl(n)){var r=n.data,o=r.type,u=r.payload;i(o,u)}}),self.addEventListener("message",t)},e.removeEventListener=function(i){var t=Kc.get(i);Kc.delete(i),self.removeEventListener("message",t)},e.postMessage=function(i,t){if(self){var n={source:"Worker thread",type:i,payload:t},r=as(t);self.postMessage(n,r)}},e}(),el=ip;function Yl(e){var i=e.type,t=e.data;return i==="message"&&t&&typeof t.source=="string"&&t.source==="Main thread"}function rh(e){return JSON.parse(Th(e))}function Th(e){var i=new Set;return JSON.stringify(e,function(t,n){if(typeof n=="object"&&n!==null){if(i.has(n))try{return JSON.parse(JSON.stringify(n))}catch(r){return}i.add(n)}return n})}function Id(e){return""+e.name}function wc(e,i){i===void 0&&(i={});var t=i[e.id]||{},n=e.name+".worker.js",r=t.workerUrl;return i._workerType==="test"&&(r=e.module+"/dist/"+n),r||(r="https://unpkg.com/"+e.module+"/dist/"+n),assert(r),r}var Qc=function(e,i,t,n){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(E){u(E)}}function p(x){try{v(n.throw(x))}catch(E){u(E)}}function v(x){x.done?o(x.value):r(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},ap=function(e,i){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=v[0]&2?r.return:v[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,v[1])).done)return o;switch(r=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,r=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){t.label=v[1];break}if(v[0]===6&&t.label<o[1]){t.label=o[1],o=v;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(v);break}o[2]&&t.ops.pop(),t.trys.pop();continue}v=i.call(e,t)}catch(x){v=[6,x],r=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}};function zv(e,i){return WorkerFarm.isSupported()?e.worker&&(i==null?void 0:i.worker):!1}function nh(e,i,t,n){return t===void 0&&(t={}),n===void 0&&(n={}),Qc(this,void 0,void 0,function(){var r,o,u,l,p,v,x,E;return ap(this,function(A){switch(A.label){case 0:return r=getWorkerName(e),o=getWorkerURL(e,t),u=WorkerFarm.getWorkerFarm(t),l=u.getWorkerPool({name:r,url:o}),p=t.jobName||e.name,[4,l.startJob(p,op.bind(null,n))];case 1:return v=A.sent(),x=removeNontransferableOptions(t),v.postMessage("process",{input:i,options:x}),[4,v.result];case 2:return E=A.sent(),[2,E.result]}})})}function op(e,i,t,n){return Qc(this,void 0,void 0,function(){var r,o,u,l,p,v,x;return ap(this,function(E){switch(E.label){case 0:switch(r=t,r){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return i.done(n),[3,9];case 2:return i.error(new Error(n.error)),[3,9];case 3:o=n.id,u=n.input,l=n.options,E.label=4;case 4:return E.trys.push([4,6,,7]),e.process?[4,e.process(u,l)]:(i.postMessage("error",{id:o,error:"Worker not set up to process on main thread"}),[2]);case 5:return p=E.sent(),i.postMessage("done",{id:o,result:p}),[3,7];case 6:return v=E.sent(),x=v instanceof Error?v.message:"unknown error",i.postMessage("error",{id:o,error:x}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+t),E.label=9;case 9:return[2]}})})}var Pd=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(i){return this.enqueue(i)},e.prototype.enqueue=function(i){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.shift();i instanceof Error?t.reject(i):t.resolve({value:i})}else this._values.push(i)},e.prototype.close=function(){for(;this._settlers.length>0;){var i=this._settlers.shift();i.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var i=this;if(this._values.length>0){var t=this._values.shift();return t instanceof Error?Promise.reject(t):Promise.resolve({done:!1,value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,r){i._settlers.push({resolve:n,reject:r})})},e}(),Rd=Pd,Wp=function(e,i,t,n){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(E){u(E)}}function p(x){try{v(n.throw(x))}catch(E){u(E)}}function v(x){x.done?o(x.value):r(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},sp=function(e,i){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=v[0]&2?r.return:v[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,v[1])).done)return o;switch(r=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,r=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){t.label=v[1];break}if(v[0]===6&&t.label<o[1]){t.label=o[1],o=v;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(v);break}o[2]&&t.ops.pop(),t.trys.pop();continue}v=i.call(e,t)}catch(x){v=[6,x],r=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},Ld=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=e[Symbol.asyncIterator],t;return i?i.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=e[o]&&function(u){return new Promise(function(l,p){u=e[o](u),r(l,p,u.done,u.value)})}}function r(o,u,l,p){Promise.resolve(p).then(function(v){o({value:v,done:l})},u)}},kf=0,Mh,Bo;function kh(e,i){var t=this;if(typeof self!="undefined"){var n={process:Xp};el.onmessage=function(r,o){return Wp(t,void 0,void 0,function(){var u,l,p,v,x,E,A,T,L,F,z;return sp(this,function(H){switch(H.label){case 0:switch(H.trys.push([0,19,,20]),u=r,u){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(o.input,o.options||{},n)];case 2:return l=H.sent(),el.postMessage("done",{result:l}),[3,18];case 3:if(!i)throw new Error("Worker does not support batched processing");Mh=new Rd,Bo=o.options||{},p=i(Mh,Bo,n),H.label=4;case 4:H.trys.push([4,9,10,15]),v=Ld(p),H.label=5;case 5:return[4,v.next()];case 6:if(x=H.sent(),!!x.done)return[3,8];E=x.value,el.postMessage("output-batch",{result:E}),H.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return A=H.sent(),F={error:A},[3,15];case 10:return H.trys.push([10,,13,14]),x&&!x.done&&(z=v.return)?[4,z.call(v)]:[3,12];case 11:H.sent(),H.label=12;case 12:return[3,14];case 13:if(F)throw F.error;return[7];case 14:return[7];case 15:return el.postMessage("done",{}),[3,18];case 16:return Mh.push(o.input),[3,18];case 17:return Mh.close(),[3,18];case 18:return[3,20];case 19:return T=H.sent(),L=T instanceof Error?T.message:"",el.postMessage("error",{error:L}),[3,20];case 20:return[2]}})})}}}function Xp(e,i){return i===void 0&&(i={}),new Promise(function(t,n){var r=kf++,o=function(l,p){if(p.id===r)switch(l){case"done":el.removeEventListener(o),t(p.result);break;case"error":el.removeEventListener(o),n(p.error);break;default:}};el.addEventListener(o);var u={id:r,input:e,options:i};el.postMessage("process",u)})}var ih=function(e,i,t,n){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(E){u(E)}}function p(x){try{v(n.throw(x))}catch(E){u(E)}}function v(x){x.done?o(x.value):r(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})},ah=function(e,i){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=v[0]&2?r.return:v[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,v[1])).done)return o;switch(r=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,r=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){t.label=v[1];break}if(v[0]===6&&t.label<o[1]){t.label=o[1],o=v;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(v);break}o[2]&&t.ops.pop(),t.trys.pop();continue}v=i.call(e,t)}catch(x){v=[6,x],r=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},Jc={};function up(e,i,t){return i===void 0&&(i=null),t===void 0&&(t={}),ih(this,void 0,void 0,function(){return ah(this,function(n){switch(n.label){case 0:return i&&(e=oh(e,i,t)),Jc[e]=Jc[e]||Cc(e),[4,Jc[e]];case 1:return[2,n.sent()]}})})}function oh(e,i,t){if(e.startsWith("http"))return e;var n=t.modules||{};return n[e]?n[e]:t.CDN?(assert(t.CDN.startsWith("http")),t.CDN+"/"+i+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+i+"/src/libs/"+e}function Cc(e){return ih(this,void 0,void 0,function(){var i,t,n;return ah(this,function(r){switch(r.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return i=r.sent(),[4,i.arrayBuffer()];case 2:return[2,r.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return t=r.sent(),[4,t.text()];case 5:return n=r.sent(),[2,If(n,e)]}})})}function If(e,i){if(isWorker)return eval.call(global,e),null;var t=document.createElement("script");t.id=i;try{t.appendChild(document.createTextNode(e))}catch(n){t.text=e}return document.body.appendChild(t),null}var Ih="0.0.3",lp={id:"null",name:"null",module:"web-worker-helper",options:{}};function xl(e){var i=e.color;return!i||!i.length?[1,1,1,1]:i}function Pf(e,i,t){return t.length===2?[t[0],t[1],0]:[t[0],t[1],t[2]]}function ef(e){var i=e.filter;return i?[1]:[0]}function Rf(e,i){return[i]}var Lf=ee(9187),Vs=ee.n(Lf),W=ee(96156),Xr=ee(31437),Ac=Xr.create(),Ph=Xr.create(),No=Xr.create(),tl=Xr.create(),fu=Xr.create();function ql(e,i,t,n,r){Xr.add(e,t,n),Xr.normalize(e,e),i=Xr.fromValues(-e[1],e[0]);var o=Xr.fromValues(-t[1],t[0]);return[r/Xr.dot(i,o),i]}function Kl(e,i){return Xr.set(e,-i[1],i[0])}function Ql(e,i,t){return Xr.sub(e,i,t),Xr.normalize(e,e),e}function Rh(e,i){return e[0]===i[0]&&e[1]===i[1]}function Zv(e){for(var i=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(t,1),t++):i.set(n,n)}return e}var Od=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,wt.Z)(this,e),(0,W.Z)(this,"lastFlip",-1),(0,W.Z)(this,"miter",Xr.fromValues(0,0)),(0,W.Z)(this,"started",!1),(0,W.Z)(this,"dash",!1),(0,W.Z)(this,"totalDistance",0),(0,W.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,zt.Z)(e,[{key:"extrude_gaode2",value:function(t,n){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,l=1;l<o;l++){var p,v,x,E=t[l-1];E.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var A=n[l-1],T=t[l];T.push((v=n[l][2])!==null&&v!==void 0?v:0);var L=n[l],F=l<t.length-1?[].concat((0,cr.Z)(t[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,z=l<n.length-1?n[l+1]:null,H=this.segment_gaode2(r,u,E,T,F,A,L,z);u+=H}if(this.dash)for(var ne=0;ne<r.positions.length/6;ne++)r.positions[ne*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,n){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,l=1;l<o;l++){var p,v,x,E=t[l-1];E.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var A=n[l-1],T=t[l];T.push((v=n[l][2])!==null&&v!==void 0?v:0);var L=n[l],F=l<t.length-1?[].concat((0,cr.Z)(t[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,z=l<n.length-1?n[l+1]:null,H=this.simpleSegment(r,u,E,T,F,A,L,z);u+=H}if(this.dash)for(var ne=0;ne<r.positions.length/6;ne++)r.positions[ne*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=n.startIndex,u=1;u<r;u++){var l=t[u-1],p=t[u],v=u<t.length-1?t[u+1]:null,x=this.segment(n,o,l,p,v);o+=x}if(this.dash)for(var E=0;E<n.positions.length/6;E++)n.positions[E*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=n.startIndex,u=1;u<r;u++){var l=t[u-1],p=t[u],v=u<t.length-1?t[u+1]:null,x=this.simpleSegment(n,o,l,p,v);o+=x}if(this.dash)for(var E=0;E<n.positions.length/6;E++)n.positions[E*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(t,n,r,o,u,l,p,v){var x=0,E=t.indices,A=t.positions,T=t.normals,L=this.cap==="square",F=this.join==="bevel",z=Q([p[0],p[1]]),H=Q([l[0],l[1]]);Ql(No,o,r);var ne=0;if(this.dash&&(ne=this.lineSegmentDistance(z,H),this.totalDistance+=ne),this.normal||(this.normal=Xr.create(),Kl(this.normal,No)),!this.started)if(this.started=!0,L){var oe=Xr.create(),ke=Xr.create();Xr.add(oe,this.normal,No),Xr.add(ke,this.normal,No),T.push(ke[0],ke[1],0),T.push(oe[0],oe[1],0),A.push(r[0],r[1],r[2]|0,this.totalDistance-ne,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),A.push(r[0],r[1],r[2]|0,this.totalDistance-ne,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,T,r,this.normal,this.thickness,this.totalDistance-ne);if(E.push(n+0,n+1,n+2),u){Rh(o,u)&&Xr.add(u,o,Xr.normalize(u,Xr.subtract(u,o,r))),Ql(tl,u,o);var At=ql(fu,Xr.create(),No,tl,this.thickness),Nt=(0,$n.Z)(At,2),Gt=Nt[0],xr=Nt[1],dr=Xr.dot(fu,this.normal)<0?-1:1,zr=F;if(!zr&&this.join==="miter"){var bn=Gt;bn>this.miterLimit&&(zr=!0)}zr?(T.push(this.normal[0],this.normal[1],0),T.push(xr[0],xr[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*dr,o[2]|0),this.complex.indexes.push(this.currentIndex),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*dr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,E.push.apply(E,(0,cr.Z)(this.lastFlip!==-dr?[n,n+2,n+3]:[n+2,n+1,n+3])),E.push(n+2,n+3,n+4),Kl(Ac,tl),Xr.copy(this.normal,Ac),T.push(this.normal[0],this.normal[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*dr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x+=3):(this.extrusions(A,T,o,xr,Gt,this.totalDistance),E.push.apply(E,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),dr=-1,Xr.copy(this.normal,xr),x+=2),this.lastFlip=dr}else{if(Kl(this.normal,No),L){var De=Xr.create(),ft=Xr.create();Xr.sub(ft,No,this.normal),Xr.add(De,No,this.normal),T.push(ft[0],ft[1],0),T.push(De[0],De[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,T,o,this.normal,this.thickness,this.totalDistance);E.push.apply(E,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),x+=2}return x}},{key:"simpleSegment",value:function(t,n,r,o,u){var l=0,p=t.indices,v=t.positions,x=t.normals,E=Q([o[0],o[1]]),A=Q([r[0],r[1]]);Ql(No,E,A);var T=0;if(this.dash&&(T=this.lineSegmentDistance(E,A),this.totalDistance+=T),this.normal||(this.normal=Xr.create(),Kl(this.normal,No)),this.started||(this.started=!0,this.extrusions(v,x,r,this.normal,this.thickness,this.totalDistance-T)),p.push(n+0,n+1,n+2),!u)Kl(this.normal,No),this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance),p.push.apply(p,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var L=Q([u[0],u[1]]);Rh(E,L)&&Xr.add(L,E,Xr.normalize(L,Xr.subtract(L,E,A))),Ql(tl,L,E);var F=ql(fu,Xr.create(),No,tl,this.thickness),z=(0,$n.Z)(F,2),H=z[0],ne=z[1],oe=Xr.dot(fu,this.normal)<0?-1:1;this.extrusions(v,x,o,ne,H,this.totalDistance),p.push.apply(p,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),oe=-1,Xr.copy(this.normal,ne),l+=2,this.lastFlip=oe}return l}},{key:"segment",value:function(t,n,r,o,u){var l=0,p=t.indices,v=t.positions,x=t.normals,E=this.cap==="square",A=this.join==="bevel",T=Q([o[0],o[1]]),L=Q([r[0],r[1]]);Ql(No,T,L);var F=0;if(this.dash&&(F=this.lineSegmentDistance(T,L),this.totalDistance+=F),this.normal||(this.normal=Xr.create(),Kl(this.normal,No)),!this.started)if(this.started=!0,E){var z=Xr.create(),H=Xr.create();Xr.add(z,this.normal,No),Xr.add(H,this.normal,No),x.push(H[0],H[1],0),x.push(z[0],z[1],0),v.push(r[0],r[1],r[2]|0,this.totalDistance-F,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),v.push(r[0],r[1],r[2]|0,this.totalDistance-F,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,r,this.normal,this.thickness,this.totalDistance-F);if(p.push(n+0,n+1,n+2),u){var ke=Q([u[0],u[1]]);Rh(T,ke)&&Xr.add(ke,T,Xr.normalize(ke,Xr.subtract(ke,T,L))),Ql(tl,ke,T);var De=ql(fu,Xr.create(),No,tl,this.thickness),ft=(0,$n.Z)(De,2),At=ft[0],Nt=ft[1],Gt=Xr.dot(fu,this.normal)<0?-1:1,xr=A;if(!xr&&this.join==="miter"){var dr=At;dr>this.miterLimit&&(xr=!0)}xr?(x.push(this.normal[0],this.normal[1],0),x.push(Nt[0],Nt[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Gt,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Gt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p.push.apply(p,(0,cr.Z)(this.lastFlip!==-Gt?[n,n+2,n+3]:[n+2,n+1,n+3])),p.push(n+2,n+3,n+4),Kl(Ac,tl),Xr.copy(this.normal,Ac),x.push(this.normal[0],this.normal[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Gt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(v,x,o,Nt,At,this.totalDistance),p.push.apply(p,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Gt=-1,Xr.copy(this.normal,Nt),l+=2),this.lastFlip=Gt}else{if(Kl(this.normal,No),E){var ne=Xr.create(),oe=Xr.create();Xr.sub(oe,No,this.normal),Xr.add(ne,No,this.normal),x.push(oe[0],oe[1],0),x.push(ne[0],ne[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance);p.push.apply(p,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(t,n,r,o,u,l){n.push(o[0],o[1],0),n.push(o[0],o[1],0),t.push(r[0],r[1],r[2]|0,l,-u,r[2]|0),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],r[2]|0,l,u,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var r=n[0]-t[0],o=n[1]-t[1];return Math.sqrt(r*r+o*o)}}]),e}(),Js=85.0511287798;function Lh(e){var i=e.coordinates,t=e.originCoordinates,n=e.version,r=new Od({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=i;Array.isArray(o[0][0])||(o=[i]);var u=t;Array.isArray(u[0][0])||(u=[t]);for(var l=0;l<o.length;l++){var p=o[l],v=u[l];r.extrude_gaode2(p,v)}}else{var x=i;x[0]&&!Array.isArray(x[0][0])&&(x=[i]),x.forEach(function(A){r.extrude(A)})}var E=r.complex;return{vertices:E.positions,indices:E.indices,normals:E.normals,indexes:E.indexes,size:6}}function tf(e){var i=jr(e.coordinates);return{vertices:[].concat((0,cr.Z)(i),(0,cr.Z)(i),(0,cr.Z)(i),(0,cr.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function rf(e){var i=e.coordinates,t=Vs().flatten(i),n=t.vertices,r=t.dimensions,o=t.holes,u=Vs()(n,o,r);return{indices:u,vertices:n,size:r}}function bl(e,i){var t=i;return i>Js&&(t=Js),i<-Js&&(t=-Js),[Math.PI*e/180+Math.PI,Math.PI-Math.log(Math.tan(Math.PI*.25+Math.PI*t/180*.5))]}function Fd(e,i){return[(e-Math.PI)*180/Math.PI,(Math.atan(Math.exp(Math.PI-i))-Math.PI*.25)*2*180/Math.PI]}var Dd=function(){var e=(0,Wt.Z)(be().mark(function i(t){var n,r,o,u,l,p,v,x,E;return be().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return n=t.descriptors,r=t.features,o=t.enablePicking,u=t.iconMap,l={a_Color:xl,a_Position:Pf,filter:ef,a_vertexId:Rf,a_PickingColor:function(F){var z=F.id;return o?Jn(z):[0,0,0]},a_DistanceAndIndex:function(F,z,H,ne,oe,ke){return ke===void 0?[H[3],10]:[H[3],ke]},a_Total_Distance:function(F,z,H){return[H[5]]},a_Size:function(F){var z=F.size,H=z===void 0?1:z;return Array.isArray(H)?[H[0],H[1]]:[H,0]},a_Normal:function(F,z,H,ne,oe){return oe},a_Miter:function(F,z,H){return[H[4]]},a_iconMapUV:function(F){var z=F.texture,H=u[z]||{x:0,y:0},ne=H.x,oe=H.y;return[ne,oe]}},p={sizePerElement:0,elements:[]},v=0,x=[],E=3,r.forEach(function(L,F){var z=Lh(L),H=z.indices,ne=z.vertices,oe=z.normals,ke=z.size,De=z.indexes;H.forEach(function(Gt){x.push(Gt+v)}),E=ke;var ft=ne.length/ke;p.sizePerElement=E,p.elements.push({featureIdx:F,vertices:ne,normals:oe,offset:v}),v+=ft;for(var At=function(xr){var dr=(oe==null?void 0:oe.slice(xr*3,xr*3+3))||[],zr=ne.slice(xr*ke,xr*ke+ke),bn=0;De&&De[xr]!==void 0&&(bn=De[xr]),n.forEach(function(Wn){if(Wn&&l[Wn.name]){var oa;(oa=Wn.buffer.data).push.apply(oa,(0,cr.Z)(l[Wn.name](L,F,zr,xr,dr,bn)))}})},Nt=0;Nt<ft;Nt++)At(Nt)}),T.abrupt("return",{descriptors:n,featureLayout:p,indices:x});case 8:case"end":return T.stop()}},i)}));return function(t){return e.apply(this,arguments)}}(),El=function(){var e=(0,Wt.Z)(be().mark(function i(t){var n,r,o,u,l,p,v,x,E;return be().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return n=t.descriptors,r=t.features,o=t.enablePicking,u=t.shape2d,l={a_Color:xl,a_Position:Pf,filter:ef,a_vertexId:Rf,a_PickingColor:function(F){var z=F.id;return o?Jn(z):[0,0,0]},a_Shape:function(F){var z=F.shape,H=z===void 0?2:z,ne=u.indexOf(H);return[ne]},a_Extrude:function(F,z,H,ne){var oe=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],ke=ne%4*3;return[oe[ke],oe[ke+1],oe[ke+2]]},a_Size:function(F){var z=F.size,H=z===void 0?5:z;return Array.isArray(H)?[H[0]]:[H]}},p={sizePerElement:0,elements:[]},v=0,x=[],E=3,r.forEach(function(L,F){var z=tf(L),H=z.indices,ne=z.vertices,oe=z.normals,ke=z.size,De=z.indexes;H.forEach(function(Gt){x.push(Gt+v)}),E=ke;var ft=ne.length/ke;p.sizePerElement=E,p.elements.push({featureIdx:F,vertices:ne,normals:oe,offset:v}),v+=ft;for(var At=function(xr){var dr=(oe==null?void 0:oe.slice(xr*3,xr*3+3))||[],zr=ne.slice(xr*ke,xr*ke+ke),bn=0;De&&De[xr]!==void 0&&(bn=De[xr]),n.forEach(function(Wn){if(Wn&&l[Wn.name]){var oa;(oa=Wn.buffer.data).push.apply(oa,(0,cr.Z)(l[Wn.name](L,F,zr,xr,dr,bn)))}})},Nt=0;Nt<ft;Nt++)At(Nt)}),T.abrupt("return",{descriptors:n,featureLayout:p,indices:x});case 8:case"end":return T.stop()}},i)}));return function(t){return e.apply(this,arguments)}}(),Of=function(){var e=(0,Wt.Z)(be().mark(function i(t){var n,r,o,u,l,p,v,x;return be().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return n=t.descriptors,r=t.features,o=t.enablePicking,u={a_Color:xl,a_Position:Pf,filter:ef,a_vertexId:Rf,a_PickingColor:function(L){var F=L.id;return o?Jn(F):[0,0,0]}},l={sizePerElement:0,elements:[]},p=0,v=[],x=3,r.forEach(function(T,L){var F=rf(T),z=F.indices,H=F.vertices,ne=F.normals,oe=F.size,ke=F.indexes;z.forEach(function(Nt){v.push(Nt+p)}),x=oe;var De=H.length/oe;l.sizePerElement=x,l.elements.push({featureIdx:L,vertices:H,normals:ne,offset:p}),p+=De;for(var ft=function(Gt){var xr=(ne==null?void 0:ne.slice(Gt*3,Gt*3+3))||[],dr=H.slice(Gt*oe,Gt*oe+oe),zr=0;ke&&ke[Gt]!==void 0&&(zr=ke[Gt]),n.forEach(function(bn){if(bn&&u[bn.name]){var Wn;(Wn=bn.buffer.data).push.apply(Wn,(0,cr.Z)(u[bn.name](T,L,dr,Gt,xr,zr)))}})},At=0;At<De;At++)ft(At)}),A.abrupt("return",{descriptors:n,featureLayout:l,indices:v});case 8:case"end":return A.stop()}},i)}));return function(t){return e.apply(this,arguments)}}(),Tc={pointFill:El,line:Dd,polygonFill:Of},Jl=(0,mt.Z)({},Tc);function $p(e){return sh.apply(this,arguments)}function sh(){return sh=(0,Wt.Z)(be().mark(function e(i){var t,n;return be().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(t=i.workerType,n=i.data,!Jl[t]){o.next=3;break}return o.abrupt("return",Jl[t](n));case 3:return o.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(t,'" non-existent.'))));case 4:case"end":return o.stop()}},e)})),sh.apply(this,arguments)}kh($p);var uh=new Map;function cp(e,i){uh.set(e,i)}function Ta(e){var i=uh.get(e);return i}var Mc=`var L7=function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(){r=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),u=new T(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=f;var h={};function p(){}function v(){}function d(){}var y={};c(y,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(k([])));m&&m!==e&&n.call(m,a)&&(y=m);var x=d.prototype=p.prototype=Object.create(y);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var r;o(this,"_invoke",{value:function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,u){var s=l(t[o],t,i);if("throw"!==s.type){var c=s.arg,f=c.value;return f&&"object"==typeof f&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(f).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,u)}))}u(s.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}})}function E(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return I()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var u=A(a,r);if(u){if(u===h)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=l(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===h)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}function A(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,A(t,e),"throw"===e.method))return h;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var n=l(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,h;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,h):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,h)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function k(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:I}}function I(){return{value:void 0,done:!0}}return v.prototype=d,o(x,"constructor",{value:d,configurable:!0}),o(d,"constructor",{value:v,configurable:!0}),v.displayName=c(d,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,c(t,s,"GeneratorFunction")),t.prototype=Object.create(x),t},t.awrap=function(t){return{__await:t}},b(w.prototype),c(w.prototype,u,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(x),c(x,s,"Generator"),c(x,a,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=k,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),S(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},t}function n(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(o,i){var a=t.apply(e,r);function u(t){n(a,o,i,u,s,"next",t)}function s(t){n(a,o,i,u,s,"throw",t)}u(void 0)}))}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f(t);if(e){var o=f(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return p(this,r)}}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){if(t){if("string"==typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function b(t,e){return t(e={exports:{}},e.exports),e.exports}var w,E,A=function(t){return t&&t.Math==Math&&t},O=A("object"==typeof globalThis&&globalThis)||A("object"==typeof window&&window)||A("object"==typeof self&&self)||A("object"==typeof x&&x)||function(){return this}()||Function("return this")(),S=Object.defineProperty,T=function(t,e){try{S(O,t,{value:e,configurable:!0,writable:!0})}catch(r){O[t]=e}return e},k=O["__core-js_shared__"]||T("__core-js_shared__",{}),I=b((function(t){(t.exports=function(t,e){return k[t]||(k[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.26.1",mode:"global",copyright:"\xA9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.26.1/LICENSE",source:"https://github.com/zloirock/core-js"})})),j=function(t){try{return!!t()}catch(t){return!0}},P=!j((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),_=Function.prototype,M=_.call,L=P&&_.bind.bind(M,M),R=P?L:function(t){return function(){return M.apply(t,arguments)}},C=function(t){return null==t},N=TypeError,D=function(t){if(C(t))throw N("Can't call method on "+t);return t},F=Object,W=function(t){return F(D(t))},z=R({}.hasOwnProperty),B=Object.hasOwn||function(t,e){return z(W(t),e)},U=0,G=Math.random(),H=R(1..toString),V=function(t){return"Symbol("+(void 0===t?"":t)+")_"+H(++U+G,36)},q="object"==typeof document&&document.all,Z={all:q,IS_HTMLDDA:void 0===q&&void 0!==q},Y=Z.all,$=Z.IS_HTMLDDA?function(t){return"function"==typeof t||t===Y}:function(t){return"function"==typeof t},K=function(t){return $(t)?t:void 0},Q=function(t,e){return arguments.length<2?K(O[t]):O[t]&&O[t][e]},X=Q("navigator","userAgent")||"",J=O.process,tt=O.Deno,et=J&&J.versions||tt&&tt.version,rt=et&&et.v8;rt&&(E=(w=rt.split("."))[0]>0&&w[0]<4?1:+(w[0]+w[1])),!E&&X&&(!(w=X.match(/Edge\\/(\\d+)/))||w[1]>=74)&&(w=X.match(/Chrome\\/(\\d+)/))&&(E=+w[1]);var nt=E,ot=!!Object.getOwnPropertySymbols&&!j((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&nt&&nt<41})),it=ot&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,at=I("wks"),ut=O.Symbol,st=ut&&ut.for,ct=it?ut:ut&&ut.withoutSetter||V,ft=function(t){if(!B(at,t)||!ot&&"string"!=typeof at[t]){var e="Symbol."+t;ot&&B(ut,t)?at[t]=ut[t]:at[t]=it&&st?st(e):ct(e)}return at[t]},lt={};lt[ft("toStringTag")]="z";var ht="[object z]"===String(lt),pt=!j((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),vt=Z.all,dt=Z.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:$(t)||t===vt}:function(t){return"object"==typeof t?null!==t:$(t)},yt=O.document,gt=dt(yt)&&dt(yt.createElement),mt=function(t){return gt?yt.createElement(t):{}},xt=!pt&&!j((function(){return 7!=Object.defineProperty(mt("div"),"a",{get:function(){return 7}}).a})),bt=pt&&j((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),wt=String,Et=TypeError,At=function(t){if(dt(t))return t;throw Et(wt(t)+" is not an object")},Ot=Function.prototype.call,St=P?Ot.bind(Ot):function(){return Ot.apply(Ot,arguments)},Tt=R({}.isPrototypeOf),kt=Object,It=it?function(t){return"symbol"==typeof t}:function(t){var e=Q("Symbol");return $(e)&&Tt(e.prototype,kt(t))},jt=String,Pt=function(t){try{return jt(t)}catch(t){return"Object"}},_t=TypeError,Mt=function(t){if($(t))return t;throw _t(Pt(t)+" is not a function")},Lt=function(t,e){var r=t[e];return C(r)?void 0:Mt(r)},Rt=TypeError,Ct=TypeError,Nt=ft("toPrimitive"),Dt=function(t,e){if(!dt(t)||It(t))return t;var r,n=Lt(t,Nt);if(n){if(void 0===e&&(e="default"),r=St(n,t,e),!dt(r)||It(r))return r;throw Ct("Can't convert object to primitive value")}return void 0===e&&(e="number"),function(t,e){var r,n;if("string"===e&&$(r=t.toString)&&!dt(n=St(r,t)))return n;if($(r=t.valueOf)&&!dt(n=St(r,t)))return n;if("string"!==e&&$(r=t.toString)&&!dt(n=St(r,t)))return n;throw Rt("Can't convert object to primitive value")}(t,e)},Ft=function(t){var e=Dt(t,"string");return It(e)?e:e+""},Wt=TypeError,zt=Object.defineProperty,Bt=Object.getOwnPropertyDescriptor,Ut={f:pt?bt?function(t,e,r){if(At(t),e=Ft(e),At(r),"function"==typeof t&&"prototype"===e&&"value"in r&&"writable"in r&&!r.writable){var n=Bt(t,e);n&&n.writable&&(t[e]=r.value,r={configurable:"configurable"in r?r.configurable:n.configurable,enumerable:"enumerable"in r?r.enumerable:n.enumerable,writable:!1})}return zt(t,e,r)}:zt:function(t,e,r){if(At(t),e=Ft(e),At(r),xt)try{return zt(t,e,r)}catch(t){}if("get"in r||"set"in r)throw Wt("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},Gt=Function.prototype,Ht=pt&&Object.getOwnPropertyDescriptor,Vt=B(Gt,"name"),qt={EXISTS:Vt,PROPER:Vt&&"something"===function(){}.name,CONFIGURABLE:Vt&&(!pt||pt&&Ht(Gt,"name").configurable)},Zt=R(Function.toString);$(k.inspectSource)||(k.inspectSource=function(t){return Zt(t)});var Yt,$t,Kt,Qt=k.inspectSource,Xt=O.WeakMap,Jt=$(Xt)&&/native code/.test(String(Xt)),te=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},ee=pt?function(t,e,r){return Ut.f(t,e,te(1,r))}:function(t,e,r){return t[e]=r,t},re=I("keys"),ne=function(t){return re[t]||(re[t]=V(t))},oe={},ie=O.TypeError,ae=O.WeakMap;if(Jt||k.state){var ue=k.state||(k.state=new ae);ue.get=ue.get,ue.has=ue.has,ue.set=ue.set,Yt=function(t,e){if(ue.has(t))throw ie("Object already initialized");return e.facade=t,ue.set(t,e),e},$t=function(t){return ue.get(t)||{}},Kt=function(t){return ue.has(t)}}else{var se=ne("state");oe[se]=!0,Yt=function(t,e){if(B(t,se))throw ie("Object already initialized");return e.facade=t,ee(t,se,e),e},$t=function(t){return B(t,se)?t[se]:{}},Kt=function(t){return B(t,se)}}var ce={set:Yt,get:$t,has:Kt,enforce:function(t){return Kt(t)?$t(t):Yt(t,{})},getterFor:function(t){return function(e){var r;if(!dt(e)||(r=$t(e)).type!==t)throw ie("Incompatible receiver, "+t+" required");return r}}},fe=b((function(t){var e=qt.CONFIGURABLE,r=ce.enforce,n=ce.get,o=Object.defineProperty,i=pt&&!j((function(){return 8!==o((function(){}),"length",{value:8}).length})),a=String(String).split("String"),u=t.exports=function(t,n,u){"Symbol("===String(n).slice(0,7)&&(n="["+String(n).replace(/^Symbol\\(([^)]*)\\)/,"$1")+"]"),u&&u.getter&&(n="get "+n),u&&u.setter&&(n="set "+n),(!B(t,"name")||e&&t.name!==n)&&(pt?o(t,"name",{value:n,configurable:!0}):t.name=n),i&&u&&B(u,"arity")&&t.length!==u.arity&&o(t,"length",{value:u.arity});try{u&&B(u,"constructor")&&u.constructor?pt&&o(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var s=r(t);return B(s,"source")||(s.source=a.join("string"==typeof n?n:"")),t};Function.prototype.toString=u((function(){return $(this)&&n(this).source||Qt(this)}),"toString")})),le=function(t,e,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:e;if($(r)&&fe(r,i,n),n.global)o?t[e]=r:T(e,r);else{try{n.unsafe?t[e]&&(o=!0):delete t[e]}catch(t){}o?t[e]=r:Ut.f(t,e,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return t},he=R({}.toString),pe=R("".slice),ve=function(t){return pe(he(t),8,-1)},de=ft("toStringTag"),ye=Object,ge="Arguments"==ve(function(){return arguments}()),me=ht?ve:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=ye(t),de))?r:ge?ve(e):"Object"==(n=ve(e))&&$(e.callee)?"Arguments":n},xe=ht?{}.toString:function(){return"[object "+me(this)+"]"};ht||le(Object.prototype,"toString",xe,{unsafe:!0});var be={}.propertyIsEnumerable,we=Object.getOwnPropertyDescriptor,Ee={f:we&&!be.call({1:2},1)?function(t){var e=we(this,t);return!!e&&e.enumerable}:be},Ae=Object,Oe=R("".split),Se=j((function(){return!Ae("z").propertyIsEnumerable(0)}))?function(t){return"String"==ve(t)?Oe(t,""):Ae(t)}:Ae,Te=function(t){return Se(D(t))},ke=Object.getOwnPropertyDescriptor,Ie={f:pt?ke:function(t,e){if(t=Te(t),e=Ft(e),xt)try{return ke(t,e)}catch(t){}if(B(t,e))return te(!St(Ee.f,t,e),t[e])}},je=Math.ceil,Pe=Math.floor,_e=Math.trunc||function(t){var e=+t;return(e>0?Pe:je)(e)},Me=function(t){var e=+t;return e!=e||0===e?0:_e(e)},Le=Math.max,Re=Math.min,Ce=function(t,e){var r=Me(t);return r<0?Le(r+e,0):Re(r,e)},Ne=Math.min,De=function(t){return t>0?Ne(Me(t),9007199254740991):0},Fe=function(t){return De(t.length)},We=function(t){return function(e,r,n){var o,i=Te(e),a=Fe(i),u=Ce(n,a);if(t&&r!=r){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((t||u in i)&&i[u]===r)return t||u||0;return!t&&-1}},ze={includes:We(!0),indexOf:We(!1)},Be=ze.indexOf,Ue=R([].push),Ge=function(t,e){var r,n=Te(t),o=0,i=[];for(r in n)!B(oe,r)&&B(n,r)&&Ue(i,r);for(;e.length>o;)B(n,r=e[o++])&&(~Be(i,r)||Ue(i,r));return i},He=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ve=He.concat("length","prototype"),qe={f:Object.getOwnPropertyNames||function(t){return Ge(t,Ve)}},Ze={f:Object.getOwnPropertySymbols},Ye=R([].concat),$e=Q("Reflect","ownKeys")||function(t){var e=qe.f(At(t)),r=Ze.f;return r?Ye(e,r(t)):e},Ke=function(t,e,r){for(var n=$e(e),o=Ut.f,i=Ie.f,a=0;a<n.length;a++){var u=n[a];B(t,u)||r&&B(r,u)||o(t,u,i(e,u))}},Qe=/#|\\.prototype\\./,Xe=function(t,e){var r=tr[Je(t)];return r==rr||r!=er&&($(e)?j(e):!!e)},Je=Xe.normalize=function(t){return String(t).replace(Qe,".").toLowerCase()},tr=Xe.data={},er=Xe.NATIVE="N",rr=Xe.POLYFILL="P",nr=Xe,or=Ie.f,ir=function(t,e){var r,n,o,i,a,u=t.target,s=t.global,c=t.stat;if(r=s?O:c?O[u]||T(u,{}):(O[u]||{}).prototype)for(n in e){if(i=e[n],o=t.dontCallGetSet?(a=or(r,n))&&a.value:r[n],!nr(s?n:u+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;Ke(i,o)}(t.sham||o&&o.sham)&&ee(i,"sham",!0),le(r,n,i,t)}},ar="process"==ve(O.process),ur=String,sr=TypeError,cr=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=R(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),e=r instanceof Array}catch(t){}return function(r,n){return At(r),function(t){if("object"==typeof t||$(t))return t;throw sr("Can't set "+ur(t)+" as a prototype")}(n),e?t(r,n):r.__proto__=n,r}}():void 0),fr=Ut.f,lr=ft("toStringTag"),hr=function(t,e,r){t&&!r&&(t=t.prototype),t&&!B(t,lr)&&fr(t,lr,{configurable:!0,value:e})},pr=ft("species"),vr=function(t){var e=Q(t),r=Ut.f;pt&&e&&!e[pr]&&r(e,pr,{configurable:!0,get:function(){return this}})},dr=TypeError,yr=function(t,e){if(Tt(e,t))return t;throw dr("Incorrect invocation")},gr=function(){},mr=[],xr=Q("Reflect","construct"),br=/^\\s*(?:class|function)\\b/,wr=R(br.exec),Er=!br.exec(gr),Ar=function(t){if(!$(t))return!1;try{return xr(gr,mr,t),!0}catch(t){return!1}},Or=function(t){if(!$(t))return!1;switch(me(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Er||!!wr(br,Qt(t))}catch(t){return!0}};Or.sham=!0;var Sr,Tr,kr,Ir,jr=!xr||j((function(){var t;return Ar(Ar.call)||!Ar(Object)||!Ar((function(){t=!0}))||t}))?Or:Ar,Pr=TypeError,_r=function(t){if(jr(t))return t;throw Pr(Pt(t)+" is not a constructor")},Mr=ft("species"),Lr=function(t,e){var r,n=At(t).constructor;return void 0===n||C(r=At(n)[Mr])?e:_r(r)},Rr=Function.prototype,Cr=Rr.apply,Nr=Rr.call,Dr="object"==typeof Reflect&&Reflect.apply||(P?Nr.bind(Cr):function(){return Nr.apply(Cr,arguments)}),Fr=function(t){if("Function"===ve(t))return R(t)},Wr=Fr(Fr.bind),zr=function(t,e){return Mt(t),void 0===e?t:P?Wr(t,e):function(){return t.apply(e,arguments)}},Br=Q("document","documentElement"),Ur=R([].slice),Gr=TypeError,Hr=function(t,e){if(t<e)throw Gr("Not enough arguments");return t},Vr=/(?:ipad|iphone|ipod).*applewebkit/i.test(X),qr=O.setImmediate,Zr=O.clearImmediate,Yr=O.process,$r=O.Dispatch,Kr=O.Function,Qr=O.MessageChannel,Xr=O.String,Jr=0,tn={};try{Sr=O.location}catch(t){}var en=function(t){if(B(tn,t)){var e=tn[t];delete tn[t],e()}},rn=function(t){return function(){en(t)}},nn=function(t){en(t.data)},on=function(t){O.postMessage(Xr(t),Sr.protocol+"//"+Sr.host)};qr&&Zr||(qr=function(t){Hr(arguments.length,1);var e=$(t)?t:Kr(t),r=Ur(arguments,1);return tn[++Jr]=function(){Dr(e,void 0,r)},Tr(Jr),Jr},Zr=function(t){delete tn[t]},ar?Tr=function(t){Yr.nextTick(rn(t))}:$r&&$r.now?Tr=function(t){$r.now(rn(t))}:Qr&&!Vr?(Ir=(kr=new Qr).port2,kr.port1.onmessage=nn,Tr=zr(Ir.postMessage,Ir)):O.addEventListener&&$(O.postMessage)&&!O.importScripts&&Sr&&"file:"!==Sr.protocol&&!j(on)?(Tr=on,O.addEventListener("message",nn,!1)):Tr="onreadystatechange"in mt("script")?function(t){Br.appendChild(mt("script")).onreadystatechange=function(){Br.removeChild(this),en(t)}}:function(t){setTimeout(rn(t),0)});var an,un,sn,cn,fn,ln,hn,pn,vn={set:qr,clear:Zr},dn=/ipad|iphone|ipod/i.test(X)&&void 0!==O.Pebble,yn=/web0s(?!.*chrome)/i.test(X),gn=Ie.f,mn=vn.set,xn=O.MutationObserver||O.WebKitMutationObserver,bn=O.document,wn=O.process,En=O.Promise,An=gn(O,"queueMicrotask"),On=An&&An.value;On||(an=function(){var t,e;for(ar&&(t=wn.domain)&&t.exit();un;){e=un.fn,un=un.next;try{e()}catch(t){throw un?cn():sn=void 0,t}}sn=void 0,t&&t.enter()},Vr||ar||yn||!xn||!bn?!dn&&En&&En.resolve?((hn=En.resolve(void 0)).constructor=En,pn=zr(hn.then,hn),cn=function(){pn(an)}):ar?cn=function(){wn.nextTick(an)}:(mn=zr(mn,O),cn=function(){mn(an)}):(fn=!0,ln=bn.createTextNode(""),new xn(an).observe(ln,{characterData:!0}),cn=function(){ln.data=fn=!fn}));var Sn=On||function(t){var e={fn:t,next:void 0};sn&&(sn.next=e),un||(un=e,cn()),sn=e},Tn=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},kn=function(){this.head=null,this.tail=null};kn.prototype={add:function(t){var e={item:t,next:null};this.head?this.tail.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}};var In,jn,Pn,_n=kn,Mn=O.Promise,Ln="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Rn=!Ln&&!ar&&"object"==typeof window&&"object"==typeof document,Cn=(Mn&&Mn.prototype,ft("species")),Nn=!1,Dn=$(O.PromiseRejectionEvent),Fn={CONSTRUCTOR:nr("Promise",(function(){var t=Qt(Mn),e=t!==String(Mn);if(!e&&66===nt)return!0;if(!nt||nt<51||!/native code/.test(t)){var r=new Mn((function(t){t(1)})),n=function(t){t((function(){}),(function(){}))};if((r.constructor={})[Cn]=n,!(Nn=r.then((function(){}))instanceof n))return!0}return!e&&(Rn||Ln)&&!Dn})),REJECTION_EVENT:Dn,SUBCLASSING:Nn},Wn=TypeError,zn=function(t){var e,r;this.promise=new t((function(t,n){if(void 0!==e||void 0!==r)throw Wn("Bad Promise constructor");e=t,r=n})),this.resolve=Mt(e),this.reject=Mt(r)},Bn={f:function(t){return new zn(t)}},Un=vn.set,Gn=Fn.CONSTRUCTOR,Hn=Fn.REJECTION_EVENT,Vn=Fn.SUBCLASSING,qn=ce.getterFor("Promise"),Zn=ce.set,Yn=Mn&&Mn.prototype,$n=Mn,Kn=Yn,Qn=O.TypeError,Xn=O.document,Jn=O.process,to=Bn.f,eo=to,ro=!!(Xn&&Xn.createEvent&&O.dispatchEvent),no=function(t){var e;return!(!dt(t)||!$(e=t.then))&&e},oo=function(t,e){var r,n,o,i=e.value,a=1==e.state,u=a?t.ok:t.fail,s=t.resolve,c=t.reject,f=t.domain;try{u?(a||(2===e.rejection&&co(e),e.rejection=1),!0===u?r=i:(f&&f.enter(),r=u(i),f&&(f.exit(),o=!0)),r===t.promise?c(Qn("Promise-chain cycle")):(n=no(r))?St(n,r,s,c):s(r)):c(i)}catch(t){f&&!o&&f.exit(),c(t)}},io=function(t,e){t.notified||(t.notified=!0,Sn((function(){for(var r,n=t.reactions;r=n.get();)oo(r,t);t.notified=!1,e&&!t.rejection&&uo(t)})))},ao=function(t,e,r){var n,o;ro?((n=Xn.createEvent("Event")).promise=e,n.reason=r,n.initEvent(t,!1,!0),O.dispatchEvent(n)):n={promise:e,reason:r},!Hn&&(o=O["on"+t])?o(n):"unhandledrejection"===t&&function(t,e){var r=O.console;r&&r.error&&(1==arguments.length?r.error(t):r.error(t,e))}("Unhandled promise rejection",r)},uo=function(t){St(Un,O,(function(){var e,r=t.facade,n=t.value;if(so(t)&&(e=Tn((function(){ar?Jn.emit("unhandledRejection",n,r):ao("unhandledrejection",r,n)})),t.rejection=ar||so(t)?2:1,e.error))throw e.value}))},so=function(t){return 1!==t.rejection&&!t.parent},co=function(t){St(Un,O,(function(){var e=t.facade;ar?Jn.emit("rejectionHandled",e):ao("rejectionhandled",e,t.value)}))},fo=function(t,e,r){return function(n){t(e,n,r)}},lo=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,io(t,!0))},ho=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw Qn("Promise can't be resolved itself");var n=no(e);n?Sn((function(){var r={done:!1};try{St(n,e,fo(ho,r,t),fo(lo,r,t))}catch(e){lo(r,e,t)}})):(t.value=e,t.state=1,io(t,!1))}catch(e){lo({done:!1},e,t)}}};if(Gn&&(Kn=($n=function(t){yr(this,Kn),Mt(t),St(In,this);var e=qn(this);try{t(fo(ho,e),fo(lo,e))}catch(t){lo(e,t)}}).prototype,(In=function(t){Zn(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new _n,rejection:!1,state:0,value:void 0})}).prototype=le(Kn,"then",(function(t,e){var r=qn(this),n=to(Lr(this,$n));return r.parent=!0,n.ok=!$(t)||t,n.fail=$(e)&&e,n.domain=ar?Jn.domain:void 0,0==r.state?r.reactions.add(n):Sn((function(){oo(n,r)})),n.promise})),jn=function(){var t=new In,e=qn(t);this.promise=t,this.resolve=fo(ho,e),this.reject=fo(lo,e)},Bn.f=to=function(t){return t===$n||void 0===t?new jn(t):eo(t)},$(Mn)&&Yn!==Object.prototype)){Pn=Yn.then,Vn||le(Yn,"then",(function(t,e){var r=this;return new $n((function(t,e){St(Pn,r,t,e)})).then(t,e)}),{unsafe:!0});try{delete Yn.constructor}catch(t){}cr&&cr(Yn,Kn)}ir({global:!0,constructor:!0,wrap:!0,forced:Gn},{Promise:$n}),hr($n,"Promise",!1),vr("Promise");var po={},vo=ft("iterator"),yo=Array.prototype,go=function(t){return void 0!==t&&(po.Array===t||yo[vo]===t)},mo=ft("iterator"),xo=function(t){if(!C(t))return Lt(t,mo)||Lt(t,"@@iterator")||po[me(t)]},bo=TypeError,wo=function(t,e){var r=arguments.length<2?xo(t):e;if(Mt(r))return At(St(r,t));throw bo(Pt(t)+" is not iterable")},Eo=function(t,e,r){var n,o;At(t);try{if(!(n=Lt(t,"return"))){if("throw"===e)throw r;return r}n=St(n,t)}catch(t){o=!0,n=t}if("throw"===e)throw r;if(o)throw n;return At(n),r},Ao=TypeError,Oo=function(t,e){this.stopped=t,this.result=e},So=Oo.prototype,To=function(t,e,r){var n,o,i,a,u,s,c,f=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),v=!(!r||!r.INTERRUPTED),d=zr(e,f),y=function(t){return n&&Eo(n,"normal",t),new Oo(!0,t)},g=function(t){return l?(At(t),v?d(t[0],t[1],y):d(t[0],t[1])):v?d(t,y):d(t)};if(h)n=t.iterator;else if(p)n=t;else{if(!(o=xo(t)))throw Ao(Pt(t)+" is not iterable");if(go(o)){for(i=0,a=Fe(t);a>i;i++)if((u=g(t[i]))&&Tt(So,u))return u;return new Oo(!1)}n=wo(t,o)}for(s=h?t.next:n.next;!(c=St(s,n)).done;){try{u=g(c.value)}catch(t){Eo(n,"throw",t)}if("object"==typeof u&&u&&Tt(So,u))return u}return new Oo(!1)},ko=ft("iterator"),Io=!1;try{var jo=0,Po={next:function(){return{done:!!jo++}},return:function(){Io=!0}};Po[ko]=function(){return this},Array.from(Po,(function(){throw 2}))}catch(t){}var _o=function(t,e){if(!e&&!Io)return!1;var r=!1;try{var n={};n[ko]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r},Mo=Fn.CONSTRUCTOR||!_o((function(t){Mn.all(t).then(void 0,(function(){}))}));ir({target:"Promise",stat:!0,forced:Mo},{all:function(t){var e=this,r=Bn.f(e),n=r.resolve,o=r.reject,i=Tn((function(){var r=Mt(e.resolve),i=[],a=0,u=1;To(t,(function(t){var s=a++,c=!1;u++,St(r,e,t).then((function(t){c||(c=!0,i[s]=t,--u||n(i))}),o)})),--u||n(i)}));return i.error&&o(i.value),r.promise}});var Lo=Fn.CONSTRUCTOR,Ro=Mn&&Mn.prototype;if(ir({target:"Promise",proto:!0,forced:Lo,real:!0},{catch:function(t){return this.then(void 0,t)}}),$(Mn)){var Co=Q("Promise").prototype.catch;Ro.catch!==Co&&le(Ro,"catch",Co,{unsafe:!0})}ir({target:"Promise",stat:!0,forced:Mo},{race:function(t){var e=this,r=Bn.f(e),n=r.reject,o=Tn((function(){var o=Mt(e.resolve);To(t,(function(t){St(o,e,t).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}}),ir({target:"Promise",stat:!0,forced:Fn.CONSTRUCTOR},{reject:function(t){var e=Bn.f(this);return St(e.reject,void 0,t),e.promise}});var No=Fn.CONSTRUCTOR;Q("Promise");function Do(t,e){if(!t)throw new Error(e||"web worker helper assertion failed.")}ir({target:"Promise",stat:!0,forced:No},{resolve:function(t){return function(t,e){if(At(t),dt(e)&&e.constructor===t)return e;var r=Bn.f(t);return(0,r.resolve)(e),r.promise}(this,t)}});var Fo="undefined"!=typeof window&&void 0!==window.orientation,Wo=function(){function t(t,e){var r=this;this.name=t,this.workerThread=e,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(t,e){r.resolve=t,r.reject=e}))}return t.prototype.postMessage=function(t,e){this.workerThread.postMessage({source:"Main thread",type:t,payload:e})},t.prototype.done=function(t){Do(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(t)},t.prototype.error=function(t){Do(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(t)},t}(),zo=new Map;function Bo(t){Do(t.source&&!t.url||!t.source&&t.url);var e=zo.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return Uo((e=t,"try {\\n  importScripts('"+e+"');\\n} catch (error) {\\n  console.error(error);\\n  throw error;\\n}"));var e}(t.url),zo.set(t.url,e)),t.source&&(e=Uo(t.source),zo.set(t.source,e))),Do(e),e}function Uo(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Go(t,e,r){void 0===e&&(e=!0);var n=r||new Set;if(t){if(Ho(t))n.add(t);else if(Ho(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(var o in t)Go(t[o],e,n)}else;return void 0===r?Array.from(n):[]}function Ho(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}var Vo=function(){},qo=function(){function t(t){this.terminated=!1,this.loadableURL="";var e=t.name,r=t.source,n=t.url;Do(r||n),this.name=e,this.source=r,this.url=n,this.onMessage=Vo,this.onError=function(t){return console.log(t)},this.worker=this.createBrowserWorker()}return t.isSupported=function(){return"undefined"!=typeof Worker},t.prototype.destroy=function(){this.onMessage=Vo,this.onError=Vo,this.worker.terminate(),this.terminated=!0},Object.defineProperty(t.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),t.prototype.postMessage=function(t,e){e=e||Go(t),this.worker.postMessage(t,e)},t.prototype.getErrorFromErrorEvent=function(t){var e="Failed to load ";return e+="worker "+this.name+" from "+this.url+". ",t.message&&(e+=t.message+" in "),t.lineno&&(e+=":"+t.lineno+":"+t.colno),new Error(e)},t.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=Bo({source:this.source,url:this.url});var e=new Worker(this.loadableURL,{name:this.name});return e.onmessage=function(e){e.data?t.onMessage(e.data):t.onError(new Error("No data received"))},e.onerror=function(e){t.onError(t.getErrorFromErrorEvent(e)),t.terminated=!0},e.onmessageerror=function(e){return console.error("worker "+t.name+", message error: "+e)},e},t}(),Zo=self&&self.__assign||function(){return(Zo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Yo=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},$o=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Ko=function(){function t(t){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}return t.prototype.destroy=function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0},t.prototype.setProps=function(t){this.props=Zo(Zo({},this.props),t),void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)},t.prototype.startJob=function(t,e,r){return void 0===e&&(e=function(t,e,r){return t.done(r)}),void 0===r&&(r=function(t,e){return t.error(e)}),Yo(this,void 0,void 0,(function(){var n,o=this;return $o(this,(function(i){switch(i.label){case 0:return n=new Promise((function(n){return o.jobQueue.push({name:t,onMessage:e,onError:r,onStart:n}),o})),this.startQueuedJob(),[4,n];case 1:return[2,i.sent()]}}))}))},t.prototype.startQueuedJob=function(){return Yo(this,void 0,void 0,(function(){var t,e,r;return $o(this,(function(n){switch(n.label){case 0:if(!this.jobQueue.length)return[2];if(!(t=this.getAvailableWorker()))return[2];if(!(e=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:e.name,backlog:this.jobQueue.length,workerThread:t}),r=new Wo(e.name,t),t.onMessage=function(t){return e.onMessage(r,t.type,t.payload)},t.onError=function(t){return e.onError(r,t)},e.onStart(r),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,r.result];case 2:return n.sent(),[3,4];case 3:return this.returnWorkerToQueue(t),[7];case 4:return[2]}}))}))},t.prototype.returnWorkerToQueue=function(t){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this.startQueuedJob()},t.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var t=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new qo({name:t,source:this.source,url:this.url})}return null},t.prototype.getMaxConcurrency=function(){return Fo?this.maxMobileConcurrency:this.maxConcurrency},t}(),Qo=self&&self.__assign||function(){return(Qo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Xo=self&&self.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Jo={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},ti=(function(){function t(t){this.workerPools=new Map,this.props=Qo({},Jo),this.setProps(t),this.workerPools=new Map}t.isSupported=function(){return qo.isSupported()},t.getWorkerFarm=function(e){return void 0===e&&(e={}),t.workerFarm=t.workerFarm||new t({}),t.workerFarm.setProps(e),t.workerFarm},t.prototype.destroy=function(){var t,e;try{for(var r=Xo(this.workerPools.values()),n=r.next();!n.done;n=r.next()){n.value.destroy()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.setProps=function(t){var e,r;this.props=Qo(Qo({},this.props),t);try{for(var n=Xo(this.workerPools.values()),o=n.next();!o.done;o=n.next()){o.value.setProps(this.getWorkerPoolProps())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},t.prototype.getWorkerPool=function(t){var e=t.name,r=t.source,n=t.url,o=this.workerPools.get(e);return o||((o=new Ko({name:e,source:r,url:n})).setProps(this.getWorkerPoolProps()),this.workerPools.set(e,o)),o},t.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(),new Map),ei=function(){function t(){}return Object.defineProperty(t,"onmessage",{set:function(t){self.onmessage=function(e){if(ri(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}},enumerable:!1,configurable:!0}),t.addEventListener=function(t){var e=ti.get(t);e||(e=function(e){if(ri(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}),self.addEventListener("message",e)},t.removeEventListener=function(t){var e=ti.get(t);ti.delete(t),self.removeEventListener("message",e)},t.postMessage=function(t,e){if(self){var r={source:"Worker thread",type:t,payload:e},n=Go(e);self.postMessage(r,n)}},t}();function ri(t){var e=t.type,r=t.data;return"message"===e&&r&&"string"==typeof r.source&&"Main thread"===r.source}self&&self.__awaiter,self&&self.__generator;var ni,oi,ii=function(){function t(){this._values=[],this._settlers=[],this._closed=!1}return t.prototype[Symbol.asyncIterator]=function(){return this},t.prototype.push=function(t){return this.enqueue(t)},t.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var e=this._settlers.shift();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.push(t)},t.prototype.close=function(){for(;this._settlers.length>0;){this._settlers.shift().resolve({done:!0})}this._closed=!0},t.prototype.next=function(){var t=this;if(this._values.length>0){var e=this._values.shift();return e instanceof Error?Promise.reject(e):Promise.resolve({done:!1,value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(e,r){t._settlers.push({resolve:e,reject:r})}))},t}(),ai=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},ui=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},si=self&&self.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise((function(n,o){(function(t,e,r,n){Promise.resolve(n).then((function(e){t({value:e,done:r})}),e)})(n,o,(e=t[r](e)).done,e.value)}))}}},ci=0;function fi(t,e){var r=this;if("undefined"!=typeof self){var n={process:li};ei.onmessage=function(o,i){return ai(r,void 0,void 0,(function(){var r,a,u,s,c,f,l,h,p,v;return ui(this,(function(d){switch(d.label){case 0:switch(d.trys.push([0,19,,20]),o){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!t)throw new Error("Worker does not support atomic processing");return[4,t(i.input,i.options||{},n)];case 2:return r=d.sent(),ei.postMessage("done",{result:r}),[3,18];case 3:if(!e)throw new Error("Worker does not support batched processing");ni=new ii,oi=i.options||{},a=e(ni,oi,n),d.label=4;case 4:d.trys.push([4,9,10,15]),u=si(a),d.label=5;case 5:return[4,u.next()];case 6:if((s=d.sent()).done)return[3,8];c=s.value,ei.postMessage("output-batch",{result:c}),d.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return f=d.sent(),p={error:f},[3,15];case 10:return d.trys.push([10,,13,14]),s&&!s.done&&(v=u.return)?[4,v.call(u)]:[3,12];case 11:d.sent(),d.label=12;case 12:return[3,14];case 13:if(p)throw p.error;return[7];case 14:return[7];case 15:return ei.postMessage("done",{}),[3,18];case 16:return ni.push(i.input),[3,18];case 17:return ni.close(),[3,18];case 18:return[3,20];case 19:return l=d.sent(),h=l instanceof Error?l.message:"",ei.postMessage("error",{error:h}),[3,20];case 20:return[2]}}))}))}}}function li(t,e){return void 0===e&&(e={}),new Promise((function(r,n){var o=ci++,i=function(t,e){if(e.id===o)switch(t){case"done":ei.removeEventListener(i),r(e.result);break;case"error":ei.removeEventListener(i),n(e.error)}};ei.addEventListener(i);var a={id:o,input:t,options:e};ei.postMessage("process",a)}))}self&&self.__awaiter,self&&self.__generator;var hi={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},pi=mt("span").classList,vi=pi&&pi.constructor&&pi.constructor.prototype,di=vi===Object.prototype?void 0:vi,yi=Array.isArray||function(t){return"Array"==ve(t)},gi=ft("species"),mi=Array,xi=function(t,e){return new(function(t){var e;return yi(t)&&(e=t.constructor,(jr(e)&&(e===mi||yi(e.prototype))||dt(e)&&null===(e=e[gi]))&&(e=void 0)),void 0===e?mi:e}(t))(0===e?0:e)},bi=R([].push),wi=function(t){var e=1==t,r=2==t,n=3==t,o=4==t,i=6==t,a=7==t,u=5==t||i;return function(s,c,f,l){for(var h,p,v=W(s),d=Se(v),y=zr(c,f),g=Fe(d),m=0,x=l||xi,b=e?x(s,g):r||a?x(s,0):void 0;g>m;m++)if((u||m in d)&&(p=y(h=d[m],m,v),t))if(e)b[m]=p;else if(p)switch(t){case 3:return!0;case 5:return h;case 6:return m;case 2:bi(b,h)}else switch(t){case 4:return!1;case 7:bi(b,h)}return i?-1:n||o?o:b}},Ei={forEach:wi(0),map:wi(1),filter:wi(2),some:wi(3),every:wi(4),find:wi(5),findIndex:wi(6),filterReject:wi(7)},Ai=function(t,e){var r=[][t];return!!r&&j((function(){r.call(null,e||function(){return 1},1)}))},Oi=Ei.forEach,Si=Ai("forEach")?[].forEach:function(t){return Oi(this,t,arguments.length>1?arguments[1]:void 0)},Ti=function(t){if(t&&t.forEach!==Si)try{ee(t,"forEach",Si)}catch(e){t.forEach=Si}};for(var ki in hi)hi[ki]&&Ti(O[ki]&&O[ki].prototype);Ti(di);var Ii=function(t,e,r){var n=Ft(e);n in t?Ut.f(t,n,te(0,r)):t[n]=r},ji=ft("species"),Pi=function(t){return nt>=51||!j((function(){var e=[];return(e.constructor={})[ji]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},_i=Pi("slice"),Mi=ft("species"),Li=Array,Ri=Math.max;ir({target:"Array",proto:!0,forced:!_i},{slice:function(t,e){var r,n,o,i=Te(this),a=Fe(i),u=Ce(t,a),s=Ce(void 0===e?a:e,a);if(yi(i)&&(r=i.constructor,(jr(r)&&(r===Li||yi(r.prototype))||dt(r)&&null===(r=r[Mi]))&&(r=void 0),r===Li||void 0===r))return Ur(i,u,s);for(n=new(void 0===r?Li:r)(Ri(s-u,0)),o=0;u<s;u++,o++)u in i&&Ii(n,o,i[u]);return n.length=o,n}});var Ci=qt.EXISTS,Ni=Ut.f,Di=Function.prototype,Fi=R(Di.toString),Wi=/function\\b(?:\\s|\\/\\*[\\S\\s]*?\\*\\/|\\/\\/[^\\n\\r]*[\\n\\r]+)*([^\\s(/]*)/,zi=R(Wi.exec);pt&&!Ci&&Ni(Di,"name",{configurable:!0,get:function(){try{return zi(Wi,Fi(this))[1]}catch(t){return""}}});var Bi=Ei.map,Ui=Pi("map");ir({target:"Array",proto:!0,forced:!Ui},{map:function(t){return Bi(this,t,arguments.length>1?arguments[1]:void 0)}});var Gi,Hi=Object.keys||function(t){return Ge(t,He)},Vi={f:pt&&!bt?Object.defineProperties:function(t,e){At(t);for(var r,n=Te(e),o=Hi(e),i=o.length,a=0;i>a;)Ut.f(t,r=o[a++],n[r]);return t}},qi=ne("IE_PROTO"),Zi=function(){},Yi=function(t){return"<script>"+t+"<\\/script>"},$i=function(t){t.write(Yi("")),t.close();var e=t.parentWindow.Object;return t=null,e},Ki=function(){try{Gi=new ActiveXObject("htmlfile")}catch(t){}var t,e;Ki="undefined"!=typeof document?document.domain&&Gi?$i(Gi):((e=mt("iframe")).style.display="none",Br.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(Yi("document.F=Object")),t.close(),t.F):$i(Gi);for(var r=He.length;r--;)delete Ki.prototype[He[r]];return Ki()};oe[qi]=!0;var Qi=Object.create||function(t,e){var r;return null!==t?(Zi.prototype=At(t),r=new Zi,Zi.prototype=null,r[qi]=t):r=Ki(),void 0===e?r:Vi.f(r,e)},Xi=Ut.f,Ji=ft("unscopables"),ta=Array.prototype;null==ta[Ji]&&Xi(ta,Ji,{configurable:!0,value:Qi(null)});var ea,ra,na,oa=function(t){ta[Ji][t]=!0},ia=!j((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),aa=ne("IE_PROTO"),ua=Object,sa=ua.prototype,ca=ia?ua.getPrototypeOf:function(t){var e=W(t);if(B(e,aa))return e[aa];var r=e.constructor;return $(r)&&e instanceof r?r.prototype:e instanceof ua?sa:null},fa=ft("iterator"),la=!1;[].keys&&("next"in(na=[].keys())?(ra=ca(ca(na)))!==Object.prototype&&(ea=ra):la=!0),(!dt(ea)||j((function(){var t={};return ea[fa].call(t)!==t})))&&(ea={}),$(ea[fa])||le(ea,fa,(function(){return this}));var ha={IteratorPrototype:ea,BUGGY_SAFARI_ITERATORS:la},pa=ha.IteratorPrototype,va=function(){return this},da=qt.PROPER,ya=qt.CONFIGURABLE,ga=ha.IteratorPrototype,ma=ha.BUGGY_SAFARI_ITERATORS,xa=ft("iterator"),ba=function(){return this},wa=function(t,e,r,n,o,i,a){!function(t,e,r,n){var o=e+" Iterator";t.prototype=Qi(pa,{next:te(+!n,r)}),hr(t,o,!1),po[o]=va}(r,e,n);var u,s,c,f=function(t){if(t===o&&d)return d;if(!ma&&t in p)return p[t];switch(t){case"keys":case"values":case"entries":return function(){return new r(this,t)}}return function(){return new r(this)}},l=e+" Iterator",h=!1,p=t.prototype,v=p[xa]||p["@@iterator"]||o&&p[o],d=!ma&&v||f(o),y="Array"==e&&p.entries||v;if(y&&(u=ca(y.call(new t)))!==Object.prototype&&u.next&&(ca(u)!==ga&&(cr?cr(u,ga):$(u[xa])||le(u,xa,ba)),hr(u,l,!0)),da&&"values"==o&&v&&"values"!==v.name&&(ya?ee(p,"name","values"):(h=!0,d=function(){return St(v,this)})),o)if(s={values:f("values"),keys:i?d:f("keys"),entries:f("entries")},a)for(c in s)(ma||h||!(c in p))&&le(p,c,s[c]);else ir({target:e,proto:!0,forced:ma||h},s);return p[xa]!==d&&le(p,xa,d,{name:o}),po[e]=d,s},Ea=function(t,e){return{value:t,done:e}},Aa=Ut.f,Oa=ce.set,Sa=ce.getterFor("Array Iterator"),Ta=wa(Array,"Array",(function(t,e){Oa(this,{type:"Array Iterator",target:Te(t),index:0,kind:e})}),(function(){var t=Sa(this),e=t.target,r=t.kind,n=t.index++;return!e||n>=e.length?(t.target=void 0,Ea(void 0,!0)):Ea("keys"==r?n:"values"==r?e[n]:[n,e[n]],!1)}),"values"),ka=po.Arguments=po.Array;if(oa("keys"),oa("values"),oa("entries"),pt&&"values"!==ka.name)try{Aa(ka,"name",{value:"values"})}catch(t){}var Ia,ja,Pa,_a="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Ma=Ut.f,La=ce.enforce,Ra=ce.get,Ca=O.Int8Array,Na=Ca&&Ca.prototype,Da=O.Uint8ClampedArray,Fa=Da&&Da.prototype,Wa=Ca&&ca(Ca),za=Na&&ca(Na),Ba=Object.prototype,Ua=O.TypeError,Ga=ft("toStringTag"),Ha=V("TYPED_ARRAY_TAG"),Va=_a&&!!cr&&"Opera"!==me(O.opera),qa=!1,Za={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Ya={BigInt64Array:8,BigUint64Array:8},$a=function(t){var e=ca(t);if(dt(e)){var r=Ra(e);return r&&B(r,"TypedArrayConstructor")?r.TypedArrayConstructor:$a(e)}},Ka=function(t){if(!dt(t))return!1;var e=me(t);return B(Za,e)||B(Ya,e)};for(Ia in Za)(Pa=(ja=O[Ia])&&ja.prototype)?La(Pa).TypedArrayConstructor=ja:Va=!1;for(Ia in Ya)(Pa=(ja=O[Ia])&&ja.prototype)&&(La(Pa).TypedArrayConstructor=ja);if((!Va||!$(Wa)||Wa===Function.prototype)&&(Wa=function(){throw Ua("Incorrect invocation")},Va))for(Ia in Za)O[Ia]&&cr(O[Ia],Wa);if((!Va||!za||za===Ba)&&(za=Wa.prototype,Va))for(Ia in Za)O[Ia]&&cr(O[Ia].prototype,za);if(Va&&ca(Fa)!==za&&cr(Fa,za),pt&&!B(za,Ga))for(Ia in qa=!0,Ma(za,Ga,{get:function(){return dt(this)?this[Ha]:void 0}}),Za)O[Ia]&&ee(O[Ia],Ha,Ia);var Qa={NATIVE_ARRAY_BUFFER_VIEWS:Va,TYPED_ARRAY_TAG:qa&&Ha,aTypedArray:function(t){if(Ka(t))return t;throw Ua("Target is not a typed array")},aTypedArrayConstructor:function(t){if($(t)&&(!cr||Tt(Wa,t)))return t;throw Ua(Pt(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,r,n){if(pt){if(r)for(var o in Za){var i=O[o];if(i&&B(i.prototype,t))try{delete i.prototype[t]}catch(r){try{i.prototype[t]=e}catch(t){}}}za[t]&&!r||le(za,t,r?e:Va&&Na[t]||e,n)}},exportTypedArrayStaticMethod:function(t,e,r){var n,o;if(pt){if(cr){if(r)for(n in Za)if((o=O[n])&&B(o,t))try{delete o[t]}catch(t){}if(Wa[t]&&!r)return;try{return le(Wa,t,r?e:Va&&Wa[t]||e)}catch(t){}}for(n in Za)!(o=O[n])||o[t]&&!r||le(o,t,e)}},getTypedArrayConstructor:$a,isView:function(t){if(!dt(t))return!1;var e=me(t);return"DataView"===e||B(Za,e)||B(Ya,e)},isTypedArray:Ka,TypedArray:Wa,TypedArrayPrototype:za},Xa=Qa.NATIVE_ARRAY_BUFFER_VIEWS,Ja=O.ArrayBuffer,tu=O.Int8Array,eu=!Xa||!j((function(){tu(1)}))||!j((function(){new tu(-1)}))||!_o((function(t){new tu,new tu(null),new tu(1.5),new tu(t)}),!0)||j((function(){return 1!==new tu(new Ja(2),1,void 0).length})),ru=function(t,e,r){for(var n in e)le(t,n,e[n],r);return t},nu=RangeError,ou=function(t){if(void 0===t)return 0;var e=Me(t),r=De(e);if(e!==r)throw nu("Wrong length or index");return r},iu=Array,au=Math.abs,uu=Math.pow,su=Math.floor,cu=Math.log,fu=Math.LN2,lu=function(t,e,r){var n,o,i,a=iu(r),u=8*r-e-1,s=(1<<u)-1,c=s>>1,f=23===e?uu(2,-24)-uu(2,-77):0,l=t<0||0===t&&1/t<0?1:0,h=0;for((t=au(t))!=t||t===1/0?(o=t!=t?1:0,n=s):(n=su(cu(t)/fu),t*(i=uu(2,-n))<1&&(n--,i*=2),(t+=n+c>=1?f/i:f*uu(2,1-c))*i>=2&&(n++,i/=2),n+c>=s?(o=0,n=s):n+c>=1?(o=(t*i-1)*uu(2,e),n+=c):(o=t*uu(2,c-1)*uu(2,e),n=0));e>=8;)a[h++]=255&o,o/=256,e-=8;for(n=n<<e|o,u+=e;u>0;)a[h++]=255&n,n/=256,u-=8;return a[--h]|=128*l,a},hu=function(t,e){var r,n=t.length,o=8*n-e-1,i=(1<<o)-1,a=i>>1,u=o-7,s=n-1,c=t[s--],f=127&c;for(c>>=7;u>0;)f=256*f+t[s--],u-=8;for(r=f&(1<<-u)-1,f>>=-u,u+=e;u>0;)r=256*r+t[s--],u-=8;if(0===f)f=1-a;else{if(f===i)return r?NaN:c?-1/0:1/0;r+=uu(2,e),f-=a}return(c?-1:1)*r*uu(2,f-e)},pu=function(t){for(var e=W(this),r=Fe(e),n=arguments.length,o=Ce(n>1?arguments[1]:void 0,r),i=n>2?arguments[2]:void 0,a=void 0===i?r:Ce(i,r);a>o;)e[o++]=t;return e},vu=Array,du=Math.max,yu=function(t,e,r){for(var n=Fe(t),o=Ce(e,n),i=Ce(void 0===r?n:r,n),a=vu(du(i-o,0)),u=0;o<i;o++,u++)Ii(a,u,t[o]);return a.length=u,a},gu=qe.f,mu=Ut.f,xu=qt.PROPER,bu=qt.CONFIGURABLE,wu=ce.get,Eu=ce.set,Au=O.ArrayBuffer,Ou=Au,Su=Ou&&Ou.prototype,Tu=O.DataView,ku=Tu&&Tu.prototype,Iu=Object.prototype,ju=O.Array,Pu=O.RangeError,_u=R(pu),Mu=R([].reverse),Lu=lu,Ru=hu,Cu=function(t){return[255&t]},Nu=function(t){return[255&t,t>>8&255]},Du=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},Fu=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Wu=function(t){return Lu(t,23,4)},zu=function(t){return Lu(t,52,8)},Bu=function(t,e){mu(t.prototype,e,{get:function(){return wu(this)[e]}})},Uu=function(t,e,r,n){var o=ou(r),i=wu(t);if(o+e>i.byteLength)throw Pu("Wrong index");var a=wu(i.buffer).bytes,u=o+i.byteOffset,s=yu(a,u,u+e);return n?s:Mu(s)},Gu=function(t,e,r,n,o,i){var a=ou(r),u=wu(t);if(a+e>u.byteLength)throw Pu("Wrong index");for(var s=wu(u.buffer).bytes,c=a+u.byteOffset,f=n(+o),l=0;l<e;l++)s[c+l]=f[i?l:e-l-1]};if(_a){var Hu=xu&&"ArrayBuffer"!==Au.name;if(j((function(){Au(1)}))&&j((function(){new Au(-1)}))&&!j((function(){return new Au,new Au(1.5),new Au(NaN),1!=Au.length||Hu&&!bu})))Hu&&bu&&ee(Au,"name","ArrayBuffer");else{(Ou=function(t){return yr(this,Su),new Au(ou(t))}).prototype=Su;for(var Vu,qu=gu(Au),Zu=0;qu.length>Zu;)(Vu=qu[Zu++])in Ou||ee(Ou,Vu,Au[Vu]);Su.constructor=Ou}cr&&ca(ku)!==Iu&&cr(ku,Iu);var Yu=new Tu(new Ou(2)),$u=R(ku.setInt8);Yu.setInt8(0,2147483648),Yu.setInt8(1,2147483649),!Yu.getInt8(0)&&Yu.getInt8(1)||ru(ku,{setInt8:function(t,e){$u(this,t,e<<24>>24)},setUint8:function(t,e){$u(this,t,e<<24>>24)}},{unsafe:!0})}else Su=(Ou=function(t){yr(this,Su);var e=ou(t);Eu(this,{bytes:_u(ju(e),0),byteLength:e}),pt||(this.byteLength=e)}).prototype,ku=(Tu=function(t,e,r){yr(this,ku),yr(t,Su);var n=wu(t).byteLength,o=Me(e);if(o<0||o>n)throw Pu("Wrong offset");if(o+(r=void 0===r?n-o:De(r))>n)throw Pu("Wrong length");Eu(this,{buffer:t,byteLength:r,byteOffset:o}),pt||(this.buffer=t,this.byteLength=r,this.byteOffset=o)}).prototype,pt&&(Bu(Ou,"byteLength"),Bu(Tu,"buffer"),Bu(Tu,"byteLength"),Bu(Tu,"byteOffset")),ru(ku,{getInt8:function(t){return Uu(this,1,t)[0]<<24>>24},getUint8:function(t){return Uu(this,1,t)[0]},getInt16:function(t){var e=Uu(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Uu(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return Fu(Uu(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return Fu(Uu(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return Ru(Uu(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return Ru(Uu(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){Gu(this,1,t,Cu,e)},setUint8:function(t,e){Gu(this,1,t,Cu,e)},setInt16:function(t,e){Gu(this,2,t,Nu,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){Gu(this,2,t,Nu,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){Gu(this,4,t,Du,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){Gu(this,4,t,Du,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){Gu(this,4,t,Wu,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){Gu(this,8,t,zu,e,arguments.length>2?arguments[2]:void 0)}});hr(Ou,"ArrayBuffer"),hr(Tu,"DataView");var Ku={ArrayBuffer:Ou,DataView:Tu},Qu=Math.floor,Xu=Number.isInteger||function(t){return!dt(t)&&isFinite(t)&&Qu(t)===t},Ju=RangeError,ts=RangeError,es=function(t,e){var r=function(t){var e=Me(t);if(e<0)throw Ju("The argument can't be less than 0");return e}(t);if(r%e)throw ts("Wrong offset");return r},rs=R("".slice),ns=function(t){return"Big"===rs(me(t),0,3)},os=TypeError,is=function(t){var e=Dt(t,"number");if("number"==typeof e)throw os("Can't convert number to bigint");return BigInt(e)},as=Qa.aTypedArrayConstructor,us=function(t){var e,r,n,o,i,a,u,s,c=_r(this),f=W(t),l=arguments.length,h=l>1?arguments[1]:void 0,p=void 0!==h,v=xo(f);if(v&&!go(v))for(s=(u=wo(f,v)).next,f=[];!(a=St(s,u)).done;)f.push(a.value);for(p&&l>2&&(h=zr(h,arguments[2])),r=Fe(f),n=new(as(c))(r),o=ns(n),e=0;r>e;e++)i=p?h(f[e],e):f[e],n[e]=o?is(i):+i;return n},ss=function(t,e,r){var n,o;return cr&&$(n=e.constructor)&&n!==r&&dt(o=n.prototype)&&o!==r.prototype&&cr(t,o),t},cs=b((function(t){var e=qe.f,r=Ei.forEach,n=ce.get,o=ce.set,i=ce.enforce,a=Ut.f,u=Ie.f,s=Math.round,c=O.RangeError,f=Ku.ArrayBuffer,l=f.prototype,h=Ku.DataView,p=Qa.NATIVE_ARRAY_BUFFER_VIEWS,v=Qa.TYPED_ARRAY_TAG,d=Qa.TypedArray,y=Qa.TypedArrayPrototype,g=Qa.aTypedArrayConstructor,m=Qa.isTypedArray,x=function(t,e){g(t);for(var r=0,n=e.length,o=new t(n);n>r;)o[r]=e[r++];return o},b=function(t,e){a(t,e,{get:function(){return n(this)[e]}})},w=function(t){var e;return Tt(l,t)||"ArrayBuffer"==(e=me(t))||"SharedArrayBuffer"==e},E=function(t,e){return m(t)&&!It(e)&&e in t&&Xu(+e)&&e>=0},A=function(t,e){return e=Ft(e),E(t,e)?te(2,t[e]):u(t,e)},S=function(t,e,r){return e=Ft(e),!(E(t,e)&&dt(r)&&B(r,"value"))||B(r,"get")||B(r,"set")||r.configurable||B(r,"writable")&&!r.writable||B(r,"enumerable")&&!r.enumerable?a(t,e,r):(t[e]=r.value,t)};pt?(p||(Ie.f=A,Ut.f=S,b(y,"buffer"),b(y,"byteOffset"),b(y,"byteLength"),b(y,"length")),ir({target:"Object",stat:!0,forced:!p},{getOwnPropertyDescriptor:A,defineProperty:S}),t.exports=function(t,u,l){var g=t.match(/\\d+$/)[0]/8,b=t+(l?"Clamped":"")+"Array",E="get"+t,A="set"+t,S=O[b],T=S,k=T&&T.prototype,I={},j=function(t,e){a(t,e,{get:function(){return function(t,e){var r=n(t);return r.view[E](e*g+r.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,r){var o=n(t);l&&(r=(r=s(r))<0?0:r>255?255:255&r),o.view[A](e*g+o.byteOffset,r,!0)}(this,e,t)},enumerable:!0})};p?eu&&(T=u((function(t,e,r,n){return yr(t,k),ss(dt(e)?w(e)?void 0!==n?new S(e,es(r,g),n):void 0!==r?new S(e,es(r,g)):new S(e):m(e)?x(T,e):St(us,T,e):new S(ou(e)),t,T)})),cr&&cr(T,d),r(e(S),(function(t){t in T||ee(T,t,S[t])})),T.prototype=k):(T=u((function(t,e,r,n){yr(t,k);var i,a,u,s=0,l=0;if(dt(e)){if(!w(e))return m(e)?x(T,e):St(us,T,e);i=e,l=es(r,g);var p=e.byteLength;if(void 0===n){if(p%g)throw c("Wrong length");if((a=p-l)<0)throw c("Wrong length")}else if((a=De(n)*g)+l>p)throw c("Wrong length");u=a/g}else u=ou(e),i=new f(a=u*g);for(o(t,{buffer:i,byteOffset:l,byteLength:a,length:u,view:new h(i)});s<u;)j(t,s++)})),cr&&cr(T,d),k=T.prototype=Qi(y)),k.constructor!==T&&ee(k,"constructor",T),i(k).TypedArrayConstructor=T,v&&ee(k,v,b);var P=T!=S;I[b]=T,ir({global:!0,constructor:!0,forced:P,sham:!p},I),"BYTES_PER_ELEMENT"in T||ee(T,"BYTES_PER_ELEMENT",g),"BYTES_PER_ELEMENT"in k||ee(k,"BYTES_PER_ELEMENT",g),vr(b)}):t.exports=function(){}}));cs("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}),!0);var fs=TypeError,ls=function(t,e){if(!delete t[e])throw fs("Cannot delete property "+Pt(e)+" of "+Pt(t))},hs=Math.min,ps=R([].copyWithin||function(t,e){var r=W(this),n=Fe(r),o=Ce(t,n),i=Ce(e,n),a=arguments.length>2?arguments[2]:void 0,u=hs((void 0===a?n:Ce(a,n))-i,n-o),s=1;for(i<o&&o<i+u&&(s=-1,i+=u-1,o+=u-1);u-- >0;)i in r?r[o]=r[i]:ls(r,o),o+=s,i+=s;return r}),vs=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("copyWithin",(function(t,e){return ps(vs(this),t,e,arguments.length>2?arguments[2]:void 0)}));var ds=Ei.every,ys=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("every",(function(t){return ds(ys(this),t,arguments.length>1?arguments[1]:void 0)}));var gs=Qa.aTypedArray,ms=Qa.exportTypedArrayMethod,xs=R("".slice);ms("fill",(function(t){var e=arguments.length;gs(this);var r="Big"===xs(me(this),0,3)?is(t):+t;return St(pu,this,r,e>1?arguments[1]:void 0,e>2?arguments[2]:void 0)}),j((function(){var t=0;return new Int8Array(2).fill({valueOf:function(){return t++}}),1!==t})));var bs=Qa.aTypedArrayConstructor,ws=Qa.getTypedArrayConstructor,Es=function(t){return bs(Lr(t,ws(t)))},As=function(t,e){return function(t,e){for(var r=0,n=Fe(e),o=new t(n);n>r;)o[r]=e[r++];return o}(Es(t),e)},Os=Ei.filter,Ss=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("filter",(function(t){var e=Os(Ss(this),t,arguments.length>1?arguments[1]:void 0);return As(this,e)}));var Ts=Ei.find,ks=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("find",(function(t){return Ts(ks(this),t,arguments.length>1?arguments[1]:void 0)}));var Is=Ei.findIndex,js=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("findIndex",(function(t){return Is(js(this),t,arguments.length>1?arguments[1]:void 0)}));var Ps=Ei.forEach,_s=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("forEach",(function(t){Ps(_s(this),t,arguments.length>1?arguments[1]:void 0)}));var Ms=ze.includes,Ls=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("includes",(function(t){return Ms(Ls(this),t,arguments.length>1?arguments[1]:void 0)}));var Rs=ze.indexOf,Cs=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("indexOf",(function(t){return Rs(Cs(this),t,arguments.length>1?arguments[1]:void 0)}));var Ns=ft("iterator"),Ds=O.Uint8Array,Fs=R(Ta.values),Ws=R(Ta.keys),zs=R(Ta.entries),Bs=Qa.aTypedArray,Us=Qa.exportTypedArrayMethod,Gs=Ds&&Ds.prototype,Hs=!j((function(){Gs[Ns].call([1])})),Vs=!!Gs&&Gs.values&&Gs[Ns]===Gs.values&&"values"===Gs.values.name,qs=function(){return Fs(Bs(this))};Us("entries",(function(){return zs(Bs(this))}),Hs),Us("keys",(function(){return Ws(Bs(this))}),Hs),Us("values",qs,Hs||!Vs,{name:"values"}),Us(Ns,qs,Hs||!Vs,{name:"values"});var Zs=Qa.aTypedArray,Ys=Qa.exportTypedArrayMethod,$s=R([].join);Ys("join",(function(t){return $s(Zs(this),t)}));var Ks=Math.min,Qs=[].lastIndexOf,Xs=!!Qs&&1/[1].lastIndexOf(1,-0)<0,Js=Ai("lastIndexOf"),tc=Xs||!Js?function(t){if(Xs)return Dr(Qs,this,arguments)||0;var e=Te(this),r=Fe(e),n=r-1;for(arguments.length>1&&(n=Ks(n,Me(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}:Qs,ec=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("lastIndexOf",(function(t){var e=arguments.length;return Dr(tc,ec(this),e>1?[t,arguments[1]]:[t])}));var rc=Ei.map,nc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("map",(function(t){return rc(nc(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(Es(t))(e)}))}));var oc=TypeError,ic=function(t){return function(e,r,n,o){Mt(r);var i=W(e),a=Se(i),u=Fe(i),s=t?u-1:0,c=t?-1:1;if(n<2)for(;;){if(s in a){o=a[s],s+=c;break}if(s+=c,t?s<0:u<=s)throw oc("Reduce of empty array with no initial value")}for(;t?s>=0:u>s;s+=c)s in a&&(o=r(o,a[s],s,i));return o}},ac={left:ic(!1),right:ic(!0)},uc=ac.left,sc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("reduce",(function(t){var e=arguments.length;return uc(sc(this),t,e,e>1?arguments[1]:void 0)}));var cc=ac.right,fc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("reduceRight",(function(t){var e=arguments.length;return cc(fc(this),t,e,e>1?arguments[1]:void 0)}));var lc=Qa.aTypedArray,hc=Qa.exportTypedArrayMethod,pc=Math.floor;hc("reverse",(function(){for(var t,e=lc(this).length,r=pc(e/2),n=0;n<r;)t=this[n],this[n++]=this[--e],this[e]=t;return this}));var vc=O.RangeError,dc=O.Int8Array,yc=dc&&dc.prototype,gc=yc&&yc.set,mc=Qa.aTypedArray,xc=Qa.exportTypedArrayMethod,bc=!j((function(){var t=new Uint8ClampedArray(2);return St(gc,t,{length:1,0:3},1),3!==t[1]})),wc=bc&&Qa.NATIVE_ARRAY_BUFFER_VIEWS&&j((function(){var t=new dc(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));xc("set",(function(t){mc(this);var e=es(arguments.length>1?arguments[1]:void 0,1),r=W(t);if(bc)return St(gc,this,r,e);var n=this.length,o=Fe(r),i=0;if(o+e>n)throw vc("Wrong length");for(;i<o;)this[e+i]=r[i++]}),!bc||wc);var Ec=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("slice",(function(t,e){for(var r=Ur(Ec(this),t,e),n=Es(this),o=0,i=r.length,a=new n(i);i>o;)a[o]=r[o++];return a}),j((function(){new Int8Array(1).slice()})));var Ac=Ei.some,Oc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("some",(function(t){return Ac(Oc(this),t,arguments.length>1?arguments[1]:void 0)}));var Sc=Math.floor,Tc=function(t,e){var r=t.length,n=Sc(r/2);return r<8?kc(t,e):Ic(t,Tc(yu(t,0,n),e),Tc(yu(t,n),e),e)},kc=function(t,e){for(var r,n,o=t.length,i=1;i<o;){for(n=i,r=t[i];n&&e(t[n-1],r)>0;)t[n]=t[--n];n!==i++&&(t[n]=r)}return t},Ic=function(t,e,r,n){for(var o=e.length,i=r.length,a=0,u=0;a<o||u<i;)t[a+u]=a<o&&u<i?n(e[a],r[u])<=0?e[a++]:r[u++]:a<o?e[a++]:r[u++];return t},jc=Tc,Pc=X.match(/firefox\\/(\\d+)/i),_c=!!Pc&&+Pc[1],Mc=/MSIE|Trident/.test(X),Lc=X.match(/AppleWebKit\\/(\\d+)\\./),Rc=!!Lc&&+Lc[1],Cc=Qa.aTypedArray,Nc=Qa.exportTypedArrayMethod,Dc=O.Uint16Array,Fc=Dc&&Fr(Dc.prototype.sort),Wc=!(!Fc||j((function(){Fc(new Dc(2),null)}))&&j((function(){Fc(new Dc(2),{})}))),zc=!!Fc&&!j((function(){if(nt)return nt<74;if(_c)return _c<67;if(Mc)return!0;if(Rc)return Rc<602;var t,e,r=new Dc(516),n=Array(516);for(t=0;t<516;t++)e=t%4,r[t]=515-t,n[t]=t-2*e+3;for(Fc(r,(function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(r[t]!==n[t])return!0}));Nc("sort",(function(t){return void 0!==t&&Mt(t),zc?Fc(this,t):jc(Cc(this),function(t){return function(e,r){return void 0!==t?+t(e,r)||0:r!=r?-1:e!=e?1:0===e&&0===r?1/e>0&&1/r<0?1:-1:e>r}}(t))}),!zc||Wc);var Bc=Qa.aTypedArray;(0,Qa.exportTypedArrayMethod)("subarray",(function(t,e){var r=Bc(this),n=r.length,o=Ce(t,n);return new(Es(r))(r.buffer,r.byteOffset+o*r.BYTES_PER_ELEMENT,De((void 0===e?n:Ce(e,n))-o))}));var Uc=O.Int8Array,Gc=Qa.aTypedArray,Hc=Qa.exportTypedArrayMethod,Vc=[].toLocaleString,qc=!!Uc&&j((function(){Vc.call(new Uc(1))}));Hc("toLocaleString",(function(){return Dr(Vc,qc?Ur(Gc(this)):Gc(this),Ur(arguments))}),j((function(){return[1,2].toLocaleString()!=new Uc([1,2]).toLocaleString()}))||!j((function(){Uc.prototype.toLocaleString.call([1,2])})));var Zc=Qa.exportTypedArrayMethod,Yc=O.Uint8Array,$c=Yc&&Yc.prototype||{},Kc=[].toString,Qc=R([].join);j((function(){Kc.call({})}))&&(Kc=function(){return Qc(this)});var Xc=$c.toString!=Kc;Zc("toString",Kc,Xc);var Jc,tf,ef=String,rf=function(t){if("Symbol"===me(t))throw TypeError("Cannot convert a Symbol value to a string");return ef(t)},nf=function(){var t=At(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},of=O.RegExp,af=j((function(){var t=of("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),uf=af||j((function(){return!of("a","y").sticky})),sf={BROKEN_CARET:af||j((function(){var t=of("^r","gy");return t.lastIndex=2,null!=t.exec("str")})),MISSED_STICKY:uf,UNSUPPORTED_Y:af},cf=O.RegExp,ff=j((function(){var t=cf(".","s");return!(t.dotAll&&t.exec("\\n")&&"s"===t.flags)})),lf=O.RegExp,hf=j((function(){var t=lf("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),pf=ce.get,vf=I("native-string-replace",String.prototype.replace),df=RegExp.prototype.exec,yf=df,gf=R("".charAt),mf=R("".indexOf),xf=R("".replace),bf=R("".slice),wf=(tf=/b*/g,St(df,Jc=/a/,"a"),St(df,tf,"a"),0!==Jc.lastIndex||0!==tf.lastIndex),Ef=sf.BROKEN_CARET,Af=void 0!==/()??/.exec("")[1];(wf||Af||Ef||ff||hf)&&(yf=function(t){var e,r,n,o,i,a,u,s=this,c=pf(s),f=rf(t),l=c.raw;if(l)return l.lastIndex=s.lastIndex,e=St(yf,l,f),s.lastIndex=l.lastIndex,e;var h=c.groups,p=Ef&&s.sticky,v=St(nf,s),d=s.source,y=0,g=f;if(p&&(v=xf(v,"y",""),-1===mf(v,"g")&&(v+="g"),g=bf(f,s.lastIndex),s.lastIndex>0&&(!s.multiline||s.multiline&&"\\n"!==gf(f,s.lastIndex-1))&&(d="(?: "+d+")",g=" "+g,y++),r=new RegExp("^(?:"+d+")",v)),Af&&(r=new RegExp("^"+d+"$(?!\\\\s)",v)),wf&&(n=s.lastIndex),o=St(df,p?r:s,g),p?o?(o.input=bf(o.input,y),o[0]=bf(o[0],y),o.index=s.lastIndex,s.lastIndex+=o[0].length):s.lastIndex=0:wf&&o&&(s.lastIndex=s.global?o.index+o[0].length:n),Af&&o&&o.length>1&&St(vf,o[0],r,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(o[i]=void 0)})),o&&h)for(o.groups=a=Qi(null),i=0;i<h.length;i++)a[(u=h[i])[0]]=o[u[1]];return o});var Of=yf;ir({target:"RegExp",proto:!0,forced:/./.exec!==Of},{exec:Of});var Sf,Tf=ft("species"),kf=RegExp.prototype,If=function(t,e,r,n){var o=ft(t),i=!j((function(){var e={};return e[o]=function(){return 7},7!=""[t](e)})),a=i&&!j((function(){var e=!1,r=/a/;return"split"===t&&((r={}).constructor={},r.constructor[Tf]=function(){return r},r.flags="",r[o]=/./[o]),r.exec=function(){return e=!0,null},r[o](""),!e}));if(!i||!a||r){var u=Fr(/./[o]),s=e(o,""[t],(function(t,e,r,n,o){var a=Fr(t),s=e.exec;return s===Of||s===kf.exec?i&&!o?{done:!0,value:u(e,r,n)}:{done:!0,value:a(r,e,n)}:{done:!1}}));le(String.prototype,t,s[0]),le(kf,o,s[1])}n&&ee(kf[o],"sham",!0)},jf=R("".charAt),Pf=R("".charCodeAt),_f=R("".slice),Mf=function(t){return function(e,r){var n,o,i=rf(D(e)),a=Me(r),u=i.length;return a<0||a>=u?t?"":void 0:(n=Pf(i,a))<55296||n>56319||a+1===u||(o=Pf(i,a+1))<56320||o>57343?t?jf(i,a):n:t?_f(i,a,a+2):o-56320+(n-55296<<10)+65536}},Lf={codeAt:Mf(!1),charAt:Mf(!0)},Rf=Lf.charAt,Cf=function(t,e,r){return e+(r?Rf(t,e).length:1)},Nf=Math.floor,Df=R("".charAt),Ff=R("".replace),Wf=R("".slice),zf=/\\$([$&'\`]|\\d{1,2}|<[^>]*>)/g,Bf=/\\$([$&'\`]|\\d{1,2})/g,Uf=function(t,e,r,n,o,i){var a=r+t.length,u=n.length,s=Bf;return void 0!==o&&(o=W(o),s=zf),Ff(i,s,(function(i,s){var c;switch(Df(s,0)){case"$":return"$";case"&":return t;case"\`":return Wf(e,0,r);case"'":return Wf(e,a);case"<":c=o[Wf(s,1,-1)];break;default:var f=+s;if(0===f)return i;if(f>u){var l=Nf(f/10);return 0===l?i:l<=u?void 0===n[l-1]?Df(s,1):n[l-1]+Df(s,1):i}c=n[f-1]}return void 0===c?"":c}))},Gf=TypeError,Hf=function(t,e){var r=t.exec;if($(r)){var n=St(r,t,e);return null!==n&&At(n),n}if("RegExp"===ve(t))return St(Of,t,e);throw Gf("RegExp#exec called on incompatible receiver")},Vf=ft("replace"),qf=Math.max,Zf=Math.min,Yf=R([].concat),$f=R([].push),Kf=R("".indexOf),Qf=R("".slice),Xf="$0"==="a".replace(/./,"$0"),Jf=!!/./[Vf]&&""===/./[Vf]("a","$0");function tl(t){this.message=t}If("replace",(function(t,e,r){var n=Jf?"$":"$0";return[function(t,r){var n=D(this),o=C(t)?void 0:Lt(t,Vf);return o?St(o,t,n,r):St(e,rf(n),t,r)},function(t,o){var i=At(this),a=rf(t);if("string"==typeof o&&-1===Kf(o,n)&&-1===Kf(o,"$<")){var u=r(e,i,a,o);if(u.done)return u.value}var s=$(o);s||(o=rf(o));var c=i.global;if(c){var f=i.unicode;i.lastIndex=0}for(var l=[];;){var h=Hf(i,a);if(null===h)break;if($f(l,h),!c)break;""===rf(h[0])&&(i.lastIndex=Cf(a,De(i.lastIndex),f))}for(var p,v="",d=0,y=0;y<l.length;y++){for(var g=rf((h=l[y])[0]),m=qf(Zf(Me(h.index),a.length),0),x=[],b=1;b<h.length;b++)$f(x,void 0===(p=h[b])?p:String(p));var w=h.groups;if(s){var E=Yf([g],x,m,a);void 0!==w&&$f(E,w);var A=rf(Dr(o,void 0,E))}else A=Uf(g,a,m,x,w,o);m>=d&&(v+=Qf(a,d,m)+A,d=m+g.length)}return v+Qf(a,d)}]}),!!j((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!Xf||Jf),tl.prototype=new Error,tl.prototype.name="InvalidCharacterError",ir({global:!0,forced:O.globalThis!==O},{globalThis:O}),Sf="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,r){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,e){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:Sf.devicePixelRatio;var el=TypeError,rl=Object.getOwnPropertyDescriptor,nl=pt&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,e){if(yi(t)&&!rl(t,"length").writable)throw el("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e},ol=TypeError,il=function(t){if(t>9007199254740991)throw ol("Maximum allowed index exceeded");return t},al=Pi("splice"),ul=Math.max,sl=Math.min;ir({target:"Array",proto:!0,forced:!al},{splice:function(t,e){var r,n,o,i,a,u,s=W(this),c=Fe(s),f=Ce(t,c),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=c-f):(r=l-2,n=sl(ul(Me(e),0),c-f)),il(c+r-n),o=xi(s,n),i=0;i<n;i++)(a=f+i)in s&&Ii(o,i,s[a]);if(o.length=n,r<n){for(i=f;i<c-n;i++)u=i+r,(a=i+n)in s?s[u]=s[a]:ls(s,u);for(i=c;i>c-n+r;i--)ls(s,i-1)}else if(r>n)for(i=c-n;i>f;i--)u=i+r-1,(a=i+n-1)in s?s[u]=s[a]:ls(s,u);for(i=0;i<r;i++)s[i+f]=arguments[i+2];return nl(s,c-n+r),o}});var cl=u((function t(e,r){i(this,t),s(this,"cancelBubble",void 0),s(this,"cancelable",void 0),s(this,"target",void 0),s(this,"currentTarget",void 0),s(this,"preventDefault",void 0),s(this,"stopPropagation",void 0),s(this,"type",void 0),s(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=e,this.timeStamp=Date.now()})),fl=Object.assign,ll=Object.defineProperty,hl=R([].concat),pl=!fl||j((function(){if(pt&&1!==fl({b:1},fl(ll({},"a",{enumerable:!0,get:function(){ll(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},r=Symbol();return t[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=fl({},t)[r]||"abcdefghijklmnopqrst"!=Hi(fl({},e)).join("")}))?function(t,e){for(var r=W(t),n=arguments.length,o=1,i=Ze.f,a=Ee.f;n>o;)for(var u,s=Se(arguments[o++]),c=i?hl(Hi(s),i(s)):Hi(s),f=c.length,l=0;f>l;)u=c[l++],pt&&!St(a,s,u)||(r[u]=s[u]);return r}:fl;ir({target:"Object",stat:!0,arity:2,forced:Object.assign!==pl},{assign:pl});var vl=Ei.findIndex,dl=!0;"findIndex"in[]&&Array(1).findIndex((function(){dl=!1})),ir({target:"Array",proto:!0,forced:dl},{findIndex:function(t){return vl(this,t,arguments.length>1?arguments[1]:void 0)}}),oa("findIndex");var yl=Lf.charAt,gl=ce.set,ml=ce.getterFor("String Iterator");wa(String,"String",(function(t){gl(this,{type:"String Iterator",string:rf(t),index:0})}),(function(){var t,e=ml(this),r=e.string,n=e.index;return n>=r.length?Ea(void 0,!0):(t=yl(r,n),e.index+=t.length,Ea(t,!1))}));var xl=qe.f,bl="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],wl={f:function(t){return bl&&"Window"==ve(t)?function(t){try{return xl(t)}catch(t){return yu(bl)}}(t):xl(Te(t))}},El=j((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),Al=Object.isExtensible,Ol=j((function(){Al(1)}))||El?function(t){return!!dt(t)&&((!El||"ArrayBuffer"!=ve(t))&&(!Al||Al(t)))}:Al,Sl=!j((function(){return Object.isExtensible(Object.preventExtensions({}))})),Tl=b((function(t){var e=Ut.f,r=!1,n=V("meta"),o=0,i=function(t){e(t,n,{value:{objectID:"O"+o++,weakData:{}}})},a=t.exports={enable:function(){a.enable=function(){},r=!0;var t=qe.f,e=R([].splice),o={};o[n]=1,t(o).length&&(qe.f=function(r){for(var o=t(r),i=0,a=o.length;i<a;i++)if(o[i]===n){e(o,i,1);break}return o},ir({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:wl.f}))},fastKey:function(t,e){if(!dt(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!B(t,n)){if(!Ol(t))return"F";if(!e)return"E";i(t)}return t[n].objectID},getWeakData:function(t,e){if(!B(t,n)){if(!Ol(t))return!0;if(!e)return!1;i(t)}return t[n].weakData},onFreeze:function(t){return Sl&&r&&Ol(t)&&!B(t,n)&&i(t),t}};oe[n]=!0})),kl=(Tl.enable,Tl.fastKey,Tl.getWeakData,Tl.onFreeze,function(t,e,r){var n=-1!==t.indexOf("Map"),o=-1!==t.indexOf("Weak"),i=n?"set":"add",a=O[t],u=a&&a.prototype,s=a,c={},f=function(t){var e=R(u[t]);le(u,t,"add"==t?function(t){return e(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!dt(t))&&e(this,0===t?0:t)}:"get"==t?function(t){return o&&!dt(t)?void 0:e(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!dt(t))&&e(this,0===t?0:t)}:function(t,r){return e(this,0===t?0:t,r),this})};if(nr(t,!$(a)||!(o||u.forEach&&!j((function(){(new a).entries().next()})))))s=r.getConstructor(e,t,n,i),Tl.enable();else if(nr(t,!0)){var l=new s,h=l[i](o?{}:-0,1)!=l,p=j((function(){l.has(1)})),v=_o((function(t){new a(t)})),d=!o&&j((function(){for(var t=new a,e=5;e--;)t[i](e,e);return!t.has(-0)}));v||((s=e((function(t,e){yr(t,u);var r=ss(new a,t,s);return C(e)||To(e,r[i],{that:r,AS_ENTRIES:n}),r}))).prototype=u,u.constructor=s),(p||d)&&(f("delete"),f("has"),n&&f("get")),(d||h)&&f(i),o&&u.clear&&delete u.clear}return c[t]=s,ir({global:!0,constructor:!0,forced:s!=a},c),hr(s,t),o||r.setStrong(s,t,n),s}),Il=Tl.getWeakData,jl=ce.set,Pl=ce.getterFor,_l=Ei.find,Ml=Ei.findIndex,Ll=R([].splice),Rl=0,Cl=function(t){return t.frozen||(t.frozen=new Nl)},Nl=function(){this.entries=[]},Dl=function(t,e){return _l(t.entries,(function(t){return t[0]===e}))};Nl.prototype={get:function(t){var e=Dl(this,t);if(e)return e[1]},has:function(t){return!!Dl(this,t)},set:function(t,e){var r=Dl(this,t);r?r[1]=e:this.entries.push([t,e])},delete:function(t){var e=Ml(this.entries,(function(e){return e[0]===t}));return~e&&Ll(this.entries,e,1),!!~e}};var Fl,Wl={getConstructor:function(t,e,r,n){var o=t((function(t,o){yr(t,i),jl(t,{type:e,id:Rl++,frozen:void 0}),C(o)||To(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Pl(e),u=function(t,e,r){var n=a(t),o=Il(At(e),!0);return!0===o?Cl(n).set(e,r):o[n.id]=r,t};return ru(i,{delete:function(t){var e=a(this);if(!dt(t))return!1;var r=Il(t);return!0===r?Cl(e).delete(t):r&&B(r,e.id)&&delete r[e.id]},has:function(t){var e=a(this);if(!dt(t))return!1;var r=Il(t);return!0===r?Cl(e).has(t):r&&B(r,e.id)}}),ru(i,r?{get:function(t){var e=a(this);if(dt(t)){var r=Il(t);return!0===r?Cl(e).get(t):r?r[e.id]:void 0}},set:function(t,e){return u(this,t,e)}}:{add:function(t){return u(this,t,!0)}}),o}},zl=ce.enforce,Bl=!O.ActiveXObject&&"ActiveXObject"in O,Ul=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Gl=kl("WeakMap",Ul,Wl);if(Jt&&Bl){Fl=Wl.getConstructor(Ul,"WeakMap",!0),Tl.enable();var Hl=Gl.prototype,Vl=R(Hl.delete),ql=R(Hl.has),Zl=R(Hl.get),Yl=R(Hl.set);ru(Hl,{delete:function(t){if(dt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),Vl(this,t)||e.frozen.delete(t)}return Vl(this,t)},has:function(t){if(dt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),ql(this,t)||e.frozen.has(t)}return ql(this,t)},get:function(t){if(dt(t)&&!Ol(t)){var e=zl(this);return e.frozen||(e.frozen=new Fl),ql(this,t)?Zl(this,t):e.frozen.get(t)}return Zl(this,t)},set:function(t,e){if(dt(t)&&!Ol(t)){var r=zl(this);r.frozen||(r.frozen=new Fl),ql(this,t)?Yl(this,t,e):r.frozen.set(t,e)}else Yl(this,t,e);return this}})}var $l=ft("iterator"),Kl=ft("toStringTag"),Ql=Ta.values,Xl=function(t,e){if(t){if(t[$l]!==Ql)try{ee(t,$l,Ql)}catch(e){t[$l]=Ql}if(t[Kl]||ee(t,Kl,e),hi[e])for(var r in Ta)if(t[r]!==Ta[r])try{ee(t,r,Ta[r])}catch(e){t[r]=Ta[r]}}};for(var Jl in hi)Xl(O[Jl]&&O[Jl].prototype,Jl);Xl(di,"DOMTokenList");var th,eh,rh,nh,oh=new WeakMap,ih=function(){function t(){i(this,t),oh.set(this,{})}return u(t,[{key:"addEventListener",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=oh.get(this);n||(n={}),n[t]||(n[t]=[]),n[t].push(e),oh.set(this,n),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,e){var r=oh.get(this);if(r){var n=r[t];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===e){n.splice(o,1);break}}}},{key:"dispatchEvent",value:function(t){var e=oh.get(this)[t.type];if(e){var r,n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=g(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}(e);try{for(n.s();!(r=n.n()).done;){(0,r.value)(t)}}catch(t){n.e(t)}finally{n.f()}}}}]),t}(),ah=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),t.className="",t.children=[],t}return u(r,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,e){this[t]=e}},{key:"getAttributeNS",value:function(t){return this[t]}}]),r}(function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"childNodes",void 0),t.childNodes=[],t}return u(r,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),r}(ih));if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var uh=my.getSystemInfoSync();th=uh.screenWidth,eh=uh.screenHeight,rh=uh.windowWidth,nh=uh.windowHeight}else{var sh=Sf.innerWidth,ch=Sf.innerHeight;th=sh,eh=ch,rh=sh,nh=ch}var fh={width:th,height:eh,availWidth:rh,availHeight:nh,availLeft:0,availTop:0},lh=fh.availWidth,hh=fh.availHeight,ph={style:[]};function vh(t,e){var r,n;"parentNode"in t||(r=0===e?function(){return null}:1===e?function(){return ph}:function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:r}));"parentElement"in t||(n=0===e?function(){return null}:1===e?function(){return ph}:function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:n}))}function dh(t){t.style=t.style||{},Object.assign(t.style,{top:"0px",left:"0px",width:lh+"px",height:hh+"px",margin:"0px",padding:"0px"})}function yh(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=lh,t.clientHeight=hh),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function gh(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=lh,t.offsetHeight=hh)}function mh(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=lh,t.scrollHeight=hh)}function xh(t){var e=function(){return!0};t.classList=[],t.classList.add=e,t.classList.remove=e,t.classList.contains=e,t.classList.toggle=e}function bh(){}var wh=function(t){c(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),s(h(t),"focus",void 0),s(h(t),"blur",void 0),s(h(t),"insertBefore",void 0),s(h(t),"appendChild",void 0),s(h(t),"removeChild",void 0),s(h(t),"remove",void 0),s(h(t),"innerHTML",void 0),s(h(t),"tagName",void 0),t.className="",t.children=[],t.focus=bh,t.blur=bh,t.insertBefore=bh,t.appendChild=bh,t.removeChild=bh,t.remove=bh,t.innerHTML="",t.tagName=n.toUpperCase(),vh(h(t),o),dh(h(t)),xh(h(t)),yh(h(t)),gh(h(t)),mh(h(t)),t}return u(r)}(ah),Eh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"video")}return u(r)}(function(t){c(r,t);var e=v(r);function r(t){return i(this,r),e.call(this,t)}return u(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(wh)),Ah={};function Oh(){return Ah}var Sh=u((function t(){i(this,t);var e=Oh(),r=e.createImage&&e.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=t.prototype),vh(r),xh(r),Object.assign(r,{addEventListener:function(t,e){r["on".concat(t)]=e.bind(r)},removeEventListener:function(t){r["on".concat(t)]=null}}),r})),Th={href:"",protocol:"",host:""},kh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"body",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e,r){}},{key:"dispatchEvent",value:function(t){}}]),r}(wh),Ih=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"html",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e){}},{key:"dispatchEvent",value:function(t){}}]),r}(wh),jh={},Ph={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Th,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return"canvas"===(t=t.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===t?new Sh:"video"===t?new Eh:new wh(t)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,e,r){jh[t]||(jh[t]=[]),jh[t].push(e)},removeEventListener:function(t,e){var r=jh[t];if(r&&r.length>0)for(var n=r.length;n--;n>0)if(r[n]===e){r.splice(n,1);break}},dispatchEvent:function(t){var e=t.type,r=jh[e];if(r)for(var n=0;n<r.length;n++)r[n](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)},createEvent:function(t){return new cl(t)}};Ph.documentElement=new Ih,Ph.head=new wh("head"),Ph.body=new kh,If("match",(function(t,e,r){return[function(e){var r=D(this),n=C(e)?void 0:Lt(e,t);return n?St(n,e,r):new RegExp(e)[t](rf(r))},function(t){var n=At(this),o=rf(t),i=r(e,n,o);if(i.done)return i.value;if(!n.global)return Hf(n,o);var a=n.unicode;n.lastIndex=0;for(var u,s=[],c=0;null!==(u=Hf(n,o));){var f=rf(u[0]);s[c]=f,""===f&&(n.lastIndex=Cf(o,De(n.lastIndex),a)),c++}return 0===c?null:s}]}));var _h,Mh,Lh=ft("isConcatSpreadable"),Rh=nt>=51||!j((function(){var t=[];return t[Lh]=!1,t.concat()[0]!==t})),Ch=Pi("concat"),Nh=function(t){if(!dt(t))return!1;var e=t[Lh];return void 0!==e?!!e:yi(t)};if(ir({target:"Array",proto:!0,arity:1,forced:!Rh||!Ch},{concat:function(t){var e,r,n,o,i,a=W(this),u=xi(a,0),s=0;for(e=-1,n=arguments.length;e<n;e++)if(Nh(i=-1===e?a:arguments[e]))for(o=Fe(i),il(s+o),r=0;r<o;r++,s++)r in i&&Ii(u,s,i[r]);else il(s+1),Ii(u,s++,i);return u.length=s,u}}),"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var Dh=my.getSystemInfoSync();_h=Dh.system,Dh.platform,Dh.language}else{var Fh={versions:(Mh=Sf.navigator.userAgent,{trident:Mh.indexOf("Trident")>-1,presto:Mh.indexOf("Presto")>-1,webKit:Mh.indexOf("AppleWebKit")>-1,gecko:Mh.indexOf("Gecko")>-1&&-1===Mh.indexOf("KHTML"),mobile:!!Mh.match(/AppleWebKit.*Mobile.*/),ios:!!Mh.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Mh.indexOf("Android")>-1||Mh.indexOf("Linux")>-1,iPhone:Mh.indexOf("iPhone")>-1,iPad:Mh.indexOf("iPad")>-1,webApp:-1===Mh.indexOf("Safari"),weixin:Mh.indexOf("MicroMessenger")>-1,qq:" qq"===Mh.match(/\\sQQ/i)}),language:(Sf.navigator.browserLanguage||Sf.navigator.language).toLowerCase()};Fh.versions.android?"android":Fh.versions.trident?"IE":Fh.versions.presto?"Opera":Fh.versions.webKit?"webKit":Fh.versions.gecko?"Firefox":Fh.versions.mobile?"mobile":Fh.versions.ios?"ios":Fh.versions.iPhone?"iPhone":Fh.versions.iPad?"ipad":Fh.versions.webApp?"webApp":Fh.versions.weixin?"weixin":Fh.versions.qq&&"qq",_h=Sf.navigator.userAgent,Fh.language}_h.toLowerCase().indexOf("android");cs("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}));var Wh=Ut.f,zh=Tl.fastKey,Bh=ce.set,Uh=ce.getterFor;kl("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(t,e,r,n){var o=t((function(t,o){yr(t,i),Bh(t,{type:e,index:Qi(null),first:void 0,last:void 0,size:0}),pt||(t.size=0),C(o)||To(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Uh(e),u=function(t,e,r){var n,o,i=a(t),u=s(t,e);return u?u.value=r:(i.last=u={index:o=zh(e,!0),key:e,value:r,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=u),n&&(n.next=u),pt?i.size++:t.size++,"F"!==o&&(i.index[o]=u)),t},s=function(t,e){var r,n=a(t),o=zh(e);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key==e)return r};return ru(i,{clear:function(){for(var t=a(this),e=t.index,r=t.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete e[r.index],r=r.next;t.first=t.last=void 0,pt?t.size=0:this.size=0},delete:function(t){var e=a(this),r=s(this,t);if(r){var n=r.next,o=r.previous;delete e.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),e.first==r&&(e.first=n),e.last==r&&(e.last=o),pt?e.size--:this.size--}return!!r},forEach:function(t){for(var e,r=a(this),n=zr(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:r.first;)for(n(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!s(this,t)}}),ru(i,r?{get:function(t){var e=s(this,t);return e&&e.value},set:function(t,e){return u(this,0===t?0:t,e)}}:{add:function(t){return u(this,t=0===t?0:t,t)}}),pt&&Wh(i,"size",{get:function(){return a(this).size}}),o},setStrong:function(t,e,r){var n=e+" Iterator",o=Uh(e),i=Uh(n);wa(t,e,(function(t,e){Bh(this,{type:n,target:t,state:o(t),kind:e,last:void 0})}),(function(){for(var t=i(this),e=t.kind,r=t.last;r&&r.removed;)r=r.previous;return t.target&&(t.last=r=r?r.next:t.state.first)?Ea("keys"==e?r.key:"values"==e?r.value:[r.key,r.value],!1):(t.target=void 0,Ea(void 0,!0))}),r?"entries":"values",!r,!0),vr(e)}});var Gh=R([].join),Hh=Se!=Object,Vh=Ai("join",",");ir({target:"Array",proto:!0,forced:Hh||!Vh},{join:function(t){return Gh(Te(this),void 0===t?",":t)}});var qh=j((function(){Hi(1)}));ir({target:"Object",stat:!0,forced:qh},{keys:function(t){return Hi(W(t))}});var Zh=new Map,Yh=new Map,$h=new Map,Kh=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"onabort",void 0),s(h(t),"onerror",void 0),s(h(t),"onload",void 0),s(h(t),"onloadstart",void 0),s(h(t),"onprogress",void 0),s(h(t),"ontimeout",void 0),s(h(t),"onloadend",void 0),s(h(t),"onreadystatechange",void 0),s(h(t),"readyState",void 0),s(h(t),"response",void 0),s(h(t),"responseText",void 0),s(h(t),"_responseType",void 0),s(h(t),"responseXML",void 0),s(h(t),"status",void 0),s(h(t),"statusText",void 0),s(h(t),"upload",void 0),s(h(t),"withCredentials",void 0),s(h(t),"timeout",void 0),s(h(t),"_url",void 0),s(h(t),"_method",void 0),t.onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t._responseType="text",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,Zh.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),t}return u(r,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=$h.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=Yh.get("responseHeader");return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\\n")}},{key:"getResponseHeader",value:function(t){return Yh.get("responseHeader")[t]}},{key:"open",value:function(t,e,r){this._method=t,this._url=e}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(t,e){var r=Zh.get("requestHeader");r[t]=e,Zh.set("requestHeader",r)}},{key:"addEventListener",value:function(t,e){var r=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||r,e.call(r,t)})}},{key:"removeEventListener",value:function(t,e){this["on"+t]===e&&(this["on"+t]=null)}}]),r}(ih);s(Kh,"UNSEND",void 0),s(Kh,"OPENED",void 0),s(Kh,"HEADERS_RECEIVED",void 0),s(Kh,"LOADING",void 0),s(Kh,"DONE",void 0),Kh.UNSEND=0,Kh.OPENED=1,Kh.HEADERS_RECEIVED=2,Kh.LOADING=3,Kh.DONE=4;var Qh="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,Xh="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),Jh=Qh||Xh;Jh||Sf.XMLHttpRequest,Jh||Sf.location;function tp(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}var ep=Ei.filter,rp=Pi("filter");function np(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}function op(t,e,r){return 2===r.length?[r[0],r[1],0]:[r[0],r[1],r[2]]}function ip(t){return t.filter?[1]:[0]}function ap(t,e){return[e]}ir({target:"Array",proto:!0,forced:!rp},{filter:function(t){return ep(this,t,arguments.length>1?arguments[1]:void 0)}});var up=cp,sp=cp;function cp(t,e,r){r=r||2;var n,o,i,a,u,s,c,f=e&&e.length,l=f?e[0]*r:t.length,h=fp(t,0,l,r,!0),p=[];if(!h||h.next===h.prev)return p;if(f&&(h=function(t,e,r,n){var o,i,a,u,s,c=[];for(o=0,i=e.length;o<i;o++)a=e[o]*n,u=o<i-1?e[o+1]*n:t.length,(s=fp(t,a,u,n,!1))===s.next&&(s.steiner=!0),c.push(wp(s));for(c.sort(gp),o=0;o<c.length;o++)r=mp(c[o],r);return r}(t,e,h,r)),t.length>80*r){n=i=t[0],o=a=t[1];for(var v=r;v<l;v+=r)(u=t[v])<n&&(n=u),(s=t[v+1])<o&&(o=s),u>i&&(i=u),s>a&&(a=s);c=0!==(c=Math.max(i-n,a-o))?32767/c:0}return hp(h,p,r,n,o,c,0),p}function fp(t,e,r,n,o){var i,a;if(o===Rp(t,e,r,n)>0)for(i=e;i<r;i+=n)a=_p(i,t[i],t[i+1],a);else for(i=r-n;i>=e;i-=n)a=_p(i,t[i],t[i+1],a);return a&&Sp(a,a.next)&&(Mp(a),a=a.next),a}function lp(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Sp(n,n.next)&&0!==Op(n.prev,n,n.next))n=n.next;else{if(Mp(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function hp(t,e,r,n,o,i,a){if(t){!a&&i&&function(t,e,r,n){var o=t;do{0===o.z&&(o.z=bp(o.x,o.y,e,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,r,n,o,i,a,u,s,c=1;do{for(r=t,t=null,i=null,a=0;r;){for(a++,n=r,u=0,e=0;e<c&&(u++,n=n.nextZ);e++);for(s=c;u>0||s>0&&n;)0!==u&&(0===s||!n||r.z<=n.z)?(o=r,r=r.nextZ,u--):(o=n,n=n.nextZ,s--),i?i.nextZ=o:t=o,o.prevZ=i,i=o;r=n}i.nextZ=null,c*=2}while(a>1)}(o)}(t,n,o,i);for(var u,s,c=t;t.prev!==t.next;)if(u=t.prev,s=t.next,i?vp(t,n,o,i):pp(t))e.push(u.i/r|0),e.push(t.i/r|0),e.push(s.i/r|0),Mp(t),t=s.next,c=s.next;else if((t=s)===c){a?1===a?hp(t=dp(lp(t),e,r),e,r,n,o,i,2):2===a&&yp(t,e,r,n,o,i):hp(lp(t),e,r,n,o,i,1);break}}}function pp(t){var e=t.prev,r=t,n=t.next;if(Op(e,r,n)>=0)return!1;for(var o=e.x,i=r.x,a=n.x,u=e.y,s=r.y,c=n.y,f=o<i?o<a?o:a:i<a?i:a,l=u<s?u<c?u:c:s<c?s:c,h=o>i?o>a?o:a:i>a?i:a,p=u>s?u>c?u:c:s>c?s:c,v=n.next;v!==e;){if(v.x>=f&&v.x<=h&&v.y>=l&&v.y<=p&&Ep(o,u,i,s,a,c,v.x,v.y)&&Op(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function vp(t,e,r,n){var o=t.prev,i=t,a=t.next;if(Op(o,i,a)>=0)return!1;for(var u=o.x,s=i.x,c=a.x,f=o.y,l=i.y,h=a.y,p=u<s?u<c?u:c:s<c?s:c,v=f<l?f<h?f:h:l<h?l:h,d=u>s?u>c?u:c:s>c?s:c,y=f>l?f>h?f:h:l>h?l:h,g=bp(p,v,e,r,n),m=bp(d,y,e,r,n),x=t.prevZ,b=t.nextZ;x&&x.z>=g&&b&&b.z<=m;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&Ep(u,f,s,l,c,h,x.x,x.y)&&Op(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&Ep(u,f,s,l,c,h,b.x,b.y)&&Op(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;x&&x.z>=g;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&Ep(u,f,s,l,c,h,x.x,x.y)&&Op(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=m;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&Ep(u,f,s,l,c,h,b.x,b.y)&&Op(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function dp(t,e,r){var n=t;do{var o=n.prev,i=n.next.next;!Sp(o,i)&&Tp(o,n,n.next,i)&&jp(o,i)&&jp(i,o)&&(e.push(o.i/r|0),e.push(n.i/r|0),e.push(i.i/r|0),Mp(n),Mp(n.next),n=t=i),n=n.next}while(n!==t);return lp(n)}function yp(t,e,r,n,o,i){var a=t;do{for(var u=a.next.next;u!==a.prev;){if(a.i!==u.i&&Ap(a,u)){var s=Pp(a,u);return a=lp(a,a.next),s=lp(s,s.next),hp(a,e,r,n,o,i,0),void hp(s,e,r,n,o,i,0)}u=u.next}a=a.next}while(a!==t)}function gp(t,e){return t.x-e.x}function mp(t,e){var r=function(t,e){var r,n=e,o=t.x,i=t.y,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var u=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=o&&u>a&&(a=u,r=n.x<n.next.x?n:n.next,u===o))return r}n=n.next}while(n!==e);if(!r)return null;var s,c=r,f=r.x,l=r.y,h=1/0;n=r;do{o>=n.x&&n.x>=f&&o!==n.x&&Ep(i<l?o:a,i,f,l,i<l?a:o,i,n.x,n.y)&&(s=Math.abs(i-n.y)/(o-n.x),jp(n,t)&&(s<h||s===h&&(n.x>r.x||n.x===r.x&&xp(r,n)))&&(r=n,h=s)),n=n.next}while(n!==c);return r}(t,e);if(!r)return e;var n=Pp(r,t);return lp(n,n.next),lp(r,r.next)}function xp(t,e){return Op(t.prev,t,e.prev)<0&&Op(e.next,t,t.next)<0}function bp(t,e,r,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function wp(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function Ep(t,e,r,n,o,i,a,u){return(o-a)*(e-u)>=(t-a)*(i-u)&&(t-a)*(n-u)>=(r-a)*(e-u)&&(r-a)*(i-u)>=(o-a)*(n-u)}function Ap(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Tp(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(jp(t,e)&&jp(e,t)&&function(t,e){var r=t,n=!1,o=(t.x+e.x)/2,i=(t.y+e.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&o<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(Op(t.prev,t,e.prev)||Op(t,e.prev,e))||Sp(t,e)&&Op(t.prev,t,t.next)>0&&Op(e.prev,e,e.next)>0)}function Op(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Sp(t,e){return t.x===e.x&&t.y===e.y}function Tp(t,e,r,n){var o=Ip(Op(t,e,r)),i=Ip(Op(t,e,n)),a=Ip(Op(r,n,t)),u=Ip(Op(r,n,e));return o!==i&&a!==u||(!(0!==o||!kp(t,r,e))||(!(0!==i||!kp(t,n,e))||(!(0!==a||!kp(r,t,n))||!(0!==u||!kp(r,e,n)))))}function kp(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Ip(t){return t>0?1:t<0?-1:0}function jp(t,e){return Op(t.prev,t,t.next)<0?Op(t,e,t.next)>=0&&Op(t,t.prev,e)>=0:Op(t,e,t.prev)<0||Op(t,t.next,e)<0}function Pp(t,e){var r=new Lp(t.i,t.x,t.y),n=new Lp(e.i,e.x,e.y),o=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=o,o.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function _p(t,e,r,n){var o=new Lp(t,e,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function Mp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Lp(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Rp(t,e,r,n){for(var o=0,i=e,a=r-n;i<r;i+=n)o+=(t[a]-t[i])*(t[i+1]+t[a+1]),a=i;return o}cp.deviation=function(t,e,r,n){var o=e&&e.length,i=o?e[0]*r:t.length,a=Math.abs(Rp(t,0,i,r));if(o)for(var u=0,s=e.length;u<s;u++){var c=e[u]*r,f=u<s-1?e[u+1]*r:t.length;a-=Math.abs(Rp(t,c,f,r))}var l=0;for(u=0;u<n.length;u+=3){var h=n[u]*r,p=n[u+1]*r,v=n[u+2]*r;l+=Math.abs((t[h]-t[v])*(t[p+1]-t[h+1])-(t[h]-t[p])*(t[v+1]-t[h+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},cp.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var i=0;i<t[o].length;i++)for(var a=0;a<e;a++)r.vertices.push(t[o][i][a]);o>0&&(n+=t[o-1].length,r.holes.push(n))}return r},up.default=sp;var Cp=R(1..valueOf),Np=R("".replace),Dp="[\\t\\n\\v\\f\\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\\u2028\\u2029\\ufeff]",Fp=RegExp("^"+Dp+Dp+"*"),Wp=RegExp(Dp+Dp+"*$"),zp=function(t){return function(e){var r=rf(D(e));return 1&t&&(r=Np(r,Fp,"")),2&t&&(r=Np(r,Wp,"")),r}},Bp={start:zp(1),end:zp(2),trim:zp(3)},Up=qe.f,Gp=Ie.f,Hp=Ut.f,Vp=Bp.trim,qp=O.Number,Zp=qp.prototype,Yp=O.TypeError,$p=R("".slice),Kp=R("".charCodeAt),Qp=function(t){var e=Dt(t,"number");return"bigint"==typeof e?e:Xp(e)},Xp=function(t){var e,r,n,o,i,a,u,s,c=Dt(t,"number");if(It(c))throw Yp("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=Vp(c),43===(e=Kp(c,0))||45===e){if(88===(r=Kp(c,2))||120===r)return NaN}else if(48===e){switch(Kp(c,1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+c}for(a=(i=$p(c,2)).length,u=0;u<a;u++)if((s=Kp(i,u))<48||s>o)return NaN;return parseInt(i,n)}return+c};if(nr("Number",!qp(" 0o1")||!qp("0b1")||qp("+0x1"))){for(var Jp,tv=function(t){var e=arguments.length<1?0:qp(Qp(t)),r=this;return Tt(Zp,r)&&j((function(){Cp(r)}))?ss(Object(e),r,tv):e},ev=pt?Up(qp):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),rv=0;ev.length>rv;rv++)B(qp,Jp=ev[rv])&&!B(tv,Jp)&&Hp(tv,Jp,Gp(qp,Jp));tv.prototype=Zp,Zp.constructor=tv,le(O,"Number",tv,{constructor:!0})}var nv=RangeError,ov=RangeError,iv=String,av=Math.floor,uv=R((function(t){var e=rf(D(this)),r="",n=Me(t);if(n<0||n==1/0)throw nv("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(e+=e))1&n&&(r+=e);return r})),sv=R("".slice),cv=R(1..toFixed),fv=function(t,e,r){return 0===e?r:e%2==1?fv(t,e-1,r*t):fv(t*t,e/2,r)},lv=function(t,e,r){for(var n=-1,o=r;++n<6;)o+=e*t[n],t[n]=o%1e7,o=av(o/1e7)},hv=function(t,e){for(var r=6,n=0;--r>=0;)n+=t[r],t[r]=av(n/e),n=n%e*1e7},pv=function(t){for(var e=6,r="";--e>=0;)if(""!==r||0===e||0!==t[e]){var n=iv(t[e]);r=""===r?n:r+uv("0",7-n.length)+n}return r},vv=j((function(){return"0.000"!==cv(8e-5,3)||"1"!==cv(.9,0)||"1.25"!==cv(1.255,2)||"1000000000000000128"!==cv(0xde0b6b3a7640080,0)}))||!j((function(){cv({})}));function dv(t){return"number"==typeof t}function yv(t){var e=Math.max(Math.min(85.0511287798,t[1]),-85.0511287798),r=Math.PI/180,n=t[0]*r,o=e*r;o=Math.log(Math.tan(Math.PI/4+o/2));return n=(256<<20)*(.5/Math.PI*n+.5),o=(256<<20)*(-.5/Math.PI*o+(r=.5)),[Math.floor(n),Math.floor(o)]}ir({target:"Number",proto:!0,forced:vv},{toFixed:function(t){var e,r,n,o,i=Cp(this),a=Me(t),u=[0,0,0,0,0,0],s="",c="0";if(a<0||a>20)throw ov("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return iv(i);if(i<0&&(s="-",i=-i),i>1e-21)if(r=(e=function(t){for(var e=0,r=t;r>=4096;)e+=12,r/=4096;for(;r>=2;)e+=1,r/=2;return e}(i*fv(2,69,1))-69)<0?i*fv(2,-e,1):i/fv(2,e,1),r*=4503599627370496,(e=52-e)>0){for(lv(u,0,r),n=a;n>=7;)lv(u,1e7,0),n-=7;for(lv(u,fv(10,n,1),0),n=e-1;n>=23;)hv(u,1<<23),n-=23;hv(u,1<<n),lv(u,1,1),hv(u,2),c=pv(u)}else lv(u,0,r),lv(u,1<<-e,0),c=pv(u)+uv("0",a);return c=a>0?s+((o=c.length)<=a?"0."+uv("0",a-o)+c:sv(c,0,o-a)+"."+sv(c,o-a)):s+c}});var gv,mv=/"/g,xv=R("".replace);ir({target:"String",proto:!0,forced:(gv="sub",j((function(){var t=""[gv]('"');return t!==t.toLowerCase()||t.split('"').length>3})))},{sub:function(){return t="sub",e="",r="",n=rf(D(this)),o="<"+t,""!==e&&(o+=" "+e+'="'+xv(rf(r),mv,"&quot;")+'"'),o+">"+n+"</"+t+">";var t,e,r,n,o}});var bv=RegExp.prototype,wv=qt.PROPER,Ev=RegExp.prototype.toString,Av=j((function(){return"/a/b"!=Ev.call({source:"a",flags:"b"})})),Ov=wv&&"toString"!=Ev.name;(Av||Ov)&&le(RegExp.prototype,"toString",(function(){var t=At(this);return"/"+rf(t.source)+"/"+rf(function(t){var e=t.flags;return void 0!==e||"flags"in bv||B(t,"flags")||!Tt(bv,t)?e:St(nf,t)}(t))}),{unsafe:!0});var Sv="undefined"!=typeof Float32Array?Float32Array:Array;function Tv(){var t=new Sv(2);return Sv!=Float32Array&&(t[0]=0,t[1]=0),t}function kv(t,e){var r=new Sv(2);return r[0]=t,r[1]=e,r}function Iv(t,e){return t[0]=e[0],t[1]=e[1],t}function jv(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Pv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function _v(t,e){var r=e[0],n=e[1],o=r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t}function Mv(t,e){return t[0]*e[0]+t[1]*e[1]}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Lv,Rv=Pv,Cv=(Lv=Tv(),Tv()),Nv=(Tv(),Tv()),Dv=Tv(),Fv=Tv();function Wv(t,e,r,n,o){return jv(t,r,n),_v(t,t),[o/Mv(e=kv(-t[1],t[0]),kv(-r[1],r[0])),e]}function zv(t,e){return function(t,e,r){return t[0]=e,t[1]=r,t}(t,-e[1],e[0])}function Bv(t,e,r){return Rv(t,e,r),_v(t,t),t}function Uv(t,e){return t[0]===e[0]&&t[1]===e[1]}var Gv=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),s(this,"complex",void 0),s(this,"join",void 0),s(this,"cap",void 0),s(this,"miterLimit",void 0),s(this,"thickness",void 0),s(this,"normal",void 0),s(this,"lastFlip",-1),s(this,"miter",kv(0,0)),s(this,"started",!1),s(this,"dash",!1),s(this,"totalDistance",0),s(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return u(t,[{key:"extrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.segment_gaode2(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.simpleSegment(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.segment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.simpleSegment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,r,n,o,i,a,u){var s=0,c=t.indices,f=t.positions,l=t.normals,h="square"===this.cap,p="bevel"===this.join,v=yv([a[0],a[1]]),g=yv([i[0],i[1]]);Bv(Nv,n,r);var m=0;if(this.dash&&(m=this.lineSegmentDistance(v,g),this.totalDistance+=m),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),!this.started)if(this.started=!0,h){var x=Tv(),b=Tv();jv(x,this.normal,Nv),jv(b,this.normal,Nv),l.push(b[0],b[1],0),l.push(x[0],x[1],0),f.push(r[0],r[1],0|r[2],this.totalDistance-m,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),f.push(r[0],r[1],0|r[2],this.totalDistance-m,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,r,this.normal,this.thickness,this.totalDistance-m);if(c.push(e+0,e+1,e+2),o){Uv(n,o)&&jv(o,n,_v(o,Pv(o,n,r))),Bv(Dv,o,n);var w=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),E=w[0],A=w[1],O=Mv(Fv,this.normal)<0?-1:1,S=p;if(!S&&"miter"===this.join)E>this.miterLimit&&(S=!0);S?(l.push(this.normal[0],this.normal[1],0),l.push(A[0],A[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,y(this.lastFlip!==-O?[e,e+2,e+3]:[e+2,e+1,e+3])),c.push(e+2,e+3,e+4),zv(Cv,Dv),Iv(this.normal,Cv),l.push(this.normal[0],this.normal[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s+=3):(this.extrusions(f,l,n,A,E,this.totalDistance),c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),O=-1,Iv(this.normal,A),s+=2),this.lastFlip=O}else{if(zv(this.normal,Nv),h){var T=Tv(),k=Tv();Rv(k,Nv,this.normal),jv(T,Nv,this.normal),l.push(k[0],k[1],0),l.push(T[0],T[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,n,this.normal,this.thickness,this.totalDistance);c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),s+=2}return s}},{key:"simpleSegment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c=yv([n[0],n[1]]),f=yv([r[0],r[1]]);Bv(Nv,c,f);var l=0;if(this.dash&&(l=this.lineSegmentDistance(c,f),this.totalDistance+=l),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),this.started||(this.started=!0,this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-l)),a.push(e+0,e+1,e+2),o){var h=yv([o[0],o[1]]);Uv(c,h)&&jv(h,c,_v(h,Pv(h,c,f))),Bv(Dv,h,c);var p=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),v=p[0],g=p[1];Mv(Fv,this.normal);this.extrusions(u,s,n,g,v,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),-1,Iv(this.normal,g),i+=2,this.lastFlip=-1}else zv(this.normal,Nv),this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2;return i}},{key:"segment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c="square"===this.cap,f="bevel"===this.join,l=yv([n[0],n[1]]),h=yv([r[0],r[1]]);Bv(Nv,l,h);var p=0;if(this.dash&&(p=this.lineSegmentDistance(l,h),this.totalDistance+=p),this.normal||(this.normal=Tv(),zv(this.normal,Nv)),!this.started)if(this.started=!0,c){var v=Tv(),g=Tv();jv(v,this.normal,Nv),jv(g,this.normal,Nv),s.push(g[0],g[1],0),s.push(v[0],v[1],0),u.push(r[0],r[1],0|r[2],this.totalDistance-p,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),u.push(r[0],r[1],0|r[2],this.totalDistance-p,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-p);if(a.push(e+0,e+1,e+2),o){var m=yv([o[0],o[1]]);Uv(l,m)&&jv(m,l,_v(m,Pv(m,l,h))),Bv(Dv,m,l);var x=d(Wv(Fv,Tv(),Nv,Dv,this.thickness),2),b=x[0],w=x[1],E=Mv(Fv,this.normal)<0?-1:1,A=f;if(!A&&"miter"===this.join)b>this.miterLimit&&(A=!0);A?(s.push(this.normal[0],this.normal[1],0),s.push(w[0],w[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,y(this.lastFlip!==-E?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),zv(Cv,Dv),Iv(this.normal,Cv),s.push(this.normal[0],this.normal[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,i+=3):(this.extrusions(u,s,n,w,b,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),E=-1,Iv(this.normal,w),i+=2),this.lastFlip=E}else{if(zv(this.normal,Nv),c){var O=Tv(),S=Tv();Rv(S,Nv,this.normal),jv(O,Nv,this.normal),s.push(S[0],S[1],0),s.push(O[0],O[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance);a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2}return i}},{key:"extrusions",value:function(t,e,r,n,o,i){e.push(n[0],n[1],0),e.push(n[0],n[1],0),t.push(r[0],r[1],0|r[2],i,-o,0|r[2]),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],0|r[2],i,o,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}}]),t}();function Hv(t){var e=t.coordinates,r=t.originCoordinates,n=t.version,o=new Gv({dash:!0,join:"bevel"});if("GAODE2.x"===n){var i=e;Array.isArray(i[0][0])||(i=[e]);var a=r;Array.isArray(a[0][0])||(a=[r]);for(var u=0;u<i.length;u++){var s=i[u],c=a[u];o.extrude_gaode2(s,c)}}else{var f=e;f[0]&&!Array.isArray(f[0][0])&&(f=[e]),f.forEach((function(t){o.extrude(t)}))}var l=o.complex;return{vertices:l.positions,indices:l.indices,normals:l.normals,indexes:l.indexes,size:6}}function Vv(t){var e=function(t){if(dv(t[0]))return t;if(dv(t[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(dv(t[0][0][0])){var e=0,r=0,n=0;return t.forEach((function(t){t.forEach((function(t){e+=t[0],r+=t[1],n++}))})),[e/n,r/n,0]}throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}(t.coordinates);return{vertices:[].concat(y(e),y(e),y(e),y(e)),indices:[0,1,2,2,3,0],size:e.length}}function qv(t){var e=t.coordinates,r=up.flatten(e),n=r.vertices,o=r.dimensions,i=r.holes;return{indices:up(n,i,o),vertices:n,size:o}}var Zv=function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.iconMap,u={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]},a_DistanceAndIndex:function(t,e,r,n,o,i){return void 0===i?[r[3],10]:[r[3],i]},a_Total_Distance:function(t,e,r){return[r[5]]},a_Size:function(t){var e=t.size,r=void 0===e?1:e;return Array.isArray(r)?[r[0],r[1]]:[r,0]},a_Normal:function(t,e,r,n,o){return o},a_Miter:function(t,e,r){return[r[4]]},a_iconMapUV:function(t){var e=t.texture,r=a[e]||{x:0,y:0};return[r.x,r.y]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Hv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size,p=r.indexes;o.forEach((function(t){f.push(t+c)})),l=h;var v=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=v;for(var d=function(r){var o=(null==a?void 0:a.slice(3*r,3*r+3))||[],s=i.slice(r*h,r*h+h),c=0;p&&void 0!==p[r]&&(c=p[r]),n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,s,r,o,c)))}))},g=0;g<v;g++)d(g)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Yv={pointFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.shape2d,u={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]},a_Shape:function(t){var e=t.shape,r=void 0===e?2:e;return[a.indexOf(r)]},a_Extrude:function(t,e,r,n){var o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],i=n%4*3;return[o[i],o[i+1],o[i+2]]},a_Size:function(t){var e=t.size,r=void 0===e?5:e;return Array.isArray(r)?[r[0]]:[r]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Vv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size;o.forEach((function(t){f.push(t+c)})),l=h;var p=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=p;for(var v=function(r){var o=[],a=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,a,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),line:Zv,polygonFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a={a_Color:np,a_Position:op,filter:ip,a_vertexId:ap,a_PickingColor:function(t){var e=t.id;return i?tp(e):[0,0,0]}},u={sizePerElement:0,elements:[]},s=0,c=[],f=3,o.forEach((function(t,e){var r=qv(t),o=r.indices,i=r.vertices,l=r.normals,h=r.size;o.forEach((function(t){c.push(t+s)})),f=h;var p=i.length/h;u.sizePerElement=f,u.elements.push({featureIdx:e,vertices:i,normals:l,offset:s}),s+=p;for(var v=function(r){var o=[],u=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&a[n.name]&&(i=n.buffer.data).push.apply(i,y(a[n.name](t,e,u,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:u,indices:c});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},$v=function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Yv);function Kv(t){return Qv.apply(this,arguments)}function Qv(){return(Qv=o(r().mark((function t(e){var n,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.workerType,o=e.data,!$v[n]){t.next=3;break}return t.abrupt("return",$v[n](o));case 3:return t.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(n,'" non-existent.'))));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return fi(Kv),t.WorkerSourceMap=Yv,t.createWorker=fi,t.worker=Kv,t}({});
`,go="l7-worker",hu=3,Yp=!0;function qp(e){cp(go,e)}function Bd(){var e=Ta(go);if(!e)throw new Error("get worker failed by workerName: ".concat(go,"."));return e}function Nd(e,i){return fp.apply(this,arguments)}function fp(){return fp=(0,Wt.Z)(be().mark(function e(i,t){var n,r,o,u,l;return be().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return n=Bd(),r=Ah.getWorkerFarm({maxConcurrency:hu,reuseWorkers:Yp}),o=r.getWorkerPool({name:go,source:n}),v.next=5,o.startJob(go,function(x,E,A){return x.done(A)});case 5:return u=v.sent,u.postMessage("process",{input:{workerType:i,data:t}}),v.next=9,u.result;case 9:return l=v.sent,v.abrupt("return",l.result);case 11:case"end":return v.stop()}},e)})),fp.apply(this,arguments)}qp(Mc);var ec={BACK:1029,FRONT:1028};function Oh(e){switch(e){case"GAODE1.x":return ec.BACK;case"GAODE2.x":return ec.BACK;case"MAPBOX":return ec.FRONT;case"SIMPLE":return ec.FRONT;case"GLOBEL":return ec.BACK;case"DEBAULT":return ec.FRONT;default:return ec.FRONT}}function zd(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function lh(){return typeof importScripts=="function"}var Zd=lh()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href},nf;(function(e){e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace"})(nf||(nf={}));var js;(function(e){e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled"})(js||(js={}));var Za=0,Fh=1,Uu=2;function Ff(e){e.forEach(function(i){i.isCurrent&&(i.isVisible=i.isLoaded)})}function hp(e){e.forEach(function(i){i.properties.state=Za}),e.forEach(function(i){i.isCurrent&&!U(i)&&we(i)}),e.forEach(function(i){i.isVisible=Boolean(i.properties.state&Uu)})}function Ud(e){e.forEach(function(t){t.properties.state=Za}),e.forEach(function(t){t.isCurrent&&U(t)});var i=e.slice().sort(function(t,n){return t.z-n.z});i.forEach(function(t){t.isVisible=Boolean(t.properties.state&Uu),t.children.length&&(t.isVisible||t.properties.state&Fh)?t.children.forEach(function(n){n.properties.state=Fh}):t.isCurrent&&we(t)})}function U(e){for(;e;){if(e.isLoaded)return e.properties.state|=Uu,!0;e=e.parent}return!1}function we(e){e.children.forEach(function(i){i.isLoaded?i.properties.state|=Uu:we(i)})}var $e,rr=256,wr=[-Infinity,-Infinity,Infinity,Infinity],Jt=.2,yr=5,kr=($e={},(0,W.Z)($e,nf.Realtime,Ff),(0,W.Z)($e,nf.Overlap,hp),(0,W.Z)($e,nf.Replace,Ud),$e),Br=function(){};function Zr(e,i,t){var n=Math.floor((e+180)/360*Math.pow(2,t)),r=Math.floor((1-Math.log(Math.tan(i*Math.PI/180)+1/Math.cos(i*Math.PI/180))/Math.PI)/2*Math.pow(2,t));return[n,r]}function $r(e,i,t){var n=e/Math.pow(2,t)*360-180,r=Math.PI-2*Math.PI*i/Math.pow(2,t),o=180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)));return[n,o]}var qr=function(i,t,n){var r=$r(i,t,n),o=(0,$n.Z)(r,2),u=o[0],l=o[1],p=$r(i+1,t+1,n),v=(0,$n.Z)(p,2),x=v[0],E=v[1];return[u,E,x,l]};function hn(e){var i=e.zoom,t=e.latLonBounds,n=e.maxZoom,r=n===void 0?Infinity:n,o=e.minZoom,u=o===void 0?0:o,l=e.zoomOffset,p=l===void 0?0:l,v=e.extent,x=v===void 0?wr:v,E=Math.ceil(i)+p;if(Number.isFinite(u)&&E<u)return[];Number.isFinite(r)&&E>r&&(E=r);for(var A=(0,$n.Z)(t,4),T=A[0],L=A[1],F=A[2],z=A[3],H=[Math.max(T,x[0]),Math.max(L,x[1]),Math.min(F,x[2]),Math.min(z,x[3])],ne=[],oe=Zr(H[0],H[1],E),ke=(0,$n.Z)(oe,2),De=ke[0],ft=ke[1],At=Zr(H[2],H[3],E),Nt=(0,$n.Z)(At,2),Gt=Nt[0],xr=Nt[1],dr=De;dr<=Gt;dr++)for(var zr=xr;zr<=ft;zr++)ne.push({x:dr,y:zr,z:E});var bn=(Gt+De)/2,Wn=(ft+xr)/2,oa=function(Co,ko){return Math.abs(Co-bn)+Math.abs(ko-Wn)};return ne.sort(function(Ma,Co){return oa(Ma.x,Ma.y)-oa(Co.x,Co.y)}),ne}var Ur=function(i,t,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,o=Math.pow(2,n),u=o-1,l=o,p=i,v=t;return r&&(p<0?p=p+l:p>u&&(p=p%l)),{warpX:p,warpY:v}};function Kr(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function Tt(e){var i=[],t=/\{([a-z])-([a-z])\}/.exec(e);if(t){var n=t[1].charCodeAt(0),r=t[2].charCodeAt(0),o;for(o=n;o<=r;++o)i.push(e.replace(t[0],String.fromCharCode(o)));return i}if(t=/\{(\d+)-(\d+)\}/.exec(e),t){for(var u=parseInt(t[2],10),l=parseInt(t[1],10);l<=u;l++)i.push(e.replace(t[0],l.toString()));return i}return i.push(e),i}function ar(e,i){if(!e||!e.length)throw new Error("url is not allowed to be empty");var t=i.x,n=i.y,r=i.z,o=Tt(e),u=Math.abs(t+n)%o.length,l=o[u];return l.replace(/\{x\}/g,t.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,r.toString()).replace(/\{bbox\}/g,qr(t,n,r).join(",")).replace(/\{-y\}/g,(Math.pow(2,r)-n-1).toString())}function Vr(e,i){var t=i.x,n=i.y,r=i.z,o=i.layer,u=i.version,l=u===void 0?"1.0.0":u,p=i.style,v=p===void 0?"default":p,x=i.format,E=i.service,A=E===void 0?"WMTS":E,T=i.tileMatrixset,L="".concat(e,"&SERVICE=").concat(A,"&REQUEST=GetTile&VERSION=").concat(l,"&LAYER=").concat(o,"&STYLE=").concat(v,"&TILEMATRIXSET=").concat(T,"&FORMAT=").concat(x,"&TILECOL=").concat(t,"&TILEROW=").concat(n,"&TILEMATRIX=").concat(r);return L}function un(e,i){i===void 0&&(i={});var t=Number(e[0]),n=Number(e[1]),r=Number(e[2]),o=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var u=[t,n],l=[t,o],p=[r,o],v=[r,n];return Ye([[u,v,p,l,u]],i.properties,{bbox:e,id:i.id})}var Er=ee(26729),Jr=ee.n(Er);function yn(e){var i=ai();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function ai(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _r=function(e){(0,Dr.Z)(t,e);var i=yn(t);function t(n){var r;(0,wt.Z)(this,t),r=i.call(this),(0,W.Z)((0,He.Z)(r),"tileSize",256),(0,W.Z)((0,He.Z)(r),"isVisible",!1),(0,W.Z)((0,He.Z)(r),"isCurrent",!1),(0,W.Z)((0,He.Z)(r),"isVisibleChange",!1),(0,W.Z)((0,He.Z)(r),"loadedLayers",0),(0,W.Z)((0,He.Z)(r),"isLayerLoaded",!1),(0,W.Z)((0,He.Z)(r),"isLoad",!1),(0,W.Z)((0,He.Z)(r),"isChildLoad",!1),(0,W.Z)((0,He.Z)(r),"parent",null),(0,W.Z)((0,He.Z)(r),"children",[]),(0,W.Z)((0,He.Z)(r),"data",null),(0,W.Z)((0,He.Z)(r),"properties",{}),(0,W.Z)((0,He.Z)(r),"loadDataId",0);var o=n.x,u=n.y,l=n.z,p=n.tileSize,v=n.warp,x=v===void 0?!0:v;return r.x=o,r.y=u,r.z=l,r.warp=x||!0,r.tileSize=p,r}return(0,zt.Z)(t,[{key:"isLoading",get:function(){return this.loadStatus===js.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===js.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===js.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===js.Cancelled}},{key:"isDone",get:function(){return[js.Loaded,js.Cancelled,js.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return qr(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var r=(0,$n.Z)(this.bounds,4),o=r[0],u=r[1],l=r[2],p=r[3],v=[(l-o)/2,(p-u)/2],x=un(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:v,meta:`
      `.concat(this.key,`
      `)}});return x}},{key:"key",get:function(){var r="".concat(this.x,"_").concat(this.y,"_").concat(this.z);return r}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var n=(0,Wt.Z)(be().mark(function o(u){var l,p,v,x,E,A,T,L,F,z,H,ne,oe,ke,De,ft,At;return be().wrap(function(Gt){for(;;)switch(Gt.prev=Gt.next){case 0:return l=u.getData,p=u.onLoad,v=u.onError,this.loadDataId++,x=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=js.Loading,E=null,Gt.prev=7,T=this.x,L=this.y,F=this.z,z=this.bounds,H=this.tileSize,ne=this.warp,oe=Ur(T,L,F,ne),ke=oe.warpX,De=oe.warpY,ft=this.abortController.signal,At={x:ke,y:De,z:F,bounds:z,tileSize:H,signal:ft,warp:ne},Gt.next=14,l(At,this);case 14:E=Gt.sent,Gt.next=20;break;case 17:Gt.prev=17,Gt.t0=Gt.catch(7),A=Gt.t0;case 20:if(x===this.loadDataId){Gt.next=22;break}return Gt.abrupt("return");case 22:if(!(this.isCancelled&&!E)){Gt.next=24;break}return Gt.abrupt("return");case 24:if(!(A||!E)){Gt.next=28;break}return this.loadStatus=js.Failure,v(A,this),Gt.abrupt("return");case 28:this.loadStatus=js.Loaded,this.data=E,p(this);case 31:case"end":return Gt.stop()}},o,this,[[7,17]])}));function r(o){return n.apply(this,arguments)}return r}()},{key:"reloadData",value:function(r){this.isLoading&&this.abortLoad(),this.loadData(r)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=js.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),t}(Er.EventEmitter),Sr=function(i,t){var n=it(i),r=nt(n,t),o=360*3-180,u=85.0511287798065,l=[Math.max(r[0][0],-o),Math.max(r[0][1],-u),Math.min(r[1][0],o),Math.min(r[1][1],u)];return l},Gn=function(i,t){var n=it(i),r=it(t),o=Fe(n,r);return o};function nn(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Gr(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function Gr(e,i){if(!!e){if(typeof e=="string")return mn(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return mn(e,i)}}function mn(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function _n(e){var i=Ri();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function Ri(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ei=function(e){(0,Dr.Z)(t,e);var i=_n(t);function t(n){var r;return(0,wt.Z)(this,t),r=i.call(this),(0,W.Z)((0,He.Z)(r),"currentTiles",[]),(0,W.Z)((0,He.Z)(r),"cacheTiles",new Map),(0,W.Z)((0,He.Z)(r),"throttleUpdate",(0,ur.throttle)(function(o,u){r.update(o,u)},16)),(0,W.Z)((0,He.Z)(r),"onTileLoad",function(o){r.emit("tile-loaded",o),r.updateTileVisible()}),(0,W.Z)((0,He.Z)(r),"onTileError",function(o,u){r.emit("tile-error",{error:o,tile:u}),r.updateTileVisible()}),(0,W.Z)((0,He.Z)(r),"onTileUnload",function(o){r.emit("tile-unload",o)}),r.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:wr,getTileData:Br,warp:!0,updateStrategy:nf.Overlap},r.updateOptions(n),r}return(0,zt.Z)(t,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(r){return r.isDone})}},{key:"tiles",get:function(){var r=Array.from(this.cacheTiles.values()).sort(function(o,u){return o.z-u.z});return r}},{key:"updateOptions",value:function(r){var o=r.minZoom===void 0?this.options.minZoom:Math.ceil(r.minZoom),u=r.maxZoom===void 0?this.options.maxZoom:Math.floor(r.maxZoom);this.options=(0,mt.Z)((0,mt.Z)((0,mt.Z)({},this.options),r),{},{minZoom:o,maxZoom:u})}},{key:"update",value:function(r,o){var u=this,l=Math.max(0,Math.ceil(r));if(!(this.lastViewStates&&this.lastViewStates.zoom===l&&Gn(this.lastViewStates.latLonBoundsBuffer,o))){var p=Sr(o,Jt);this.lastViewStates={zoom:l,latLonBounds:o,latLonBoundsBuffer:p};var v=!1,x=this.getTileIndices(l,p).filter(function(E){return u.options.warp||E.x>=0&&E.x<Math.pow(2,l)});this.currentTiles=x.map(function(E){var A=E.x,T=E.y,L=E.z,F=u.getTile(A,T,L);if(F){var z,H,ne=((z=F)===null||z===void 0?void 0:z.isFailure)||((H=F)===null||H===void 0?void 0:H.isCancelled);return ne&&F.loadData({getData:u.options.getTileData,onLoad:u.onTileLoad,onError:u.onTileError}),F}return F=u.createTile(A,T,L),v=!0,F}),v&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var r=nn(this.cacheTiles),o;try{for(r.s();!(o=r.n()).done;){var u=(0,$n.Z)(o.value,2),l=u[0],p=u[1];this.currentTiles.includes(p)||(this.cacheTiles.delete(l),this.onTileUnload(p)),this.onTileUnload(p),p.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(v){r.e(v)}finally{r.f()}}},{key:"pruneRequests",value:function(){var r=[],o=nn(this.cacheTiles.values()),u;try{for(o.s();!(u=o.n()).done;){var l=u.value;l.isLoading&&!l.isCurrent&&!l.isVisible&&r.push(l)}}catch(v){o.e(v)}finally{o.f()}for(;r.length>0;){var p=r.shift();p.abortLoad()}}},{key:"getTileByLngLat",value:function(r,o,u){var l=this.options.zoomOffset,p=Math.ceil(u)+l,v=Zr(r,o,p),x=this.tiles.filter(function(E){return E.key==="".concat(v[0],"_").concat(v[1],"_").concat(p)});return x[0]}},{key:"destroy",value:function(){var r=nn(this.cacheTiles.values()),o;try{for(r.s();!(o=r.n()).done;){var u=o.value;u.isLoading&&u.abortLoad()}}catch(l){r.e(l)}finally{r.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var r=this.options.updateStrategy,o=new Map,u=nn(this.cacheTiles.values()),l;try{for(u.s();!(l=u.n()).done;){var p=l.value;o.set(p.key,p.isVisible),p.isCurrent=!1,p.isVisible=!1}}catch(L){u.e(L)}finally{u.f()}var v=nn(this.currentTiles),x;try{for(v.s();!(x=v.n()).done;){var E=x.value;E.isCurrent=!0,E.isVisible=!0}}catch(L){v.e(L)}finally{v.f()}var A=Array.from(this.cacheTiles.values());typeof r=="function"?r(A):kr[r](A);var T=!1;Array.from(this.cacheTiles.values()).forEach(function(L){L.isVisible!==o.get(L.key)?(L.isVisibleChange=!0,T=!0):L.isVisibleChange=!1}),T&&this.emit("tile-update")}},{key:"getTileIndices",value:function(r,o){var u=this.options,l=u.tileSize,p=u.extent,v=u.zoomOffset,x=Math.floor(this.options.maxZoom),E=Math.ceil(this.options.minZoom),A=hn({maxZoom:x,minZoom:E,zoomOffset:v,tileSize:l,zoom:r,latLonBounds:o,extent:p});return A}},{key:"getTileId",value:function(r,o,u){var l="".concat(r,",").concat(o,",").concat(u);return l}},{key:"getTile",value:function(r,o,u){var l=this.getTileId(r,o,u),p=this.cacheTiles.get(l);return p}},{key:"createTile",value:function(r,o,u){var l=this.getTileId(r,o,u),p=new _r({x:r,y:o,z:u,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(l,p),p.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),p}},{key:"resizeCacheTiles",value:function(){var r=yr*this.currentTiles.length,o=this.cacheTiles.size>r;if(o){var u=nn(this.cacheTiles),l;try{for(u.s();!(l=u.n()).done;){var p=(0,$n.Z)(l.value,2),v=p[0],x=p[1];if(!x.isVisible&&!this.currentTiles.includes(x)&&(this.cacheTiles.delete(v),this.onTileUnload(x)),this.cacheTiles.size<=r)break}}catch(E){u.e(E)}finally{u.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var r=nn(this.cacheTiles.values()),o;try{for(r.s();!(o=r.n()).done;){var u=o.value;u.parent=null,u.children.length=0}}catch(E){r.e(E)}finally{r.f()}var l=nn(this.cacheTiles.values()),p;try{for(l.s();!(p=l.n()).done;){var v=p.value,x=this.getNearestAncestor(v.x,v.y,v.z);v.parent=x,x!=null&&x.children&&x.children.push(v)}}catch(E){l.e(E)}finally{l.f()}}},{key:"getNearestAncestor",value:function(r,o,u){for(;u>this.options.minZoom;){r=Math.floor(r/2),o=Math.floor(o/2),u=u-1;var l=this.getTile(r,o,u);if(l)return l}return null}}]),t}(Jr()),pn;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(pn||(pn={}));function Tn(e,i,t,n,r){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,l=t;return u&&(l=Math.round(t*(o-1))/(o-1)),n?fo(e,i,l,n,r):fo(e,i,l,.314,r)}function hi(e,i){var t=1-i;return(e[0]*t+e[1]*i)*t+(e[1]*t+e[2]*i)*i}function Mi(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function $i(e,i,t){var n=[i[0]-e[0],i[1]-e[1]],r=Mi(n,[0,0]),o=Math.atan2(n[1],n[0]),u=r/2/Math.cos(t),l=o+t,p=[u*Math.cos(l)+e[0],u*Math.sin(l)+e[1]];return p}function fo(e,i,t,n,r){if(r===Version["GAODE2.x"]){var o=amap2Project(e[0],e[1]),u=amap2Project(i[0],i[1]),l=$i(o,u,n),p=[o[0],l[0],u[0]],v=[o[1],l[1],u[1]];return[].concat(_toConsumableArray(amap2UnProject(hi(p,t),hi(v,t))),[0])}else{var x=$i(e,i,n),E=[e[0],x[0],i[0]],A=[e[1],x[1],i[1]];return[hi(E,t),hi(A,t),0]}}function Ao(e,i,t,n,r){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,l=t;return u&&(l=Math.round(t*29)/29),ss(e,i,l,r)}function Yi(e,i){var t=[i[0]-e[0],i[1]-e[1]],n=calDistance(t,[0,0]),r=Math.atan2(t[1],t[0]),o=.314,u=n/2/Math.cos(o),l=r+o,p=[u*Math.cos(l)+e[0],u*Math.sin(l)+e[1]];return p}function os(e,i){var t=1-i;return(e[0]*t+e[1]*i)*t+(e[1]*t+e[2]*i)*i}function ao(e,i){var t=[e[0]-i[0],e[1]-i[1]],n=[Math.sin(t[0]/2),Math.sin(t[1]/2)],r=n[1]*n[1]+Math.cos(e[1])*Math.cos(i[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))}function ss(e,i,t,n){var r=[degreesToRadians(e[0]),degreesToRadians(e[1])],o=[degreesToRadians(i[0]),degreesToRadians(i[1])];if(n==="GAODE2.x"){var u=Yi(r,o),l=[r[0],u[0],o[0]],p=[r[1],u[1],o[1]];return[os(l,t),os(p,t),0]}else{var v=ao(r,o);if(Math.abs(v-Math.PI)<.001)return[(1-t)*r[0]+t*o[0],(1-t)*r[1]+t*o[1]];var x=Math.sin((1-t)*v)/Math.sin(v),E=Math.sin(t*v)/Math.sin(v),A=[Math.sin(r[0]),Math.sin(r[1])],T=[Math.cos(r[0]),Math.cos(r[1])],L=[Math.sin(o[0]),Math.sin(o[1])],F=[Math.cos(o[0]),Math.cos(o[1])],z=x*T[1]*T[0]+E*F[1]*F[0],H=x*T[1]*A[0]+E*F[1]*L[0],ne=x*A[1]+E*L[1];return[radiansToDegrees(Math.atan2(H,z)),radiansToDegrees(Math.atan2(ne,Math.sqrt(z*z+H*H)))]}}function Ho(e,i){for(var t=0,n=[],r=0;r<e.length-1;r++){var o=e[r],u=e[r+1],l=Qo(o,u),p=t;t+=l,n.push({p1:o,p2:u,totalDistance:t,distance:l,lastTotalDistance:p})}for(var v=t*i,x,E,A=0,T=n;A<T.length;A++){var L=T[A],F=L.totalDistance;if(F>v){var z=L.p1,H=L.p2,ne=(v-L.lastTotalDistance)/L.distance,oe=us(H,z,ne);x=oe[0],E=oe[1];break}}return{lng:x,lat:E,height:0}}function us(e,i,t){return[e[0]*t+i[0]*(1-t),e[1]*t+i[1]*(1-t)]}function Qo(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function ds(e,i){var t=i.featureId,n=e.data.dataArray;return typeof t=="number"&&(n=n.filter(function(r){var o=r.id;return o===t})),n.map(function(r){var o=Li(r,i);return _objectSpread(_objectSpread({},r),o)})}function To(e,i){return new Promise(function(t){e.inited?t(ds(e,i)):e.once("update",function(){t(ds(e,i))})})}function Li(e,i){var t=i.offset,n=i.shape,r=i.thetaOffset,o=i.mapVersion,u=i.segmentNumber,l=u===void 0?30:u,p=i.autoFit,v=p===void 0?!0:p,x=e.coordinates;if(n==="line")return pathLineAtOffset(x,t);var E=x[0],A=x[1],T=typeof r=="string"?e[r]||0:r,L;switch(n){case"arc":L=arcLineAtOffset;break;case"greatcircle":L=greatCircleLineAtOffset;break;default:L=arcLineAtOffset}var F=L(E,A,t,T,o,l,v),z=_slicedToArray(F,3),H=z[0],ne=z[1],oe=z[2];return{lng:H,lat:ne,height:oe}}function Wo(e,i){var t=i.extent,n=t===void 0?[121.168,30.2828,121.384,30.4219]:t,r=new Promise(function(u){e instanceof HTMLImageElement||zd(e)?u([e]):da(e,function(l){u(l)})}),o={originData:e,images:r,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return o}function da(e,i){var t=e,n=[];if(typeof t=="string")zu({url:t},function(u,l){l&&(n.push(l),i(n))});else{var r=t.length,o=0;t.forEach(function(u){zu({url:u},function(l,p){o++,p&&n.push(p),o===r&&i(n)})})}return Wo}var vs=ee(38929),xi=ee(3614),qi=ee.n(xi),Ca=function(){function e(i,t,n,r){(0,wt.Z)(this,e),(0,W.Z)(this,"vectorLayerCache",{}),this.x=t,this.y=n,this.z=r,this.vectorTile=new vs.VectorTile(new(qi())(i))}return(0,zt.Z)(e,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var n=this.vectorTile.layers[t];if(Array.isArray(n.features))return this.vectorLayerCache[t]=n.features,n.features;for(var r=[],o=0;o<n.length;o++){var u=n.feature(o),l=u.toGeoJSON(this.x,this.y,this.z);r.push((0,mt.Z)((0,mt.Z)({},l),{},{properties:(0,mt.Z)({id:l.id},l.properties)}))}return this.vectorLayerCache[t]=r,r}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),zo={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},Sl=function(){var e=(0,Wt.Z)(be().mark(function i(t,n,r,o){var u;return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=ar(t,n),p.abrupt("return",new Promise(function(v){var x=gl((0,mt.Z)((0,mt.Z)({},o),{},{url:u}),function(E,A){if(E||!A)v(void 0);else{var T=new Ca(A,r.x,r.y,r.z);v(T)}});r.xhrCancel=function(){return x.abort()}}));case 2:case"end":return p.stop()}},i)}));return function(t,n,r,o){return e.apply(this,arguments)}}();function Ne(e,i){var t=Array.isArray(e)?e[0]:e,n=function(u,l){return Sl(t,u,l,i==null?void 0:i.requestParameters)},r=(0,mt.Z)((0,mt.Z)((0,mt.Z)({},zo),i),{},{getTileData:n});return{data:t,dataArray:[],tilesetOptions:r,isTile:!0}}function nr(e,i,t,n){for(var r=n,o=t-i>>1,u=t-i,l,p=e[i],v=e[i+1],x=e[t],E=e[t+1],A=i+3;A<t;A+=3){var T=Vt(e[A],e[A+1],p,v,x,E);if(T>r)l=A,r=T;else if(T===r){var L=Math.abs(A-o);L<u&&(l=A,u=L)}}r>n&&(l-i>3&&nr(e,i,l,n),e[l+2]=r,t-l>3&&nr(e,l,t,n))}function Vt(e,i,t,n,r,o){var u=r-t,l=o-n;if(u!==0||l!==0){var p=((e-t)*u+(i-n)*l)/(u*u+l*l);p>1?(t=r,n=o):p>0&&(t+=u*p,n+=l*p)}return u=e-t,l=i-n,u*u+l*l}function Mn(e,i,t,n){var r={id:typeof e=="undefined"?null:e,type:i,geometry:t,tags:n,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};return ra(r),r}function ra(e){var i=e.geometry,t=e.type;if(t==="Point"||t==="MultiPoint"||t==="LineString")Re(e,i);else if(t==="Polygon"||t==="MultiLineString")for(var n=0;n<i.length;n++)Re(e,i[n]);else if(t==="MultiPolygon")for(n=0;n<i.length;n++)for(var r=0;r<i[n].length;r++)Re(e,i[n][r])}function Re(e,i){for(var t=0;t<i.length;t+=3)e.minX=Math.min(e.minX,i[t]),e.minY=Math.min(e.minY,i[t+1]),e.maxX=Math.max(e.maxX,i[t]),e.maxY=Math.max(e.maxY,i[t+1])}function ve(e,i){var t=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)tt(t,e.features[n],i,n);else e.type==="Feature"?tt(t,e,i):tt(t,{geometry:e},i);return t}function tt(e,i,t,n){if(!!i.geometry){var r=i.geometry.coordinates,o=i.geometry.type,u=Math.pow(t.tolerance/((1<<t.maxZoom)*t.extent),2),l=[],p=i.id;if(t.promoteId?p=i.properties[t.promoteId]:t.generateId&&(p=n||0),o==="Point")Mt(r,l);else if(o==="MultiPoint")for(var v=0;v<r.length;v++)Mt(r[v],l);else if(o==="LineString")Yt(r,l,u,!1);else if(o==="MultiLineString")if(t.lineMetrics){for(v=0;v<r.length;v++)l=[],Yt(r[v],l,u,!1),e.push(Mn(p,"LineString",l,i.properties));return}else ut(r,l,u,!1);else if(o==="Polygon")ut(r,l,u,!0);else if(o==="MultiPolygon")for(v=0;v<r.length;v++){var x=[];ut(r[v],x,u,!0),l.push(x)}else if(o==="GeometryCollection"){for(v=0;v<i.geometry.geometries.length;v++)tt(e,{id:p,geometry:i.geometry.geometries[v],properties:i.properties},t,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(Mn(p,o,l,i.properties))}}function Mt(e,i){i.push(We(e[0])),i.push(xt(e[1])),i.push(0)}function Yt(e,i,t,n){for(var r,o,u=0,l=0;l<e.length;l++){var p=We(e[l][0]),v=xt(e[l][1]);i.push(p),i.push(v),i.push(0),l>0&&(n?u+=(r*v-p*o)/2:u+=Math.sqrt(Math.pow(p-r,2)+Math.pow(v-o,2))),r=p,o=v}var x=i.length-3;i[2]=1,nr(i,0,x,t),i[x+2]=1,i.size=Math.abs(u),i.start=0,i.end=i.size}function ut(e,i,t,n){for(var r=0;r<e.length;r++){var o=[];Yt(e[r],o,t,n),i.push(o)}}function We(e){return e/360+.5}function xt(e){var i=Math.sin(e*Math.PI/180),t=.5-.25*Math.log((1+i)/(1-i))/Math.PI;return t<0?0:t>1?1:t}function Ae(e,i,t,n,r,o,u,l){if(t/=i,n/=i,o>=t&&u<n)return e;if(u<t||o>=n)return null;for(var p=[],v=0;v<e.length;v++){var x=e[v],E=x.geometry,A=x.type,T=r===0?x.minX:x.minY,L=r===0?x.maxX:x.maxY;if(T>=t&&L<n){p.push(x);continue}else if(L<t||T>=n)continue;var F=[];if(A==="Point"||A==="MultiPoint")Je(E,F,t,n,r);else if(A==="LineString")Oe(E,F,t,n,r,!1,l.lineMetrics);else if(A==="MultiLineString")Ut(E,F,t,n,r,!1);else if(A==="Polygon")Ut(E,F,t,n,r,!0);else if(A==="MultiPolygon")for(var z=0;z<E.length;z++){var H=[];Ut(E[z],H,t,n,r,!0),H.length&&F.push(H)}if(F.length){if(l.lineMetrics&&A==="LineString"){for(z=0;z<F.length;z++)p.push(Mn(x.id,A,F[z],x.tags));continue}(A==="LineString"||A==="MultiLineString")&&(F.length===1?(A="LineString",F=F[0]):A="MultiLineString"),(A==="Point"||A==="MultiPoint")&&(A=F.length===3?"Point":"MultiPoint"),p.push(Mn(x.id,A,F,x.tags))}}return p.length?p:null}function Je(e,i,t,n,r){for(var o=0;o<e.length;o+=3){var u=e[o+r];u>=t&&u<=n&&(i.push(e[o]),i.push(e[o+1]),i.push(e[o+2]))}}function Oe(e,i,t,n,r,o,u){for(var l=kt(e),p=r===0?ln:cn,v=e.start,x,E,A=0;A<e.length-3;A+=3){var T=e[A],L=e[A+1],F=e[A+2],z=e[A+3],H=e[A+4],ne=r===0?T:L,oe=r===0?z:H,ke=!1;u&&(x=Math.sqrt(Math.pow(T-z,2)+Math.pow(L-H,2))),ne<t?oe>t&&(E=p(l,T,L,z,H,t),u&&(l.start=v+x*E)):ne>n?oe<n&&(E=p(l,T,L,z,H,n),u&&(l.start=v+x*E)):Mr(l,T,L,F),oe<t&&ne>=t&&(E=p(l,T,L,z,H,t),ke=!0),oe>n&&ne<=n&&(E=p(l,T,L,z,H,n),ke=!0),!o&&ke&&(u&&(l.end=v+x*E),i.push(l),l=kt(e)),u&&(v+=x)}var De=e.length-3;T=e[De],L=e[De+1],F=e[De+2],ne=r===0?T:L,ne>=t&&ne<=n&&Mr(l,T,L,F),De=l.length-3,o&&De>=3&&(l[De]!==l[0]||l[De+1]!==l[1])&&Mr(l,l[0],l[1],l[2]),l.length&&i.push(l)}function kt(e){var i=[];return i.size=e.size,i.start=e.start,i.end=e.end,i}function Ut(e,i,t,n,r,o){for(var u=0;u<e.length;u++)Oe(e[u],i,t,n,r,o,!1)}function Mr(e,i,t,n){e.push(i),e.push(t),e.push(n)}function ln(e,i,t,n,r,o){var u=(o-i)/(n-i);return e.push(o),e.push(t+(r-t)*u),e.push(1),u}function cn(e,i,t,n,r,o){var u=(o-t)/(r-t);return e.push(i+(n-i)*u),e.push(o),e.push(1),u}function Sn(e,i){var t=i.buffer/i.extent,n=e,r=Ae(e,1,-1-t,t,0,-1,2,i),o=Ae(e,1,1-t,2+t,0,-1,2,i);return(r||o)&&(n=Ae(e,1,-t,1+t,0,-1,2,i)||[],r&&(n=rn(r,1).concat(n)),o&&(n=n.concat(rn(o,-1)))),n}function rn(e,i){for(var t=[],n=0;n<e.length;n++){var r=e[n],o=r.type,u;if(o==="Point"||o==="MultiPoint"||o==="LineString")u=Hn(r.geometry,i);else if(o==="MultiLineString"||o==="Polygon"){u=[];for(var l=0;l<r.geometry.length;l++)u.push(Hn(r.geometry[l],i))}else if(o==="MultiPolygon")for(u=[],l=0;l<r.geometry.length;l++){for(var p=[],v=0;v<r.geometry[l].length;v++)p.push(Hn(r.geometry[l][v],i));u.push(p)}t.push(Mn(r.id,o,u,r.tags))}return t}function Hn(e,i){var t=[];t.size=e.size,e.start!==void 0&&(t.start=e.start,t.end=e.end);for(var n=0;n<e.length;n+=3)t.push(e[n]+i,e[n+1],e[n+2]);return t}function kn(e,i){if(e.transformed)return e;var t=1<<e.z,n=e.x,r=e.y,o,u,l;for(o=0;o<e.features.length;o++){var p=e.features[o],v=p.geometry,x=p.type;if(p.geometry=[],x===1)for(u=0;u<v.length;u+=2)p.geometry.push(Zn(v[u],v[u+1],i,t,n,r));else for(u=0;u<v.length;u++){var E=[];for(l=0;l<v[u].length;l+=2)E.push(Zn(v[u][l],v[u][l+1],i,t,n,r));p.geometry.push(E)}}return e.transformed=!0,e}function Zn(e,i,t,n,r,o){return[Math.round(t*(e*n-r)),Math.round(t*(i*n-o))]}function Un(e,i,t,n,r){for(var o=i===r.maxZoom?0:r.tolerance/((1<<i)*r.extent),u={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:t,y:n,z:i,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},l=0;l<e.length;l++){u.numFeatures++,Ln(u,e[l],o,r);var p=e[l].minX,v=e[l].minY,x=e[l].maxX,E=e[l].maxY;p<u.minX&&(u.minX=p),v<u.minY&&(u.minY=v),x>u.maxX&&(u.maxX=x),E>u.maxY&&(u.maxY=E)}return u}function Ln(e,i,t,n){var r=i.geometry,o=i.type,u=[];if(o==="Point"||o==="MultiPoint")for(var l=0;l<r.length;l+=3)u.push(r[l]),u.push(r[l+1]),e.numPoints++,e.numSimplified++;else if(o==="LineString")pi(u,r,e,t,!1,!1);else if(o==="MultiLineString"||o==="Polygon")for(l=0;l<r.length;l++)pi(u,r[l],e,t,o==="Polygon",l===0);else if(o==="MultiPolygon")for(var p=0;p<r.length;p++){var v=r[p];for(l=0;l<v.length;l++)pi(u,v[l],e,t,!0,l===0)}if(u.length){var x=i.tags||null;if(o==="LineString"&&n.lineMetrics){x={};for(var E in i.tags)x[E]=i.tags[E];x.mapbox_clip_start=r.start/r.size,x.mapbox_clip_end=r.end/r.size}var A={geometry:u,type:o==="Polygon"||o==="MultiPolygon"?3:o==="LineString"||o==="MultiLineString"?2:1,tags:x};i.id!==null&&(A.id=i.id),e.features.push(A)}}function pi(e,i,t,n,r,o){var u=n*n;if(n>0&&i.size<(r?u:n)){t.numPoints+=i.length/3;return}for(var l=[],p=0;p<i.length;p+=3)(n===0||i[p+2]>u)&&(t.numSimplified++,l.push(i[p]),l.push(i[p+1])),t.numPoints++;r&&La(l,o),e.push(l)}function La(e,i){for(var t=0,n=0,r=e.length,o=r-2;n<r;o=n,n+=2)t+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(t>0===i)for(n=0,r=e.length;n<r/2;n+=2){var u=e[n],l=e[n+1];e[n]=e[r-2-n],e[n+1]=e[r-1-n],e[r-2-n]=u,e[r-1-n]=l}}function ms(e,i){return new Ba(e,i)}function Ba(e,i){i=this.options=wl(Object.create(this.options),i);var t=i.debug;if(t&&console.time("preprocess data"),i.maxZoom<0||i.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(i.promoteId&&i.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=ve(e,i);this.tiles={},this.tileCoords=[],t&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",i.indexMaxZoom,i.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=Sn(n,i),n.length&&this.splitTile(n,0,0,0),t&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}Ba.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ba.prototype.splitTile=function(e,i,t,n,r,o,u){for(var l=[e,i,t,n],p=this.options,v=p.debug;l.length;){n=l.pop(),t=l.pop(),i=l.pop(),e=l.pop();var x=1<<i,E=_a(i,t,n),A=this.tiles[E];if(!A&&(v>1&&console.time("creation"),A=this.tiles[E]=Un(e,i,t,n,p),this.tileCoords.push({z:i,x:t,y:n}),v)){v>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",i,t,n,A.numFeatures,A.numPoints,A.numSimplified),console.timeEnd("creation"));var T="z"+i;this.stats[T]=(this.stats[T]||0)+1,this.total++}if(A.source=e,r){if(i===p.maxZoom||i===r)continue;var L=1<<r-i;if(t!==Math.floor(o/L)||n!==Math.floor(u/L))continue}else if(i===p.indexMaxZoom||A.numPoints<=p.indexMaxPoints)continue;if(A.source=null,e.length!==0){v>1&&console.time("clipping");var F=.5*p.buffer/p.extent,z=.5-F,H=.5+F,ne=1+F,oe,ke,De,ft,At,Nt;oe=ke=De=ft=null,At=Ae(e,x,t-F,t+H,0,A.minX,A.maxX,p),Nt=Ae(e,x,t+z,t+ne,0,A.minX,A.maxX,p),e=null,At&&(oe=Ae(At,x,n-F,n+H,1,A.minY,A.maxY,p),ke=Ae(At,x,n+z,n+ne,1,A.minY,A.maxY,p),At=null),Nt&&(De=Ae(Nt,x,n-F,n+H,1,A.minY,A.maxY,p),ft=Ae(Nt,x,n+z,n+ne,1,A.minY,A.maxY,p),Nt=null),v>1&&console.timeEnd("clipping"),l.push(oe||[],i+1,t*2,n*2),l.push(ke||[],i+1,t*2,n*2+1),l.push(De||[],i+1,t*2+1,n*2),l.push(ft||[],i+1,t*2+1,n*2+1)}}},Ba.prototype.getTile=function(e,i,t){var n=this.options,r=n.extent,o=n.debug;if(e<0||e>24)return null;var u=1<<e;i=(i%u+u)%u;var l=_a(e,i,t);if(this.tiles[l])return kn(this.tiles[l],r);o>1&&console.log("drilling down to z%d-%d-%d",e,i,t);for(var p=e,v=i,x=t,E;!E&&p>0;)p--,v=Math.floor(v/2),x=Math.floor(x/2),E=this.tiles[_a(p,v,x)];return!E||!E.source?null:(o>1&&console.log("found parent tile z%d-%d-%d",p,v,x),o>1&&console.time("drilling down"),this.splitTile(E.source,p,v,x,e,i,t),o>1&&console.timeEnd("drilling down"),this.tiles[l]?kn(this.tiles[l],r):null)};function _a(e,i,t){return((1<<e)*t+i)*32+e}function wl(e,i){for(var t in i)e[t]=i[t];return e}var Gs=function(){function e(i,t,n,r){(0,wt.Z)(this,e),(0,W.Z)(this,"vectorLayerCache",{}),this.x=t,this.y=n,this.z=r,this.vectorTile=i}return(0,zt.Z)(e,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var n=this.vectorTile.layers[t];return n.features}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),rl={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function Mu(e){for(var i=0,t=0,n=e.length,r=n-1,o,u;t<n;r=t++)o=e[t],u=e[r],i+=(u.x-o.x)*(o.y+u.y);return i}function pp(e){var i=e.length;if(i<=1)return[e];for(var t=[],n,r,o=0;o<i;o++){var u=Mu(e[o]);u!==0&&(r===void 0&&(r=u<0),r===u<0?(n&&t.push(n),n=[e[o]]):n.push(e[o]))}return n&&t.push(n),t}var ku=["Unknown","Point","LineString","Polygon"];function kc(e,i,t,n,r){var o=r.geometry,u=r.type,l=r.tags,p=r.id,v=e*Math.pow(2,n),x=e*i,E=e*t,A=ku[u],T,L;function F(ne){for(var oe=0;oe<ne.length;oe++){var ke=ne[oe];if(ke[3])break;var De=180-(ke[1]+E)*360/v,ft=(ke[0]+x)*360/v-180,At=360/Math.PI*Math.atan(Math.exp(De*Math.PI/180))-90;ne[oe]=[ft,At,0,1]}}switch(u){case 1:var z=[];for(T=0;T<o.length;T++)z[T]=o[T][0];o=z,F(o);break;case 2:for(T=0;T<o.length;T++)F(o[T]);break;case 3:for(o=pp(o),T=0;T<o.length;T++)for(L=0;L<o[T].length;L++)F(o[T][L]);break}o.length===1?o=o[0]:A="Multi"+A;var H={type:"Feature",geometry:{type:A,coordinates:o},properties:l,id:p,tileOrigin:[0,0],coord:""};return H}var ch=function(){var e=(0,Wt.Z)(be().mark(function i(t,n,r,o){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(p){var v=n.getTile(t.z,t.x,t.y),x=v?v.features.map(function(T){return kc(o,r.x,r.y,r.z,T)}):[],E={layers:{defaultLayer:{features:x}}},A=new Gs(E,t.x,t.y,t.z);p(A)}));case 1:case"end":return l.stop()}},i)}));return function(t,n,r,o){return e.apply(this,arguments)}}();function Uv(e){var i={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"?i:(0,mt.Z)((0,mt.Z)({},i),e.geojsonvtOptions)}function ls(e,i){var t=Uv(i),n=t.extent||4096,r=ms(e,t),o=function(p,v){return ch(v,r,p,n)},u=(0,mt.Z)((0,mt.Z)((0,mt.Z)({},rl),i),{},{getTileData:o});return{data:e,dataArray:[],tilesetOptions:u,isTile:!0}}function dp(e,i,t){switch(e){case"+":return i+t;case"-":return i-t;case"*":return i*t;case"/":return i/t;case"%":return i%t;case"^":return Math.pow(i,t);case"abs":return Math.abs(i);case"floor":return Math.floor(i);case"round":return Math.round(i);case"ceil":return Math.ceil(i);case"sin":return Math.sin(i);case"cos":return Math.cos(i);case"atan":return t===-1?Math.atan(i):Math.atan2(i,t);default:return console.warn("Calculate symbol err! Return default 0"),0}}function nl(e,i){for(var t=i[0],n=t.width,r=t.height,o=i.map(function(T){return T.rasterData}),u=n*r,l=[],p=JSON.stringify(e),v=0;v<u;v++){var x=JSON.parse(p),E=vp(x,o,v);if(typeof E=="number")l.push(E);else{var A=mp(x);l.push(A)}}return l}function vp(e,i,t){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return i[e[1]][t]}catch(n){return console.warn("Raster Data err!"),0}e.map(function(n,r){if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[r]=i[n[1]][t]}catch(o){console.warn("Raster Data err!"),e[r]=0}break;default:vp(n,i,t)}})}function Kp(e){var i=(0,$n.Z)(e,3),t=i[0],n=i[1],r=n===void 0?-1:n,o=i[2],u=o===void 0?-1:o;if(t===void 0)return console.warn("Express err!"),["+",0,0];var l=t.replace(/\s+/g,"");return[l,r,u]}function mp(e){var i=Kp(e),t=i[0],n=i[1],r=i[2];return Array.isArray(n)&&(n=mp(e[1])),Array.isArray(r)&&(r=mp(e[2])),dp(t,n,r)}var Dh={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:af}};function af(e,i){for(var t=e[0].rasterData,n=e[1].rasterData,r=e[2].rasterData,o=[],u=(i==null?void 0:i.countCut)||[2,98],l=(0,$n.Z)(u,2),p=l[0],v=l[1],x=(i==null?void 0:i.RMinMax)||Qp(t,p,v),E=(i==null?void 0:i.GMinMax)||Qp(n,p,v),A=(i==null?void 0:i.BMinMax)||Qp(r,p,v),T=0;T<t.length;T++)o.push(Math.max(0,t[T]-x[0])),o.push(Math.max(0,n[T]-E[0])),o.push(Math.max(0,r[T]-A[0]));return{rasterData:o,rMinMax:x,gMinMax:E,bMinMax:A}}function Qp(e,i,t){var n=e.slice().sort(function(l,p){return l-p}),r=n.length,o=n[Math.ceil(r*i/100)],u=n[Math.ceil(r*t/100)];return[o,u]}function Jp(e,i,t){return Vd.apply(this,arguments)}function Vd(){return Vd=(0,Wt.Z)(be().mark(function e(i,t,n){var r,o,u,l,p,v;return be().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(i.length!==0){E.next=2;break}return E.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return E.next=4,Promise.all(i.map(function(A){var T=A.data,L=A.bands,F=L===void 0?[0]:L;return t(T,F)}));case 4:r=E.sent,o=[],r.forEach(function(A){Array.isArray(A)?o.push.apply(o,(0,cr.Z)(A)):o.push(A)}),u=o[0],l=u.width,p=u.height,E.t0=(0,gu.Z)(n),E.next=E.t0==="function"?11:E.t0==="object"?13:15;break;case 11:return v=n(o),E.abrupt("break",16);case 13:return Array.isArray(n)?v={rasterData:nl(n,o)}:v=Cs(n,o),E.abrupt("break",16);case 15:v={rasterData:o[0].rasterData};case 16:return E.abrupt("return",(0,mt.Z)((0,mt.Z)({},v),{},{width:l,height:p}));case 17:case"end":return E.stop()}},e)})),Vd.apply(this,arguments)}function Cs(e,i){var t=Dh[e.type];if(t.type==="function")return t.method(i,e==null?void 0:e.options);if(t.type==="operation")return e.type==="rgb"?Df(t.expression,i):{rasterData:nl(t.expression,i)}}function Df(e,i){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var t=nl(e.r||["band",0],i),n=nl(e.g||["band",0],i),r=nl(e.b||["band",0],i);return[t,n,r]}function ed(e,i,t,n){return a.apply(this,arguments)}function a(){return a=(0,Wt.Z)(be().mark(function e(i,t,n,r){var o;return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,Jp(i,t,n);case 2:o=l.sent,r(null,{data:o});case 4:case"end":return l.stop()}},e)})),a.apply(this,arguments)}function s(e,i){return e.map(function(t){return t[i]*1})}function c(e){return e===void 0?!1:!Array.isArray(e)&&e.data!==void 0}function m(e){return Array.isArray(e)?e.length===0?!1:!!c(e[0]):!1}function _(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function S(e,i){var t=i.extent,n=i.width,r=i.height,o=i.min,u=i.max,l=i.format,p=i.operation,v,x,E;if(l===void 0||_(e))v=Array.from(e),x=n,E=r;else{var A=Array.isArray(e)?e:[e];v=Jp(A,l,p)}var T={_id:1,dataArray:[{_id:1,data:v,width:x,height:E,min:o,max:u,coordinates:[[t[0],t[1]],[t[2],t[3]]]}]};return T}var C=ee(81253),P=["extent","min","max","width","height","format","operation"];function D(e,i){var t=i.extent,n=i.min,r=i.max,o=i.width,u=i.height,l=i.format,p=i.operation,v=(0,C.Z)(i,P),x;if(l===void 0||_(e))x=Array.from(e);else{var E=Array.isArray(e)?e:[e];x=Jp(E,l,p)}var A={_id:1,dataArray:[(0,mt.Z)((0,mt.Z)({_id:1,data:x,width:o,height:u},v),{},{min:n,max:r,coordinates:[[t[0],t[1]],[t[2],t[3]]]})]};return A}var j=ee(28660),B=ee(86700),K=ee(84879),V={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},de=ee(31745),ze=ee.n(de);function Ue(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=st(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function st(e,i){if(!!e){if(typeof e=="string")return Ke(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ke(e,i)}}function Ke(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}var St=30;function jt(e){var i=e.characterSet,t=e.getFontWidth,n=e.fontHeight,r=e.buffer,o=e.maxCanvasWidth,u=e.mapping,l=u===void 0?{}:u,p=e.xOffset,v=p===void 0?0:p,x=e.yOffset,E=x===void 0?0:x,A=0,T=v;Array.from(i).forEach(function(F,z){if(!l[F]){var H=t(F,z);T+St>o&&(T=0,A++),l[F]={x:T,y:E+A*St,width:St,height:St,advance:H},T+=St}});var L=n+r*2;return{mapping:l,xOffset:T,yOffset:E+A*L,canvasHeight:Cr(E+(A+1)*L)}}function or(e,i,t){var n=0,r=0,o=0,u=[],l={},p=Ue(e),v;try{for(p.s();!(v=p.n()).done;){var x=v.value;if(!l[x.id]){var E=x.size;n+E+i>t&&(lr(l,u,r),n=0,r=o+r+i,o=0,u=[]),u.push({icon:x,xOffset:n}),n=n+E+i,o=Math.max(o,E)}}}catch(T){p.e(T)}finally{p.f()}u.length>0&&lr(l,u,r);var A=Cr(o+r+i);return{mapping:l,canvasHeight:A}}function lr(e,i,t){var n=Ue(i),r;try{for(n.s();!(r=n.n()).done;){var o=r.value,u=o.icon,l=o.xOffset;e[u.id]=(0,mt.Z)((0,mt.Z)({},u),{},{x:l,y:t,image:u.image,width:u.width,height:u.height})}}catch(p){n.e(p)}finally{n.f()}}function Cr(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Qr,dn;function ti(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Rn(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function Rn(e,i){if(!!e){if(typeof e=="string")return si(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return si(e,i)}}function si(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function On(e){var i=ji();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function ji(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bi=gs(),Kn="sans-serif",na="normal",Bi=24,va=3,ui=.25,Aa=8,ho=1024,Zo=1,So=1,yo=3,Xo=null;function gs(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function cs(e,i,t,n){e.font="".concat(n," ").concat(t,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function Hs(e,i){for(var t=0;t<e.length;t++)i.data[4*t+3]=e[t]}var As=(Qr=(0,B.b2)(),Qr(dn=function(e){(0,Dr.Z)(t,e);var i=On(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"fontAtlas",void 0),(0,W.Z)((0,He.Z)(n),"iconFontMap",void 0),(0,W.Z)((0,He.Z)(n),"iconFontGlyphs",{}),(0,W.Z)((0,He.Z)(n),"fontOptions",void 0),(0,W.Z)((0,He.Z)(n),"key",void 0),(0,W.Z)((0,He.Z)(n),"cache",new ii(yo)),n}return(0,zt.Z)(t,[{key:"scale",get:function(){return So}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Kn,fontWeight:na,characterSet:bi,fontSize:Bi,buffer:va,sdf:!0,cutoff:ui,radius:Aa,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var o=this;r.forEach(function(u){o.iconFontGlyphs[u.name]=u.unicode})}},{key:"addIconFont",value:function(r,o){this.iconFontMap.set(r,o)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=(0,mt.Z)((0,mt.Z)({},this.fontOptions),r),this.key=this.getKey();var o=this.getNewChars(this.key,this.fontOptions.characterSet),u=this.cache.get(this.key);if(!(u&&o.length===0)){var l=this.generateFontAtlas(this.key,o,u);this.fontAtlas=l,this.cache.set(this.key,l)}}},{key:"addFontFace",value:function(r,o){var u=this,l=document.createElement("style");l.type="text/css",l.innerText=`
        @font-face{
            font-family: '`.concat(r,`';
            src: url('`).concat(o,`') format('woff2'),
            url('`).concat(o,`') format('woff'),
            url('`).concat(o,`') format('truetype');
        }`),l.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(r),"L7text"),document.fonts.ready.then(function(){u.emit("fontloaded",{fontFamily:r})})}catch(p){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(p)}},document.getElementsByTagName("head")[0].appendChild(l)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,o,u){var l=this.fontOptions,p=l.fontFamily,v=l.fontWeight,x=l.fontSize,E=l.buffer,A=l.sdf,T=l.radius,L=l.cutoff,F=l.iconfont,z=u&&u.data;z||(z=Xi.document.createElement("canvas"),z.width=ho);var H=z.getContext("2d",{willReadFrequently:!0});cs(H,p,x,v);var ne=jt((0,mt.Z)({getFontWidth:function(es){return H.measureText(es).width},fontHeight:x*So,buffer:E,characterSet:o,maxCanvasWidth:ho},u&&{mapping:u.mapping,xOffset:u.xOffset,yOffset:u.yOffset})),oe=ne.mapping,ke=ne.canvasHeight,De=ne.xOffset,ft=ne.yOffset,At=H.getImageData(0,0,z.width,z.height);if(z.height=ke,H.putImageData(At,0,0),cs(H,p,x,v),A){var Nt=new(ze())(x,E,T,L,p,v),Gt=H.getImageData(0,0,Nt.size,Nt.size),xr=ti(o),dr;try{for(xr.s();!(dr=xr.n()).done;){var zr=dr.value;if(F){var bn=String.fromCharCode(parseInt(zr.replace("&#x","").replace(";",""),16)),Wn=Nt.draw(bn);Hs(Wn,Gt)}else Hs(Nt.draw(zr),Gt);H.putImageData(Gt,oe[zr].x,oe[zr].y)}}catch(ko){xr.e(ko)}finally{xr.f()}}else{var oa=ti(o),Ma;try{for(oa.s();!(Ma=oa.n()).done;){var Co=Ma.value;H.fillText(Co,oe[Co].x,oe[Co].y+x*Zo)}}catch(ko){oa.e(ko)}finally{oa.f()}}return{xOffset:De,yOffset:ft,mapping:oe,data:z,width:z.width,height:z.height}}},{key:"getKey",value:function(){return"key";var r,o,u,l,p,v,x,E}},{key:"getNewChars",value:function(r,o){var u=this.cache.get(r);if(!u)return o;var l=[],p=u.mapping,v=new Set(Object.keys(p)),x=new Set(o);return x.forEach(function(E){v.has(E)||l.push(E)}),l}}]),t}(Er.EventEmitter))||dn),Ws,Uo;function Ts(e){var i=ua();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function ua(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ka=3,Na=1024,la=64,pu=(Ws=(0,B.b2)(),Ws(Uo=function(e){(0,Dr.Z)(t,e);var i=Ts(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"canvasHeight",128),(0,W.Z)((0,He.Z)(n),"texture",void 0),(0,W.Z)((0,He.Z)(n),"canvas",void 0),(0,W.Z)((0,He.Z)(n),"iconData",void 0),(0,W.Z)((0,He.Z)(n),"iconMap",void 0),(0,W.Z)((0,He.Z)(n),"ctx",void 0),(0,W.Z)((0,He.Z)(n),"loadingImageCount",0),n}return(0,zt.Z)(t,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=Xi.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(){var n=(0,Wt.Z)(be().mark(function o(u,l){var p,v;return be().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return p=new Image,this.loadingImageCount++,this.hasImage(u)?console.warn("Image Id already exists"):this.iconData.push({id:u,size:la}),this.updateIconMap(),E.next=6,this.loadImage(l);case 6:p=E.sent,v=this.iconData.find(function(A){return A.id===u}),v&&(v.image=p,v.width=p.width,v.height=p.height),this.update();case 10:case"end":return E.stop()}},o,this)}));function r(o,u){return n.apply(this,arguments)}return r}()},{key:"addImageMini",value:function(r,o,u){var l=this,p=u.getSceneConfig().canvas,v=p.createImage();if(this.loadingImageCount++,this.hasImage(r))throw new Error("Image Id already exists");this.iconData.push({id:r,size:la}),this.updateIconMap(),this.loadImageMini(o,p).then(function(x){v=x;var E=l.iconData.find(function(A){return A.id===r});E&&(E.image=v,E.width=v.width,E.height=v.height),l.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(r){return this.iconMap.hasOwnProperty(r)}},{key:"removeImage",value:function(r){this.hasImage(r)&&(this.iconData=this.iconData.filter(function(o){return o.id!==r}),delete this.iconMap[r],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(r){return new Promise(function(o,u){if(r instanceof HTMLImageElement){o(r);return}var l=new Image;l.crossOrigin="anonymous",l.onload=function(){o(l)},l.onerror=function(){u(new Error("Could not load image at "+r))},l.src=r instanceof File?URL.createObjectURL(r):r})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var r=this;this.canvas.width=Na,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(o){var u=r.iconMap[o],l=u.x,p=u.y,v=u.image,x=u.width,E=x===void 0?64:x,A=u.height,T=A===void 0?64:A,L=Math.max(E,T),F=L/la,z=T/F,H=E/F;v&&r.ctx.drawImage(v,l+(la-H)/2,p+(la-z)/2,H,z)})}},{key:"updateIconMap",value:function(){var r=or(this.iconData,Ka,Na),o=r.mapping,u=r.canvasHeight;this.iconMap=o,this.canvasHeight=u}},{key:"loadImageMini",value:function(r,o){return new Promise(function(u,l){var p=o.createImage();p.crossOrigin="anonymous",p.onload=function(){u(p)},p.onerror=function(){l(new Error("Could not load image at "+r))},p.src=r})}}]),t}(Er.EventEmitter))||Uo),Ki=ee(49685);function Oa(){var e=new Ki.WT(16);return Ki.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Jo(e){var i=new Ki.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Xs(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function ba(e,i,t,n,r,o,u,l,p,v,x,E,A,T,L,F){var z=new Ki.WT(16);return z[0]=e,z[1]=i,z[2]=t,z[3]=n,z[4]=r,z[5]=o,z[6]=u,z[7]=l,z[8]=p,z[9]=v,z[10]=x,z[11]=E,z[12]=A,z[13]=T,z[14]=L,z[15]=F,z}function Ic(e,i,t,n,r,o,u,l,p,v,x,E,A,T,L,F,z){return e[0]=i,e[1]=t,e[2]=n,e[3]=r,e[4]=o,e[5]=u,e[6]=l,e[7]=p,e[8]=v,e[9]=x,e[10]=E,e[11]=A,e[12]=T,e[13]=L,e[14]=F,e[15]=z,e}function Iu(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Pc(e,i){if(e===i){var t=i[1],n=i[2],r=i[3],o=i[6],u=i[7],l=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=t,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=o,e[11]=i[14],e[12]=r,e[13]=u,e[14]=l}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function wo(e,i){var t=i[0],n=i[1],r=i[2],o=i[3],u=i[4],l=i[5],p=i[6],v=i[7],x=i[8],E=i[9],A=i[10],T=i[11],L=i[12],F=i[13],z=i[14],H=i[15],ne=t*l-n*u,oe=t*p-r*u,ke=t*v-o*u,De=n*p-r*l,ft=n*v-o*l,At=r*v-o*p,Nt=x*F-E*L,Gt=x*z-A*L,xr=x*H-T*L,dr=E*z-A*F,zr=E*H-T*F,bn=A*H-T*z,Wn=ne*bn-oe*zr+ke*dr+De*xr-ft*Gt+At*Nt;return Wn?(Wn=1/Wn,e[0]=(l*bn-p*zr+v*dr)*Wn,e[1]=(r*zr-n*bn-o*dr)*Wn,e[2]=(F*At-z*ft+H*De)*Wn,e[3]=(A*ft-E*At-T*De)*Wn,e[4]=(p*xr-u*bn-v*Gt)*Wn,e[5]=(t*bn-r*xr+o*Gt)*Wn,e[6]=(z*ke-L*At-H*oe)*Wn,e[7]=(x*At-A*ke+T*oe)*Wn,e[8]=(u*zr-l*xr+v*Nt)*Wn,e[9]=(n*xr-t*zr-o*Nt)*Wn,e[10]=(L*ft-F*ke+H*ne)*Wn,e[11]=(E*ke-x*ft-T*ne)*Wn,e[12]=(l*Gt-u*dr-p*Nt)*Wn,e[13]=(t*dr-n*Gt+r*Nt)*Wn,e[14]=(F*oe-L*De-z*ne)*Wn,e[15]=(x*De-E*oe+A*ne)*Wn,e):null}function Rc(e,i){var t=i[0],n=i[1],r=i[2],o=i[3],u=i[4],l=i[5],p=i[6],v=i[7],x=i[8],E=i[9],A=i[10],T=i[11],L=i[12],F=i[13],z=i[14],H=i[15];return e[0]=l*(A*H-T*z)-E*(p*H-v*z)+F*(p*T-v*A),e[1]=-(n*(A*H-T*z)-E*(r*H-o*z)+F*(r*T-o*A)),e[2]=n*(p*H-v*z)-l*(r*H-o*z)+F*(r*v-o*p),e[3]=-(n*(p*T-v*A)-l*(r*T-o*A)+E*(r*v-o*p)),e[4]=-(u*(A*H-T*z)-x*(p*H-v*z)+L*(p*T-v*A)),e[5]=t*(A*H-T*z)-x*(r*H-o*z)+L*(r*T-o*A),e[6]=-(t*(p*H-v*z)-u*(r*H-o*z)+L*(r*v-o*p)),e[7]=t*(p*T-v*A)-u*(r*T-o*A)+x*(r*v-o*p),e[8]=u*(E*H-T*F)-x*(l*H-v*F)+L*(l*T-v*E),e[9]=-(t*(E*H-T*F)-x*(n*H-o*F)+L*(n*T-o*E)),e[10]=t*(l*H-v*F)-u*(n*H-o*F)+L*(n*v-o*l),e[11]=-(t*(l*T-v*E)-u*(n*T-o*E)+x*(n*v-o*l)),e[12]=-(u*(E*z-A*F)-x*(l*z-p*F)+L*(l*A-p*E)),e[13]=t*(E*z-A*F)-x*(n*z-r*F)+L*(n*A-r*E),e[14]=-(t*(l*z-p*F)-u*(n*z-r*F)+L*(n*p-r*l)),e[15]=t*(l*A-p*E)-u*(n*A-r*E)+x*(n*p-r*l),e}function Cl(e){var i=e[0],t=e[1],n=e[2],r=e[3],o=e[4],u=e[5],l=e[6],p=e[7],v=e[8],x=e[9],E=e[10],A=e[11],T=e[12],L=e[13],F=e[14],z=e[15],H=i*u-t*o,ne=i*l-n*o,oe=i*p-r*o,ke=t*l-n*u,De=t*p-r*u,ft=n*p-r*l,At=v*L-x*T,Nt=v*F-E*T,Gt=v*z-A*T,xr=x*F-E*L,dr=x*z-A*L,zr=E*z-A*F;return H*zr-ne*dr+oe*xr+ke*Gt-De*Nt+ft*At}function Pu(e,i,t){var n=i[0],r=i[1],o=i[2],u=i[3],l=i[4],p=i[5],v=i[6],x=i[7],E=i[8],A=i[9],T=i[10],L=i[11],F=i[12],z=i[13],H=i[14],ne=i[15],oe=t[0],ke=t[1],De=t[2],ft=t[3];return e[0]=oe*n+ke*l+De*E+ft*F,e[1]=oe*r+ke*p+De*A+ft*z,e[2]=oe*o+ke*v+De*T+ft*H,e[3]=oe*u+ke*x+De*L+ft*ne,oe=t[4],ke=t[5],De=t[6],ft=t[7],e[4]=oe*n+ke*l+De*E+ft*F,e[5]=oe*r+ke*p+De*A+ft*z,e[6]=oe*o+ke*v+De*T+ft*H,e[7]=oe*u+ke*x+De*L+ft*ne,oe=t[8],ke=t[9],De=t[10],ft=t[11],e[8]=oe*n+ke*l+De*E+ft*F,e[9]=oe*r+ke*p+De*A+ft*z,e[10]=oe*o+ke*v+De*T+ft*H,e[11]=oe*u+ke*x+De*L+ft*ne,oe=t[12],ke=t[13],De=t[14],ft=t[15],e[12]=oe*n+ke*l+De*E+ft*F,e[13]=oe*r+ke*p+De*A+ft*z,e[14]=oe*o+ke*v+De*T+ft*H,e[15]=oe*u+ke*x+De*L+ft*ne,e}function tc(e,i,t){var n=t[0],r=t[1],o=t[2],u,l,p,v,x,E,A,T,L,F,z,H;return i===e?(e[12]=i[0]*n+i[4]*r+i[8]*o+i[12],e[13]=i[1]*n+i[5]*r+i[9]*o+i[13],e[14]=i[2]*n+i[6]*r+i[10]*o+i[14],e[15]=i[3]*n+i[7]*r+i[11]*o+i[15]):(u=i[0],l=i[1],p=i[2],v=i[3],x=i[4],E=i[5],A=i[6],T=i[7],L=i[8],F=i[9],z=i[10],H=i[11],e[0]=u,e[1]=l,e[2]=p,e[3]=v,e[4]=x,e[5]=E,e[6]=A,e[7]=T,e[8]=L,e[9]=F,e[10]=z,e[11]=H,e[12]=u*n+x*r+L*o+i[12],e[13]=l*n+E*r+F*o+i[13],e[14]=p*n+A*r+z*o+i[14],e[15]=v*n+T*r+H*o+i[15]),e}function Lc(e,i,t){var n=t[0],r=t[1],o=t[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*o,e[9]=i[9]*o,e[10]=i[10]*o,e[11]=i[11]*o,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function of(e,i,t,n){var r=n[0],o=n[1],u=n[2],l=Math.hypot(r,o,u),p,v,x,E,A,T,L,F,z,H,ne,oe,ke,De,ft,At,Nt,Gt,xr,dr,zr,bn,Wn,oa;return l<Ki.Ib?null:(l=1/l,r*=l,o*=l,u*=l,p=Math.sin(t),v=Math.cos(t),x=1-v,E=i[0],A=i[1],T=i[2],L=i[3],F=i[4],z=i[5],H=i[6],ne=i[7],oe=i[8],ke=i[9],De=i[10],ft=i[11],At=r*r*x+v,Nt=o*r*x+u*p,Gt=u*r*x-o*p,xr=r*o*x-u*p,dr=o*o*x+v,zr=u*o*x+r*p,bn=r*u*x+o*p,Wn=o*u*x-r*p,oa=u*u*x+v,e[0]=E*At+F*Nt+oe*Gt,e[1]=A*At+z*Nt+ke*Gt,e[2]=T*At+H*Nt+De*Gt,e[3]=L*At+ne*Nt+ft*Gt,e[4]=E*xr+F*dr+oe*zr,e[5]=A*xr+z*dr+ke*zr,e[6]=T*xr+H*dr+De*zr,e[7]=L*xr+ne*dr+ft*zr,e[8]=E*bn+F*Wn+oe*oa,e[9]=A*bn+z*Wn+ke*oa,e[10]=T*bn+H*Wn+De*oa,e[11]=L*bn+ne*Wn+ft*oa,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function sf(e,i,t){var n=Math.sin(t),r=Math.cos(t),o=i[4],u=i[5],l=i[6],p=i[7],v=i[8],x=i[9],E=i[10],A=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=o*r+v*n,e[5]=u*r+x*n,e[6]=l*r+E*n,e[7]=p*r+A*n,e[8]=v*r-o*n,e[9]=x*r-u*n,e[10]=E*r-l*n,e[11]=A*r-p*n,e}function Bh(e,i,t){var n=Math.sin(t),r=Math.cos(t),o=i[0],u=i[1],l=i[2],p=i[3],v=i[8],x=i[9],E=i[10],A=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=o*r-v*n,e[1]=u*r-x*n,e[2]=l*r-E*n,e[3]=p*r-A*n,e[8]=o*n+v*r,e[9]=u*n+x*r,e[10]=l*n+E*r,e[11]=p*n+A*r,e}function Bf(e,i,t){var n=Math.sin(t),r=Math.cos(t),o=i[0],u=i[1],l=i[2],p=i[3],v=i[4],x=i[5],E=i[6],A=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=o*r+v*n,e[1]=u*r+x*n,e[2]=l*r+E*n,e[3]=p*r+A*n,e[4]=v*r-o*n,e[5]=x*r-u*n,e[6]=E*r-l*n,e[7]=A*r-p*n,e}function Nh(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function td(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function rd(e,i,t){var n=t[0],r=t[1],o=t[2],u=Math.hypot(n,r,o),l,p,v;return u<Ki.Ib?null:(u=1/u,n*=u,r*=u,o*=u,l=Math.sin(i),p=Math.cos(i),v=1-p,e[0]=n*n*v+p,e[1]=r*n*v+o*l,e[2]=o*n*v-r*l,e[3]=0,e[4]=n*r*v-o*l,e[5]=r*r*v+p,e[6]=o*r*v+n*l,e[7]=0,e[8]=n*o*v+r*l,e[9]=r*o*v-n*l,e[10]=o*o*v+p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function uf(e,i){var t=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=t,e[7]=0,e[8]=0,e[9]=-t,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function gp(e,i){var t=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-t,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=t,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function zh(e,i){var t=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=t,e[2]=0,e[3]=0,e[4]=-t,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function lf(e,i,t){var n=i[0],r=i[1],o=i[2],u=i[3],l=n+n,p=r+r,v=o+o,x=n*l,E=n*p,A=n*v,T=r*p,L=r*v,F=o*v,z=u*l,H=u*p,ne=u*v;return e[0]=1-(T+F),e[1]=E+ne,e[2]=A-H,e[3]=0,e[4]=E-ne,e[5]=1-(x+F),e[6]=L+z,e[7]=0,e[8]=A+H,e[9]=L-z,e[10]=1-(x+T),e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Zh(e,i){var t=new Ki.WT(3),n=-i[0],r=-i[1],o=-i[2],u=i[3],l=i[4],p=i[5],v=i[6],x=i[7],E=n*n+r*r+o*o+u*u;return E>0?(t[0]=(l*u+x*n+p*o-v*r)*2/E,t[1]=(p*u+x*r+v*n-l*o)*2/E,t[2]=(v*u+x*o+l*r-p*n)*2/E):(t[0]=(l*u+x*n+p*o-v*r)*2,t[1]=(p*u+x*r+v*n-l*o)*2,t[2]=(v*u+x*o+l*r-p*n)*2),lf(e,i,t),e}function nd(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function yp(e,i){var t=i[0],n=i[1],r=i[2],o=i[4],u=i[5],l=i[6],p=i[8],v=i[9],x=i[10];return e[0]=Math.hypot(t,n,r),e[1]=Math.hypot(o,u,l),e[2]=Math.hypot(p,v,x),e}function _p(e,i){var t=new Ki.WT(3);yp(t,i);var n=1/t[0],r=1/t[1],o=1/t[2],u=i[0]*n,l=i[1]*r,p=i[2]*o,v=i[4]*n,x=i[5]*r,E=i[6]*o,A=i[8]*n,T=i[9]*r,L=i[10]*o,F=u+x+L,z=0;return F>0?(z=Math.sqrt(F+1)*2,e[3]=.25*z,e[0]=(E-T)/z,e[1]=(A-p)/z,e[2]=(l-v)/z):u>x&&u>L?(z=Math.sqrt(1+u-x-L)*2,e[3]=(E-T)/z,e[0]=.25*z,e[1]=(l+v)/z,e[2]=(A+p)/z):x>L?(z=Math.sqrt(1+x-u-L)*2,e[3]=(A-p)/z,e[0]=(l+v)/z,e[1]=.25*z,e[2]=(E+T)/z):(z=Math.sqrt(1+L-u-x)*2,e[3]=(l-v)/z,e[0]=(A+p)/z,e[1]=(E+T)/z,e[2]=.25*z),e}function xp(e,i,t,n){var r=i[0],o=i[1],u=i[2],l=i[3],p=r+r,v=o+o,x=u+u,E=r*p,A=r*v,T=r*x,L=o*v,F=o*x,z=u*x,H=l*p,ne=l*v,oe=l*x,ke=n[0],De=n[1],ft=n[2];return e[0]=(1-(L+z))*ke,e[1]=(A+oe)*ke,e[2]=(T-ne)*ke,e[3]=0,e[4]=(A-oe)*De,e[5]=(1-(E+z))*De,e[6]=(F+H)*De,e[7]=0,e[8]=(T+ne)*ft,e[9]=(F-H)*ft,e[10]=(1-(E+L))*ft,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function id(e,i,t,n,r){var o=i[0],u=i[1],l=i[2],p=i[3],v=o+o,x=u+u,E=l+l,A=o*v,T=o*x,L=o*E,F=u*x,z=u*E,H=l*E,ne=p*v,oe=p*x,ke=p*E,De=n[0],ft=n[1],At=n[2],Nt=r[0],Gt=r[1],xr=r[2],dr=(1-(F+H))*De,zr=(T+ke)*De,bn=(L-oe)*De,Wn=(T-ke)*ft,oa=(1-(A+H))*ft,Ma=(z+ne)*ft,Co=(L+oe)*At,ko=(z-ne)*At,es=(1-(A+F))*At;return e[0]=dr,e[1]=zr,e[2]=bn,e[3]=0,e[4]=Wn,e[5]=oa,e[6]=Ma,e[7]=0,e[8]=Co,e[9]=ko,e[10]=es,e[11]=0,e[12]=t[0]+Nt-(dr*Nt+Wn*Gt+Co*xr),e[13]=t[1]+Gt-(zr*Nt+oa*Gt+ko*xr),e[14]=t[2]+xr-(bn*Nt+Ma*Gt+es*xr),e[15]=1,e}function bp(e,i){var t=i[0],n=i[1],r=i[2],o=i[3],u=t+t,l=n+n,p=r+r,v=t*u,x=n*u,E=n*l,A=r*u,T=r*l,L=r*p,F=o*u,z=o*l,H=o*p;return e[0]=1-E-L,e[1]=x+H,e[2]=A-z,e[3]=0,e[4]=x-H,e[5]=1-v-L,e[6]=T+F,e[7]=0,e[8]=A+z,e[9]=T-F,e[10]=1-v-E,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ep(e,i,t,n,r,o,u){var l=1/(t-i),p=1/(r-n),v=1/(o-u);return e[0]=o*2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o*2*p,e[6]=0,e[7]=0,e[8]=(t+i)*l,e[9]=(r+n)*p,e[10]=(u+o)*v,e[11]=-1,e[12]=0,e[13]=0,e[14]=u*o*2*v,e[15]=0,e}function Uh(e,i,t,n,r){var o=1/Math.tan(i/2),u;return e[0]=o/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==Infinity?(u=1/(n-r),e[10]=(r+n)*u,e[14]=2*r*n*u):(e[10]=-1,e[14]=-2*n),e}var Sp=Uh;function Vh(e,i,t,n,r){var o=1/Math.tan(i/2),u;return e[0]=o/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==Infinity?(u=1/(n-r),e[10]=r*u,e[14]=r*n*u):(e[10]=-1,e[14]=-n),e}function ad(e,i,t,n){var r=Math.tan(i.upDegrees*Math.PI/180),o=Math.tan(i.downDegrees*Math.PI/180),u=Math.tan(i.leftDegrees*Math.PI/180),l=Math.tan(i.rightDegrees*Math.PI/180),p=2/(u+l),v=2/(r+o);return e[0]=p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=v,e[6]=0,e[7]=0,e[8]=-((u-l)*p*.5),e[9]=(r-o)*v*.5,e[10]=n/(t-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*t/(t-n),e[15]=0,e}function fh(e,i,t,n,r,o,u){var l=1/(i-t),p=1/(n-r),v=1/(o-u);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*v,e[11]=0,e[12]=(i+t)*l,e[13]=(r+n)*p,e[14]=(u+o)*v,e[15]=1,e}var wp=fh;function hh(e,i,t,n,r,o,u){var l=1/(i-t),p=1/(n-r),v=1/(o-u);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=v,e[11]=0,e[12]=(i+t)*l,e[13]=(r+n)*p,e[14]=o*v,e[15]=1,e}function Cp(e,i,t,n){var r,o,u,l,p,v,x,E,A,T,L=i[0],F=i[1],z=i[2],H=n[0],ne=n[1],oe=n[2],ke=t[0],De=t[1],ft=t[2];return Math.abs(L-ke)<Ki.Ib&&Math.abs(F-De)<Ki.Ib&&Math.abs(z-ft)<Ki.Ib?Iu(e):(x=L-ke,E=F-De,A=z-ft,T=1/Math.hypot(x,E,A),x*=T,E*=T,A*=T,r=ne*A-oe*E,o=oe*x-H*A,u=H*E-ne*x,T=Math.hypot(r,o,u),T?(T=1/T,r*=T,o*=T,u*=T):(r=0,o=0,u=0),l=E*u-A*o,p=A*r-x*u,v=x*o-E*r,T=Math.hypot(l,p,v),T?(T=1/T,l*=T,p*=T,v*=T):(l=0,p=0,v=0),e[0]=r,e[1]=l,e[2]=x,e[3]=0,e[4]=o,e[5]=p,e[6]=E,e[7]=0,e[8]=u,e[9]=v,e[10]=A,e[11]=0,e[12]=-(r*L+o*F+u*z),e[13]=-(l*L+p*F+v*z),e[14]=-(x*L+E*F+A*z),e[15]=1,e)}function jh(e,i,t,n){var r=i[0],o=i[1],u=i[2],l=n[0],p=n[1],v=n[2],x=r-t[0],E=o-t[1],A=u-t[2],T=x*x+E*E+A*A;T>0&&(T=1/Math.sqrt(T),x*=T,E*=T,A*=T);var L=p*A-v*E,F=v*x-l*A,z=l*E-p*x;return T=L*L+F*F+z*z,T>0&&(T=1/Math.sqrt(T),L*=T,F*=T,z*=T),e[0]=L,e[1]=F,e[2]=z,e[3]=0,e[4]=E*z-A*F,e[5]=A*L-x*z,e[6]=x*F-E*L,e[7]=0,e[8]=x,e[9]=E,e[10]=A,e[11]=0,e[12]=r,e[13]=o,e[14]=u,e[15]=1,e}function jd(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Vv(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Gd(e,i,t){return e[0]=i[0]+t[0],e[1]=i[1]+t[1],e[2]=i[2]+t[2],e[3]=i[3]+t[3],e[4]=i[4]+t[4],e[5]=i[5]+t[5],e[6]=i[6]+t[6],e[7]=i[7]+t[7],e[8]=i[8]+t[8],e[9]=i[9]+t[9],e[10]=i[10]+t[10],e[11]=i[11]+t[11],e[12]=i[12]+t[12],e[13]=i[13]+t[13],e[14]=i[14]+t[14],e[15]=i[15]+t[15],e}function Hd(e,i,t){return e[0]=i[0]-t[0],e[1]=i[1]-t[1],e[2]=i[2]-t[2],e[3]=i[3]-t[3],e[4]=i[4]-t[4],e[5]=i[5]-t[5],e[6]=i[6]-t[6],e[7]=i[7]-t[7],e[8]=i[8]-t[8],e[9]=i[9]-t[9],e[10]=i[10]-t[10],e[11]=i[11]-t[11],e[12]=i[12]-t[12],e[13]=i[13]-t[13],e[14]=i[14]-t[14],e[15]=i[15]-t[15],e}function Wd(e,i,t){return e[0]=i[0]*t,e[1]=i[1]*t,e[2]=i[2]*t,e[3]=i[3]*t,e[4]=i[4]*t,e[5]=i[5]*t,e[6]=i[6]*t,e[7]=i[7]*t,e[8]=i[8]*t,e[9]=i[9]*t,e[10]=i[10]*t,e[11]=i[11]*t,e[12]=i[12]*t,e[13]=i[13]*t,e[14]=i[14]*t,e[15]=i[15]*t,e}function q0(e,i,t,n){return e[0]=i[0]+t[0]*n,e[1]=i[1]+t[1]*n,e[2]=i[2]+t[2]*n,e[3]=i[3]+t[3]*n,e[4]=i[4]+t[4]*n,e[5]=i[5]+t[5]*n,e[6]=i[6]+t[6]*n,e[7]=i[7]+t[7]*n,e[8]=i[8]+t[8]*n,e[9]=i[9]+t[9]*n,e[10]=i[10]+t[10]*n,e[11]=i[11]+t[11]*n,e[12]=i[12]+t[12]*n,e[13]=i[13]+t[13]*n,e[14]=i[14]+t[14]*n,e[15]=i[15]+t[15]*n,e}function Ap(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function Mo(e,i){var t=e[0],n=e[1],r=e[2],o=e[3],u=e[4],l=e[5],p=e[6],v=e[7],x=e[8],E=e[9],A=e[10],T=e[11],L=e[12],F=e[13],z=e[14],H=e[15],ne=i[0],oe=i[1],ke=i[2],De=i[3],ft=i[4],At=i[5],Nt=i[6],Gt=i[7],xr=i[8],dr=i[9],zr=i[10],bn=i[11],Wn=i[12],oa=i[13],Ma=i[14],Co=i[15];return Math.abs(t-ne)<=Ki.Ib*Math.max(1,Math.abs(t),Math.abs(ne))&&Math.abs(n-oe)<=Ki.Ib*Math.max(1,Math.abs(n),Math.abs(oe))&&Math.abs(r-ke)<=Ki.Ib*Math.max(1,Math.abs(r),Math.abs(ke))&&Math.abs(o-De)<=Ki.Ib*Math.max(1,Math.abs(o),Math.abs(De))&&Math.abs(u-ft)<=Ki.Ib*Math.max(1,Math.abs(u),Math.abs(ft))&&Math.abs(l-At)<=Ki.Ib*Math.max(1,Math.abs(l),Math.abs(At))&&Math.abs(p-Nt)<=Ki.Ib*Math.max(1,Math.abs(p),Math.abs(Nt))&&Math.abs(v-Gt)<=Ki.Ib*Math.max(1,Math.abs(v),Math.abs(Gt))&&Math.abs(x-xr)<=Ki.Ib*Math.max(1,Math.abs(x),Math.abs(xr))&&Math.abs(E-dr)<=Ki.Ib*Math.max(1,Math.abs(E),Math.abs(dr))&&Math.abs(A-zr)<=Ki.Ib*Math.max(1,Math.abs(A),Math.abs(zr))&&Math.abs(T-bn)<=Ki.Ib*Math.max(1,Math.abs(T),Math.abs(bn))&&Math.abs(L-Wn)<=Ki.Ib*Math.max(1,Math.abs(L),Math.abs(Wn))&&Math.abs(F-oa)<=Ki.Ib*Math.max(1,Math.abs(F),Math.abs(oa))&&Math.abs(z-Ma)<=Ki.Ib*Math.max(1,Math.abs(z),Math.abs(Ma))&&Math.abs(H-Co)<=Ki.Ib*Math.max(1,Math.abs(H),Math.abs(Co))}var rc=Pu,K0=Hd,cf,od,jv=(cf=(0,B.b2)(),cf(od=function(){function e(){(0,wt.Z)(this,e),(0,W.Z)(this,"viewport",void 0),(0,W.Z)(this,"overridedViewProjectionMatrix",void 0),(0,W.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,W.Z)(this,"jitteredProjectionMatrix",void 0),(0,W.Z)(this,"viewMatrixInverse",void 0),(0,W.Z)(this,"cameraPosition",void 0)}return(0,zt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=Oa(),wo(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),n=(0,$n.Z)(t,2),r=n[0],o=n[1];return[r,o]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,n){var r=Nh(Oa(),[t,n,0]);this.jitteredProjectionMatrix=Pu(Oa(),r,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Pu(Oa(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||od),Al;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom"})(Al||(Al={}));var nc,Tp;function Mp(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=sd(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function sd(e,i){if(!!e){if(typeof e=="string")return kp(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return kp(e,i)}}function kp(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}var Xd={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},Gv=(nc=(0,B.b2)(),nc(Tp=function(){function e(){(0,wt.Z)(this,e),(0,W.Z)(this,"container",void 0),(0,W.Z)(this,"controlCorners",void 0),(0,W.Z)(this,"controlContainer",void 0),(0,W.Z)(this,"scene",void 0),(0,W.Z)(this,"mapsService",void 0),(0,W.Z)(this,"controls",[]),(0,W.Z)(this,"unAddControls",[])}return(0,zt.Z)(e,[{key:"init",value:function(t,n){this.container=t.container,this.scene=n,this.mapsService=n.get(V.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,n){var r=n.get(V.IMapService);r.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find(function(n){return n.controlOption.name===t})}},{key:"removeControl",value:function(t){var n=this.controls.indexOf(t);return n>-1&&this.controls.splice(n,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach(function(n){n.addTo(t.scene),t.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var t=Mp(this.controls),n;try{for(t.s();!(n=t.n()).done;){var r=n.value;r.remove()}}catch(o){t.e(o)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},n="l7-",r=this.controlContainer=ri("div",n+"control-container",this.container);function o(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],p=l.map(function(v){return n+v}).join(" ");t[l.filter(function(v){return!["row","column"].includes(v)}).join("")]=ri("div",p,r)}function u(l){var p=l.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat((0,cr.Z)(p),[Xd[l]])}Object.values(Al).forEach(function(l){o(u(l))})}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&no(this.controlCorners[t]);this.controlContainer&&no(this.controlContainer)}}]),e}())||Tp),Gh,$d,Hv=(Gh=(0,B.b2)(),Gh($d=function(){function e(){(0,wt.Z)(this,e),(0,W.Z)(this,"container",void 0),(0,W.Z)(this,"scene",void 0),(0,W.Z)(this,"mapsService",void 0),(0,W.Z)(this,"markers",[]),(0,W.Z)(this,"markerLayers",[]),(0,W.Z)(this,"unAddMarkers",[]),(0,W.Z)(this,"unAddMarkerLayers",[])}return(0,zt.Z)(e,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var n=this.markerLayers.indexOf(t);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach(function(n){n.addTo(t.scene),t.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach(function(n){t.markerLayers.push(n),n.addTo(t.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var n=this.markers.indexOf(t);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(V.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(t){t.remove()}),this.markers=[],this.markerLayers.forEach(function(t){t.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),e}())||$d),Yd,qd,Wv=(Yd=(0,B.b2)(),Yd(qd=function(){function e(){(0,wt.Z)(this,e),(0,W.Z)(this,"scene",void 0),(0,W.Z)(this,"mapsService",void 0),(0,W.Z)(this,"popups",[]),(0,W.Z)(this,"unAddPopups",[])}return(0,zt.Z)(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(t){t!=null&&t.isOpen()&&t.remove();var n=this.popups.indexOf(t);n>-1&&this.popups.splice(n,1);var r=this.unAddPopups.indexOf(t);r>-1&&this.unAddPopups.splice(r,1)}},{key:"destroy",value:function(){this.popups.forEach(function(t){return t.remove()})}},{key:"addPopup",value:function(t){var n=this;t&&t.getOptions().autoClose&&[].concat((0,cr.Z)(this.popups),(0,cr.Z)(this.unAddPopups)).forEach(function(r){r.getOptions().autoClose&&n.removePopup(r)}),this.isMarkerReady?(t.addTo(this.scene),this.popups.push(t)):this.unAddPopups.push(t),t.on("close",function(){n.removePopup(t)})}},{key:"initPopup",value:function(){var t=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(n){t.addPopup(n),t.unAddPopups=[]})}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(V.IMapService)}}]),e}())||qd),Vu={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo \u6D4B\u8BD5 Token, \u751F\u4EA7\u73AF\u5883\u52A1\u5FC5\u81EA\u884C\u6CE8\u518C Token \u786E\u4FDD\u670D\u52A1\u7A33\u5B9A",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},ud=Vu,Kd,ic,Q0={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,isMini:!1,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Xv={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},ph=(Kd=(0,B.b2)(),Kd(ic=function(){function e(){(0,wt.Z)(this,e),(0,W.Z)(this,"sceneConfigCache",{}),(0,W.Z)(this,"layerConfigCache",{}),(0,W.Z)(this,"layerAttributeConfigCache",{})}return(0,zt.Z)(e,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return ud[t]}},{key:"setSceneConfig",value:function(t,n){this.sceneConfigCache[t]=(0,mt.Z)((0,mt.Z)({},Q0),n)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,n,r){this.layerConfigCache[n]=(0,mt.Z)({},(0,ur.merge)({},this.sceneConfigCache[t],Xv,r))}},{key:"getAttributeConfig",value:function(t){return this.layerAttributeConfigCache[t]}},{key:"setAttributeConfig",value:function(t,n){this.layerAttributeConfigCache[t]=(0,mt.Z)((0,mt.Z)({},this.layerAttributeConfigCache[t]),n)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||ic);function ia(e,i,t,n){!t||Object.defineProperty(e,i,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(n):void 0})}function Qi(e,i,t,n,r){var o={};return Object.keys(n).forEach(function(u){o[u]=n[u]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=t.slice().reverse().reduce(function(u,l){return l(e,i,u)||u},o),r&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(e,i,o),o=null),o}function dh(){var e=new Ki.WT(4);return Ki.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Ip(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function $v(e,i,t,n){var r=new Ki.WT(4);return r[0]=e,r[1]=i,r[2]=t,r[3]=n,r}function J0(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function em(e,i,t,n,r){return e[0]=i,e[1]=t,e[2]=n,e[3]=r,e}function tm(e,i,t){return e[0]=i[0]+t[0],e[1]=i[1]+t[1],e[2]=i[2]+t[2],e[3]=i[3]+t[3],e}function Yv(e,i,t){return e[0]=i[0]-t[0],e[1]=i[1]-t[1],e[2]=i[2]-t[2],e[3]=i[3]-t[3],e}function qv(e,i,t){return e[0]=i[0]*t[0],e[1]=i[1]*t[1],e[2]=i[2]*t[2],e[3]=i[3]*t[3],e}function Nf(e,i,t){return e[0]=i[0]/t[0],e[1]=i[1]/t[1],e[2]=i[2]/t[2],e[3]=i[3]/t[3],e}function rm(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function Kv(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function Qv(e,i,t){return e[0]=Math.min(i[0],t[0]),e[1]=Math.min(i[1],t[1]),e[2]=Math.min(i[2],t[2]),e[3]=Math.min(i[3],t[3]),e}function nm(e,i,t){return e[0]=Math.max(i[0],t[0]),e[1]=Math.max(i[1],t[1]),e[2]=Math.max(i[2],t[2]),e[3]=Math.max(i[3],t[3]),e}function Jv(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function e0(e,i,t){return e[0]=i[0]*t,e[1]=i[1]*t,e[2]=i[2]*t,e[3]=i[3]*t,e}function im(e,i,t,n){return e[0]=i[0]+t[0]*n,e[1]=i[1]+t[1]*n,e[2]=i[2]+t[2]*n,e[3]=i[3]+t[3]*n,e}function t0(e,i){var t=i[0]-e[0],n=i[1]-e[1],r=i[2]-e[2],o=i[3]-e[3];return Math.hypot(t,n,r,o)}function am(e,i){var t=i[0]-e[0],n=i[1]-e[1],r=i[2]-e[2],o=i[3]-e[3];return t*t+n*n+r*r+o*o}function ld(e){var i=e[0],t=e[1],n=e[2],r=e[3];return Math.hypot(i,t,n,r)}function om(e){var i=e[0],t=e[1],n=e[2],r=e[3];return i*i+t*t+n*n+r*r}function Qd(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function Tg(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function sm(e,i){var t=i[0],n=i[1],r=i[2],o=i[3],u=t*t+n*n+r*r+o*o;return u>0&&(u=1/Math.sqrt(u)),e[0]=t*u,e[1]=n*u,e[2]=r*u,e[3]=o*u,e}function Mg(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function kg(e,i,t,n){var r=t[0]*n[1]-t[1]*n[0],o=t[0]*n[2]-t[2]*n[0],u=t[0]*n[3]-t[3]*n[0],l=t[1]*n[2]-t[2]*n[1],p=t[1]*n[3]-t[3]*n[1],v=t[2]*n[3]-t[3]*n[2],x=i[0],E=i[1],A=i[2],T=i[3];return e[0]=E*v-A*p+T*l,e[1]=-(x*v)+A*u-T*o,e[2]=x*p-E*u+T*r,e[3]=-(x*l)+E*o-A*r,e}function Ig(e,i,t,n){var r=i[0],o=i[1],u=i[2],l=i[3];return e[0]=r+n*(t[0]-r),e[1]=o+n*(t[1]-o),e[2]=u+n*(t[2]-u),e[3]=l+n*(t[3]-l),e}function Pg(e,i){i=i||1;var t,n,r,o,u,l;do t=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,u=t*t+n*n;while(u>=1);do r=glMatrix.RANDOM()*2-1,o=glMatrix.RANDOM()*2-1,l=r*r+o*o;while(l>=1);var p=Math.sqrt((1-u)/l);return e[0]=i*t,e[1]=i*n,e[2]=i*r*p,e[3]=i*o*p,e}function Jd(e,i,t){var n=i[0],r=i[1],o=i[2],u=i[3];return e[0]=t[0]*n+t[4]*r+t[8]*o+t[12]*u,e[1]=t[1]*n+t[5]*r+t[9]*o+t[13]*u,e[2]=t[2]*n+t[6]*r+t[10]*o+t[14]*u,e[3]=t[3]*n+t[7]*r+t[11]*o+t[15]*u,e}function Rg(e,i,t){var n=i[0],r=i[1],o=i[2],u=t[0],l=t[1],p=t[2],v=t[3],x=v*n+l*o-p*r,E=v*r+p*n-u*o,A=v*o+u*r-l*n,T=-u*n-l*r-p*o;return e[0]=x*v+T*-u+E*-p-A*-l,e[1]=E*v+T*-l+A*-u-x*-p,e[2]=A*v+T*-p+x*-l-E*-u,e[3]=i[3],e}function Lg(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Og(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function ff(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function ev(e,i){var t=e[0],n=e[1],r=e[2],o=e[3],u=i[0],l=i[1],p=i[2],v=i[3];return Math.abs(t-u)<=glMatrix.EPSILON*Math.max(1,Math.abs(t),Math.abs(u))&&Math.abs(n-l)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(o-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))}var um=null,cd=null,lm=null,b8=null,E8=null,S8=null,w8=null,C8=function(){var e=dh();return function(i,t,n,r,o,u){var l,p;for(t||(t=4),n||(n=0),r?p=Math.min(r*t+n,i.length):p=i.length,l=n;l<p;l+=t)e[0]=i[l],e[1]=i[l+1],e[2]=i[l+2],e[3]=i[l+3],o(e,e,u),i[l]=e[0],i[l+1]=e[1],i[l+2]=e[2],i[l+3]=e[3];return i}}(),cm=Math.PI/180,_E=512,Fg=4003e4;function Dg(e){var i=e.latitude,t=i===void 0?0:i,n=e.zoom,r=n===void 0?0:n,o=e.scale,u=e.highPrecision,l=u===void 0?!1:u,p=e.flipY,v=p===void 0?!1:p;o=o!==void 0?o:Math.pow(2,r);var x={},E=_E*o,A=Math.cos(t*cm),T=E/360,L=T/A,F=E/Fg/A;if(x.pixelsPerMeter=[F,-F,F],x.metersPerPixel=[1/F,-1/F,1/F],x.pixelsPerDegree=[T,-L,F],x.degreesPerPixel=[1/T,-1/L,1/F],l){var z=cm*Math.tan(t*cm)/A,H=T*z/2,ne=E/Fg*z,oe=ne/L*F;x.pixelsPerDegree2=[0,-H,ne],x.pixelsPerMeter2=[oe,0,oe],v&&(x.pixelsPerDegree2[1]=-x.pixelsPerDegree2[1],x.pixelsPerMeter2[1]=-x.pixelsPerMeter2[1])}return v&&(x.pixelsPerMeter[1]=-x.pixelsPerMeter[1],x.metersPerPixel[1]=-x.metersPerPixel[1],x.pixelsPerDegree[1]=-x.pixelsPerDegree[1],x.degreesPerPixel[1]=-x.degreesPerPixel[1]),x}var Hh;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Hh||(Hh={}));var Pp={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Bg,Ng,zg,fm,Zg,xE=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],bE=(Bg=(0,B.b2)(),Ng=(0,B.f3)(V.ICameraService),Bg(zg=(fm=function(){function e(){(0,wt.Z)(this,e),(0,W.Z)(this,"needRefresh",!0),ia(this,"cameraService",Zg,this),(0,W.Z)(this,"coordinateSystem",void 0),(0,W.Z)(this,"viewportCenter",void 0),(0,W.Z)(this,"viewportCenterProjection",void 0),(0,W.Z)(this,"pixelsPerDegree",void 0),(0,W.Z)(this,"pixelsPerDegree2",void 0),(0,W.Z)(this,"pixelsPerMeter",void 0)}return(0,zt.Z)(e,[{key:"refresh",value:function(t){var n=this.cameraService.getZoom(),r=this.cameraService.getZoomScale(),o=t||this.cameraService.getCenter(),u=Dg({latitude:o[1],zoom:n}),l=u.pixelsPerMeter,p=u.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=l,this.pixelsPerDegree=p,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Hh.LNGLAT||this.coordinateSystem===Hh.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Hh.LNGLAT_OFFSET?this.calculateLnglatOffset(o,n):this.coordinateSystem===Hh.P20_OFFSET&&this.calculateLnglatOffset(o,n,r,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,n,r,o){var u=Dg({latitude:t[1],zoom:n,scale:r,flipY:o,highPrecision:!0}),l=u.pixelsPerMeter,p=u.pixelsPerDegree,v=u.pixelsPerDegree2,x=this.cameraService.getViewMatrix(),E=this.cameraService.getProjectionMatrix(),A=Pu([],E,x),T=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,n));this.viewportCenterProjection=Jd([],[T[0],T[1],0,1],A),x=this.cameraService.getViewMatrixUncentered()||x,A=Pu([],E,x),A=Pu([],A,xE),this.cameraService.setViewProjectionMatrix(A),this.pixelsPerMeter=l,this.pixelsPerDegree=p,this.pixelsPerDegree2=v}}]),e}(),Zg=Qi(fm.prototype,"cameraService",[Ng],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fm))||zg),EE=ee(20396),tv=ee.n(EE),Ru;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(Ru||(Ru={}));var Ug,Vg,jg,hm,Gg;function SE(e){var i=wE();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function wE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CE={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},AE=(Ug=(0,B.b2)(),Vg=(0,B.f3)(V.IMapService),Ug(jg=(hm=function(e){(0,Dr.Z)(t,e);var i=SE(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"indragging",!1),ia((0,He.Z)(n),"mapService",Gg,(0,He.Z)(n)),(0,W.Z)((0,He.Z)(n),"hammertime",void 0),(0,W.Z)((0,He.Z)(n),"lastClickTime",0),(0,W.Z)((0,He.Z)(n),"lastClickXY",[-1,-1]),(0,W.Z)((0,He.Z)(n),"clickTimer",void 0),(0,W.Z)((0,He.Z)(n),"$containter",void 0),(0,W.Z)((0,He.Z)(n),"onDrag",function(l){var p=n.interactionEvent(l);p.type=CE[p.type],p.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(Ru.Drag,p)}),(0,W.Z)((0,He.Z)(n),"onHammer",function(l){l.srcEvent.stopPropagation();var p=n.interactionEvent(l);n.emit(Ru.Hover,p)}),(0,W.Z)((0,He.Z)(n),"onTouch",function(l){var p=l.touches[0];n.onHover({x:p.pageX,y:p.pageY,type:"touch"})}),(0,W.Z)((0,He.Z)(n),"onHover",function(l){var p=l.clientX,v=l.clientY,x=p,E=v,A=l.type,T=n.mapService.getMapContainer();if(T)if(jo)x=x-T.left-0,E=E-T.top-0;else{var L=T.getBoundingClientRect(),F=L.top,z=L.left;x=x-z-T.clientLeft,E=E-F-T.clientTop}var H=n.mapService.containerToLngLat([x,E]);if(A==="click"){if(!jo&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(x,E,H);return}if(A==="touch"){n.isDoubleTap(x,E,H);return}A!=="click"&&A!=="dblclick"&&n.emit(Ru.Hover,{x,y:E,lngLat:H,type:A,target:l})}),n}return(0,zt.Z)(t,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Ru.Hover)}},{key:"triggerHover",value:function(r){var o=r.x,u=r.y;this.emit(Ru.Hover,{x:o,y:u})}},{key:"triggerSelect",value:function(r){this.emit(Ru.Select,{featureId:r})}},{key:"triggerActive",value:function(r){this.emit(Ru.Active,{featureId:r})}},{key:"handleMiniEvent",value:function(r){this.onHover({clientX:r.touches[0].pageX,clientY:r.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var r=this.mapService.getMapContainer();if(r)if(jo)Xi.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var o=new(tv()).Manager(r);o.add(new(tv()).Tap({event:"dblclick",taps:2})),o.add(new(tv()).Tap({event:"click"})),o.add(new(tv()).Pan({threshold:0,pointers:0})),o.add(new(tv()).Press({})),o.on("dblclick click",this.onHammer),o.on("panstart panmove panend pancancel",this.onDrag),r.addEventListener("mousemove",this.onHover),r.addEventListener("mousedown",this.onHover,!0),r.addEventListener("mouseup",this.onHover),r.addEventListener("contextmenu",this.onHover),this.hammertime=o}}},{key:"removeEventListenerOnMap",value:function(){if(jo)Xi.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var r=this.mapService.getMapContainer();r&&(r.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),r.removeEventListener("mousedown",this.onHover),r.removeEventListener("mouseup",this.onHover),r.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(r){var o=r.type,u=r.pointerType,l,p;u==="touch"?(p=Math.floor(r.pointers[0].clientY),l=Math.floor(r.pointers[0].clientX)):(p=Math.floor(r.srcEvent.y),l=Math.floor(r.srcEvent.x));var v=this.mapService.getMapContainer();if(v){var x=v.getBoundingClientRect(),E=x.top,A=x.left;l-=A,p-=E}var T=this.mapService.containerToLngLat([l,p]);return{x:l,y:p,lngLat:T,type:o,target:r.srcEvent}}},{key:"isDoubleTap",value:function(r,o,u){var l=this,p=new Date().getTime(),v="click";p-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-r)<10&&Math.abs(this.lastClickXY[1]-o)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),v="dblclick",this.emit(Ru.Hover,{x:r,y:o,lngLat:u,type:v})):(this.lastClickTime=p,this.lastClickXY=[r,o],this.clickTimer=setTimeout(function(){v="click",l.emit(Ru.Hover,{x:r,y:o,lngLat:u,type:v})},400))}}]),t}(Jr()),Gg=Qi(hm.prototype,"mapService",[Vg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hm))||jg),TE=0;function ME(e){if(jo)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var t=document.createElement("div");return t.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,t.id="l7-scene-".concat(TE++),t.classList.add("l7-scene"),i.appendChild(t),t}return null}function kE(e){var i,t,n=!0;return e==null||(i=e.target)===null||i===void 0||(t=i.path)===null||t===void 0||t.map(function(r){if(r!=null&&r.classList){var o;r==null||(o=r.classList)===null||o===void 0||o.forEach(function(u){(u==="l7-marker"||u==="l7-popup")&&(n=!1)})}}),n}var $;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})($||($={}));var Hg,Wg,Xg,$g,Yg,qg,Kg,Rp,Qg,Jg,ey,ty,ry,IE=(Hg=(0,B.b2)(),Wg=(0,B.f3)(V.IMapService),Xg=(0,B.f3)(V.IRendererService),$g=(0,B.f3)(V.IGlobalConfigService),Yg=(0,B.f3)(V.IInteractionService),qg=(0,B.f3)(V.ILayerService),Hg(Kg=(Rp=function(){function e(){var i=this;(0,wt.Z)(this,e),(0,W.Z)(this,"pickedColors",void 0),(0,W.Z)(this,"pickedTileLayers",[]),ia(this,"mapService",Qg,this),ia(this,"rendererService",Jg,this),ia(this,"configService",ey,this),ia(this,"interactionService",ty,this),ia(this,"layerService",ry,this),(0,W.Z)(this,"pickingFBO",void 0),(0,W.Z)(this,"width",0),(0,W.Z)(this,"height",0),(0,W.Z)(this,"alreadyInPicking",!1),(0,W.Z)(this,"pickBufferScale",1),(0,W.Z)(this,"pickFromPickingFBO",function(t,n){var r=n.x,o=n.y,u=n.lngLat,l=n.type,p=n.target,v=!1,x=i.rendererService,E=x.readPixels,A=x.getContainer,T=i.getContainerSize(A()),L=T.width,F=T.height;L*=Ra,F*=Ra;var z=t.getLayerConfig(),H=z.enableHighlight,ne=z.enableSelect,oe=r*Ra,ke=o*Ra;if(oe>L-1*Ra||oe<0||ke>F-1*Ra||ke<0)return!1;var De=E({x:Math.floor(oe/i.pickBufferScale),y:Math.floor((F-(o+1)*Ra)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO});if(i.pickedColors=De,De[0]!==0||De[1]!==0||De[2]!==0){var ft=li(De),At=t.layerPickService.getFeatureById(ft);ft!==t.getCurrentPickId()&&l==="mousemove"&&(l="mouseenter");var Nt={x:r,y:o,type:l,lngLat:u,featureId:ft,feature:At,target:p};At&&(v=!0,t.setCurrentPickId(ft),i.triggerHoverOnLayer(t,Nt))}else{var Gt={x:r,y:o,lngLat:u,type:t.getCurrentPickId()!==null&&l==="mousemove"?"mouseout":"un"+l,featureId:null,target:p,feature:null};i.triggerHoverOnLayer(t,(0,mt.Z)((0,mt.Z)({},Gt),{},{type:"unpick"})),i.triggerHoverOnLayer(t,Gt),t.setCurrentPickId(null)}if(H&&t.layerPickService.highlightPickedFeature(De),ne&&l==="click"&&(De==null?void 0:De.toString())!==[0,0,0,0].toString()){var xr=li(De);t.getCurrentSelectedId()===null||xr!==t.getCurrentSelectedId()?(t.layerPickService.selectFeature(De),t.setCurrentSelectedId(xr)):(t.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null))}return v})}return(0,zt.Z)(e,[{key:"init",value:function(t){var n=this.rendererService,r=n.createTexture2D,o=n.createFramebuffer,u=n.getContainer,l=this.getContainerSize(u()),p=l.width,v=l.height;p*=Ra,v*=Ra,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=o({color:r({width:Math.round(p/this.pickBufferScale),height:Math.round(v/this.pickBufferScale),wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE})}),this.interactionService.on(Ru.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,Wt.Z)(be().mark(function n(r,o,u){var l=this,p,v,x;return be().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:p=this.rendererService,v=p.useFramebuffer,x=p.clear,this.resizePickingFBO(),v(this.pickingFBO,function(){x({framebuffer:l.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),r.hooks.beforePickingEncode.call(),r.renderModels(),r.hooks.afterPickingEncode.call();var T=l.pickBox(r,o);u(T)});case 3:case"end":return A.stop()}},n,this)}));function t(n,r,o){return i.apply(this,arguments)}return t}()},{key:"pickBox",value:function(t,n){var r=this,o=n.map(function(xr){var dr=xr<0?0:xr;return Math.floor(dr*Ra/r.pickBufferScale)}),u=(0,$n.Z)(o,4),l=u[0],p=u[1],v=u[2],x=u[3],E=this.rendererService,A=E.readPixels,T=E.getContainer,L=this.getContainerSize(T()),F=L.width,z=L.height;if(F*=Ra,z*=Ra,l>(F-1)*Ra/this.pickBufferScale||v<0||p>(z-1)*Ra/this.pickBufferScale||x<0)return[];for(var H=Math.min(F/this.pickBufferScale,v)-l,ne=Math.min(z/this.pickBufferScale,x)-p,oe=A({x:l,y:Math.floor(z/this.pickBufferScale-(x+1)),width:H,height:ne,data:new Uint8Array(H*ne*4),framebuffer:this.pickingFBO}),ke=[],De={},ft=0;ft<oe.length/4;ft=ft+1){var At=oe.slice(ft*4,ft*4+4),Nt=li(At);if(Nt!==-1&&!De[Nt]){var Gt=t.layerPickService.getFeatureById(Nt);ke.push((0,mt.Z)((0,mt.Z)({},Gt),{},{pickedFeatureIdx:Nt})),De[Nt]=!0}}return ke}},{key:"handleCursor",value:function(t,n){var r=t.getLayerConfig(),o=r.cursor,u=o===void 0?"":o,l=r.cursorEnabled;if(l){var p=this.mapService.version,v=p==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),x=v==null?void 0:v.style.getPropertyValue("cursor");n==="unmousemove"&&x!==""?v==null||v.style.setProperty("cursor",""):n==="mousemove"&&(v==null||v.style.setProperty("cursor",u))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/Ra,height:t.height/Ra}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,Wt.Z)(be().mark(function n(r){return be().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(!this.layerService.needPick(r.type)||!this.isPickingAllLayer())){u.next=2;break}return u.abrupt("return");case 2:return this.alreadyInPicking=!0,u.next=5,this.pickingLayers(r);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return u.stop()}},n,this)}));function t(n){return i.apply(this,arguments)}return t}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,n=this.getContainerSize(t()),r=n.width,o=n.height;r*=Ra,o*=Ra,(this.width!==r||this.height!==o)&&(this.pickingFBO.resize({width:Math.round(r/this.pickBufferScale),height:Math.round(o/this.pickBufferScale)}),this.width=r,this.height=o)}},{key:"pickingLayers",value:function(){var i=(0,Wt.Z)(be().mark(function n(r){var o=this,u,l,p;return be().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:u=this.rendererService,l=u.useFramebuffer,p=u.clear,this.resizePickingFBO(),l(this.pickingFBO,function(){var E=o.layerService.getRenderList();E.filter(function(A){return A.needPick(r.type)}).reverse().some(function(A){p({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),A.layerPickService.pickRender(r);var T=o.pickFromPickingFBO(A,r);return o.layerService.pickedLayerId=T?+A.id:-1,T&&!A.getLayerConfig().enablePropagation})});case 3:case"end":return x.stop()}},n,this)}));function t(n){return i.apply(this,arguments)}return t}()},{key:"triggerHoverOnLayer",value:function(t,n){kE(n)&&(this.handleCursor(t,n.type),t.emit(n.type,n))}}]),e}(),Qg=Qi(Rp.prototype,"mapService",[Wg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jg=Qi(Rp.prototype,"rendererService",[Xg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ey=Qi(Rp.prototype,"configService",[$g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ty=Qi(Rp.prototype,"interactionService",[Yg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ry=Qi(Rp.prototype,"layerService",[qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rp))||Kg),PE=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,wt.Z)(this,e),(0,W.Z)(this,"autoStart",void 0),(0,W.Z)(this,"startTime",0),(0,W.Z)(this,"oldTime",0),(0,W.Z)(this,"running",!1),(0,W.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,zt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();t=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=t}return t}}]),e}(),ny,iy,ay,oy,r0,sy,uy;function RE(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=LE(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function LE(e,i){if(!!e){if(typeof e=="string")return ly(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ly(e,i)}}function ly(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function OE(e){var i=FE();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function FE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DE=(ny=(0,B.b2)(),iy=(0,B.f3)(V.IRendererService),ay=(0,B.f3)(V.IMapService),ny(oy=(r0=function(e){(0,Dr.Z)(t,e);var i=OE(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"pickedLayerId",-1),(0,W.Z)((0,He.Z)(n),"clock",new PE),(0,W.Z)((0,He.Z)(n),"alreadyInRendering",!1),(0,W.Z)((0,He.Z)(n),"layers",[]),(0,W.Z)((0,He.Z)(n),"layerList",[]),(0,W.Z)((0,He.Z)(n),"layerRenderID",void 0),(0,W.Z)((0,He.Z)(n),"sceneInited",!1),(0,W.Z)((0,He.Z)(n),"animateInstanceCount",0),(0,W.Z)((0,He.Z)(n),"shaderPicking",!0),(0,W.Z)((0,He.Z)(n),"enableRender",!0),ia((0,He.Z)(n),"renderService",sy,(0,He.Z)(n)),ia((0,He.Z)(n),"mapService",uy,(0,He.Z)(n)),(0,W.Z)((0,He.Z)(n),"reRender",(0,ur.throttle)(function(){n.updateLayerRenderList(),n.renderLayers()},32)),(0,W.Z)((0,He.Z)(n),"throttleRenderLayers",(0,ur.throttle)(function(){n.renderLayers()},16)),n}return(0,zt.Z)(t,[{key:"needPick",value:function(r){return this.layerList.some(function(o){return o.needPick(r)})}},{key:"add",value:function(r){var o=this;this.layers.push(r),this.sceneInited&&r.init().then(function(){o.updateLayerRenderList(),o.renderLayers()})}},{key:"addMask",value:function(r){var o=this;this.sceneInited&&r.init().then(function(){o.renderLayers()})}},{key:"initLayers",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u=this;return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var v=(0,Wt.Z)(be().mark(function x(E){return be().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(E.startInit){T.next=4;break}return T.next=3,E.init();case 3:u.updateLayerRenderList();case 4:case"end":return T.stop()}},x)}));return function(x){return v.apply(this,arguments)}}());case 2:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(o){return o.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(o){return o.name===r})}},{key:"remove",value:function(){var n=(0,Wt.Z)(be().mark(function o(u,l){var p,v;return be().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:l?(p=l.layerChildren.indexOf(u),p>-1&&l.layerChildren.splice(p,1)):(v=this.layers.indexOf(u),v>-1&&this.layers.splice(v,1)),this.updateLayerRenderList(),u.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 5:case"end":return E.stop()}},o,this)}));function r(o,u){return n.apply(this,arguments)}return r}()},{key:"removeAllLayers",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:this.destroy(),this.reRender();case 2:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p;return be().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){x.next=2;break}return x.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),u=RE(this.layerList),x.prev=5,u.s();case 7:if((l=u.n()).done){x.next=19;break}if(p=l.value,p.masks.filter(function(E){return E.inited}).length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),p.masks.map(function(){var E=(0,Wt.Z)(be().mark(function A(T){return be().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:T.render();case 1:case"end":return F.stop()}},A)}));return function(A){return E.apply(this,arguments)}}())),!p.getLayerConfig().enableMultiPassRenderer){x.next=15;break}return x.next=13,p.renderMultiPass();case 13:x.next=17;break;case 15:return x.next=17,p.render();case 17:x.next=7;break;case 19:x.next=24;break;case 21:x.prev=21,x.t0=x.catch(5),u.e(x.t0);case 24:return x.prev=24,u.f(),x.finish(24);case 27:this.alreadyInRendering=!1;case 28:case"end":return x.stop()}},o,this,[[5,21,24,27]])}));function r(){return n.apply(this,arguments)}return r}()},{key:"renderMask",value:function(r){r.filter(function(o){return o.inited}).map(function(o){o.render()})}},{key:"beforeRenderData",value:function(){var n=(0,Wt.Z)(be().mark(function o(u){var l;return be().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,u.hooks.beforeRenderData.promise();case 2:l=v.sent,l&&this.renderLayers();case 4:case"end":return v.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"renderLayer",value:function(){var n=(0,Wt.Z)(be().mark(function o(u){var l=this;return be().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(u.masks.filter(function(x){return x.inited}).length>0&&u.masks.map(function(x){l.renderService.clear({stencil:0,depth:1,framebuffer:null}),x.render()}),!u.getLayerConfig().enableMultiPassRenderer){v.next=6;break}return v.next=4,u.renderMultiPass();case 4:v.next=8;break;case 6:return v.next=8,u.render();case 8:case"end":return v.stop()}},o)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).sort(function(o,u){return o.zIndex-u.zIndex}).forEach(function(o){r.layerList.push(o)})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var r=En(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=Xi.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){Xi.cancelAnimationFrame(this.layerRenderID)}}]),t}(Er.EventEmitter),sy=Qi(r0.prototype,"renderService",[iy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uy=Qi(r0.prototype,"mapService",[ay],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r0))||oy),BE=function(){function e(i){var t=this;(0,wt.Z)(this,e),(0,W.Z)(this,"name",void 0),(0,W.Z)(this,"type",void 0),(0,W.Z)(this,"scale",void 0),(0,W.Z)(this,"descriptor",void 0),(0,W.Z)(this,"featureBufferLayout",[]),(0,W.Z)(this,"needRescale",!1),(0,W.Z)(this,"needRemapping",!1),(0,W.Z)(this,"needRegenerateVertices",!1),(0,W.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,W.Z)(this,"vertexAttribute",void 0),(0,W.Z)(this,"defaultCallback",function(n){if(n.length===0){var r;return((r=t.scale)===null||r===void 0?void 0:r.defaultValues)||[]}return n.map(function(o,u){var l,p=(l=t.scale)===null||l===void 0?void 0:l.scalers[u].func,v=p(o);return v})}),this.setProps(i)}return(0,zt.Z)(e,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var r,o=(r=this.scale)===null||r===void 0?void 0:r.callback.apply(r,(0,cr.Z)(t));if(!(0,ur.isNil)(o))return[o]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),NE=["modelType"],zE=["buffer","update","name"],ZE=["buffer","update","name"],UE=["buffer","update","name"],rv,cy,fy,hy,pm,py,VE=(rv={},(0,W.Z)(rv,$.FLOAT,4),(0,W.Z)(rv,$.UNSIGNED_BYTE,1),(0,W.Z)(rv,$.UNSIGNED_SHORT,2),rv),jE=(cy=(0,B.b2)(),fy=(0,B.f3)(V.IRendererService),cy(hy=(pm=function(){function e(){(0,wt.Z)(this,e),(0,W.Z)(this,"attributesAndIndices",void 0),ia(this,"rendererService",py,this),(0,W.Z)(this,"attributes",[]),(0,W.Z)(this,"triangulation",void 0),(0,W.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,zt.Z)(e,[{key:"registerStyleAttribute",value:function(t){var n=this.getLayerStyleAttribute(t.name||"");return n?n.setProps(t):(n=new BE(t),this.attributes.push(n)),n}},{key:"updateScaleAttribute",value:function(t){this.attributes.forEach(function(n){var r,o=n.name,u=(r=n.scale)===null||r===void 0?void 0:r.field;(t[o]||u&&t[u])&&(n.needRescale=!0,n.needRemapping=!0,n.needRegenerateVertices=!0)})}},{key:"updateStyleAttribute",value:function(t,n,r){var o=this.getLayerStyleAttribute(t);o||(o=this.registerStyleAttribute((0,mt.Z)((0,mt.Z)({},n),{},{name:t})));var u=n.scale;u&&o&&(o.scale=u,o.needRescale=!0,o.needRemapping=!0,o.needRegenerateVertices=!0,r&&r.featureRange&&(o.featureRange=r.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find(function(n){return n.name===t})}},{key:"getLayerAttributeScale",value:function(t){var n,r=this.getLayerStyleAttribute(t),o=r==null||(n=r.scale)===null||n===void 0?void 0:n.scalers;return o&&o[0]?o[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0,l=this.attributes.find(function(De){return De.name===t});if(l&&l.descriptor){var p=l.descriptor,v=p.update,x=p.buffer,E=p.size,A=E===void 0?0:E,T=VE[x.type||$.FLOAT];if(v){var L=this.featureLayout,F=L.elements,z=L.sizePerElement,H=F.slice(r,o);if(!H.length)return;var ne=H[0].offset,oe=ne*A*T,ke=H.map(function(De,ft){for(var At=De.featureIdx,Nt=De.vertices,Gt=De.normals,xr=Nt.length/z,dr=[],zr=0;zr<xr;zr++){var bn=Gt?Gt.slice(zr*3,zr*3+3):[];dr.push.apply(dr,(0,cr.Z)(v(n[At],At,Nt.slice(zr*z,zr*z+z),ft,bn)))}return dr}).reduce(function(De,ft){return De.push.apply(De,(0,cr.Z)(ft)),De},[]);l.vertexAttribute.updateBuffer({data:ke,offset:oe}),u==null||u.emit("legend:".concat(t),{type:t,attr:l})}}}},{key:"createAttributesAndIndicesAscy",value:function(t,n,r){var o=this;this.featureLayout={sizePerElement:0,elements:[]};var u=this.attributes.map(function(L){return L.resetDescriptor(),L.descriptor}).filter(function(L){return L}),l=r.modelType,p=(0,C.Z)(r,NE),v=this.rendererService,x=v.createAttribute,E=v.createBuffer,A=v.createElements,T={};return new Promise(function(L,F){Nd(l,(0,mt.Z)({descriptors:o.getDescriptorsWithOutFunc(u),features:t,segmentNumber:n},p)).then(function(z){z.descriptors.forEach(function(ne,oe){if(ne){var ke=ne.buffer,De=ne.update,ft=ne.name,At=(0,C.Z)(ne,zE),Nt=x((0,mt.Z)({buffer:E(ke)},At));T[ne.name||""]=Nt,o.attributes[oe].vertexAttribute=Nt}}),o.featureLayout=z.featureLayout;var H=A({data:z.indices,type:$.UNSIGNED_INT,count:z.indices.length});o.attributesAndIndices={attributes:T,elements:H,count:null},L(o.attributesAndIndices)}).catch(function(z){console.warn(z),F(z)})})}},{key:"createAttributesAndIndices",value:function(t,n,r){var o=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var u=this.attributes.map(function(oe){return oe.resetDescriptor(),oe.descriptor}),l=0,p=0,v=[],x=[],E=[],A=3;t.forEach(function(oe,ke){var De=o.triangulation(oe,r),ft=De.indices,At=De.vertices,Nt=De.normals,Gt=De.size,xr=De.indexes,dr=De.count;typeof dr=="number"&&(p+=dr),ft.forEach(function(oa){x.push(oa+l)}),A=Gt;var zr=At.length/Gt;o.featureLayout.sizePerElement=A,o.featureLayout.elements.push({featureIdx:ke,vertices:At,normals:Nt,offset:l}),l+=zr;for(var bn=function(Ma){var Co=(Nt==null?void 0:Nt.slice(Ma*3,Ma*3+3))||[],ko=At.slice(Ma*Gt,Ma*Gt+Gt),es=0;xr&&xr[Ma]!==void 0&&(es=xr[Ma]),u.forEach(function(Ml,Bv){if(Ml&&Ml.update){var kd;(kd=Ml.buffer.data).push.apply(kd,(0,cr.Z)(Ml.update(oe,ke,ko,Ma,Co,es)))}})},Wn=0;Wn<zr;Wn++)bn(Wn)});var T=this.rendererService,L=T.createAttribute,F=T.createBuffer,z=T.createElements,H={};u.forEach(function(oe,ke){if(oe){var De=oe.buffer,ft=oe.update,At=oe.name,Nt=(0,C.Z)(oe,ZE),Gt=L((0,mt.Z)({buffer:F(De)},Nt));H[oe.name||""]=Gt,o.attributes[ke].vertexAttribute=Gt}});var ne=z({data:x,type:$.UNSIGNED_INT,count:x.length});return this.attributesAndIndices={attributes:H,elements:ne,count:p},this.attributesAndIndices}},{key:"createAttributes",value:function(t,n){var r=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var o=this.attributes.map(function(T){return T.resetDescriptor(),T.descriptor}),u=0,l=[],p=3;t.forEach(function(T,L){var F=r.triangulation(T),z=F.indices,H=F.vertices,ne=F.normals,oe=F.size,ke=F.indexes;z.forEach(function(Nt){l.push(Nt+u)}),p=oe;var De=H.length/oe;r.featureLayout.sizePerElement=p,r.featureLayout.elements.push({featureIdx:L,vertices:H,normals:ne,offset:u}),u+=De;for(var ft=function(Gt){var xr=(ne==null?void 0:ne.slice(Gt*3,Gt*3+3))||[],dr=H.slice(Gt*oe,Gt*oe+oe),zr=0;ke&&ke[Gt]!==void 0&&(zr=ke[Gt]),o.forEach(function(bn,Wn){if(bn&&bn.update){var oa;(oa=bn.buffer.data).push.apply(oa,(0,cr.Z)(bn.update(T,L,dr,Gt,xr,zr)))}})},At=0;At<De;At++)ft(At)});var v=this.rendererService,x=v.createAttribute,E=v.createBuffer,A={};return o.forEach(function(T,L){if(T){var F=T.buffer,z=T.update,H=T.name,ne=(0,C.Z)(T,UE),oe=x((0,mt.Z)({buffer:E(F)},ne));A[T.name||""]=oe,r.attributes[L].vertexAttribute=oe}}),{attributes:A}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}},{key:"getDescriptorsWithOutFunc",value:function(t){return t.map(function(n){return{buffer:n.buffer,name:n.name,size:n.size}})}}]),e}(),py=Qi(pm.prototype,"rendererService",[fy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pm))||hy),dm=ee(34155);function vm(e,i,t,n){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function l(x){try{v(n.next(x))}catch(E){u(E)}}function p(x){try{v(n.throw(x))}catch(E){u(E)}}function v(x){x.done?o(x.value):r(x.value).then(l,p)}v((n=n.apply(e,i||[])).next())})}function mm(e,i){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(v){return function(x){return p([v,x])}}function p(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=v[0]&2?r.return:v[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,v[1])).done)return o;switch(r=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,r=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){t.label=v[1];break}if(v[0]===6&&t.label<o[1]){t.label=o[1],o=v;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(v);break}o[2]&&t.ops.pop(),t.trys.pop();continue}v=i.call(e,t)}catch(x){v=[6,x],r=0}finally{n=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function n0(e,i){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var n=t.call(e),r,o=[],u;try{for(;(i===void 0||i-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(l){u={error:l}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(u)throw u.error}}return o}function i0(e,i,t){if(t||arguments.length===2)for(var n=0,r=i.length,o;n<r;n++)(o||!(n in i))&&(o||(o=Array.prototype.slice.call(i,0,n)),o[n]=i[n]);return e.concat(o||Array.prototype.slice.call(i))}function gm(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ym={exports:{}},a0={exports:{}},nv={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=t;function t(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default})(nv,nv.exports);var Tl={},_m={exports:{}},xm={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t){return function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];var o=n.pop();return t.call(this,n,o)}},e.exports=i.default})(xm,xm.exports);var Wh={};Object.defineProperty(Wh,"__esModule",{value:!0}),Wh.fallback=dy,Wh.wrap=vy;var GE=Wh.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,HE=Wh.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,WE=Wh.hasNextTick=typeof dm=="object"&&typeof dm.nextTick=="function";function dy(e){setTimeout(e,0)}function vy(e){return function(i){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return e(function(){return i.apply(void 0,t)})}}var iv;GE?iv=queueMicrotask:HE?iv=setImmediate:WE?iv=dm.nextTick:iv=dy,Wh.default=vy(iv),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=p;var t=xm.exports,n=l(t),r=Wh,o=l(r),u=Tl;function l(E){return E&&E.__esModule?E:{default:E}}function p(E){return(0,u.isAsync)(E)?function(){for(var A=[],T=arguments.length;T--;)A[T]=arguments[T];var L=A.pop(),F=E.apply(this,A);return v(F,L)}:(0,n.default)(function(A,T){var L;try{L=E.apply(this,A)}catch(F){return T(F)}if(L&&typeof L.then=="function")return v(L,T);T(null,L)})}function v(E,A){return E.then(function(T){x(A,null,T)},function(T){x(A,T&&T.message?T:new Error(T))})}function x(E,A,T){try{E(A,T)}catch(L){(0,o.default)(function(F){throw F},L)}}e.exports=i.default}(_m,_m.exports),Object.defineProperty(Tl,"__esModule",{value:!0}),Tl.isAsyncIterable=Tl.isAsyncGenerator=Tl.isAsync=void 0;var XE=_m.exports,$E=YE(XE);function YE(e){return e&&e.__esModule?e:{default:e}}function gy(e){return e[Symbol.toStringTag]==="AsyncFunction"}function qE(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function KE(e){return typeof e[Symbol.asyncIterator]=="function"}function QE(e){if(typeof e!="function")throw new Error("expected a function");return gy(e)?(0,$E.default)(e):e}Tl.default=QE,Tl.isAsync=gy,Tl.isAsyncGenerator=qE,Tl.isAsyncIterable=KE;var Lp={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=t;function t(n,r){if(r===void 0&&(r=n.length),!r)throw new Error("arity is undefined");function o(){for(var u=this,l=[],p=arguments.length;p--;)l[p]=arguments[p];return typeof l[r-1]=="function"?n.apply(this,l):new Promise(function(v,x){l[r-1]=function(E){for(var A=[],T=arguments.length-1;T-- >0;)A[T]=arguments[T+1];if(E)return x(E);v(A.length>1?A:A[0])},n.apply(u,l)})}return o}e.exports=i.default})(Lp,Lp.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var t=nv.exports,n=p(t),r=Tl,o=p(r),u=Lp.exports,l=p(u);function p(v){return v&&v.__esModule?v:{default:v}}i.default=(0,l.default)(function(v,x,E){var A=(0,n.default)(x)?[]:{};v(x,function(T,L,F){(0,o.default)(T)(function(z){for(var H,ne=[],oe=arguments.length-1;oe-- >0;)ne[oe]=arguments[oe+1];ne.length<2&&(H=ne,ne=H[0]),A[L]=ne,F(z)})},function(T){return E(T,A)})},3),e.exports=i.default}(a0,a0.exports);var bm={exports:{}},o0={exports:{}},Em={exports:{}},av={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=t;function t(n){function r(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(n!==null){var l=n;n=null,l.apply(this,o)}}return Object.assign(r,n),r}e.exports=i.default})(av,av.exports);var Sm={exports:{}},wm={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},e.exports=i.default})(wm,wm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=x;var t=nv.exports,n=u(t),r=wm.exports,o=u(r);function u(E){return E&&E.__esModule?E:{default:E}}function l(E){var A=-1,T=E.length;return function(){return++A<T?{value:E[A],key:A}:null}}function p(E){var A=-1;return function(){var L=E.next();return L.done?null:(A++,{value:L.value,key:A})}}function v(E){var A=E?Object.keys(E):[],T=-1,L=A.length;return function F(){var z=A[++T];return z==="__proto__"?F():T<L?{value:E[z],key:z}:null}}function x(E){if((0,n.default)(E))return l(E);var A=(0,o.default)(E);return A?p(A):v(E)}e.exports=i.default}(Sm,Sm.exports);var ov={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=t;function t(n){return function(){for(var r=[],o=arguments.length;o--;)r[o]=arguments[o];if(n===null)throw new Error("Callback was already called.");var u=n;n=null,u.apply(this,r)}}e.exports=i.default})(ov,ov.exports);var Cm={exports:{}},sv={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var t={};i.default=t,e.exports=i.default})(sv,sv.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=o;var t=sv.exports,n=r(t);function r(u){return u&&u.__esModule?u:{default:u}}function o(u,l,p,v){var x=!1,E=!1,A=!1,T=0,L=0;function F(){T>=l||A||x||(A=!0,u.next().then(function(ne){var oe=ne.value,ke=ne.done;if(!(E||x)){if(A=!1,ke){x=!0,T<=0&&v(null);return}T++,p(oe,L,z),L++,F()}}).catch(H))}function z(ne,oe){if(T-=1,!E){if(ne)return H(ne);if(ne===!1){x=!0,E=!0;return}if(oe===n.default||x&&T<=0)return x=!0,v(null);F()}}function H(ne){E||(A=!1,x=!0,v(ne))}F()}e.exports=i.default}(Cm,Cm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var t=av.exports,n=T(t),r=Sm.exports,o=T(r),u=ov.exports,l=T(u),p=Tl,v=Cm.exports,x=T(v),E=sv.exports,A=T(E);function T(L){return L&&L.__esModule?L:{default:L}}i.default=function(L){return function(F,z,H){if(H=(0,n.default)(H),L<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!F)return H(null);if((0,p.isAsyncGenerator)(F))return(0,x.default)(F,L,z,H);if((0,p.isAsyncIterable)(F))return(0,x.default)(F[Symbol.asyncIterator](),L,z,H);var ne=(0,o.default)(F),oe=!1,ke=!1,De=0,ft=!1;function At(Gt,xr){if(!ke)if(De-=1,Gt)oe=!0,H(Gt);else if(Gt===!1)oe=!0,ke=!0;else{if(xr===A.default||oe&&De<=0)return oe=!0,H(null);ft||Nt()}}function Nt(){for(ft=!0;De<L&&!oe;){var Gt=ne();if(Gt===null){oe=!0,De<=0&&H(null);return}De+=1,z(Gt.value,Gt.key,(0,l.default)(At))}ft=!1}Nt()}},e.exports=i.default}(Em,Em.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var t=Em.exports,n=p(t),r=Tl,o=p(r),u=Lp.exports,l=p(u);function p(x){return x&&x.__esModule?x:{default:x}}function v(x,E,A,T){return(0,n.default)(E)(x,(0,o.default)(A),T)}i.default=(0,l.default)(v,4),e.exports=i.default}(o0,o0.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var t=o0.exports,n=u(t),r=Lp.exports,o=u(r);function u(p){return p&&p.__esModule?p:{default:p}}function l(p,v,x){return(0,n.default)(p,1,v,x)}i.default=(0,o.default)(l,3),e.exports=i.default}(bm,bm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=l;var t=a0.exports,n=u(t),r=bm.exports,o=u(r);function u(p){return p&&p.__esModule?p:{default:p}}function l(p,v){return(0,n.default)(o.default,p,v)}e.exports=i.default}(ym,ym.exports);var s0=gm(ym.exports),zf=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,t=[],n=0;n<arguments.length;n++)t[n]=i[n];return this.args=t,s0(this.tasks)},e.prototype.tap=function(i,t){var n=this;this.tasks.push(function(r){t.apply(void 0,i0([],n0(n.args),!1)),r(null,i)})},e}(),Am={exports:{}},Tm={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var t=nv.exports,n=z(t),r=sv.exports,o=z(r),u=o0.exports,l=z(u),p=av.exports,v=z(p),x=ov.exports,E=z(x),A=Tl,T=z(A),L=Lp.exports,F=z(L);function z(ke){return ke&&ke.__esModule?ke:{default:ke}}function H(ke,De,ft){ft=(0,v.default)(ft);var At=0,Nt=0,Gt=ke.length,xr=!1;Gt===0&&ft(null);function dr(zr,bn){zr===!1&&(xr=!0),xr!==!0&&(zr?ft(zr):(++Nt===Gt||bn===o.default)&&ft(null))}for(;At<Gt;At++)De(ke[At],At,(0,E.default)(dr))}function ne(ke,De,ft){return(0,l.default)(ke,Infinity,De,ft)}function oe(ke,De,ft){var At=(0,n.default)(ke)?H:ne;return At(ke,(0,T.default)(De),ft)}i.default=(0,F.default)(oe,3),e.exports=i.default})(Tm,Tm.exports),function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=l;var t=Tm.exports,n=u(t),r=a0.exports,o=u(r);function u(p){return p&&p.__esModule?p:{default:p}}function l(p,v){return(0,o.default)(n.default,p,v)}e.exports=i.default}(Am,Am.exports);var JE=gm(Am.exports),A8=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return JE(this.tasks)},e.prototype.tapPromise=function(i,t){var n=this;this.tasks.push(function(r){return vm(n,void 0,void 0,function(){return mm(this,function(o){switch(o.label){case 0:return[4,t()];case 1:return o.sent(),r(null,i),[2]}})})})},e}(),Mm={exports:{}};(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var t=av.exports,n=x(t),r=ov.exports,o=x(r),u=Tl,l=x(u),p=Lp.exports,v=x(p);function x(A){return A&&A.__esModule?A:{default:A}}function E(A,T){if(T=(0,n.default)(T),!Array.isArray(A))return T(new Error("First argument to waterfall must be an array of functions"));if(!A.length)return T();var L=0;function F(H){var ne=(0,l.default)(A[L++]);ne.apply(void 0,H.concat([(0,o.default)(z)]))}function z(H){for(var ne=[],oe=arguments.length-1;oe-- >0;)ne[oe]=arguments[oe+1];if(H!==!1){if(H||L===A.length)return T.apply(void 0,[H].concat(ne));F(ne)}}F([])}i.default=(0,v.default)(E),e.exports=i.default})(Mm,Mm.exports);var yy=gm(Mm.exports),T8=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return yy(this.tasks)},e.prototype.tap=function(i,t){this.tasks.length===0?this.tasks.push(function(n){var r=t();n(r?null:!1,r)}):this.tasks.push(function(n,r){var o=t.apply(void 0,i0([],n0(n),!1));r(o?null:!1,i)})},e}(),_y=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return s0(this.tasks)},e.prototype.tap=function(i,t){this.tasks.push(function(n){var r=t();n(r,i)})},e}(),eS=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,t=[],n=0;n<arguments.length;n++)t[n]=i[n];return this.args=t,s0(this.tasks)},e.prototype.tapPromise=function(i,t){var n=this;this.tasks.push(function(r){return vm(n,void 0,void 0,function(){return mm(this,function(o){switch(o.label){case 0:return[4,t.apply(void 0,i0([],n0(this.args),!1))];case 1:return o.sent(),r(null,i),[2]}})})})},e}(),tS=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,t=[],n=0;n<arguments.length;n++)t[n]=i[n];return this.args=t,s0(this.tasks)},e.prototype.tapPromise=function(i,t){var n=this;this.tasks.push(function(r){return vm(n,void 0,void 0,function(){var o;return mm(this,function(u){switch(u.label){case 0:return[4,t.apply(void 0,i0([],n0(this.args),!1))];case 1:return o=u.sent(),r(o,i),[2]}})})})},e}(),rS=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return yy(this.tasks)},e.prototype.tapPromise=function(i,t){this.tasks.length===0?this.tasks.push(function(n){t().then(function(r){n(null,r)})}):this.tasks.push(function(n,r){t(n).then(function(o){r(null,o)})})},e}(),xy=ee(67709),nS=ee.n(xy),by,Ey,Sy,wy,Cy,Ay,Ty,My,ky,Iy,Py,Ry,Ly,Oy,Fy,Dy,By,Lu,Ny,zy,Zy,Uy,Vy,jy,Gy,Hy,Wy,Xy,$y,Yy,qy,Ky,Qy;function iS(e){var i=aS();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function aS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oS=(by=(0,B.b2)(),Ey=(0,B.f3)(V.SceneID),Sy=(0,B.f3)(V.IIconService),wy=(0,B.f3)(V.IFontService),Cy=(0,B.f3)(V.IControlService),Ay=(0,B.f3)(V.IGlobalConfigService),Ty=(0,B.f3)(V.IMapService),My=(0,B.f3)(V.ICoordinateSystemService),ky=(0,B.f3)(V.IRendererService),Iy=(0,B.f3)(V.ILayerService),Py=(0,B.f3)(V.ICameraService),Ry=(0,B.f3)(V.IInteractionService),Ly=(0,B.f3)(V.IPickingService),Oy=(0,B.f3)(V.IShaderModuleService),Fy=(0,B.f3)(V.IMarkerService),Dy=(0,B.f3)(V.IPopupService),by(By=(Lu=function(e){(0,Dr.Z)(t,e);var i=iS(t);function t(){var n;return(0,wt.Z)(this,t),n=i.call(this),(0,W.Z)((0,He.Z)(n),"destroyed",!1),(0,W.Z)((0,He.Z)(n),"loaded",!1),ia((0,He.Z)(n),"id",Ny,(0,He.Z)(n)),ia((0,He.Z)(n),"iconService",zy,(0,He.Z)(n)),ia((0,He.Z)(n),"fontService",Zy,(0,He.Z)(n)),ia((0,He.Z)(n),"controlService",Uy,(0,He.Z)(n)),ia((0,He.Z)(n),"configService",Vy,(0,He.Z)(n)),ia((0,He.Z)(n),"map",jy,(0,He.Z)(n)),ia((0,He.Z)(n),"coordinateSystemService",Gy,(0,He.Z)(n)),ia((0,He.Z)(n),"rendererService",Hy,(0,He.Z)(n)),ia((0,He.Z)(n),"layerService",Wy,(0,He.Z)(n)),ia((0,He.Z)(n),"cameraService",Xy,(0,He.Z)(n)),ia((0,He.Z)(n),"interactionService",$y,(0,He.Z)(n)),ia((0,He.Z)(n),"pickingService",Yy,(0,He.Z)(n)),ia((0,He.Z)(n),"shaderModuleService",qy,(0,He.Z)(n)),ia((0,He.Z)(n),"markerService",Ky,(0,He.Z)(n)),ia((0,He.Z)(n),"popupService",Qy,(0,He.Z)(n)),(0,W.Z)((0,He.Z)(n),"inited",!1),(0,W.Z)((0,He.Z)(n),"initPromise",void 0),(0,W.Z)((0,He.Z)(n),"rendering",!1),(0,W.Z)((0,He.Z)(n),"$container",void 0),(0,W.Z)((0,He.Z)(n),"canvas",void 0),(0,W.Z)((0,He.Z)(n),"markerContainer",void 0),(0,W.Z)((0,He.Z)(n),"hooks",void 0),(0,W.Z)((0,He.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),au(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,W.Z)((0,He.Z)(n),"handleMapCameraChanged",function(r){n.cameraService.update(r),n.render()}),n.hooks={init:new eS},n}return(0,zt.Z)(t,[{key:"init",value:function(r){var o=this;this.configService.setSceneConfig(this.id,r),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Wt.Z)(be().mark(function u(){return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,new Promise(function(v){o.map.onCameraChanged(function(x){o.cameraService.init(),o.cameraService.update(x),v()}),o.map.init()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.map.addMarkerContainer(),o.markerService.addMarkers(),o.markerService.addMarkerLayers(),o.popupService.initPopup(),o.interactionService.init(),o.interactionService.on(Ru.Drag,o.addSceneEvent.bind(o));case 9:case"end":return p.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,Wt.Z)(be().mark(function u(){var l,p;return be().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(l=o.map.getOverlayContainer(),l?o.$container=l:o.$container=ME(o.configService.getSceneConfig(o.id).id||""),!o.$container){x.next=12;break}return o.canvas=ri("canvas","",o.$container),o.setCanvas(),x.next=7,o.rendererService.init(o.canvas,o.configService.getSceneConfig(o.id),r.gl);case 7:o.initContainer(),nS()(o.$container,o.handleWindowResized),Xi.matchMedia&&((p=Xi.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||p===void 0||p.addListener(o.handleWindowResized)),x.next=13;break;case 12:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 13:o.pickingService.init(o.id);case 14:case"end":return x.stop()}},u)}))),this.render()}},{key:"initMiniScene",value:function(r){var o=this;this.configService.setSceneConfig(this.id,r),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Wt.Z)(be().mark(function u(){return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,new Promise(function(v){o.map.onCameraChanged(function(x){o.cameraService.init(),o.cameraService.update(x),o.map.version!=="GAODE2.x"&&v()}),o.map.initMiniMap()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.interactionService.init(),o.interactionService.on(Ru.Drag,o.addSceneEvent.bind(o));case 5:case"end":return p.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,Wt.Z)(be().mark(function u(){var l;return be().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(l=r.canvas,o.$container=l||null,!o.$container){v.next=7;break}return v.next=5,o.rendererService.init(r.canvas,o.configService.getSceneConfig(o.id),void 0);case 5:v.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:o.pickingService.init(o.id);case 9:case"end":return v.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(r){this.layerService.sceneService=this,this.layerService.add(r)}},{key:"addMask",value:function(r){this.layerService.sceneService=this,this.layerService.addMask(r)}},{key:"render",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.rendering||this.destroyed)){l.next=2;break}return l.abrupt("return");case 2:if(this.rendering=!0,this.inited){l.next=16;break}return l.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),l.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,l.next=20;break;case 16:return l.next=18,this.layerService.initLayers();case 18:return l.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"addFontFace",value:function(r,o){this.fontService.addFontFace(r,o)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(){var n=(0,Wt.Z)(be().mark(function o(u){var l,p,v;return be().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return p=(l=this.$container)===null||l===void 0?void 0:l.getElementsByTagName("canvas")[0],E.next=3,this.render();case 3:return v=u==="jpg"?p==null?void 0:p.toDataURL("image/jpeg"):p==null?void 0:p.toDataURL("image/png"),E.abrupt("return",v);case 5:case"end":return E.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var r=this.$container.parentElement;r!==null&&(this.markerContainer=ri("div","l7-marker-container",r))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var r=this,o,u;if(!this.inited){this.destroyed=!0;return}if((0,xy.unbind)(this.$container,this.handleWindowResized),Xi.matchMedia){var l;(l=Xi.matchMedia("screen and (min-resolution: 2dppx)"))===null||l===void 0||l.removeListener(this.handleWindowResized)}this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(function(){var p;(p=r.$container)===null||p===void 0||p.removeChild(r.canvas),r.canvas=null,r.rendererService.destroy()}),(o=this.$container)===null||o===void 0||(u=o.parentNode)===null||u===void 0||u.removeChild(this.$container),this.emit("destroy")}},{key:"initContainer",value:function(){var r,o,u=Ra,l=((r=this.$container)===null||r===void 0?void 0:r.clientWidth)||400,p=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,v=this.canvas;v&&(v.width=l*u,v.height=p*u),this.rendererService.viewport({x:0,y:0,width:u*l,height:u*p})}},{key:"setCanvas",value:function(){var r,o,u=Ra,l=((r=this.$container)===null||r===void 0?void 0:r.clientWidth)||400,p=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,v=this.canvas;v.width=l*u,v.height=p*u,v.style.width="100%",v.style.height="100%"}},{key:"addSceneEvent",value:function(r){this.emit(r.type,r)}}]),t}(Er.EventEmitter),Ny=Qi(Lu.prototype,"id",[Ey],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zy=Qi(Lu.prototype,"iconService",[Sy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zy=Qi(Lu.prototype,"fontService",[wy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uy=Qi(Lu.prototype,"controlService",[Cy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vy=Qi(Lu.prototype,"configService",[Ay],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jy=Qi(Lu.prototype,"map",[Ty],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gy=Qi(Lu.prototype,"coordinateSystemService",[My],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hy=Qi(Lu.prototype,"rendererService",[ky],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wy=Qi(Lu.prototype,"layerService",[Iy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xy=Qi(Lu.prototype,"cameraService",[Py],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$y=Qi(Lu.prototype,"interactionService",[Ry],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yy=Qi(Lu.prototype,"pickingService",[Ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qy=Qi(Lu.prototype,"shaderModuleService",[Oy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ky=Qi(Lu.prototype,"markerService",[Fy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qy=Qi(Lu.prototype,"popupService",[Dy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lu))||By);function sS(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var uS=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Jy(e){var i={};return e=e.replace(uS,function(t,n,r){var o=r.split(":"),u=o[0].trim(),l="";switch(o.length>1&&(l=o[1].trim()),n){case"bool":l=l==="true";break;case"float":case"int":l=Number(l);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":l?l=l.replace("[","").replace("]","").split(",").reduce(function(p,v){return p.push(Number(v.trim())),p},[]):l=new Array(sS(n)).fill(0);break;default:}return i[u]=l,"uniform ".concat(n," ").concat(u,`;
`)}),{content:e,uniforms:i}}var e_,t_,r_="#define PI 3.14159265359",lS=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,cS=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,fS=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,hS=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,pS=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,dS=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,vS=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel * u_FocalDistance ;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * 2.0 *  u_FocalDistance;;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,mS=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,gS=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,yS=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,_S=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,xS=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,bS=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,ES=/precision\s+(high|low|medium)p\s+float/,SS=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,wS=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,CS=(e_=(0,B.b2)(),e_(t_=function(){function e(){(0,wt.Z)(this,e),(0,W.Z)(this,"moduleCache",{}),(0,W.Z)(this,"rawContentCache",{})}return(0,zt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:r_,fs:r_}),this.registerModule("decode",{vs:lS,fs:""}),this.registerModule("projection",{vs:vS,fs:""}),this.registerModule("project",{vs:dS,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:mS}),this.registerModule("lighting",{vs:fS,fs:""}),this.registerModule("light",{vs:cS,fs:""}),this.registerModule("picking",{vs:pS,fs:hS}),this.registerModule("styleMapping",{vs:gS,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:bS,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:yS,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:_S,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:xS,fs:""})}},{key:"registerModule",value:function(t,n){if(!this.rawContentCache[t]){var r=n.vs,o=n.fs,u=n.uniforms,l=Jy(r),p=l.content,v=l.uniforms,x=Jy(o),E=x.content,A=x.uniforms;this.rawContentCache[t]={fs:E,uniforms:(0,mt.Z)((0,mt.Z)((0,mt.Z)({},v),A),u),vs:p}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var n=this;if(this.moduleCache[t])return this.moduleCache[t];var r=this.rawContentCache[t].vs,o=this.rawContentCache[t].fs,u=this.processModule(r,[],"vs"),l=u.content,p=u.includeList,v=this.processModule(o,[],"fs"),x=v.content,E=v.includeList,A=x,T=(0,ur.uniq)(p.concat(E).concat(t)).reduce(function(L,F){return(0,mt.Z)((0,mt.Z)({},L),n.rawContentCache[F].uniforms)},{});return ES.test(x)||(A=SS+x),this.moduleCache[t]={fs:A.trim(),uniforms:T,vs:l.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,n,r){var o=this,u=t.replace(wS,function(l,p){var v=p.split(" "),x=v[0].replace(/"/g,"");if(n.indexOf(x)>-1)return"";var E=o.rawContentCache[x][r];n.push(x);var A=o.processModule(E,n,r),T=A.content;return T});return{content:u,includeList:n}}}]),e}())||t_),Qa=ee(66213),Xh;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Xh||(Xh={}));var n_,i_,u0=(n_=(0,B.b2)(),n_(i_=function(){function e(){(0,wt.Z)(this,e),(0,W.Z)(this,"shaderModuleService",void 0),(0,W.Z)(this,"rendererService",void 0),(0,W.Z)(this,"cameraService",void 0),(0,W.Z)(this,"mapService",void 0),(0,W.Z)(this,"interactionService",void 0),(0,W.Z)(this,"layerService",void 0),(0,W.Z)(this,"config",void 0)}return(0,zt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Xh.Normal}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(V.IRendererService),this.cameraService=t.getContainer().get(V.ICameraService),this.mapService=t.getContainer().get(V.IMapService),this.interactionService=t.getContainer().get(V.IInteractionService),this.layerService=t.getContainer().get(V.ILayerService),this.shaderModuleService=t.getContainer().get(V.IShaderModuleService)}},{key:"render",value:function(t){}}]),e}())||i_),a_,o_;function AS(e){var i=TS();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function TS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MS=(a_=(0,B.b2)(),a_(o_=function(e){(0,Dr.Z)(t,e);var i=AS(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(r,o){(0,Qa.Z)((0,Qe.Z)(t.prototype),"init",this).call(this,r,o)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),t}(u0))||o_),s_,u_,l_,km,c_;function kS(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=IS(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function IS(e,i){if(!!e){if(typeof e=="string")return f_(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return f_(e,i)}}function f_(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}var PS=(s_=(0,B.b2)(),u_=(0,B.f3)(V.IPostProcessor),s_(l_=(km=function(){function e(){(0,wt.Z)(this,e),(0,W.Z)(this,"passes",[]),ia(this,"postProcessor",c_,this),(0,W.Z)(this,"layer",void 0),(0,W.Z)(this,"renderFlag",void 0),(0,W.Z)(this,"width",0),(0,W.Z)(this,"height",0)}return(0,zt.Z)(e,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,Wt.Z)(be().mark(function n(){var r,o,u;return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:r=kS(this.passes),p.prev=1,r.s();case 3:if((o=r.n()).done){p.next=9;break}return u=o.value,p.next=7,u.render(this.layer);case 7:p.next=3;break;case 9:p.next=14;break;case 11:p.prev=11,p.t0=p.catch(1),r.e(p.t0);case 14:return p.prev=14,r.f(),p.finish(14);case 17:return p.next=19,this.postProcessor.render(this.layer);case 19:case"end":return p.stop()}},n,this,[[1,11,14,17]])}));function t(){return i.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){(this.width!==t||this.height!==n)&&(this.postProcessor.resize(t,n),this.width=t,this.height=n)}},{key:"add",value:function(t,n){t.getType()===Xh.PostProcessing?this.postProcessor.add(t,this.layer,n):(t.init(this.layer,n),this.passes.push(t))}},{key:"insert",value:function(t,n,r){t.init(this.layer,n),this.passes.splice(r,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),c_=Qi(km.prototype,"postProcessor",[u_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),km))||l_),h_,p_;function RS(e){var i=LS();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function LS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OS=(h_=(0,B.b2)(),h_(p_=function(e){(0,Dr.Z)(t,e);var i=RS(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"pickingFBO",void 0),(0,W.Z)((0,He.Z)(n),"layer",void 0),(0,W.Z)((0,He.Z)(n),"width",0),(0,W.Z)((0,He.Z)(n),"height",0),(0,W.Z)((0,He.Z)(n),"alreadyInRendering",!1),(0,W.Z)((0,He.Z)(n),"pickFromPickingFBO",function(l){var p=l.x,v=l.y,x=l.lngLat,E=l.type;if(!(!n.layer.isVisible()||!n.layer.needPick(E))){var A=n.rendererService,T=A.getViewportSize,L=A.readPixels,F=A.useFramebuffer,z=T(),H=z.width,ne=z.height,oe=n.layer.getLayerConfig(),ke=oe.enableHighlight,De=oe.enableSelect,ft=p*Ra,At=v*Ra;if(!(ft>H||ft<0||At>ne||At<0)){var Nt;F(n.pickingFBO,function(){var Gt;if(Nt=L({x:Math.round(ft),y:Math.round(ne-(v+1)*Ra),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),Nt[0]!==0||Nt[1]!==0||Nt[2]!==0){var xr=li(Nt),dr=n.layer.getSource().getFeatureById(xr),zr={x:p,y:v,type:E,lngLat:x,featureId:xr,feature:dr};dr&&(n.layer.setCurrentPickId(xr),n.triggerHoverOnLayer(zr))}else{var bn={x:p,y:v,lngLat:x,type:n.layer.getCurrentPickId()===null?"un"+E:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer((0,mt.Z)((0,mt.Z)({},bn),{},{type:"unpick"})),n.triggerHoverOnLayer(bn),n.layer.setCurrentPickId(null)}ke&&n.highlightPickedFeature(Nt),De&&E==="click"&&((Gt=Nt)===null||Gt===void 0?void 0:Gt.toString())!==[0,0,0,0].toString()&&n.selectFeature(Nt)})}}}),n}return(0,zt.Z)(t,[{key:"getType",value:function(){return Xh.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(r,o){(0,Qa.Z)((0,Qe.Z)(t.prototype),"init",this).call(this,r,o),this.layer=r;var u=this.rendererService,l=u.createTexture2D,p=u.createFramebuffer,v=u.getViewportSize,x=v(),E=x.width,A=x.height;this.pickingFBO=p({color:l({width:E,height:A,wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE})}),this.interactionService.on(Ru.Hover,this.pickFromPickingFBO),this.interactionService.on(Ru.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Ru.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(r){var o=this;if(!this.alreadyInRendering){var u=this.rendererService,l=u.getViewportSize,p=u.useFramebuffer,v=u.clear,x=l(),E=x.width,A=x.height;this.alreadyInRendering=!0,(this.width!==E||this.height!==A)&&(this.pickingFBO.resize({width:E,height:A}),this.width=E,this.height=A),p(this.pickingFBO,function(){v({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var T=o.layer.multiPassRenderer.getRenderFlag();o.layer.multiPassRenderer.setRenderFlag(!1),r.hooks.beforePickingEncode.call(),r.render(),r.hooks.afterPickingEncode.call(),o.layer.multiPassRenderer.setRenderFlag(T),o.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(r){this.layer.emit(r.type,r)}},{key:"highlightPickedFeature",value:function(r){var o=(0,$n.Z)(r,3),u=o[0],l=o[1],p=o[2];this.layer.hooks.beforeHighlight.call([u,l,p]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(r){var o=(0,$n.Z)(r,3),u=o[0],l=o[1],p=o[2];this.layer.hooks.beforeSelect.call([u,l,p]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(r){var o=r.featureId,u=Jn(o);this.selectFeature(new Uint8Array(u))}},{key:"highlightFeatureHandle",value:function(r){var o=r.featureId,u=Jn(o);this.highlightPickedFeature(new Uint8Array(u))}}]),t}(u0))||p_),d_,v_,m_,Im,g_,FS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,vh=(d_=(0,B.b2)(),v_=(0,B.f3)(V.IShaderModuleService),d_(m_=(Im=function(){function e(){(0,wt.Z)(this,e),ia(this,"shaderModuleService",g_,this),(0,W.Z)(this,"rendererService",void 0),(0,W.Z)(this,"config",void 0),(0,W.Z)(this,"quad",FS),(0,W.Z)(this,"enabled",!0),(0,W.Z)(this,"renderToScreen",!1),(0,W.Z)(this,"model",void 0),(0,W.Z)(this,"name",void 0),(0,W.Z)(this,"optionsToUpdate",{})}return(0,zt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return Xh.PostProcessing}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(V.IRendererService),this.shaderModuleService=t.getContainer().get(V.IShaderModuleService);var r=this.rendererService,o=r.createAttribute,u=r.createBuffer,l=r.createModel,p=this.setupShaders(),v=p.vs,x=p.fs,E=p.uniforms;this.model=l({vs:v,fs:x,attributes:{a_Position:o({buffer:u({data:[-4,-4,4,-4,0,4],type:$.FLOAT}),size:2})},uniforms:(0,mt.Z)((0,mt.Z)({u_Texture:null},E),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(t,n){var r=this,o=t.multiPassRenderer.getPostProcessor(),u=this.rendererService,l=u.useFramebuffer,p=u.getViewportSize,v=u.clear,x=p(),E=x.width,A=x.height;l(this.renderToScreen?null:o.getWriteFBO(),function(){v({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var T=(0,mt.Z)({u_BloomFinal:0,u_Texture:o.getReadFBO(),u_ViewportSize:[E,A]},r.convertOptionsToUniforms(r.optionsToUpdate));n&&(T.u_BloomFinal=1,T.u_Texture2=n),r.model.draw({uniforms:T})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=(0,mt.Z)((0,mt.Z)({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var n={};return Object.keys(t).forEach(function(r){(0,ur.isNil)(t[r])||(n["u_".concat((0,ur.upperFirst)((0,ur.camelCase)(r)))]=t[r])}),n}}]),e}(),g_=Qi(Im.prototype,"shaderModuleService",[v_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Im))||m_),y_,__;function DS(e){var i=BS();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function BS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NS=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,zS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ZS=(y_=(0,B.b2)(),y_(__=function(e){(0,Dr.Z)(t,e);var i=DS(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:zS,fs:NS});var r=this.shaderModuleService.getModule("blur-pass"),o=r.vs,u=r.fs,l=r.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,mt.Z)((0,mt.Z)({},l),{},{u_ViewportSize:[v,x]})}}},{key:"convertOptionsToUniforms",value:function(r){var o={};return(0,ur.isNil)(r.bloomRadius)||(o.u_radius=r.bloomRadius),(0,ur.isNil)(r.bloomIntensity)||(o.u_intensity=r.bloomIntensity),(0,ur.isNil)(r.bloomBaseRadio)||(o.u_baseRadio=r.bloomBaseRadio),o}}]),t}(vh))||__),x_,b_;function US(e){var i=VS();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function VS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,GS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,HS=(x_=(0,B.b2)(),x_(b_=function(e){(0,Dr.Z)(t,e);var i=US(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:GS,fs:jS});var r=this.shaderModuleService.getModule("blur-pass"),o=r.vs,u=r.fs,l=r.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,mt.Z)((0,mt.Z)({},l),{},{u_ViewportSize:[v,x]})}}},{key:"convertOptionsToUniforms",value:function(r){var o={};return(0,ur.isNil)(r.blurRadius)||(o.u_BlurDir=[r.blurRadius,0]),o}}]),t}(vh))||b_),E_,S_;function WS(e){var i=XS();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function XS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $S=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,YS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,qS=(E_=(0,B.b2)(),E_(S_=function(e){(0,Dr.Z)(t,e);var i=WS(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:YS,fs:$S});var r=this.shaderModuleService.getModule("blur-pass"),o=r.vs,u=r.fs,l=r.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,mt.Z)((0,mt.Z)({},l),{},{u_ViewportSize:[v,x]})}}},{key:"convertOptionsToUniforms",value:function(r){var o={};return(0,ur.isNil)(r.blurRadius)||(o.u_BlurDir=[0,r.blurRadius]),o}}]),t}(vh))||S_),w_,C_;function KS(e){var i=QS();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function QS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JS=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,ew=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,tw=(w_=(0,B.b2)(),w_(C_=function(e){(0,Dr.Z)(t,e);var i=KS(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:ew,fs:JS});var r=this.shaderModuleService.getModule("colorhalftone-pass"),o=r.vs,u=r.fs,l=r.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,mt.Z)((0,mt.Z)({},l),{},{u_ViewportSize:[v,x]})}}}]),t}(vh))||C_),A_,T_;function rw(e){var i=nw();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function nw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iw=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,aw=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ow=(A_=(0,B.b2)(),A_(T_=function(e){(0,Dr.Z)(t,e);var i=rw(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:aw,fs:iw}),this.shaderModuleService.getModule("copy-pass")}}]),t}(vh))||T_),M_,k_;function sw(e){var i=uw();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function uw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lw=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,cw=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,fw=(M_=(0,B.b2)(),M_(k_=function(e){(0,Dr.Z)(t,e);var i=sw(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:cw,fs:lw});var r=this.shaderModuleService.getModule("hexagonalpixelate-pass"),o=r.vs,u=r.fs,l=r.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,mt.Z)((0,mt.Z)({},l),{},{u_ViewportSize:[v,x]})}}}]),t}(vh))||k_),I_,P_;function hw(e){var i=pw();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function pw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dw=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,vw=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,mw=(I_=(0,B.b2)(),I_(P_=function(e){(0,Dr.Z)(t,e);var i=hw(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:vw,fs:dw});var r=this.shaderModuleService.getModule("ink-pass"),o=r.vs,u=r.fs,l=r.uniforms,p=this.rendererService.getViewportSize(),v=p.width,x=p.height;return{vs:o,fs:u,uniforms:(0,mt.Z)((0,mt.Z)({},l),{},{u_ViewportSize:[v,x]})}}}]),t}(vh))||P_),R_,L_;function gw(e){var i=yw();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function yw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _w=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,xw=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,bw=(R_=(0,B.b2)(),R_(L_=function(e){(0,Dr.Z)(t,e);var i=gw(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:xw,fs:_w}),this.shaderModuleService.getModule("noise-pass")}}]),t}(vh))||L_),O_,F_;function Ew(e){var i=Sw();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function Sw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ww=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Cw=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,Aw=(O_=(0,B.b2)(),O_(F_=function(e){(0,Dr.Z)(t,e);var i=Ew(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:ww,fs:Cw}),this.shaderModuleService.getModule("sepia-pass")}}]),t}(vh))||F_),D_,B_,N_,z_,fd,Z_,Tw=(D_=(0,B.b2)(),B_=(0,B.f3)(V.IRendererService),N_=(0,B.zY)(),D_(z_=(fd=function(){function e(){(0,wt.Z)(this,e),ia(this,"rendererService",Z_,this),(0,W.Z)(this,"passes",[]),(0,W.Z)(this,"readFBO",void 0),(0,W.Z)(this,"writeFBO",void 0)}return(0,zt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,n=t.getViewportSize,r=t.createTexture2D,o=n(),u=o.width,l=o.height;return r({x:0,y:0,width:u,height:l,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,n=this.rendererService.useFramebuffer;return new Promise(function(r){n(t.readFBO,(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:r(t.getCurrentFBOTex());case 1:case"end":return l.stop()}},o)})))})}},{key:"renderBloomPass",value:function(){var i=(0,Wt.Z)(be().mark(function n(r,o){var u,l;return be().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.getReadFBOTex();case 2:u=v.sent,l=0;case 4:if(!(l<4)){v.next=11;break}return v.next=7,o.render(r,u);case 7:this.swap(),l++,v.next=4;break;case 11:case"end":return v.stop()}},n,this)}));function t(n,r){return i.apply(this,arguments)}return t}()},{key:"render",value:function(){var i=(0,Wt.Z)(be().mark(function n(r){var o,u;return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:o=0;case 1:if(!(o<this.passes.length)){p.next=15;break}if(u=this.passes[o],u.setRenderToScreen(this.isLastEnabledPass(o)),u.getName()!=="bloom"){p.next=9;break}return p.next=7,this.renderBloomPass(r,u);case 7:p.next=12;break;case 9:return p.next=11,u.render(r);case 11:o!==this.passes.length-1&&this.swap();case 12:o++,p.next=1;break;case 15:case"end":return p.stop()}},n,this)}));function t(n){return i.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){this.readFBO.resize({width:t,height:n}),this.writeFBO.resize({width:t,height:n})}},{key:"add",value:function(t,n,r){t.init(n,r),this.passes.push(t)}},{key:"insert",value:function(t,n,r,o){t.init(r,o),this.passes.splice(n,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find(function(n){return n.getName()===t})}},{key:"init",value:function(){var t=this.rendererService,n=t.createFramebuffer,r=t.createTexture2D;this.readFBO=n({color:r({width:1,height:1,wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE})}),this.writeFBO=n({color:r({width:1,height:1,wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var n=t+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),e}(),Z_=Qi(fd.prototype,"rendererService",[B_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qi(fd.prototype,"init",[N_],Object.getOwnPropertyDescriptor(fd.prototype,"init"),fd.prototype),fd))||z_),U_,V_;function Mw(e){var i=kw();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function kw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Iw=(U_=(0,B.b2)(),U_(V_=function(e){(0,Dr.Z)(t,e);var i=Mw(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getType",value:function(){return Xh.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(r,o){(0,Qa.Z)((0,Qe.Z)(t.prototype),"init",this).call(this,r,o)}},{key:"render",value:function(r){var o=this.rendererService,u=o.useFramebuffer,l=o.clear,p=r.multiPassRenderer.getPostProcessor().getReadFBO();u(p,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:p}),r.multiPassRenderer.setRenderFlag(!1),r.models.forEach(function(v){v.draw({uniforms:r.layerModel.getUninforms()})}),r.multiPassRenderer.setRenderFlag(!0)})}}]),t}(u0))||V_),j_,G_,H_,Pm,W_;function Pw(e){var i=Rw();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function Rw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lw=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,X_=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Ow=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function $_(e,i){for(var t=0,n=1/i,r=e;r>0;)t=t+n*(r%i),r=Math.floor(r/i),n=n/i;return t}var Fw=1,Dw=(j_=(0,B.b2)(),G_=(0,B.f3)(V.IShaderModuleService),j_(H_=(Pm=function(e){(0,Dr.Z)(t,e);var i=Pw(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),ia((0,He.Z)(n),"shaderModuleService",W_,(0,He.Z)(n)),(0,W.Z)((0,He.Z)(n),"haltonSequence",[]),(0,W.Z)((0,He.Z)(n),"accumulatingId",0),(0,W.Z)((0,He.Z)(n),"frame",0),(0,W.Z)((0,He.Z)(n),"timer",void 0),(0,W.Z)((0,He.Z)(n),"sampleRenderTarget",void 0),(0,W.Z)((0,He.Z)(n),"prevRenderTarget",void 0),(0,W.Z)((0,He.Z)(n),"outputRenderTarget",void 0),(0,W.Z)((0,He.Z)(n),"copyRenderTarget",void 0),(0,W.Z)((0,He.Z)(n),"blendModel",void 0),(0,W.Z)((0,He.Z)(n),"outputModel",void 0),(0,W.Z)((0,He.Z)(n),"copyModel",void 0),n}return(0,zt.Z)(t,[{key:"getType",value:function(){return Xh.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(r,o){(0,Qa.Z)((0,Qe.Z)(t.prototype),"init",this).call(this,r,o);var u=this.rendererService,l=u.createFramebuffer,p=u.createTexture2D;this.sampleRenderTarget=l({color:p({width:1,height:1,wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE})}),this.prevRenderTarget=l({color:p({width:1,height:1,wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE})}),this.outputRenderTarget=l({color:p({width:1,height:1,wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE})}),this.copyRenderTarget=l({color:p({width:1,height:1,wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE})});for(var v=0;v<30;v++)this.haltonSequence.push([$_(v,2),$_(v,3)]);this.blendModel=this.createTriangleModel("blend-pass",Lw),this.outputModel=this.createTriangleModel("copy-pass",X_,{blend:{enable:!0,func:{srcRGB:$.ONE,dstRGB:$.ONE_MINUS_SRC_ALPHA,srcAlpha:$.ONE,dstAlpha:$.ONE_MINUS_SRC_ALPHA},equation:{rgb:$.FUNC_ADD,alpha:$.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",X_)}},{key:"render",value:function(r){var o=this,u=this.rendererService,l=u.clear,p=u.getViewportSize,v=u.useFramebuffer,x=p(),E=x.width,A=x.height;this.sampleRenderTarget.resize({width:E,height:A}),this.prevRenderTarget.resize({width:E,height:A}),this.outputRenderTarget.resize({width:E,height:A}),this.copyRenderTarget.resize({width:E,height:A}),this.resetFrame(),this.stopAccumulating();var T=r.multiPassRenderer.getPostProcessor().getReadFBO();v(T,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:T}),r.multiPassRenderer.setRenderFlag(!1),r.render(),r.multiPassRenderer.setRenderFlag(!0)});var L=function F(z){!o.accumulatingId||z!==o.accumulatingId||o.isFinished()||(o.doRender(r),Xi.requestAnimationFrame(function(){F(z)}))};this.accumulatingId=Fw++,this.timer=Xi.setTimeout(function(){L(o.accumulatingId)},50)}},{key:"doRender",value:function(r){var o=this,u=this.rendererService,l=u.clear,p=u.getViewportSize,v=u.useFramebuffer,x=p(),E=x.width,A=x.height,T=r.getLayerConfig(),L=T.jitterScale,F=L===void 0?1:L,z=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((z[0]*2-1)/E*F,(z[1]*2-1)/A*F),r.multiPassRenderer.setRenderFlag(!1),r.hooks.beforeRender.call(),v(this.sampleRenderTarget,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.sampleRenderTarget}),r.render()}),r.hooks.afterRender.call(),r.multiPassRenderer.setRenderFlag(!0);var H=r.getLayerConfig();v(this.outputRenderTarget,function(){o.blendModel.draw({uniforms:{u_opacity:H.opacity||1,u_MixRatio:o.frame===0?1:.9,u_Diffuse1:o.sampleRenderTarget,u_Diffuse2:o.frame===0?r.multiPassRenderer.getPostProcessor().getReadFBO():o.prevRenderTarget}})}),this.frame===0&&l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(v(this.copyRenderTarget,function(){o.outputModel.draw({uniforms:{u_Texture:o.outputRenderTarget}})}),v(r.multiPassRenderer.getPostProcessor().getReadFBO(),function(){o.copyModel.draw({uniforms:{u_Texture:o.copyRenderTarget}})}),r.multiPassRenderer.getPostProcessor().render(r));var ne=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=ne,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,Xi.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(r,o,u){this.shaderModuleService.registerModule(r,{vs:Ow,fs:o});var l=this.shaderModuleService.getModule(r),p=l.vs,v=l.fs,x=l.uniforms,E=this.rendererService,A=E.createAttribute,T=E.createBuffer,L=E.createModel;return L((0,mt.Z)({vs:p,fs:v,attributes:{a_Position:A({buffer:T({data:[-4,-4,4,-4,0,4],type:$.FLOAT}),size:2})},uniforms:(0,mt.Z)({},x),depth:{enable:!1},count:3},u))}}]),t}(u0),W_=Qi(Pm.prototype,"shaderModuleService",[G_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pm))||H_),uv=new B.W2;uv.bind(V.IGlobalConfigService).to(ph).inSingletonScope(),(0,B.GW)((0,B.b2)(),Er.EventEmitter),uv.bind(V.IEventEmitter).to(Er.EventEmitter);var Y_=(0,K.Z)(uv,!1),Rm=function(i){var t=Y_.lazyInject(i);return function(n,r,o){t.call(this,n,r),o&&(o.initializer=function(){return n[r]})}},M8=function(i){var t=Y_.lazyMultiInject(i);return function(n,r,o){t.call(this,n,r),o&&(o.initializer=function(){return n[r]})}},ac=uv,Bw=0;function Nw(){var e=new B.W2;return e.parent=uv,e.bind(V.SceneID).toConstantValue("".concat(Bw++)),e.bind(V.IShaderModuleService).to(CS).inSingletonScope(),e.bind(V.ILayerService).to(DE).inSingletonScope(),e.bind(V.ISceneService).to(oS).inSingletonScope(),e.bind(V.ICameraService).to(jv).inSingletonScope(),e.bind(V.ICoordinateSystemService).to(bE).inSingletonScope(),e.bind(V.IInteractionService).to(AE).inSingletonScope(),e.bind(V.IPickingService).to(IE).inSingletonScope(),e.bind(V.IControlService).to(Gv).inSingletonScope(),e.bind(V.IMarkerService).to(Hv).inSingletonScope(),e.bind(V.IIconService).to(pu).inSingletonScope(),e.bind(V.IFontService).to(As).inSingletonScope(),e.bind(V.IPopupService).to(Wv).inSingletonScope(),e.bind(V.INormalPass).to(MS).whenTargetNamed("clear"),e.bind(V.INormalPass).to(OS).whenTargetNamed("pixelPicking"),e.bind(V.INormalPass).to(Iw).whenTargetNamed("render"),e.bind(V.INormalPass).to(Dw).whenTargetNamed("taa"),e.bind(V.IFactoryNormalPass).toFactory(function(i){return function(t){return i.container.getNamed(V.INormalPass,t)}}),e.bind(V.IPostProcessingPass).to(ow).whenTargetNamed("copy"),e.bind(V.IPostProcessingPass).to(ZS).whenTargetNamed("bloom"),e.bind(V.IPostProcessingPass).to(HS).whenTargetNamed("blurH"),e.bind(V.IPostProcessingPass).to(qS).whenTargetNamed("blurV"),e.bind(V.IPostProcessingPass).to(bw).whenTargetNamed("noise"),e.bind(V.IPostProcessingPass).to(Aw).whenTargetNamed("sepia"),e.bind(V.IPostProcessingPass).to(tw).whenTargetNamed("colorHalftone"),e.bind(V.IPostProcessingPass).to(fw).whenTargetNamed("hexagonalPixelate"),e.bind(V.IPostProcessingPass).to(mw).whenTargetNamed("ink"),e.bind(V.IFactoryPostProcessingPass).toFactory(function(i){return function(t){var n=i.container.getNamed(V.IPostProcessingPass,t);return n.setName(t),n}}),e}function l0(e){var i=new B.W2;return i.parent=e,i.bind(V.IStyleAttributeService).to(jE).inSingletonScope(),i.bind(V.IMultiPassRenderer).to(PS).inSingletonScope(),i.bind(V.IPostProcessor).to(Tw).inSingletonScope(),i}var zw=null;function k8(e){return zw.indexOf(e)}var Zw=2,I8=4,Uw=64,P8=128,Vw=256,jw=512,R8=8192,L8=16384,O8=32768,Gw=null,q_=131072,F8=262144,Hw=524288,D8=1048576,Ww=2097152,B8=4194304,Xw=8388608,$w=16777216,Yw=null;function c0(e,i){return e=clamp(Math.floor(e),0,255),i=clamp(Math.floor(i),0,255),256*e+i}function N8(e){var i=e.color,t=e.radius,n=e.tileX,r=e.tileY,o=e.shape,u=e.opacity,l=e.stroke,p=e.strokeWidth,v=e.strokeOpacity,x=[],E=[],A=[],T=[c0(i[0],i[1]),c0(i[2],i[3])],L=[c0(l[0],l[1]),c0(l[2],l[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(F){var z=_slicedToArray(F,2),H=z[0],ne=z[1];x.push([].concat(T,[(H+1)*Xw+(ne+1)*Ww+getShapeIndex(o)*q_+t,(n+512)*Hw+(r+512)*Uw])),E.push([].concat(L,[p,v])),A.push([u,0,0,0])}),{packedBuffer:x,packedBuffer2:E,packedBuffer3:A}}function z8(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var t=i?1:0,n=Math.floor(e*127);return n*Yw+t*$w+n*q_+t*Gw+n*jw+t*Vw+n*Zw+t}var hf;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(hf||(hf={}));var _o;(function(e){e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging"})(_o||(_o={}));var $h;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})($h||($h={}));var Nn;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(Nn||(Nn={}));var pf;(function(e){e.IMAGE="image",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer"})(pf||(pf={}));var qw=["mapload","mapchange","mapAfterFrameChange"],Op={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},f0=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Kw=function(){var e=(0,Wt.Z)(be().mark(function i(t,n,r,o){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(p,v){n({x:t.x,y:t.y,z:t.z},function(x,E){if(x||E.length===0){v(x);return}E&&ed([{data:E,bands:[0]}],r,o,function(A,T){A?v(A):T&&p(T)})})}));case 1:case"end":return l.stop()}},i)}));return function(t,n,r,o){return e.apply(this,arguments)}}();function Qw(e,i){return Array.isArray(e)?typeof e[0]=="string"?e.map(function(t){return ar(t,i)}):e.map(function(t){return{url:ar(t.url,i),bands:t.bands||[0]}}):ar(e,i)}function Jw(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(function(i){return{url:i,bands:[0]}}):e}function K_(e,i){e.xhrCancel=function(){i.map(function(t){t.abort()})}}var eC=function(){var e=(0,Wt.Z)(be().mark(function i(t,n,r,o,u){var l,p,v,x,E,A;return be().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(l=Jw(n.url),!(l.length>1)){L.next=15;break}return L.next=4,tC(l,n);case 4:if(p=L.sent,v=p.rasterFiles,x=p.xhrList,E=p.errList,K_(t,x),!(E.length>0)){L.next=12;break}return r(E,null),L.abrupt("return");case 12:ed(v,o,u,r),L.next=17;break;case 15:A=gl(n,function(F,z){if(F)r(F);else if(z){var H=[{data:z,bands:l[0].bands}];ed(H,o,u,r)}}),K_(t,[A]);case 17:case"end":return L.stop()}},i)}));return function(t,n,r,o,u){return e.apply(this,arguments)}}();function tC(e,i){return Lm.apply(this,arguments)}function Lm(){return Lm=(0,Wt.Z)(be().mark(function e(i,t){var n,r,o,u,l,p,v,x,E,A,T;return be().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:n=[],r=[],o=[],u=0;case 4:if(!(u<i.length)){F.next=20;break}return l=i[u],p=(0,mt.Z)((0,mt.Z)({},t),{},{url:l.url}),v=l.bands,F.next=10,Hl((0,mt.Z)((0,mt.Z)({},p),{},{type:"arrayBuffer"}));case 10:x=F.sent,E=x.err,A=x.data,T=x.xhr,E&&o.push(E),r.push(T),n.push({data:A,bands:v});case 17:u++,F.next=4;break;case 20:return F.abrupt("return",{rasterFiles:n,xhrList:r,errList:o});case 21:case"end":return F.stop()}},e)})),Lm.apply(this,arguments)}var rC=function(){var e=(0,Wt.Z)(be().mark(function i(t,n,r,o,u){var l;return be().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l={url:Qw(t,n)},v.abrupt("return",new Promise(function(x,E){eC(r,l,function(A,T){A?E(A):T&&x(T)},o,u)}));case 2:case"end":return v.stop()}},i)}));return function(t,n,r,o,u){return e.apply(this,arguments)}}(),Q_=function(){var e=(0,Wt.Z)(be().mark(function i(t,n,r,o){var u,l,p,v;return be().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return l=Array.isArray(t)?t[0]:t,o.wmtsOptions?(p=(o==null?void 0:o.getURLFromTemplate)||Vr,u=p(l,(0,mt.Z)((0,mt.Z)({},n),o.wmtsOptions))):(v=(o==null?void 0:o.getURLFromTemplate)||ar,u=v(l,n)),E.abrupt("return",new Promise(function(A,T){var L,F=zu({url:u,type:(o==null||(L=o.requestParameters)===null||L===void 0?void 0:L.type)||"arrayBuffer"},function(z,H){z?T(z):H&&A(H)},o.transformResponse);r.xhrCancel=function(){return F.abort()}}));case 3:case"end":return E.stop()}},i)}));return function(t,n,r,o){return e.apply(this,arguments)}}(),J_=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},nC={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},Z8=[pf.ARRAYBUFFER,pf.RGB];function iC(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function aC(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(iC(e))throw new Error("tile server url is error");var t=(i==null?void 0:i.dataType)||pf.IMAGE;t===pf.RGB&&(t=pf.ARRAYBUFFER);var n=function(u,l){switch(t){case pf.IMAGE:return Q_(e,u,l,i);case pf.ARRAYBUFFER:return rC(e,u,l,(i==null?void 0:i.format)||J_,i==null?void 0:i.operation);case pf.CUSTOMARRAYBUFFER:case pf.CUSTOMRGB:return Kw(l,i==null?void 0:i.getCustomData,(i==null?void 0:i.format)||J_,i==null?void 0:i.operation);default:return Q_(e,u,l,i)}},r=(0,mt.Z)((0,mt.Z)((0,mt.Z)({},nC),i),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:r,isTile:!0}}var oC={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},sC=function(){var e=(0,Wt.Z)(be().mark(function i(t){return be().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise(function(o){var u=(0,$n.Z)(t.bounds,4),l=u[0],p=u[1],v=u[2],x=u[3],E={layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,textLng:(l+v)/2,textLat:(p+x)/2},geometry:{type:"LineString",coordinates:[[v,x],[v,p],[l,p],[l,p]]}}]}}};o(E)}));case 1:case"end":return r.stop()}},i)}));return function(t){return e.apply(this,arguments)}}();function uC(e,i){var t=function(o){return sC(o)},n=(0,mt.Z)((0,mt.Z)((0,mt.Z)({},oC),i),{},{getTileData:t});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var lC=ee(69848),e1=ee.n(lC);function t1(e,i){var t=i.radius,n=t===void 0?40:t,r=i.maxZoom,o=r===void 0?18:r,u=i.minZoom,l=u===void 0?0:u,p=i.zoom,v=p===void 0?2:p;if(e.pointIndex){var x=e.pointIndex.getClusters(e.extent,Math.floor(v));return e.dataArray=cC(x),e}var E=new(e1())({radius:n,minZoom:l,maxZoom:o}),A={type:"FeatureCollection",features:[]};return A.features=e.dataArray.map(function(T){return{type:"Feature",geometry:{type:"Point",coordinates:T.coordinates},properties:(0,mt.Z)({},T)}}),E.load(A.features),E}function cC(e){return e.map(function(i,t){return(0,mt.Z)({coordinates:i.geometry.coordinates,_id:t+1},i.properties)})}function fC(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],t=1;t<e.length;t++)e[t]>i&&(i=e[t]);return i}function hC(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],t=1;t<e.length;t++)e[t]<i&&(i=e[t]);return i}function r1(e){if(e.length===0)return 0;for(var i=e[0],t=0,n,r=1;r<e.length;r++)n=i+e[r]*1,Math.abs(i)>=Math.abs(e[r])?t+=i-n+e[r]:t+=e[r]-n+i,i=n;return i+t*1}function pC(e){if(e.length===0)throw new Error("mean requires at least one data point");return r1(e)/e.length}var dC={min:hC,max:fC,mean:pC,sum:r1};function vC(e){var i=mC();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function mC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function gC(e,i){if(Array.isArray(i))return i}var yC=function(e){(0,Dr.Z)(t,e);var i=vC(t);function t(n,r){var o;return(0,wt.Z)(this,t),o=i.call(this),(0,W.Z)((0,He.Z)(o),"type","source"),(0,W.Z)((0,He.Z)(o),"isTile",!1),(0,W.Z)((0,He.Z)(o),"inited",!1),(0,W.Z)((0,He.Z)(o),"hooks",{init:new zf}),(0,W.Z)((0,He.Z)(o),"parser",{type:"geojson"}),(0,W.Z)((0,He.Z)(o),"transforms",[]),(0,W.Z)((0,He.Z)(o),"cluster",!1),(0,W.Z)((0,He.Z)(o),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,W.Z)((0,He.Z)(o),"invalidExtent",!1),(0,W.Z)((0,He.Z)(o),"dataArrayChanged",!1),(0,W.Z)((0,He.Z)(o),"cfg",{autoRender:!0}),o.originData=n,o.initCfg(r),o.init().then(function(){o.inited=!0,o.emit("update",{type:"inited"})}),o}return(0,zt.Z)(t,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(r){return this.clusterIndex.getClusters(this.caculClusterExtent(2),r)}},{key:"getClustersLeaves",value:function(r){return this.clusterIndex.getLeaves(r,Infinity)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(r){var o=this,u=this.clusterOptions,l=u.method,p=l===void 0?"sum":l,v=u.field,x=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(r));this.clusterOptions.zoom=r,x.forEach(function(E){E.id||(E.properties.point_count=1)}),(v||(0,ur.isFunction)(p))&&(x=x.map(function(E){var A=E.id;if(A){var T=o.clusterIndex.getLeaves(A,Infinity),L=T.map(function(H){return H.properties}),F;if((0,ur.isString)(p)&&v){var z=s(L,v);F=dC[p](z)}(0,ur.isFunction)(p)&&(F=p(L)),E.properties.stat=F}else E.properties.point_count=1;return E})),this.data=sr("geojson")({type:"FeatureCollection",features:x}),this.executeTrans()}},{key:"getFeatureById",value:function(r){var o=this.parser,u=o.type,l=u===void 0?"geojson":u,p=o.geometry;if(l==="geojson"&&!this.cluster){var v=r<this.originData.features.length?this.originData.features[r]:"null",x=(0,ur.cloneDeep)(v);if(x!=null&&x.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var E=this.data.dataArray.find(function(A){return A._id===r});x.properties=E}return x}else return l==="json"&&p?this.data.dataArray.find(function(A){return A._id===r}):r<this.data.dataArray.length?this.data.dataArray[r]:"null"}},{key:"updateFeaturePropertiesById",value:function(r,o){this.data.dataArray=this.data.dataArray.map(function(u){return u._id===r?(0,mt.Z)((0,mt.Z)({},u),o):u}),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(r,o){var u=this.data.dataArray.find(function(l){return l[r]===o});return u==null?void 0:u._id}},{key:"setData",value:function(r,o){var u=this;this.originData=r,this.dataArrayChanged=!1,this.initCfg(o),this.init().then(function(){u.emit("update",{type:"update"})})}},{key:"destroy",value:function(){var r;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(r=this.tileset)===null||r===void 0||r.destroy()}},{key:"processData",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u=this;return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,new Promise(function(v,x){try{u.excuteParser(),u.initCluster(),u.executeTrans(),v({})}catch(E){x(E)}});case 2:return p.abrupt("return",p.sent);case 3:case"end":return p.stop()}},o)}));function r(){return n.apply(this,arguments)}return r}()},{key:"initCfg",value:function(r){this.cfg=(0,ur.mergeWith)(this.cfg,r,gC);var o=this.cfg;o&&(o.parser&&(this.parser=o.parser),o.transforms&&(this.transforms=o.transforms),this.cluster=o.cluster||!1,o.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,mt.Z)((0,mt.Z)({},this.clusterOptions),o.clusterOptions)))}},{key:"init",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.inited=!1,l.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"excuteParser",value:function(){var r=this.parser,o=r.type||"geojson",u=sr(o);this.data=u(this.originData,r),this.tileset=this.initTileset(),!r.cancelExtent&&(this.extent=f(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(r){this.center=[(r[0]+r[2])/2,(r[1]+r[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var r=this.data.tilesetOptions;if(!!r){if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(r),this.tileset;var o=new Ei((0,mt.Z)({},r));return o}}},{key:"executeTrans",value:function(){var r=this,o=this.transforms;o.forEach(function(u){var l=u.type,p=ae(l)(r.data,u);Object.assign(r.data,p)})}},{key:"initCluster",value:function(){if(!!this.cluster){var r=this.clusterOptions||{};this.clusterIndex=t1(this.data,r)}}},{key:"caculClusterExtent",value:function(r){var o=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(o=nt(it(this.extent),r)),o[0].concat(o[1])}}]),t}(Er.EventEmitter);function _C(e,i){var t=i.callback;return t&&(e.dataArray=e.dataArray.filter(t)),e}function n1(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=xC(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function xC(e,i){if(!!e){if(typeof e=="string")return i1(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return i1(e,i)}}function i1(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}var Om=6378e3;function bC(e,i){var t=e.dataArray,n=i.size,r=n===void 0?10:n,o=r/(2*Math.PI*Om)*(256<<20)/2,u=EC(t,r),l=u.gridHash,p=u.gridOffset,v=AC(l,p,i);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:v}}function EC(e,i){var t=Infinity,n=-Infinity,r,o=n1(e),u;try{for(o.s();!(u=o.n()).done;){var l=u.value;r=l.coordinates[1],Number.isFinite(r)&&(t=r<t?r:t,n=r>n?r:n)}}catch(oe){o.e(oe)}finally{o.f()}var p=(t+n)/2,v=SC(i,p);if(v.xOffset<=0||v.yOffset<=0)return{gridHash:{},gridOffset:v};var x={},E=n1(e),A;try{for(E.s();!(A=E.n()).done;){var T=A.value,L=T.coordinates[1],F=T.coordinates[0];if(Number.isFinite(L)&&Number.isFinite(F)){var z=Math.floor((L+90)/v.yOffset),H=Math.floor((F+180)/v.xOffset),ne="".concat(z,"-").concat(H);x[ne]=x[ne]||{count:0,points:[]},x[ne].count+=1,x[ne].points.push(T)}}}catch(oe){E.e(oe)}finally{E.f()}return{gridHash:x,gridOffset:v}}function SC(e,i){var t=wC(e),n=CC(i,e);return{yOffset:t,xOffset:n}}function wC(e){return e/Om*(180/Math.PI)}function CC(e,i){return i/Om*(180/Math.PI)/Math.cos(e*Math.PI/180)}function AC(e,i,t){return Object.keys(e).reduce(function(n,r,o){var u=r.split("-"),l=parseInt(u[0],10),p=parseInt(u[1],10),v={};if(t.field&&t.method){var x=jl(e[r].points,t.field);v[t.method]=mc[t.method](x)}return Object.assign(v,{_id:o,coordinates:Q([-180+i.xOffset*(p+.5),-90+i.yOffset*(l+.5)]),rawData:e[r].points,count:e[r].count}),n.push(v),n},[])}var hd=Math.PI/3,TC=[0,hd,2*hd,3*hd,4*hd,5*hd];function MC(e){return e[0]}function kC(e){return e[1]}function IC(){var e=0,i=0,t=1,n=1,r=MC,o=kC,u,l,p;function v(E){var A={},T=[],L,F=E.length;for(L=0;L<F;++L)if(!(isNaN(H=+r.call(null,z=E[L],L,E))||isNaN(ne=+o.call(null,z,L,E)))){var z,H,ne,oe=Math.round(ne=ne/p),ke=Math.round(H=H/l-(oe&1)/2),De=ne-oe;if(Math.abs(De)*3>1){var ft=H-ke,At=ke+(H<ke?-1:1)/2,Nt=oe+(ne<oe?-1:1),Gt=H-At,xr=ne-Nt;ft*ft+De*De>Gt*Gt+xr*xr&&(ke=At+(oe&1?1:-1)/2,oe=Nt)}var dr=ke+"-"+oe,zr=A[dr];zr?zr.push(z):(T.push(zr=A[dr]=[z]),zr.x=(ke+(oe&1)/2)*l,zr.y=oe*p)}return T}function x(E){var A=0,T=0;return TC.map(function(L){var F=Math.sin(L)*E,z=-Math.cos(L)*E,H=F-A,ne=z-T;return A=F,T=z,[H,ne]})}return v.hexagon=function(E){return"m"+x(E==null?u:+E).join("l")+"z"},v.centers=function(){for(var E=[],A=Math.round(i/p),T=Math.round(e/l),L=A*p;L<n+u;L+=p,++A)for(var F=T*l+(A&1)*l/2;F<t+l/2;F+=l)E.push([F,L]);return E},v.mesh=function(){var E=x(u).slice(0,4).join("l");return v.centers().map(function(A){return"M"+A+"m"+E}).join("")},v.x=function(E){return arguments.length?(r=E,v):r},v.y=function(E){return arguments.length?(o=E,v):o},v.radius=function(E){return arguments.length?(u=+E,l=u*2*Math.sin(hd),p=u*1.5,v):u},v.size=function(E){return arguments.length?(e=i=0,t=+E[0],n=+E[1],v):[t-e,n-i]},v.extent=function(E){return arguments.length?(e=+E[0][0],i=+E[0][1],t=+E[1][0],n=+E[1][1],v):[[e,i],[t,n]]},v.radius(1)}var PC=6378e3;function RC(e,i){var t=e.dataArray,n=i.size,r=n===void 0?10:n,o=i.method,u=o===void 0?"sum":o,l=r/(2*Math.PI*PC)*(256<<20)/2,p=t.map(function(A){var T=Q(A.coordinates),L=(0,$n.Z)(T,2),F=L[0],z=L[1];return(0,mt.Z)((0,mt.Z)({},A),{},{coordinates:[F,z]})}),v=IC().radius(l).x(function(A){return A.coordinates[0]}).y(function(A){return A.coordinates[1]}),x=v(p),E={dataArray:x.map(function(A,T){var L;if(i.field&&u){var F=jl(A,i.field);A[u]=mc[u](F)}return L={},(0,W.Z)(L,i.method,A[u]),(0,W.Z)(L,"count",A.length),(0,W.Z)(L,"rawData",A),(0,W.Z)(L,"coordinates",[A.x,A.y]),(0,W.Z)(L,"_id",T),L}),radius:l,xOffset:l,yOffset:l,type:"hexagon"};return E}function LC(e,i){var t=i.sourceField,n=i.targetField,r=i.data,o={};return r.forEach(function(u){o[u[t]]=u}),e.dataArray=e.dataArray.map(function(u){var l=u[n];return(0,mt.Z)((0,mt.Z)({},u),o[l])}),e}function OC(e,i){var t=i.callback;return t&&(e.dataArray=e.dataArray.map(t)),e}Ir("rasterTile",aC),Ir("mvt",Ne),Ir("geojsonvt",ls),Ir("testTile",uC),Ir("geojson",$a),Ir("image",Wo),Ir("csv",Ji),Ir("json",zi),Ir("raster",S),Ir("rasterRgb",D),Ze("cluster",t1),Ze("filter",_C),Ze("join",LC),Ze("map",OC),Ze("grid",bC),Ze("hexagon",RC);var Fm=yC;function FC(e){var i=DC();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function DC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var a1=function(e){(0,Dr.Z)(t,e);var i=FC(t);function t(n){var r;return(0,wt.Z)(this,t),r=i.call(this),(0,W.Z)((0,He.Z)(r),"added",!1),(0,W.Z)((0,He.Z)(r),"eventHandle",function(o){r.emit(o.type,{target:o,data:r.markerOption.extData,lngLat:r.lngLat})}),r.markerOption=(0,mt.Z)((0,mt.Z)({},r.getDefault()),n),oi(["update","onMove","onMapClick"],(0,He.Z)(r)),r.init(),r}return(0,zt.Z)(t,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:qa.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(r){this.scene=r,this.mapsService=r.get(V.IMapService),this.sceneSerive=r.get(V.ISceneService);var o=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var r=this.markerOption.element;return r&&no(r),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(r){return this.lngLat=r,Array.isArray(r)&&(this.lngLat={lng:r[0],lat:r[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(r){var o=this;if(!this.added)return this.once("added",function(){o.setElement(r)}),this;var u=this.markerOption.element;return u&&no(u),this.markerOption.element=r,this.init(),this.mapsService.getMarkerContainer().appendChild(r),this.registerMarkerEvent(r),this.update(),this}},{key:"openPopup",value:function(){var r=this;if(!this.added)return this.once("added",function(){r.openPopup()}),this;var o=this.popup;return o?(o.isOpen()||o.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var r=this;this.added||this.once("added",function(){r.closePopup()});var o=this.popup;return o&&o.remove(),this}},{key:"setPopup",value:function(r){return this.popup=r,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var r=this.popup;if(r)r.isOpen()?r.remove():r.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(r){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(r){this.markerOption.extData=r}},{key:"update",value:function(){if(!!this.mapsService){var r=this.markerOption,o=r.element,u=r.anchor;this.updatePosition(),Af(o,"".concat(io[u]))}}},{key:"onMapClick",value:function(r){var o=this.markerOption.element;this.popup&&o&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var r=this.mapsService.getContainer();return{containerHeight:(r==null?void 0:r.scrollHeight)||0,containerWidth:(r==null?void 0:r.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var r=this.markerOption,o=r.element,u=r.offsets,l=this.lngLat,p=l.lng,v=l.lat,x=this.mapsService.lngLatToContainer([p,v]);if(o){o.style.display="block",o.style.whiteSpace="nowrap";var E=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),A=E.containerHeight,T=E.containerWidth,L=E.bounds;if(!L)return;if(Math.abs(L[0][0])>180||Math.abs(L[1][0])>180){if(x.x>T){var F=this.mapsService.lngLatToContainer([p-360,v]);x.x=F.x}if(x.x<0){var z=this.mapsService.lngLatToContainer([p+360,v]);x.x=z.x}}(x.x>T||x.x<0||x.y>A||x.y<0)&&(o.style.display="none"),o.style.left=x.x+u[0]+"px",o.style.top=x.y-u[1]+"px"}}}},{key:"init",value:function(){var r=this,o=this.markerOption.element,u=this.markerOption,l=u.color,p=u.anchor;if(!o){this.defaultMarker=!0,o=ri("div"),this.markerOption.element=o;var v=document.createElementNS("http://www.w3.org/2000/svg","svg");v.setAttributeNS(null,"display","block"),v.setAttributeNS(null,"height","48px"),v.setAttributeNS(null,"width","48px"),v.setAttributeNS(null,"viewBox","0 0 1024 1024");var x=document.createElementNS("http://www.w3.org/2000/svg","path");x.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),x.setAttributeNS(null,"fill",l),v.appendChild(x),o.appendChild(v)}Ns(o,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(E){var A,T,L=((A=r.markerOption)===null||A===void 0?void 0:A.style)&&((T=r.markerOption)===null||T===void 0?void 0:T.style[E]);o&&(o.style[E]=L)}),o.addEventListener("click",function(E){r.onMapClick(E)}),o.addEventListener("click",this.eventHandle),Ls(o,p,"marker")}},{key:"registerMarkerEvent",value:function(r){r.addEventListener("mousemove",this.eventHandle),r.addEventListener("click",this.eventHandle),r.addEventListener("mousedown",this.eventHandle),r.addEventListener("mouseup",this.eventHandle),r.addEventListener("dblclick",this.eventHandle),r.addEventListener("contextmenu",this.eventHandle),r.addEventListener("mouseover",this.eventHandle),r.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var r=this.getElement();r.removeEventListener("mousemove",this.eventHandle),r.removeEventListener("click",this.eventHandle),r.removeEventListener("mousedown",this.eventHandle),r.removeEventListener("mouseup",this.eventHandle),r.removeEventListener("dblclick",this.eventHandle),r.removeEventListener("contextmenu",this.eventHandle),r.removeEventListener("mouseover",this.eventHandle),r.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(r){return null}},{key:"onUp",value:function(r){throw new Error("Method not implemented.")}}]),t}(Er.EventEmitter);function BC(e){var i=NC();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function NC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var U8=function(e){(0,Dr.Z)(t,e);var i=BC(t);function t(n){var r,o;return(0,wt.Z)(this,t),o=i.call(this),(0,W.Z)((0,He.Z)(o),"markers",[]),(0,W.Z)((0,He.Z)(o),"points",[]),(0,W.Z)((0,He.Z)(o),"clusterMarkers",[]),o.markerLayerOption=(0,ur.merge)(o.getDefault(),n),oi(["update"],(0,He.Z)(o)),o.zoom=((r=o.markerLayerOption.clusterOption)===null||r===void 0?void 0:r.zoom)||-99,o}return(0,zt.Z)(t,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(r){return this.scene=r,this.mapsService=r.get(V.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(!!this.mapsService){var r=this.mapsService.getContainer();this.containerSize={containerWidth:(r==null?void 0:r.scrollWidth)||0,containerHeight:(r==null?void 0:r.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(r){var o=this.markerLayerOption.cluster;if(r.getMarkerLayerContainerSize=this.getContainerSize.bind(this),o&&(this.addPoint(r,this.markers.length),this.mapsService)){var u=this.mapsService.getZoom(),l=this.mapsService.getBounds();this.bbox=nt(l,.5),this.zoom=Math.floor(u),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(r)}},{key:"removeMarker",value:function(r){this.markers.indexOf(r);var o=this.markers.indexOf(r);o>-1&&this.markers.splice(o,1)}},{key:"hide",value:function(){this.markers.map(function(r){r.getElement().style.opacity="0"}),this.clusterMarkers.map(function(r){r.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(r){r.getElement().style.opacity="1"}),this.clusterMarkers.map(function(r){r.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var r=this.markerLayerOption.cluster;return r?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var r=this;this.getMarkers().forEach(function(o){o.addTo(r.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(r){r.remove()}),this.clusterMarkers.forEach(function(r){r.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(r,o){var u=r.getLnglat(),l=u.lng,p=u.lat,v={geometry:{type:"Point",coordinates:[l,p]},properties:(0,mt.Z)((0,mt.Z)({},r.getExtData()),{},{marker_id:o})};this.points.push(v),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var r=this.markerLayerOption.clusterOption,o=r.radius,u=r.minZoom,l=u===void 0?0:u,p=r.maxZoom;this.clusterIndex=new(e1())({radius:o,minZoom:l,maxZoom:p}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(r,o){var u=this,l=r[0].concat(r[1]),p=this.clusterIndex.getClusters(l,o);this.clusterMarkers.forEach(function(v){v.remove()}),this.clusterMarkers=[],p.forEach(function(v){var x,E=u.markerLayerOption.clusterOption,A=E.field,T=E.method;if((x=v.properties)!==null&&x!==void 0&&x.cluster_id){var L,F=u.getLeaves((L=v.properties)===null||L===void 0?void 0:L.cluster_id);if(v.properties.clusterData=F,A&&T){var z=F==null?void 0:F.map(function(De){var ft=(0,W.Z)({},A,De.properties[A]);return ft}),H=jl(z,A),ne=wa(T,H),oe="point_"+T;v.properties[oe]=ne.toFixed(2)}}var ke=u.clusterMarker(v);u.clusterMarkers.push(ke),ke.addTo(u.scene)})}},{key:"getLeaves",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return r?this.clusterIndex.getLeaves(r,o,u):null}},{key:"clusterMarker",value:function(r){var o=this.markerLayerOption.clusterOption,u=o,l=u.element,p=l===void 0?this.generateElement.bind(this):l,v=new a1({element:p(r)}).setLnglat({lng:r.geometry.coordinates[0],lat:r.geometry.coordinates[1]});return v}},{key:"normalMarker",value:function(r){var o=r.properties.marker_id;return this.markers[o]}},{key:"update",value:function(){if(!!this.mapsService&&this.markers.length!==0){var r=this.mapsService.getZoom(),o=this.mapsService.getBounds();(!this.bbox||Math.abs(r-this.zoom)>=1||!Fe(this.bbox,o))&&(this.bbox=nt(o,.5),this.zoom=Math.floor(r),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(r){var o=ri("div","l7-marker-cluster"),u=ri("div","",o),l=ri("span","",u),p=this.markerLayerOption.clusterOption,v=p.field,x=p.method;r.properties.point_count=r.properties.point_count||1;var E=v&&x?r.properties["point_"+x]||r.properties[v]:r.properties.point_count;return l.textContent=E,o}}]),t}(Er.EventEmitter),V8=ee(4157);function zC(e){var i=ZC();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function ZC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pd=function(e){(0,Dr.Z)(t,e);var i=zC(t);function t(n){var r;return(0,wt.Z)(this,t),r=i.call(this),t.controlCount++,r.controlOption=(0,mt.Z)((0,mt.Z)({},r.getDefault(n)),n||{}),r}return(0,zt.Z)(t,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(r){var o=this.getDefault(r);Object.entries(r).forEach(function(u){var l=(0,$n.Z)(u,2),p=l[0],v=l[1];v===void 0&&(r[p]=o[p])}),"position"in r&&this.setPosition(r.position),"className"in r&&this.setClassName(r.className),"style"in r&&this.setStyle(r.style),this.controlOption=(0,mt.Z)((0,mt.Z)({},this.controlOption),r)}},{key:"addTo",value:function(r){this.mapsService=r.get(V.IMapService),this.renderService=r.get(V.IRendererService),this.layerService=r.get(V.ILayerService),this.controlService=r.get(V.IControlService),this.configService=r.get(V.IGlobalConfigService),this.scene=r.get(V.ISceneService),this.sceneContainer=r,this.isShow=!0,this.container=this.onAdd(),Ns(this.container,"l7-control");var o=this.controlOption,u=o.className,l=o.style;return u&&this.setClassName(u),l&&this.setStyle(l),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;no(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return ri("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var r=this.container;Ps(r,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var r=this.container;Ns(r,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(r){return{position:Al.TOPRIGHT,name:"".concat(t.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(r){if(this.mapsService&&r&&r.screenX>0&&r.screenY>0){var o=this.mapsService.getContainer();o!==null&&o.focus()}}},{key:"setPosition",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Al.TOPLEFT,o=this.controlService;return o&&o.removeControl(this),this.controlOption.position=r,o&&o.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(r){var o=this.container,u=this.controlOption.className;u&&Ps(o,u),r&&Ns(o,r)}},{key:"setStyle",value:function(r){var o=this.container;r?o.setAttribute("style",r):o.removeAttribute("style")}},{key:"insertContainer",value:function(){var r=this.controlOption.position,o=this.container;if(r instanceof Element)r.appendChild(o);else{var u=this.controlService.controlCorners[r];r.indexOf("bottom")!==-1?u.insertBefore(o,u.firstChild):u.appendChild(o)}}},{key:"checkUpdateOption",value:function(r,o){return o.some(function(u){return u in r})}}]),t}(Jr());(0,W.Z)(pd,"controlCount",0);function UC(e){var i=VC();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function VC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var h0=function(e){(0,Dr.Z)(t,e);var i=UC(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"isDisable",!1),n}return(0,zt.Z)(t,[{key:"setIsDisable",value:function(r){if(this.isDisable=r,r){var o;(o=this.button)===null||o===void 0||o.setAttribute("disabled","true")}else{var u;(u=this.button)===null||u===void 0||u.removeAttribute("disabled")}}},{key:"createButton",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return ri("button","l7-button-control ".concat(r))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var r=this.controlOption,o=r.title,u=r.btnText,l=r.btnIcon;return this.setBtnTitle(o),this.setBtnText(u),this.setBtnIcon(l),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(r){var o=r.title,u=r.btnText,l=r.btnIcon;this.checkUpdateOption(r,["title"])&&this.setBtnTitle(o),this.checkUpdateOption(r,["btnIcon"])&&this.setBtnIcon(l),this.checkUpdateOption(r,["btnText"])&&this.setBtnText(u),(0,Qa.Z)((0,Qe.Z)(t.prototype),"setOptions",this).call(this,r)}},{key:"setBtnTitle",value:function(r){var o;(o=this.button)===null||o===void 0||o.setAttribute("title",r!=null?r:"")}},{key:"setBtnIcon",value:function(r){if(this.buttonIcon&&no(this.buttonIcon),r){var o,u=(o=this.button)===null||o===void 0?void 0:o.firstChild;if(u){var l;(l=this.button)===null||l===void 0||l.insertBefore(r,u)}else{var p;(p=this.button)===null||p===void 0||p.appendChild(r)}this.buttonIcon=r}}},{key:"setBtnText",value:function(r){if(!!this.button)if(Ps(this.button,"l7-button-control--row"),Ps(this.button,"l7-button-control--column"),r){var o=this.buttonText;if(!o){var u;o=ri("div","l7-button-control__text"),(u=this.button)===null||u===void 0||u.appendChild(o),this.buttonText=o}o.innerText=r,Ns(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!r&&this.buttonText&&(no(this.buttonText),this.buttonText=void 0)}}]),t}(pd);function jC(e){var i=GC();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function GC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var o1=function(e){(0,Dr.Z)(t,e);var i=jC(t);function t(n,r){var o;return(0,wt.Z)(this,t),o=i.call(this),(0,W.Z)((0,He.Z)(o),"isShow",!1),(0,W.Z)((0,He.Z)(o),"timeout",null),(0,W.Z)((0,He.Z)(o),"show",function(){return o.isShow||!o.contentDOM.innerHTML||(o.resetPopperPosition(),Ps(o.popperDOM,"l7-popper-hide"),o.isShow=!0,o.option.unique&&t.conflictPopperList.forEach(function(u){u!==(0,He.Z)(o)&&u.isShow&&u.hide()}),o.emit("show")),(0,He.Z)(o)}),(0,W.Z)((0,He.Z)(o),"hide",function(){return o.isShow&&(Ns(o.popperDOM,"l7-popper-hide"),o.isShow=!1,o.emit("hide")),(0,He.Z)(o)}),(0,W.Z)((0,He.Z)(o),"setHideTimeout",function(){o.timeout||(o.timeout=window.setTimeout(function(){!o.isShow||(o.hide(),o.timeout=null)},300))}),(0,W.Z)((0,He.Z)(o),"clearHideTimeout",function(){o.timeout&&(window.clearTimeout(o.timeout),o.timeout=null)}),(0,W.Z)((0,He.Z)(o),"onBtnClick",function(){o.isShow?o.hide():o.show()}),(0,W.Z)((0,He.Z)(o),"onBtnMouseLeave",function(){o.setHideTimeout()}),(0,W.Z)((0,He.Z)(o),"onBtnMouseMove",function(){o.clearHideTimeout(),!o.isShow&&o.show()}),o.button=n,o.option=r,o.init(),r.unique&&t.conflictPopperList.push((0,He.Z)(o)),o}return(0,zt.Z)(t,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(r){typeof r=="string"?this.contentDOM.innerHTML=r:r instanceof HTMLElement&&(Rs(this.contentDOM),this.contentDOM.appendChild(r)),this.content=r}},{key:"init",value:function(){var r=this.option.trigger;this.popperDOM=this.createPopper(),r==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),no(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var r={},o=this.option,u=o.container,l=o.offset,p=l===void 0?[0,0]:l,v=o.placement,x=(0,$n.Z)(p,2),E=x[0],A=x[1],T=this.button.getBoundingClientRect(),L=u.getBoundingClientRect(),F=qs(T,L),z=F.left,H=F.right,ne=F.top,oe=F.bottom,ke=!1,De=!1;/^(left|right)/.test(v)?(v.includes("left")?r.right="".concat(T.width+H,"px"):v.includes("right")&&(r.left="".concat(T.width+z,"px")),v.includes("start")?r.top="".concat(ne,"px"):v.includes("end")?r.bottom="".concat(oe,"px"):(r.top="".concat(ne+T.height/2,"px"),De=!0,r.transform="translate(".concat(E,"px, calc(").concat(A,"px - 50%))"))):/^(top|bottom)/.test(v)&&(v.includes("top")?r.bottom="".concat(T.height+oe,"px"):v.includes("bottom")&&(r.top="".concat(T.height+ne,"px")),v.includes("start")?r.left="".concat(z,"px"):v.includes("end")?r.right="".concat(H,"px"):(r.left="".concat(z+T.width/2,"px"),ke=!0,r.transform="translate(calc(".concat(E,"px - 50%), ").concat(A,"px)"))),r.transform="translate(calc(".concat(E,"px - ").concat(ke?"50%":"0%","), calc(").concat(A,"px - ").concat(De?"50%":"0%",")");var ft=v.split("-");ft.length&&Ns(this.popperDOM,ft.map(function(At){return"l7-popper-".concat(At)}).join(" ")),su(this.popperDOM,vl(r))}},{key:"createPopper",value:function(){var r=this.option,o=r.container,u=r.className,l=u===void 0?"":u,p=r.content,v=ri("div","l7-popper l7-popper-hide ".concat(l)),x=ri("div","l7-popper-content"),E=ri("div","l7-popper-arrow");return v.appendChild(x),v.appendChild(E),o.appendChild(v),this.popperDOM=v,this.contentDOM=x,p&&this.setContent(p),v}}]),t}(Er.EventEmitter);(0,W.Z)(o1,"conflictPopperList",[]);function HC(e){var i=WC();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function WC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XC={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},$C=function(e){(0,Dr.Z)(t,e);var i=HC(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),(0,Qa.Z)((0,Qe.Z)(t.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(r){var o,u=(0,Qa.Z)((0,Qe.Z)(t.prototype),"getDefault",this).call(this,r),l=(o=r==null?void 0:r.position)!==null&&o!==void 0?o:u.position;return(0,mt.Z)((0,mt.Z)({},(0,Qa.Z)((0,Qe.Z)(t.prototype),"getDefault",this).call(this,r)),{},{popperPlacement:l instanceof Element?"bottom":XC[l],popperTrigger:"click"})}},{key:"onAdd",value:function(){var r=(0,Qa.Z)((0,Qe.Z)(t.prototype),"onAdd",this).call(this);return this.initPopper(),r}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var r=this,o=this.controlOption,u=o.popperClassName,l=o.popperPlacement,p=o.popperTrigger,v=this.mapsService.getMapContainer();return this.popper=new o1(this.button,{className:u,placement:l,trigger:p,container:v,unique:!0}),this.popper.on("show",function(){r.emit("popperShow",r)}).on("hide",function(){r.emit("popperHide",r)}),this.popper}},{key:"setOptions",value:function(r){if((0,Qa.Z)((0,Qe.Z)(t.prototype),"setOptions",this).call(this,r),this.checkUpdateOption(r,["popperPlacement","popperTrigger","popperClassName"])){var o=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(o)}}}]),t}(h0);function YC(e){var i=qC();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function qC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mh;(function(e){e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index"})(mh||(mh={}));var s1=function(e){(0,Dr.Z)(t,e);var i=YC(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"selectValue",[]),(0,W.Z)((0,He.Z)(n),"createNormalOption",function(l){var p=n.selectValue.includes(l.value),v=ri("div","l7-select-control-item ".concat(p?mh.ActiveOptionClassName:""));n.getIsMultiple()&&v.appendChild(n.createCheckbox(p)),l.icon&&v.appendChild(l.icon);var x=ri("span");return x.innerText=l.text,v.appendChild(x),v}),(0,W.Z)((0,He.Z)(n),"onItemClick",function(l){if(n.getIsMultiple()){var p=n.selectValue.findIndex(function(v){return v===l.value});p>-1?n.selectValue.splice(p,1):n.selectValue=[].concat((0,cr.Z)(n.selectValue),[l.value])}else n.selectValue=[l.value];n.setSelectValue(n.selectValue)}),n}return(0,zt.Z)(t,[{key:"setOptions",value:function(r){(0,Qa.Z)((0,Qe.Z)(t.prototype),"setOptions",this).call(this,r);var o=r.options;o&&this.popper.setContent(this.getPopperContent(o))}},{key:"onAdd",value:function(){var r=(0,Qa.Z)((0,Qe.Z)(t.prototype),"onAdd",this).call(this),o=this.controlOption.defaultValue;return o&&(this.selectValue=this.transSelectValue(o)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),r}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(r){var o=this,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,l=this.transSelectValue(r);this.optionDOMList.forEach(function(p){var v=p.getAttribute(mh.OptionValueAttrKey),x=o.getIsMultiple()?p.querySelector("input[type=checkbox]"):void 0;l.includes(v)?(Ns(p,mh.ActiveOptionClassName),x&&ps(x,!0)):(Ps(p,mh.ActiveOptionClassName),x&&ps(x,!1))}),this.selectValue=l,u&&this.emit("selectChange",this.getIsMultiple()?l:l[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(r){var o=this,u=this.isImageOptions(),l=ri("div",u?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&Ns(l,"l7-select-control--multiple");var p=r.map(function(v,x){var E=u?o.createImageOption(v):o.createNormalOption(v);return E.setAttribute(mh.OptionValueAttrKey,v.value),E.setAttribute(mh.OptionIndexAttrKey,window.String(x)),E.addEventListener("click",o.onItemClick.bind(o,v)),E});return l.append.apply(l,(0,cr.Z)(p)),this.optionDOMList=p,l}},{key:"createImageOption",value:function(r){var o=this.selectValue.includes(r.value),u=ri("div","l7-select-control-item ".concat(o?mh.ActiveOptionClassName:"")),l=ri("img");l.setAttribute("src",r.img),Qn(l),u.appendChild(l);var p=ri("div","l7-select-control-item-row");this.getIsMultiple()&&u.appendChild(this.createCheckbox(o));var v=ri("span");return v.innerText=r.text,p.appendChild(v),u.appendChild(p),u}},{key:"createCheckbox",value:function(r){var o=ri("input");return o.setAttribute("type","checkbox"),r&&ps(o,!0),o}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find(function(r){return r.img})}},{key:"transSelectValue",value:function(r){return Array.isArray(r)?r:[r]}}]),t}($C);function KC(e){var i=QC();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function QC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var u1=function(e){(0,Dr.Z)(t,e);var i=KC(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getDefault",value:function(){return{position:Al.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var r=ri("div","l7-control-logo");return this.setLogoContent(r),r}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(r){(0,Qa.Z)((0,Qe.Z)(t.prototype),"setOptions",this).call(this,r),this.checkUpdateOption(r,["img","href"])&&(Rs(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(r){var o=this.controlOption,u=o.href,l=o.img,p=ri("img");if(p.setAttribute("src",l),p.setAttribute("aria-label","AntV logo"),Qn(p),u){var v=ri("a","l7-control-logo-link");v.target="_blank",v.href=u,v.rel="noopener nofollow",v.setAttribute("rel","noopener nofollow"),v.appendChild(p),r.appendChild(v)}else r.appendChild(p)}}]),t}(pd),gh=function(i){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(i)),t.appendChild(n),t};function l1(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=JC(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function JC(e,i){if(!!e){if(typeof e=="string")return c1(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return c1(e,i)}}function c1(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}var f1=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],yh=function(){if(typeof document=="undefined")return!1;var e=f1[0],i={},t=l1(f1),n;try{for(t.s();!(n=t.n()).done;){var r=n.value,o=r==null?void 0:r[1];if(o in document){var u=l1(r.entries()),l;try{for(u.s();!(l=u.n()).done;){var p=(0,$n.Z)(l.value,2),v=p[0],x=p[1];i[e[v]]=x}}catch(E){u.e(E)}finally{u.f()}return i}}}catch(E){t.e(E)}finally{t.f()}return!1}(),h1={change:yh.fullscreenchange,error:yh.fullscreenerror},oc={request:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document.documentElement,t=arguments.length>1?arguments[1]:void 0;return new Promise(function(n,r){var o=function l(){oc.off("change",l),n()};oc.on("change",o);var u=i[yh.requestFullscreen](t);u instanceof Promise&&u.then(o).catch(r)})},exit:function(){return new Promise(function(i,t){if(!oc.isFullscreen){i();return}var n=function o(){oc.off("change",o),i()};oc.on("change",n);var r=document[yh.exitFullscreen]();r instanceof Promise&&r.then(n).catch(t)})},toggle:function(i,t){return oc.isFullscreen?oc.exit():oc.request(i,t)},onchange:function(i){oc.on("change",i)},onerror:function(i){oc.on("error",i)},on:function(i,t){var n=h1[i];n&&document.addEventListener(n,t,!1)},off:function(i,t){var n=h1[i];n&&document.removeEventListener(n,t,!1)},raw:yh};Object.defineProperties(oc,{isFullscreen:{get:function(){return Boolean(document[yh.fullscreenElement])}},element:{enumerable:!0,get:function(){var i;return(i=document[yh.fullscreenElement])!==null&&i!==void 0?i:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[yh.fullscreenEnabled])}}}),yh||(oc={isEnabled:!1});var Dm=oc;function eA(e){var i=tA();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function tA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rA=function(e){(0,Dr.Z)(t,e);var i=eA(t);function t(n){var r;return(0,wt.Z)(this,t),r=i.call(this,n),(0,W.Z)((0,He.Z)(r),"isFullscreen",!1),(0,W.Z)((0,He.Z)(r),"toggleFullscreen",(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!Dm.isEnabled){l.next=3;break}return l.next=3,Dm.toggle(r.mapContainer);case 3:case"end":return l.stop()}},o)}))),(0,W.Z)((0,He.Z)(r),"onClick",function(){r.toggleFullscreen()}),(0,W.Z)((0,He.Z)(r),"onFullscreenChange",function(){r.isFullscreen=!!document.fullscreenElement;var o=r.controlOption,u=o.btnText,l=o.btnIcon,p=o.title,v=o.exitBtnText,x=o.exitBtnIcon,E=o.exitTitle;r.isFullscreen?(r.setBtnTitle(E),r.setBtnText(v),r.setBtnIcon(x)):(r.setBtnTitle(p),r.setBtnText(u),r.setBtnIcon(l)),r.emit("fullscreenChange",r.isFullscreen)}),Dm.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316"),r}return(0,zt.Z)(t,[{key:"setOptions",value:function(r){var o=r.exitBtnText,u=r.exitBtnIcon,l=r.exitTitle;this.isFullscreen&&(this.checkUpdateOption(r,["exitBtnIcon"])&&this.setBtnIcon(u),this.checkUpdateOption(r,["exitBtnText"])&&this.setBtnText(o),this.checkUpdateOption(r,["exitTitle"])&&this.setBtnTitle(l)),(0,Qa.Z)((0,Qe.Z)(t.prototype),"setOptions",this).call(this,r)}},{key:"onAdd",value:function(){var r=(0,Qa.Z)((0,Qe.Z)(t.prototype),"onAdd",this).call(this);return r.addEventListener("click",this.onClick),this.mapContainer=vn(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),r}},{key:"onRemove",value:function(){(0,Qa.Z)((0,Qe.Z)(t.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(r){return(0,mt.Z)((0,mt.Z)({},(0,Qa.Z)((0,Qe.Z)(t.prototype),"getDefault",this).call(this,r)),{},{title:"\u5168\u5C4F",btnIcon:gh("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:gh("l7-icon-exit-fullscreen")})}}]),t}(h0);function nA(e){var i=iA();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function iA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aA=function(e){(0,Dr.Z)(t,e);var i=nA(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"onClick",(0,Wt.Z)(be().mark(function l(){var p;return be().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(p=n.controlOption.onExport,p!=null){x.next=5;break}x.next=10;break;case 5:return x.t0=p,x.next=8,n.getImage();case 8:x.t1=x.sent,(0,x.t0)(x.t1);case 10:case"end":return x.stop()}},l)}))),(0,W.Z)((0,He.Z)(n),"mergeImage",(0,Wt.Z)(be().mark(function l(){var p,v,x,E,A,T,L,F,z,H,ne,oe,ke,De,ft=arguments;return be().wrap(function(Nt){for(;;)switch(Nt.prev=Nt.next){case 0:for(x=n.controlOption.imageType,E=(p=(v=n.mapsService.getContainer())===null||v===void 0?void 0:v.getBoundingClientRect())!==null&&p!==void 0?p:{},A=E.width,T=A===void 0?0:A,L=E.height,F=L===void 0?0:L,z=document.createElement("canvas"),z.width=T,z.height=F,H=z.getContext("2d"),ne=ft.length,oe=new Array(ne),ke=0;ke<ne;ke++)oe[ke]=ft[ke];return Nt.next=9,Promise.all(oe.map(function(Gt){return new Promise(function(xr){var dr=new Image;dr.onload=function(){xr(dr)},dr.src=Gt})}));case 9:return De=Nt.sent,De.forEach(function(Gt){H==null||H.drawImage(Gt,0,0,T,F)}),Nt.abrupt("return",z.toDataURL("image/".concat(x)));case 12:case"end":return Nt.stop()}},l)}))),n}return(0,zt.Z)(t,[{key:"onAdd",value:function(){var r=(0,Qa.Z)((0,Qe.Z)(t.prototype),"onAdd",this).call(this);return r.addEventListener("click",this.onClick),r}},{key:"getDefault",value:function(r){return(0,mt.Z)((0,mt.Z)({},(0,Qa.Z)((0,Qe.Z)(t.prototype),"getDefault",this).call(this,r)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:gh("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l;return be().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.mapsService.exportMap("png");case 2:return u=v.sent,v.next=5,this.scene.exportPng("png");case 5:return l=v.sent,v.abrupt("return",this.mergeImage(u,l));case 7:case"end":return v.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()}]),t}(h0);function oA(e){var i=sA();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function sA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uA=function(e){(0,Dr.Z)(t,e);var i=oA(t);function t(n){var r;return(0,wt.Z)(this,t),r=i.call(this,n),(0,W.Z)((0,He.Z)(r),"getGeoLocation",function(){return new Promise(function(o,u){window.navigator.geolocation.getCurrentPosition(function(l){var p=l.coords,v=p!=null?p:{},x=v.longitude,E=v.latitude;!(0,ur.isNaN)(x)&&!(0,ur.isNaN)(E)?o([x,E]):u()},function(l){u(l)})})}),(0,W.Z)((0,He.Z)(r),"onClick",(0,Wt.Z)(be().mark(function o(){var u,l,p;return be().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(window.navigator.geolocation){x.next=2;break}return x.abrupt("return");case 2:return u=r.controlOption.transform,x.next=5,r.getGeoLocation();case 5:if(l=x.sent,p=r.mapsService.getZoom(),x.t0=r.mapsService,x.t1=p>15?p:15,!u){x.next=15;break}return x.next=12,u(l);case 12:x.t2=x.sent,x.next=16;break;case 15:x.t2=l;case 16:x.t3=x.t2,x.t0.setZoomAndCenter.call(x.t0,x.t1,x.t3);case 18:case"end":return x.stop()}},o)}))),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D"),r}return(0,zt.Z)(t,[{key:"getDefault",value:function(r){return(0,mt.Z)((0,mt.Z)({},(0,Qa.Z)((0,Qe.Z)(t.prototype),"getDefault",this).call(this,r)),{},{title:"\u5B9A\u4F4D",btnIcon:gh("l7-icon-reposition")})}},{key:"onAdd",value:function(){var r=(0,Qa.Z)((0,Qe.Z)(t.prototype),"onAdd",this).call(this);return r.addEventListener("click",this.onClick),r}}]),t}(h0),lA={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u6708\u5149\u94F6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"\u8349\u8272\u9752",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"\u96C5\u58EB\u7070",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"\u6D82\u9E26",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"\u9171\u7C7D",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},cA={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u4EAE",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u6697",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"\u536B\u661F",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"\u6237\u5916",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}};function fA(e){var i=hA();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function hA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pA=function(e){(0,Dr.Z)(t,e);var i=fA(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"onMapThemeChange",function(){n.mapsService.setMapStyle(n.selectValue[0])}),n}return(0,zt.Z)(t,[{key:"getDefault",value:function(r){return(0,mt.Z)((0,mt.Z)({},(0,Qa.Z)((0,Qe.Z)(t.prototype),"getDefault",this).call(this,r)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:gh("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var r=this.mapsService.getType()==="mapbox"?cA:lA;return Object.entries(this.mapsService.getMapStyleConfig()).filter(function(o){var u=(0,$n.Z)(o,2),l=u[0],p=u[1];return typeof p=="string"&&l!=="blank"}).map(function(o){var u,l=(0,$n.Z)(o,2),p=l[0],v=l[1],x=(u=r[p])!==null&&u!==void 0?u:{},E=x.text,A=x.img;return{text:E!=null?E:p,value:v,img:A,key:p}})}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var r,o=this;if((r=this.controlOption.options)!==null&&r!==void 0&&r.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var u,l,p=this.controlOption.defaultValue;this.controlOption.defaultValue=(u=(l=this.controlOption.options.find(function(x){return x.key===p}))===null||l===void 0?void 0:l.value)!==null&&u!==void 0?u:p}else{var v=this.getMapStyle();v?this.controlOption.defaultValue=v:this.mapsService.map.once("styledata",function(){var x=o.mapsService.getMapStyle();o.controlOption.defaultValue=x,o.setSelectValue(x,!1)})}return this.on("selectChange",this.onMapThemeChange),(0,Qa.Z)((0,Qe.Z)(t.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),t}(s1);function dA(e){var i=vA();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function vA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var p1=function(e){(0,Dr.Z)(t,e);var i=dA(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"onLayerChange",function(){var l;(l=n.controlOption.layers)!==null&&l!==void 0&&l.length||(n.selectValue=n.getLayerVisible(),n.setOptions({options:n.getLayerOptions()}))}),(0,W.Z)((0,He.Z)(n),"onLayerVisibleChane",function(){n.setSelectValue(n.getLayerVisible())}),(0,W.Z)((0,He.Z)(n),"onSelectChange",function(){n.layers.forEach(function(l){var p=n.selectValue.includes(l.name),v=l.isVisible();p&&!v&&l.show(),!p&&v&&l.hide()})}),n}return(0,zt.Z)(t,[{key:"layers",get:function(){var r=this.layerService,o=this.controlOption.layers;if(Array.isArray(o)&&o.length){var u=[];return o.forEach(function(l){if(l instanceof Object&&u.push(l),typeof l=="string"){var p=r.getLayer(l)||r.getLayerByName(l);p&&u.push(p)}}),u}return r.getLayers()||[]}},{key:"getDefault",value:function(r){return(0,mt.Z)((0,mt.Z)({},(0,Qa.Z)((0,Qe.Z)(t.prototype),"getDefault",this).call(this,r)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:gh("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter(function(r){return r.isVisible()}).map(function(r){return r.name})}},{key:"getLayerOptions",value:function(){return this.layers.map(function(r){return{text:r.name,value:r.name}})}},{key:"setOptions",value:function(r){var o=this.checkUpdateOption(r,["layers"]);(0,Qa.Z)((0,Qe.Z)(t.prototype),"setOptions",this).call(this,r),o&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var r;return(r=this.controlOption.options)!==null&&r!==void 0&&r.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),(0,Qa.Z)((0,Qe.Z)(t.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),t}(s1);function mA(e){var i=gA();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function gA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yA=function(e){(0,Dr.Z)(t,e);var i=mA(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"location",[0,0]),(0,W.Z)((0,He.Z)(n),"onMouseMove",function(l){var p=n.location,v=l.lngLat||l.lnglat,x=n.controlOption.transform;v&&(p=[v.lng,v.lat]),n.location=p,x&&(p=x(p)),n.insertLocation2HTML(p),n.emit("locationChange",p)}),n}return(0,zt.Z)(t,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(r){return(0,mt.Z)((0,mt.Z)({},(0,Qa.Z)((0,Qe.Z)(t.prototype),"getDefault",this).call(this,r)),{},{position:Al.BOTTOMLEFT,transform:function(u){var l=(0,$n.Z)(u,2),p=l[0],v=l[1];return[+(+p).toFixed(6),+(+v).toFixed(6)]}})}},{key:"onAdd",value:function(){var r=ri("div","l7-control-mouse-location");return r.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),r}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(r){this.container.innerText=r.join(", ")}}]),t}(pd);function _A(e){var i=xA();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function xA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bA=function(e){(0,Dr.Z)(t,e);var i=_A(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"zoomIn",function(){!n.disabled&&n.mapsService.getZoom()<n.mapsService.getMaxZoom()&&n.mapsService.zoomIn()}),(0,W.Z)((0,He.Z)(n),"zoomOut",function(){!n.disabled&&n.mapsService.getZoom()>n.mapsService.getMinZoom()&&n.mapsService.zoomOut()}),(0,W.Z)((0,He.Z)(n),"updateDisabled",function(){var l=n.mapsService;n.zoomInButton.removeAttribute("disabled"),n.zoomOutButton.removeAttribute("disabled"),(n.disabled||l.getZoom()<=l.getMinZoom())&&n.zoomOutButton.setAttribute("disabled","true"),(n.disabled||l.getZoom()>=l.getMaxZoom())&&n.zoomInButton.setAttribute("disabled","true")}),n}return(0,zt.Z)(t,[{key:"getDefault",value:function(r){return(0,mt.Z)((0,mt.Z)({},(0,Qa.Z)((0,Qe.Z)(t.prototype),"getDefault",this).call(this,r)),{},{position:Al.BOTTOMRIGHT,name:"zoom",zoomInText:gh("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:gh("l7-icon-narrow"),zoomOutTitle:"Zoom out"})}},{key:"setOptions",value:function(r){(0,Qa.Z)((0,Qe.Z)(t.prototype),"setOptions",this).call(this,r),this.checkUpdateOption(r,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var r=ri("div","l7-control-zoom");return this.resetButtonGroup(r),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),r}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(r){Rs(r),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",r,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",r,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(r,o,u,l,p){var v=ri("button",u,l);return typeof r=="string"?v.innerHTML=r:v.append(r),v.title=o,v.addEventListener("click",p),v}}]),t}(pd);function EA(e){var i=SA();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function SA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wA=function(e){(0,Dr.Z)(t,e);var i=EA(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"update",function(){var l=n.mapsService,p=n.controlOption.maxWidth,v=l.getSize()[1]/2,x=l.containerToLngLat([0,v]),E=l.containerToLngLat([p,v]),A=je([x.lng,x.lat],[E.lng,E.lat]);n.updateScales(A)}),n}return(0,zt.Z)(t,[{key:"getDefault",value:function(r){return(0,mt.Z)((0,mt.Z)({},(0,Qa.Z)((0,Qe.Z)(t.prototype),"getDefault",this).call(this,r)),{},{name:"scale",position:Al.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var r="l7-control-scale",o=ri("div",r);this.resetScaleLines(o);var u=this.controlOption.updateWhenIdle;return this.mapsService.on(u?"moveend":"mapmove",this.update),this.mapsService.on(u?"zoomend":"zoomchange",this.update),o}},{key:"onRemove",value:function(){var r=this.controlOption.updateWhenIdle;this.mapsService.off(r?"zoomend":"zoomchange",this.update),this.mapsService.off(r?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(r){(0,Qa.Z)((0,Qe.Z)(t.prototype),"setOptions",this).call(this,r),this.checkUpdateOption(r,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(r){var o=this.controlOption,u=o.metric,l=o.imperial;u&&r&&this.updateMetric(r),l&&r&&this.updateImperial(r)}},{key:"resetScaleLines",value:function(r){Rs(r);var o=this.controlOption,u=o.metric,l=o.imperial,p=o.maxWidth,v=o.lockWidth;v&&su(r,"width: ".concat(p,"px")),u&&(this.mScale=ri("div","l7-control-scale-line",r)),l&&(this.iScale=ri("div","l7-control-scale-line",r)),this.update()}},{key:"updateScale",value:function(r,o,u){var l=this.controlOption.maxWidth;r.style.width=Math.round(l*u)+"px",r.innerHTML=o}},{key:"getRoundNum",value:function(r){var o=Math.pow(10,(Math.floor(r)+"").length-1),u=r/o;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:1,o*u}},{key:"updateMetric",value:function(r){var o=this.getRoundNum(r),u=o<1e3?o+" m":o/1e3+" km";this.updateScale(this.mScale,u,o/r)}},{key:"updateImperial",value:function(r){var o=r*3.2808399,u,l,p;o>5280?(u=o/5280,l=this.getRoundNum(u),this.updateScale(this.iScale,l+" mi",l/u)):(p=this.getRoundNum(o),this.updateScale(this.iScale,p+" ft",p/o))}}]),t}(pd);function CA(e){var i=AA();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function AA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Bm=function(e){(0,Dr.Z)(t,e);var i=CA(t);function t(n){var r;(0,wt.Z)(this,t),r=i.call(this),(0,W.Z)((0,He.Z)(r),"isShow",!0),(0,W.Z)((0,He.Z)(r),"onMouseMove",function(u){var l,p=r.mapsService.getMapContainer(),v=(l=p==null?void 0:p.getBoundingClientRect())!==null&&l!==void 0?l:{},x=v.left,E=x===void 0?0:x,A=v.top,T=A===void 0?0:A;r.setPopupPosition(u.clientX-E,u.clientY-T)}),(0,W.Z)((0,He.Z)(r),"updateLngLatPosition",function(){if(!(!r.mapsService||r.popupOption.followCursor)){var u=r.lngLat,l=u.lng,p=u.lat,v=r.mapsService.lngLatToContainer([l,p]),x=v.x,E=v.y;r.setPopupPosition(x,E)}}),(0,W.Z)((0,He.Z)(r),"onKeyDown",function(u){u.keyCode===27&&r.remove()}),(0,W.Z)((0,He.Z)(r),"onCloseButtonClick",function(u){u.stopPropagation&&u.stopPropagation(),r.hide()}),(0,W.Z)((0,He.Z)(r),"update",function(){var u=!!r.lngLat,l=r.popupOption,p=l.className,v=l.style,x=l.maxWidth,E=l.anchor,A=l.stopPropagation;if(!(!r.mapsService||!u||!r.content)){var T=r.mapsService.getMarkerContainer();if(!r.container&&T&&(r.container=ri("div","l7-popup ".concat(p!=null?p:""," ").concat(r.isShow?"":"l7-popup-hide"),T),v&&r.container.setAttribute("style",v),r.tip=ri("div","l7-popup-tip",r.container),r.container.appendChild(r.content),A&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(z){r.container.addEventListener(z,function(H){H.stopPropagation()})}),r.container.style.whiteSpace="nowrap"),r.updateLngLatPosition(),Af(r.container,"".concat(io[E])),Ls(r.container,E,"popup"),x){var L=r.container.getBoundingClientRect(),F=L.width;F>parseFloat(x)&&(r.container.style.width=x)}else r.container.style.removeProperty("width")}}),r.popupOption=(0,mt.Z)((0,mt.Z)({},r.getDefault(n!=null?n:{})),n);var o=r.popupOption.lngLat;return o&&(r.lngLat=o),r}return(0,zt.Z)(t,[{key:"lngLat",get:function(){var r;return(r=this.popupOption.lngLat)!==null&&r!==void 0?r:{lng:0,lat:0}},set:function(r){this.popupOption.lngLat=r}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(r){this.mapsService=r.get(V.IMapService),this.sceneService=r.get(V.ISceneService),this.layerService=r.get(V.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=r,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var o=this.popupOption,u=o.html,l=o.text,p=o.title;return u?this.setHTML(u):l&&this.setText(l),p&&this.setTitle(p),this.emit("open"),this}},{key:"remove",value:function(){if(!!(this!==null&&this!==void 0&&this.isOpen()))return this.content&&no(this.content),this.container&&(no(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(r){return this.show(),this.popupOption=(0,mt.Z)((0,mt.Z)({},this.popupOption),r),this.checkUpdateOption(r,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(no(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(r,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(r,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(r,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(r,["html"])&&r.html?this.setHTML(r.html):this.checkUpdateOption(r,["text"])&&r.text&&this.setText(r.text),this.checkUpdateOption(r,["lngLat"])&&r.lngLat&&this.setLnglat(r.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&Ps(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(!!this.isShow)return this.container&&Ns(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(r){return this.popupOption.html=r,this.setDOMContent(r)}},{key:"setText",value:function(r){return this.popupOption.text=r,this.setDOMContent(window.document.createTextNode(r))}},{key:"setTitle",value:function(r){this.show(),this.popupOption.title=r,r?(this.contentTitle||(this.contentTitle=ri("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),Rs(this.contentTitle),Bn(this.contentTitle,r)):this.contentTitle&&(no(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var r=this.lngLat,o=r.lng,u=r.lat;return this.popupOption.autoPan&&this.mapsService.panTo([o,u]),this}},{key:"setLngLat",value:function(r){return this.setLnglat(r)}},{key:"setLnglat",value:function(r){var o=this;return this.show(),this.lngLat=r,Array.isArray(r)&&(this.lngLat={lng:r[0],lat:r[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){o.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(r){return this.popupOption.maxWidth=r,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(r){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:qa.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(r){return this.show(),this.createContent(),Bn(this.contentPanel,r),this.update(),this}},{key:"updateCloseOnClick",value:function(r){var o=this,u=this.mapsService;u&&(u==null||u.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!r&&requestAnimationFrame(function(){u==null||u.on("click",o.onCloseButtonClick)}))}},{key:"updateCloseOnEsc",value:function(r){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!r&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(r){var o,u=(o=this.mapsService)===null||o===void 0?void 0:o.getContainer();u&&(u==null||u.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!r&&(u==null||u.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var r=this;if(this.content&&no(this.content),this.contentTitle=void 0,this.content=ri("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var o=gh("l7-icon-guanbi");Ns(o,"l7-popup-close-button"),this.content.appendChild(o),this.popupOption.closeButtonOffsets&&(o.style.right=this.popupOption.closeButtonOffsets[0]+"px",o.style.top=this.popupOption.closeButtonOffsets[1]+"px"),o.setAttribute("aria-label","Close popup"),o.addEventListener("click",function(){r.hide()}),this.closeButton=o}else this.closeButton=void 0;this.contentPanel=ri("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(r,o){if(this.container){var u=this.popupOption.offsets;this.container.style.left=r+u[0]+"px",this.container.style.top=o-u[1]+"px"}}},{key:"checkUpdateOption",value:function(r,o){return o.some(function(u){return u in r})}}]),t}(Er.EventEmitter);function TA(e){var i=MA();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function MA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var j8=function(e){(0,Dr.Z)(t,e);var i=TA(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"layerConfigMap",new WeakMap),n}return(0,zt.Z)(t,[{key:"layerConfigItems",get:function(){var r,o=this.popupOption,u=o.config,l=o.items;return(r=u!=null?u:l)!==null&&r!==void 0?r:[]}},{key:"addTo",value:function(r){return(0,Qa.Z)((0,Qe.Z)(t.prototype),"addTo",this).call(this,r),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return(0,Qa.Z)((0,Qe.Z)(t.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(r){return this.unbindLayerEvent(),(0,Qa.Z)((0,Qe.Z)(t.prototype),"setOptions",this).call(this,r),this.bindLayerEvent(),this}},{key:"getDefault",value:function(r){var o=r.trigger==="click";return(0,mt.Z)((0,mt.Z)({},(0,Qa.Z)((0,Qe.Z)(t.prototype),"getDefault",this).call(this,r)),{},{trigger:"hover",followCursor:!o,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!1,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var r=this,o=this.popupOption.trigger;this.layerConfigItems.forEach(function(u){var l,p=r.getLayerByConfig(u);if(!!p){var v=(0,mt.Z)({},u);if(o==="hover"){var x=r.onLayerMouseMove.bind(r,p),E=r.onLayerMouseOut.bind(r,p);v.onMouseMove=x,v.onMouseOut=E,p==null||p.on("mousemove",x),p==null||p.on("mouseout",E)}else{var A=r.onLayerClick.bind(r,p);v.onClick=A,p==null||p.on("click",A)}var T=p==null||(l=p.getSource)===null||l===void 0?void 0:l.call(p),L=r.onSourceUpdate.bind(r,p);T==null||T.on("update",L),v.onSourceUpdate=L,r.layerConfigMap.set(p,v)}})}},{key:"unbindLayerEvent",value:function(){var r=this;this.layerConfigItems.forEach(function(o){var u=r.getLayerByConfig(o),l=u&&r.layerConfigMap.get(u);if(!!l){var p=l.onMouseMove,v=l.onMouseOut,x=l.onClick,E=l.onSourceUpdate;if(p&&u.off("mousemove",p),v&&u.off("mouseout",v),x&&u.off("click",x),E){var A;u==null||(A=u.getSource())===null||A===void 0||A.off("update",E)}}})}},{key:"onLayerMouseMove",value:function(r,o){if(!this.isSameFeature(r,o.featureId)){var u=this.getLayerInfoFrag(r,o),l=u.title,p=u.content;this.setDOMContent(p),this.setTitle(l),this.displayFeatureInfo={layer:r,featureId:o.featureId},this.show()}}},{key:"onLayerMouseOut",value:function(r,o){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onLayerClick",value:function(r,o){if(this.isShow&&this.isSameFeature(r,o.featureId))this.hide();else{var u=this.getLayerInfoFrag(r,o),l=u.title,p=u.content;this.setDOMContent(p),this.setLnglat(o.lngLat),this.setTitle(l),this.displayFeatureInfo={layer:r,featureId:o.featureId},this.show()}}},{key:"onSourceUpdate",value:function(r){var o;((o=this.displayFeatureInfo)===null||o===void 0?void 0:o.layer)===r&&(this.hide(),this.displayFeatureInfo=void 0)}},{key:"getLayerInfoFrag",value:function(r,o){var u=this.layerConfigMap.get(r),l,p=document.createDocumentFragment();if(u){var v=o.feature;v.type==="Feature"&&"properties"in v&&"geometry"in v&&(v=v.properties);var x=u.title,E=u.fields,A=u.customContent;if(x){l=document.createDocumentFragment();var T=x instanceof Function?x(v):x;Bn(l,T)}if(A){var L=A instanceof Function?A(v):A;Bn(p,L)}else E!=null&&E.length&&(E==null||E.forEach(function(F){var z,H,ne=typeof F=="string"?{field:F}:F,oe=ne.field,ke=ne.formatField,De=ne.formatValue,ft=ne.getValue,At=ri("div","l7-layer-popup__row"),Nt=ft?ft(o.feature):(0,ur.get)(v,oe),Gt=(z=ke instanceof Function?ke(oe,v):ke)!==null&&z!==void 0?z:oe,xr=(H=De instanceof Function?De(Nt,v):De)!==null&&H!==void 0?H:Nt,dr=ri("span","l7-layer-popup__key",At);Bn(dr,Gt),Bn(dr,document.createTextNode("\uFF1A"));var zr=ri("span","l7-layer-popup__value",At);Bn(zr,xr),p.appendChild(At)}))}return{title:l,content:p}}},{key:"getLayerByConfig",value:function(r){var o=r.layer;if(o instanceof Object)return o;if(typeof o=="string")return this.layerService.getLayer(o)||this.layerService.getLayerByName(o)}},{key:"isSameFeature",value:function(r,o){var u=this.displayFeatureInfo;return u&&r===u.layer&&o===u.featureId}}]),t}(Bm);function kA(e,i){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(i||(i=document),!!i)){var r=i.head||i.getElementsByTagName("head")[0];if(!r){r=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(r,o):i.documentElement.appendChild(r)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),r.appendChild(u),u}}kA(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 1000;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 800;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-control-container .l7-column {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 6px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-popper.l7-popper-end {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  height: 24px;
  line-height: 24px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 16px;
  font-size: 12px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  height: 14px;
  width: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  padding: 12px 12px 0 12px;
  width: 474px;
  height: 320px;
  overflow: auto;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: wrap;
      flex-wrap: wrap;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-select-control--image .l7-select-control-item {
  margin-right: 12px;
  border-radius: 2px;
  overflow: hidden;
  border: 1px solid #fff;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  width: calc((100% - 36px) / 3);
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  margin-bottom: 12px;
  position: relative;
  font-size: 12px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 142px;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  right: 0;
  top: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control--image .l7-select-control-item:nth-child(3n) {
  margin-right: 0;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  border-radius: 2px;
  overflow: hidden;
}
.l7-control-zoom .l7-button-control {
  -webkit-box-shadow: 0 0 0;
          box-shadow: 0 0 0;
  border-radius: 0;
  font-size: 16px;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:first-child {
  border-bottom: 1px solid #f0f0f0;
}
.l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  -webkit-transition: width 0.1s;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
`);var Yh,Nm=(Yh={},(0,W.Z)(Yh,hf.additive,{enable:!0,func:{srcRGB:$.ONE,dstRGB:$.ONE,srcAlpha:1,dstAlpha:1}}),(0,W.Z)(Yh,hf.none,{enable:!1}),(0,W.Z)(Yh,hf.normal,{enable:!0,func:{srcRGB:$.SRC_ALPHA,dstRGB:$.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,W.Z)(Yh,hf.subtractive,{enable:!0,func:{srcRGB:$.ONE,dstRGB:$.ONE,srcAlpha:$.ZERO,dstAlpha:$.ONE_MINUS_SRC_COLOR},equation:{rgb:$.FUNC_SUBTRACT,alpha:$.FUNC_SUBTRACT}}),(0,W.Z)(Yh,hf.max,{enable:!0,func:{srcRGB:$.ONE,dstRGB:$.ONE},equation:{rgb:$.MAX_EXT}}),(0,W.Z)(Yh,hf.min,{enable:!0,func:{srcRGB:$.ONE,dstRGB:$.ONE},equation:{rgb:$.MIN_EXT}}),Yh);function sc(e,i,t,n,r){i.updateStyleAttribute(e,t,n,r)}function IA(e,i){i.tileLayer||i.isTileLayer||(e.opacity&&p0("opacity",i,e.opacity),e.strokeWidth&&p0("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&p0("strokeOpacity",i,e.strokeOpacity),e.stroke&&PA("stroke",i,e.stroke),e.offsets&&d1("offsets",i,e.offsets),e.textOffset&&d1("textOffset",i,e.textOffset),e.thetaOffset&&p0("thetaOffset",i,e.thetaOffset))}function p0(e,i,t){(0,ur.isString)(t)?sc(e,i,t,function(n){return n}):(0,ur.isNumber)(t)||(Array.isArray(t)&&t.length===2?(0,ur.isString)(t[0])&&(0,ur.isFunction)(t[1])||(0,ur.isString)(t[0])&&Array.isArray(t[1])&&(0,ur.isNumber)(t[1][0])&&(0,ur.isNumber)(t[1][1])?sc(e,i,t[0],t[1]):sc(e,i,[1],void 0):sc(e,i,[1],void 0))}function d1(e,i,t){(0,ur.isString)(t)?sc(e,i,t,function(n){return n}):Array.isArray(t)&&t.length===2&&(0,ur.isString)(t[0])&&(0,ur.isFunction)(t[1])?sc(e,i,t[0],t[1]):Array.isArray(t)&&t.length===2&&(0,ur.isNumber)(t[0])&&(0,ur.isNumber)(t[1])?sc(e,i,t,void 0):sc(e,i,[0,0],void 0)}function PA(e,i,t){(0,ur.isString)(t)||(Array.isArray(t)&&t.length===2&&((0,ur.isString)(t[0])&&(0,ur.isFunction)(t[1])||(0,ur.isString)(t[0])&&Array.isArray(t[1])&&t[1].length>0)?sc(e,i,t[0],t[1]):sc(e,i,"#fff",void 0))}var il;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFUALT="DEFUALTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(il||(il={}));function RA(e,i){var t=[i[0]-e[0],i[1]-e[1]],n=yt(t),r=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return r}function LA(e,i,t){if(e.length>0&&i.version===il["GAODE2.x"]){var n=t.coordCenter;typeof e[0].coordinates[0]=="number"?e.filter(function(r){return!r.originCoordinates}).map(function(r){r.version=il["GAODE2.x"],r.originCoordinates=(0,ur.cloneDeep)(r.coordinates),r.coordinates=i.lngLatToCoordByLayer(r.coordinates,n)}):e.filter(function(r){return!r.originCoordinates}).map(function(r){r.version=il["GAODE2.x"],r.originCoordinates=(0,ur.cloneDeep)(r.coordinates),r.coordinates=i.lngLatToCoordsByLayer(r.coordinates,n)})}}function OA(e,i){e.length>0&&i.version===il.SIMPLE&&e.map(function(t){t.simpleCoordinate||(t.coordinates=FA(t.coordinates,i),t.simpleCoordinate=!0)})}function FA(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var t=[];return e.map(function(r){var o=[];r.map(function(u){o.push(i.simpleMapCoord.unproject(u))}),t.push(o)}),t}else{var n=[];return e.map(function(r){n.push(i.simpleMapCoord.unproject(r))}),n}}function DA(e,i){var t;if(!e.scale)return[];var n=(e==null||(t=e.scale)===null||t===void 0?void 0:t.scalers)||[],r=[];n.forEach(function(u){var l,p=u.field;(i.hasOwnProperty(p)||((l=e.scale)===null||l===void 0?void 0:l.type)==="variable")&&r.push(i[p])});var o=e.mapping?e.mapping(r):[];return o}function BA(e,i,t,n,r){var o=r==null?void 0:r.getLayerConfig(),u=o.arrow,l=u===void 0?{enable:!1}:u,p=i.map(function(v){var x={id:v._id,coordinates:v.coordinates};if(e.filter(function(T){return T.scale!==void 0}).forEach(function(T){var L=DA(T,v);T.needRemapping=!1,T.name==="color"&&(L=L.map(function(F){return En(F)})),x[T.name]=Array.isArray(L)&&L.length===1?L[0]:L,T.name==="shape"&&(x.shape=t.getIconFontKey(x[T.name]))}),x.shape==="line"&&l.enable){var E=x.coordinates,A=RA(E[0],E[1]);x.coordinates.splice(1,0,A,A)}return x});return LA(p,n,r),OA(p,n),p}function NA(e,i,t,n,r,o){var u=new Fm(r,o),l=n.getLayerStyleAttributes()||[],p=u.data.dataArray,v=p,x=BA(l,v,i,t,e);return u.destroy(),x}function v1(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function m1(e,i,t,n){var r=e.multiPassRenderer,o=e.getLayerConfig(),u=o.enableTAA;return u?r.add(n("taa")):r.add(n("render")),v1(i).forEach(function(l){var p=(0,$n.Z)(l,2),v=p[0],x=p[1];r.add(t(v),x)}),r.add(t("copy")),r}var zA=function(){function e(i){(0,wt.Z)(this,e),this.layer=i}return(0,zt.Z)(e,[{key:"pickRender",value:function(t){var n=this.layer;if(n.tileLayer)return n.tileLayer.pickRender(t);n.hooks.beforePickingEncode.call(),n.masks.length>0&&n.masks.filter(function(r){return r.inited}).forEach(function(){var r=(0,Wt.Z)(be().mark(function o(u){return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:u.render();case 1:case"end":return p.stop()}},o)}));return function(o){return r.apply(this,arguments)}}()),n.renderModels(!0),n.hooks.afterPickingEncode.call()}},{key:"pick",value:function(t,n){var r=this.layer.getContainer(),o=r.get(V.IPickingService);return t.type==="RasterLayer"?this.pickRasterLayer(t,n):(this.pickRender(n),o.pickFromPickingFBO(t,n))}},{key:"pickRasterLayer",value:function(t,n,r){var o=this.layer.getContainer(),u=o.get(V.IPickingService),l=o.get(V.IMapService),p=this.layer.getSource().extent,v=bc(n.lngLat,p),x={x:n.x,y:n.y,type:n.type,lngLat:n.lngLat,target:n,rasterValue:null},E=r||t;if(v){var A=this.readRasterValue(t,p,l,n.x,n.y);return x.rasterValue=A,u.triggerHoverOnLayer(E,x),!0}else return x.type=n.type==="mousemove"?"mouseout":"un"+n.type,u.triggerHoverOnLayer(E,(0,mt.Z)((0,mt.Z)({},x),{},{type:"unpick"})),u.triggerHoverOnLayer(E,x),!1}},{key:"readRasterValue",value:function(t,n,r,o,u){var l=t.getSource().data.dataArray[0],p=(0,$n.Z)(n,4),v=p[0],x=v===void 0?0:v,E=p[1],A=E===void 0?0:E,T=p[2],L=T===void 0?10:T,F=p[3],z=F===void 0?-10:F,H=r.lngLatToContainer([x,A]),ne=r.lngLatToContainer([L,z]),oe=ne.x-H.x,ke=H.y-ne.y,De=[(o-H.x)/oe,(u-ne.y)/ke],ft=l.width||1,At=l.height||1,Nt=Math.floor(De[0]*ft),Gt=Math.floor(De[1]*At),xr=Math.max(0,Gt-1)*ft+Nt,dr=l.data[xr];return dr}},{key:"selectFeature",value:function(t){var n=this.layer,r=(0,$n.Z)(t,3),o=r[0],u=r[1],l=r[2];n.hooks.beforeSelect.call([o,u,l])}},{key:"highlightPickedFeature",value:function(t){var n=(0,$n.Z)(t,3),r=n[0],o=n[1],u=n[2];this.layer.hooks.beforeHighlight.call([r,o,u])}},{key:"getFeatureById",value:function(t){return this.layer.getSource().getFeatureById(t)}}]),e}(),ZA=function(){function e(i){(0,wt.Z)(this,e),this.layer=i;var t=this.layer.getContainer();this.rendererService=t.get(V.IRendererService)}return(0,zt.Z)(e,[{key:"getColorTexture",value:function(t,n){var r=this.getTextureKey(t,n);return this.key===r?this.colorTexture:(this.createColorTexture(t,n),this.key=r,this.colorTexture)}},{key:"createColorTexture",value:function(t,n){var r=this.rendererService.createTexture2D,o=this.getColorRampBar(t,n),u=r({data:o.data,width:o.width,height:o.height,flipY:!1});return this.colorTexture=u,u}},{key:"setColorTexture",value:function(t,n,r){this.key=this.getTextureKey(n,r),this.colorTexture=t}},{key:"destroy",value:function(){var t;(t=this.colorTexture)===null||t===void 0||t.destroy()}},{key:"getColorRampBar",value:function(t,n){switch(t.type){case"cat":return fi(t);case"quantize":return Lo(t);case"custom":return co(t,n);case"linear":return di(t,n);default:return Ti(t)}}},{key:"getTextureKey",value:function(t,n){var r;return"".concat(t.colors.join("_"),"_").concat(t==null||(r=t.positions)===null||r===void 0?void 0:r.join("_"),"_").concat(t.type,"_").concat(n==null?void 0:n.join("_"))}}]),e}(),UA=["passes"],VA=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber","workerEnabled","workerOptions"],g1,zm,y1;function jA(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=GA(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function GA(e,i){if(!!e){if(typeof e=="string")return _1(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _1(e,i)}}function _1(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function HA(e){var i=WA();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function WA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var x1=0,qh=(g1=Rm(V.IGlobalConfigService),zm=function(e){(0,Dr.Z)(t,e);var i=HA(t);function t(){var n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,wt.Z)(this,t),n=i.call(this),(0,W.Z)((0,He.Z)(n),"id","".concat(x1++)),(0,W.Z)((0,He.Z)(n),"name","".concat(x1)),(0,W.Z)((0,He.Z)(n),"visible",!0),(0,W.Z)((0,He.Z)(n),"zIndex",0),(0,W.Z)((0,He.Z)(n),"inited",!1),(0,W.Z)((0,He.Z)(n),"layerModelNeedUpdate",!1),(0,W.Z)((0,He.Z)(n),"pickedFeatureID",null),(0,W.Z)((0,He.Z)(n),"selectedFeatureID",null),(0,W.Z)((0,He.Z)(n),"styleNeedUpdate",!1),(0,W.Z)((0,He.Z)(n),"forceRender",!1),(0,W.Z)((0,He.Z)(n),"clusterZoom",0),(0,W.Z)((0,He.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,W.Z)((0,He.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,W.Z)((0,He.Z)(n),"hooks",{init:new tS,afterInit:new _y,beforeRender:new _y,beforeRenderData:new rS,afterRender:new zf,beforePickingEncode:new zf,afterPickingEncode:new zf,beforeHighlight:new zf(["pickedColor"]),afterHighlight:new zf,beforeSelect:new zf(["pickedColor"]),afterSelect:new zf,beforeDestroy:new zf,afterDestroy:new zf}),(0,W.Z)((0,He.Z)(n),"models",[]),(0,W.Z)((0,He.Z)(n),"startInit",!1),(0,W.Z)((0,He.Z)(n),"layerChildren",[]),(0,W.Z)((0,He.Z)(n),"masks",[]),ia((0,He.Z)(n),"configService",y1,(0,He.Z)(n)),(0,W.Z)((0,He.Z)(n),"animateOptions",{enable:!1}),(0,W.Z)((0,He.Z)(n),"currentPickId",null),(0,W.Z)((0,He.Z)(n),"pendingStyleAttributes",[]),(0,W.Z)((0,He.Z)(n),"scaleOptions",{}),(0,W.Z)((0,He.Z)(n),"animateStatus",!1),(0,W.Z)((0,He.Z)(n),"isDestroyed",!1),(0,W.Z)((0,He.Z)(n),"encodeDataLength",0),(0,W.Z)((0,He.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var o=n.getLayerConfig();o&&o.autoFit&&n.fitBounds(o.fitBoundsOptions);var u=n.layerSource.getSourceCfg().autoRender;u&&n.reRender()}),n.name=r.name||n.id,n.zIndex=r.zIndex||0,n.rawConfig=r,n}return(0,zt.Z)(t,[{key:"addMaskLayer",value:function(r){this.masks.push(r)}},{key:"removeMaskLayer",value:function(r){var o=this.masks.indexOf(r);o>-1&&this.masks.splice(o,1),r.destroy()}},{key:"getAttribute",value:function(r){return this.styleAttributeService.getLayerStyleAttribute(r)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(r){var o=this;if(Object.keys(r).map(function(l){l in o.rawConfig&&(o.rawConfig[l]=r[l])}),!this.startInit)this.needUpdateConfig=(0,mt.Z)((0,mt.Z)({},this.needUpdateConfig),r);else{var u=this.container.get(V.SceneID);IA(r,this),this.configService.setLayerConfig(u,this.id,(0,mt.Z)((0,mt.Z)((0,mt.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),r)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(r,o){this.container=r,this.sceneContainer=o}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(r){return this.plugins.push(r),this}},{key:"init",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u=this,l,p,v,x,E,A,T;return be().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:l=this.container.get(V.SceneID),this.startInit=!0,this.configService.setLayerConfig(l,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(V.IIconService),this.fontService=this.container.get(V.IFontService),this.rendererService=this.container.get(V.IRendererService),this.layerService=this.container.get(V.ILayerService),this.interactionService=this.container.get(V.IInteractionService),this.pickingService=this.container.get(V.IPickingService),this.mapService=this.container.get(V.IMapService),p=this.getLayerConfig(),v=p.enableMultiPassRenderer,x=p.passes,v&&x!==null&&x!==void 0&&x.length&&x.length>0&&this.mapService.on("mapAfterFrameChange",function(){u.renderLayers()}),this.cameraService=this.container.get(V.ICameraService),this.coordinateService=this.container.get(V.ICoordinateSystemService),this.shaderModuleService=this.container.get(V.IShaderModuleService),this.postProcessingPassFactory=this.container.get(V.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(V.IFactoryNormalPass),this.styleAttributeService=this.container.get(V.IStyleAttributeService),v&&(this.multiPassRenderer=this.container.get(V.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach(function(z){var H=z.attributeName,ne=z.attributeField,oe=z.attributeValues,ke=z.updateOptions;u.styleAttributeService.updateStyleAttribute(H,{scale:(0,mt.Z)({field:ne},u.splitValuesAndCallbackInAttribute(oe,u.getLayerConfig()[H]))},ke)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(V.ILayerPlugin),E=jA(this.plugins);try{for(E.s();!(A=E.n()).done;)T=A.value,T.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(z){E.e(z)}finally{E.f()}return this.layerPickService=new zA(this),this.textureService=new ZA(this),F.next=29,this.hooks.init.promise();case 29:this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 33:case"end":return F.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"updateModelData",value:function(r){r.attributes&&r.elements?this.models.map(function(o){o.updateAttributesAndElements(r.attributes,r.elements)}):console.warn("data error")}},{key:"createModelData",value:function(r,o){var u;if((u=this.layerModel)!==null&&u!==void 0&&u.createModelData)return this.layerModel.createModelData(o);var l=this.calculateEncodeData(r,o),p=this.triangulation;return l&&p?this.styleAttributeService.createAttributesAndIndices(l,p):{attributes:void 0,elements:void 0}}},{key:"setLayerPickService",value:function(r){this.layerPickService=r}},{key:"calculateEncodeData",value:function(r,o){return this.inited?NA(this,this.fontService,this.mapService,this.styleAttributeService,r,o):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.updateLayerConfig((0,mt.Z)((0,mt.Z)((0,mt.Z)({},this.getDefaultConfig()),this.rawConfig),this.needUpdateConfig));var r=this.getLayerConfig(),o=r.animateOption;o!=null&&o.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(r,o,u){return this.updateStyleAttribute("color",r,o,u),this}},{key:"texture",value:function(r,o,u){return this.updateStyleAttribute("texture",r,o,u),this}},{key:"rotate",value:function(r,o,u){return this.updateStyleAttribute("rotate",r,o,u),this}},{key:"size",value:function(r,o,u){return this.updateStyleAttribute("size",r,o,u),this}},{key:"filter",value:function(r,o,u){var l=this.updateStyleAttribute("filter",r,o,u);return this.dataState.dataSourceNeedUpdate=l,this}},{key:"shape",value:function(r,o,u){this.shapeOption={field:r,values:o};var l=this.updateStyleAttribute("shape",r,o,u);return this.dataState.dataSourceNeedUpdate=l,this}},{key:"label",value:function(r,o,u){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:r,attributeValues:o,updateOptions:u}),this}},{key:"animate",value:function(r){var o={};return(0,ur.isObject)(r)?(o.enable=!0,o=(0,mt.Z)((0,mt.Z)({},o),r)):o.enable=r,this.updateLayerConfig({animateOption:o}),this}},{key:"source",value:function(r,o){return(r==null?void 0:r.type)==="source"?(this.setSource(r),this):(this.sourceOption={data:r,options:o},this.clusterZoom=0,this)}},{key:"setData",value:function(r,o){var u=this;return this.inited?this.layerSource.setData(r,o):this.on("inited",function(){var l=u.getSource();l?u.layerSource.setData(r,o):u.source(new Fm(r,o))}),this}},{key:"style",value:function(r){var o=this,u=r.passes,l=(0,C.Z)(r,UA);return u&&v1(u).forEach(function(p){var v=o.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(p[0]);v&&v.updateOptions(p[1])}),this.rawConfig=(0,mt.Z)((0,mt.Z)({},this.rawConfig),l),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(r,o){var u=(0,mt.Z)({},this.scaleOptions);if((0,ur.isObject)(r)?this.scaleOptions=(0,mt.Z)((0,mt.Z)({},this.scaleOptions),r):this.scaleOptions[r]=o,this.styleAttributeService&&!(0,ur.isEqual)(u,this.scaleOptions)){var l=(0,ur.isObject)(r)?r:(0,W.Z)({},r,o);this.styleAttributeService.updateScaleAttribute(l)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(),this))}},{key:"renderMultiPass",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){l.next=2;break}return l.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){l.next=7;break}return l.next=5,this.multiPassRenderer.render();case 5:l.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"active",value:function(r){var o={};return o.enableHighlight=(0,ur.isObject)(r)?!0:r,(0,ur.isObject)(r)?(o.enableHighlight=!0,r.color&&(o.highlightColor=r.color),r.mix&&(o.activeMix=r.mix)):o.enableHighlight=!!r,this.updateLayerConfig(o),this}},{key:"setActive",value:function(r,o){var u=this;if((0,ur.isObject)(r)){var l=r.x,p=l===void 0?0:l,v=r.y,x=v===void 0?0:v;this.updateLayerConfig({highlightColor:(0,ur.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,ur.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.pick({x:p,y:x})}else this.updateLayerConfig({pickedFeatureID:r,highlightColor:(0,ur.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,ur.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(Jn(r)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"select",value:function(r){var o={};return o.enableSelect=(0,ur.isObject)(r)?!0:r,(0,ur.isObject)(r)?(o.enableSelect=!0,r.color&&(o.selectColor=r.color),r.mix&&(o.selectMix=r.mix)):o.enableSelect=!!r,this.updateLayerConfig(o),this}},{key:"setSelect",value:function(r,o){var u=this;if((0,ur.isObject)(r)){var l=r.x,p=l===void 0?0:l,v=r.y,x=v===void 0?0:v;this.updateLayerConfig({selectColor:(0,ur.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,ur.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.pick({x:p,y:x})}else this.updateLayerConfig({pickedFeatureID:r,selectColor:(0,ur.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,ur.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Jn(r)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"setBlend",value:function(r){return this.updateLayerConfig({blend:r}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(r){return this.zIndex=r,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(r){this.currentPickId=r}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(r){this.selectedFeatureID=r}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var r=this.mapService.getZoom(),o=this.getLayerConfig(),u=o.visible,l=o.minZoom,p=l===void 0?-Infinity:l,v=o.maxZoom,x=v===void 0?Infinity:v;return!!u&&r>=p&&r<x}},{key:"setMultiPass",value:function(r,o){if(this.updateLayerConfig({enableMultiPassRenderer:r}),o&&this.updateLayerConfig({passes:o}),r){var u=this.getLayerConfig(),l=u.passes,p=l===void 0?[]:l;this.multiPassRenderer=m1(this,p,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var v=this.rendererService.getViewportSize(),x=v.width,E=v.height;this.multiPassRenderer.resize(x,E)}return this}},{key:"setMinZoom",value:function(r){return this.updateLayerConfig({minZoom:r}),this}},{key:"getMinZoom",value:function(){var r=this.getLayerConfig(),o=r.minZoom;return o}},{key:"getMaxZoom",value:function(){var r=this.getLayerConfig(),o=r.maxZoom;return o}},{key:"get",value:function(r){var o=this.getLayerConfig();return o[r]}},{key:"setMaxZoom",value:function(r){return this.updateLayerConfig({maxZoom:r}),this}},{key:"setAutoFit",value:function(r){return this.updateLayerConfig({autoFit:r}),this}},{key:"fitBounds",value:function(r){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var o=this.getSource(),u=o.extent,l=u.some(function(p){return Math.abs(p)===Infinity});return l?this:(this.mapService.fitBounds([[u[0],u[1]],[u[2],u[3]]],r),this)}},{key:"destroy",value:function(){var r,o,u,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isDestroyed||(this.layerChildren.map(function(p){return p.destroy(!1)}),this.layerChildren=[],this.masks.map(function(p){return p.destroy(!1)}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(r=this.multiPassRenderer)===null||r===void 0||r.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(o=this.layerModel)===null||o===void 0||o.clearModels(l),(u=this.tileLayer)===null||u===void 0||u.destroy(),this.models=[],this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var r;this.models.forEach(function(o){return o.destroy()}),(r=this.layerModel)===null||r===void 0||r.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(r){return r.needRescale||r.needRemapping||r.needRegenerateVertices}).length}},{key:"setSource",value:function(r){var o=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=r,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var u=this.mapService.getZoom();this.layerSource.updateClusterData(u)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(l){var p=l.type;if(o.coordCenter===void 0){var v,x=o.layerSource.center;o.coordCenter=x,(v=o.mapService)!==null&&v!==void 0&&v.setCoordCenter&&o.mapService.setCoordCenter(x)}p==="update"&&o.sourceEvent()})}},{key:"initSource",value:function(r){this.layerSource=r,this.clusterZoom=0,this.addSourceEvent()}},{key:"getSource",value:function(){return this.layerSource}},{key:"addSourceEvent",value:function(){var r=this;this.layerSource.on("update",function(){if(r.coordCenter===void 0){var o,u=r.layerSource.center;r.coordCenter=u,(o=r.mapService)!==null&&o!==void 0&&o.setCoordCenter&&r.mapService.setCoordCenter(u)}r.sourceEvent()})}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(r){this.encodedData=r,this.encodeDataLength=r.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(r){return this.styleAttributeService.getLayerAttributeScale(r)}},{key:"getLegend",value:function(r){var o,u,l,p=this.styleAttributeService.getLayerStyleAttribute(r),v=(p==null||(o=p.scale)===null||o===void 0?void 0:o.scalers)||[];return{type:(u=v[0].option)===null||u===void 0?void 0:u.type,field:p==null||(l=p.scale)===null||l===void 0?void 0:l.field,items:this.getLegendItems(r)}}},{key:"getLegendItems",value:function(r){var o=this.styleAttributeService.getLayerAttributeScale(r);if(!o)return[];if(o.invertExtent){var u=o.range().map(function(v){return(0,W.Z)({value:o.invertExtent(v)},r,v)});return u}else if(o.ticks){var l=o.ticks().map(function(v){return(0,W.Z)({value:v},r,o(v))});return l}else if(o!=null&&o.domain){var p=o.domain().filter(function(v){return!(0,ur.isUndefined)(v)}).map(function(v){return(0,W.Z)({value:v},r,o(v))});return p}return[]}},{key:"pick",value:function(r){var o=r.x,u=r.y;this.interactionService.triggerHover({x:o,y:u})}},{key:"boxSelect",value:function(r,o){this.pickingService.boxPickLayer(this,r,o)}},{key:"buildLayerModel",value:function(){var n=(0,Wt.Z)(be().mark(function o(u){var l=this,p,v,x,E,A,T,L,F,z,H,ne,oe,ke,De;return be().wrap(function(At){for(;;)switch(At.prev=At.next){case 0:return p=u.moduleName,v=u.vertexShader,x=u.fragmentShader,E=u.triangulation,A=u.segmentNumber,T=u.workerEnabled,L=T===void 0?!1:T,F=u.workerOptions,z=(0,C.Z)(u,VA),this.shaderModuleService.registerModule(p,{vs:v,fs:x}),H=this.shaderModuleService.getModule(p),ne=H.vs,oe=H.fs,ke=H.uniforms,De=this.rendererService.createModel,At.abrupt("return",new Promise(function(Nt,Gt){if(F&&F.modelType in Tc&&L)l.styleAttributeService.createAttributesAndIndicesAscy(l.encodedData,A,F).then(function(Ma){var Co=Ma.attributes,ko=Ma.elements,es=De((0,mt.Z)({attributes:Co,uniforms:ke,fs:oe,vs:ne,elements:ko,blend:Nm[hf.normal]},z));Nt(es)}).catch(function(Ma){return Gt(Ma)});else{var xr=l.styleAttributeService.createAttributesAndIndices(l.encodedData,E,A),dr=xr.attributes,zr=xr.elements,bn=xr.count,Wn=(0,mt.Z)({attributes:dr,uniforms:ke,fs:oe,vs:ne,elements:zr,blend:Nm[hf.normal]},z);bn&&(Wn.count=bn);var oa=De(Wn);Nt(oa)}}));case 5:case"end":return At.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"createAttributes",value:function(r){var o=r.triangulation,u=this.styleAttributeService.createAttributes(this.encodedData,o),l=u.attributes;return l}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(r){var o=this.getLayerConfig(),u=o.enableHighlight,l=u===void 0?!0:u,p=o.enableSelect,v=p===void 0?!0:p,x=this.eventNames().indexOf(r)!==-1||this.eventNames().indexOf("un"+r)!==-1;return(r==="click"||r==="dblclick")&&v&&(x=!0),r==="mousemove"&&(l||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(x=!0),this.isVisible()&&x}},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return l.stop()}},o)}));function r(){return n.apply(this,arguments)}return r}()},{key:"rebuildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"renderMulPass",value:function(){var n=(0,Wt.Z)(be().mark(function o(u){return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,u.render();case 2:case"end":return p.stop()}},o)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"renderModels",value:function(r){var o=this;return this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(u){u.draw({uniforms:o.layerModel.getUninforms()},r)}),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(r,o,u,l){var p=this.configService.getAttributeConfig(this.id)||{};return(0,ur.isEqual)(p[r],{field:o,values:u})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(r)!==-1&&this.configService.setAttributeConfig(this.id,(0,W.Z)({},r,{field:o,values:u})),this.startInit?this.styleAttributeService.updateStyleAttribute(r,{scale:(0,mt.Z)({field:o},this.splitValuesAndCallbackInAttribute(u,this.getLayerConfig()[o]))},l):this.pendingStyleAttributes.push({attributeName:r,attributeField:o,attributeValues:u,updateOptions:l}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(r){console.warn("empty fn")}},{key:"processData",value:function(r){return r}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.models.forEach(function(p){return p.destroy()}),this.models=[],l.next=4,this.layerModel.initModels();case 4:this.models=l.sent;case 5:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(r,o){return{values:(0,ur.isFunction)(r)?void 0:r||o,callback:(0,ur.isFunction)(r)?r:void 0}}}]),t}(Er.EventEmitter),y1=Qi(zm.prototype,"configService",[g1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zm),b1,Zm,E1;function XA(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=$A(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function $A(e,i){if(!!e){if(typeof e=="string")return S1(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return S1(e,i)}}function S1(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}var oo=(b1=Rm(V.IGlobalConfigService),Zm=function(){function e(i){(0,wt.Z)(this,e),ia(this,"configService",E1,this),this.layer=i,this.rendererService=i.getContainer().get(V.IRendererService),this.pickingService=i.getContainer().get(V.IPickingService),this.shaderModuleService=i.getContainer().get(V.IShaderModuleService),this.styleAttributeService=i.getContainer().get(V.IStyleAttributeService),this.mapService=i.getContainer().get(V.IMapService),this.iconService=i.getContainer().get(V.IIconService),this.fontService=i.getContainer().get(V.IFontService),this.cameraService=i.getContainer().get(V.ICameraService),this.layerService=i.getContainer().get(V.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var t=this.rendererService.createTexture2D;this.createTexture2D=t,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:$.NEAREST,min:$.NEAREST,width:1,height:1}))}return(0,zt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertiesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertiesExist.hasOpacity,this.stylePropertiesExist.hasStrokeOpacity,this.stylePropertiesExist.hasStrokeWidth,this.stylePropertiesExist.hasStroke,this.stylePropertiesExist.hasOffsets,this.stylePropertiesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(t){var n=!1;return(0,ur.isEqual)(t.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=t.thetaOffset),(0,ur.isEqual)(t.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=t.opacity),(0,ur.isEqual)(t.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=t.strokeOpacity),(0,ur.isEqual)(t.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=t.strokeWidth),(0,ur.isEqual)(t.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=t.stroke),(0,ur.isEqual)(t.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=t.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(t){this.clearLastCalRes(),t.opacity!==void 0&&!(0,ur.isNumber)(t.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertiesExist.hasOpacity=1,this.cellLength+=1),t.strokeOpacity!==void 0&&!(0,ur.isNumber)(t.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertiesExist.hasStrokeOpacity=1,this.cellLength+=1),t.strokeWidth!==void 0&&!(0,ur.isNumber)(t.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertiesExist.hasStrokeWidth=1,this.cellLength+=1),t.stroke!==void 0&&!this.isStaticColor(t.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertiesExist.hasStroke=1,this.cellLength+=4),t.offsets!==void 0&&!this.isOffsetStatic(t.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertiesExist.hasOffsets=1,this.cellLength+=2),t.thetaOffset!==void 0&&!(0,ur.isNumber)(t.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertiesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(t){return(0,ur.isString)(t)?!!(0,An.ZP)(t):!1}},{key:"getStrokeColor",value:function(t){if(this.isStaticColor(t)){var n=En(t);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(t){return!!(Array.isArray(t)&&t.length===2&&(0,ur.isNumber)(t[0])&&(0,ur.isNumber)(t[1]))}},{key:"patchMod",value:function(t,n){for(var r=0;r<n;r++)t.push(-1)}},{key:"patchData",value:function(t,n,r){var o=XA(r),u;try{for(o.s();!(u=o.n()).done;){var l=u.value,p=l.attr,v=l.count,x=n[p];x!==void 0?p==="stroke"?t.push.apply(t,(0,cr.Z)(En(x))):p==="offsets"?this.isOffsetStatic(x)?t.push(-x[0],x[1]):t.push(0,0):t.push((0,ur.isNumber)(x)?x:1):this.patchMod(t,v)}}catch(E){o.e(E)}finally{o.f()}}},{key:"calDataFrame",value:function(t,n,r){for(var o=n.length,u=Math.ceil(o*t/this.DATA_TEXTURE_WIDTH),l=u*this.DATA_TEXTURE_WIDTH,p=[],v=0;v<o;v++){var x=n[v];this.patchData(p,x,r)}for(var E=p.length;E<l;E++)p.push(-1);return{data:p,width:this.DATA_TEXTURE_WIDTH,height:u}}},{key:"getBlend",value:function(){var t=this.layer.getLayerConfig(),n=t.blend,r=n===void 0?"normal":n;return Nm[hf[r]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){var i=(0,Wt.Z)(be().mark(function n(){return be().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",!1);case 1:case"end":return o.stop()}},n)}));function t(){return i.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var i=(0,Wt.Z)(be().mark(function n(){return be().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return o.stop()}},n)}));function t(){return i.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var i=(0,Wt.Z)(be().mark(function n(){return be().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return o.stop()}},n)}));function t(){return i.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){var t=this.layer.getLayerConfig(),n=t.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),E1=Qi(Zm.prototype,"configService",[b1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zm),Um=100,G8=36,H8=40;function w1(e){return e/180*Math.acos(-1)}function C1(e){var i=w1(e[0])+Math.PI/2,t=w1(e[1]),n=Um+Math.random()*.4,r=n*Math.cos(t)*Math.cos(i),o=n*Math.cos(t)*Math.sin(i),u=n*Math.sin(t);return[o,u,r]}function W8(e,i){var t=mat4.create(),n=mat4.create(),r=vec3.fromValues(0,1,0),o=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var u=typeof i.segments!="undefined"?i.segments:32,l=2+u,p=2*l,v=[],x=[],E=[],A=[],T=[],L=[],F=0;F<=l;F++){for(var z=F/l,H=z*Math.PI,ne=0;ne<=p;ne++){var oe=ne/p,ke=oe*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-H),mat4.identity(t),mat4.rotateY(t,t,ke),vec3.transformMat4(o,r,n),vec3.transformMat4(o,o,t),vec3.scale(o,o,-e),E.push(o.slice()),A.push.apply(A,_toConsumableArray(o.slice())),vec3.normalize(o,o),T.push.apply(T,_toConsumableArray(o.slice())),L.push([oe,1-z]),A.push(oe,1-z)}if(F>0)for(var De=E.length,ft=De-2*(p+1);ft+p+2<De;ft++)v.push([ft,ft+1,ft+p+1]),x.push(ft,ft+1,ft+p+1),v.push([ft+p+1,ft+1,ft+p+2]),x.push(ft+p+1,ft+1,ft+p+2)}return{cells:v,positions:E,uvs:L,positionsArr:A,indicesArr:x,normalArr:T}}var d0=Xr.create(),X8=Xr.create(),eu=Xr.create(),Kh=Xr.create(),dd=Xr.create();function Vm(e,i,t,n,r){Xr.add(e,t,n),Xr.normalize(e,e),i=Xr.fromValues(-e[1],e[0]);var o=Xr.fromValues(-t[1],t[0]);return[r/Xr.dot(i,o),i]}function Qh(e,i){return Xr.set(e,-i[1],i[0])}function vd(e,i,t){return Xr.sub(e,i,t),Xr.normalize(e,e),e}function jm(e,i){return e[0]===i[0]&&e[1]===i[1]}function $8(e){for(var i=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(t,1),t++):i.set(n,n)}return e}var YA=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,wt.Z)(this,e),(0,W.Z)(this,"lastFlip",-1),(0,W.Z)(this,"miter",Xr.fromValues(0,0)),(0,W.Z)(this,"started",!1),(0,W.Z)(this,"dash",!1),(0,W.Z)(this,"totalDistance",0),(0,W.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,zt.Z)(e,[{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=n.startIndex,u=1;u<r;u++){var l=t[u-1],p=t[u],v=u<t.length-1?t[u+1]:null,x=this.simpleSegment(n,o,l,p,v);o+=x}if(this.dash)for(var E=0;E<n.positions.length/6;E++)n.positions[E*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(t,n){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,l=1;l<o;l++){var p,v,x,E=t[l-1];E.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var A=n[l-1],T=t[l];T.push((v=n[l][2])!==null&&v!==void 0?v:0);var L=n[l],F=l<t.length-1?[].concat((0,cr.Z)(t[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,z=l<n.length-1?n[l+1]:null,H=this.simpleSegment(r,u,E,T,F,A,L,z);u+=H}if(this.dash)for(var ne=0;ne<r.positions.length/6;ne++)r.positions[ne*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude_gaode2",value:function(t,n){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,l=1;l<o;l++){var p,v,x,E=t[l-1];E.push((p=n[l-1][2])!==null&&p!==void 0?p:0);var A=n[l-1],T=t[l];T.push((v=n[l][2])!==null&&v!==void 0?v:0);var L=n[l],F=l<t.length-1?[].concat((0,cr.Z)(t[l+1]),[(x=n[l+1][2])!==null&&x!==void 0?x:0]):null,z=l<n.length-1?n[l+1]:null,H=this.segment_gaode2(r,u,E,T,F,A,L,z);u+=H}if(this.dash)for(var ne=0;ne<r.positions.length/6;ne++)r.positions[ne*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=n.startIndex,u=1;u<r;u++){var l=t[u-1],p=t[u],v=u<t.length-1?t[u+1]:null,x=this.segment(n,o,l,p,v);o+=x}if(this.dash)for(var E=0;E<n.positions.length/6;E++)n.positions[E*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(t,n,r,o,u){var l=0,p=t.indices,v=t.positions,x=t.normals,E=Q([o[0],o[1]]),A=Q([r[0],r[1]]);vd(eu,E,A);var T=0;if(this.dash&&(T=this.lineSegmentDistance(E,A),this.totalDistance+=T),this.normal||(this.normal=Xr.create(),Qh(this.normal,eu)),this.started||(this.started=!0,this.extrusions(v,x,r,this.normal,this.thickness,this.totalDistance-T)),p.push(n+0,n+1,n+2),!u)Qh(this.normal,eu),this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance),p.push.apply(p,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var L=Q([u[0],u[1]]);jm(E,L)&&Xr.add(L,E,Xr.normalize(L,Xr.subtract(L,E,A))),vd(Kh,L,E);var F=Vm(dd,Xr.create(),eu,Kh,this.thickness),z=(0,$n.Z)(F,2),H=z[0],ne=z[1],oe=Xr.dot(dd,this.normal)<0?-1:1;this.extrusions(v,x,o,ne,H,this.totalDistance),p.push.apply(p,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),oe=-1,Xr.copy(this.normal,ne),l+=2,this.lastFlip=oe}return l}},{key:"segment_gaode2",value:function(t,n,r,o,u,l,p,v){var x=0,E=t.indices,A=t.positions,T=t.normals,L=this.cap==="square",F=this.join==="bevel",z=Q([p[0],p[1]]),H=Q([l[0],l[1]]);vd(eu,o,r);var ne=0;if(this.dash&&(ne=this.lineSegmentDistance(z,H),this.totalDistance+=ne),this.normal||(this.normal=Xr.create(),Qh(this.normal,eu)),!this.started)if(this.started=!0,L){var oe=Xr.create(),ke=Xr.create();Xr.add(oe,this.normal,eu),Xr.add(ke,this.normal,eu),T.push(ke[0],ke[1],0),T.push(oe[0],oe[1],0),A.push(r[0],r[1],r[2]|0,this.totalDistance-ne,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),A.push(r[0],r[1],r[2]|0,this.totalDistance-ne,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,T,r,this.normal,this.thickness,this.totalDistance-ne);if(E.push(n+0,n+1,n+2),u){jm(o,u)&&Xr.add(u,o,Xr.normalize(u,Xr.subtract(u,o,r))),vd(Kh,u,o);var At=Vm(dd,Xr.create(),eu,Kh,this.thickness),Nt=(0,$n.Z)(At,2),Gt=Nt[0],xr=Nt[1],dr=Xr.dot(dd,this.normal)<0?-1:1,zr=F;if(!zr&&this.join==="miter"){var bn=Gt;bn>this.miterLimit&&(zr=!0)}zr?(T.push(this.normal[0],this.normal[1],0),T.push(xr[0],xr[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*dr,o[2]|0),this.complex.indexes.push(this.currentIndex),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*dr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,E.push.apply(E,(0,cr.Z)(this.lastFlip!==-dr?[n,n+2,n+3]:[n+2,n+1,n+3])),E.push(n+2,n+3,n+4),Qh(d0,Kh),Xr.copy(this.normal,d0),T.push(this.normal[0],this.normal[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*dr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x+=3):(this.extrusions(A,T,o,xr,Gt,this.totalDistance),E.push.apply(E,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),dr=-1,Xr.copy(this.normal,xr),x+=2),this.lastFlip=dr}else{if(Qh(this.normal,eu),L){var De=Xr.create(),ft=Xr.create();Xr.sub(ft,eu,this.normal),Xr.add(De,eu,this.normal),T.push(ft[0],ft[1],0),T.push(De[0],De[1],0),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),A.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,T,o,this.normal,this.thickness,this.totalDistance);E.push.apply(E,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),x+=2}return x}},{key:"segment",value:function(t,n,r,o,u){var l=0,p=t.indices,v=t.positions,x=t.normals,E=this.cap==="square",A=this.join==="bevel",T=Q([o[0],o[1]]),L=Q([r[0],r[1]]);vd(eu,T,L);var F=0;if(this.dash&&(F=this.lineSegmentDistance(T,L),this.totalDistance+=F),this.normal||(this.normal=Xr.create(),Qh(this.normal,eu)),!this.started)if(this.started=!0,E){var z=Xr.create(),H=Xr.create();Xr.add(z,this.normal,eu),Xr.add(H,this.normal,eu),x.push(H[0],H[1],0),x.push(z[0],z[1],0),v.push(r[0],r[1],r[2]|0,this.totalDistance-F,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),v.push(r[0],r[1],r[2]|0,this.totalDistance-F,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,r,this.normal,this.thickness,this.totalDistance-F);if(p.push(n+0,n+1,n+2),u){var ke=Q([u[0],u[1]]);jm(T,ke)&&Xr.add(ke,T,Xr.normalize(ke,Xr.subtract(ke,T,L))),vd(Kh,ke,T);var De=Vm(dd,Xr.create(),eu,Kh,this.thickness),ft=(0,$n.Z)(De,2),At=ft[0],Nt=ft[1],Gt=Xr.dot(dd,this.normal)<0?-1:1,xr=A;if(!xr&&this.join==="miter"){var dr=At;dr>this.miterLimit&&(xr=!0)}xr?(x.push(this.normal[0],this.normal[1],0),x.push(Nt[0],Nt[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Gt,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Gt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p.push.apply(p,(0,cr.Z)(this.lastFlip!==-Gt?[n,n+2,n+3]:[n+2,n+1,n+3])),p.push(n+2,n+3,n+4),Qh(d0,Kh),Xr.copy(this.normal,d0),x.push(this.normal[0],this.normal[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Gt,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(v,x,o,Nt,At,this.totalDistance),p.push.apply(p,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Gt=-1,Xr.copy(this.normal,Nt),l+=2),this.lastFlip=Gt}else{if(Qh(this.normal,eu),E){var ne=Xr.create(),oe=Xr.create();Xr.sub(oe,eu,this.normal),Xr.add(ne,eu,this.normal),x.push(oe[0],oe[1],0),x.push(ne[0],ne[1],0),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),v.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(v,x,o,this.normal,this.thickness,this.totalDistance);p.push.apply(p,(0,cr.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(t,n,r,o,u,l){n.push(o[0],o[1],0),n.push(o[0],o[1],0),t.push(r[0],r[1],r[2]|0,l,-u,r[2]|0),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],r[2]|0,l,u,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var r=n[0]-t[0],o=n[1]-t[1];return Math.sqrt(r*r+o*o)}}]),e}(),so=ee(77160);function qA(e){var i=e[0][0],t=e[0][e[0].length-1];i[0]===t[0]&&i[1]===t[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,r=Vs().flatten(e),o=r.vertices,u=r.dimensions,l=[],p=[],v=0;v<o.length/u;v++)u===2?l.push(o[v*2],o[v*2+1],1):l.push(o[v*3],o[v*3+1],1);var x=Vs()(r.vertices,r.holes,r.dimensions);p.push.apply(p,(0,cr.Z)(x));for(var E=function(L){var F=r.vertices.slice(L*u,(L+1)*u),z=r.vertices.slice((L+1)*u,(L+2)*u);z.length===0&&(z=r.vertices.slice(0,u));var H=l.length/3;l.push(F[0],F[1],1,z[0],z[1],1,F[0],F[1],0,z[0],z[1],0),p.push.apply(p,(0,cr.Z)([0,2,1,2,3,1].map(function(ne){return ne+H})))},A=0;A<n;A++)E(A);return{positions:l,index:p}}function KA(e){var i=Vs().flatten(e),t=Vs()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:t}}function A1(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var r=e[0].length,o=Vs().flatten(e),u=o.vertices,l=o.dimensions,p=[],v=[],x=[],E=0;E<u.length/l;E++)l===2?p.push(u[E*2],u[E*2+1],1,-1,-1):p.push(u[E*3],u[E*3+1],1,-1,-1),x.push(0,0,1);var A=Vs()(o.vertices,o.holes,o.dimensions);v.push.apply(v,(0,cr.Z)(A));for(var T=function(z){var H=o.vertices.slice(z*l,(z+1)*l),ne=o.vertices.slice((z+1)*l,(z+2)*l);ne.length===0&&(ne=o.vertices.slice(0,l));var oe=p.length/5;p.push(H[0],H[1],1,0,0,ne[0],ne[1],1,.1,0,H[0],H[1],0,0,.8,ne[0],ne[1],0,.1,.8);var ke=QA([ne[0],ne[1],1],[H[0],H[1],0],[H[0],H[1],1],i);x.push.apply(x,(0,cr.Z)(ke).concat((0,cr.Z)(ke),(0,cr.Z)(ke),(0,cr.Z)(ke))),v.push.apply(v,(0,cr.Z)([1,2,0,3,2,1].map(function(De){return De+oe})))},L=0;L<r;L++)T(L);return{positions:p,index:v,normals:x}}function QA(e,i,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,r=so.create(),o=so.create(),u=so.create();n&&(e=w(e),i=w(i),t=w(t));var l=so.fromValues.apply(so,(0,cr.Z)(e)),p=so.fromValues.apply(so,(0,cr.Z)(i)),v=so.fromValues.apply(so,(0,cr.Z)(t));so.sub(r,v,p),so.sub(o,l,p),so.cross(u,r,o);var x=so.create();return so.normalize(x,u),x}var Oc,Fp;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Fp||(Fp={}));var Dp;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Dp||(Dp={}));function lv(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=Math.PI*2/e,n=[],r=0;r<e;r++)n.push(t*r+i*Math.PI/12);var o=n.map(function(u){var l=Math.sin(u+Math.PI/4),p=Math.cos(u+Math.PI/4);return[l,p,0]});return o}function T1(){return lv(30)}function M1(){return lv(4)}function k1(){return lv(3)}function I1(){return lv(6,1)}function P1(){return lv(5)}var md=(Oc={},(0,W.Z)(Oc,Dp.CIRCLE,T1),(0,W.Z)(Oc,Dp.HEXAGON,I1),(0,W.Z)(Oc,Dp.TRIANGLE,k1),(0,W.Z)(Oc,Dp.SQUARE,M1),(0,W.Z)(Oc,Dp.PENTAGON,P1),(0,W.Z)(Oc,Fp.CYLINDER,T1),(0,W.Z)(Oc,Fp.HEXAGONCOLUMN,I1),(0,W.Z)(Oc,Fp.TRIANGLECOLUMN,k1),(0,W.Z)(Oc,Fp.SQUARECOLUMN,M1),(0,W.Z)(Oc,Fp.PENTAGONCOLUMN,P1),Oc),v0={};function m0(e){var i=jr(e.coordinates);return{vertices:[].concat((0,cr.Z)(i),(0,cr.Z)(i),(0,cr.Z)(i),(0,cr.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function R1(e){var i=jr(e.coordinates),t=C1(i);return{vertices:[].concat((0,cr.Z)(t),(0,cr.Z)(t),(0,cr.Z)(t),(0,cr.Z)(t)),indices:[0,1,2,2,3,0],size:t.length}}function Gm(e){var i=e.shape,t=a3(i,!1),n=t.positions,r=t.index,o=t.normals;return{vertices:n,indices:r,normals:o,size:5}}function JA(e){var i=jr(e.coordinates);return{vertices:(0,cr.Z)(i),indices:[0],size:i.length}}function cv(e){var i=e.coordinates,t=e.originCoordinates,n=e.version,r=new YA({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=i;Array.isArray(o[0][0])||(o=[i]);var u=t;Array.isArray(u[0][0])||(u=[t]);for(var l=0;l<o.length;l++){var p=o[l],v=u[l];r.extrude_gaode2(p,v)}}else{var x=i;x[0]&&!Array.isArray(x[0][0])&&(x=[i]),x.forEach(function(A){r.extrude(A)})}var E=r.complex;return{vertices:E.positions,indices:E.indices,normals:E.normals,indexes:E.indexes,size:6}}function e3(e){var i=e.coordinates,t=[];if(!Array.isArray(i[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var n=t3(i),r=n.results,o=n.totalDistance;return r.map(function(u){t.push(u[0],u[1],u[2],u[3],0,o)}),{vertices:t,indices:[],normals:[],size:6,count:r.length}}function Y8(e){var i=e.coordinates,t=[];if(!Array.isArray(i[0]))return{vertices:[],indices:[],size:4,count:0};var n=r3(i),r=n.results;return r.map(function(o){t.push(o[0],o[1],o[2],o[3])}),{vertices:t,indices:[],size:4,count:r.length}}function L1(e,i){var t=i[0]-e[0],n=i[1]-e[1];return Math.sqrt(t*t+n*n)}function gd(e,i){return e.length<3&&e.push(0),i!==void 0&&e.push(i),e}function t3(e){var i=e;Array.isArray(i)&&Array.isArray(i[0])&&Array.isArray(i[0][0])&&(i=e.flat());var t=0;if(i.length<2)return{results:i,totalDistance:0};var n=[],r=gd(i[0],t);n.push(r);for(var o=1;o<i.length-1;o++){var u=L1(i[o-1],i[o]);t+=u;var l=gd(i[o],t);n.push(l),n.push(l)}var p=L1(i[i.length-2],i[i.length-1]);return t+=p,n.push(gd(i[i.length-1],t)),{results:n,totalDistance:t}}function r3(e){if(e.length<2)return{results:e};var i=[],t=gd(e[0]);i.push(t);for(var n=1;n<e.length-1;n++){var r=gd(e[n]);i.push(r),i.push(r)}return i.push(gd(e[e.length-1])),{results:i}}function Hm(e){var i=e.coordinates,t=Vs().flatten(i),n=t.vertices,r=t.dimensions,o=t.holes;return{indices:Vs()(n,o,r),vertices:n,size:r}}function n3(e){var i=e.coordinates,t=Vs().flatten(i),n=t.vertices,r=t.dimensions,o=t.holes;return{indices:Vs()(n,o,r),vertices:i3(n),size:r+4}}function i3(e){for(var i=[],t=Cn(e),n=t.center,r=t.radius,o=0;o<e.length;o+=2){var u=e[o],l=e[o+1];i.push.apply(i,[u,l,0].concat((0,cr.Z)(n),[r]))}return i}function O1(e){var i=e.coordinates,t=A1(i,!0),n=t.positions,r=t.index,o=t.normals;return{vertices:n,indices:r,normals:o,size:5}}function F1(e){var i=e.shape,t=s3(i),n=t.positions,r=t.index;return{vertices:n,indices:r,size:3}}function g0(e){var i=e.coordinates,t=[].concat((0,cr.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,cr.Z)(i[1]),[0,1,0],(0,cr.Z)(i[0]),[0,0,1],(0,cr.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:t,indices:n,size:5}}function y0(e,i){for(var t=i||30,n=e.coordinates,r=[],o=[],u=function(v){r.push(v,1,v,n[0][0],n[0][1],n[1][0],n[1][1],v,-1,v,n[0][0],n[0][1],n[1][0],n[1][1]),v!==t-1&&o.push.apply(o,(0,cr.Z)([0,1,2,1,3,2].map(function(x){return v*2+x})))},l=0;l<t;l++)u(l);return{vertices:r,indices:o,size:7}}function D1(e){var i=e.coordinates;i.length===2&&i.push(0);var t=_0(-1,1),n=_0(1,1),r=_0(-1,-1),o=_0(1,-1),u=[].concat((0,cr.Z)(i),(0,cr.Z)(t),(0,cr.Z)(i),(0,cr.Z)(r),(0,cr.Z)(i),(0,cr.Z)(o),(0,cr.Z)(i),(0,cr.Z)(n)),l=[0,1,2,3,0,2];return{vertices:u,indices:l,size:5}}function a3(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(v0&&v0[e])return v0[e];var t=md[e]?md[e]():md.cylinder(),n=A1([t],i);return v0[e]=n,n}function q8(e,i){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,r=new Float32Array(e.length/t*3),o,u,l,p=vec3.create(),v=vec3.create(),x=vec3.create(),E=0,A=i.length;E<A;E+=3){o=i[E+0]*3,u=i[E+1]*3,l=i[E+2]*3;var T=[e[o],e[o+1]],L=[e[u],e[u+1]],F=[e[l],e[l+1]];n&&(T=lngLatToMeters(T),L=lngLatToMeters(L),F=lngLatToMeters(F));var z=T,H=_slicedToArray(z,2),ne=H[0],oe=H[1],ke=vec3.fromValues(ne,oe,e[o+2]),De=L,ft=_slicedToArray(De,2),At=ft[0],Nt=ft[1],Gt=vec3.fromValues(At,Nt,e[u+2]),xr=F,dr=_slicedToArray(xr,2),zr=dr[0],bn=dr[1],Wn=vec3.fromValues(zr,bn,e[l+2]);vec3.sub(p,Wn,Gt),vec3.sub(v,ke,Gt),vec3.cross(x,p,v),r[o]+=p[0],r[o+1]+=p[1],r[o+2]+=p[2],r[u]+=p[0],r[u+1]+=p[1],r[u+2]+=p[2],r[l]+=p[0],r[l+1]+=p[1],r[l+2]+=p[2]}return o3(r),r}function o3(e){for(var i=0,t=e.length;i<t;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),r=vec3.create();vec3.normalize(r,n),e.set(r,i)}}function K8(e){var i=e[0][0],t=e[0][e[0].length-1];return i[0]===t[0]&&i[1]===t[1]}function s3(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],t=md[e]?md[e]():md.circle(),n=i.indexOf(e)===-1?KA([t]):qA([t]);return n}function _0(e,i){var t=(e+1)/2,n=(i+1)/2;return[t,n]}function Q8(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:i,indices:t,size:5,normals:n}}function J8(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:i,indices:t,size:5,normals:n}}function u3(e){var i=l3();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function l3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var c3=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,f3=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,h3=function(e){(0,Dr.Z)(t,e);var i=u3(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.baseColor,p=l===void 0?"rgb(16,16,16)":l,v=r.brightColor,x=v===void 0?"rgb(255,176,38)":v,E=r.windowColor,A=E===void 0?"rgb(30,60,89)":E,T=r.time,L=T===void 0?0:T,F=r.sweep,z=F===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:F;return{u_cityCenter:z.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*z.sweepRadius,u_circleSweep:z.enable?1:0,u_circleSweepColor:En(z.sweepColor).slice(0,3),u_circleSweepSpeed:z.sweepSpeed,u_opacity:u,u_baseColor:En(p),u_brightColor:En(x),u_windowColor:En(A),u_time:this.layer.getLayerAnimateTime()||L}}},{key:"calCityGeo",value:function(){var r=(0,$n.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],l=r[2],p=r[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(l+o)/2,(p+u)/2]);var v=this.mapService.lngLatToCoord([l,p]),x=this.mapService.lngLatToCoord([o,u]);this.cityMinSize=Math.sqrt(Math.pow(v[0]-x[0],2)+Math.pow(v[1]-x[1],2))/4}else{var E=l-o,A=p-u;this.cityCenter=[(l+o)/2,(p+u)/2],this.cityMinSize=Math.sqrt(Math.pow(E,2)+Math.pow(A,2))/4}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.calCityGeo(),this.startModelAnimate(),l.next=4,this.buildModels();case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u;return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:f3,fragmentShader:c3,triangulation:O1,depth:{enable:!0},cull:{enable:!0,face:$.BACK}});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Nn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?10:u;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),t}(oo);function p3(e){var i=v3();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function v3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var m3=function(e){(0,Dr.Z)(t,e);var i=p3(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"type","CityBuildingLayer"),n}return(0,zt.Z)(t,[{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.layerModel=new h3(this),l.next=3,this.initLayerModels();case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"setLight",value:function(r){this.updateLayerConfig({time:r})}},{key:"getModelType",value:function(){return"citybuilding"}}]),t}(qh);function g3(e){var i=y3();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function y3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _3=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,x3=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,b3=function(e){(0,Dr.Z)(t,e);var i=g3(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.coverage,l=r.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E;return be().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:_3,fragmentShader:x3,triangulation:F1,primitive:$.TRIANGLES,depth:{enable:!1},stencil:Hi(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Nn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),t}(oo);function E3(e){var i=S3();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function S3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w3=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
 
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,C3=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,A3=function(e){(0,Dr.Z)(t,e);var i=E3(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.coverage,l=r.angle;return{u_opacity:o||1,u_coverage:u||1,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E;return be().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:w3,fragmentShader:C3,triangulation:Gm,primitive:$.TRIANGLES,depth:{enable:!0},blend:this.getBlend(),stencil:Hi(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o){var u=o.size;return Array.isArray(u)?[u[0]]:[u]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Nn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Nn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),t}(oo);function T3(e,i){for(var t=[],n=[],r=[],o=e+1,u=i+1,l=e/2,p=i/2,v=0;v<u;v++)for(var x=v-p,E=0;E<o;E++){var A=E-l;n.push(A/l,-x/p,0),r.push(E/e),r.push(1-v/i)}for(var T=0;T<i;T++)for(var L=0;L<e;L++){var F=L+o*T,z=L+o*(T+1),H=L+1+o*(T+1),ne=L+1+o*T;t.push(F,z,ne),t.push(z,H,ne)}return{vertices:n,indices:t,uvs:r}}var B1,N1;function M3(e){var i=k3();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function k3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var I3=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,P3=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,R3=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,L3=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,O3=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,F3=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,z1=(B1=(0,B.b2)(),B1(N1=function(e){(0,Dr.Z)(t,e);var i=M3(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"render",value:function(){var r=this,o=this.rendererService,u=o.clear,l=o.useFramebuffer;l(this.heatmapFramerBuffer,function(){u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:r.heatmapFramerBuffer}),r.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E,A,T,L,F;return be().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return l=this.rendererService,p=l.createFramebuffer,v=l.getViewportSize,x=l.createTexture2D,E=this.styleAttributeService.getLayerStyleAttribute("shape"),A=(E==null||(u=E.scale)===null||u===void 0?void 0:u.field)||"heatmap",this.shapeType=A,H.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=H.sent,this.colorModel=A==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap(),T=v(),L=T.width,F=T.height,this.heatmapFramerBuffer=p({color:x({width:Math.floor(L/4),height:Math.floor(F/4),wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE,min:$.LINEAR,mag:$.LINEAR}),depth:!1}),this.updateColorTexture(),H.abrupt("return",[this.intensityModel,this.colorModel]);case 12:case"end":return H.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.initModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Nn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?1:u;return[l]}}})}},{key:"buildHeatMapIntensity",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u;return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=D1,p.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:F3,fragmentShader:O3,triangulation:D1,depth:{enable:!1},cull:{enable:!0,face:Oh(this.mapService.version)},blend:{enable:!0,func:{srcRGB:$.ONE,srcAlpha:1,dstRGB:$.ONE,dstAlpha:1}}});case 3:return u=p.sent,p.abrupt("return",u);case 5:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildHeatmapColor",value:function(){var r=this.layer.getLayerConfig(),o=r.mask,u=o===void 0?!1:o,l=r.maskInside,p=l===void 0?!0:l;this.shaderModuleService.registerModule("heatmapColor",{vs:L3,fs:R3});var v=this.shaderModuleService.getModule("heatmapColor"),x=v.vs,E=v.fs,A=v.uniforms,T=this.rendererService,L=T.createAttribute,F=T.createElements,z=T.createBuffer,H=T.createModel;return H({vs:x,fs:E,attributes:{a_Position:L({buffer:z({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:$.FLOAT}),size:3}),a_Uv:L({buffer:z({data:[0,1,1,1,0,0,1,0],type:$.FLOAT}),size:2})},uniforms:(0,mt.Z)({},A),depth:{enable:!1},blend:this.getBlend(),elements:F({data:[0,2,1,2,3,1],type:$.UNSIGNED_INT,count:6}),stencil:Hi(u,p)})}},{key:"drawIntensityMode",value:function(){var r,o=this.layer.getLayerConfig(),u=o.opacity,l=o.intensity,p=l===void 0?10:l,v=o.radius,x=v===void 0?5:v;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(r=this.intensityModel)===null||r===void 0||r.draw({uniforms:{u_opacity:u||1,u_radius:x,u_intensity:p}}),this.layer.hooks.afterRender.call()}},{key:"drawColorMode",value:function(){var r,o=this.layer.getLayerConfig(),u=o.opacity;(r=this.colorModel)===null||r===void 0||r.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var r,o=this.layer.getLayerConfig(),u=o.opacity,l=Oa();wo(l,this.cameraService.getViewProjectionMatrixUncentered()),(r=this.colorModel)===null||r===void 0||r.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,cr.Z)(l)}})}},{key:"build3dHeatMap",value:function(){var r=this.layer.getLayerConfig(),o=r.mask,u=o===void 0?!1:o,l=r.maskInside,p=l===void 0?!0:l,v=this.rendererService.getViewportSize,x=v(),E=x.width,A=x.height,T=T3(E/4,A/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:P3,fs:I3});var L=this.shaderModuleService.getModule("heatmap3dColor"),F=L.vs,z=L.fs,H=L.uniforms,ne=this.rendererService,oe=ne.createAttribute,ke=ne.createElements,De=ne.createBuffer,ft=ne.createModel;return ft({vs:F,fs:z,attributes:{a_Position:oe({buffer:De({data:T.vertices,type:$.FLOAT}),size:3}),a_Uv:oe({buffer:De({data:T.uvs,type:$.FLOAT}),size:2})},primitive:$.TRIANGLES,uniforms:(0,mt.Z)({},H),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:$.SRC_ALPHA,srcAlpha:1,dstRGB:$.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:ke({data:T.indices,type:$.UNSIGNED_INT,count:T.indices.length}),stencil:Hi(u,p)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var r=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var o=this.layer.getLayerConfig(),u=o.rampColors,l=Ti(u);this.colorTexture=r({data:new Uint8Array(l.data),width:l.width,height:l.height,wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE,min:$.NEAREST,mag:$.NEAREST,flipY:!1})}}]),t}(oo))||N1);function D3(e){var i=B3();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function B3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var N3=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,z3=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Z3=function(e){(0,Dr.Z)(t,e);var i=D3(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.coverage,l=r.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E;return be().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:z3,fragmentShader:N3,triangulation:F1,depth:{enable:!1},primitive:$.TRIANGLES,blend:this.getBlend(),stencil:Hi(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Nn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o){var u=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[u[0],u[1],0]}}})}}]),t}(oo),U3={heatmap:z1,heatmap3d:z1,grid:b3,grid3d:A3,hexagon:Z3},V3=U3;function j3(e){var i=G3();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function G3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H3=function(e){(0,Dr.Z)(t,e);var i=j3(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"type","HeatMapLayer"),n}return(0,zt.Z)(t,[{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u;return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new V3[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"renderModels",value:function(){var r=this,o=this.getModelType();return o==="heatmap"?(this.layerModel&&this.layerModel.render(),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(u){return u.draw({uniforms:r.layerModel.getUninforms()})}),this.hooks.afterRender.call(),this)}},{key:"updateModelData",value:function(r){r.attributes&&r.elements?this.models[0].updateAttributesAndElements(r.attributes,r.elements):console.warn("data error")}},{key:"getModelType",value:function(){var r,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=this.getLayerConfig(),l=u.shape3d,p=this.getSource(),v=p.data.type,x=(o==null||(r=o.scale)===null||r===void 0?void 0:r.field)||"heatmap";return x==="heatmap"||x==="heatmap3d"?"heatmap":v==="hexagon"?(l==null?void 0:l.indexOf(x))===-1?"hexagon":"grid3d":v==="grid"?(l==null?void 0:l.indexOf(x))===-1?"grid":"grid3d":"heatmap"}}]),t}(qh);function W3(e){var i=X3();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function X3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $3=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,Y3=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,q3=function(e){(0,Dr.Z)(t,e);var i=W3(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity;return{u_opacity:o||1,u_texture:this.texture}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u=this,l,p,v,x,E,A,T,L,F,z,H;return be().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:if(l=this.layer.getLayerConfig(),p=l.mask,v=p===void 0?!1:p,x=l.maskInside,E=x===void 0?!0:x,A=this.layer.getSource(),T=this.rendererService.createTexture2D,this.texture=T({height:0,width:0}),!jo){oe.next=12;break}L=this.layerService.sceneService.getSceneConfig().canvas,F=L.createImage(),F.crossOrigin="anonymous",F.src=A.data.originData,F.onload=function(){u.texture=T({data:F,width:F.width,height:F.height}),u.layerService.reRender()},oe.next=16;break;case 12:return oe.next=14,A.data.images;case 14:z=oe.sent,this.texture=T({data:z[0],width:z[0].width,height:z[0].height,mag:$.LINEAR,min:$.LINEAR});case 16:return oe.next=18,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:Y3,fragmentShader:$3,triangulation:g0,primitive:$.TRIANGLES,blend:{enable:!0},depth:{enable:!1},stencil:Hi(v,E)});case 18:return H=oe.sent,oe.abrupt("return",[H]);case 20:case"end":return oe.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.texture)===null||r===void 0||r.destroy()}},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.initModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),t}(oo),K3={image:q3},Q3=K3;function J3(e){var i=eT();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function eT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z1=function(e){(0,Dr.Z)(t,e);var i=J3(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"type","ImageLayer"),n}return(0,zt.Z)(t,[{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u;return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new Q3[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={image:{}};return o[r]}},{key:"getModelType",value:function(){return"image"}}]),t}(qh);function tT(e){var i=rT();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function rT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nT=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,iT=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,aT=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
}`,oT=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  float arcThetaOffset = styleMappingMat[0][1];
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, arcThetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, arcThetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,sT=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,uT=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,lT={solid:0,dash:1},cT=function(e){(0,Dr.Z)(t,e);var i=tT(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:$.NEAREST,min:$.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.sourceColor,p=r.targetColor,v=r.textureBlend,x=v===void 0?"normal":v,E=r.lineType,A=E===void 0?"solid":E,T=r.dashArray,L=T===void 0?[10,5]:T,F=r.forward,z=F===void 0?!0:F,H=r.lineTexture,ne=H===void 0?!1:H,oe=r.iconStep,ke=oe===void 0?100:oe,De=r.segmentNumber,ft=De===void 0?30:De,At=r.thetaOffset,Nt=At===void 0?.314:At;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,thetaOffset:Nt})){this.judgeStyleAttributes({opacity:u,thetaOffset:Nt});var Gt=this.layer.getEncodedData(),xr=this.calDataFrame(this.cellLength,Gt,this.cellProperties),dr=xr.data,zr=xr.width,bn=xr.height;this.rowCount=bn,this.dataTexture=this.cellLength>0&&dr.length>0?this.createTexture2D({flipY:!0,data:dr,format:$.LUMINANCE,type:$.FLOAT,width:zr,height:bn}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}L.length===2&&L.push(0,0);var Wn=0,oa=[0,0,0,0],Ma=[0,0,0,0];return l&&p&&(oa=En(l),Ma=En(p),Wn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:(0,ur.isNumber)(Nt)?Nt:0,u_opacity:(0,ur.isNumber)(u)?u:1,u_textureBlend:x==="normal"?0:1,segmentNumber:ft,u_line_type:lT[A||"solid"],u_dash_array:L,u_blur:.9,u_lineDir:z?1:-1,u_texture:this.texture,u_line_texture:ne?1:0,u_icon_step:ke,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Wn,u_sourceColor:oa,u_targetColor:Ma}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.next=4,this.buildModels();case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor,l=r.lineType;return l==="dash"?{frag:nT,vert:iT,type:"Dash"}:o&&u?{frag:sT,vert:uT,type:"Linear"}:{frag:aT,vert:oT,type:""}}},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E,A,T,L,F,z,H;return be().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return u=this.layer.getLayerConfig(),l=u.segmentNumber,p=l===void 0?30:l,v=u.mask,x=v===void 0?!1:v,E=u.maskInside,A=E===void 0?!0:E,T=this.getShaders(),L=T.frag,F=T.vert,z=T.type,oe.next=4,this.layer.buildLayerModel({moduleName:"lineArc2d"+z,vertexShader:F,fragmentShader:L,triangulation:y0,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p,stencil:Hi(x,A)});case 4:return H=oe.sent,oe.abrupt("return",[H]);case 6:case"end":return oe.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Nn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u){var l=r.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}})}}]),t}(oo);function fT(e){var i=hT();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function hT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,dT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,vT=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,mT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
uniform float u_opacity: 1.0;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_segmentIndex;
varying vec2 v_iconMapUV;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,gT={solid:0,dash:1},yT=function(e){(0,Dr.Z)(t,e);var i=fT(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:$.NEAREST,min:$.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.sourceColor,p=r.targetColor,v=r.textureBlend,x=v===void 0?"normal":v,E=r.lineType,A=E===void 0?"solid":E,T=r.dashArray,L=T===void 0?[10,5]:T,F=r.lineTexture,z=F===void 0?!1:F,H=r.iconStep,ne=H===void 0?100:H,oe=r.segmentNumber,ke=oe===void 0?30:oe,De=r.globalArcHeight,ft=De===void 0?10:De;L.length===2&&L.push(0,0);var At=0,Nt=[0,0,0,0],Gt=[0,0,0,0];if(l&&p&&(Nt=En(l),Gt=En(p),At=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var xr=this.layer.getEncodedData(),dr=this.calDataFrame(this.cellLength,xr,this.cellProperties),zr=dr.data,bn=dr.width,Wn=dr.height;this.rowCount=Wn,this.dataTexture=this.cellLength>0&&zr.length>0?this.createTexture2D({flipY:!0,data:zr,format:$.LUMINANCE,type:$.FLOAT,width:bn,height:Wn}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Um,u_global_height:ft,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,ur.isNumber)(u)?u:1,u_textureBlend:x==="normal"?0:1,segmentNumber:ke,u_line_type:gT[A]||0,u_dash_array:L,u_texture:this.texture,u_line_texture:z?1:0,u_icon_step:ne,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:At,u_sourceColor:Nt,u_targetColor:Gt}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.next=4,this.buildModels();case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor;return o&&u?{frag:vT,vert:mT,type:"Linear"}:{frag:pT,vert:dT,type:""}}},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E,A,T,L,F,z,H;return be().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return u=this.layer.getLayerConfig(),l=u.segmentNumber,p=l===void 0?30:l,v=u.mask,x=v===void 0?!1:v,E=u.maskInside,A=E===void 0?!0:E,T=this.getShaders(),L=T.frag,F=T.vert,z=T.type,oe.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+z,vertexShader:F,fragmentShader:L,triangulation:y0,blend:this.getBlend(),segmentNumber:p,stencil:Hi(x,A)});case 4:return H=oe.sent,oe.abrupt("return",[H]);case 6:case"end":return oe.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Nn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u){var l=r.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}})}}]),t}(oo);function _T(e){var i=xT();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function xT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,ET=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,ST=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,wT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
uniform float u_opacity: 1.0;

varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_segmentIndex;
varying vec2 v_iconMapUV;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,CT={solid:0,dash:1},AT=function(e){(0,Dr.Z)(t,e);var i=_T(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:$.NEAREST,min:$.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.sourceColor,p=r.targetColor,v=r.textureBlend,x=v===void 0?"normal":v,E=r.lineType,A=E===void 0?"solid":E,T=r.dashArray,L=T===void 0?[10,5]:T,F=r.lineTexture,z=F===void 0?!1:F,H=r.iconStep,ne=H===void 0?100:H,oe=r.segmentNumber,ke=oe===void 0?30:oe,De=r.globalArcHeight,ft=De===void 0?10:De;L.length===2&&L.push(0,0);var At=0,Nt=[0,0,0,0],Gt=[0,0,0,0];if(l&&p&&(Nt=En(l),Gt=En(p),At=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var xr=this.layer.getEncodedData(),dr=this.calDataFrame(this.cellLength,xr,this.cellProperties),zr=dr.data,bn=dr.width,Wn=dr.height;this.rowCount=Wn,this.dataTexture=this.cellLength>0&&zr.length>0?this.createTexture2D({flipY:!0,data:zr,format:$.LUMINANCE,type:$.FLOAT,width:bn,height:Wn}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_globel:1,u_globel_radius:Um,u_global_height:ft,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,ur.isNumber)(u)?u:1,u_textureBlend:x==="normal"?0:1,segmentNumber:ke,u_line_type:CT[A]||0,u_dash_array:L,u_texture:this.texture,u_line_texture:z?1:0,u_icon_step:ne,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:At,u_sourceColor:Nt,u_targetColor:Gt}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.next=4,this.buildModels();case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor;return o&&u?{frag:ST,vert:wT,type:"Linear"}:{frag:bT,vert:ET,type:""}}},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E,A,T,L,F,z,H;return be().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return u=this.layer.getLayerConfig(),l=u.segmentNumber,p=l===void 0?30:l,v=u.mask,x=v===void 0?!1:v,E=u.maskInside,A=E===void 0?!0:E,T=this.getShaders(),L=T.frag,F=T.vert,z=T.type,oe.next=4,this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+z,vertexShader:F,fragmentShader:L,triangulation:y0,depth:{enable:!0},blend:this.getBlend(),segmentNumber:p,stencil:Hi(x,A)});case 4:return H=oe.sent,oe.abrupt("return",[H]);case 6:case"end":return oe.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Nn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u){var l=r.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}})}}]),t}(oo);function TT(e){var i=MT();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function MT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,IT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,PT={solid:0,dash:1},RT=function(e){(0,Dr.Z)(t,e);var i=TT(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:$.NEAREST,min:$.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.sourceColor,p=r.targetColor,v=r.textureBlend,x=v===void 0?"normal":v,E=r.lineType,A=E===void 0?"solid":E,T=r.dashArray,L=T===void 0?[10,5]:T,F=r.lineTexture,z=F===void 0?!1:F,H=r.iconStep,ne=H===void 0?100:H,oe=r.segmentNumber,ke=oe===void 0?30:oe;L.length===2&&L.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var De=0,ft=[0,0,0,0],At=[0,0,0,0];if(l&&p&&(ft=En(l),At=En(p),De=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Nt=this.layer.getEncodedData(),Gt=this.calDataFrame(this.cellLength,Nt,this.cellProperties),xr=Gt.data,dr=Gt.width,zr=Gt.height;this.rowCount=zr,this.dataTexture=this.cellLength>0&&xr.length>0?this.createTexture2D({flipY:!0,data:xr,format:$.LUMINANCE,type:$.FLOAT,width:dr,height:zr}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,ur.isNumber)(u)?u:1,u_textureBlend:x==="normal"?0:1,segmentNumber:ke,u_line_type:PT[A]||0,u_dash_array:L,u_texture:this.texture,u_line_texture:z?1:0,u_icon_step:ne,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:De,u_sourceColor:ft,u_targetColor:At}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.next=4,this.buildModels();case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E;return be().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:IT,fragmentShader:kT,triangulation:y0,depth:{enable:!1},blend:this.getBlend(),stencil:Hi(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Nn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:4,update:function(u,l,p){return[p[3],p[4],p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u){var l=r.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}})}}]),t}(oo);function LT(e){var i=OT();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function OT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FT=`#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
uniform float u_CoordinateSystem;
varying vec4 v_color;
uniform float u_arrow: 0.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

varying mat4 styleMappingMat;
void main() {
  float distanceAndIndex = styleMappingMat[0][3];
  float miter = styleMappingMat[0][2];

  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B


  if(u_arrow > 0.0 && distanceAndIndex < 2.0) { // arrow
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) { 
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z < 0.0) { // amap
        discard;
      }
    } else { // amap2 mapbox map
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z > 0.0) { 
        discard;
      }
    }
  } else { // line body
    if(miter < 0.0) {
      discard;
    }
  }


  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,DT=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute vec4 a_dirPoints;
attribute vec3 a_DistanceAndIndex;

uniform vec4 u_lineDir;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - a_Miter - a_DistanceAndIndex
    0.0, 0.0, 0.0, 0.0, // originX - originY - vectorX - vectorY
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );
  styleMappingMat[0][3] = a_DistanceAndIndex.y;
  styleMappingMat[0][2] = a_Miter;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  // styleMappingMat[1].rg = a_Position.xy + offset;

  vec2 copyOffset = vec2(offset.x, offset.y);

  float lineDistance = a_DistanceAndIndex.x;
  float total_Distance = a_DistanceAndIndex.z;
  float currentLinePointRatio = lineDistance / total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z); // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }
  
  if(u_arrow > 0.0 && a_DistanceAndIndex.y < 2.0) {
    vec2 startPoint = a_dirPoints.rg;
    vec2 endPoint = a_dirPoints.ba;
    vec4 t1 = project_position(vec4(startPoint, 0, 1.0));
    vec4 t2 = project_position(vec4(endPoint, 0, 1.0));
    // TODO\uFF1A \u540E\u7EED\u4F18\u5316\u53EF\u4EE5\u628A\u4F4D\u7F6E\u8BA1\u7B97\u653E\u5728 cpu \u4E2D\u5B8C\u6210
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      vec2 p1 = (u_Mvp * vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = (u_Mvp * vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    } else {
      vec2 p1 = project_common_position_to_clipspace(vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = project_common_position_to_clipspace(vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    }
  }

  setPickingColor(a_PickingColor);
}
`,BT=function(e){(0,Dr.Z)(t,e);var i=LT(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.sourceColor,p=r.targetColor,v=r.arrow,x=v===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:v,E=0,A=[0,0,0,0],T=[0,0,0,0];if(l&&p&&(A=En(l),T=En(p),E=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var L=this.layer.getEncodedData(),F=this.calDataFrame(this.cellLength,L,this.cellProperties),z=F.data,H=F.width,ne=F.height;this.rowCount=ne,this.dataTexture=this.cellLength>0&&z.length>0?this.createTexture2D({flipY:!0,data:z,format:$.LUMINANCE,type:$.FLOAT,width:H,height:ne}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,ur.isNumber)(u)?u:1,u_linearColor:E,u_sourceColor:A,u_targetColor:T,u_arrow:Number(x.enable),u_arrowHeight:x.arrowHeight||3,u_arrowWidth:x.arrowWidth||2,u_tailWidth:x.tailWidth===void 0?1:x.tailWidth}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E,A,T,L,F,z;return be().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=u.depth,A=E===void 0?!1:E,T=this.getShaders(),L=T.frag,F=T.vert,this.layer.triangulation=cv,ne.next=5,this.layer.buildLayerModel({moduleName:"lineHalf",vertexShader:F,fragmentShader:L,triangulation:cv,depth:{enable:A},blend:this.getBlend(),stencil:Hi(p,x)});case 5:return z=ne.sent,ne.abrupt("return",[z]);case 7:case"end":return ne.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getShaders",value:function(){return{frag:FT,vert:DT,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Nn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o,u,l,p,v,x){return x===void 0?[l[3],10,l[5]]:[l[3],x,l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"dirPoints",type:Nn.Attribute,descriptor:{name:"a_dirPoints",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:4,update:function(o){var u=o.coordinates[0]||[0,0],l=o.coordinates[3]||[0,0];return[u[0],u[1],l[0],l[1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Nn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Nn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o,u,l){return[l[4]]}}})}}]),t}(oo),U1;(function(e){e[e.solid=0]="solid",e[e.dash=1]="dash"})(U1||(U1={}));var yd;(function(e){e.VERTICAL="vertical",e.HORIZONTAL="horizontal"})(yd||(yd={}));var Wm;(function(e){e.NORMAL="normal",e.REPLACE="replace"})(Wm||(Wm={}));var fv;(function(e){e[e.pixel=0]="pixel",e[e.meter=1]="meter"})(fv||(fv={}));var V1;(function(e){e.ALWAYS="always",e.DRAGEND="dragend"})(V1||(V1={}));function NT(e){var i=zT();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function zT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZT=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,UT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,VT=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;

uniform vec3 u_blur;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = styleMappingMat[3][3];
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  gl_FragColor = filterColor(gl_FragColor);
}
`,j1=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,jT=`varying vec4 v_color;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3][0]; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,GT={solid:0,dash:1},G1=function(e){(0,Dr.Z)(t,e);var i=NT(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"texture",n.createTexture2D({data:[0,0,0,0],mag:$.NEAREST,min:$.NEAREST,premultiplyAlpha:!1,width:1,height:1})),(0,W.Z)((0,He.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:$.NEAREST,min:$.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.sourceColor,p=r.targetColor,v=r.textureBlend,x=v===void 0?"normal":v,E=r.lineType,A=E===void 0?"solid":E,T=r.dashArray,L=T===void 0?[10,5,0,0]:T,F=r.lineTexture,z=F===void 0?!1:F,H=r.iconStep,ne=H===void 0?100:H,oe=r.vertexHeightScale,ke=oe===void 0?20:oe,De=r.borderWidth,ft=De===void 0?0:De,At=r.borderColor,Nt=At===void 0?"#ccc":At,Gt=r.raisingHeight,xr=Gt===void 0?0:Gt,dr=r.heightfixed,zr=dr===void 0?!1:dr,bn=r.linearDir,Wn=bn===void 0?yd.VERTICAL:bn,oa=r.blur,Ma=oa===void 0?[1,1,1]:oa,Co=r.arrow,ko=Co===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:Co;L.length===2&&L.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var es=0,Ml=[0,0,0,0],Bv=[0,0,0,0];if(l&&p&&(Ml=En(l),Bv=En(p),es=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var kd=this.layer.getEncodedData(),Nv=this.calDataFrame(this.cellLength,kd,this.cellProperties),$0=Nv.data,Ag=Nv.width,Y0=Nv.height;this.rowCount=Y0,this.dataTexture=this.cellLength>0&&$0.length>0?this.createTexture2D({flipY:!0,data:$0,format:$.LUMINANCE,type:$.FLOAT,width:Ag,height:Y0}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,ur.isNumber)(u)?u:1,u_textureBlend:x===Wm.NORMAL?0:1,u_line_type:GT[A],u_dash_array:L,u_blur:Ma,u_texture:this.texture,u_line_texture:z?1:0,u_icon_step:ne,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:ft,u_borderColor:En(Nt),u_linearDir:Wn===yd.VERTICAL?1:0,u_linearColor:es,u_sourceColor:Ml,u_targetColor:Bv,u_heightfixed:Number(zr),u_vertexScale:ke,u_raisingHeight:Number(xr),u_arrow:Number(ko.enable),u_arrowHeight:ko.arrowHeight||3,u_arrowWidth:ko.arrowWidth||2,u_tailWidth:ko.tailWidth===void 0?1:ko.tailWidth}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E,A,T,L,F,z,H,ne,oe,ke;return be().wrap(function(ft){for(;;)switch(ft.prev=ft.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=u.depth,A=E===void 0?!1:E,T=u.workerEnabled,L=T===void 0?!1:T,F=u.enablePicking,z=this.getShaders(),H=z.frag,ne=z.vert,oe=z.type,this.layer.triangulation=Lh,ft.next=5,this.layer.buildLayerModel({moduleName:"line"+oe,vertexShader:ne,fragmentShader:H,triangulation:Lh,depth:{enable:A},blend:this.getBlend(),stencil:Hi(p,x),workerEnabled:L,workerOptions:{modelType:"line"+oe,enablePicking:F,iconMap:this.iconService.getIconMap()}});case 5:return ke=ft.sent,ft.abrupt("return",[ke]);case 7:case"end":return ft.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor,l=r.lineType;return l==="dash"?{frag:ZT,vert:UT,type:"Dash"}:o&&u?{frag:jT,vert:j1,type:"Linear"}:{frag:VT,vert:j1,type:""}}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Nn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u,l,p,v,x,E){return E===void 0?[p[3],10]:[p[3],E]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Nn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u,l,p){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0],p[1]]:[p,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Nn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(u,l,p,v,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Nn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u,l,p){return[p[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u){var l=r.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}})}}]),t}(oo);function HT(e){var i=WT();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function WT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XT=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  gl_FragColor = texture2D(u_texture, vec2(linearRadio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,$T=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,YT=function(e){(0,Dr.Z)(t,e);var i=HT(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var p=n.layer.getLayerConfig(),v=p.rampColors,x=Ti(v);n.colorTexture=l({data:new Uint8Array(x.data),width:x.width,height:x.height,wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE,min:$.NEAREST,mag:$.NEAREST,flipY:!1})}),n}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.vertexHeightScale,p=l===void 0?20:l,v=r.raisingHeight,x=v===void 0?0:v,E=r.heightfixed,A=E===void 0?!1:E,T=r.linearDir,L=T===void 0?yd.VERTICAL:T;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var F=this.layer.getEncodedData(),z=this.calDataFrame(this.cellLength,F,this.cellProperties),H=z.data,ne=z.width,oe=z.height;this.rowCount=oe,this.dataTexture=this.cellLength>0&&H.length>0?this.createTexture2D({flipY:!0,data:H,format:$.LUMINANCE,type:$.FLOAT,width:ne,height:oe}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_linearDir:L===yd.VERTICAL?1:0,u_opacity:(0,ur.isNumber)(u)?u:1,u_texture:this.colorTexture,u_heightfixed:Number(A),u_vertexScale:p,u_raisingHeight:Number(x)}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),l.next=3,this.buildModels();case 3:return l.abrupt("return",l.sent);case 4:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o;(r=this.colorTexture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E,A,T;return be().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=u.depth,A=E===void 0?!1:E,this.layer.triangulation=cv,F.next=4,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:$T,fragmentShader:XT,triangulation:cv,depth:{enable:A},blend:this.getBlend(),stencil:Hi(p,x)});case 4:return T=F.sent,F.abrupt("return",[T]);case 6:case"end":return F.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Nn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o,u,l,p,v,x){return x===void 0?[l[3],10]:[l[3],x]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Nn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o,u,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Nn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Nn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o,u,l){return[l[4]]}}})}}]),t}(oo);function qT(e){var i=KT();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function KT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QT=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,JT=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];

  // styleMappingMat[3][0] \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = mix(u_sourceColor, u_targetColor, styleMappingMat[3][0]);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,H1=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  v_color = a_Color; 
  styleMappingMat[3][0] = a_Distance / a_Total_Distance;

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,e5=function(e){(0,Dr.Z)(t,e);var i=qT(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.sourceColor,p=r.targetColor,v=r.vertexHeightScale,x=v===void 0?20:v,E=0,A=[0,0,0,0],T=[0,0,0,0];if(l&&p&&(A=En(l),T=En(p),E=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var L=this.layer.getEncodedData(),F=this.calDataFrame(this.cellLength,L,this.cellProperties),z=F.data,H=F.width,ne=F.height;this.rowCount=ne,this.dataTexture=this.cellLength>0&&z.length>0?this.createTexture2D({flipY:!0,data:z,format:$.LUMINANCE,type:$.FLOAT,width:H,height:ne}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,ur.isNumber)(u)?u:1,u_linearColor:E,u_sourceColor:A,u_targetColor:T,u_vertexScale:x}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor;return o&&u?{frag:JT,vert:H1,type:"lineSimpleLinear"}:{frag:QT,vert:H1,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E,A,T,L,F;return be().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=this.getShaders(),A=E.frag,T=E.vert,L=E.type,H.next=4,this.layer.buildLayerModel({moduleName:L,vertexShader:T,fragmentShader:A,triangulation:e3,primitive:$.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:Hi(p,x),pick:!1});case 4:return F=H.sent,H.abrupt("return",[F]);case 6:case"end":return H.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:Nn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o,u,l){return[l[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Nn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o,u,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}})}}]),t}(oo);function t5(e){var i=r5();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function r5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var n5=`#define Animate 0.0
#define LineTexture 1.0

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying vec2 v_iconMapUV;
varying float v_blur;
varying float v_radio;
varying vec4 v_color;
varying vec4 v_dataset;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,i5=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;
uniform float u_linearColor: 0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
varying vec4 v_color;
varying float v_blur;
varying float v_radio;
varying vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,a5=function(e){(0,Dr.Z)(t,e);var i=t5(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:$.NEAREST,min:$.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.sourceColor,p=r.targetColor,v=r.textureBlend,x=v===void 0?"normal":v,E=r.heightfixed,A=E===void 0?!1:E,T=r.lineTexture,L=T===void 0?!1:T,F=r.iconStep,z=F===void 0?100:F,H=r.iconStepCount,ne=H===void 0?1:H;this.rendererService.getDirty()&&this.texture.bind();var oe=0,ke=[0,0,0,0],De=[0,0,0,0];return l&&p&&(ke=En(l),De=En(p),oe=1),{u_heightfixed:Number(A),u_opacity:(0,ur.isNumber)(u)?u:1,u_textureBlend:x==="normal"?0:1,u_texture:this.texture,u_line_texture:L?1:0,u_iconStepCount:ne,u_icon_step:z,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:oe,u_sourceColor:ke,u_targetColor:De}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.next=4,this.buildModels();case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.texture)===null||r===void 0||r.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u;return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:i5,fragmentShader:n5,triangulation:cv,depth:{enable:!1},blend:this.getBlend()});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Nn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u,l,p){return[p[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Nn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u,l,p){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u){var l=u.size,p=l===void 0?1:l;return Array.isArray(p)?[p[0],p[1]]:[p,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Nn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(u,l,p,v,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Nn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u,l,p){return[p[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u){var l=r.iconService.getIconMap(),p=u.texture,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}})}}]),t}(oo),o5={arc:cT,arc3d:yT,greatcircle:RT,wall:a5,line:G1,halfLine:BT,simple:e5,linearline:YT,earthArc3d:AT},s5=o5;function u5(e){var i=l5();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function l5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xm=function(e){(0,Dr.Z)(t,e);var i=u5(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"type","LineLayer"),(0,W.Z)((0,He.Z)(n),"arrowInsertCount",0),(0,W.Z)((0,He.Z)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return(0,zt.Z)(t,[{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u;return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new s5[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},halfLine:{},earthArc3d:{}};return o[r]}},{key:"getModelType",value:function(){var r;if(this.layerType)return this.layerType;var o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(r=o.scale)===null||r===void 0?void 0:r.field;return u||"line"}},{key:"processData",value:function(r){if(this.getModelType()!=="simple")return r;var o=[];return r.map(function(u){if(Array.isArray(u.coordinates)&&Array.isArray(u.coordinates[0])&&Array.isArray(u.coordinates[0][0])){var l=(0,mt.Z)({},u);u.coordinates.map(function(p){o.push((0,mt.Z)((0,mt.Z)({},l),{},{coordinates:p}))})}else o.push(u)}),o}}]),t}(qh);function c5(e){var i=f5();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function f5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var h5=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,p5=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,d5=function(e){(0,Dr.Z)(t,e);var i=c5(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"raiseCount",0),(0,W.Z)((0,He.Z)(n),"raiseRepeat",0),n}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,l=r.opacity,p=l===void 0?1:l,v=r.sourceColor,x=r.targetColor,E=r.pickLight,A=E===void 0?!1:E,T=r.heightfixed,L=T===void 0?!1:T,F=r.opacityLinear,z=F===void 0?{enable:!1,dir:"up"}:F,H=r.lightEnable,ne=H===void 0?!0:H;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var oe=this.layer.getEncodedData(),ke=this.calDataFrame(this.cellLength,oe,this.cellProperties),De=ke.data,ft=ke.width,At=ke.height;this.rowCount=At,this.dataTexture=this.cellLength>0&&De.length>0?this.createTexture2D({flipY:!0,data:De,format:$.LUMINANCE,type:$.FLOAT,width:ft,height:At}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}var Nt=0,Gt=[0,0,0,0],xr=[0,0,0,0];if(v&&x&&(Gt=En(v),xr=En(x),Nt=1),this.raiseCount<1&&this.raiseRepeat>0&&u.enable){var dr=u.speed,zr=dr===void 0?.01:dr;this.raiseCount+=zr,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(A),u_heightfixed:Number(L),u_r:u.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,ur.isNumber)(p)?p:1,u_linearColor:Nt,u_sourceColor:Gt,u_targetColor:xr,u_opacitylinear:Number(z.enable),u_opacitylinear_dir:z.dir==="up"?1:0,u_lightEnable:Number(ne)}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v;return be().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.layer.getLayerConfig(),l=u.animateOption.repeat,p=l===void 0?1:l,this.raiseRepeat=p,E.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:p5,fragmentShader:h5,triangulation:Gm,depth:{enable:!0},cull:{enable:!0,face:Oh(this.mapService.version)},blend:this.getBlend()});case 4:return v=E.sent,E.abrupt("return",[v]);case 6:case"end":return E.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o){var u=o.size;if(u){var l=[];return Array.isArray(u)&&(l=u.length===2?[u[0],u[0],u[1]]:u),Array.isArray(u)||(l=[u,u,u]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Nn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Nn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o){var u=jr(o.coordinates);return C1([u[0],u[1]])}}})}}]),t}(oo);function v5(e){var i=m5();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function m5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var g5=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,y5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);

  setPickingColor(a_PickingColor);
}
`,_5=function(e){(0,Dr.Z)(t,e);var i=v5(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.strokeOpacity,p=l===void 0?1:l,v=r.strokeWidth,x=v===void 0?0:v,E=r.stroke,A=E===void 0?"rgba(0,0,0,0)":E,T=r.offsets,L=T===void 0?[0,0]:T,F=r.blend,z=r.blur,H=z===void 0?0:z;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:p,strokeWidth:x,stroke:A,offsets:L})){this.judgeStyleAttributes({opacity:u,strokeOpacity:p,strokeWidth:x,stroke:A,offsets:L});var ne=this.layer.getEncodedData(),oe=this.calDataFrame(this.cellLength,ne,this.cellProperties),ke=oe.data,De=oe.width,ft=oe.height;this.rowCount=ft,this.dataTexture=this.cellLength>0&&ke.length>0?this.createTexture2D({flipY:!0,data:ke,format:$.LUMINANCE,type:$.FLOAT,width:De,height:ft}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_blur:H,u_additive:F==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,ur.isNumber)(u)?u:1,u_stroke_opacity:(0,ur.isNumber)(p)?p:1,u_stroke_width:(0,ur.isNumber)(x)?x:1,u_stroke_color:this.getStrokeColor(A),u_offsets:this.isOffsetStatic(L)?L:[0,0]}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u;return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return this.layer.triangulation=R1,p.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:y5,fragmentShader:g5,triangulation:R1,depth:{enable:!0},blend:this.getBlend()});case 3:return u=p.sent,p.abrupt("return",[u]);case 5:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Nn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(u,l,p,v){var x=(0,$n.Z)(p,3),E=x[0],A=x[1],T=x[2],L=so.fromValues(0,0,1),F=so.fromValues(E,0,T),z=E>=0?so.angle(L,F):Math.PI*2-so.angle(L,F),H=Math.PI*2-Math.asin(A/100),ne=Oa();Bh(ne,ne,z),sf(ne,ne,H);var oe=so.fromValues(1,1,0);so.transformMat4(oe,oe,ne),so.normalize(oe,oe);var ke=so.fromValues(-1,1,0);so.transformMat4(ke,ke,ne),so.normalize(ke,ke);var De=so.fromValues(-1,-1,0);so.transformMat4(De,De,ne),so.normalize(De,De);var ft=so.fromValues(1,-1,0);so.transformMat4(ft,ft,ne),so.normalize(ft,ft);var At=[].concat((0,cr.Z)(oe),(0,cr.Z)(ke),(0,cr.Z)(De),(0,cr.Z)(ft)),Nt=v%4*3;return[At[Nt],At[Nt+1],At[Nt+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Nn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.shape,p=l===void 0?2:l,v=r.layer.getLayerConfig().shape2d,x=v.indexOf(p);return[x]}}})}}]),t}(oo);function x5(e){var i=b5();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function b5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var E5=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,S5=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }

  setPickingColor(a_PickingColor);
}
`,W1=function(e){(0,Dr.Z)(t,e);var i=x5(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"raiseCount",0),(0,W.Z)((0,He.Z)(n),"raiseRepeat",0),n}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,l=r.opacity,p=l===void 0?1:l,v=r.sourceColor,x=r.targetColor,E=r.pickLight,A=E===void 0?!1:E,T=r.heightfixed,L=T===void 0?!1:T,F=r.opacityLinear,z=F===void 0?{enable:!1,dir:"up"}:F,H=r.lightEnable,ne=H===void 0?!0:H;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var oe=this.layer.getEncodedData(),ke=this.calDataFrame(this.cellLength,oe,this.cellProperties),De=ke.data,ft=ke.width,At=ke.height;this.rowCount=At,this.dataTexture=this.cellLength>0&&De.length>0?this.createTexture2D({flipY:!0,data:De,format:$.LUMINANCE,type:$.FLOAT,width:ft,height:At}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}var Nt=0,Gt=[0,0,0,0],xr=[0,0,0,0];if(v&&x&&(Gt=En(v),xr=En(x),Nt=1),this.raiseCount<1&&this.raiseRepeat>0&&u.enable){var dr=u.speed,zr=dr===void 0?.01:dr;this.raiseCount+=zr,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(A),u_heightfixed:Number(L),u_r:u.enable&&this.raiseRepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,ur.isNumber)(p)?p:1,u_linearColor:Nt,u_sourceColor:Gt,u_targetColor:xr,u_opacitylinear:Number(z.enable),u_opacitylinear_dir:z.dir==="up"?1:0,u_lightEnable:Number(ne)}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E;return be().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.depth,p=l===void 0?!0:l,v=u.animateOption.repeat,x=v===void 0?1:v,this.raiseRepeat=x,T.next=4,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:S5,fragmentShader:E5,triangulation:Gm,blend:this.getBlend(),cull:{enable:!0,face:Oh(this.mapService.version)},depth:{enable:p}});case 4:return E=T.sent,T.abrupt("return",[E]);case 6:case"end":return T.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o){var u=o.size;if(u){var l=[];return Array.isArray(u)&&(l=u.length===2?[u[0],u[0],u[1]]:u),Array.isArray(u)||(l=[u,u,u]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Nn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o,u,l,p,v){return v}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Nn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o){var u=jr(o.coordinates);return[u[0],u[1],0]}}})}}]),t}(oo);function w5(e){var i=C5();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function C5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var X1=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  
  // \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,A5=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,$m=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform int u_Size_Unit;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;
if(u_Size_Unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);
  
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_raisingHeight;

  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }
 

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position =  u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,$1=function(e){(0,Dr.Z)(t,e);var i=w5(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.strokeOpacity,p=l===void 0?1:l,v=r.strokeWidth,x=v===void 0?0:v,E=r.stroke,A=E===void 0?"rgba(0,0,0,0)":E,T=r.offsets,L=T===void 0?[0,0]:T,F=r.blend,z=r.blur,H=z===void 0?0:z,ne=r.raisingHeight,oe=ne===void 0?0:ne,ke=r.heightfixed,De=ke===void 0?!1:ke,ft=r.unit,At=ft===void 0?"pixel":ft;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:p,strokeWidth:x,stroke:A,offsets:L})){this.judgeStyleAttributes({opacity:u,strokeOpacity:p,strokeWidth:x,stroke:A,offsets:L});var Nt=this.layer.getEncodedData(),Gt=this.calDataFrame(this.cellLength,Nt,this.cellProperties),xr=Gt.data,dr=Gt.width,zr=Gt.height;this.rowCount=zr,this.dataTexture=this.cellLength>0&&xr.length>0?this.createTexture2D({flipY:!0,data:xr,format:$.LUMINANCE,type:$.FLOAT,width:dr,height:zr}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(oe),u_heightfixed:Number(De),u_blur:H,u_additive:F==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,ur.isNumber)(u)?u:1,u_stroke_opacity:(0,ur.isNumber)(p)?p:1,u_stroke_width:(0,ur.isNumber)(x)?x:1,u_stroke_color:this.getStrokeColor(A),u_Size_Unit:fv[At],u_offsets:this.isOffsetStatic(L)?L:[0,0]}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),tf)}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E,A,T,L,F,z,H,ne,oe,ke,De;return be().wrap(function(At){for(;;)switch(At.prev=At.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=u.animateOption,A=E===void 0?{enable:!1}:E,T=u.workerEnabled,L=T===void 0?!1:T,F=u.enablePicking,z=u.shape2d,H=this.getShaders(A),ne=H.frag,oe=H.vert,ke=H.type,this.layer.triangulation=tf,At.next=5,this.layer.buildLayerModel({moduleName:ke,vertexShader:oe,fragmentShader:ne,triangulation:tf,depth:{enable:!1},blend:this.getBlend(),stencil:Hi(p,x),workerEnabled:L,workerOptions:{modelType:ke,enablePicking:F,shape2d:z}});case 5:return De=At.sent,At.abrupt("return",[De]);case 7:case"end":return At.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getShaders",value:function(r){if(r.enable)switch(r.type){case"wave":return{frag:X1,vert:$m,type:"pointWave"};default:return{frag:X1,vert:$m,type:"pointWave"}}else return{frag:A5,vert:$m,type:"pointFill"}}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Nn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(u,l,p,v){var x=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],E=v%4*3;return[x[E],x[E+1],x[E+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Nn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.shape,p=l===void 0?2:l,v=r.indexOf(p);return[v]}}})}}]),t}(oo);function T5(e){var i=M5();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function M5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var k5=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,I5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform int u_Size_Unit;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float newSize = a_Size;
  if(u_Size_Unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (newSize) + textrueOffsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp *vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,P5=function(e){(0,Dr.Z)(t,e);var i=T5(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"meter2coord",1),(0,W.Z)((0,He.Z)(n),"isMeter",!1),(0,W.Z)((0,He.Z)(n),"radian",0),(0,W.Z)((0,He.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=l({data:n.iconService.getCanvas(),mag:$.LINEAR,min:$.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.offsets,p=l===void 0?[0,0]:l,v=r.rotation,x=r.raisingHeight,E=x===void 0?0:x,A=r.heightfixed,T=A===void 0?!1:A,L=r.unit,F=L===void 0?"pixel":L;this.rendererService.getDirty()&&this.texture.bind();var z=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(z=-1),this.radian=v!==void 0?z*Math.PI*v/180:z*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:p})){this.judgeStyleAttributes({opacity:u,offsets:p});var H=this.layer.getEncodedData(),ne=this.calDataFrame(this.cellLength,H,this.cellProperties),oe=ne.data,ke=ne.width,De=ne.height;this.rowCount=De,this.dataTexture=this.cellLength>0&&oe.length>0?this.createTexture2D({flipY:!0,data:oe,format:$.LUMINANCE,type:$.FLOAT,width:ke,height:De}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(E),u_heightfixed:Number(T),u_Size_Unit:fv[F],u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,ur.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(p)?p:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),m0)}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.next=4,this.buildModels();case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E;return be().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:I5,fragmentShader:k5,triangulation:m0,depth:{enable:!1},blend:this.getBlend(),stencil:Hi(p,x),cull:{enable:!0,face:Oh(this.mapService.version)}});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o;this.iconService.off("imageUpdate",this.updateTexture),(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Nn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.rotate,p=l===void 0?0:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u){var l=r.iconService.getIconMap(),p=u.shape,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Nn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(u,l,p,v){var x=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],E=v%4*3;return[x[E],x[E+1],x[E+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}})}}]),t}(oo);function R5(e){var i=L5();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function L5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var O5=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,F5=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(textrueOffsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,Y1=function(e){(0,Dr.Z)(t,e);var i=R5(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(function(){n.layerService.throttleRenderLayers()});return}n.texture=l({data:n.iconService.getCanvas(),mag:$.LINEAR,min:$.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.offsets,p=l===void 0?[0,0]:l,v=r.raisingHeight,x=v===void 0?0:v,E=r.heightfixed,A=E===void 0?!1:E;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:p})){this.judgeStyleAttributes({opacity:u,offsets:p});var T=this.layer.getEncodedData(),L=this.calDataFrame(this.cellLength,T,this.cellProperties),F=L.data,z=L.width,H=L.height;this.rowCount=H,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:$.LUMINANCE,type:$.FLOAT,width:z,height:H}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(x),u_heightfixed:Number(A),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,ur.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(p)?p:[0,0]}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.next=4,this.buildModels();case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E;return be().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:F5,fragmentShader:O5,triangulation:JA,depth:{enable:!1},primitive:$.POINTS,blend:this.getBlend(),stencil:Hi(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(u){var l=u.size,p=l===void 0?5:l;return Array.isArray(p)?[p[0]]:[p]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(u){var l=r.iconService.getIconMap(),p=u.shape,v=l[p]||{x:0,y:0},x=v.x,E=v.y;return[x,E]}}})}}]),t}(oo);function D5(e){var i=B5();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function B5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var N5=`uniform float u_opacity : 1;
varying vec4 v_color;
void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;
}
`,z5=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;

varying vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
}
`;function q1(e){var i=e.coordinates;return{vertices:(0,cr.Z)(i),indices:[0],size:i.length}}var K1=function(e){(0,Dr.Z)(t,e);var i=D5(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o;return{u_opacity:(0,ur.isNumber)(u)?u:1}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E;return be().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,this.layer.triangulation=q1,T.next=4,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:z5,fragmentShader:N5,triangulation:q1,depth:{enable:!1},primitive:$.POINTS,blend:this.getBlend(),stencil:Hi(p,x),pick:!1});case 4:return E=T.sent,T.abrupt("return",[E]);case 6:case"end":return T.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(oo);function Z5(e){var i=U5();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function U5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var V5=`
uniform float u_additive;
uniform float u_opacity: 1.0;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;
#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  v_exteude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,j5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
uniform float u_speed: 1.0;
uniform float u_time;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform int u_Size_Unit;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_exteude = rotateMatrix * a_Extrude.xy;

  // unpack color(vec2)
  v_color = a_Color;



  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_Size_Unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  // radius(16-bit)
  v_radius = newSize;

  vec2 offset = (extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
  offset = project_pixel(offset);
  
  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp *vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,G5=function(e){(0,Dr.Z)(t,e);var i=Z5(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.blend,p=r.speed,v=p===void 0?1:p,x=r.unit,E=x===void 0?"pixel":x;return{u_Size_Unit:fv[E],u_speed:v,u_additive:l==="additive"?1:0,u_opacity:(0,ur.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1}:o;return{u_animate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),m0)}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E;return be().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:j5,fragmentShader:V5,triangulation:m0,depth:{enable:!1},blend:this.getBlend(),stencil:Hi(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Nn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(o,u,l,p){var v=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],x=p%4*3;return[v[x],v[x+1],v[x+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?5:u;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(oo);function H5(e){var i=W5();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function W5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var X5=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,$5=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Q1(e){var i=e.coordinates;return{vertices:(0,cr.Z)(i),indices:[0],size:i.length}}var Y5=function(e){(0,Dr.Z)(t,e);var i=H5(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.offsets,p=l===void 0?[0,0]:l,v=r.blend,x=r.strokeOpacity,E=x===void 0?1:x,A=r.strokeWidth,T=A===void 0?0:A,L=r.stroke,F=L===void 0?"#fff":L;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:p})){this.judgeStyleAttributes({opacity:u,offsets:p});var z=this.layer.getEncodedData(),H=this.calDataFrame(this.cellLength,z,this.cellProperties),ne=H.data,oe=H.width,ke=H.height;this.rowCount=ke,this.dataTexture=this.cellLength>0&&ne.length>0?this.createTexture2D({flipY:!0,data:ne,format:$.LUMINANCE,type:$.FLOAT,width:oe,height:ke}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_additive:v==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,ur.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(p)?p:[0,0],u_stroke_opacity:(0,ur.isNumber)(E)?E:1,u_stroke_width:(0,ur.isNumber)(T)?T:1,u_stroke_color:this.getStrokeColor(F)}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E;return be().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,this.layer.triangulation=Q1,T.next=4,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:$5,fragmentShader:X5,triangulation:Q1,depth:{enable:!1},primitive:$.POINTS,blend:this.getBlend(),stencil:Hi(p,x)});case 4:return E=T.sent,T.abrupt("return",[E]);case 6:case"end":return T.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?1:u;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(oo);function q5(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=K5(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function K5(e,i){if(!!e){if(typeof e=="string")return J1(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return J1(e,i)}}function J1(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}var Q5=function(){function e(i,t,n){(0,wt.Z)(this,e),(0,W.Z)(this,"boxCells",[]);var r=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(t/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)r.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=t,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/t,this.boxUid=0}return(0,zt.Z)(e,[{key:"insert",value:function(t,n,r,o,u){this.forEachCell(n,r,o,u,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(u)}},{key:"query",value:function(t,n,r,o,u){return this.queryHitTest(t,n,r,o,!1,u)}},{key:"hitTest",value:function(t,n,r,o,u){return this.queryHitTest(t,n,r,o,!0,u)}},{key:"insertBoxCell",value:function(t,n,r,o,u,l){this.boxCells[u].push(l)}},{key:"queryHitTest",value:function(t,n,r,o,u,l){if(r<0||t>this.width||o<0||n>this.height)return u?!1:[];var p=[];if(t<=0&&n<=0&&this.width<=r&&this.height<=o){if(u)return!0;for(var v=0;v<this.boxKeys.length;v++)p.push({key:this.boxKeys[v],x1:this.bboxes[v*4],y1:this.bboxes[v*4+1],x2:this.bboxes[v*4+2],y2:this.bboxes[v*4+3]});return l?p.filter(l):p}var x={hitTest:u,seenUids:{box:{},circle:{}}};return this.forEachCell(t,n,r,o,this.queryCell,p,x,l),u?p.length>0:p}},{key:"queryCell",value:function(t,n,r,o,u,l,p,v){var x=p.seenUids,E=this.boxCells[u];if(E!==null){var A=this.bboxes,T=q5(E),L;try{for(T.s();!(L=T.n()).done;){var F=L.value;if(!x.box[F]){x.box[F]=!0;var z=F*4;if(t<=A[z+2]&&n<=A[z+3]&&r>=A[z+0]&&o>=A[z+1]&&(!v||v(this.boxKeys[F]))){if(p.hitTest)return l.push(!0),!0;l.push({key:this.boxKeys[F],x1:A[z],y1:A[z+1],x2:A[z+2],y2:A[z+3]})}}}}catch(H){T.e(H)}finally{T.f()}}return!1}},{key:"forEachCell",value:function(t,n,r,o,u,l,p,v){for(var x=this.convertToXCellCoord(t),E=this.convertToYCellCoord(n),A=this.convertToXCellCoord(r),T=this.convertToYCellCoord(o),L=x;L<=A;L++)for(var F=E;F<=T;F++){var z=this.xCellCount*F+L;if(u.call(this,t,n,r,o,z,l,p,v))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),e}(),J5=Q5,e4=function(){function e(i,t){(0,wt.Z)(this,e),(0,W.Z)(this,"viewportPadding",100),this.width=i,this.height=t,this.viewportPadding=Math.max(i,t),this.grid=new J5(i+this.viewportPadding,t+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=t+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=t+2*this.viewportPadding}return(0,zt.Z)(e,[{key:"placeCollisionBox",value:function(t){var n=t.x1+t.anchorPointX+this.viewportPadding,r=t.y1+t.anchorPointY+this.viewportPadding,o=t.x2+t.anchorPointX+this.viewportPadding,u=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,r,o,u)||this.grid.hitTest(n,r,o,u)?{box:[]}:{box:[n,r,o,u]}}},{key:"insertCollisionBox",value:function(t,n){var r={featureIndex:n};this.grid.insert(r,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,n,r){var o=$v(n,r,0,1),u=dh(),l=ba.apply(Le,(0,cr.Z)(t));return Jd(u,o,l),{x:(u[0]/u[3]+1)/2*this.width+this.viewportPadding,y:(-u[1]/u[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,n,r,o){return r>=0&&t<this.gridRightBoundary&&o>=0&&n<this.gridBottomBoundary}}]),e}();function ex(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=t4(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function t4(e,i){if(!!e){if(typeof e=="string")return tx(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return tx(e,i)}}function tx(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function rx(e){var i=.5,t=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0;break;default:t=.5}return{horizontalAlign:i,verticalAlign:t}}function nx(e,i,t,n,r){if(!!r){var o=e[n],u=o.glyph;if(u)for(var l=i[u].advance*o.scale,p=(e[n].x+l)*r,v=t;v<=n;v++)e[v].x-=p}}function ix(e,i,t,n,r,o,u){var l=(i-t)*r,p=(-n*u+.5)*o,v=ex(e),x;try{for(v.s();!(x=v.n()).done;){var E=x.value;E.x+=l,E.y+=p}}catch(A){v.e(A)}finally{v.f()}}function r4(e,i,t,n,r,o,u){var l=-8,p=0,v=l,x=0,E=e.positionedGlyphs,A=o==="right"?1:o==="left"?0:.5,T=E.length;t.forEach(function(ne){if(ne.split("").forEach(function(ke){var De=i[ke],ft=0;De&&(E.push({glyph:ke,x:p,y:v+ft,vertical:!1,scale:1,metrics:De}),p+=De.advance+u)}),E.length!==T){var oe=p-u;x=Math.max(oe,x),nx(E,i,T,E.length-1,A)}p=0,v-=n+5});var L=rx(r),F=L.horizontalAlign,z=L.verticalAlign;ix(E,A,F,z,x,n,t.length);var H=v-l;e.top+=-z*H,e.bottom=e.top-H,e.left+=-F*x,e.right=e.left+x}function n4(e,i,t,n,r,o,u){var l=-8,p=0,v=l,x=0,E=e.positionedGlyphs,A=o==="right"?1:o==="left"?0:.5,T=E.length;t.forEach(function(ne){var oe=i[ne],ke=0;if(oe&&(E.push({glyph:ne,x:oe.advance/2,y:v+ke,vertical:!1,scale:1,metrics:oe}),p+=oe.advance+u),E.length!==T){var De=p-u;x=Math.max(De,x),nx(E,i,T,E.length-1,A)}p=0,v-=n+5});var L=rx(r),F=L.horizontalAlign,z=L.verticalAlign;ix(E,A,F,z,x,n,t.length);var H=v-l;e.top+=-z*H,e.bottom=e.top-H,e.left+=-F*x,e.right=e.left+x}function i4(e,i,t,n,r,o){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],l=arguments.length>7?arguments[7]:void 0,p=e.split(`
`),v=[],x={positionedGlyphs:v,top:u[1],bottom:u[1],left:u[0],right:u[0],lineCount:p.length,text:e};return l?n4(x,i,p,t,n,r,o):r4(x,i,p,t,n,r,o),v.length?x:!1}function a4(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],t=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,r=n===void 0?[]:n,o=[],u=ex(r),l;try{for(u.s();!(l=u.n()).done;){var p=l.value,v=p.metrics,x=4,E=v.advance*p.scale/2,A=t?[p.x+E,p.y]:[0,0],T=t?[0,0]:[p.x+E+i[0],p.y+i[1]],L=(0-x)*p.scale-E+T[0],F=(0-x)*p.scale+T[1],z=L+v.width*p.scale,H=F+v.height*p.scale,ne={x:L,y:F},oe={x:z,y:F},ke={x:L,y:H},De={x:z,y:H};o.push({tl:ne,tr:oe,bl:ke,br:De,tex:v,glyphOffset:A})}}catch(ft){u.e(ft)}finally{u.f()}return o}function o4(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=s4(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function s4(e,i){if(!!e){if(typeof e=="string")return ax(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ax(e,i)}}function ax(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function u4(e){var i=l4();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function l4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ox=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,sx=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp *(vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function ux(e){var i=this,t=e.id,n=[],r=[];if(!i.glyphInfoMap||!i.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var o=i.glyphInfoMap[t].centroid,u=o.length===2?[o[0],o[1],0]:o;return i.glyphInfoMap[t].glyphQuads.forEach(function(l,p){n.push.apply(n,(0,cr.Z)(u).concat([l.tex.x,l.tex.y+l.tex.height,l.tl.x,l.tl.y],(0,cr.Z)(u),[l.tex.x+l.tex.width,l.tex.y+l.tex.height,l.tr.x,l.tr.y],(0,cr.Z)(u),[l.tex.x+l.tex.width,l.tex.y,l.br.x,l.br.y],(0,cr.Z)(u),[l.tex.x,l.tex.y,l.bl.x,l.bl.y])),r.push(0+p*4,1+p*4,2+p*4,2+p*4,3+p*4,0+p*4)}),{vertices:n,indices:r,size:7}}var lx=function(e){(0,Dr.Z)(t,e);var i=u4(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"glyphInfoMap",{}),(0,W.Z)((0,He.Z)(n),"currentZoom",-1),(0,W.Z)((0,He.Z)(n),"textureHeight",0),(0,W.Z)((0,He.Z)(n),"textCount",0),(0,W.Z)((0,He.Z)(n),"preTextStyle",{}),(0,W.Z)((0,He.Z)(n),"mapping",(0,Wt.Z)(be().mark(function l(){return be().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return n.initGlyph(),n.updateTexture(),v.next=4,n.reBuildModel();case 4:case"end":return v.stop()}},l)}))),n}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.stroke,p=l===void 0?"#fff":l,v=r.strokeWidth,x=v===void 0?0:v,E=r.textAnchor,A=E===void 0?"center":E,T=r.textOffset,L=r.textAllowOverlap,F=L===void 0?!1:L,z=r.halo,H=z===void 0?.5:z,ne=r.gamma,oe=ne===void 0?2:ne,ke=r.raisingHeight,De=ke===void 0?0:ke,ft=this.fontService,At=ft.canvas,Nt=ft.mapping;if(Nt&&Object.keys(Nt).length!==this.textCount&&At&&(this.updateTexture(),this.textCount=Object.keys(Nt).length),this.preTextStyle={textAnchor:A,textAllowOverlap:F,textOffset:T},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeWidth:x,stroke:p})){this.judgeStyleAttributes({opacity:u,strokeWidth:x,stroke:p});var Gt=this.layer.getEncodedData(),xr=this.calDataFrame(this.cellLength,Gt,this.cellProperties),dr=xr.data,zr=xr.width,bn=xr.height;this.rowCount=bn,this.dataTexture=this.cellLength>0&&dr.length>0?this.createTexture2D({flipY:!0,data:dr,format:$.LUMINANCE,type:$.FLOAT,width:zr,height:bn}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(De),u_opacity:(0,ur.isNumber)(u)?u:1,u_stroke_width:(0,ur.isNumber)(x)?x:1,u_stroke_color:this.getStrokeColor(p),u_sdf_map:this.texture,u_halo_blur:H,u_gamma_scale:oe,u_sdf_map_size:[(At==null?void 0:At.width)||1,(At==null?void 0:At.height)||1]}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E;return be().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),u=this.layer.getLayerConfig(),l=u.textAnchor,p=l===void 0?"center":l,v=u.textAllowOverlap,x=v===void 0?!0:v,E=u.textOffset,this.preTextStyle={textAnchor:p,textAllowOverlap:x,textOffset:E},T.next=6,this.buildModels();case 6:return T.abrupt("return",T.sent);case 7:case"end":return T.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E,A,T;return be().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=u.textAllowOverlap,A=E===void 0?!1:E,this.initGlyph(),this.updateTexture(),A||this.filterGlyphs(),F.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:sx,fragmentShader:ox,triangulation:ux.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:Hi(p,x)});case 6:return T=F.sent,F.abrupt("return",[T]);case 8:case"end":return F.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"needUpdate",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E,A,T,L,F;return be().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:if(u=this.layer.getLayerConfig(),l=u.textAllowOverlap,p=l===void 0?!1:l,v=u.textAnchor,x=v===void 0?"center":v,E=u.textOffset,A=this.layer.getEncodedData(),!(JSON.stringify(E)!==JSON.stringify(this.preTextStyle.textOffset)||x!==this.preTextStyle.textAnchor)){H.next=6;break}return H.next=5,this.mapping();case 5:return H.abrupt("return",!0);case 6:if(!(A.length<5||p)){H.next=8;break}return H.abrupt("return",!1);case 8:if(T=this.mapService.getZoom(),L=this.mapService.getBounds(),F=Fe(this.extent,L),!(Math.abs(this.currentZoom-T)>1||!F||p!==this.preTextStyle.textAllowOverlap)){H.next=15;break}return H.next=14,this.reBuildModel();case 14:return H.abrupt("return",!0);case 15:return H.abrupt("return",!1);case 16:case"end":return H.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Nn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o){var u=o.rotate,l=u===void 0?0:u;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Nn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o,u,l){return[l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(o){var u=o.size,l=u===void 0?12:u;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Nn.Attribute,descriptor:{name:"a_tex",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var r=this.mapService.getBounds();return nt(r,.5)}},{key:"initTextFont",value:function(){var r=this.layer.getLayerConfig(),o=r.fontWeight,u=o===void 0?"400":o,l=r.fontFamily,p=l===void 0?"sans-serif":l,v=this.layer.getEncodedData(),x=[];v.forEach(function(E){var A=E.shape,T=A===void 0?"":A;T=T.toString();var L=o4(T),F;try{for(L.s();!(F=L.n()).done;){var z=F.value;x.indexOf(z)===-1&&x.push(z)}}catch(H){L.e(H)}finally{L.f()}}),this.fontService.setFontOptions({characterSet:x,fontWeight:u,fontFamily:p,iconfont:!1})}},{key:"initIconFontTex",value:function(){var r=this.layer.getLayerConfig(),o=r.fontWeight,u=o===void 0?"400":o,l=r.fontFamily,p=l===void 0?"sans-serif":l,v=this.layer.getEncodedData(),x=[];v.forEach(function(E){var A=E.shape,T=A===void 0?"":A;T="".concat(T),x.indexOf(T)===-1&&x.push(T)}),this.fontService.setFontOptions({characterSet:x,fontWeight:u,fontFamily:p,iconfont:!0})}},{key:"generateGlyphLayout",value:function(r){var o=this,u=this.fontService.mapping,l=this.layer.getLayerConfig(),p=l.spacing,v=p===void 0?2:p,x=l.textAnchor,E=x===void 0?"center":x,A=l.textOffset,T=this.layer.getEncodedData();this.glyphInfo=T.map(function(L){var F=L.shape,z=F===void 0?"":F,H=L.id,ne=L.size,oe=ne===void 0?1:ne,ke=i4(z.toString(),u,oe,E,"left",v,A||L.textOffset||[0,0],r),De=a4(ke,A,!1);return L.shaping=ke,L.glyphQuads=De,L.centroid=jr(L.coordinates),L.originCentroid=L.version==="GAODE2.x"?jr(L.originCoordinates):L.originCentroid=L.centroid,o.glyphInfoMap[H]={shaping:ke,glyphQuads:De,centroid:jr(L.coordinates)},L})}},{key:"filterGlyphs",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.padding,l=u===void 0?[0,0]:u,p=o.textAllowOverlap,v=p===void 0?!1:p;if(!v){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var x=this.rendererService.getViewportSize(),E=x.width,A=x.height,T=new e4(E,A),L=this.glyphInfo.filter(function(F){var z=F.shaping,H=F.id,ne=H===void 0?0:H,oe=F.version==="GAODE2.x"?F.originCentroid:F.centroid,ke=F.size,De=ke/16,ft=r.mapService.lngLatToContainer(oe),At=T.placeCollisionBox({x1:z.left*De-l[0],x2:z.right*De+l[0],y1:z.top*De-l[1],y2:z.bottom*De+l[1],anchorPointX:ft.x,anchorPointY:ft.y}),Nt=At.box;return Nt&&Nt.length?(T.insertCollisionBox(Nt,ne),!0):!1});L.forEach(function(F){r.glyphInfoMap[F.id]=F})}}},{key:"initGlyph",value:function(){var r=this.layer.getLayerConfig(),o=r.iconfont,u=o===void 0?!1:o;u?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(u)}},{key:"updateTexture",value:function(){var r=this.rendererService.createTexture2D,o=this.fontService.canvas;this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=r({data:o,mag:$.LINEAR,min:$.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E;return be().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,this.filterGlyphs(),T.next=4,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:sx,fragmentShader:ox,triangulation:ux.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:Hi(p,x)});case 4:E=T.sent,this.layer.models=[E];case 6:case"end":return T.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()}]),t}(oo),c4={fillImage:P5,fill:$1,radar:G5,image:Y1,normal:K1,simplePoint:Y5,extrude:W1,text:lx,earthFill:_5,earthExtrude:d5},f4=c4;function h4(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=p4(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(v){throw v},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,l;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return o=v.done,v},e:function(v){u=!0,l=v},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw l}}}}function p4(e,i){if(!!e){if(typeof e=="string")return cx(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return cx(e,i)}}function cx(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function d4(e){var i=v4();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function v4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var x0=function(e){(0,Dr.Z)(t,e);var i=d4(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"type","PointLayer"),(0,W.Z)((0,He.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return(0,zt.Z)(t,[{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u;return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new f4[u](this),p.next=5,this.initLayerModels();case 5:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"rebuildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var r=this.shapeOption,o=r.field,u=r.values,l=this.getLayerConfig(),p=l.shape2d,v=this.iconService.getIconMap();if(o&&(p==null?void 0:p.indexOf(o))!==-1)return"fill";if(u==="text")return"text";if(u&&u instanceof Array){var x=h4(u),E;try{for(x.s();!(E=x.n()).done;){var A=E.value;if(typeof A=="string"&&v.hasOwnProperty(A))return"image"}}catch(T){x.e(T)}finally{x.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return o[r]}},{key:"getModelType",value:function(){var r=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,l=o.shape3d,p=this.iconService.getIconMap(),v=r.find(function(E){return E.hasOwnProperty("shape")});if(v){var x=v.shape;return x==="dot"?"normal":x==="simple"?"simplePoint":x==="radar"?"radar":this.layerType==="fillImage"?"fillImage":(u==null?void 0:u.indexOf(x))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(l==null?void 0:l.indexOf(x))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":p.hasOwnProperty(x)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),t}(qh);function m4(e){var i=g4();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function g4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var y4=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,_4=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,x4=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,b4=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,E4=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,S4=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,w4=function(e){(0,Dr.Z)(t,e);var i=m4(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.heightfixed,p=l===void 0?!1:l,v=r.raisingHeight,x=v===void 0?0:v,E=r.topsurface,A=E===void 0?!0:E,T=r.sidesurface,L=T===void 0?!0:T,F=r.sourceColor,z=r.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var H=this.layer.getEncodedData(),ne=this.calDataFrame(this.cellLength,H,this.cellProperties),oe=ne.data,ke=ne.width,De=ne.height;this.rowCount=De,this.dataTexture=this.cellLength>0&&oe.length>0?this.createTexture2D({flipY:!0,data:oe,format:$.LUMINANCE,type:$.FLOAT,width:ke,height:De}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}var ft=0,At=[1,1,1,1],Nt=[1,1,1,1];return F&&z&&(At=En(F),Nt=En(z),ft=1),{u_topsurface:Number(A),u_sidesurface:Number(L),u_heightfixed:Number(p),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(x),u_opacity:(0,ur.isNumber)(u)?u:1,u_linearColor:ft,u_sourceColor:At,u_targetColor:Nt,u_texture:this.texture}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.next=3,this.buildModels();case 3:return l.abrupt("return",l.sent);case 4:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E,A,T,L,F;return be().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=this.getShaders(),A=E.frag,T=E.vert,L=E.type,H.next=4,this.layer.buildLayerModel({moduleName:L,vertexShader:T,fragmentShader:A,triangulation:O1,stencil:Hi(p,x)});case 4:return F=H.sent,H.abrupt("return",[F]);case 6:case"end":return H.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.pickLight,u=r.mapTexture;return u?{frag:x4,vert:b4,type:"polygonExtrudeTexture"}:o?{frag:E4,vert:S4,type:"polygonExtrudePickLight"}:{frag:y4,vert:_4,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var r,o;(r=this.dataTexture)===null||r===void 0||r.destroy(),(o=this.texture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,o=(0,$n.Z)(r,4),u=o[0],l=o[1],p=o[2],v=o[3],x=p-u,E=v-l;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Nn.Attribute,descriptor:{name:"a_uvs",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(T,L,F){var z=F[0],H=F[1];return[(z-u)/x,(H-l)/E,F[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Nn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(T,L,F,z,H){return H}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Nn.Attribute,descriptor:{name:"a_Size",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(T){var L=T.size,F=L===void 0?10:L;return Array.isArray(F)?[F[0]]:[F]}}})}},{key:"loadTexture",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.mapTexture,l=this.rendererService.createTexture2D;if(this.texture=l({height:0,width:0}),u){var p=new Image;p.crossOrigin="",p.src=u,p.onload=function(){r.texture=l({data:p,width:p.width,height:p.height,wrapS:$.CLAMP_TO_EDGE,wrapT:$.CLAMP_TO_EDGE,min:$.LINEAR,mag:$.LINEAR}),r.layerService.reRender()}}}}]),t}(oo);function C4(e){var i=A4();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function A4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var T4=`uniform float u_opacity: 1.0;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,M4=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,k4=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,I4=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,P4=function(e){(0,Dr.Z)(t,e);var i=C4(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.raisingHeight,u=o===void 0?0:o,l=r.opacity,p=l===void 0?1:l,v=r.opacityLinear,x=v===void 0?{enable:!1,dir:"in"}:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var E=this.layer.getEncodedData(),A=this.calDataFrame(this.cellLength,E,this.cellProperties),T=A.data,L=A.width,F=A.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:$.LUMINANCE,type:$.FLOAT,width:L,height:F}):this.createTexture2D({flipY:!0,data:[1],format:$.LUMINANCE,type:$.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(u),u_opacity:(0,ur.isNumber)(p)?p:1,u_opacitylinear:Number(x.enable),u_dir:x.dir==="in"?1:0}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E,A,T,L,F,z,H,ne,oe;return be().wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return u=this.getModelParams(),l=u.frag,p=u.vert,v=u.triangulation,x=u.type,E=this.layer.getLayerConfig(),A=E.mask,T=A===void 0?!1:A,L=E.maskInside,F=L===void 0?!0:L,z=E.workerEnabled,H=z===void 0?!1:z,ne=E.enablePicking,this.layer.triangulation=v,De.next=5,this.layer.buildLayerModel({moduleName:x,vertexShader:p,fragmentShader:l,triangulation:v,primitive:$.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Hi(T,F),workerEnabled:H,workerOptions:{modelType:x,enablePicking:ne}});case 5:return oe=De.sent,De.abrupt("return",[oe]);case 7:case"end":return De.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getLayerConfig(),o=r.opacityLinear,u=o===void 0?{enable:!1,dir:"in"}:o;u.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Nn.Attribute,descriptor:{name:"a_linear",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:3,update:function(p,v,x){return[x[3],x[4],x[5]]}}})}},{key:"getModelParams",value:function(){var r=this.layer.getLayerConfig(),o=r.opacityLinear,u=o===void 0?{enable:!1}:o;return u.enable?{frag:M4,vert:k4,type:"polygonLinear",triangulation:n3}:{frag:T4,vert:I4,type:"polygonFill",triangulation:rf}}}]),t}(oo);function R4(e){var i=L4();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function L4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var O4=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = u_opacity;
  gl_FragColor = vec4(col, opacity);  
}
`,F4=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,D4=function(e){(0,Dr.Z)(t,e);var i=R4(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.watercolor,p=l===void 0?"#6D99A8":l,v=r.watercolor2,x=v===void 0?"#0F121C":v;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:En(p),u_watercolor2:En(x),u_opacity:(0,ur.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.next=3,this.buildModels();case 3:return l.abrupt("return",l.sent);case 4:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E;return be().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:F4,fragmentShader:O4,triangulation:Hm,primitive:$.TRIANGLES,depth:{enable:!1},stencil:Hi(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o,u;(r=this.texture1)===null||r===void 0||r.destroy(),(o=this.texture2)===null||o===void 0||o.destroy(),(u=this.texture3)===null||u===void 0||u.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,o=(0,$n.Z)(r,4),u=o[0],l=o[1],p=o[2],v=o[3],x=p-u,E=v-l;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Nn.Attribute,descriptor:{name:"a_uv",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(T,L,F,z){var H=T.version===il["GAODE2.x"]?T.originCoordinates[0][z]:F,ne=(0,$n.Z)(H,2),oe=ne[0],ke=ne[1];return[(oe-u)/x,(ke-l)/E]}}})}},{key:"loadTexture",value:function(){var r=this,o=this.rendererService.createTexture2D,u={height:0,width:0};this.texture1=o(u),this.texture2=o(u),this.texture3=o(u),l(function(v){r.texture1=p(v[0]),r.texture2=p(v[1]),r.texture3=p(v[2]),r.layerService.reRender()});function l(v){var x=0,E=[],A=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];A.map(function(T){var L=new Image;L.crossOrigin="",L.src=T,E.push(L),L.onload=function(){x++,x===3&&v(E)}})}function p(v){return o({data:v,width:v.width,height:v.height,wrapS:$.MIRRORED_REPEAT,wrapT:$.MIRRORED_REPEAT,min:$.LINEAR,mag:$.LINEAR})}}}]),t}(oo);function B4(e){var i=N4();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function N4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var z4=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = u_opacity;
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,Z4=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;


#pragma include "projection"

void main() {
  v_uv = a_uv;

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,U4=function(e){(0,Dr.Z)(t,e);var i=B4(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.speed,p=l===void 0?.5:l;return{u_texture:this.texture,u_speed:p,u_opacity:(0,ur.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.next=3,this.buildModels();case 3:return l.abrupt("return",l.sent);case 4:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E;return be().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,T.next=3,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:Z4,fragmentShader:z4,triangulation:Hm,primitive:$.TRIANGLES,depth:{enable:!1},stencil:Hi(p,x)});case 3:return E=T.sent,T.abrupt("return",[E]);case 5:case"end":return T.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.texture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,o=(0,$n.Z)(r,4),u=o[0],l=o[1],p=o[2],v=o[3],x=p-u,E=v-l;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Nn.Attribute,descriptor:{name:"a_uv",buffer:{usage:$.STATIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(T,L,F,z){var H=T.version===il["GAODE2.x"]?T.originCoordinates[0][z]:F,ne=(0,$n.Z)(H,2),oe=ne[0],ke=ne[1];return[(oe-u)/x,(ke-l)/E]}}})}},{key:"loadTexture",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.waterTexture,l=this.rendererService.createTexture2D;this.texture=l({height:0,width:0});var p=new Image;p.crossOrigin="",u?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),p.src=u):p.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",p.onload=function(){r.texture=l({data:p,width:p.width,height:p.height,wrapS:$.MIRRORED_REPEAT,wrapT:$.MIRRORED_REPEAT,min:$.LINEAR,mag:$.LINEAR}),r.layerService.reRender()}}}]),t}(oo),V4={fill:P4,line:G1,extrude:w4,text:lx,point_fill:$1,point_image:Y1,point_normal:K1,point_extrude:W1,water:U4,ocean:D4},j4=V4;function G4(e){var i=H4();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function H4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ym=function(e){(0,Dr.Z)(t,e);var i=G4(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"type","PolygonLayer"),n}return(0,zt.Z)(t,[{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u;return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new j4[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getModelType",value:function(){var r,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(r=o.scale)===null||r===void 0?void 0:r.field;return u==="fill"?"fill":u==="extrude"?"extrude":u==="water"?"water":u==="ocean"?"ocean":u==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var r=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,l=o.shape3d,p=this.iconService.getIconMap(),v=r.find(function(E){return E.hasOwnProperty("shape")});if(v){var x=v.shape;return x==="dot"?"point_normal":(u==null?void 0:u.indexOf(x))!==-1?"point_fill":(l==null?void 0:l.indexOf(x))!==-1?"point_extrude":p.hasOwnProperty(x)?"point_image":"text"}else return"fill"}}]),t}(qh);function W4(e){var i=X4();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function X4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $4=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;
bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }


void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value))
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
   
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,Y4=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,fx=function(e){(0,Dr.Z)(t,e);var i=W4(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.clampLow,p=l===void 0?!0:l,v=r.clampHigh,x=v===void 0?!0:v,E=r.noDataValue,A=E===void 0?-9999999:E,T=r.domain,L=r.rampColors,F=T||Fo(L);return this.colorTexture=this.layer.textureService.getColorTexture(L,F),{u_opacity:u||1,u_texture:this.texture,u_domain:F,u_clampLow:p,u_clampHigh:typeof x!="undefined"?x:p,u_noDataValue:A,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:function(){var n=(0,Wt.Z)(be().mark(function o(u){var l,p,v,x;return be().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(!Array.isArray(u.data)){A.next=4;break}return A.abrupt("return",{data:u.data,width:u.width,height:u.height});case 4:return A.next=6,u.data;case 6:return l=A.sent,p=l.rasterData,v=l.width,x=l.height,A.abrupt("return",{data:Array.from(p),width:v,height:x});case 11:case"end":return A.stop()}},o)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E,A,T,L,F,z,H,ne;return be().wrap(function(ke){for(;;)switch(ke.prev=ke.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=this.layer.getSource(),A=this.rendererService.createTexture2D,T=E.data.dataArray[0],ke.next=6,this.getRasterData(T);case 6:return L=ke.sent,F=L.data,z=L.width,H=L.height,this.texture=A({data:F,width:z,height:H,format:$.LUMINANCE,type:$.FLOAT}),ke.next=13,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:Y4,fragmentShader:$4,triangulation:g0,primitive:$.TRIANGLES,depth:{enable:!1},stencil:Hi(p,x)});case 13:return ne=ke.sent,ke.abrupt("return",[ne]);case 15:case"end":return ke.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.initModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),t}(oo),q4=["data"],K4=["rasterData"];function Q4(e){var i=J4();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function J4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eM=`precision mediump float;
uniform vec2 u_rminmax: vec2(0,255); 
uniform vec2 u_gminmax: vec2(0,255);
uniform vec2 u_bminmax: vec2(0,255);
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform float u_noDataValue : 0.0;
varying vec2 v_texCoord;

void main() {
  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;
  if(rgb == vec3(u_noDataValue)) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
    gl_FragColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }
 
}`,tM=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,rM=function(e){(0,Dr.Z)(t,e);var i=Q4(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"dataOption",{}),n}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,l=r.noDataValue,p=l===void 0?0:l,v=this.dataOption,x=v.rMinMax,E=v.gMinMax,A=v.bMinMax;return{u_opacity:u||1,u_texture:this.texture,u_noDataValue:p,u_rminmax:x,u_gminmax:E,u_bminmax:A}}},{key:"getRasterData",value:function(){var n=(0,Wt.Z)(be().mark(function o(u){var l,p,v,x,E;return be().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(!Array.isArray(u.data)){T.next=4;break}return l=u.data,p=(0,C.Z)(u,q4),this.dataOption=p,T.abrupt("return",(0,mt.Z)({data:l},p));case 4:return T.next=6,u.data;case 6:if(v=T.sent,x=v.rasterData,E=(0,C.Z)(v,K4),this.dataOption=E,!Array.isArray(x)){T.next=14;break}return T.abrupt("return",(0,mt.Z)({data:x},E));case 14:return T.abrupt("return",(0,mt.Z)({data:Array.from(x)},E));case 15:case"end":return T.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E,A,T,L,F,z,H,ne;return be().wrap(function(ke){for(;;)switch(ke.prev=ke.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=this.layer.getSource(),A=this.rendererService.createTexture2D,T=E.data.dataArray[0],ke.next=6,this.getRasterData(T);case 6:return L=ke.sent,F=L.data,z=L.width,H=L.height,this.texture=A({data:F,width:z,height:H,format:$.RGB,type:$.FLOAT}),ke.next=13,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:tM,fragmentShader:eM,triangulation:g0,primitive:$.TRIANGLES,depth:{enable:!1},stencil:Hi(p,x)});case 13:return ne=ke.sent,ke.abrupt("return",[ne]);case 15:case"end":return ke.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.initModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.texture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),t}(oo);function nM(e){var i=iM();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function iM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aM=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;

void main() {
  vec4 baseColor = texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y)) * 256.0;
  float r = baseColor.r * 256.0 * 256.0;
  float g = baseColor.g * 256.0;
  float b = baseColor.b;
  float value =  (r + g + b) * 0.1 - 10000.0;
  
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
     gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture2D(u_colorTexture, vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,oM=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,sM=function(e){(0,Dr.Z)(t,e);var i=nM(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.clampLow,l=u===void 0?!0:u,p=r.clampHigh,v=p===void 0?!0:p,x=r.noDataValue,E=x===void 0?-9999999:x,A=r.domain,T=r.rampColors,L=r.colorTexture,F=A||Fo(T),z=L;return L?this.layer.textureService.setColorTexture(L,T,F):z=this.layer.textureService.getColorTexture(T,F),{u_opacity:o||1,u_texture:this.texture,u_domain:F,u_clampLow:l,u_clampHigh:typeof v!="undefined"?v:l,u_noDataValue:E,u_colorTexture:z}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E,A,T,L;return be().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return u=this.layer.getLayerConfig(),l=u.mask,p=l===void 0?!1:l,v=u.maskInside,x=v===void 0?!0:v,E=this.layer.getSource(),A=this.rendererService.createTexture2D,z.next=5,E.data.images;case 5:return T=z.sent,this.texture=A({data:T[0],width:T[0].width,height:T[0].height}),z.next=9,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:oM,fragmentShader:aM,triangulation:g0,primitive:$.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Hi(p,x)});case 9:return L=z.sent,z.abrupt("return",[L]);case 11:case"end":return z.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.texture)===null||r===void 0||r.destroy()}},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.initModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:2,update:function(o,u,l){return[l[3],l[4]]}}})}}]),t}(oo),uM={raster:fx,rasterRgb:rM,raster3d:fx,rasterTerrainRgb:sM},lM=uM;function cM(e){var i=fM();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function fM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var b0=function(e){(0,Dr.Z)(t,e);var i=cM(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"type","RasterLayer"),n}return(0,zt.Z)(t,[{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u;return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new lM[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}};return o[r]}},{key:"getModelType",value:function(){var r=this.layerSource.getParserType();switch(r){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]),t}(qh);function hM(e){var i=pM();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function pM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dM=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,vM=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,mM=function(e){(0,Dr.Z)(t,e);var i=hM(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?0:o,l=r.color,p=l===void 0?"#000":l;return{u_opacity:(0,ur.isNumber)(u)?u:0,u_color:En(p)}}},{key:"initModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u;return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.layer.buildLayerModel({moduleName:"mask",vertexShader:vM,fragmentShader:dM,triangulation:Hm,depth:{enable:!1},blend:this.getBlend(),stencil:{enable:!0,mask:255,func:{cmp:$.ALWAYS,ref:1,mask:255},opFront:{fail:$.REPLACE,zfail:$.REPLACE,zpass:$.REPLACE}},pick:!1});case 2:return u=p.sent,p.abrupt("return",[u]);case 4:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;r&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),t}(oo),gM={fill:mM},yM=gM;function _M(e){var i=xM();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function xM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qm=function(e){(0,Dr.Z)(t,e);var i=_M(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"type","MaskLayer"),n}return(0,zt.Z)(t,[{key:"buildModels",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u;return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=this.getModelType(),this.layerModel=new yM[u](this),p.next=4,this.initLayerModels();case 4:case"end":return p.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getModelType",value:function(){return"fill"}}]),t}(qh),hx,px,dx,vx,E0,mx,gx,bM=(hx=(0,B.b2)(),px=(0,B.f3)(V.IMapService),dx=(0,B.f3)(V.IFontService),hx(vx=(E0=function(){function e(){(0,wt.Z)(this,e),ia(this,"mapService",mx,this),ia(this,"fontService",gx,this)}return(0,zt.Z)(e,[{key:"apply",value:function(t,n){var r=this,o=n.styleAttributeService;t.hooks.init.tapPromise("DataMappingPlugin",(0,Wt.Z)(be().mark(function u(){return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:r.generateMaping(t,{styleAttributeService:o});case 1:case"end":return p.stop()}},u)}))),t.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var u=(0,Wt.Z)(be().mark(function l(p){return be().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(p){x.next=2;break}return x.abrupt("return",p);case 2:return t.dataState.dataMappingNeedUpdate=!1,x.abrupt("return",r.generateMaping(t,{styleAttributeService:o}));case 4:case"end":return x.stop()}},l)}));return function(l){return u.apply(this,arguments)}}()),t.hooks.beforeRender.tap("DataMappingPlugin",function(){var u=t.getSource();if(!(t.layerModelNeedUpdate||!u||!u.inited)){var l=o.getLayerStyleAttributes()||[],p=o.getLayerStyleAttribute("filter"),v=u.data.dataArray;if(!(Array.isArray(v)&&v.length===0)){var x=l.filter(function(T){return T.needRemapping}),E=v;if(p!=null&&p.needRemapping&&p!==null&&p!==void 0&&p.scale&&(E=v.filter(function(T){return r.applyAttributeMapping(p,T)[0]})),x.length){var A=r.mapping(t,x,E,t.getEncodedData());t.setEncodedData(A)}}}})}},{key:"generateMaping",value:function(t,n){var r=this,o=n.styleAttributeService,u=o.getLayerStyleAttributes()||[],l=o.getLayerStyleAttribute("filter"),p=t.getSource().data.dataArray,v=p;l!=null&&l.scale&&(v=p.filter(function(E){return r.applyAttributeMapping(l,E)[0]})),v=t.processData(v);var x=this.mapping(t,u,v,void 0);return t.setEncodedData(x),p.length===0&&t.encodeDataLength===0?!1:(t.emit("dataUpdate",null),!0)}},{key:"mapping",value:function(t,n,r,o){var u=this,l=t.getLayerConfig(),p=l.arrow,v=p===void 0?{enable:!1}:p,x=n.filter(function(A){return A.scale!==void 0}).filter(function(A){return A.name!=="filter"}),E=r.map(function(A,T){var L=o?o[T]:{},F=(0,mt.Z)({id:A._id,coordinates:A.coordinates},L);if(x.forEach(function(ne){var oe=u.applyAttributeMapping(ne,A);ne.name==="color"&&(oe=oe.map(function(ke){return En(ke)})),F[ne.name]=Array.isArray(oe)&&oe.length===1?oe[0]:oe,ne.name==="shape"&&(F.shape=u.fontService.getIconFontKey(F[ne.name]))}),v.enable&&(F.shape==="line"||F.shape==="halfLine")){var z=F.coordinates;if(t.arrowInsertCount<t.encodeDataLength){var H=u.getArrowPoints(z[0],z[1]);F.coordinates.splice(1,0,H,H),t.arrowInsertCount++}}return F});return n.forEach(function(A){A.needRemapping=!1}),this.adjustData2Amap2Coordinates(E,t),this.adjustData2SimpleCoordinates(E),E}},{key:"adjustData2Amap2Coordinates",value:function(t,n){var r=this;if(t.length>0&&this.mapService.version===il["GAODE2.x"]){var o=n.coordCenter||n.getSource().center;typeof t[0].coordinates[0]=="number"?t.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=il["GAODE2.x"],u.originCoordinates=(0,ur.cloneDeep)(u.coordinates),u.coordinates=r.mapService.lngLatToCoordByLayer(u.coordinates,o)}):t.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=il["GAODE2.x"],u.originCoordinates=(0,ur.cloneDeep)(u.coordinates),u.coordinates=r.mapService.lngLatToCoordsByLayer(u.coordinates,o)})}}},{key:"adjustData2SimpleCoordinates",value:function(t){var n=this;t.length>0&&this.mapService.version===il.SIMPLE&&t.map(function(r){r.simpleCoordinate||(r.coordinates=n.unProjectCoordinates(r.coordinates),r.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(t){var n=this;if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var r=[];return t.map(function(u){var l=[];u.map(function(p){l.push(n.mapService.simpleMapCoord.unproject(p))}),r.push(l)}),r}else{var o=[];return t.map(function(u){o.push(n.mapService.simpleMapCoord.unproject(u))}),o}}},{key:"applyAttributeMapping",value:function(t,n){var r;if(!t.scale)return[];var o=(t==null||(r=t.scale)===null||r===void 0?void 0:r.scalers)||[],u=[];o.forEach(function(p){var v,x=p.field;(n.hasOwnProperty(x)||((v=t.scale)===null||v===void 0?void 0:v.type)==="variable")&&u.push(n[x])});var l=t.mapping?t.mapping(u):[];return l}},{key:"getArrowPoints",value:function(t,n){var r=[n[0]-t[0],n[1]-t[1]],o=yt(r),u=[t[0]+o[0]*1e-4,t[1]+o[1]*1e-4];return u}}]),e}(),mx=Qi(E0.prototype,"mapService",[px],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gx=Qi(E0.prototype,"fontService",[dx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E0))||vx),yx,_x,EM=(yx=(0,B.b2)(),yx(_x=function(){function e(){(0,wt.Z)(this,e)}return(0,zt.Z)(e,[{key:"apply",value:function(t){var n=this;this.mapService=t.getContainer().get(V.IMapService),t.hooks.init.tapPromise("DataSourcePlugin",(0,Wt.Z)(be().mark(function r(){var o,u,l,p;return be().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(o=t.getSource(),o||(u=t.sourceOption||t.defaultSourceConfig,l=u.data,p=u.options,o=new Fm(l,p),t.setSource(o)),!o.inited){x.next=6;break}n.updateClusterData(t),x.next=8;break;case 6:return x.next=8,new Promise(function(E){o.on("update",function(A){A.type==="inited"&&n.updateClusterData(t),E(null)})});case 8:case"end":return x.stop()}},r)}))),t.hooks.beforeRenderData.tapPromise("DataSourcePlugin",(0,Wt.Z)(be().mark(function r(){var o,u;return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return o=n.updateClusterData(t),u=t.dataState.dataSourceNeedUpdate,t.dataState.dataSourceNeedUpdate=!1,p.abrupt("return",o||u);case 4:case"end":return p.stop()}},r)})))}},{key:"updateClusterData",value:function(t){if(t.isTileLayer||t.tileLayer||!t.getSource())return!1;var n=t.getSource(),r=n.cluster,o=n.clusterOptions.zoom,u=o===void 0?0:o,l=this.mapService.getZoom()-1,p=t.dataState.dataSourceNeedUpdate;return r&&p&&n.updateClusterData(Math.floor(l)),r&&Math.abs(t.clusterZoom-l)>=1?(u!==Math.floor(l)&&n.updateClusterData(Math.floor(l)),t.clusterZoom=l,!0):!1}}]),e}())||_x);function Km(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function xx(e){return e.length===1&&(e=SM(e)),{left:function(i,t,n,r){for(n==null&&(n=0),r==null&&(r=i.length);n<r;){var o=n+r>>>1;e(i[o],t)<0?n=o+1:r=o}return n},right:function(i,t,n,r){for(n==null&&(n=0),r==null&&(r=i.length);n<r;){var o=n+r>>>1;e(i[o],t)>0?r=o:n=o+1}return n}}}function SM(e){return function(i,t){return Km(e(i),t)}}var bx=xx(Km),wM=bx.right,eR=bx.left,S0=wM;function Ex(e,i){var t=e.length,n=-1,r,o,u;if(i==null){for(;++n<t;)if((r=e[n])!=null&&r>=r)for(o=u=r;++n<t;)(r=e[n])!=null&&(o>r&&(o=r),u<r&&(u=r))}else for(;++n<t;)if((r=i(e[n],n,e))!=null&&r>=r)for(o=u=r;++n<t;)(r=i(e[n],n,e))!=null&&(o>r&&(o=r),u<r&&(u=r));return[o,u]}var Sx=Array.prototype,tR=Sx.slice,rR=Sx.map,Qm=Math.sqrt(50),Jm=Math.sqrt(10),eg=Math.sqrt(2);function Cx(e,i,t){var n,r=-1,o,u,l;if(i=+i,e=+e,t=+t,e===i&&t>0)return[e];if((n=i<e)&&(o=e,e=i,i=o),(l=w0(e,i,t))===0||!isFinite(l))return[];if(l>0)for(e=Math.ceil(e/l),i=Math.floor(i/l),u=new Array(o=Math.ceil(i-e+1));++r<o;)u[r]=(e+r)*l;else for(e=Math.floor(e*l),i=Math.ceil(i*l),u=new Array(o=Math.ceil(e-i+1));++r<o;)u[r]=(e-r)/l;return n&&u.reverse(),u}function w0(e,i,t){var n=(i-e)/Math.max(0,t),r=Math.floor(Math.log(n)/Math.LN10),o=n/Math.pow(10,r);return r>=0?(o>=Qm?10:o>=Jm?5:o>=eg?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(o>=Qm?10:o>=Jm?5:o>=eg?2:1)}function tg(e,i,t){var n=Math.abs(i-e)/Math.max(0,t),r=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),o=n/r;return o>=Qm?r*=10:o>=Jm?r*=5:o>=eg&&(r*=2),i<e?-r:r}function nR(){var e=identity,i=extent,t=sturges;function n(r){var o,u=r.length,l,p=new Array(u);for(o=0;o<u;++o)p[o]=e(r[o],o,r);var v=i(p),x=v[0],E=v[1],A=t(p,x,E);Array.isArray(A)||(A=tickStep(x,E,A),A=range(Math.ceil(x/A)*A,E,A));for(var T=A.length;A[0]<=x;)A.shift(),--T;for(;A[T-1]>E;)A.pop(),--T;var L=new Array(T+1),F;for(o=0;o<=T;++o)F=L[o]=[],F.x0=o>0?A[o-1]:x,F.x1=o<T?A[o]:E;for(o=0;o<u;++o)l=p[o],x<=l&&l<=E&&L[bisect(A,l,0,T)].push(r[o]);return L}return n.value=function(r){return arguments.length?(e=typeof r=="function"?r:constant(r),n):e},n.domain=function(r){return arguments.length?(i=typeof r=="function"?r:constant([r[0],r[1]]),n):i},n.thresholds=function(r){return arguments.length?(t=typeof r=="function"?r:Array.isArray(r)?constant(slice.call(r)):constant(r),n):t},n}function iR(e,i,t){return e=map.call(e,number).sort(ascending),Math.ceil((t-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function CM(e){return e===null?NaN:+e}function AM(e,i,t){if(t==null&&(t=CM),!!(n=e.length)){if((i=+i)<=0||n<2)return+t(e[0],0,e);if(i>=1)return+t(e[n-1],n-1,e);var n,r=(n-1)*i,o=Math.floor(r),u=+t(e[o],o,e),l=+t(e[o+1],o+1,e);return u+(l-u)*(r-o)}}var TM=ee(87765),Fc="$";function C0(){}C0.prototype=Ax.prototype={constructor:C0,has:function(e){return Fc+e in this},get:function(e){return this[Fc+e]},set:function(e,i){return this[Fc+e]=i,this},remove:function(e){var i=Fc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===Fc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===Fc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===Fc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===Fc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===Fc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Fc)return!1;return!0},each:function(e){for(var i in this)i[0]===Fc&&e(this[i],i.slice(1),this)}};function Ax(e,i){var t=new C0;if(e instanceof C0)e.each(function(l,p){t.set(p,l)});else if(Array.isArray(e)){var n=-1,r=e.length,o;if(i==null)for(;++n<r;)t.set(n,e[n]);else for(;++n<r;)t.set(i(o=e[n],n,e),o)}else if(e)for(var u in e)t.set(u,e[u]);return t}var rg=Ax;function aR(){var e=[],i=[],t,n,r;function o(l,p,v,x){if(p>=e.length)return t!=null&&l.sort(t),n!=null?n(l):l;for(var E=-1,A=l.length,T=e[p++],L,F,z=map(),H,ne=v();++E<A;)(H=z.get(L=T(F=l[E])+""))?H.push(F):z.set(L,[F]);return z.each(function(oe,ke){x(ne,ke,o(oe,p,v,x))}),ne}function u(l,p){if(++p>e.length)return l;var v,x=i[p-1];return n!=null&&p>=e.length?v=l.entries():(v=[],l.each(function(E,A){v.push({key:A,values:u(E,p)})})),x!=null?v.sort(function(E,A){return x(E.key,A.key)}):v}return r={object:function(l){return o(l,0,MM,kM)},map:function(l){return o(l,0,Tx,Mx)},entries:function(l){return u(o(l,0,Tx,Mx),0)},key:function(l){return e.push(l),r},sortKeys:function(l){return i[e.length-1]=l,r},sortValues:function(l){return t=l,r},rollup:function(l){return n=l,r}}}function MM(){return{}}function kM(e,i,t){e[i]=t}function Tx(){return map()}function Mx(e,i,t){e.set(i,t)}function A0(){}var Bp=rg.prototype;A0.prototype=IM.prototype={constructor:A0,has:Bp.has,add:function(e){return e+="",this[Fc+e]=e,this},remove:Bp.remove,clear:Bp.clear,values:Bp.keys,size:Bp.size,empty:Bp.empty,each:Bp.each};function IM(e,i){var t=new A0;if(e instanceof A0)e.each(function(o){t.add(o)});else if(e){var n=-1,r=e.length;if(i==null)for(;++n<r;)t.add(e[n]);else for(;++n<r;)t.add(i(e[n],n,e))}return t}var oR=null,kx=Array.prototype,Ix=kx.map,Np=kx.slice;function Jh(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function Px(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var Rx={name:"implicit"};function T0(){var e=rg(),i=[],t=[],n=Rx;function r(o){var u=o+"",l=e.get(u);if(!l){if(n!==Rx)return n;e.set(u,l=i.push(o))}return t[(l-1)%t.length]}return r.domain=function(o){if(!arguments.length)return i.slice();i=[],e=rg();for(var u=-1,l=o.length,p,v;++u<l;)e.has(v=(p=o[u])+"")||e.set(v,i.push(p));return r},r.range=function(o){return arguments.length?(t=Np.call(o),r):t.slice()},r.unknown=function(o){return arguments.length?(n=o,r):n},r.copy=function(){return T0(i,t).unknown(n)},Jh.apply(r,arguments),r}function Lx(){var e=ordinal().unknown(void 0),i=e.domain,t=e.range,n=[0,1],r,o,u=!1,l=0,p=0,v=.5;delete e.unknown;function x(){var E=i().length,A=n[1]<n[0],T=n[A-0],L=n[1-A];r=(L-T)/Math.max(1,E-l+p*2),u&&(r=Math.floor(r)),T+=(L-T-r*(E-l))*v,o=r*(1-l),u&&(T=Math.round(T),o=Math.round(o));var F=sequence(E).map(function(z){return T+r*z});return t(A?F.reverse():F)}return e.domain=function(E){return arguments.length?(i(E),x()):i()},e.range=function(E){return arguments.length?(n=[+E[0],+E[1]],x()):n.slice()},e.rangeRound=function(E){return n=[+E[0],+E[1]],u=!0,x()},e.bandwidth=function(){return o},e.step=function(){return r},e.round=function(E){return arguments.length?(u=!!E,x()):u},e.padding=function(E){return arguments.length?(l=Math.min(1,p=+E),x()):l},e.paddingInner=function(E){return arguments.length?(l=Math.min(1,E),x()):l},e.paddingOuter=function(E){return arguments.length?(p=+E,x()):p},e.align=function(E){return arguments.length?(v=Math.max(0,Math.min(1,E)),x()):v},e.copy=function(){return Lx(i(),n).round(u).paddingInner(l).paddingOuter(p).align(v)},initRange.apply(x(),arguments)}function Ox(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Ox(i())},e}function sR(){return Ox(Lx.apply(null,arguments).paddingInner(1))}var PM=ee(21775),RM=ee(73626);function LM(e,i){return e=+e,i=+i,function(t){return Math.round(e*(1-t)+i*t)}}function OM(e){return function(){return e}}function FM(e){return+e}var Fx=[0,1];function ju(e){return e}function ng(e,i){return(i-=e=+e)?function(t){return(t-e)/i}:OM(isNaN(i)?NaN:.5)}function Dx(e){var i=e[0],t=e[e.length-1],n;return i>t&&(n=i,i=t,t=n),function(r){return Math.max(i,Math.min(t,r))}}function DM(e,i,t){var n=e[0],r=e[1],o=i[0],u=i[1];return r<n?(n=ng(r,n),o=t(u,o)):(n=ng(n,r),o=t(o,u)),function(l){return o(n(l))}}function BM(e,i,t){var n=Math.min(e.length,i.length)-1,r=new Array(n),o=new Array(n),u=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++u<n;)r[u]=ng(e[u],e[u+1]),o[u]=t(i[u],i[u+1]);return function(l){var p=S0(e,l,1,n)-1;return o[p](r[p](l))}}function M0(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function ig(){var e=Fx,i=Fx,t=PM.Z,n,r,o,u=ju,l,p,v;function x(){return l=Math.min(e.length,i.length)>2?BM:DM,p=v=null,E}function E(A){return isNaN(A=+A)?o:(p||(p=l(e.map(n),i,t)))(n(u(A)))}return E.invert=function(A){return u(r((v||(v=l(i,e.map(n),RM.Z)))(A)))},E.domain=function(A){return arguments.length?(e=Ix.call(A,FM),u===ju||(u=Dx(e)),x()):e.slice()},E.range=function(A){return arguments.length?(i=Np.call(A),x()):i.slice()},E.rangeRound=function(A){return i=Np.call(A),t=LM,x()},E.clamp=function(A){return arguments.length?(u=A?Dx(e):ju,E):u!==ju},E.interpolate=function(A){return arguments.length?(t=A,x()):t},E.unknown=function(A){return arguments.length?(o=A,E):o},function(A,T){return n=A,r=T,x()}}function Bx(e,i){return ig()(e,i)}var NM=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function k0(e){if(!(i=NM.exec(e)))throw new Error("invalid format: "+e);var i;return new ag({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}k0.prototype=ag.prototype;function ag(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}ag.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function zM(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function I0(e,i){if((t=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var t,n=e.slice(0,t);return[n.length>1?n[0]+n.slice(2):n,+e.slice(t+1)]}function _d(e){return e=I0(Math.abs(e)),e?e[1]:NaN}function ZM(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(_d(i)/3)))*3-_d(Math.abs(e)))}function UM(e,i){return function(t,n){for(var r=t.length,o=[],u=0,l=e[0],p=0;r>0&&l>0&&(p+l+1>n&&(l=Math.max(1,n-p)),o.push(t.substring(r-=l,r+l)),!((p+=l+1)>n));)l=e[u=(u+1)%e.length];return o.reverse().join(i)}}function VM(e){return function(i){return i.replace(/[0-9]/g,function(t){return e[+t]})}}function jM(e){e:for(var i=e.length,t=1,n=-1,r;t<i;++t)switch(e[t]){case".":n=r=t;break;case"0":n===0&&(n=t),r=t;break;default:if(!+e[t])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(r+1):e}var Nx;function GM(e,i){var t=I0(e,i);if(!t)return e+"";var n=t[0],r=t[1],o=r-(Nx=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,u=n.length;return o===u?n:o>u?n+new Array(o-u+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+I0(e,Math.max(0,i+o-1))[0]}function zx(e,i){var t=I0(e,i);if(!t)return e+"";var n=t[0],r=t[1];return r<0?"0."+new Array(-r).join("0")+n:n.length>r+1?n.slice(0,r+1)+"."+n.slice(r+1):n+new Array(r-n.length+2).join("0")}var Zx={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:zM,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return zx(e*100,i)},r:zx,s:GM,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Ux(e){return e}var Vx=Array.prototype.map,jx=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function HM(e){var i=e.grouping===void 0||e.thousands===void 0?Ux:UM(Vx.call(e.grouping,Number),e.thousands+""),t=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?Ux:VM(Vx.call(e.numerals,String)),u=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"-":e.minus+"",p=e.nan===void 0?"NaN":e.nan+"";function v(E){E=k0(E);var A=E.fill,T=E.align,L=E.sign,F=E.symbol,z=E.zero,H=E.width,ne=E.comma,oe=E.precision,ke=E.trim,De=E.type;De==="n"?(ne=!0,De="g"):Zx[De]||(oe===void 0&&(oe=12),ke=!0,De="g"),(z||A==="0"&&T==="=")&&(z=!0,A="0",T="=");var ft=F==="$"?t:F==="#"&&/[boxX]/.test(De)?"0"+De.toLowerCase():"",At=F==="$"?n:/[%p]/.test(De)?u:"",Nt=Zx[De],Gt=/[defgprs%]/.test(De);oe=oe===void 0?6:/[gprs]/.test(De)?Math.max(1,Math.min(21,oe)):Math.max(0,Math.min(20,oe));function xr(dr){var zr=ft,bn=At,Wn,oa,Ma;if(De==="c")bn=Nt(dr)+bn,dr="";else{dr=+dr;var Co=dr<0||1/dr<0;if(dr=isNaN(dr)?p:Nt(Math.abs(dr),oe),ke&&(dr=jM(dr)),Co&&+dr==0&&L!=="+"&&(Co=!1),zr=(Co?L==="("?L:l:L==="-"||L==="("?"":L)+zr,bn=(De==="s"?jx[8+Nx/3]:"")+bn+(Co&&L==="("?")":""),Gt){for(Wn=-1,oa=dr.length;++Wn<oa;)if(Ma=dr.charCodeAt(Wn),48>Ma||Ma>57){bn=(Ma===46?r+dr.slice(Wn+1):dr.slice(Wn))+bn,dr=dr.slice(0,Wn);break}}}ne&&!z&&(dr=i(dr,Infinity));var ko=zr.length+dr.length+bn.length,es=ko<H?new Array(H-ko+1).join(A):"";switch(ne&&z&&(dr=i(es+dr,es.length?H-bn.length:Infinity),es=""),T){case"<":dr=zr+dr+bn+es;break;case"=":dr=zr+es+dr+bn;break;case"^":dr=es.slice(0,ko=es.length>>1)+zr+dr+bn+es.slice(ko);break;default:dr=es+zr+dr+bn;break}return o(dr)}return xr.toString=function(){return E+""},xr}function x(E,A){var T=v((E=k0(E),E.type="f",E)),L=Math.max(-8,Math.min(8,Math.floor(_d(A)/3)))*3,F=Math.pow(10,-L),z=jx[8+L/3];return function(H){return T(F*H)+z}}return{format:v,formatPrefix:x}}var P0,og,Gx;WM({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function WM(e){return P0=HM(e),og=P0.format,Gx=P0.formatPrefix,P0}function XM(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,_d(i)-_d(e))+1}function $M(e){return Math.max(0,-_d(Math.abs(e)))}function YM(e,i,t,n){var r=tg(e,i,t),o;switch(n=k0(n==null?",f":n),n.type){case"s":{var u=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(o=ZM(r,u))&&(n.precision=o),Gx(n,u)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=XM(r,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=$M(r))&&(n.precision=o-(n.type==="%")*2);break}}return og(n)}function hv(e){var i=e.domain;return e.ticks=function(t){var n=i();return Cx(n[0],n[n.length-1],t==null?10:t)},e.tickFormat=function(t,n){var r=i();return YM(r[0],r[r.length-1],t==null?10:t,n)},e.nice=function(t){t==null&&(t=10);var n=i(),r=0,o=n.length-1,u=n[r],l=n[o],p;return l<u&&(p=u,u=l,l=p,p=r,r=o,o=p),p=w0(u,l,t),p>0?(u=Math.floor(u/p)*p,l=Math.ceil(l/p)*p,p=w0(u,l,t)):p<0&&(u=Math.ceil(u*p)/p,l=Math.floor(l*p)/p,p=w0(u,l,t)),p>0?(n[r]=Math.floor(u/p)*p,n[o]=Math.ceil(l/p)*p,i(n)):p<0&&(n[r]=Math.ceil(u*p)/p,n[o]=Math.floor(l*p)/p,i(n)),e},e}function Hx(){var e=Bx(ju,ju);return e.copy=function(){return M0(e,Hx())},Jh.apply(e,arguments),hv(e)}function qM(e){var i;function t(n){return isNaN(n=+n)?i:n}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=map.call(n,number),t):e.slice()},t.unknown=function(n){return arguments.length?(i=n,t):i},t.copy=function(){return qM(e).unknown(i)},e=arguments.length?map.call(e,number):[0,1],linearish(t)}function Wx(e,i){e=e.slice();var t=0,n=e.length-1,r=e[t],o=e[n],u;return o<r&&(u=t,t=n,n=u,u=r,r=o,o=u),e[t]=i.floor(r),e[n]=i.ceil(o),e}function Xx(e){return Math.log(e)}function $x(e){return Math.exp(e)}function KM(e){return-Math.log(-e)}function QM(e){return-Math.exp(-e)}function JM(e){return isFinite(e)?+("1e"+e):e<0?0:e}function e6(e){return e===10?JM:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function t6(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function Yx(e){return function(i){return-e(-i)}}function r6(e){var i=e(Xx,$x),t=i.domain,n=10,r,o;function u(){return r=t6(n),o=e6(n),t()[0]<0?(r=Yx(r),o=Yx(o),e(KM,QM)):e(Xx,$x),i}return i.base=function(l){return arguments.length?(n=+l,u()):n},i.domain=function(l){return arguments.length?(t(l),u()):t()},i.ticks=function(l){var p=t(),v=p[0],x=p[p.length-1],E;(E=x<v)&&(A=v,v=x,x=A);var A=r(v),T=r(x),L,F,z,H=l==null?10:+l,ne=[];if(!(n%1)&&T-A<H){if(A=Math.round(A)-1,T=Math.round(T)+1,v>0){for(;A<T;++A)for(F=1,L=o(A);F<n;++F)if(z=L*F,!(z<v)){if(z>x)break;ne.push(z)}}else for(;A<T;++A)for(F=n-1,L=o(A);F>=1;--F)if(z=L*F,!(z<v)){if(z>x)break;ne.push(z)}}else ne=Cx(A,T,Math.min(T-A,H)).map(o);return E?ne.reverse():ne},i.tickFormat=function(l,p){if(p==null&&(p=n===10?".0e":","),typeof p!="function"&&(p=og(p)),l===Infinity)return p;l==null&&(l=10);var v=Math.max(1,n*l/i.ticks().length);return function(x){var E=x/o(Math.round(r(x)));return E*n<n-.5&&(E*=n),E<=v?p(x):""}},i.nice=function(){return t(Wx(t(),{floor:function(l){return o(Math.floor(r(l)))},ceil:function(l){return o(Math.ceil(r(l)))}}))},i}function qx(){var e=r6(ig()).domain([1,10]);return e.copy=function(){return M0(e,qx()).base(e.base())},Jh.apply(e,arguments),e}function Kx(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function Qx(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function n6(e){var i=1,t=e(Kx(i),Qx(i));return t.constant=function(n){return arguments.length?e(Kx(i=+n),Qx(i)):i},linearish(t)}function i6(){var e=n6(transformer());return e.copy=function(){return copy(e,i6()).constant(e.constant())},initRange.apply(e,arguments)}function Jx(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function a6(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function o6(e){return e<0?-e*e:e*e}function s6(e){var i=e(ju,ju),t=1;function n(){return t===1?e(ju,ju):t===.5?e(a6,o6):e(Jx(t),Jx(1/t))}return i.exponent=function(r){return arguments.length?(t=+r,n()):t},hv(i)}function sg(){var e=s6(ig());return e.copy=function(){return M0(e,sg()).exponent(e.exponent())},Jh.apply(e,arguments),e}function uR(){return sg.apply(null,arguments).exponent(.5)}function eb(){var e=[],i=[],t=[],n;function r(){var u=0,l=Math.max(1,i.length);for(t=new Array(l-1);++u<l;)t[u-1]=AM(e,u/l);return o}function o(u){return isNaN(u=+u)?n:i[S0(t,u)]}return o.invertExtent=function(u){var l=i.indexOf(u);return l<0?[NaN,NaN]:[l>0?t[l-1]:e[0],l<t.length?t[l]:e[e.length-1]]},o.domain=function(u){if(!arguments.length)return e.slice();e=[];for(var l=0,p=u.length,v;l<p;++l)v=u[l],v!=null&&!isNaN(v=+v)&&e.push(v);return e.sort(Km),r()},o.range=function(u){return arguments.length?(i=Np.call(u),r()):i.slice()},o.unknown=function(u){return arguments.length?(n=u,o):n},o.quantiles=function(){return t.slice()},o.copy=function(){return eb().domain(e).range(i).unknown(n)},Jh.apply(o,arguments)}function tb(){var e=0,i=1,t=1,n=[.5],r=[0,1],o;function u(p){return p<=p?r[S0(n,p,0,t)]:o}function l(){var p=-1;for(n=new Array(t);++p<t;)n[p]=((p+1)*i-(p-t)*e)/(t+1);return u}return u.domain=function(p){return arguments.length?(e=+p[0],i=+p[1],l()):[e,i]},u.range=function(p){return arguments.length?(t=(r=Np.call(p)).length-1,l()):r.slice()},u.invertExtent=function(p){var v=r.indexOf(p);return v<0?[NaN,NaN]:v<1?[e,n[0]]:v>=t?[n[t-1],i]:[n[v-1],n[v]]},u.unknown=function(p){return arguments.length&&(o=p),u},u.thresholds=function(){return n.slice()},u.copy=function(){return tb().domain([e,i]).range(r).unknown(o)},Jh.apply(hv(u),arguments)}function rb(){var e=[.5],i=[0,1],t,n=1;function r(o){return o<=o?i[S0(e,o,0,n)]:t}return r.domain=function(o){return arguments.length?(e=Np.call(o),n=Math.min(e.length,i.length-1),r):e.slice()},r.range=function(o){return arguments.length?(i=Np.call(o),n=Math.min(e.length,i.length-1),r):i.slice()},r.invertExtent=function(o){var u=i.indexOf(o);return[e[u-1],e[u]]},r.unknown=function(o){return arguments.length?(t=o,r):t},r.copy=function(){return rb().domain(e).range(i).unknown(t)},Jh.apply(r,arguments)}var ug=new Date,lg=new Date;function al(e,i,t,n){function r(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return r.floor=function(o){return e(o=new Date(+o)),o},r.ceil=function(o){return e(o=new Date(o-1)),i(o,1),e(o),o},r.round=function(o){var u=r(o),l=r.ceil(o);return o-u<l-o?u:l},r.offset=function(o,u){return i(o=new Date(+o),u==null?1:Math.floor(u)),o},r.range=function(o,u,l){var p=[],v;if(o=r.ceil(o),l=l==null?1:Math.floor(l),!(o<u)||!(l>0))return p;do p.push(v=new Date(+o)),i(o,l),e(o);while(v<o&&o<u);return p},r.filter=function(o){return al(function(u){if(u>=u)for(;e(u),!o(u);)u.setTime(u-1)},function(u,l){if(u>=u)if(l<0)for(;++l<=0;)for(;i(u,-1),!o(u););else for(;--l>=0;)for(;i(u,1),!o(u););})},t&&(r.count=function(o,u){return ug.setTime(+o),lg.setTime(+u),e(ug),e(lg),Math.floor(t(ug,lg))},r.every=function(o){return o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?r.filter(n?function(u){return n(u)%o==0}:function(u){return r.count(0,u)%o==0}):r}),r}var cg=al(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});cg.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:al(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,t){i.setFullYear(i.getFullYear()+t*e)})};var xd=cg,lR=cg.range,nb=al(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),u6=nb,cR=nb.range,R0=1e3,pv=6e4,ib=36e5,ab=864e5,ob=6048e5;function zp(e){return al(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,t){i.setDate(i.getDate()+t*7)},function(i,t){return(t-i-(t.getTimezoneOffset()-i.getTimezoneOffset())*pv)/ob})}var fg=zp(0),L0=zp(1),l6=zp(2),c6=zp(3),bd=zp(4),f6=zp(5),h6=zp(6),fR=fg.range,hR=L0.range,pR=l6.range,dR=c6.range,vR=bd.range,mR=f6.range,gR=h6.range,sb=al(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*pv)/ab},function(e){return e.getDate()-1}),hg=sb,yR=sb.range,ub=al(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*R0-e.getMinutes()*pv)},function(e,i){e.setTime(+e+i*ib)},function(e,i){return(i-e)/ib},function(e){return e.getHours()}),p6=ub,_R=ub.range,lb=al(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*R0)},function(e,i){e.setTime(+e+i*pv)},function(e,i){return(i-e)/pv},function(e){return e.getMinutes()}),d6=lb,xR=lb.range,cb=al(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*R0)},function(e,i){return(i-e)/R0},function(e){return e.getUTCSeconds()}),v6=cb,bR=cb.range,O0=al(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});O0.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?al(function(i){i.setTime(Math.floor(i/e)*e)},function(i,t){i.setTime(+i+t*e)},function(i,t){return(t-i)/e}):O0};var m6=O0,ER=O0.range;function Zp(e){return al(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,t){i.setUTCDate(i.getUTCDate()+t*7)},function(i,t){return(t-i)/ob})}var fb=Zp(0),F0=Zp(1),g6=Zp(2),y6=Zp(3),Ed=Zp(4),_6=Zp(5),x6=Zp(6),SR=fb.range,wR=F0.range,CR=g6.range,AR=y6.range,TR=Ed.range,MR=_6.range,kR=x6.range,hb=al(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/ab},function(e){return e.getUTCDate()-1}),pb=hb,IR=hb.range,pg=al(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});pg.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:al(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,t){i.setUTCFullYear(i.getUTCFullYear()+t*e)})};var dv=pg,PR=pg.range;function dg(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function vg(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function vv(e,i,t){return{y:e,m:i,d:t,H:0,M:0,S:0,L:0}}function b6(e){var i=e.dateTime,t=e.date,n=e.time,r=e.periods,o=e.days,u=e.shortDays,l=e.months,p=e.shortMonths,v=mv(r),x=gv(r),E=mv(o),A=gv(o),T=mv(u),L=gv(u),F=mv(l),z=gv(l),H=mv(p),ne=gv(p),oe={a:Co,A:ko,b:es,B:Ml,c:null,d:_b,e:_b,f:G6,g:ek,G:rk,H:U6,I:V6,j:j6,L:xb,m:H6,M:W6,p:Bv,q:kd,Q:Ab,s:Tb,S:X6,u:$6,U:Y6,V:q6,w:K6,W:Q6,x:null,X:null,y:J6,Y:tk,Z:nk,"%":Cb},ke={a:Nv,A:$0,b:Ag,B:Y0,c:null,d:Eb,e:Eb,f:sk,g:gk,G:_k,H:ik,I:ak,j:ok,L:Sb,m:uk,M:lk,p:_8,q:x8,Q:Ab,s:Tb,S:ck,u:fk,U:hk,V:pk,w:dk,W:vk,x:null,X:null,y:mk,Y:yk,Z:xk,"%":Cb},De={a:xr,A:dr,b:zr,B:bn,c:Wn,d:gb,e:gb,f:B6,g:mb,G:vb,H:yb,I:yb,j:L6,L:D6,m:R6,M:O6,p:Gt,q:P6,Q:z6,s:Z6,S:F6,u:A6,U:T6,V:M6,w:C6,W:k6,x:oa,X:Ma,y:mb,Y:vb,Z:I6,"%":N6};oe.x=ft(t,oe),oe.X=ft(n,oe),oe.c=ft(i,oe),ke.x=ft(t,ke),ke.X=ft(n,ke),ke.c=ft(i,ke);function ft(wi,Ha){return function(vo){var zn=[],kl=-1,ts=0,lc=wi.length,cc,Hp,yE;for(vo instanceof Date||(vo=new Date(+vo));++kl<lc;)wi.charCodeAt(kl)===37&&(zn.push(wi.slice(ts,kl)),(Hp=db[cc=wi.charAt(++kl)])!=null?cc=wi.charAt(++kl):Hp=cc==="e"?" ":"0",(yE=Ha[cc])&&(cc=yE(vo,Hp)),zn.push(cc),ts=kl+1);return zn.push(wi.slice(ts,kl)),zn.join("")}}function At(wi,Ha){return function(vo){var zn=vv(1900,void 0,1),kl=Nt(zn,wi,vo+="",0),ts,lc;if(kl!=vo.length)return null;if("Q"in zn)return new Date(zn.Q);if("s"in zn)return new Date(zn.s*1e3+("L"in zn?zn.L:0));if(Ha&&!("Z"in zn)&&(zn.Z=0),"p"in zn&&(zn.H=zn.H%12+zn.p*12),zn.m===void 0&&(zn.m="q"in zn?zn.q:0),"V"in zn){if(zn.V<1||zn.V>53)return null;"w"in zn||(zn.w=1),"Z"in zn?(ts=vg(vv(zn.y,0,1)),lc=ts.getUTCDay(),ts=lc>4||lc===0?F0.ceil(ts):F0(ts),ts=pb.offset(ts,(zn.V-1)*7),zn.y=ts.getUTCFullYear(),zn.m=ts.getUTCMonth(),zn.d=ts.getUTCDate()+(zn.w+6)%7):(ts=dg(vv(zn.y,0,1)),lc=ts.getDay(),ts=lc>4||lc===0?L0.ceil(ts):L0(ts),ts=hg.offset(ts,(zn.V-1)*7),zn.y=ts.getFullYear(),zn.m=ts.getMonth(),zn.d=ts.getDate()+(zn.w+6)%7)}else("W"in zn||"U"in zn)&&("w"in zn||(zn.w="u"in zn?zn.u%7:"W"in zn?1:0),lc="Z"in zn?vg(vv(zn.y,0,1)).getUTCDay():dg(vv(zn.y,0,1)).getDay(),zn.m=0,zn.d="W"in zn?(zn.w+6)%7+zn.W*7-(lc+5)%7:zn.w+zn.U*7-(lc+6)%7);return"Z"in zn?(zn.H+=zn.Z/100|0,zn.M+=zn.Z%100,vg(zn)):dg(zn)}}function Nt(wi,Ha,vo,zn){for(var kl=0,ts=Ha.length,lc=vo.length,cc,Hp;kl<ts;){if(zn>=lc)return-1;if(cc=Ha.charCodeAt(kl++),cc===37){if(cc=Ha.charAt(kl++),Hp=De[cc in db?Ha.charAt(kl++):cc],!Hp||(zn=Hp(wi,vo,zn))<0)return-1}else if(cc!=vo.charCodeAt(zn++))return-1}return zn}function Gt(wi,Ha,vo){var zn=v.exec(Ha.slice(vo));return zn?(wi.p=x[zn[0].toLowerCase()],vo+zn[0].length):-1}function xr(wi,Ha,vo){var zn=T.exec(Ha.slice(vo));return zn?(wi.w=L[zn[0].toLowerCase()],vo+zn[0].length):-1}function dr(wi,Ha,vo){var zn=E.exec(Ha.slice(vo));return zn?(wi.w=A[zn[0].toLowerCase()],vo+zn[0].length):-1}function zr(wi,Ha,vo){var zn=H.exec(Ha.slice(vo));return zn?(wi.m=ne[zn[0].toLowerCase()],vo+zn[0].length):-1}function bn(wi,Ha,vo){var zn=F.exec(Ha.slice(vo));return zn?(wi.m=z[zn[0].toLowerCase()],vo+zn[0].length):-1}function Wn(wi,Ha,vo){return Nt(wi,i,Ha,vo)}function oa(wi,Ha,vo){return Nt(wi,t,Ha,vo)}function Ma(wi,Ha,vo){return Nt(wi,n,Ha,vo)}function Co(wi){return u[wi.getDay()]}function ko(wi){return o[wi.getDay()]}function es(wi){return p[wi.getMonth()]}function Ml(wi){return l[wi.getMonth()]}function Bv(wi){return r[+(wi.getHours()>=12)]}function kd(wi){return 1+~~(wi.getMonth()/3)}function Nv(wi){return u[wi.getUTCDay()]}function $0(wi){return o[wi.getUTCDay()]}function Ag(wi){return p[wi.getUTCMonth()]}function Y0(wi){return l[wi.getUTCMonth()]}function _8(wi){return r[+(wi.getUTCHours()>=12)]}function x8(wi){return 1+~~(wi.getUTCMonth()/3)}return{format:function(wi){var Ha=ft(wi+="",oe);return Ha.toString=function(){return wi},Ha},parse:function(wi){var Ha=At(wi+="",!1);return Ha.toString=function(){return wi},Ha},utcFormat:function(wi){var Ha=ft(wi+="",ke);return Ha.toString=function(){return wi},Ha},utcParse:function(wi){var Ha=At(wi+="",!0);return Ha.toString=function(){return wi},Ha}}}var db={"-":"",_:" ","0":"0"},xu=/^\s*\d+/,E6=/^%/,S6=/[\\^$*+?|[\]().{}]/g;function po(e,i,t){var n=e<0?"-":"",r=(n?-e:e)+"",o=r.length;return n+(o<t?new Array(t-o+1).join(i)+r:r)}function w6(e){return e.replace(S6,"\\$&")}function mv(e){return new RegExp("^(?:"+e.map(w6).join("|")+")","i")}function gv(e){for(var i={},t=-1,n=e.length;++t<n;)i[e[t].toLowerCase()]=t;return i}function C6(e,i,t){var n=xu.exec(i.slice(t,t+1));return n?(e.w=+n[0],t+n[0].length):-1}function A6(e,i,t){var n=xu.exec(i.slice(t,t+1));return n?(e.u=+n[0],t+n[0].length):-1}function T6(e,i,t){var n=xu.exec(i.slice(t,t+2));return n?(e.U=+n[0],t+n[0].length):-1}function M6(e,i,t){var n=xu.exec(i.slice(t,t+2));return n?(e.V=+n[0],t+n[0].length):-1}function k6(e,i,t){var n=xu.exec(i.slice(t,t+2));return n?(e.W=+n[0],t+n[0].length):-1}function vb(e,i,t){var n=xu.exec(i.slice(t,t+4));return n?(e.y=+n[0],t+n[0].length):-1}function mb(e,i,t){var n=xu.exec(i.slice(t,t+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),t+n[0].length):-1}function I6(e,i,t){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(t,t+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),t+n[0].length):-1}function P6(e,i,t){var n=xu.exec(i.slice(t,t+1));return n?(e.q=n[0]*3-3,t+n[0].length):-1}function R6(e,i,t){var n=xu.exec(i.slice(t,t+2));return n?(e.m=n[0]-1,t+n[0].length):-1}function gb(e,i,t){var n=xu.exec(i.slice(t,t+2));return n?(e.d=+n[0],t+n[0].length):-1}function L6(e,i,t){var n=xu.exec(i.slice(t,t+3));return n?(e.m=0,e.d=+n[0],t+n[0].length):-1}function yb(e,i,t){var n=xu.exec(i.slice(t,t+2));return n?(e.H=+n[0],t+n[0].length):-1}function O6(e,i,t){var n=xu.exec(i.slice(t,t+2));return n?(e.M=+n[0],t+n[0].length):-1}function F6(e,i,t){var n=xu.exec(i.slice(t,t+2));return n?(e.S=+n[0],t+n[0].length):-1}function D6(e,i,t){var n=xu.exec(i.slice(t,t+3));return n?(e.L=+n[0],t+n[0].length):-1}function B6(e,i,t){var n=xu.exec(i.slice(t,t+6));return n?(e.L=Math.floor(n[0]/1e3),t+n[0].length):-1}function N6(e,i,t){var n=E6.exec(i.slice(t,t+1));return n?t+n[0].length:-1}function z6(e,i,t){var n=xu.exec(i.slice(t));return n?(e.Q=+n[0],t+n[0].length):-1}function Z6(e,i,t){var n=xu.exec(i.slice(t));return n?(e.s=+n[0],t+n[0].length):-1}function _b(e,i){return po(e.getDate(),i,2)}function U6(e,i){return po(e.getHours(),i,2)}function V6(e,i){return po(e.getHours()%12||12,i,2)}function j6(e,i){return po(1+hg.count(xd(e),e),i,3)}function xb(e,i){return po(e.getMilliseconds(),i,3)}function G6(e,i){return xb(e,i)+"000"}function H6(e,i){return po(e.getMonth()+1,i,2)}function W6(e,i){return po(e.getMinutes(),i,2)}function X6(e,i){return po(e.getSeconds(),i,2)}function $6(e){var i=e.getDay();return i===0?7:i}function Y6(e,i){return po(fg.count(xd(e)-1,e),i,2)}function bb(e){var i=e.getDay();return i>=4||i===0?bd(e):bd.ceil(e)}function q6(e,i){return e=bb(e),po(bd.count(xd(e),e)+(xd(e).getDay()===4),i,2)}function K6(e){return e.getDay()}function Q6(e,i){return po(L0.count(xd(e)-1,e),i,2)}function J6(e,i){return po(e.getFullYear()%100,i,2)}function ek(e,i){return e=bb(e),po(e.getFullYear()%100,i,2)}function tk(e,i){return po(e.getFullYear()%1e4,i,4)}function rk(e,i){var t=e.getDay();return e=t>=4||t===0?bd(e):bd.ceil(e),po(e.getFullYear()%1e4,i,4)}function nk(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+po(i/60|0,"0",2)+po(i%60,"0",2)}function Eb(e,i){return po(e.getUTCDate(),i,2)}function ik(e,i){return po(e.getUTCHours(),i,2)}function ak(e,i){return po(e.getUTCHours()%12||12,i,2)}function ok(e,i){return po(1+pb.count(dv(e),e),i,3)}function Sb(e,i){return po(e.getUTCMilliseconds(),i,3)}function sk(e,i){return Sb(e,i)+"000"}function uk(e,i){return po(e.getUTCMonth()+1,i,2)}function lk(e,i){return po(e.getUTCMinutes(),i,2)}function ck(e,i){return po(e.getUTCSeconds(),i,2)}function fk(e){var i=e.getUTCDay();return i===0?7:i}function hk(e,i){return po(fb.count(dv(e)-1,e),i,2)}function wb(e){var i=e.getUTCDay();return i>=4||i===0?Ed(e):Ed.ceil(e)}function pk(e,i){return e=wb(e),po(Ed.count(dv(e),e)+(dv(e).getUTCDay()===4),i,2)}function dk(e){return e.getUTCDay()}function vk(e,i){return po(F0.count(dv(e)-1,e),i,2)}function mk(e,i){return po(e.getUTCFullYear()%100,i,2)}function gk(e,i){return e=wb(e),po(e.getUTCFullYear()%100,i,2)}function yk(e,i){return po(e.getUTCFullYear()%1e4,i,4)}function _k(e,i){var t=e.getUTCDay();return e=t>=4||t===0?Ed(e):Ed.ceil(e),po(e.getUTCFullYear()%1e4,i,4)}function xk(){return"+0000"}function Cb(){return"%"}function Ab(e){return+e}function Tb(e){return Math.floor(+e/1e3)}var Sd,Mb,bk,Ek,Sk;wk({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function wk(e){return Sd=b6(e),Mb=Sd.format,bk=Sd.parse,Ek=Sd.utcFormat,Sk=Sd.utcParse,Sd}var yv=1e3,_v=yv*60,xv=_v*60,bv=xv*24,Ck=bv*7,kb=bv*30,mg=bv*365;function Ak(e){return new Date(e)}function Tk(e){return e instanceof Date?+e:+new Date(+e)}function Ib(e,i,t,n,r,o,u,l,p){var v=Bx(ju,ju),x=v.invert,E=v.domain,A=p(".%L"),T=p(":%S"),L=p("%I:%M"),F=p("%I %p"),z=p("%a %d"),H=p("%b %d"),ne=p("%B"),oe=p("%Y"),ke=[[u,1,yv],[u,5,5*yv],[u,15,15*yv],[u,30,30*yv],[o,1,_v],[o,5,5*_v],[o,15,15*_v],[o,30,30*_v],[r,1,xv],[r,3,3*xv],[r,6,6*xv],[r,12,12*xv],[n,1,bv],[n,2,2*bv],[t,1,Ck],[i,1,kb],[i,3,3*kb],[e,1,mg]];function De(At){return(u(At)<At?A:o(At)<At?T:r(At)<At?L:n(At)<At?F:i(At)<At?t(At)<At?z:H:e(At)<At?ne:oe)(At)}function ft(At,Nt,Gt,xr){if(At==null&&(At=10),typeof At=="number"){var dr=Math.abs(Gt-Nt)/At,zr=xx(function(bn){return bn[2]}).right(ke,dr);zr===ke.length?(xr=tg(Nt/mg,Gt/mg,At),At=e):zr?(zr=ke[dr/ke[zr-1][2]<ke[zr][2]/dr?zr-1:zr],xr=zr[1],At=zr[0]):(xr=Math.max(tg(Nt,Gt,At),1),At=l)}return xr==null?At:At.every(xr)}return v.invert=function(At){return new Date(x(At))},v.domain=function(At){return arguments.length?E(Ix.call(At,Tk)):E().map(Ak)},v.ticks=function(At,Nt){var Gt=E(),xr=Gt[0],dr=Gt[Gt.length-1],zr=dr<xr,bn;return zr&&(bn=xr,xr=dr,dr=bn),bn=ft(At,xr,dr,Nt),bn=bn?bn.range(xr,dr+1):[],zr?bn.reverse():bn},v.tickFormat=function(At,Nt){return Nt==null?De:p(Nt)},v.nice=function(At,Nt){var Gt=E();return(At=ft(At,Gt[0],Gt[Gt.length-1],Nt))?E(Wx(Gt,At)):v},v.copy=function(){return M0(v,Ib(e,i,t,n,r,o,u,l,p))},v}function Mk(){return Jh.apply(Ib(xd,u6,fg,hg,p6,d6,v6,m6,Mb).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function RR(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function D0(){var e=0,i=1,t,n,r,o,u=ju,l=!1,p;function v(x){return isNaN(x=+x)?p:u(r===0?.5:(x=(o(x)-t)*r,l?Math.max(0,Math.min(1,x)):x))}return v.domain=function(x){return arguments.length?(t=o(e=+x[0]),n=o(i=+x[1]),r=t===n?0:1/(n-t),v):[e,i]},v.clamp=function(x){return arguments.length?(l=!!x,v):l},v.interpolator=function(x){return arguments.length?(u=x,v):u},v.unknown=function(x){return arguments.length?(p=x,v):p},function(x){return o=x,t=x(e),n=x(i),r=t===n?0:1/(n-t),v}}function Ev(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Pb(){var e=hv(D0()(ju));return e.copy=function(){return Ev(e,Pb())},Px.apply(e,arguments)}function kk(){var e=loggish(D0()).domain([1,10]);return e.copy=function(){return Ev(e,kk()).base(e.base())},initInterpolator.apply(e,arguments)}function Ik(){var e=symlogish(D0());return e.copy=function(){return Ev(e,Ik()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Rb(){var e=powish(D0());return e.copy=function(){return Ev(e,Rb()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function LR(){return Rb.apply(null,arguments).exponent(.5)}function Pk(){var e=[],i=identity;function t(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return t.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var r=0,o=n.length,u;r<o;++r)u=n[r],u!=null&&!isNaN(u=+u)&&e.push(u);return e.sort(ascending),t},t.interpolator=function(n){return arguments.length?(i=n,t):i},t.copy=function(){return Pk(i).domain(e)},initInterpolator.apply(t,arguments)}function B0(){var e=0,i=.5,t=1,n,r,o,u,l,p=ju,v,x=!1,E;function A(T){return isNaN(T=+T)?E:(T=.5+((T=+v(T))-r)*(T<r?u:l),p(x?Math.max(0,Math.min(1,T)):T))}return A.domain=function(T){return arguments.length?(n=v(e=+T[0]),r=v(i=+T[1]),o=v(t=+T[2]),u=n===r?0:.5/(r-n),l=r===o?0:.5/(o-r),A):[e,i,t]},A.clamp=function(T){return arguments.length?(x=!!T,A):x},A.interpolator=function(T){return arguments.length?(p=T,A):p},A.unknown=function(T){return arguments.length?(E=T,A):E},function(T){return v=T,n=T(e),r=T(i),o=T(t),u=n===r?0:.5/(r-n),l=r===o?0:.5/(o-r),A}}function Lb(){var e=hv(B0()(ju));return e.copy=function(){return Ev(e,Lb())},Px.apply(e,arguments)}function Rk(){var e=loggish(B0()).domain([.1,1,10]);return e.copy=function(){return copy(e,Rk()).base(e.base())},initInterpolator.apply(e,arguments)}function Lk(){var e=symlogish(B0());return e.copy=function(){return copy(e,Lk()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Ob(){var e=powish(B0());return e.copy=function(){return copy(e,Ob()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function OR(){return Ob.apply(null,arguments).exponent(.5)}function Fb(e){var i,t=[];function n(r){return r==null?i:r}return n.invert=n,n.domain=n.range=function(r){return r?(t=r,r):t},n.unknown=function(r){return r?(i=r,r):i},n.copy=function(){return Fb(e).unknown(i)},n}var uc,Db,Bb,Ok=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Fk=(uc={},(0,W.Z)(uc,_o.LINEAR,Hx),(0,W.Z)(uc,_o.POWER,sg),(0,W.Z)(uc,_o.LOG,qx),(0,W.Z)(uc,_o.IDENTITY,Fb),(0,W.Z)(uc,_o.SEQUENTIAL,Pb),(0,W.Z)(uc,_o.TIME,Mk),(0,W.Z)(uc,_o.QUANTILE,eb),(0,W.Z)(uc,_o.QUANTIZE,tb),(0,W.Z)(uc,_o.THRESHOLD,rb),(0,W.Z)(uc,_o.CAT,T0),(0,W.Z)(uc,_o.DIVERGING,Lb),uc),Dk=(Db=(0,B.b2)(),Db(Bb=function(){function e(){(0,wt.Z)(this,e),(0,W.Z)(this,"scaleOptions",{})}return(0,zt.Z)(e,[{key:"apply",value:function(t,n){var r=this,o=n.styleAttributeService;t.hooks.init.tapPromise("FeatureScalePlugin",(0,Wt.Z)(be().mark(function u(){var l,p,v;return be().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(r.scaleOptions=t.getScaleOptions(),p=o.getLayerStyleAttributes(),v=(l=t.getSource())===null||l===void 0?void 0:l.data.dataArray,!(Array.isArray(v)&&v.length===0)){E.next=7;break}return E.abrupt("return");case 7:r.caculateScalesForAttributes(p||[],v);case 8:case"end":return E.stop()}},u)}))),t.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var u=(0,Wt.Z)(be().mark(function l(p){var v,x;return be().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(p){A.next=2;break}return A.abrupt("return",p);case 2:if(r.scaleOptions=t.getScaleOptions(),v=o.getLayerStyleAttributes(),x=t.getSource().data.dataArray,!(Array.isArray(x)&&x.length===0)){A.next=7;break}return A.abrupt("return",!0);case 7:return r.caculateScalesForAttributes(v||[],x),t.layerModelNeedUpdate=!0,A.abrupt("return",!0);case 10:case"end":return A.stop()}},l)}));return function(l){return u.apply(this,arguments)}}()),t.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!t.layerModelNeedUpdate){r.scaleOptions=t.getScaleOptions();var u=o.getLayerStyleAttributes(),l=t.getSource().data.dataArray;if(!(Array.isArray(l)&&l.length===0)&&u){var p=u.filter(function(v){return v.needRescale});p.length&&r.caculateScalesForAttributes(p,l)}}})}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,n){var r=this;t.forEach(function(o){if(o.scale){var u=o.scale;u.names=r.parseFields(o.scale.field||[]);var l=[];u.names.forEach(function(p){var v;l.push(r.createScale(p,o.name,(v=o.scale)===null||v===void 0?void 0:v.values,n))}),l.some(function(p){return p.type===$h.VARIABLE})?(u.type=$h.VARIABLE,l.forEach(function(p){var v;if(!u.callback&&u.values!=="text")switch((v=p.option)===null||v===void 0?void 0:v.type){case _o.LOG:case _o.LINEAR:case _o.POWER:if(u.values&&u.values.length>2){var x=p.scale.ticks(u.values.length);p.scale.domain(x)}u.values?p.scale.range(u.values):p.scale.range(p.option.domain);break;case _o.QUANTILE:case _o.QUANTIZE:case _o.THRESHOLD:p.scale.range(u.values);break;case _o.IDENTITY:break;case _o.CAT:u.values?p.scale.range(u.values):p.scale.range(p.option.domain);break;case _o.DIVERGING:case _o.SEQUENTIAL:p.scale.interpolator(TM.hD(u.values));break}if(u.values==="text"){var E;p.scale.range((E=p.option)===null||E===void 0?void 0:E.domain)}})):(u.type=$h.CONSTANT,u.defaultValues=l.map(function(p,v){return p.scale(u.names[v])})),u.scalers=l.map(function(p){return{field:p.field,func:p.scale,option:p.option}}),o.needRescale=!1}})}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:(0,ur.isString)(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,n,r,o){var u,l,p=this.scaleOptions[n]&&((u=this.scaleOptions[n])===null||u===void 0?void 0:u.field)===t?this.scaleOptions[n]:this.scaleOptions[t],v={field:t,scale:void 0,type:$h.VARIABLE,option:p};if(!o||!o.length)return p&&p.type?v.scale=this.createDefaultScale(p):(v.scale=T0([t]),v.type=$h.CONSTANT),v;var x=(l=o.find(function(T){return!(0,ur.isNil)(T[t])}))===null||l===void 0?void 0:l[t];if(this.isNumber(t)||(0,ur.isNil)(x)&&!p)v.scale=T0([t]),v.type=$h.CONSTANT;else{var E=p&&p.type||this.getDefaultType(x);r==="text"&&(E=_o.CAT);var A=this.createScaleConfig(E,t,p,o);v.scale=this.createDefaultScale(A),v.option=A}return v}},{key:"getDefaultType",value:function(t){var n=_o.LINEAR;return typeof t=="string"&&(n=Ok.test(t)?_o.TIME:_o.CAT),n}},{key:"createScaleConfig",value:function(t,n,r,o){var u={type:t},l=(o==null?void 0:o.map(function(x){return x[n]}))||[];if(r!=null&&r.domain)u.domain=r==null?void 0:r.domain;else if(t===_o.CAT||t===_o.IDENTITY)u.domain=(0,ur.uniq)(l);else if(t===_o.QUANTILE)u.domain=l;else if(t===_o.DIVERGING){var p=Ex(l),v=(r==null?void 0:r.neutral)!==void 0?r==null?void 0:r.neutral:(p[0]+p[1])/2;u.domain=[p[0],v,p[1]]}else u.domain=Ex(l);return(0,mt.Z)((0,mt.Z)({},u),r)}},{key:"createDefaultScale",value:function(t){var n=t.type,r=t.domain,o=t.unknown,u=t.clamp,l=t.nice,p=Fk[n]();return r&&p.domain&&p.domain(r),o&&p.unknown(o),u!==void 0&&p.clamp&&p.clamp(u),l!==void 0&&p.nice&&p.nice(l),p}}]),e}())||Bb),Nb,zb,Bk=(Nb=(0,B.b2)(),Nb(zb=function(){function e(){(0,wt.Z)(this,e)}return(0,zt.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var n=t.animateStatus;n&&t.models.forEach(function(r){r.addUniforms((0,mt.Z)({},t.layerModel.getAnimateUniforms()))})})}}]),e}())||zb),Nk=function(){function e(i){var t=i.rendererService,n=i.layerService,r=i.parent;(0,wt.Z)(this,e),(0,W.Z)(this,"tileResource",new Map),(0,W.Z)(this,"_tiles",[]),this.rendererService=t,this.layerService=n,this.parent=r}return(0,zt.Z)(e,[{key:"tiles",get:function(){return this._tiles}},{key:"hasTile",value:function(t){return this._tiles.some(function(n){return n.key===t})}},{key:"addTile",value:function(t){this._tiles.push(t)}},{key:"getTile",value:function(t){return this._tiles.find(function(n){return n.key===t})}},{key:"getVisibleTileBylngLat",value:function(t){return this._tiles.find(function(n){return n.isLoaded&&n.visible&&n.lnglatInBounds(t)})}},{key:"removeTile",value:function(t){var n=this._tiles.findIndex(function(o){return o.key===t}),r=this._tiles.splice(n,1);r[0]&&r[0].destroy()}},{key:"updateTileVisible",value:function(t){var n=this.getTile(t.key);n==null||n.updateVisible(t.isVisible)}},{key:"isParentLoaded",value:function(t){var n=t.parent;if(!n)return!0;var r=this.getTile(n==null?void 0:n.key);return!!(r!=null&&r.isLoaded)}},{key:"isChildrenLoaded",value:function(t){var n=this,r=t==null?void 0:t.children;return r.length===0?!0:r.some(function(o){var u=n.getTile(o==null?void 0:o.key);return(u==null?void 0:u.isLoaded)===!1})}},{key:"render",value:function(){var i=(0,Wt.Z)(be().mark(function n(){var r=this,o;return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:o=this.getRenderLayers(),o.map(function(){var p=(0,Wt.Z)(be().mark(function v(x){return be().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,r.layerService.renderLayer(x);case 2:case"end":return A.stop()}},v)}));return function(v){return p.apply(this,arguments)}}());case 2:case"end":return l.stop()}},n,this)}));function t(){return i.apply(this,arguments)}return t}()},{key:"getRenderLayers",value:function(){var t=this._tiles.filter(function(r){return r.visible&&r.isLoaded}),n=[];return t.map(function(r){return n.push.apply(n,(0,cr.Z)(r.getLayers()))}),n}},{key:"getLayers",value:function(){var t=this._tiles.filter(function(r){return r.isLoaded}),n=[];return t.map(function(r){return n.push.apply(n,(0,cr.Z)(r.getLayers()))}),n}},{key:"getTiles",value:function(){return this._tiles}},{key:"destroy",value:function(){this._tiles.forEach(function(t){return t.destroy()}),this.tileResource.clear()}}]),e}(),zk=ee(32676);function Zk(e,i,t){t===void 0&&(t={});var n=tr(e),r=tr(i),o=zk.union(n.coordinates,r.coordinates);return o.length===0?null:o.length===1?Ye(o[0],t.properties):jn(o,t.properties)}var Uk=Zk,Vk=function(){function e(){(0,wt.Z)(this,e)}return(0,zt.Z)(e,[{key:"getCombineFeature",value:function(t){var n=null,r=t[0];return t.map(function(o){var u=Ye(o.coordinates);n===null?n=u:n=Uk(n,u)}),r&&(n.properties=(0,mt.Z)({},r)),n}}]),e}(),Sv="select",wv="active",jk=function(){function e(i){var t=i.layerService,n=i.tileLayerService,r=i.parent;(0,wt.Z)(this,e),(0,W.Z)(this,"tilePickID",new Map),this.layerService=t,this.tileLayerService=n,this.parent=r,this.tileSourceService=new Vk}return(0,zt.Z)(e,[{key:"pickRender",value:function(t){var n=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(n){var r=n.getMainLayer();r==null||r.layerPickService.pickRender(t)}}},{key:"pick",value:function(t,n){var r=this.parent.getContainer(),o=r.get(V.IPickingService);if(t.type==="RasterLayer"){var u=this.tileLayerService.getVisibleTileBylngLat(n.lngLat);if(u&&u.getMainLayer()!==void 0){var l=u.getMainLayer();return l.layerPickService.pickRasterLayer(l,n,this.parent)}return!1}return this.pickRender(n),o.pickFromPickingFBO(t,n)}},{key:"selectFeature",value:function(t){var n=(0,$n.Z)(t,3),r=n[0],o=n[1],u=n[2],l=this.color2PickId(r,o,u);this.tilePickID.set(Sv,l),this.updateHighLight(r,o,u,Sv)}},{key:"highlightPickedFeature",value:function(t){var n=(0,$n.Z)(t,3),r=n[0],o=n[1],u=n[2],l=this.color2PickId(r,o,u);this.tilePickID.set(wv,l),this.updateHighLight(r,o,u,wv)}},{key:"updateHighLight",value:function(t,n,r,o){this.tileLayerService.tiles.map(function(u){var l=u.getMainLayer();switch(o){case Sv:l==null||l.hooks.beforeSelect.call([t,n,r]);break;case wv:l==null||l.hooks.beforeHighlight.call([t,n,r]);break}})}},{key:"setPickState",value:function(){var t=this.tilePickID.get(Sv),n=this.tilePickID.get(wv);if(t){var r=this.pickId2Color(t),o=(0,$n.Z)(r,3),u=o[0],l=o[1],p=o[2];this.updateHighLight(u,l,p,Sv);return}if(n){var v=this.pickId2Color(n),x=(0,$n.Z)(v,3),E=x[0],A=x[1],T=x[2];this.updateHighLight(E,A,T,wv);return}}},{key:"color2PickId",value:function(t,n,r){return li(new Uint8Array([t,n,r]))}},{key:"pickId2Color",value:function(t){return Jn(t)}},{key:"getFeatureById",value:function(t){var n=this.tileLayerService.getTiles().filter(function(o){return o.visible}),r=[];return n.forEach(function(o){r.push.apply(r,(0,cr.Z)(o.getFeatureById(t)))}),r}},{key:"pickRasterLayer",value:function(t,n,r){return!1}}]),e}();function Gk(e){return e==="PolygonLayer"?Ym:e==="LineLayer"?Xm:x0}function Hk(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}var Up=function(){function e(i,t){(0,wt.Z)(this,e),(0,W.Z)(this,"visible",!0),(0,W.Z)(this,"layers",[]),(0,W.Z)(this,"isLoaded",!1),this.parent=t,this.sourceTile=i,this.x=i.x,this.y=i.y,this.z=i.z,this.key="".concat(this.x,"_").concat(this.y,"_").concat(this.z)}return(0,zt.Z)(e,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(t){var n=(0,$n.Z)(this.sourceTile.bounds,4),r=n[0],o=n[1],u=n[2],l=n[3],p=t.lng,v=t.lat;return p>=r&&p<=u&&v>=o&&v<=l}},{key:"getLayerOptions",value:function(){var t=this.parent.getLayerConfig();return(0,mt.Z)((0,mt.Z)({},t),{},{autoFit:!1,mask:Hk(this.parent.type)||t.mask})}},{key:"addMask",value:function(){var i=(0,Wt.Z)(be().mark(function n(r,o){var u;return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return u=l0(this.parent.sceneContainer),o.setContainer(u,this.parent.sceneContainer),p.next=4,o.init();case 4:r.addMaskLayer(o);case 5:case"end":return p.stop()}},n,this)}));function t(n,r){return i.apply(this,arguments)}return t}()},{key:"addLayer",value:function(){var i=(0,Wt.Z)(be().mark(function n(r){var o;return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return r.isTileLayer=!0,o=l0(this.parent.sceneContainer),r.setContainer(o,this.parent.sceneContainer),this.layers.push(r),l.next=6,r.init();case 6:case"end":return l.stop()}},n,this)}));function t(n){return i.apply(this,arguments)}return t}()},{key:"updateVisible",value:function(t){this.visible=t,this.updateOptions("visible",t)}},{key:"updateOptions",value:function(t,n){this.layers.forEach(function(r){r.updateLayerConfig((0,W.Z)({},t,n))})}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(t){return[]}},{key:"getFeatureById",value:function(t){return[]}},{key:"destroy",value:function(){this.layers.forEach(function(t){return t.destroy()})}}]),e}();function Wk(e){var i=Xk();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function Xk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var N0=function(e){(0,Dr.Z)(t,e);var i=Wk(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x;return be().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=Gk(this.parent.type),v=this.getSourceOption(),v){A.next=7;break}return this.isLoaded=!0,A.abrupt("return");case 7:if(x=new p((0,mt.Z)({},l)).source(v.data,v.options),Object.keys(u).forEach(function(T){var L,F,z=T;x[z]((L=u[z])===null||L===void 0?void 0:L.field,(F=u[z])===null||F===void 0?void 0:F.values)}),!l.mask){A.next=12;break}return A.next=12,this.addTileMask(x);case 12:return A.next=14,this.addLayer(x);case 14:this.setLayerMinMaxZoom(x),this.isLoaded=!0;case 16:case"end":return A.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"addTileMask",value:function(){var n=(0,Wt.Z)(be().mark(function o(u){var l;return be().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l=new qm({layerType:"MaskLayer"}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}),v.next=3,this.addMask(u,l);case 3:case"end":return v.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"getSourceOption",value:function(){var r=this.parent.getSource(),o=this.parent.getLayerConfig(),u=o.sourceLayer,l=u===void 0?"defaultLayer":u,p=o.featureId,v=p===void 0?"id":p,x=this.getFeatures(l);return{data:{type:"FeatureCollection",features:x},options:{parser:{type:"geojson",featureId:v},transforms:r.transforms}}}},{key:"setLayerMinMaxZoom",value:function(r){r.getModelType()==="text"&&r.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(r){var o=this.sourceTile.data;return o.getTileData(r)}},{key:"getFeatureById",value:function(r){var o=this.getMainLayer();if(!o)return[];var u=o.getSource().data.dataArray.filter(function(l){return l._id===r});return u}}]),t}(Up);function $k(e){var i=Yk();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function Yk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qk=function(e){(0,Dr.Z)(t,e);var i=$k(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v;return be().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.getSourceOption(),l=u.data.features[0].properties,p=new Xm().source(u.data,u.options).size(1).shape("line").color("red"),v=new x0({minZoom:this.z-1,maxZoom:this.z+1}).source([l],{parser:{type:"json",x:"textLng",y:"textLat"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),E.next=6,this.addLayer(p);case 6:return E.next=8,this.addLayer(v);case 8:this.isLoaded=!0;case 9:case"end":return E.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getSourceOption",value:function(){var r=this.parent.getSource(),o=this.sourceTile.data.layers.testTile.features;return{data:{type:"FeatureCollection",features:o},options:{parser:{type:"geojson"},transforms:r.transforms}}}}]),t}(Up);function Kk(e){var i=Qk();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function Qk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Jk=function(e){(0,Dr.Z)(t,e);var i=Kk(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v;return be().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new Z1((0,mt.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(A){var T,L,F=A;v[F]((T=u[F])===null||T===void 0?void 0:T.field,(L=u[F])===null||L===void 0?void 0:L.values)}),E.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return E.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getSourceOption",value:function(){var r=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:r.transforms}}}}]),t}(Up),e7=["rasterData"];function t7(e){var i=r7();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function r7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var n7={positions:[0,1],colors:["#000","#fff"]},i7=function(e){(0,Dr.Z)(t,e);var i=t7(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v,x,E,A;return be().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=this.getLayerOptions(),x=v.rampColors,E=v.domain,this.colorTexture=this.parent.textureService.getColorTexture(x,E),A=new b0((0,mt.Z)((0,mt.Z)({},l),{},{colorTexture:this.colorTexture})).source(p.data,p.options),u&&Object.keys(u).forEach(function(F){var z,H,ne=F;A[ne]((z=u[ne])===null||z===void 0?void 0:z.field,(H=u[ne])===null||H===void 0?void 0:H.values)}),L.next=9,this.addLayer(A);case 9:this.isLoaded=!0;case 10:case"end":return L.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getSourceOption",value:function(){var r=this.parent.getSource(),o=this.sourceTile.data.data,u=o.rasterData,l=(0,C.Z)(o,e7);return{data:u,options:{parser:(0,mt.Z)({type:"raster",extent:this.sourceTile.bounds},l),transforms:r.transforms}}}},{key:"styleUpdate",value:function(){for(var r=this,o=arguments.length,u=new Array(o),l=0;l<o;l++)u[l]=arguments[l];var p=u,v=p.rampColors,x=v===void 0?n7:v,E=p.domain;this.colorTexture=this.parent.textureService.getColorTexture(x,E||Fo(x)),this.layers.forEach(function(A){return A.style({colorTexture:r.colorTexture})})}},{key:"destroy",value:function(){this.layers.forEach(function(r){return r.destroy()})}}]),t}(Up),a7=["rasterData"];function o7(e){var i=s7();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function s7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var u7=function(e){(0,Dr.Z)(t,e);var i=o7(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v;return be().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new b0((0,mt.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(A){var T,L,F=A;v[F]((T=u[F])===null||T===void 0?void 0:T.field,(L=u[F])===null||L===void 0?void 0:L.values)}),E.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return E.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getSourceOption",value:function(){var r=this.parent.getSource(),o=this.sourceTile.data.data,u=o.rasterData,l=(0,C.Z)(o,a7);return{data:u,options:{parser:(0,mt.Z)({type:"rasterRgb",extent:this.sourceTile.bounds},l),transforms:r.transforms}}}}]),t}(Up);function l7(e){var i=c7();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function c7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var f7=function(e){(0,Dr.Z)(t,e);var i=l7(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v;return be().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new b0((0,mt.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(A){var T,L,F=A;v[F]((T=u[F])===null||T===void 0?void 0:T.field,(L=u[F])===null||L===void 0?void 0:L.values)}),E.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return E.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getSourceOption",value:function(){var r=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:r.transforms}}}}]),t}(Up);function h7(e){var i=p7();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function p7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var d7=function(e){(0,Dr.Z)(t,e);var i=h7(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u,l,p,v;return be().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),p=this.getSourceOption(),v=new qm((0,mt.Z)({},l)).source(p.data,p.options),u&&Object.keys(u).forEach(function(A){var T,L,F=A;v[F]((T=u[F])===null||T===void 0?void 0:T.field,(L=u[F])===null||L===void 0?void 0:L.values)}),E.next=7,this.addLayer(v);case 7:this.isLoaded=!0;case 8:case"end":return E.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"getFeatures",value:function(r){if(!r)return[];var o=this.sourceTile.data;return o.getTileData(r)}},{key:"getSourceOption",value:function(){var r=this.parent.getSource(),o=this.parent.getLayerConfig(),u=o.sourceLayer,l=o.featureId,p=this.getFeatures(u);return{data:{type:"FeatureCollection",features:p},options:{parser:{type:"geojson",featureId:l},transforms:r.transforms}}}}]),t}(Up);function v7(e){var i=e.type;switch(i){case"PolygonLayer":return N0;case"LineLayer":return N0;case"PointLayer":return N0;case"TileDebugLayer":return qk;case"MaskLayer":return d7;case"RasterLayer":var t=e.getSource().parser.dataType;switch(t){case"rgb":case"customRGB":return u7;case"arraybuffer":case"customArrayBuffer":return i7;case"terrainRGB":return f7;default:return Jk}default:return N0}}var m7=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive"],Zb=function(){function e(i){(0,wt.Z)(this,e),(0,W.Z)(this,"initedTileset",!1),(0,W.Z)(this,"viewchange",(0,ur.debounce)(this.mapchange,24)),this.parent=i;var t=this.parent.getContainer();this.rendererService=t.get(V.IRendererService),this.layerService=t.get(V.ILayerService),this.mapService=t.get(V.IMapService),this.pickingService=t.get(V.IPickingService),this.tileLayerService=new Nk({rendererService:this.rendererService,layerService:this.layerService,parent:i}),this.tilePickService=new jk({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:i}),this.parent.setLayerPickService(this.tilePickService),this.proxy(i),this.initTileSetManager()}return(0,zt.Z)(e,[{key:"initTileSetManager",value:function(){var t,n=this.parent.getSource();this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var r=this.getCurrentView(),o=r.latLonBounds,u=r.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(u,o)}},{key:"mapchange",value:function(){var t,n=this.getCurrentView(),r=n.latLonBounds,o=n.zoom;if(this.mapService.version==="GAODE1.x"){var u=this.parent.getLayerConfig(),l=u.visible;o<2&&l?(this.parent.updateLayerConfig({visible:!1}),this.layerService.reRender()):o>=2&&!l&&(this.parent.updateLayerConfig({visible:!0}),this.layerService.reRender())}this.lastViewStates&&this.lastViewStates.zoom===o&&this.lastViewStates.latLonBounds.toString()===r.toString()||(this.lastViewStates={zoom:o,latLonBounds:r},(t=this.tilesetManager)===null||t===void 0||t.throttleUpdate(o,r))}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds(),n=[t[0][0],t[0][1],t[1][0],t[1][1]],r=this.mapService.getZoom();return{latLonBounds:n,zoom:r}}},{key:"bindTilesetEvent",value:function(){var t=this;this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){t.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,r){t.tileError(n)}),this.tilesetManager.on("tile-update",function(){t.tileUpdate()}),this.mapService.on("zoomend",function(){return t.mapchange()}),this.mapService.on("moveend",function(){return t.viewchange()})}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"destroy",value:function(){var t;(t=this.tilesetManager)===null||t===void 0||t.destroy(),this.tileLayerService.destroy()}},{key:"tileUnLoad",value:function(t){this.tileLayerService.removeTile(t.key)}},{key:"tileUpdate",value:function(){var i=(0,Wt.Z)(be().mark(function n(){var r=this,o,u;return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(this.tilesetManager){p.next=2;break}return p.abrupt("return");case 2:return o=this.parent.getMinZoom(),u=this.parent.getMaxZoom(),p.next=6,Promise.all(this.tilesetManager.tiles.filter(function(v){return v.isLoaded}).filter(function(v){return v.isVisibleChange}).filter(function(v){return v.data}).filter(function(v){return v.z>=o&&v.z<u}).map(function(){var v=(0,Wt.Z)(be().mark(function x(E){var A,T;return be().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(r.tileLayerService.hasTile(E.key)){F.next=9;break}return A=v7(r.parent),T=new A(E,r.parent),F.next=5,T.initTileLayer();case 5:r.tilePickService.setPickState(),T.getLayers().length!==0&&(r.tileLayerService.addTile(T),r.tileLayerService.updateTileVisible(E),r.layerService.reRender()),F.next=12;break;case 9:r.tileLayerService.updateTileVisible(E),r.tilePickService.setPickState(),r.layerService.reRender();case 12:case"end":return F.stop()}},x)}));return function(x){return v.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return p.stop()}},n,this)}));function t(){return i.apply(this,arguments)}return t}()},{key:"setPickState",value:function(t){}},{key:"pickRender",value:function(t){this.tilePickService.pickRender(t)}},{key:"selectFeature",value:function(t){this.tilePickService.selectFeature(t)}},{key:"highlightPickedFeature",value:function(t){this.tilePickService.highlightPickedFeature(t)}},{key:"proxy",value:function(t){var n=this;m7.forEach(function(r){var o=t[r].bind(t);t[r]=function(){for(var u=arguments.length,l=new Array(u),p=0;p<u;p++)l[p]=arguments[p];return o.apply(void 0,l),n.getLayers().map(function(v){v[r].apply(v,l)}),r==="style"&&n.getTiles().forEach(function(v){return v.styleUpdate.apply(v,l)}),t}})}}]),e}(),Ub,Vb,g7=(Ub=(0,B.b2)(),Ub(Vb=function(){function e(){(0,wt.Z)(this,e)}return(0,zt.Z)(e,[{key:"initLayerModel",value:function(){var i=(0,Wt.Z)(be().mark(function n(r){return be().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return r.prepareBuildModel(),u.next=3,r.buildModels();case 3:r.styleNeedUpdate=!1;case 4:case"end":return u.stop()}},n)}));function t(n){return i.apply(this,arguments)}return t}()},{key:"prepareLayerModel",value:function(){var i=(0,Wt.Z)(be().mark(function n(r){return be().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return r.prepareBuildModel(),u.next=3,r.buildModels();case 3:case"end":return u.stop()}},n)}));function t(n){return i.apply(this,arguments)}return t}()},{key:"apply",value:function(t){var n=this;t.hooks.init.tapPromise("LayerModelPlugin",(0,Wt.Z)(be().mark(function r(){return be().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!t.getSource().isTile){u.next=4;break}return t.prepareBuildModel(),t.tileLayer=new Zb(t),u.abrupt("return");case 4:return u.next=6,n.initLayerModel(t);case 6:case"end":return u.stop()}},r)}))),t.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var r=(0,Wt.Z)(be().mark(function o(u){return be().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(u){p.next=2;break}return p.abrupt("return",!1);case 2:if(!t.getSource().isTile){p.next=5;break}return t.tileLayer=new Zb(t),p.abrupt("return",!1);case 5:return p.next=7,n.prepareLayerModel(t);case 7:return p.abrupt("return",!0);case 8:case"end":return p.stop()}},o)}));return function(o){return r.apply(this,arguments)}}())}}]),e}())||Vb),jb,Gb,y7=(jb=(0,B.b2)(),jb(Gb=function(){function e(){(0,wt.Z)(this,e)}return(0,zt.Z)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",function(){var n=t.getLayerConfig(),r=n.autoFit,o=n.fitBoundsOptions;r&&t.fitBounds(o)})}}]),e}())||Gb),Hb,Wb,_7=["type"],Xb={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},x7={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},b7={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},E7={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function S7(e){var i={u_DirectionalLights:new Array(3).fill((0,mt.Z)({},b7)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,mt.Z)({},E7)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[x7]),e.forEach(function(t){var n=t.type,r=n===void 0?"directional":n,o=(0,C.Z)(t,_7),u=Xb[r].lights,l=Xb[r].num,p=i[l];i[u][p]=(0,mt.Z)((0,mt.Z)({},i[u][p]),o),i[l]++}),i}var w7=(Hb=(0,B.b2)(),Hb(Wb=function(){function e(){(0,wt.Z)(this,e)}return(0,zt.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",function(){var n=t.getLayerConfig(),r=n.enableLighting;r&&t.models.forEach(function(o){return o.addUniforms((0,mt.Z)({},S7()))})})}}]),e}())||Wb),$b,Yb,C7=($b=(0,B.b2)(),$b(Yb=function(){function e(){(0,wt.Z)(this,e)}return(0,zt.Z)(e,[{key:"apply",value:function(t,n){var r=this,o=n.rendererService,u=n.postProcessingPassFactory,l=n.normalPassFactory;t.hooks.init.tapPromise("MultiPassRendererPlugin",function(){var p=t.getLayerConfig(),v=p.enableMultiPassRenderer,x=p.passes,E=x===void 0?[]:x;r.enabled=!!v&&t.getLayerConfig().enableMultiPassRenderer!==!1,r.enabled&&(t.multiPassRenderer=m1(t,E,u,l),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(r.enabled){var p=o.getViewportSize(),v=p.width,x=p.height;t.multiPassRenderer.resize(v,x)}})}}]),e}())||Yb),qb,Kb,z0={NONE:0,ENCODE:1,HIGHLIGHT:2},A7=(qb=(0,B.b2)(),qb(Kb=function(){function e(){(0,wt.Z)(this,e)}return(0,zt.Z)(e,[{key:"apply",value:function(t,n){var r=n.styleAttributeService;t.hooks.init.tapPromise("PixelPickingPlugin",function(){var o=t.getLayerConfig(),u=o.enablePicking;r.registerStyleAttribute({name:"pickingColor",type:Nn.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:$.FLOAT},size:3,update:function(p){var v=p.id;return u?Jn(v):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var o=t.getLayerConfig(),u=o.enablePicking;u&&t.isVisible()&&t.models.forEach(function(l){return l.addUniforms({u_PickingStage:z0.ENCODE})})}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var o=t.getLayerConfig(),u=o.enablePicking;u&&t.isVisible()&&t.models.forEach(function(l){return l.addUniforms({u_PickingStage:z0.HIGHLIGHT})})}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",function(o){var u=t.getLayerConfig(),l=u.highlightColor,p=u.activeMix,v=p===void 0?0:p,x=typeof l=="string"?En(l):l||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:li(new Uint8Array(o))}),t.models.forEach(function(E){return E.addUniforms({u_PickingStage:z0.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:x.map(function(A){return A*255}),u_activeMix:v})})}),t.hooks.beforeSelect.tap("PixelPickingPlugin",function(o){var u=t.getLayerConfig(),l=u.selectColor,p=u.selectMix,v=p===void 0?0:p,x=typeof l=="string"?En(l):l||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:li(new Uint8Array(o))}),t.models.forEach(function(E){return E.addUniforms({u_PickingStage:z0.HIGHLIGHT,u_PickingColor:o,u_HighlightColor:x.map(function(A){return A*255}),u_activeMix:v,u_CurrentSelectedId:o,u_SelectColor:x.map(function(A){return A*255}),u_EnableSelect:1})})})}}]),e}())||Kb),T7=["mvt","geojsonvt","testTile"];function M7(e){var i=e.getSource();return T7.includes(i.parser.type)}function FR(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}var Qb,Jb,k7=(Qb=(0,B.b2)(),Qb(Jb=function(){function e(){(0,wt.Z)(this,e)}return(0,zt.Z)(e,[{key:"apply",value:function(t,n){var r=this,o=n.styleAttributeService;t.hooks.init.tapPromise("RegisterStyleAttributePlugin",function(){M7(t)||r.registerBuiltinAttributes(o,t)})}},{key:"registerBuiltinAttributes",value:function(t,n){if(n.type==="MaskLayer"){this.registerPositionAttribute(t);return}this.registerPositionAttribute(t),this.registerColorAttribute(t),this.registerVertexIdAttribute(t)}},{key:"registerPositionAttribute",value:function(t){t.registerStyleAttribute({name:"position",type:Nn.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:$.FLOAT},size:3,update:function(r,o,u){return u.length===2?[u[0],u[1],0]:[u[0],u[1],u[2]]}}})}},{key:"registerFilterAttribute",value:function(t){t.registerStyleAttribute({name:"filter",type:Nn.Attribute,descriptor:{name:"filter",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(r){var o=r.filter;return o?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(t){t.registerStyleAttribute({name:"color",type:Nn.Attribute,descriptor:{name:"a_Color",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:4,update:function(r){var o=r.color;return!o||!o.length?[1,1,1,1]:o}}})}},{key:"registerVertexIdAttribute",value:function(t){t.registerStyleAttribute({name:"vertexId",type:Nn.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:$.DYNAMIC_DRAW,data:[],type:$.FLOAT},size:1,update:function(r,o){return[o]}}})}}]),e}())||Jb),e2,t2,r2,n2,i2,a2,wd,o2,s2,u2,l2,I7=(e2=(0,B.b2)(),t2=(0,B.f3)(V.ICameraService),r2=(0,B.f3)(V.ICoordinateSystemService),n2=(0,B.f3)(V.IRendererService),i2=(0,B.f3)(V.IMapService),e2(a2=(wd=function(){function e(){(0,wt.Z)(this,e),ia(this,"cameraService",o2,this),ia(this,"coordinateSystemService",s2,this),ia(this,"rendererService",u2,this),ia(this,"mapService",l2,this)}return(0,zt.Z)(e,[{key:"apply",value:function(t){var n=this,r=this.mapService.version,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[0,0];t.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var l=t.getLayerConfig().tileOrigin;n.coordinateSystemService.refresh(l),r==="GAODE2.x"&&(n.setLayerCenter(t),o=n.mapService.map.customCoords.getMVPMatrix(),u=n.mapService.getCustomCoordCenter());var p=n.rendererService.getViewportSize(),v=p.width,x=p.height;t.models.forEach(function(E){var A;E.addUniforms((A={},(0,W.Z)(A,Op.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,W.Z)(A,Op.ViewMatrix,n.cameraService.getViewMatrix()),(0,W.Z)(A,Op.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,W.Z)(A,Op.Zoom,n.cameraService.getZoom()),(0,W.Z)(A,Op.ZoomScale,n.cameraService.getZoomScale()),(0,W.Z)(A,Op.FocalDistance,n.cameraService.getFocalDistance()),(0,W.Z)(A,Op.CameraPosition,n.cameraService.getCameraPosition()),(0,W.Z)(A,Pp.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,W.Z)(A,Pp.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,W.Z)(A,Pp.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,W.Z)(A,Pp.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,W.Z)(A,Pp.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,W.Z)(A,Pp.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,W.Z)(A,Pp.Mvp,o),(0,W.Z)(A,"u_SceneCenterMKT",u),(0,W.Z)(A,"u_ViewportSize",[v,x]),(0,W.Z)(A,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,W.Z)(A,"u_DevicePixelRatio",Xi.devicePixelRatio),(0,W.Z)(A,"u_PickingBuffer",t.getLayerConfig().pickingBuffer||0),(0,W.Z)(A,"u_shaderPick",Number(t.getShaderPickStat())),A))})})}},{key:"setLayerCenter",value:function(t){t.coordCenter===void 0&&(t.coordCenter=t.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(t.coordCenter)}}]),e}(),o2=Qi(wd.prototype,"cameraService",[t2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s2=Qi(wd.prototype,"coordinateSystemService",[r2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u2=Qi(wd.prototype,"rendererService",[n2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l2=Qi(wd.prototype,"mapService",[i2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wd))||a2),c2,f2,P7=(c2=(0,B.b2)(),c2(f2=function(){function e(){(0,wt.Z)(this,e)}return(0,zt.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",function(){t.layerModel&&t.layerModel.needUpdate().then(function(n){n&&t.renderLayers()})}),t.hooks.afterRender.tap("UpdateModelPlugin",function(){t.layerModelNeedUpdate=!1})}}]),e}())||f2),h2,p2,R7=(h2=(0,B.b2)(),h2(p2=function(){function e(){(0,wt.Z)(this,e)}return(0,zt.Z)(e,[{key:"apply",value:function(t,n){var r=this,o=n.styleAttributeService;t.hooks.init.tapPromise("UpdateStyleAttributePlugin",function(){r.initStyleAttribute(t,{styleAttributeService:o})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){t.layerModelNeedUpdate||t.inited&&r.updateStyleAttribute(t,{styleAttributeService:o})})}},{key:"updateStyleAttribute",value:function(t,n){var r=n.styleAttributeService,o=r.getLayerStyleAttributes()||[],u=r.getLayerStyleAttribute("filter");if(u&&u.needRegenerateVertices){t.layerModelNeedUpdate=!0,o.forEach(function(l){return l.needRegenerateVertices=!1});return}o.filter(function(l){return l.needRegenerateVertices}).forEach(function(l){r.updateAttributeByFeatureRange(l.name,t.getEncodedData(),l.featureRange.startIndex,l.featureRange.endIndex,t),l.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(t,n){var r=n.styleAttributeService,o=r.getLayerStyleAttributes()||[];o.filter(function(u){return u.needRegenerateVertices}).forEach(function(u){r.updateAttributeByFeatureRange(u.name,t.getEncodedData(),u.featureRange.startIndex,u.featureRange.endIndex),u.needRegenerateVertices=!1})}}]),e}())||p2);ac.bind(V.ILayerPlugin).to(EM).inRequestScope(),ac.bind(V.ILayerPlugin).to(k7).inRequestScope(),ac.bind(V.ILayerPlugin).to(Dk).inRequestScope(),ac.bind(V.ILayerPlugin).to(bM).inRequestScope(),ac.bind(V.ILayerPlugin).to(y7).inRequestScope(),ac.bind(V.ILayerPlugin).to(R7).inRequestScope(),ac.bind(V.ILayerPlugin).to(P7).inRequestScope(),ac.bind(V.ILayerPlugin).to(C7).inRequestScope(),ac.bind(V.ILayerPlugin).to(I7).inRequestScope(),ac.bind(V.ILayerPlugin).to(Bk).inRequestScope(),ac.bind(V.ILayerPlugin).to(w7).inRequestScope(),ac.bind(V.ILayerPlugin).to(A7).inRequestScope(),ac.bind(V.ILayerPlugin).to(g7).inRequestScope();var L7=ee(88307),O7=ee.n(L7),F7=function(){function e(i,t){(0,wt.Z)(this,e);var n=t.buffer,r=t.offset,o=t.stride,u=t.normalized,l=t.size,p=t.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:r||0,stride:o||0,normalized:u||!1,divisor:p||0},l&&(this.attribute.size=l)}return(0,zt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),_h,Cv,xh,Dc,Av,ep,Tv,Z0,Zf,Vp,Ou,Uf,Vf,U0,D7=(_h={},(0,W.Z)(_h,$.POINTS,"points"),(0,W.Z)(_h,$.LINES,"lines"),(0,W.Z)(_h,$.LINE_LOOP,"line loop"),(0,W.Z)(_h,$.LINE_STRIP,"line strip"),(0,W.Z)(_h,$.TRIANGLES,"triangles"),(0,W.Z)(_h,$.TRIANGLE_FAN,"triangle fan"),(0,W.Z)(_h,$.TRIANGLE_STRIP,"triangle strip"),_h),d2=(Cv={},(0,W.Z)(Cv,$.STATIC_DRAW,"static"),(0,W.Z)(Cv,$.DYNAMIC_DRAW,"dynamic"),(0,W.Z)(Cv,$.STREAM_DRAW,"stream"),Cv),gg=(xh={},(0,W.Z)(xh,$.BYTE,"int8"),(0,W.Z)(xh,$.UNSIGNED_INT,"int16"),(0,W.Z)(xh,$.INT,"int32"),(0,W.Z)(xh,$.UNSIGNED_BYTE,"uint8"),(0,W.Z)(xh,$.UNSIGNED_SHORT,"uint16"),(0,W.Z)(xh,$.UNSIGNED_INT,"uint32"),(0,W.Z)(xh,$.FLOAT,"float"),xh),B7=(Dc={},(0,W.Z)(Dc,$.ALPHA,"alpha"),(0,W.Z)(Dc,$.LUMINANCE,"luminance"),(0,W.Z)(Dc,$.LUMINANCE_ALPHA,"luminance alpha"),(0,W.Z)(Dc,$.RGB,"rgb"),(0,W.Z)(Dc,$.RGBA,"rgba"),(0,W.Z)(Dc,$.RGBA4,"rgba4"),(0,W.Z)(Dc,$.RGB5_A1,"rgb5 a1"),(0,W.Z)(Dc,$.RGB565,"rgb565"),(0,W.Z)(Dc,$.DEPTH_COMPONENT,"depth"),(0,W.Z)(Dc,$.DEPTH_STENCIL,"depth stencil"),Dc),N7=(Av={},(0,W.Z)(Av,$.DONT_CARE,"dont care"),(0,W.Z)(Av,$.NICEST,"nice"),(0,W.Z)(Av,$.FASTEST,"fast"),Av),v2=(ep={},(0,W.Z)(ep,$.NEAREST,"nearest"),(0,W.Z)(ep,$.LINEAR,"linear"),(0,W.Z)(ep,$.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,W.Z)(ep,$.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,W.Z)(ep,$.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,W.Z)(ep,$.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),ep),m2=(Tv={},(0,W.Z)(Tv,$.REPEAT,"repeat"),(0,W.Z)(Tv,$.CLAMP_TO_EDGE,"clamp"),(0,W.Z)(Tv,$.MIRRORED_REPEAT,"mirror"),Tv),z7=(Z0={},(0,W.Z)(Z0,$.NONE,"none"),(0,W.Z)(Z0,$.BROWSER_DEFAULT_WEBGL,"browser"),Z0),Z7=(Zf={},(0,W.Z)(Zf,$.NEVER,"never"),(0,W.Z)(Zf,$.ALWAYS,"always"),(0,W.Z)(Zf,$.LESS,"less"),(0,W.Z)(Zf,$.LEQUAL,"lequal"),(0,W.Z)(Zf,$.GREATER,"greater"),(0,W.Z)(Zf,$.GEQUAL,"gequal"),(0,W.Z)(Zf,$.EQUAL,"equal"),(0,W.Z)(Zf,$.NOTEQUAL,"notequal"),Zf),g2=(Vp={},(0,W.Z)(Vp,$.FUNC_ADD,"add"),(0,W.Z)(Vp,$.MIN_EXT,"min"),(0,W.Z)(Vp,$.MAX_EXT,"max"),(0,W.Z)(Vp,$.FUNC_SUBTRACT,"subtract"),(0,W.Z)(Vp,$.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Vp),V0=(Ou={},(0,W.Z)(Ou,$.ZERO,"zero"),(0,W.Z)(Ou,$.ONE,"one"),(0,W.Z)(Ou,$.SRC_COLOR,"src color"),(0,W.Z)(Ou,$.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,W.Z)(Ou,$.SRC_ALPHA,"src alpha"),(0,W.Z)(Ou,$.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,W.Z)(Ou,$.DST_COLOR,"dst color"),(0,W.Z)(Ou,$.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,W.Z)(Ou,$.DST_ALPHA,"dst alpha"),(0,W.Z)(Ou,$.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,W.Z)(Ou,$.CONSTANT_COLOR,"constant color"),(0,W.Z)(Ou,$.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,W.Z)(Ou,$.CONSTANT_ALPHA,"constant alpha"),(0,W.Z)(Ou,$.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,W.Z)(Ou,$.SRC_ALPHA_SATURATE,"src alpha saturate"),Ou),U7=(Uf={},(0,W.Z)(Uf,$.NEVER,"never"),(0,W.Z)(Uf,$.ALWAYS,"always"),(0,W.Z)(Uf,$.LESS,"less"),(0,W.Z)(Uf,$.LEQUAL,"lequal"),(0,W.Z)(Uf,$.GREATER,"greater"),(0,W.Z)(Uf,$.GEQUAL,"gequal"),(0,W.Z)(Uf,$.EQUAL,"equal"),(0,W.Z)(Uf,$.NOTEQUAL,"notequal"),Uf),Cd=(Vf={},(0,W.Z)(Vf,$.ZERO,"zero"),(0,W.Z)(Vf,$.KEEP,"keep"),(0,W.Z)(Vf,$.REPLACE,"replace"),(0,W.Z)(Vf,$.INVERT,"invert"),(0,W.Z)(Vf,$.INCR,"increment"),(0,W.Z)(Vf,$.DECR,"decrement"),(0,W.Z)(Vf,$.INCR_WRAP,"increment wrap"),(0,W.Z)(Vf,$.DECR_WRAP,"decrement wrap"),Vf),V7=(U0={},(0,W.Z)(U0,$.FRONT,"front"),(0,W.Z)(U0,$.BACK,"back"),U0),j7=function(){function e(i,t){(0,wt.Z)(this,e);var n=t.data,r=t.usage,o=t.type;this.buffer=i.buffer({data:n,usage:d2[r||$.STATIC_DRAW],type:gg[o||$.UNSIGNED_BYTE]})}return(0,zt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(t){var n=t.data,r=t.offset;this.buffer.subdata(n,r)}}]),e}(),G7=function(){function e(i,t){(0,wt.Z)(this,e);var n=t.data,r=t.usage,o=t.type,u=t.count;this.elements=i.elements({data:n,usage:d2[r||$.STATIC_DRAW],type:gg[o||$.UNSIGNED_BYTE],count:u})}return(0,zt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var n=t.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),H7=function(){function e(i,t){(0,wt.Z)(this,e);var n=t.width,r=t.height,o=t.color,u=t.colors,l={width:n,height:r};Array.isArray(u)&&(l.colors=u.map(function(p){return p.get()})),o&&typeof o!="boolean"&&(l.color=o.get()),this.framebuffer=i.framebuffer(l)}return(0,zt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var n=t.width,r=t.height;this.framebuffer.resize(n,r)}}]),e}(),W7=function(){function e(i,t){(0,wt.Z)(this,e),(0,W.Z)(this,"destroyed",!1),(0,W.Z)(this,"uniforms",{}),this.reGl=i;var n=t.pick,r=n===void 0?!0:n,o=t.vs,u=t.fs,l=t.attributes,p=t.uniforms,v=t.primitive,x=t.count,E=t.elements,A=t.depth,T=t.blend,L=t.stencil,F=t.cull,z=t.instances,H={};this.options=t,p&&(this.uniforms=this.extractUniforms(p),Object.keys(p).forEach(function(De){H[De]=i.prop(De)}));var ne={};Object.keys(l).forEach(function(De){ne[De]=l[De].get()});var oe={attributes:ne,frag:u,uniforms:H,vert:o,blend:{},primitive:D7[v===void 0?$.TRIANGLES:v]};if(z&&(oe.instances=z),x?oe.count=x:E&&(oe.elements=E.get()),this.initDepthDrawParams({depth:A},oe),this.initBlendDrawParams({blend:T},oe),this.initStencilDrawParams({stencil:L},oe),this.initCullDrawParams({cull:F},oe),this.drawCommand=i(oe),r){var ke=(0,ur.cloneDeep)(oe);ke.blend=(0,mt.Z)((0,mt.Z)({},ke.blend),{},{enable:!1}),this.drawPickCommand=i(ke)}this.drawParams=oe}return(0,zt.Z)(e,[{key:"updateAttributesAndElements",value:function(t,n){var r={};if(Object.keys(t).forEach(function(u){r[u]=t[u].get()}),this.drawParams.attributes=r,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams),this.options.pick){var o=(0,ur.cloneDeep)(this.drawParams);o.blend=(0,mt.Z)((0,mt.Z)({},o.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(o)}}},{key:"updateAttributes",value:function(t){var n={};if(Object.keys(t).forEach(function(o){n[o]=t[o].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams),this.options.pick){var r=(0,ur.cloneDeep)(this.drawParams);r.blend=(0,mt.Z)((0,mt.Z)({},r.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(r)}}},{key:"addUniforms",value:function(t){this.uniforms=(0,mt.Z)((0,mt.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var r=(0,mt.Z)((0,mt.Z)({},this.uniforms),this.extractUniforms(t.uniforms||{})),o={};Object.keys(r).forEach(function(u){var l=(0,gu.Z)(r[u]);l==="boolean"||l==="number"||Array.isArray(r[u])||r[u].BYTES_PER_ELEMENT?o[u]=r[u]:o[u]=r[u].get()}),n?this.drawPickCommand&&this.drawPickCommand(o):this.drawCommand(o)}}},{key:"destroy",value:function(){var t,n;(t=this.drawParams)===null||t===void 0||(n=t.elements)===null||n===void 0||n.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r==null||r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,n){var r=t.depth;r&&(n.depth={enable:r.enable===void 0?!0:!!r.enable,mask:r.mask===void 0?!0:!!r.mask,func:Z7[r.func||$.LESS],range:r.range||[0,1]})}},{key:"initBlendDrawParams",value:function(t,n){var r=t.blend;if(r){var o=r.enable,u=r.func,l=r.equation,p=r.color,v=p===void 0?[0,0,0,0]:p;n.blend={enable:!!o,func:{srcRGB:V0[u&&u.srcRGB||$.SRC_ALPHA],srcAlpha:V0[u&&u.srcAlpha||$.SRC_ALPHA],dstRGB:V0[u&&u.dstRGB||$.ONE_MINUS_SRC_ALPHA],dstAlpha:V0[u&&u.dstAlpha||$.ONE_MINUS_SRC_ALPHA]},equation:{rgb:g2[l&&l.rgb||$.FUNC_ADD],alpha:g2[l&&l.alpha||$.FUNC_ADD]},color:v}}}},{key:"initStencilDrawParams",value:function(t,n){var r=t.stencil;if(r){var o=r.enable,u=r.mask,l=u===void 0?-1:u,p=r.func,v=p===void 0?{cmp:$.ALWAYS,ref:0,mask:-1}:p,x=r.opFront,E=x===void 0?{fail:$.KEEP,zfail:$.KEEP,zpass:$.KEEP}:x,A=r.opBack,T=A===void 0?{fail:$.KEEP,zfail:$.KEEP,zpass:$.KEEP}:A;n.stencil={enable:!!o,mask:l,func:(0,mt.Z)((0,mt.Z)({},v),{},{cmp:U7[v.cmp]}),opFront:{fail:Cd[E.fail],zfail:Cd[E.zfail],zpass:Cd[E.zpass]},opBack:{fail:Cd[T.fail],zfail:Cd[T.zfail],zpass:Cd[T.zpass]}}}}},{key:"initCullDrawParams",value:function(t,n){var r=t.cull;if(r){var o=r.enable,u=r.face,l=u===void 0?$.BACK:u;n.cull={enable:!!o,face:V7[l]}}}},{key:"extractUniforms",value:function(t){var n=this,r={};return Object.keys(t).forEach(function(o){n.extractUniformsRecursively(o,t[o],r,"")}),r}},{key:"extractUniformsRecursively",value:function(t,n,r,o){var u=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||(0,ur.isTypedArray)(n)||n===""||"resize"in n){r["".concat(o&&o+".").concat(t)]=n;return}(0,ur.isPlainObject)(n)&&Object.keys(n).forEach(function(l){u.extractUniformsRecursively(l,n[l],r,"".concat(o&&o+".").concat(t))}),Array.isArray(n)&&n.forEach(function(l,p){Object.keys(l).forEach(function(v){u.extractUniformsRecursively(v,l[v],r,"".concat(o&&o+".").concat(t,"[").concat(p,"]"))})})}}]),e}(),X7=function(){function e(i,t){(0,wt.Z)(this,e),(0,W.Z)(this,"isDestroy",!1);var n=t.data,r=t.type,o=r===void 0?$.UNSIGNED_BYTE:r,u=t.width,l=t.height,p=t.flipY,v=p===void 0?!1:p,x=t.format,E=x===void 0?$.RGBA:x,A=t.mipmap,T=A===void 0?!1:A,L=t.wrapS,F=L===void 0?$.CLAMP_TO_EDGE:L,z=t.wrapT,H=z===void 0?$.CLAMP_TO_EDGE:z,ne=t.aniso,oe=ne===void 0?0:ne,ke=t.alignment,De=ke===void 0?1:ke,ft=t.premultiplyAlpha,At=ft===void 0?!1:ft,Nt=t.mag,Gt=Nt===void 0?$.NEAREST:Nt,xr=t.min,dr=xr===void 0?$.NEAREST:xr,zr=t.colorSpace,bn=zr===void 0?$.BROWSER_DEFAULT_WEBGL:zr,Wn=t.x,oa=Wn===void 0?0:Wn,Ma=t.y,Co=Ma===void 0?0:Ma,ko=t.copy,es=ko===void 0?!1:ko;this.width=u,this.height=l;var Ml={width:u,height:l,type:gg[o],format:B7[E],wrapS:m2[F],wrapT:m2[H],mag:v2[Gt],min:v2[dr],alignment:De,flipY:v,colorSpace:z7[bn],premultiplyAlpha:At,aniso:oe,x:oa,y:Co,copy:es};n&&(Ml.data=n),typeof T=="number"?Ml.mipmap=N7[T]:typeof T=="boolean"&&(Ml.mipmap=T),this.texture=i.texture(Ml)}return(0,zt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var n=t.width,r=t.height;this.texture.resize(n,r),this.width=n,this.height=r}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDestroy=!0}}]),e}(),y2,_2,$7=(y2=(0,B.b2)(),y2(_2=function(){function e(){var i=this;(0,wt.Z)(this,e),(0,W.Z)(this,"createModel",function(t){return new W7(i.gl,t)}),(0,W.Z)(this,"createAttribute",function(t){return new F7(i.gl,t)}),(0,W.Z)(this,"createBuffer",function(t){return new j7(i.gl,t)}),(0,W.Z)(this,"createElements",function(t){return new G7(i.gl,t)}),(0,W.Z)(this,"createTexture2D",function(t){return new X7(i.gl,t)}),(0,W.Z)(this,"createFramebuffer",function(t){return new H7(i.gl,t)}),(0,W.Z)(this,"useFramebuffer",function(t,n){i.gl({framebuffer:t?t.get():null})(n)}),(0,W.Z)(this,"clear",function(t){var n,r=t.color,o=t.depth,u=t.stencil,l=t.framebuffer,p=l===void 0?null:l,v={color:r,depth:o,stencil:u};v.framebuffer=p===null?p:p.get(),(n=i.gl)===null||n===void 0||n.clear(v)}),(0,W.Z)(this,"viewport",function(t){var n=t.x,r=t.y,o=t.width,u=t.height;i.gl._gl.viewport(n,r,o,u),i.width=o,i.height=u,i.gl._refresh()}),(0,W.Z)(this,"readPixels",function(t){var n=t.framebuffer,r=t.x,o=t.y,u=t.width,l=t.height,p={x:r,y:o,width:u,height:l};return n&&(p.framebuffer=n.get()),i.gl.read(p)}),(0,W.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,W.Z)(this,"getContainer",function(){if(jo)return i.canvas;var t;return(t=i.canvas)===null||t===void 0?void 0:t.parentElement}),(0,W.Z)(this,"getCanvas",function(){return i.canvas}),(0,W.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,W.Z)(this,"destroy",function(){var t,n,r;i.canvas=null,(t=i.gl)===null||t===void 0||(n=t._gl)===null||n===void 0||(r=n.getExtension("WEBGL_lose_context"))===null||r===void 0||r.loseContext(),i.gl.destroy(),i.gl=null})}return(0,zt.Z)(e,[{key:"init",value:function(){var i=(0,Wt.Z)(be().mark(function n(r,o,u){var l=this;return be().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.canvas=r,!u){v.next=5;break}this.gl=u,v.next=8;break;case 5:return v.next=7,new Promise(function(x,E){O7()({canvas:l.canvas,attributes:{alpha:!0,antialias:o.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:o.preserveDrawingBuffer,stencil:o.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(T,L){(T||!L)&&E(T),x(L)}})});case 7:this.gl=v.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return v.stop()}},n,this)}));function t(n,r,o){return i.apply(this,arguments)}return t}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||_2);function Y7(e){var i=q7();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function q7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yg=["selectstart","selecting","selectend"],K7=function(e){(0,Dr.Z)(t,e);var i=Y7(t);function t(n){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,wt.Z)(this,t),r=i.call(this),(0,W.Z)((0,He.Z)(r),"isEnable",!1),(0,W.Z)((0,He.Z)(r),"onDragStart",function(u){r.box.style.display="block",r.startEvent=r.endEvent=u,r.syncBoxBound(),r.emit("selectstart",r.getLngLatBox(),r.startEvent,r.endEvent)}),(0,W.Z)((0,He.Z)(r),"onDragging",function(u){r.endEvent=u,r.syncBoxBound(),r.emit("selecting",r.getLngLatBox(),r.startEvent,r.endEvent)}),(0,W.Z)((0,He.Z)(r),"onDragEnd",function(u){r.endEvent=u,r.box.style.display="none",r.emit("selectend",r.getLngLatBox(),r.startEvent,r.endEvent)}),r.scene=n,r.options=o,r}return(0,zt.Z)(t,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var r=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var o=ri("div",void 0,this.container);o.classList.add("l7-select-box"),r&&o.classList.add(r),o.style.display="none",this.box=o}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){!this.isEnable||(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var r=this.startEvent,o=r.x,u=r.y,l=this.endEvent,p=l.x,v=l.y,x=Math.min(o,p),E=Math.min(u,v),A=Math.abs(o-p),T=Math.abs(u-v);this.box.style.top="".concat(E,"px"),this.box.style.left="".concat(x,"px"),this.box.style.width="".concat(A,"px"),this.box.style.height="".concat(T,"px")}},{key:"getLngLatBox",value:function(){var r=this.startEvent.lngLat,o=r.lng,u=r.lat,l=this.endEvent.lngLat,p=l.lng,v=l.lat;return ni([[o,u],[p,v]])}}]),t}(Er.EventEmitter),Q7=function(){function e(i){(0,wt.Z)(this,e);var t=i.id,n=i.map,r=i.canvas,o=i.hasBaseMap,u=Nw();this.container=u,n.setContainer(u,t,r,o),u.bind(V.IRendererService).to($7).inSingletonScope(),this.sceneService=u.get(V.ISceneService),this.mapService=u.get(V.IMapService),this.iconService=u.get(V.IIconService),this.fontService=u.get(V.IFontService),this.controlService=u.get(V.IControlService),this.layerService=u.get(V.ILayerService),this.markerService=u.get(V.IMarkerService),this.interactionService=u.get(V.IInteractionService),this.popupService=u.get(V.IPopupService),this.boxSelect=new K7(this,{}),Ro((i==null?void 0:i.isMini)||!1),jo?this.sceneService.initMiniScene(i):(this.initComponent(t),this.sceneService.init(i),this.initControl())}return(0,zt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(){var i=(0,Wt.Z)(be().mark(function n(r){return be().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.sceneService.exportPng(r);case 2:return u.abrupt("return",u.sent);case 3:case"end":return u.stop()}},n,this)}));function t(n){return i.apply(this,arguments)}return t}()},{key:"exportMap",value:function(){var i=(0,Wt.Z)(be().mark(function n(r){return be().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.sceneService.exportPng(r);case 2:return u.abrupt("return",u.sent);case 3:case"end":return u.stop()}},n,this)}));function t(n){return i.apply(this,arguments)}return t}()},{key:"registerRenderService",value:function(t){var n=this;if(this.sceneService.loaded){var r=new t(this);r.init()}else this.on("loaded",function(){var o=new t(n);o.init()})}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var n=this,r=l0(this.container);if(t.setContainer(r,this.container),this.sceneService.addLayer(t),t.inited){var o=this.initMask(t);this.addMask(o,t.id)}else t.on("inited",function(){var u=n.initMask(t);n.addMask(u,t.id)})}},{key:"initMask",value:function(t){var n=t.getLayerConfig(),r=n.mask,o=n.maskfence,u=n.maskColor,l=u===void 0?"#000":u,p=n.maskOpacity,v=p===void 0?0:p;if(!(!r||!o)){var x=new qm().source(o).shape("fill").style({color:l,opacity:v});return x}}},{key:"addMask",value:function(t,n){if(!!t){var r=this.getLayer(n);if(r){var o=l0(this.container);t.setContainer(o,this.container),r.addMaskLayer(t),this.sceneService.addMask(t)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(){var i=(0,Wt.Z)(be().mark(function n(r,o){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.layerService.remove(r,o);case 2:case"end":return l.stop()}},n,this)}));function t(n,r){return i.apply(this,arguments)}return t}()},{key:"removeAllLayer",value:function(){var i=(0,Wt.Z)(be().mark(function n(){return be().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.layerService.removeAllLayers();case 2:case"end":return o.stop()}},n,this)}));function t(){return i.apply(this,arguments)}return t}()},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,n){this.fontService.addIconFont(t,n)}},{key:"addIconFonts",value:function(t){var n=this;t.forEach(function(r){var o=(0,$n.Z)(r,2),u=o[0],l=o[1];n.fontService.addIconFont(u,l)})}},{key:"addFontFace",value:function(t,n){var r=this;this.fontService.once("fontloaded",function(o){r.emit("fontloaded",o)}),this.fontService.addFontFace(t,n)}},{key:"addImage",value:function(){var i=(0,Wt.Z)(be().mark(function n(r,o){return be().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(jo){l.next=5;break}return l.next=3,this.iconService.addImage(r,o);case 3:l.next=6;break;case 5:this.iconService.addImageMini(r,o,this.sceneService);case 6:case"end":return l.stop()}},n,this)}));function t(n,r){return i.apply(this,arguments)}return t}()},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"removePopup",value:function(t){this.popupService.removePopup(t)}},{key:"on",value:function(t,n){if(yg.includes(t)){var r;(r=this.boxSelect)===null||r===void 0||r.on(t,n)}else f0.includes(t)?this.sceneService.on(t,n):this.mapService.on(t,n)}},{key:"once",value:function(t,n){if(yg.includes(t)){var r;(r=this.boxSelect)===null||r===void 0||r.once(t,n)}else f0.includes(t)?this.sceneService.once(t,n):this.mapService.once(t,n)}},{key:"emit",value:function(t,n){f0.indexOf(t)===-1?this.mapService.on(t,n):this.sceneService.emit(t,n)}},{key:"off",value:function(t,n){if(yg.includes(t)){var r;(r=this.boxSelect)===null||r===void 0||r.off(t,n)}else f0.includes(t)?this.sceneService.off(t,n):this.mapService.off(t,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,n){return this.mapService.setCenter(t,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,n){this.mapService.panBy(t,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,n){var r=this.sceneService.getSceneConfig(),o=r.fitBoundsOptions,u=r.animate;this.mapService.fitBounds(t,n||(0,mt.Z)((0,mt.Z)({},o),{},{animate:u}))}},{key:"setZoomAndCenter",value:function(t,n){this.mapService.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,n){this.container.bind(V.IPostProcessingPass).to(t).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var t=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.boxSelect.enable(),n&&this.boxSelect.once("selectend",function(){t.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:vn(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),n=t.logoVisible,r=t.logoPosition;n&&this.addControl(new u1({position:r}))}}]),e}(),DR="2.13.3";function Mv(e){return Mv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Mv(e)}function x2(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function BR(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?x2(Object(t),!0).forEach(function(n){J7(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):x2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function J7(e,i,t){return i=eI(i),i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function eI(e){var i=tI(e,"string");return Mv(i)==="symbol"?i:String(i)}function tI(e,i){if(Mv(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,i||"default");if(Mv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function NR(e,i){return aI(e)||iI(e,i)||nI(e,i)||rI()}function rI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nI(e,i){if(!!e){if(typeof e=="string")return b2(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return b2(e,i)}}function b2(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function iI(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,r,o,u,l=[],p=!0,v=!1;try{if(o=(t=t.call(e)).next,i===0){if(Object(t)!==t)return;p=!1}else for(;!(p=(n=o.call(t)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,r=x}finally{try{if(!p&&t.return!=null&&(u=t.return(),Object(u)!==u))return}finally{if(v)throw r}}return l}}function aI(e){if(Array.isArray(e))return e}var zR=null,ZR=null,E2,_g,S2,oI=(E2=Rm(V.IGlobalConfigService),_g=function(){function e(i){(0,wt.Z)(this,e),ia(this,"configService",S2,this),this.config=i}return(0,zt.Z)(e,[{key:"setContainer",value:function(t,n,r,o){t.bind(V.MapConfig).toConstantValue((0,mt.Z)((0,mt.Z)({},this.config),{},{id:n,canvas:r,hasBaseMap:o})),t.bind(V.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),S2=Qi(_g.prototype,"configService",[E2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_g),sI=ee(6158),kv=ee.n(sI),uI=function(){function e(i){(0,wt.Z)(this,e),(0,W.Z)(this,"size",1e4),this.size=i||1e4}return(0,zt.Z)(e,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){var n=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(t){var n=this.mercatorXfromLng(t[0]),r=this.mercatorYfromLat(t[1]);return[n,r]}},{key:"unproject",value:function(t){var n=this.lngFromMercatorX(t[0]),r=this.latFromMercatorY(t[1]);return[n,r]}}]),e}(),lI={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},w2,C2,A2,T2,M2,k2,Ad,I2,P2,R2,L2,O2={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},cI=12,fI=(w2=(0,B.b2)(),C2=(0,B.f3)(V.MapConfig),A2=(0,B.f3)(V.IGlobalConfigService),T2=(0,B.f3)(V.ICoordinateSystemService),M2=(0,B.f3)(V.IEventEmitter),w2(k2=(Ad=function(){function e(){var i=this;(0,wt.Z)(this,e),(0,W.Z)(this,"version",il.DEFUALT),(0,W.Z)(this,"simpleMapCoord",new uI),(0,W.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),ia(this,"config",I2,this),ia(this,"configService",P2,this),ia(this,"coordinateSystemService",R2,this),ia(this,"eventEmitter",L2,this),(0,W.Z)(this,"handleCameraChanged",function(t){var n=i.map.getCenter(),r=n.lat,o=n.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[o,r],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0}),i.updateCoordinateSystemService(),i.cameraChangedCallback(i.viewport)})}return(0,zt.Z)(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=ri("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(t,n){qw.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(O2[t]||t,n)}},{key:"off",value:function(t,n){this.map.off(O2[t]||t,n),this.eventEmitter.off(t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===il.SIMPLE)return this.simpleMapCoord.getSize();var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,n){this.map.zoomIn(t,n)}},{key:"zoomOut",value:function(t,n){this.map.zoomOut(t,n)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.panTo([t,n])}},{key:"fitBounds",value:function(t,n){this.map.fitBounds(t,n)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.dragEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,n){this.map.flyTo({zoom:t,center:n})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyleValue(t))}},{key:"meterToCoord",value:function(t,n){return 1}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"getMapStyle",value:function(){try{var t,n=(t=this.map.getStyle().sprite)!==null&&t!==void 0?t:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(n)?n==null?void 0:n.replace(/\/\w+$/,"").replace(/sprites/,"styles"):n}catch(r){return""}}},{key:"getMapStyleConfig",value:function(){return lI}},{key:"getMapStyleValue",value:function(t){var n;return(n=this.getMapStyleConfig()[t])!==null&&n!==void 0?n:t}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var n,r=arguments.length,o=new Array(r>1?r-1:0),u=1;u<r;u++)o[u-1]=arguments[u];(n=this.eventEmitter).emit.apply(n,[t].concat(o))}},{key:"once",value:function(t){for(var n,r=arguments.length,o=new Array(r>1?r-1:0),u=1;u<r;u++)o[u-1]=arguments[u];(n=this.eventEmitter).once.apply(n,[t].concat(o))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(t){var n=this.map.getCanvas(),r=t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return r}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatMapContainer",value:function(t){var n=t;return typeof t=="string"&&(n=document.getElementById(t)),n}},{key:"updateView",value:function(t){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var t=this.config.offsetCoordinate,n=t===void 0?!0:t;this.viewport.getZoom()>cI&&n?this.coordinateSystemService.setCoordinateSystem(Hh.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Hh.LNGLAT)}}]),e}(),I2=Qi(Ad.prototype,"config",[C2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P2=Qi(Ad.prototype,"configService",[A2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R2=Qi(Ad.prototype,"coordinateSystemService",[T2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L2=Qi(Ad.prototype,"eventEmitter",[M2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ad))||k2);function Iv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function j0(e,i){var t=Jd([],i,e);return e0(t,t,1/t[3]),t}function UR(e,i){var t=e%i;return t<0?i+t:t}function VR(e,i,t){return t*i+(1-t)*e}function jp(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var df=Math.PI,F2=df/4,bh=df/180,D2=180/df,xg=512,bg=4003e4,hI=1.5;function B2(e){return Math.pow(2,e)}function pI(e){return Math.log2(e)}function G0(e,i){var t=(0,$n.Z)(e,2),n=t[0],r=t[1];jp(Number.isFinite(n)&&Number.isFinite(i)),jp(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude"),i*=xg;var o=n*bh,u=r*bh,l=i*(o+df)/(2*df),p=i*(df-Math.log(Math.tan(F2+u*.5)))/(2*df);return[l,p]}function Eg(e,i){var t=(0,$n.Z)(e,2),n=t[0],r=t[1];i*=xg;var o=n/i*(2*df)-df,u=2*(Math.atan(Math.exp(df-r/i*(2*df)))-F2);return[o*D2,u*D2]}function jR(e){var i=e.latitude;assert(Number.isFinite(i));var t=Math.cos(i*bh);return pI(bg*t)-9}function N2(e){var i=e.latitude,t=e.longitude,n=e.zoom,r=e.scale,o=e.highPrecision,u=o===void 0?!1:o;r=r!==void 0?r:B2(n),jp(Number.isFinite(i)&&Number.isFinite(t)&&Number.isFinite(r));var l={},p=xg*r,v=Math.cos(i*bh),x=p/360,E=x/v,A=p/bg/v;if(l.pixelsPerMeter=[A,-A,A],l.metersPerPixel=[1/A,-1/A,1/A],l.pixelsPerDegree=[x,-E,A],l.degreesPerPixel=[1/x,-1/E,1/A],u){var T=bh*Math.tan(i*bh)/v,L=x*T/2,F=p/bg*T,z=F/E*A;l.pixelsPerDegree2=[0,-L,F],l.pixelsPerMeter2=[z,0,z]}return l}function GR(e,i){var t=_slicedToArray(e,3),n=t[0],r=t[1],o=t[2],u=_slicedToArray(i,3),l=u[0],p=u[1],v=u[2],x=1,E=N2({longitude:n,latitude:r,scale:x,highPrecision:!0}),A=E.pixelsPerMeter,T=E.pixelsPerMeter2,L=G0(e,x);L[0]+=l*(A[0]+T[0]*p),L[1]+=p*(A[1]+T[1]*p);var F=Eg(L,x),z=(o||0)+(v||0);return Number.isFinite(o)||Number.isFinite(v)?[F[0],F[1],z]:F}function dI(e){var i=e.height,t=e.pitch,n=e.bearing,r=e.altitude,o=e.center,u=o===void 0?null:o,l=e.flipY,p=l===void 0?!1:l,v=Iv();return tc(v,v,[0,0,-r]),Lc(v,v,[1,1,1/i]),sf(v,v,-t*bh),Bf(v,v,n*bh),p&&Lc(v,v,[1,-1,1]),u&&tc(v,v,so.negate([],u)),v}function vI(e){var i=e.width,t=e.height,n=e.altitude,r=n===void 0?hI:n,o=e.pitch,u=o===void 0?0:o,l=e.nearZMultiplier,p=l===void 0?1:l,v=e.farZMultiplier,x=v===void 0?1:v,E=u*bh,A=Math.atan(.5/r),T=Math.sin(A)*r/Math.sin(Math.PI/2-E-A),L=Math.cos(Math.PI/2-E)*T+r;return{fov:2*Math.atan(t/2/r),aspect:i/t,focalDistance:r,near:p,far:L*x}}function mI(e){var i=e.width,t=e.height,n=e.pitch,r=e.altitude,o=e.nearZMultiplier,u=e.farZMultiplier,l=vI({width:i,height:t,altitude:r,pitch:n,nearZMultiplier:o,farZMultiplier:u}),p=l.fov,v=l.aspect,x=l.near,E=l.far,A=Sp([],p,v,x,E);return A}function gI(e,i){var t=(0,$n.Z)(e,3),n=t[0],r=t[1],o=t[2],u=o===void 0?0:o;return jp(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(u)),j0(i,[n,r,u,1])}function z2(e,i){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,$n.Z)(e,3),r=n[0],o=n[1],u=n[2];if(jp(Number.isFinite(r)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(u)){var l=j0(i,[r,o,u,1]);return l}var p=j0(i,[r,o,0,1]),v=j0(i,[r,o,1,1]),x=p[2],E=v[2],A=x===E?0:((t||0)-x)/(E-x);return Xr.lerp([],p,v,A)}var Z2=Iv(),yI=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=i.width,n=i.height,r=i.viewMatrix,o=r===void 0?Z2:r,u=i.projectionMatrix,l=u===void 0?Z2:u;(0,wt.Z)(this,e),this.width=t||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=l;var p=Iv();Pu(p,p,this.projectionMatrix),Pu(p,p,this.viewMatrix),this.viewProjectionMatrix=p;var v=Iv();Lc(v,v,[this.width/2,-this.height/2,1]),tc(v,v,[1,-1,0]),Pu(v,v,this.viewProjectionMatrix);var x=wo(Iv(),v);if(!x)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=v,this.pixelUnprojectionMatrix=x,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,zt.Z)(e,[{key:"equals",value:function(t){return t instanceof e?t.width===this.width&&t.height===this.height&&Mo(t.projectionMatrix,this.projectionMatrix)&&Mo(t.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=n.topLeft,o=r===void 0?!0:r,u=this.projectPosition(t),l=gI(u,this.pixelProjectionMatrix),p=(0,$n.Z)(l,2),v=p[0],x=p[1],E=o?x:this.height-x;return t.length===2?[v,E]:[v,E,l[2]]}},{key:"unproject",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=n.topLeft,o=r===void 0?!0:r,u=n.targetZ,l=(0,$n.Z)(t,3),p=l[0],v=l[1],x=l[2],E=o?v:this.height-v,A=u&&u*this.pixelsPerMeter,T=z2([p,E,x],this.pixelUnprojectionMatrix,A),L=this.unprojectPosition(T),F=(0,$n.Z)(L,3),z=F[0],H=F[1],ne=F[2];return Number.isFinite(x)?[z,H,ne]:Number.isFinite(u)?[z,H,u]:[z,H]}},{key:"projectPosition",value:function(t){var n=this.projectFlat(t),r=(0,$n.Z)(n,2),o=r[0],u=r[1],l=(t[2]||0)*this.pixelsPerMeter;return[o,u,l]}},{key:"unprojectPosition",value:function(t){var n=this.unprojectFlat(t),r=(0,$n.Z)(n,2),o=r[0],u=r[1],l=(t[2]||0)/this.pixelsPerMeter;return[o,u,l]}},{key:"projectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}}]),e}();function _I(e){var i=e.width,t=e.height,n=e.bounds,r=e.minExtent,o=r===void 0?0:r,u=e.maxZoom,l=u===void 0?24:u,p=e.padding,v=p===void 0?0:p,x=e.offset,E=x===void 0?[0,0]:x,A=(0,$n.Z)(n,2),T=(0,$n.Z)(A[0],2),L=T[0],F=T[1],z=(0,$n.Z)(A[1],2),H=z[0],ne=z[1];if(Number.isFinite(v)){var oe=v;v={top:oe,bottom:oe,left:oe,right:oe}}else jp(Number.isFinite(v.top)&&Number.isFinite(v.bottom)&&Number.isFinite(v.left)&&Number.isFinite(v.right));var ke=new U2({width:i,height:t,longitude:0,latitude:0,zoom:0}),De=ke.project([L,ne]),ft=ke.project([H,F]),At=[Math.max(Math.abs(ft[0]-De[0]),o),Math.max(Math.abs(ft[1]-De[1]),o)],Nt=[i-v.left-v.right-Math.abs(E[0])*2,t-v.top-v.bottom-Math.abs(E[1])*2];jp(Nt[0]>0&&Nt[1]>0);var Gt=Nt[0]/At[0],xr=Nt[1]/At[1],dr=(v.right-v.left)/2/Gt,zr=(v.bottom-v.top)/2/xr,bn=[(ft[0]+De[0])/2+dr,(ft[1]+De[1])/2+zr],Wn=ke.unproject(bn),oa=ke.zoom+Math.log2(Math.abs(Math.min(Gt,xr)));return{longitude:Wn[0],latitude:Wn[1],zoom:Math.min(oa,l)}}var U2=function(e){(0,Dr.Z)(i,e);function i(){var t,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.width,o=n.height,u=n.latitude,l=u===void 0?0:u,p=n.longitude,v=p===void 0?0:p,x=n.zoom,E=x===void 0?0:x,A=n.pitch,T=A===void 0?0:A,L=n.bearing,F=L===void 0?0:L,z=n.altitude,H=z===void 0?1.5:z,ne=n.nearZMultiplier,oe=n.farZMultiplier;(0,wt.Z)(this,i),r=r||1,o=o||1;var ke=B2(E);H=Math.max(.75,H);var De=G0([v,l],ke);De[2]=0;var ft=mI({width:r,height:o,pitch:T,bearing:F,altitude:H,nearZMultiplier:ne||1/o,farZMultiplier:oe||1.01}),At=dI({height:o,center:De,pitch:T,bearing:F,altitude:H,flipY:!0});return t=(0,Rr.Z)(this,(0,Qe.Z)(i).call(this,{width:r,height:o,viewMatrix:At,projectionMatrix:ft})),t.latitude=l,t.longitude=v,t.zoom=E,t.pitch=T,t.bearing=F,t.altitude=H,t.scale=ke,t.center=De,t.pixelsPerMeter=N2((0,He.Z)((0,He.Z)(t))).pixelsPerMeter[2],Object.freeze((0,He.Z)((0,He.Z)(t))),t}return(0,zt.Z)(i,[{key:"projectFlat",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return G0(n,r)}},{key:"unprojectFlat",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Eg(n,r)}},{key:"getMapCenterByLngLatPosition",value:function(n){var r=n.lngLat,o=n.pos,u=z2(o,this.pixelUnprojectionMatrix),l=G0(r,this.scale),p=Xr.add([],l,Xr.negate([],u)),v=Xr.add([],this.center,p);return Eg(v,this.scale)}},{key:"getLocationAtPoint",value:function(n){var r=n.lngLat,o=n.pos;return this.getMapCenterByLngLatPosition({lngLat:r,pos:o})}},{key:"fitBounds",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,u=this.height,l=_I(Object.assign({width:o,height:u,bounds:n},r)),p=l.longitude,v=l.latitude,x=l.zoom;return new i({width:o,height:u,longitude:p,latitude:v,zoom:x})}}]),i}(yI),xI=function(){function e(){(0,wt.Z)(this,e)}return(0,zt.Z)(e,[{key:"syncWithMapCamera",value:function(t){var n=t.center,r=t.zoom,o=t.pitch,u=t.bearing,l=t.viewportHeight,p=t.viewportWidth;this.viewport=new U2({width:p,height:l,longitude:n&&n[0],latitude:n&&n[1],zoom:r,pitch:o,bearing:u})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}}]),e}(),bI=["id","attributionControl","style","token","rotation","mapInstance"],V2,j2;function EI(e){var i=SI();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function SI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function wI(e,i){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(i||(i=document),!!i)){var r=i.head||i.getElementsByTagName("head")[0];if(!r){r=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(r,o):i.documentElement.appendChild(r)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),r.appendChild(u),u}}wI(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=kv();var CI=0,G2="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",AI=(V2=(0,B.b2)(),V2(j2=function(e){(0,Dr.Z)(t,e);var i=EI(t);function t(){var n;(0,wt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),(0,W.Z)((0,He.Z)(n),"version",il.MAPBOX),n}return(0,zt.Z)(t,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},u=this.lngLatToMercator(r,0),l=u.x,p=u.y;return[l-o.x,p-o.y]}},{key:"lngLatToMercator",value:function(r,o){var u=window.mapboxgl.MercatorCoordinate.fromLngLat(r,o),l=u.x,p=l===void 0?0:l,v=u.y,x=v===void 0?0:v,E=u.z,A=E===void 0?0:E;return{x:p,y:x,z:A}}},{key:"getModelMatrix",value:function(r,o,u){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(r,o),x=v.meterInMercatorCoordinateUnits(),E=Oa();return tc(E,E,so.fromValues(v.x-p.x,v.y-p.y,v.z||0-p.z)),Lc(E,E,so.fromValues(x*l[0],-x*l[1],x*l[2])),sf(E,E,u[0]),Bh(E,E,u[1]),Bf(E,E,u[2]),E}},{key:"init",value:function(){var n=(0,Wt.Z)(be().mark(function o(){var u=this,l,p,v,x,E,A,T,L,F,z,H,ne,oe;return be().wrap(function(De){for(;;)switch(De.prev=De.next){case 0:l=this.config,p=l.id,v=p===void 0?"map":p,x=l.attributionControl,E=x===void 0?!1:x,A=l.style,T=A===void 0?"light":A,L=l.token,F=L===void 0?G2:L,z=l.rotation,H=z===void 0?0:z,ne=l.mapInstance,oe=(0,C.Z)(l,bI),this.viewport=new xI,!ne&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),F===G2&&T!=="blank"&&!window.mapboxgl.accessToken&&!ne&&console.warn(this.configService.getSceneWarninfo("MapToken")),!ne&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=F),ne?(this.map=ne,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(v),this.map=new window.mapboxgl.Map((0,mt.Z)({container:this.$mapContainer,style:this.getMapStyleValue(T),attributionControl:E,bearing:H},oe))),this.map.on("load",function(){u.handleCameraChanged()}),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return De.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,o;(r=this.$mapContainer)===null||r===void 0||(o=r.parentNode)===null||o===void 0||o.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var o,u=arguments.length,l=new Array(u>1?u-1:0),p=1;p<u;p++)l[p-1]=arguments[p];(o=this.eventEmitter).emit.apply(o,[r].concat(l))}},{key:"once",value:function(r){for(var o,u=arguments.length,l=new Array(u>1?u-1:0),p=1;p<u;p++)l[p-1]=arguments[p];(o=this.eventEmitter).once.apply(o,[r].concat(l))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,o){var u=new(kv()).LngLat(r[0],r[1]),l=new(kv()).LngLat(o[0],o[1]),p=u.distanceTo(l),v=kv().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),x=kv().MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]}),E=v.x,A=v.y,T=x.x,L=x.y,F=Math.sqrt(Math.pow(E-T,2)+Math.pow(A-L,2))*4194304*2;return F/p}},{key:"exportMap",value:function(r){var o=this.map.getCanvas(),u=r==="jpg"?o==null?void 0:o.toDataURL("image/jpeg"):o==null?void 0:o.toDataURL("image/png");return u}},{key:"creatMapContainer",value:function(r){var o=r;typeof r=="string"&&(o=document.getElementById(r));var u=document.createElement("div");return u.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,u.id="l7_mapbox_div"+CI++,o.appendChild(u),u}}]),t}(fI))||j2);function TI(e){var i=MI();return function(){var n=(0,Qe.Z)(e),r;if(i){var o=(0,Qe.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Rr.Z)(this,r)}}function MI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function kI(e,i){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(i||(i=document),!!i)){var r=i.head||i.getElementsByTagName("head")[0];if(!r){r=i.createElement("head");var o=i.body||i.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(r,o):i.documentElement.appendChild(r)}var u=i.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(i.createTextNode(e)),r.appendChild(u),u}}kI(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var II=function(e){(0,Dr.Z)(t,e);var i=TI(t);function t(){return(0,wt.Z)(this,t),i.apply(this,arguments)}return(0,zt.Z)(t,[{key:"getServiceConstructor",value:function(){return AI}}]),t}(oI);function Pv(e){return Pv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Pv(e)}function H2(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function W2(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?H2(Object(t),!0).forEach(function(n){PI(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):H2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function PI(e,i,t){return i=RI(i),i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function RI(e){var i=LI(e,"string");return Pv(i)==="symbol"?i:String(i)}function LI(e,i){if(Pv(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,i||"default");if(Pv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function OI(e,i){return NI(e)||BI(e,i)||DI(e,i)||FI()}function FI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DI(e,i){if(!!e){if(typeof e=="string")return X2(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return X2(e,i)}}function X2(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function BI(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,r,o,u,l=[],p=!0,v=!1;try{if(o=(t=t.call(e)).next,i===0){if(Object(t)!==t)return;p=!1}else for(;!(p=(n=o.call(t)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,r=x}finally{try{if(!p&&t.return!=null&&(u=t.return(),Object(u)!==u))return}finally{if(v)throw r}}return l}}function NI(e){if(Array.isArray(e))return e}var zI=Et.memo(function(e){var i=e.style,t=e.className,n=e.map,r=e.option,o=e.onSceneLoaded,u=(0,Et.createRef)(),l=(0,Et.useState)(),p=OI(l,2),v=p[0],x=p[1];return(0,Et.useEffect)(function(){var E=new Q7(W2(W2({id:u.current},r),{},{map:new II(n)}));return E.on("loaded",function(){x(E),o&&o(E)}),function(){E.destroy()}},[]),(0,Et.useEffect)(function(){v&&n.style&&v.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,Et.useEffect)(function(){v&&n.zoom&&v.setZoom(n.zoom)},[n.zoom]),(0,Et.useEffect)(function(){v&&n.center&&v.setCenter(n.center)},[JSON.stringify(n.center)]),(0,Et.useEffect)(function(){v&&n.pitch!==void 0&&v.setPitch(n.pitch||0)},[n.pitch]),(0,Et.useEffect)(function(){v&&n.rotation&&v.setRotation(n.rotation)},[n.rotation]),Et.createElement(Ct.Provider,{value:v},(0,Et.createElement)("div",{ref:u,style:i,className:t},v&&e.children))}),ZI=zI;function Rv(e){return Rv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Rv(e)}function $2(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function HR(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?$2(Object(t),!0).forEach(function(n){UI(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):$2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function UI(e,i,t){return i=VI(i),i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function VI(e){var i=jI(e,"string");return Rv(i)==="symbol"?i:String(i)}function jI(e,i){if(Rv(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,i||"default");if(Rv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function WR(e,i){return XI(e)||WI(e,i)||HI(e,i)||GI()}function GI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function HI(e,i){if(!!e){if(typeof e=="string")return Y2(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Y2(e,i)}}function Y2(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function WI(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,r,o,u,l=[],p=!0,v=!1;try{if(o=(t=t.call(e)).next,i===0){if(Object(t)!==t)return;p=!1}else for(;!(p=(n=o.call(t)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,r=x}finally{try{if(!p&&t.return!=null&&(u=t.return(),Object(u)!==u))return}finally{if(v)throw r}}return l}}function XI(e){if(Array.isArray(e))return e}var XR=null,$R=null;function Lv(e){return Lv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Lv(e)}function q2(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function YR(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?q2(Object(t),!0).forEach(function(n){$I(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):q2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function $I(e,i,t){return i=YI(i),i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function YI(e){var i=qI(e,"string");return Lv(i)==="symbol"?i:String(i)}function qI(e,i){if(Lv(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,i||"default");if(Lv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function qR(e,i){return eP(e)||JI(e,i)||QI(e,i)||KI()}function KI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function QI(e,i){if(!!e){if(typeof e=="string")return K2(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return K2(e,i)}}function K2(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function JI(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,r,o,u,l=[],p=!0,v=!1;try{if(o=(t=t.call(e)).next,i===0){if(Object(t)!==t)return;p=!1}else for(;!(p=(n=o.call(t)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,r=x}finally{try{if(!p&&t.return!=null&&(u=t.return(),Object(u)!==u))return}finally{if(v)throw r}}return l}}function eP(e){if(Array.isArray(e))return e}var KR=null,QR=null;function Ov(e){return Ov=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Ov(e)}function Q2(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function JR(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?Q2(Object(t),!0).forEach(function(n){tP(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Q2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function tP(e,i,t){return i=rP(i),i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function rP(e){var i=nP(e,"string");return Ov(i)==="symbol"?i:String(i)}function nP(e,i){if(Ov(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,i||"default");if(Ov(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function eL(e,i){return sP(e)||oP(e,i)||aP(e,i)||iP()}function iP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aP(e,i){if(!!e){if(typeof e=="string")return J2(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return J2(e,i)}}function J2(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function oP(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,r,o,u,l=[],p=!0,v=!1;try{if(o=(t=t.call(e)).next,i===0){if(Object(t)!==t)return;p=!1}else for(;!(p=(n=o.call(t)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,r=x}finally{try{if(!p&&t.return!=null&&(u=t.return(),Object(u)!==u))return}finally{if(v)throw r}}return l}}function sP(e){if(Array.isArray(e))return e}var tL=null,rL=null;function nL(e,i){return fP(e)||cP(e,i)||lP(e,i)||uP()}function uP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lP(e,i){if(!!e){if(typeof e=="string")return eE(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return eE(e,i)}}function eE(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function cP(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,r,o,u,l=[],p=!0,v=!1;try{if(o=(t=t.call(e)).next,i===0){if(Object(t)!==t)return;p=!1}else for(;!(p=(n=o.call(t)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,r=x}finally{try{if(!p&&t.return!=null&&(u=t.return(),Object(u)!==u))return}finally{if(v)throw r}}return l}}function fP(e){if(Array.isArray(e))return e}var iL=null;function Fv(e){return Fv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Fv(e)}var aL=null;function tE(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function oL(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?tE(Object(t),!0).forEach(function(n){hP(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):tE(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function hP(e,i,t){return i=pP(i),i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function pP(e){var i=dP(e,"string");return Fv(i)==="symbol"?i:String(i)}function dP(e,i){if(Fv(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,i||"default");if(Fv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function sL(e,i){if(e==null)return{};var t=vP(e,i),n,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(t[n]=e[n]))}return t}function vP(e,i){if(e==null)return{};var t={},n=Object.keys(e),r,o;for(o=0;o<n.length;o++)r=n[o],!(i.indexOf(r)>=0)&&(t[r]=e[r]);return t}var uL={exportImage:aA,fullscreen:rA,geoLocate:uA,layer:p1,layerSwitch:p1,logo:u1,mapTheme:pA,mouseLocation:yA,zoom:bA,scale:wA},lL=null,rE=ee(73935);function nE(e,i){return _P(e)||yP(e,i)||gP(e,i)||mP()}function mP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gP(e,i){if(!!e){if(typeof e=="string")return iE(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return iE(e,i)}}function iE(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function yP(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,r,o,u,l=[],p=!0,v=!1;try{if(o=(t=t.call(e)).next,i===0){if(Object(t)!==t)return;p=!1}else for(;!(p=(n=o.call(t)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,r=x}finally{try{if(!p&&t.return!=null&&(u=t.return(),Object(u)!==u))return}finally{if(v)throw r}}return l}}function _P(e){if(Array.isArray(e))return e}var aE=Et.useEffect,oE=Et.useState,xP=/\B([A-Z])/g,bP=function(i){return i.replace(xP,"-$1").toLowerCase()};function cL(e){var i=e.className,t=e.style,n=e.children,r=e.position,o=oE(),u=nE(o,2),l=u[0],p=u[1],v=useSceneValue(),x=oE(function(){return document.createElement("div")}),E=nE(x,1),A=E[0];return aE(function(){var T=new Control({position:r});return T.onAdd=function(){if(i&&(A.className=i),t){var L=Object.keys(t).map(function(F){return"".concat(bP(F),":").concat(t[F])}).join(";");A.style.cssText=L}return A},T.onRemove=function(){},p(T),v.addControl(T),function(){v.removeControl(T)}},[]),aE(function(){l&&l.setPosition(r||"bottomleft")},[r]),createPortal(n,A)}var sE=(0,Et.createContext)({});function fL(){return useContext(sE)}var EP=ee(60442),jf=ee.n(EP),SP=Et.memo(function(i){var t=i.layer,n=i.active;return t.active(n.option),null},jf()),wP=Et.memo(function(i){var t=i.layer,n=i.animate;return t.animate(n),null},jf()),CP=Et.memo(function(i){var t=i.layer,n=i.color;return n.field?t.color(n.field,n.values):t.color(n.values),null},jf()),AP=Et.memo(function(i){var t=i.layer,n=i.filter;return n.field&&t.filter(n.field,n.values),null},jf()),TP=Et.memo(function(i){var t=i.layer,n=i.scale;return t.scale(n.values),null},jf()),MP=Et.memo(function(i){var t=i.layer,n=i.select;return t.select(n.option),null},jf()),kP=Et.memo(function(i){var t=i.layer,n=i.shape;return n.field?t.shape(n.field,n.values):t.shape(n.values),null},jf()),IP=Et.memo(function(i){var t=i.layer,n=i.size;return n.field?t.size(n.field,n.values):t.size(n.values),null},jf()),PP=["data"];function RP(e,i){if(e==null)return{};var t=LP(e,i),n,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(t[n]=e[n]))}return t}function LP(e,i){if(e==null)return{};var t={},n=Object.keys(e),r,o;for(o=0;o<n.length;o++)r=n[o],!(i.indexOf(r)>=0)&&(t[r]=e[r]);return t}var OP=Et.memo(function(i){var t=i.layer,n=i.source,r=n.data,o=RP(n,PP);return t.inited?t.setData(r,o):t.source(r,o),o.autoFit&&t.fitBounds(o&&o.fitBoundsOptions),null},jf()),hL=Et.useEffect,FP=Et.memo(function(i){var t=i.layer,n=i.style;return t.style(n),null},jf());function DP(e,i){return ZP(e)||zP(e,i)||NP(e,i)||BP()}function BP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function NP(e,i){if(!!e){if(typeof e=="string")return uE(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return uE(e,i)}}function uE(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=e[t];return n}function zP(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,r,o,u,l=[],p=!0,v=!1;try{if(o=(t=t.call(e)).next,i===0){if(Object(t)!==t)return;p=!1}else for(;!(p=(n=o.call(t)).done)&&(l.push(n.value),l.length!==i);p=!0);}catch(x){v=!0,r=x}finally{try{if(!p&&t.return!=null&&(u=t.return(),Object(u)!==u))return}finally{if(v)throw r}}return l}}function ZP(e){if(Array.isArray(e))return e}var Dv=Et.useEffect,UP=Et.useState;function lE(e,i){var t=i.source,n=i.color,r=i.shape,o=i.style,u=i.size,l=i.scale,p=i.active,v=i.select,x=i.filter,E=i.animate,A=i.options,T=i.onLayerLoaded,L=pt(),F=UP(function(){var ne;switch(e){case"polygonLayer":ne=new Ym(A);break;case"lineLayer":ne=new Xm(A);break;case"pointLayer":ne=new x0(A);break;case"heatmapLayer":ne=new H3(A);break;case"rasterLayer":ne=new b0(A);break;case"imageLayer":ne=new Z1(A);break;case"citybuildingLayer":ne=new m3(A);break;default:ne=new Ym(A)}return ne.on("inited",function(){T&&T(ne,L)}),ne}),z=DP(F,1),H=z[0];return Dv(function(){return L.addLayer(H),function(){L.removeLayer(H)}},[]),Dv(function(){H.inited&&A&&H.updateLayerConfig(A)},[A==null?void 0:A.minZoom,A==null?void 0:A.maxZoom,A==null?void 0:A.visible]),Dv(function(){H.inited&&(A==null?void 0:A.zIndex)&&H.setIndex(A.zIndex)},[A==null?void 0:A.zIndex]),Dv(function(){H.inited&&(A==null?void 0:A.blend)&&H.setBlend(A.blend)},[A==null?void 0:A.blend]),Dv(function(){L.render()}),Et.createElement(sE.Provider,{value:H},Et.createElement(OP,{layer:H,source:t}),l&&Et.createElement(TP,{layer:H,scale:l}),n&&Et.createElement(CP,{layer:H,color:n}),u&&Et.createElement(IP,{layer:H,size:u}),r&&Et.createElement(kP,{layer:H,shape:r}),o&&Et.createElement(FP,{layer:H,style:o}),p&&Et.createElement(SP,{layer:H,active:p}),v&&Et.createElement(MP,{layer:H,select:v}),x&&Et.createElement(AP,{layer:H,filter:x}),E&&Et.createElement(wP,{layer:H,animate:E}),i.children)}var pL=null,dL=null,cE=Et.memo(function(i){return lE("pointLayer",i)}),VP=Et.memo(function(i){return lE("heatmapLayer",i)}),vL=null,mL=null,gL=null,yL=Et.useEffect,_L=null,xL=null;function Td(e){return Td=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Td(e)}function fE(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function H0(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?fE(Object(t),!0).forEach(function(n){jP(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):fE(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function jP(e,i,t){return i=pE(i),i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function GP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function hE(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,pE(n.key),n)}}function HP(e,i,t){return i&&hE(e.prototype,i),t&&hE(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function pE(e){var i=WP(e,"string");return Td(i)==="symbol"?i:String(i)}function WP(e,i){if(Td(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,i||"default");if(Td(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function XP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Sg(e,i)}function Sg(e,i){return Sg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},Sg(e,i)}function $P(e){var i=KP();return function(){var n=W0(e),r;if(i){var o=W0(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return YP(this,r)}}function YP(e,i){if(i&&(Td(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return qP(e)}function qP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function KP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function W0(e){return W0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},W0(e)}var bL=function(e){XP(t,e);var i=$P(t);function t(n){var r;return GP(this,t),r=i.call(this,n),r.el=void 0,r.scene=void 0,r.popup=void 0,r.el=document.createElement("div"),r}return HP(t,[{key:"componentDidMount",value:function(){var r,o=this.props,u=o.lnglat,l=o.children,p=o.option,v=o.lngLat,x=new Bm(H0(H0({},p),{},{stopPropagation:(r=this.props.option)===null||r===void 0?void 0:r.stopPropagation}));u&&x.setLnglat(u),v&&x.setLnglat(v),l&&x.setHTML(this.el),this.popup=x,this.scene.addPopup(x)}},{key:"componentDidUpdate",value:function(r){var o,u,l,p,v,x,E=Array.isArray(r.lnglat)?r.lnglat:[r==null||(o=r.lnglat)===null||o===void 0?void 0:o.lng,r==null||(u=r.lnglat)===null||u===void 0?void 0:u.lat],A=Array.isArray(this.props.lnglat)?this.props.lnglat:[(l=this.props)===null||l===void 0||(p=l.lnglat)===null||p===void 0?void 0:p.lng,(v=this.props)===null||v===void 0||(x=v.lnglat)===null||x===void 0?void 0:x.lat],T=E.toString()!==A.toString();if(T){var L;this.popup.remove(),this.popup=new Bm(H0(H0({},this.props.option),{},{stopPropagation:(L=this.props.option)===null||L===void 0?void 0:L.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setHTML(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var r=this;return Et.createElement(Ct.Consumer,{},function(o){return o&&(r.scene=o),(0,rE.createPortal)(r.props.children,r.el)})}}]),t}(Et.PureComponent);function Md(e){return Md=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Md(e)}function QP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function dE(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,e8(n.key),n)}}function JP(e,i,t){return i&&dE(e.prototype,i),t&&dE(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function e8(e){var i=t8(e,"string");return Md(i)==="symbol"?i:String(i)}function t8(e,i){if(Md(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,i||"default");if(Md(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function r8(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&wg(e,i)}function wg(e,i){return wg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},wg(e,i)}function n8(e){var i=o8();return function(){var n=X0(e),r;if(i){var o=X0(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return i8(this,r)}}function i8(e,i){if(i&&(Md(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return a8(e)}function a8(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o8(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function X0(e){return X0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},X0(e)}var EL=function(e){r8(t,e);var i=n8(t);function t(n){var r;return QP(this,t),r=i.call(this,n),r.el=void 0,r.scene=void 0,r.marker=void 0,r.el=document.createElement("div"),r}return JP(t,[{key:"componentDidMount",value:function(){var r=this.props,o=r.lnglat,u=r.children,l=r.option,p=r.onMarkerLoaded,v=new a1(l);o&&v.setLnglat(o),u&&v.setElement(this.el),this.marker=v,p&&p(v),this.scene.addMarker(v)}},{key:"componentDidUpdate",value:function(r){var o,u=JSON.stringify(r==null?void 0:r.lnglat)!==JSON.stringify((o=this.props)===null||o===void 0?void 0:o.lnglat);u&&this.props.lnglat&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var r=this;return Et.createElement(Ct.Consumer,{},function(o){return o&&(r.scene=o),(0,rE.createPortal)(r.props.children,r.el)})}}]),t}(Et.PureComponent),SL=Et.useEffect,wL=null,CL=null,AL=Et.useEffect,TL=null,s8=ee(83832),ki=ee(85893),u8=["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],l8=function(e){(0,br.Z)(t,e);var i=(0,J.Z)(t);function t(){var n;(0,It.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),n.state={data:null,grid:null,loading:!1},n}return(0,Zt.Z)(t,[{key:"componentDidMount",value:function(){var n=(0,qt.Z)((0,Ft.Z)().mark(function o(){var u,l,p,v;return(0,Ft.Z)().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,Promise.all([fetch("https://gw.alipayobjects.com/os/bmw-prod/c5dba875-b6ea-4e88-b778-66a862906c93.json").then(function(A){return A.json()}),fetch("https://gw.alipayobjects.com/os/bmw-prod/8990e8b4-c58e-419b-afb9-8ea3daff2dd1.json").then(function(A){return A.json()})]);case 2:u=E.sent,l=(0,gr.Z)(u,2),p=l[0],v=l[1],this.setState({data:p,grid:v,loading:!0});case 7:case"end":return E.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"render",value:function(){var r=this.state,o=r.data,u=r.grid,l=r.loading;return l===!1?(0,ki.jsx)(s8.Z,{}):(0,ki.jsxs)(ZI,{map:{center:[110.19382669582967,50.258134],pitch:0,style:"blank",zoom:1},style:{position:"relative",width:"100%",height:"452px"},children:[u&&(0,ki.jsx)(VP,{source:{data:u,transforms:[{type:"hexagon",size:8e5,field:"capacity",method:"sum"}]},color:{values:"#ddd"},shape:{values:"hexagon"},style:{coverage:.7,opacity:.8}},"1"),o&&[(0,ki.jsx)(cE,{options:{autoFit:!0},source:{data:o},scale:{values:{color:{field:"cum_conf",type:"quantile"},size:{field:"cum_conf",type:"log"}}},color:{field:"cum_conf",values:u8},shape:{values:"circle"},active:{option:{color:"#0c2c84"}},size:{field:"cum_conf",values:[0,30]},style:{opacity:.8}},"2"),(0,ki.jsx)(cE,{source:{data:o},color:{values:"#fff"},shape:{field:"Short_Name_ZH",values:"text"},filter:{field:"cum_conf",values:function(v){return v>2e3}},size:{values:12},style:{opacity:1,strokeOpacity:1,strokeWidth:0}},"5")]]})}}]),t}(Et.Component),vE=ee(86582),c8=ee(70499),Gp=ee.n(c8);function f8(e){return e*1<10?"0".concat(e):e}function mE(){for(var e=[],i=0;i<24;i+=1)e.push({x:"".concat(f8(i),":00"),y:Math.floor(Math.random()*200)+i*50});return e}var h8=function(e){(0,br.Z)(t,e);var i=(0,J.Z)(t);function t(){var n;(0,It.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=i.call.apply(i,[this].concat(o)),n.state={activeData:mE()},n.timer=void 0,n.requestRef=void 0,n.loopData=function(){n.requestRef=requestAnimationFrame(function(){n.timer=window.setTimeout(function(){n.setState({activeData:mE()},function(){n.loopData()})},1e3)})},n}return(0,Zt.Z)(t,[{key:"componentDidMount",value:function(){this.loopData()}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer),this.requestRef&&cancelAnimationFrame(this.requestRef)}},{key:"render",value:function(){var r=this.state.activeData,o=r===void 0?[]:r;return(0,ki.jsxs)("div",{className:Gp().activeChart,children:[(0,ki.jsx)(ye.Z,{title:"\u76EE\u6807\u8BC4\u4F30",value:"\u6709\u671B\u8FBE\u5230\u9884\u671F"}),(0,ki.jsx)("div",{style:{marginTop:32},children:(0,ki.jsx)(ct.m,{data:o,xField:"x",forceFit:!0,yField:"y",height:84})}),o&&(0,ki.jsxs)("div",{children:[(0,ki.jsxs)("div",{className:Gp().activeChartGrid,children:[(0,ki.jsxs)("p",{children:[(0,vE.Z)(o).sort()[o.length-1].y+200," \u4EBF\u5143"]}),(0,ki.jsxs)("p",{children:[(0,vE.Z)(o).sort()[Math.floor(o.length/2)].y," \u4EBF\u5143"]})]}),(0,ki.jsx)("div",{className:Gp().dashedLine,children:(0,ki.jsx)("div",{className:Gp().line})}),(0,ki.jsx)("div",{className:Gp().dashedLine,children:(0,ki.jsx)("div",{className:Gp().line})})]}),o&&(0,ki.jsxs)("div",{className:Gp().activeChartLegend,children:[(0,ki.jsx)("span",{children:"00:00"}),(0,ki.jsx)("span",{children:o[Math.floor(o.length/2)].x}),(0,ki.jsx)("span",{children:o[o.length-1].x})]})]})}}]),t}(Et.Component);function p8(){return Cg.apply(this,arguments)}function Cg(){return Cg=(0,qt.Z)((0,Ft.Z)().mark(function e(){return(0,Ft.Z)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,ot.WY)("/api/tags"));case 1:case"end":return t.stop()}},e)})),Cg.apply(this,arguments)}var d8=ee(19134),gE=ee.n(d8),v8=ye.Z.Countdown,m8=Date.now()+1e3*60*60*24*2+1e3*30,g8=function(){var i=(0,ot.QT)(p8),t=i.loading,n=i.data,r=((n==null?void 0:n.list)||[]).map(function(o){return{id:+Date.now(),word:o.name,weight:o.value}});return(0,ki.jsx)(bt.Z,{children:(0,ki.jsxs)(ki.Fragment,{children:[(0,ki.jsxs)(X.Z,{gutter:24,children:[(0,ki.jsx)(se.Z,{xl:18,lg:24,md:24,sm:24,xs:24,style:{marginBottom:24},children:(0,ki.jsxs)(y.Z,{title:"\u6D3B\u52A8\u5B9E\u65F6\u4EA4\u6613\u60C5\u51B5",bordered:!1,children:[(0,ki.jsxs)(X.Z,{children:[(0,ki.jsx)(se.Z,{md:6,sm:12,xs:24,children:(0,ki.jsx)(ye.Z,{title:"\u4ECA\u65E5\u4EA4\u6613\u603B\u989D",suffix:"\u5143",value:vr()(124543233).format("0,0")})}),(0,ki.jsx)(se.Z,{md:6,sm:12,xs:24,children:(0,ki.jsx)(ye.Z,{title:"\u9500\u552E\u76EE\u6807\u5B8C\u6210\u7387",value:"92%"})}),(0,ki.jsx)(se.Z,{md:6,sm:12,xs:24,children:(0,ki.jsx)(v8,{title:"\u6D3B\u52A8\u5269\u4F59\u65F6\u95F4",value:m8,format:"HH:mm:ss:SSS"})}),(0,ki.jsx)(se.Z,{md:6,sm:12,xs:24,children:(0,ki.jsx)(ye.Z,{title:"\u6BCF\u79D2\u4EA4\u6613\u603B\u989D",suffix:"\u5143",value:vr()(234).format("0,0")})})]}),(0,ki.jsx)("div",{className:gE().mapChart,children:(0,ki.jsx)(l8,{})})]})}),(0,ki.jsxs)(se.Z,{xl:6,lg:24,md:24,sm:24,xs:24,children:[(0,ki.jsx)(y.Z,{title:"\u6D3B\u52A8\u60C5\u51B5\u9884\u6D4B",style:{marginBottom:24},bordered:!1,children:(0,ki.jsx)(h8,{})}),(0,ki.jsx)(y.Z,{title:"\u5238\u6838\u6548\u7387",style:{marginBottom:24},bodyStyle:{textAlign:"center"},bordered:!1,children:(0,ki.jsx)(ct.aC,{height:180,min:0,max:100,forceFit:!0,value:87,range:[0,25,50,75,100],statistic:{visible:!0,text:"\u4F18",color:"#30bf78"}})})]})]}),(0,ki.jsxs)(X.Z,{gutter:24,children:[(0,ki.jsx)(se.Z,{xl:12,lg:24,sm:24,xs:24,style:{marginBottom:24},children:(0,ki.jsx)(y.Z,{title:"\u5404\u54C1\u7C7B\u5360\u6BD4",bordered:!1,className:gE().pieCard,children:(0,ki.jsxs)(X.Z,{style:{padding:"16px 0"},children:[(0,ki.jsx)(se.Z,{span:8,children:(0,ki.jsx)(ct.TZ,{forceFit:!0,height:128,percent:.28})}),(0,ki.jsx)(se.Z,{span:8,children:(0,ki.jsx)(ct.TZ,{color:"#5DDECF",forceFit:!0,height:128,percent:.22})}),(0,ki.jsx)(se.Z,{span:8,children:(0,ki.jsx)(ct.TZ,{color:"#2FC25B",forceFit:!0,height:128,percent:.32})})]})})}),(0,ki.jsx)(se.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,ki.jsx)(y.Z,{title:"\u70ED\u95E8\u641C\u7D22",loading:t,bordered:!1,bodyStyle:{overflow:"hidden"},children:(0,ki.jsx)(ct.kB,{data:r,forceFit:!0,height:162,wordStyle:{fontSize:[10,20]},shape:"triangle"})})}),(0,ki.jsx)(se.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,ki.jsx)(y.Z,{title:"\u8D44\u6E90\u5269\u4F59",bodyStyle:{textAlign:"center",fontSize:0},bordered:!1,children:(0,ki.jsx)(ct.Kj,{height:161,min:0,max:1e4,value:5639,forceFit:!0,padding:[0,0,0,0],statistic:{formatter:function(u){return"".concat((100*u/1e4).toFixed(1),"%")}}})})})]})]})})},y8=g8},9187:function(sn){"use strict";sn.exports=pe,sn.exports.default=pe;function pe(Y,ce,ue){ue=ue||2;var Xe=ce&&ce.length,lt=Xe?ce[0]*ue:Y.length,_t=ee(Y,0,lt,ue,!0),Xt=[];if(!_t||_t.next===_t.prev)return Xt;var hr,Yr,Hr,vi,Vn,Xn,ma;if(Xe&&(_t=se(Y,ce,_t,ue)),Y.length>80*ue){hr=Hr=Y[0],Yr=vi=Y[1];for(var Pi=ue;Pi<lt;Pi+=ue)Vn=Y[Pi],Xn=Y[Pi+1],Vn<hr&&(hr=Vn),Xn<Yr&&(Yr=Xn),Vn>Hr&&(Hr=Vn),Xn>vi&&(vi=Xn);ma=Math.max(Hr-hr,vi-Yr),ma=ma!==0?32767/ma:0}return Te(_t,Xt,ue,hr,Yr,ma,0),Xt}function ee(Y,ce,ue,Xe,lt){var _t,Xt;if(lt===Ze(Y,ce,ue,Xe)>0)for(_t=ce;_t<ue;_t+=Xe)Xt=sr(_t,Y[_t],Y[_t+1],Xt);else for(_t=ue-Xe;_t>=ce;_t-=Xe)Xt=sr(_t,Y[_t],Y[_t+1],Xt);return Xt&&Zt(Xt,Xt.next)&&(Ir(Xt),Xt=Xt.next),Xt}function Le(Y,ce){if(!Y)return Y;ce||(ce=Y);var ue=Y,Xe;do if(Xe=!1,!ue.steiner&&(Zt(ue,ue.next)||It(ue.prev,ue,ue.next)===0)){if(Ir(ue),ue=ce=ue.prev,ue===ue.next)break;Xe=!0}else ue=ue.next;while(Xe||ue!==ce);return ce}function Te(Y,ce,ue,Xe,lt,_t,Xt){if(!!Y){!Xt&&_t&&bt(Y,Xe,lt,_t);for(var hr=Y,Yr,Hr;Y.prev!==Y.next;){if(Yr=Y.prev,Hr=Y.next,_t?Ie(Y,Xe,lt,_t):y(Y)){ce.push(Yr.i/ue|0),ce.push(Y.i/ue|0),ce.push(Hr.i/ue|0),Ir(Y),Y=Hr.next,hr=Hr.next;continue}if(Y=Hr,Y===hr){Xt?Xt===1?(Y=X(Le(Y),ce,ue),Te(Y,ce,ue,Xe,lt,_t,2)):Xt===2&&Se(Y,ce,ue,Xe,lt,_t):Te(Le(Y),ce,ue,Xe,lt,_t,1);break}}}}function y(Y){var ce=Y.prev,ue=Y,Xe=Y.next;if(It(ce,ue,Xe)>=0)return!1;for(var lt=ce.x,_t=ue.x,Xt=Xe.x,hr=ce.y,Yr=ue.y,Hr=Xe.y,vi=lt<_t?lt<Xt?lt:Xt:_t<Xt?_t:Xt,Vn=hr<Yr?hr<Hr?hr:Hr:Yr<Hr?Yr:Hr,Xn=lt>_t?lt>Xt?lt:Xt:_t>Xt?_t:Xt,ma=hr>Yr?hr>Hr?hr:Hr:Yr>Hr?Yr:Hr,Pi=Xe.next;Pi!==ce;){if(Pi.x>=vi&&Pi.x<=Xn&&Pi.y>=Vn&&Pi.y<=ma&&gr(lt,hr,_t,Yr,Xt,Hr,Pi.x,Pi.y)&&It(Pi.prev,Pi,Pi.next)>=0)return!1;Pi=Pi.next}return!0}function Ie(Y,ce,ue,Xe){var lt=Y.prev,_t=Y,Xt=Y.next;if(It(lt,_t,Xt)>=0)return!1;for(var hr=lt.x,Yr=_t.x,Hr=Xt.x,vi=lt.y,Vn=_t.y,Xn=Xt.y,ma=hr<Yr?hr<Hr?hr:Hr:Yr<Hr?Yr:Hr,Pi=vi<Vn?vi<Xn?vi:Xn:Vn<Xn?Vn:Xn,mi=hr>Yr?hr>Hr?hr:Hr:Yr>Hr?Yr:Hr,ca=vi>Vn?vi>Xn?vi:Xn:Vn>Xn?Vn:Xn,Gi=vr(ma,Pi,ce,ue,Xe),Si=vr(mi,ca,ce,ue,Xe),ei=Y.prevZ,cr=Y.nextZ;ei&&ei.z>=Gi&&cr&&cr.z<=Si;){if(ei.x>=ma&&ei.x<=mi&&ei.y>=Pi&&ei.y<=ca&&ei!==lt&&ei!==Xt&&gr(hr,vi,Yr,Vn,Hr,Xn,ei.x,ei.y)&&It(ei.prev,ei,ei.next)>=0||(ei=ei.prevZ,cr.x>=ma&&cr.x<=mi&&cr.y>=Pi&&cr.y<=ca&&cr!==lt&&cr!==Xt&&gr(hr,vi,Yr,Vn,Hr,Xn,cr.x,cr.y)&&It(cr.prev,cr,cr.next)>=0))return!1;cr=cr.nextZ}for(;ei&&ei.z>=Gi;){if(ei.x>=ma&&ei.x<=mi&&ei.y>=Pi&&ei.y<=ca&&ei!==lt&&ei!==Xt&&gr(hr,vi,Yr,Vn,Hr,Xn,ei.x,ei.y)&&It(ei.prev,ei,ei.next)>=0)return!1;ei=ei.prevZ}for(;cr&&cr.z<=Si;){if(cr.x>=ma&&cr.x<=mi&&cr.y>=Pi&&cr.y<=ca&&cr!==lt&&cr!==Xt&&gr(hr,vi,Yr,Vn,Hr,Xn,cr.x,cr.y)&&It(cr.prev,cr,cr.next)>=0)return!1;cr=cr.nextZ}return!0}function X(Y,ce,ue){var Xe=Y;do{var lt=Xe.prev,_t=Xe.next.next;!Zt(lt,_t)&&br(lt,Xe,Xe.next,_t)&&pt(lt,_t)&&pt(_t,lt)&&(ce.push(lt.i/ue|0),ce.push(Xe.i/ue|0),ce.push(_t.i/ue|0),Ir(Xe),Ir(Xe.next),Xe=Y=_t),Xe=Xe.next}while(Xe!==Y);return Le(Xe)}function Se(Y,ce,ue,Xe,lt,_t){var Xt=Y;do{for(var hr=Xt.next.next;hr!==Xt.prev;){if(Xt.i!==hr.i&&qt(Xt,hr)){var Yr=vt(Xt,hr);Xt=Le(Xt,Xt.next),Yr=Le(Yr,Yr.next),Te(Xt,ce,ue,Xe,lt,_t,0),Te(Yr,ce,ue,Xe,lt,_t,0);return}hr=hr.next}Xt=Xt.next}while(Xt!==Y)}function se(Y,ce,ue,Xe){var lt=[],_t,Xt,hr,Yr,Hr;for(_t=0,Xt=ce.length;_t<Xt;_t++)hr=ce[_t]*Xe,Yr=_t<Xt-1?ce[_t+1]*Xe:Y.length,Hr=ee(Y,hr,Yr,Xe,!1),Hr===Hr.next&&(Hr.steiner=!0),lt.push(Ft(Hr));for(lt.sort(rt),_t=0;_t<lt.length;_t++)ue=ye(lt[_t],ue);return ue}function rt(Y,ce){return Y.x-ce.x}function ye(Y,ce){var ue=ot(Y,ce);if(!ue)return ce;var Xe=vt(ue,Y);return Le(Xe,Xe.next),Le(ue,ue.next)}function ot(Y,ce){var ue=ce,Xe=Y.x,lt=Y.y,_t=-Infinity,Xt;do{if(lt<=ue.y&&lt>=ue.next.y&&ue.next.y!==ue.y){var hr=ue.x+(lt-ue.y)*(ue.next.x-ue.x)/(ue.next.y-ue.y);if(hr<=Xe&&hr>_t&&(_t=hr,Xt=ue.x<ue.next.x?ue:ue.next,hr===Xe))return Xt}ue=ue.next}while(ue!==ce);if(!Xt)return null;var Yr=Xt,Hr=Xt.x,vi=Xt.y,Vn=Infinity,Xn;ue=Xt;do Xe>=ue.x&&ue.x>=Hr&&Xe!==ue.x&&gr(lt<vi?Xe:_t,lt,Hr,vi,lt<vi?_t:Xe,lt,ue.x,ue.y)&&(Xn=Math.abs(lt-ue.y)/(Xe-ue.x),pt(ue,Y)&&(Xn<Vn||Xn===Vn&&(ue.x>Xt.x||ue.x===Xt.x&&ct(Xt,ue)))&&(Xt=ue,Vn=Xn)),ue=ue.next;while(ue!==Yr);return Xt}function ct(Y,ce){return It(Y.prev,Y,ce.prev)<0&&It(ce.next,Y,Y.next)<0}function bt(Y,ce,ue,Xe){var lt=Y;do lt.z===0&&(lt.z=vr(lt.x,lt.y,ce,ue,Xe)),lt.prevZ=lt.prev,lt.nextZ=lt.next,lt=lt.next;while(lt!==Y);lt.prevZ.nextZ=null,lt.prevZ=null,Ot(lt)}function Ot(Y){var ce,ue,Xe,lt,_t,Xt,hr,Yr,Hr=1;do{for(ue=Y,Y=null,_t=null,Xt=0;ue;){for(Xt++,Xe=ue,hr=0,ce=0;ce<Hr&&(hr++,Xe=Xe.nextZ,!!Xe);ce++);for(Yr=Hr;hr>0||Yr>0&&Xe;)hr!==0&&(Yr===0||!Xe||ue.z<=Xe.z)?(lt=ue,ue=ue.nextZ,hr--):(lt=Xe,Xe=Xe.nextZ,Yr--),_t?_t.nextZ=lt:Y=lt,lt.prevZ=_t,_t=lt;ue=Xe}_t.nextZ=null,Hr*=2}while(Xt>1);return Y}function vr(Y,ce,ue,Xe,lt){return Y=(Y-ue)*lt|0,ce=(ce-Xe)*lt|0,Y=(Y|Y<<8)&16711935,Y=(Y|Y<<4)&252645135,Y=(Y|Y<<2)&858993459,Y=(Y|Y<<1)&1431655765,ce=(ce|ce<<8)&16711935,ce=(ce|ce<<4)&252645135,ce=(ce|ce<<2)&858993459,ce=(ce|ce<<1)&1431655765,Y|ce<<1}function Ft(Y){var ce=Y,ue=Y;do(ce.x<ue.x||ce.x===ue.x&&ce.y<ue.y)&&(ue=ce),ce=ce.next;while(ce!==Y);return ue}function gr(Y,ce,ue,Xe,lt,_t,Xt,hr){return(lt-Xt)*(ce-hr)>=(Y-Xt)*(_t-hr)&&(Y-Xt)*(Xe-hr)>=(ue-Xt)*(ce-hr)&&(ue-Xt)*(_t-hr)>=(lt-Xt)*(Xe-hr)}function qt(Y,ce){return Y.next.i!==ce.i&&Y.prev.i!==ce.i&&!Ct(Y,ce)&&(pt(Y,ce)&&pt(ce,Y)&&Ht(Y,ce)&&(It(Y.prev,Y,ce.prev)||It(Y,ce.prev,ce))||Zt(Y,ce)&&It(Y.prev,Y,Y.next)>0&&It(ce.prev,ce,ce.next)>0)}function It(Y,ce,ue){return(ce.y-Y.y)*(ue.x-ce.x)-(ce.x-Y.x)*(ue.y-ce.y)}function Zt(Y,ce){return Y.x===ce.x&&Y.y===ce.y}function br(Y,ce,ue,Xe){var lt=Et(It(Y,ce,ue)),_t=Et(It(Y,ce,Xe)),Xt=Et(It(ue,Xe,Y)),hr=Et(It(ue,Xe,ce));return!!(lt!==_t&&Xt!==hr||lt===0&&J(Y,ue,ce)||_t===0&&J(Y,Xe,ce)||Xt===0&&J(ue,Y,Xe)||hr===0&&J(ue,ce,Xe))}function J(Y,ce,ue){return ce.x<=Math.max(Y.x,ue.x)&&ce.x>=Math.min(Y.x,ue.x)&&ce.y<=Math.max(Y.y,ue.y)&&ce.y>=Math.min(Y.y,ue.y)}function Et(Y){return Y>0?1:Y<0?-1:0}function Ct(Y,ce){var ue=Y;do{if(ue.i!==Y.i&&ue.next.i!==Y.i&&ue.i!==ce.i&&ue.next.i!==ce.i&&br(ue,ue.next,Y,ce))return!0;ue=ue.next}while(ue!==Y);return!1}function pt(Y,ce){return It(Y.prev,Y,Y.next)<0?It(Y,ce,Y.next)>=0&&It(Y,Y.prev,ce)>=0:It(Y,ce,Y.prev)<0||It(Y,Y.next,ce)<0}function Ht(Y,ce){var ue=Y,Xe=!1,lt=(Y.x+ce.x)/2,_t=(Y.y+ce.y)/2;do ue.y>_t!=ue.next.y>_t&&ue.next.y!==ue.y&&lt<(ue.next.x-ue.x)*(_t-ue.y)/(ue.next.y-ue.y)+ue.x&&(Xe=!Xe),ue=ue.next;while(ue!==Y);return Xe}function vt(Y,ce){var ue=new ae(Y.i,Y.x,Y.y),Xe=new ae(ce.i,ce.x,ce.y),lt=Y.next,_t=ce.prev;return Y.next=ce,ce.prev=Y,ue.next=lt,lt.prev=ue,Xe.next=ue,ue.prev=Xe,_t.next=Xe,Xe.prev=_t,Xe}function sr(Y,ce,ue,Xe){var lt=new ae(Y,ce,ue);return Xe?(lt.next=Xe.next,lt.prev=Xe,Xe.next.prev=lt,Xe.next=lt):(lt.prev=lt,lt.next=lt),lt}function Ir(Y){Y.next.prev=Y.prev,Y.prev.next=Y.next,Y.prevZ&&(Y.prevZ.nextZ=Y.nextZ),Y.nextZ&&(Y.nextZ.prevZ=Y.prevZ)}function ae(Y,ce,ue){this.i=Y,this.x=ce,this.y=ue,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}pe.deviation=function(Y,ce,ue,Xe){var lt=ce&&ce.length,_t=lt?ce[0]*ue:Y.length,Xt=Math.abs(Ze(Y,0,_t,ue));if(lt)for(var hr=0,Yr=ce.length;hr<Yr;hr++){var Hr=ce[hr]*ue,vi=hr<Yr-1?ce[hr+1]*ue:Y.length;Xt-=Math.abs(Ze(Y,Hr,vi,ue))}var Vn=0;for(hr=0;hr<Xe.length;hr+=3){var Xn=Xe[hr]*ue,ma=Xe[hr+1]*ue,Pi=Xe[hr+2]*ue;Vn+=Math.abs((Y[Xn]-Y[Pi])*(Y[ma+1]-Y[Xn+1])-(Y[Xn]-Y[ma])*(Y[Pi+1]-Y[Xn+1]))}return Xt===0&&Vn===0?0:Math.abs((Vn-Xt)/Xt)};function Ze(Y,ce,ue,Xe){for(var lt=0,_t=ce,Xt=ue-Xe;_t<ue;_t+=Xe)lt+=(Y[Xt]-Y[_t])*(Y[_t+1]+Y[Xt+1]),Xt=_t;return lt}pe.flatten=function(Y){for(var ce=Y[0][0].length,ue={vertices:[],holes:[],dimensions:ce},Xe=0,lt=0;lt<Y.length;lt++){for(var _t=0;_t<Y[lt].length;_t++)for(var Xt=0;Xt<ce;Xt++)ue.vertices.push(Y[lt][_t][Xt]);lt>0&&(Xe+=Y[lt-1].length,ue.holes.push(Xe))}return ue}},67709:function(sn){function pe(Le){var Te=Le.target||Le.srcElement;Te.__resizeRAF__&&cancelAnimationFrame(Te.__resizeRAF__),Te.__resizeRAF__=requestAnimationFrame(function(){var y=Te.__resizeTrigger__,Ie=y&&y.__resizeListeners__;Ie&&Ie.forEach(function(X){X.call(y,Le)})})}var ee=function(Te,y){var Ie=this,X=Ie.document,Se,se=X.attachEvent;typeof navigator!="undefined"&&(Se=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function rt(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",pe)}if(!Te.__resizeListeners__)if(Te.__resizeListeners__=[],se)Te.__resizeTrigger__=Te,Te.attachEvent("onresize",pe);else{getComputedStyle(Te).position==="static"&&(Te.style.position="relative");var ye=Te.__resizeTrigger__=X.createElement("object");ye.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ye.setAttribute("class","resize-sensor"),ye.setAttribute("tabindex","-1"),ye.setAttribute("title",""),ye.__resizeElement__=Te,ye.onload=rt,ye.type="text/html",Se&&Te.appendChild(ye),ye.data="about:blank",Se||Te.appendChild(ye)}Te.__resizeListeners__.push(y)};sn.exports=typeof window=="undefined"?ee:ee.bind(window),sn.exports.unbind=function(Le,Te){var y=document.attachEvent,Ie=Le.__resizeListeners__||[];if(Te){var X=Ie.indexOf(Te);X!==-1&&Ie.splice(X,1)}else Ie=Le.__resizeListeners__=[];if(!Ie.length){if(y)Le.detachEvent("onresize",pe);else if(Le.__resizeTrigger__){var Se=Le.__resizeTrigger__.contentDocument,se=Se&&Se.defaultView;se&&(se.removeEventListener("resize",pe),delete se.__resizeTrigger__),Le.__resizeTrigger__=!Le.removeChild(Le.__resizeTrigger__)}delete Le.__resizeListeners__}}},26729:function(sn){"use strict";var pe=Object.prototype.hasOwnProperty,ee="~";function Le(){}Object.create&&(Le.prototype=Object.create(null),new Le().__proto__||(ee=!1));function Te(Se,se,rt){this.fn=Se,this.context=se,this.once=rt||!1}function y(Se,se,rt,ye,ot){if(typeof rt!="function")throw new TypeError("The listener must be a function");var ct=new Te(rt,ye||Se,ot),bt=ee?ee+se:se;return Se._events[bt]?Se._events[bt].fn?Se._events[bt]=[Se._events[bt],ct]:Se._events[bt].push(ct):(Se._events[bt]=ct,Se._eventsCount++),Se}function Ie(Se,se){--Se._eventsCount==0?Se._events=new Le:delete Se._events[se]}function X(){this._events=new Le,this._eventsCount=0}X.prototype.eventNames=function(){var se=[],rt,ye;if(this._eventsCount===0)return se;for(ye in rt=this._events)pe.call(rt,ye)&&se.push(ee?ye.slice(1):ye);return Object.getOwnPropertySymbols?se.concat(Object.getOwnPropertySymbols(rt)):se},X.prototype.listeners=function(se){var rt=ee?ee+se:se,ye=this._events[rt];if(!ye)return[];if(ye.fn)return[ye.fn];for(var ot=0,ct=ye.length,bt=new Array(ct);ot<ct;ot++)bt[ot]=ye[ot].fn;return bt},X.prototype.listenerCount=function(se){var rt=ee?ee+se:se,ye=this._events[rt];return ye?ye.fn?1:ye.length:0},X.prototype.emit=function(se,rt,ye,ot,ct,bt){var Ot=ee?ee+se:se;if(!this._events[Ot])return!1;var vr=this._events[Ot],Ft=arguments.length,gr,qt;if(vr.fn){switch(vr.once&&this.removeListener(se,vr.fn,void 0,!0),Ft){case 1:return vr.fn.call(vr.context),!0;case 2:return vr.fn.call(vr.context,rt),!0;case 3:return vr.fn.call(vr.context,rt,ye),!0;case 4:return vr.fn.call(vr.context,rt,ye,ot),!0;case 5:return vr.fn.call(vr.context,rt,ye,ot,ct),!0;case 6:return vr.fn.call(vr.context,rt,ye,ot,ct,bt),!0}for(qt=1,gr=new Array(Ft-1);qt<Ft;qt++)gr[qt-1]=arguments[qt];vr.fn.apply(vr.context,gr)}else{var It=vr.length,Zt;for(qt=0;qt<It;qt++)switch(vr[qt].once&&this.removeListener(se,vr[qt].fn,void 0,!0),Ft){case 1:vr[qt].fn.call(vr[qt].context);break;case 2:vr[qt].fn.call(vr[qt].context,rt);break;case 3:vr[qt].fn.call(vr[qt].context,rt,ye);break;case 4:vr[qt].fn.call(vr[qt].context,rt,ye,ot);break;default:if(!gr)for(Zt=1,gr=new Array(Ft-1);Zt<Ft;Zt++)gr[Zt-1]=arguments[Zt];vr[qt].fn.apply(vr[qt].context,gr)}}return!0},X.prototype.on=function(se,rt,ye){return y(this,se,rt,ye,!1)},X.prototype.once=function(se,rt,ye){return y(this,se,rt,ye,!0)},X.prototype.removeListener=function(se,rt,ye,ot){var ct=ee?ee+se:se;if(!this._events[ct])return this;if(!rt)return Ie(this,ct),this;var bt=this._events[ct];if(bt.fn)bt.fn===rt&&(!ot||bt.once)&&(!ye||bt.context===ye)&&Ie(this,ct);else{for(var Ot=0,vr=[],Ft=bt.length;Ot<Ft;Ot++)(bt[Ot].fn!==rt||ot&&!bt[Ot].once||ye&&bt[Ot].context!==ye)&&vr.push(bt[Ot]);vr.length?this._events[ct]=vr.length===1?vr[0]:vr:Ie(this,ct)}return this},X.prototype.removeAllListeners=function(se){var rt;return se?(rt=ee?ee+se:se,this._events[rt]&&Ie(this,rt)):(this._events=new Le,this._eventsCount=0),this},X.prototype.off=X.prototype.removeListener,X.prototype.addListener=X.prototype.on,X.prefixed=ee,X.EventEmitter=X,sn.exports=X},80645:function(sn,pe){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */pe.read=function(ee,Le,Te,y,Ie){var X,Se,se=Ie*8-y-1,rt=(1<<se)-1,ye=rt>>1,ot=-7,ct=Te?Ie-1:0,bt=Te?-1:1,Ot=ee[Le+ct];for(ct+=bt,X=Ot&(1<<-ot)-1,Ot>>=-ot,ot+=se;ot>0;X=X*256+ee[Le+ct],ct+=bt,ot-=8);for(Se=X&(1<<-ot)-1,X>>=-ot,ot+=y;ot>0;Se=Se*256+ee[Le+ct],ct+=bt,ot-=8);if(X===0)X=1-ye;else{if(X===rt)return Se?NaN:(Ot?-1:1)*Infinity;Se=Se+Math.pow(2,y),X=X-ye}return(Ot?-1:1)*Se*Math.pow(2,X-y)},pe.write=function(ee,Le,Te,y,Ie,X){var Se,se,rt,ye=X*8-Ie-1,ot=(1<<ye)-1,ct=ot>>1,bt=Ie===23?Math.pow(2,-24)-Math.pow(2,-77):0,Ot=y?0:X-1,vr=y?1:-1,Ft=Le<0||Le===0&&1/Le<0?1:0;for(Le=Math.abs(Le),isNaN(Le)||Le===Infinity?(se=isNaN(Le)?1:0,Se=ot):(Se=Math.floor(Math.log(Le)/Math.LN2),Le*(rt=Math.pow(2,-Se))<1&&(Se--,rt*=2),Se+ct>=1?Le+=bt/rt:Le+=bt*Math.pow(2,1-ct),Le*rt>=2&&(Se++,rt/=2),Se+ct>=ot?(se=0,Se=ot):Se+ct>=1?(se=(Le*rt-1)*Math.pow(2,Ie),Se=Se+ct):(se=Le*Math.pow(2,ct-1)*Math.pow(2,Ie),Se=0));Ie>=8;ee[Te+Ot]=se&255,Ot+=vr,se/=256,Ie-=8);for(Se=Se<<Ie|se,ye+=Ie;ye>0;ee[Te+Ot]=Se&255,Ot+=vr,Se/=256,ye-=8);ee[Te+Ot-vr]|=Ft*128}},7375:function(sn,pe){"use strict";Object.defineProperty(pe,"__esModule",{value:!0});var ee=Symbol.for("INJECTION");function Le(Se,se,rt,ye){function ot(){return ye&&!Reflect.hasMetadata(ee,this,se)&&Reflect.defineMetadata(ee,rt(),this,se),Reflect.hasMetadata(ee,this,se)?Reflect.getMetadata(ee,this,se):rt()}function ct(bt){Reflect.defineMetadata(ee,bt,this,se)}Object.defineProperty(Se,se,{configurable:!0,enumerable:!0,get:ot,set:ct})}function Te(Se,se){return function(rt){return function(ye,ot){var ct=function(){return Se.get(rt)};Le(ye,ot,ct,se)}}}pe.makePropertyInjectDecorator=Te;function y(Se,se){return function(rt,ye){return function(ot,ct){var bt=function(){return Se.getNamed(rt,ye)};Le(ot,ct,bt,se)}}}pe.makePropertyInjectNamedDecorator=y;function Ie(Se,se){return function(rt,ye,ot){return function(ct,bt){var Ot=function(){return Se.getTagged(rt,ye,ot)};Le(ct,bt,Ot,se)}}}pe.makePropertyInjectTaggedDecorator=Ie;function X(Se,se){return function(rt){return function(ye,ot){var ct=function(){return Se.getAll(rt)};Le(ye,ot,ct,se)}}}pe.makePropertyMultiInjectDecorator=X},84879:function(sn,pe,ee){"use strict";var Le;Le={value:!0};var Te=ee(7375);function y(Ie,X){X===void 0&&(X=!0);var Se=Te.makePropertyInjectDecorator(Ie,X),se=Te.makePropertyInjectNamedDecorator(Ie,X),rt=Te.makePropertyInjectTaggedDecorator(Ie,X),ye=Te.makePropertyMultiInjectDecorator(Ie,X);return{lazyInject:Se,lazyInjectNamed:se,lazyInjectTagged:rt,lazyMultiInject:ye}}pe.Z=y},99934:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.tagProperty=pe.tagParameter=pe.decorate=void 0;var Le=ee(16674),Te=ee(6867);function y(ye,ot,ct,bt){var Ot=Te.TAGGED;X(Ot,ye,ot,bt,ct)}pe.tagParameter=y;function Ie(ye,ot,ct){var bt=Te.TAGGED_PROP;X(bt,ye.constructor,ot,ct)}pe.tagProperty=Ie;function X(ye,ot,ct,bt,Ot){var vr={},Ft=typeof Ot=="number",gr=Ot!==void 0&&Ft?Ot.toString():ct;if(Ft&&ct!==void 0)throw new Error(Le.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(ye,ot)&&(vr=Reflect.getMetadata(ye,ot));var qt=vr[gr];if(!Array.isArray(qt))qt=[];else for(var It=0,Zt=qt;It<Zt.length;It++){var br=Zt[It];if(br.key===bt.key)throw new Error(Le.DUPLICATED_METADATA+" "+br.key.toString())}qt.push(bt),vr[gr]=qt,Reflect.defineMetadata(ye,vr,ot)}function Se(ye,ot){Reflect.decorate(ye,ot)}function se(ye,ot){return function(ct,bt){ot(ct,bt,ye)}}function rt(ye,ot,ct){typeof ct=="number"?Se([se(ct,ye)],ot):typeof ct=="string"?Reflect.decorate([ye],ot,ct):Se([ye],ot)}pe.decorate=rt},5744:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.inject=pe.LazyServiceIdentifer=void 0;var Le=ee(16674),Te=ee(6867),y=ee(47738),Ie=ee(99934),X=function(){function se(rt){this._cb=rt}return se.prototype.unwrap=function(){return this._cb()},se}();pe.LazyServiceIdentifer=X;function Se(se){return function(rt,ye,ot){if(se===void 0)throw new Error(Le.UNDEFINED_INJECT_ANNOTATION(rt.name));var ct=new y.Metadata(Te.INJECT_TAG,se);typeof ot=="number"?Ie.tagParameter(rt,ye,ot,ct):Ie.tagProperty(rt,ye,ct)}}pe.inject=Se},64315:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.injectable=void 0;var Le=ee(16674),Te=ee(6867);function y(){return function(Ie){if(Reflect.hasOwnMetadata(Te.PARAM_TYPES,Ie))throw new Error(Le.DUPLICATED_INJECTABLE_DECORATOR);var X=Reflect.getMetadata(Te.DESIGN_PARAM_TYPES,Ie)||[];return Reflect.defineMetadata(Te.PARAM_TYPES,X,Ie),Ie}}pe.injectable=y},71693:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.multiInject=void 0;var Le=ee(6867),Te=ee(47738),y=ee(99934);function Ie(X){return function(Se,se,rt){var ye=new Te.Metadata(Le.MULTI_INJECT_TAG,X);typeof rt=="number"?y.tagParameter(Se,se,rt,ye):y.tagProperty(Se,se,ye)}}pe.multiInject=Ie},38085:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.named=void 0;var Le=ee(6867),Te=ee(47738),y=ee(99934);function Ie(X){return function(Se,se,rt){var ye=new Te.Metadata(Le.NAMED_TAG,X);typeof rt=="number"?y.tagParameter(Se,se,rt,ye):y.tagProperty(Se,se,ye)}}pe.named=Ie},6515:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.optional=void 0;var Le=ee(6867),Te=ee(47738),y=ee(99934);function Ie(){return function(X,Se,se){var rt=new Te.Metadata(Le.OPTIONAL_TAG,!0);typeof se=="number"?y.tagParameter(X,Se,se,rt):y.tagProperty(X,Se,rt)}}pe.optional=Ie},7014:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.postConstruct=void 0;var Le=ee(16674),Te=ee(6867),y=ee(47738);function Ie(){return function(X,Se,se){var rt=new y.Metadata(Te.POST_CONSTRUCT,Se);if(Reflect.hasOwnMetadata(Te.POST_CONSTRUCT,X.constructor))throw new Error(Le.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(Te.POST_CONSTRUCT,rt,X.constructor)}}pe.postConstruct=Ie},32052:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.tagged=void 0;var Le=ee(47738),Te=ee(99934);function y(Ie,X){return function(Se,se,rt){var ye=new Le.Metadata(Ie,X);typeof rt=="number"?Te.tagParameter(Se,se,rt,ye):Te.tagProperty(Se,se,ye)}}pe.tagged=y},55638:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.targetName=void 0;var Le=ee(6867),Te=ee(47738),y=ee(99934);function Ie(X){return function(Se,se,rt){var ye=new Te.Metadata(Le.NAME_TAG,X);y.tagParameter(Se,se,rt,ye)}}pe.targetName=Ie},86757:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.unmanaged=void 0;var Le=ee(6867),Te=ee(47738),y=ee(99934);function Ie(){return function(X,Se,se){var rt=new Te.Metadata(Le.UNMANAGED_TAG,!0);y.tagParameter(X,Se,se,rt)}}pe.unmanaged=Ie},44290:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.Binding=void 0;var Le=ee(28421),Te=ee(37791),y=function(){function Ie(X,Se){this.id=Te.id(),this.activated=!1,this.serviceIdentifier=X,this.scope=Se,this.type=Le.BindingTypeEnum.Invalid,this.constraint=function(se){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Ie.prototype.clone=function(){var X=new Ie(this.serviceIdentifier,this.scope);return X.activated=X.scope===Le.BindingScopeEnum.Singleton?this.activated:!1,X.implementationType=this.implementationType,X.dynamicValue=this.dynamicValue,X.scope=this.scope,X.type=this.type,X.factory=this.factory,X.provider=this.provider,X.constraint=this.constraint,X.onActivation=this.onActivation,X.cache=this.cache,X},Ie}();pe.Binding=y},23184:function(sn,pe){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.BindingCount=void 0;var ee={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};pe.BindingCount=ee},16674:function(sn,pe){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.STACK_OVERFLOW=pe.CIRCULAR_DEPENDENCY_IN_FACTORY=pe.POST_CONSTRUCT_ERROR=pe.MULTIPLE_POST_CONSTRUCT_METHODS=pe.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=pe.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=pe.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=pe.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=pe.ARGUMENTS_LENGTH_MISMATCH=pe.INVALID_DECORATOR_OPERATION=pe.INVALID_TO_SELF_VALUE=pe.INVALID_FUNCTION_BINDING=pe.INVALID_MIDDLEWARE_RETURN=pe.NO_MORE_SNAPSHOTS_AVAILABLE=pe.INVALID_BINDING_TYPE=pe.NOT_IMPLEMENTED=pe.CIRCULAR_DEPENDENCY=pe.UNDEFINED_INJECT_ANNOTATION=pe.MISSING_INJECT_ANNOTATION=pe.MISSING_INJECTABLE_ANNOTATION=pe.NOT_REGISTERED=pe.CANNOT_UNBIND=pe.AMBIGUOUS_MATCH=pe.KEY_NOT_FOUND=pe.NULL_ARGUMENT=pe.DUPLICATED_METADATA=pe.DUPLICATED_INJECTABLE_DECORATOR=void 0,pe.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",pe.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",pe.NULL_ARGUMENT="NULL argument",pe.KEY_NOT_FOUND="Key Not Found",pe.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",pe.CANNOT_UNBIND="Could not unbind serviceIdentifier:",pe.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",pe.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",pe.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var ee=function(Ie){return"@inject called with undefined this could mean that the class "+Ie+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};pe.UNDEFINED_INJECT_ANNOTATION=ee,pe.CIRCULAR_DEPENDENCY="Circular dependency found:",pe.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",pe.INVALID_BINDING_TYPE="Invalid binding type:",pe.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",pe.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",pe.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",pe.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",pe.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Le=function(){for(var Ie=[],X=0;X<arguments.length;X++)Ie[X]=arguments[X];return"The number of constructor arguments in the derived class "+(Ie[0]+" must be >= than the number of constructor arguments of its base class.")};pe.ARGUMENTS_LENGTH_MISMATCH=Le,pe.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",pe.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",pe.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",pe.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",pe.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var Te=function(){for(var Ie=[],X=0;X<arguments.length;X++)Ie[X]=arguments[X];return"@postConstruct error in class "+Ie[0]+": "+Ie[1]};pe.POST_CONSTRUCT_ERROR=Te;var y=function(){for(var Ie=[],X=0;X<arguments.length;X++)Ie[X]=arguments[X];return"It looks like there is a circular dependency "+("in one of the '"+Ie[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Ie[1]+"'.")};pe.CIRCULAR_DEPENDENCY_IN_FACTORY=y,pe.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(sn,pe){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.TargetTypeEnum=pe.BindingTypeEnum=pe.BindingScopeEnum=void 0;var ee={Request:"Request",Singleton:"Singleton",Transient:"Transient"};pe.BindingScopeEnum=ee;var Le={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};pe.BindingTypeEnum=Le;var Te={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};pe.TargetTypeEnum=Te},6867:function(sn,pe){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.NON_CUSTOM_TAG_KEYS=pe.POST_CONSTRUCT=pe.DESIGN_PARAM_TYPES=pe.PARAM_TYPES=pe.TAGGED_PROP=pe.TAGGED=pe.MULTI_INJECT_TAG=pe.INJECT_TAG=pe.OPTIONAL_TAG=pe.UNMANAGED_TAG=pe.NAME_TAG=pe.NAMED_TAG=void 0,pe.NAMED_TAG="named",pe.NAME_TAG="name",pe.UNMANAGED_TAG="unmanaged",pe.OPTIONAL_TAG="optional",pe.INJECT_TAG="inject",pe.MULTI_INJECT_TAG="multi_inject",pe.TAGGED="inversify:tagged",pe.TAGGED_PROP="inversify:tagged_props",pe.PARAM_TYPES="inversify:paramtypes",pe.DESIGN_PARAM_TYPES="design:paramtypes",pe.POST_CONSTRUCT="post_construct";function ee(){return[pe.INJECT_TAG,pe.MULTI_INJECT_TAG,pe.NAME_TAG,pe.UNMANAGED_TAG,pe.NAMED_TAG,pe.OPTIONAL_TAG]}pe.NON_CUSTOM_TAG_KEYS=ee()},51389:function(sn,pe,ee){"use strict";var Le=this&&this.__awaiter||function(qt,It,Zt,br){function J(Et){return Et instanceof Zt?Et:new Zt(function(Ct){Ct(Et)})}return new(Zt||(Zt=Promise))(function(Et,Ct){function pt(sr){try{vt(br.next(sr))}catch(Ir){Ct(Ir)}}function Ht(sr){try{vt(br.throw(sr))}catch(Ir){Ct(Ir)}}function vt(sr){sr.done?Et(sr.value):J(sr.value).then(pt,Ht)}vt((br=br.apply(qt,It||[])).next())})},Te=this&&this.__generator||function(qt,It){var Zt={label:0,sent:function(){if(Et[0]&1)throw Et[1];return Et[1]},trys:[],ops:[]},br,J,Et,Ct;return Ct={next:pt(0),throw:pt(1),return:pt(2)},typeof Symbol=="function"&&(Ct[Symbol.iterator]=function(){return this}),Ct;function pt(vt){return function(sr){return Ht([vt,sr])}}function Ht(vt){if(br)throw new TypeError("Generator is already executing.");for(;Zt;)try{if(br=1,J&&(Et=vt[0]&2?J.return:vt[0]?J.throw||((Et=J.return)&&Et.call(J),0):J.next)&&!(Et=Et.call(J,vt[1])).done)return Et;switch(J=0,Et&&(vt=[vt[0]&2,Et.value]),vt[0]){case 0:case 1:Et=vt;break;case 4:return Zt.label++,{value:vt[1],done:!1};case 5:Zt.label++,J=vt[1],vt=[0];continue;case 7:vt=Zt.ops.pop(),Zt.trys.pop();continue;default:if(Et=Zt.trys,!(Et=Et.length>0&&Et[Et.length-1])&&(vt[0]===6||vt[0]===2)){Zt=0;continue}if(vt[0]===3&&(!Et||vt[1]>Et[0]&&vt[1]<Et[3])){Zt.label=vt[1];break}if(vt[0]===6&&Zt.label<Et[1]){Zt.label=Et[1],Et=vt;break}if(Et&&Zt.label<Et[2]){Zt.label=Et[2],Zt.ops.push(vt);break}Et[2]&&Zt.ops.pop(),Zt.trys.pop();continue}vt=It.call(qt,Zt)}catch(sr){vt=[6,sr],J=0}finally{br=Et=0}if(vt[0]&5)throw vt[1];return{value:vt[0]?vt[1]:void 0,done:!0}}},y=this&&this.__spreadArray||function(qt,It){for(var Zt=0,br=It.length,J=qt.length;Zt<br;Zt++,J++)qt[J]=It[Zt];return qt};Object.defineProperty(pe,"__esModule",{value:!0}),pe.Container=void 0;var Ie=ee(44290),X=ee(16674),Se=ee(28421),se=ee(6867),rt=ee(51377),ye=ee(86311),ot=ee(31927),ct=ee(51860),bt=ee(37791),Ot=ee(55800),vr=ee(85700),Ft=ee(80175),gr=function(){function qt(It){this._appliedMiddleware=[];var Zt=It||{};if(typeof Zt!="object")throw new Error(""+X.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(Zt.defaultScope===void 0)Zt.defaultScope=Se.BindingScopeEnum.Transient;else if(Zt.defaultScope!==Se.BindingScopeEnum.Singleton&&Zt.defaultScope!==Se.BindingScopeEnum.Transient&&Zt.defaultScope!==Se.BindingScopeEnum.Request)throw new Error(""+X.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(Zt.autoBindInjectable===void 0)Zt.autoBindInjectable=!1;else if(typeof Zt.autoBindInjectable!="boolean")throw new Error(""+X.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(Zt.skipBaseClassChecks===void 0)Zt.skipBaseClassChecks=!1;else if(typeof Zt.skipBaseClassChecks!="boolean")throw new Error(""+X.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:Zt.autoBindInjectable,defaultScope:Zt.defaultScope,skipBaseClassChecks:Zt.skipBaseClassChecks},this.id=bt.id(),this._bindingDictionary=new Ft.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new rt.MetadataReader}return qt.merge=function(It,Zt){for(var br=[],J=2;J<arguments.length;J++)br[J-2]=arguments[J];var Et=new qt,Ct=y([It,Zt],br).map(function(vt){return ye.getBindingDictionary(vt)}),pt=ye.getBindingDictionary(Et);function Ht(vt,sr){vt.traverse(function(Ir,ae){ae.forEach(function(Ze){sr.add(Ze.serviceIdentifier,Ze.clone())})})}return Ct.forEach(function(vt){Ht(vt,pt)}),Et},qt.prototype.load=function(){for(var It=[],Zt=0;Zt<arguments.length;Zt++)It[Zt]=arguments[Zt];for(var br=this._getContainerModuleHelpersFactory(),J=0,Et=It;J<Et.length;J++){var Ct=Et[J],pt=br(Ct.id);Ct.registry(pt.bindFunction,pt.unbindFunction,pt.isboundFunction,pt.rebindFunction)}},qt.prototype.loadAsync=function(){for(var It=[],Zt=0;Zt<arguments.length;Zt++)It[Zt]=arguments[Zt];return Le(this,void 0,void 0,function(){var br,J,Et,Ct,pt;return Te(this,function(Ht){switch(Ht.label){case 0:br=this._getContainerModuleHelpersFactory(),J=0,Et=It,Ht.label=1;case 1:return J<Et.length?(Ct=Et[J],pt=br(Ct.id),[4,Ct.registry(pt.bindFunction,pt.unbindFunction,pt.isboundFunction,pt.rebindFunction)]):[3,4];case 2:Ht.sent(),Ht.label=3;case 3:return J++,[3,1];case 4:return[2]}})})},qt.prototype.unload=function(){for(var It=this,Zt=[],br=0;br<arguments.length;br++)Zt[br]=arguments[br];var J=function(Et){return function(Ct){return Ct.moduleId===Et}};Zt.forEach(function(Et){var Ct=J(Et.id);It._bindingDictionary.removeByCondition(Ct)})},qt.prototype.bind=function(It){var Zt=this.options.defaultScope||Se.BindingScopeEnum.Transient,br=new Ie.Binding(It,Zt);return this._bindingDictionary.add(It,br),new ct.BindingToSyntax(br)},qt.prototype.rebind=function(It){return this.unbind(It),this.bind(It)},qt.prototype.unbind=function(It){try{this._bindingDictionary.remove(It)}catch(Zt){throw new Error(X.CANNOT_UNBIND+" "+Ot.getServiceIdentifierAsString(It))}},qt.prototype.unbindAll=function(){this._bindingDictionary=new Ft.Lookup},qt.prototype.isBound=function(It){var Zt=this._bindingDictionary.hasKey(It);return!Zt&&this.parent&&(Zt=this.parent.isBound(It)),Zt},qt.prototype.isBoundNamed=function(It,Zt){return this.isBoundTagged(It,se.NAMED_TAG,Zt)},qt.prototype.isBoundTagged=function(It,Zt,br){var J=!1;if(this._bindingDictionary.hasKey(It)){var Et=this._bindingDictionary.get(It),Ct=ye.createMockRequest(this,It,Zt,br);J=Et.some(function(pt){return pt.constraint(Ct)})}return!J&&this.parent&&(J=this.parent.isBoundTagged(It,Zt,br)),J},qt.prototype.snapshot=function(){this._snapshots.push(vr.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},qt.prototype.restore=function(){var It=this._snapshots.pop();if(It===void 0)throw new Error(X.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=It.bindings,this._middleware=It.middleware},qt.prototype.createChild=function(It){var Zt=new qt(It||this.options);return Zt.parent=this,Zt},qt.prototype.applyMiddleware=function(){for(var It=[],Zt=0;Zt<arguments.length;Zt++)It[Zt]=arguments[Zt];this._appliedMiddleware=this._appliedMiddleware.concat(It);var br=this._middleware?this._middleware:this._planAndResolve();this._middleware=It.reduce(function(J,Et){return Et(J)},br)},qt.prototype.applyCustomMetadataReader=function(It){this._metadataReader=It},qt.prototype.get=function(It){return this._get(!1,!1,Se.TargetTypeEnum.Variable,It)},qt.prototype.getTagged=function(It,Zt,br){return this._get(!1,!1,Se.TargetTypeEnum.Variable,It,Zt,br)},qt.prototype.getNamed=function(It,Zt){return this.getTagged(It,se.NAMED_TAG,Zt)},qt.prototype.getAll=function(It){return this._get(!0,!0,Se.TargetTypeEnum.Variable,It)},qt.prototype.getAllTagged=function(It,Zt,br){return this._get(!1,!0,Se.TargetTypeEnum.Variable,It,Zt,br)},qt.prototype.getAllNamed=function(It,Zt){return this.getAllTagged(It,se.NAMED_TAG,Zt)},qt.prototype.resolve=function(It){var Zt=this.createChild();return Zt.bind(It).toSelf(),this._appliedMiddleware.forEach(function(br){Zt.applyMiddleware(br)}),Zt.get(It)},qt.prototype._getContainerModuleHelpersFactory=function(){var It=this,Zt=function(pt,Ht){pt._binding.moduleId=Ht},br=function(pt){return function(Ht){var vt=It.bind.bind(It),sr=vt(Ht);return Zt(sr,pt),sr}},J=function(pt){return function(Ht){var vt=It.unbind.bind(It);vt(Ht)}},Et=function(pt){return function(Ht){var vt=It.isBound.bind(It);return vt(Ht)}},Ct=function(pt){return function(Ht){var vt=It.rebind.bind(It),sr=vt(Ht);return Zt(sr,pt),sr}};return function(pt){return{bindFunction:br(pt),isboundFunction:Et(pt),rebindFunction:Ct(pt),unbindFunction:J(pt)}}},qt.prototype._get=function(It,Zt,br,J,Et,Ct){var pt=null,Ht={avoidConstraints:It,contextInterceptor:function(vt){return vt},isMultiInject:Zt,key:Et,serviceIdentifier:J,targetType:br,value:Ct};if(this._middleware){if(pt=this._middleware(Ht),pt==null)throw new Error(X.INVALID_MIDDLEWARE_RETURN)}else pt=this._planAndResolve()(Ht);return pt},qt.prototype._planAndResolve=function(){var It=this;return function(Zt){var br=ye.plan(It._metadataReader,It,Zt.isMultiInject,Zt.targetType,Zt.serviceIdentifier,Zt.key,Zt.value,Zt.avoidConstraints);br=Zt.contextInterceptor(br);var J=ot.resolve(br);return J}},qt}();pe.Container=gr},33244:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.AsyncContainerModule=pe.ContainerModule=void 0;var Le=ee(37791),Te=function(){function Ie(X){this.id=Le.id(),this.registry=X}return Ie}();pe.ContainerModule=Te;var y=function(){function Ie(X){this.id=Le.id(),this.registry=X}return Ie}();pe.AsyncContainerModule=y},85700:function(sn,pe){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.ContainerSnapshot=void 0;var ee=function(){function Le(){}return Le.of=function(Te,y){var Ie=new Le;return Ie.bindings=Te,Ie.middleware=y,Ie},Le}();pe.ContainerSnapshot=ee},80175:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.Lookup=void 0;var Le=ee(16674),Te=function(){function y(){this._map=new Map}return y.prototype.getMap=function(){return this._map},y.prototype.add=function(Ie,X){if(Ie==null)throw new Error(Le.NULL_ARGUMENT);if(X==null)throw new Error(Le.NULL_ARGUMENT);var Se=this._map.get(Ie);Se!==void 0?(Se.push(X),this._map.set(Ie,Se)):this._map.set(Ie,[X])},y.prototype.get=function(Ie){if(Ie==null)throw new Error(Le.NULL_ARGUMENT);var X=this._map.get(Ie);if(X!==void 0)return X;throw new Error(Le.KEY_NOT_FOUND)},y.prototype.remove=function(Ie){if(Ie==null)throw new Error(Le.NULL_ARGUMENT);if(!this._map.delete(Ie))throw new Error(Le.KEY_NOT_FOUND)},y.prototype.removeByCondition=function(Ie){var X=this;this._map.forEach(function(Se,se){var rt=Se.filter(function(ye){return!Ie(ye)});rt.length>0?X._map.set(se,rt):X._map.delete(se)})},y.prototype.hasKey=function(Ie){if(Ie==null)throw new Error(Le.NULL_ARGUMENT);return this._map.has(Ie)},y.prototype.clone=function(){var Ie=new y;return this._map.forEach(function(X,Se){X.forEach(function(se){return Ie.add(Se,se.clone())})}),Ie},y.prototype.traverse=function(Ie){this._map.forEach(function(X,Se){Ie(Se,X)})},y}();pe.Lookup=Te},86700:function(sn,pe,ee){"use strict";var Le;Le={value:!0},Le=Le=Le=Le=Le=Le=pe.GW=Le=Le=pe.zY=Le=Le=Le=Le=Le=pe.f3=Le=Le=pe.b2=Le=Le=Le=Le=Le=pe.W2=Le=void 0;var Te=ee(6867);Le=Te;var y=ee(51389);Object.defineProperty(pe,"W2",{enumerable:!0,get:function(){return y.Container}});var Ie=ee(28421);Le={enumerable:!0,get:function(){return Ie.BindingScopeEnum}},Le={enumerable:!0,get:function(){return Ie.BindingTypeEnum}},Le={enumerable:!0,get:function(){return Ie.TargetTypeEnum}};var X=ee(33244);Le={enumerable:!0,get:function(){return X.AsyncContainerModule}},Le={enumerable:!0,get:function(){return X.ContainerModule}};var Se=ee(64315);Object.defineProperty(pe,"b2",{enumerable:!0,get:function(){return Se.injectable}});var se=ee(32052);Le={enumerable:!0,get:function(){return se.tagged}};var rt=ee(38085);Le={enumerable:!0,get:function(){return rt.named}};var ye=ee(5744);Object.defineProperty(pe,"f3",{enumerable:!0,get:function(){return ye.inject}}),Le={enumerable:!0,get:function(){return ye.LazyServiceIdentifer}};var ot=ee(6515);Le={enumerable:!0,get:function(){return ot.optional}};var ct=ee(86757);Le={enumerable:!0,get:function(){return ct.unmanaged}};var bt=ee(71693);Le={enumerable:!0,get:function(){return bt.multiInject}};var Ot=ee(55638);Le={enumerable:!0,get:function(){return Ot.targetName}};var vr=ee(7014);Object.defineProperty(pe,"zY",{enumerable:!0,get:function(){return vr.postConstruct}});var Ft=ee(51377);Le={enumerable:!0,get:function(){return Ft.MetadataReader}};var gr=ee(37791);Le={enumerable:!0,get:function(){return gr.id}};var qt=ee(99934);Object.defineProperty(pe,"GW",{enumerable:!0,get:function(){return qt.decorate}});var It=ee(80758);Le={enumerable:!0,get:function(){return It.traverseAncerstors}},Le={enumerable:!0,get:function(){return It.taggedConstraint}},Le={enumerable:!0,get:function(){return It.namedConstraint}},Le={enumerable:!0,get:function(){return It.typeConstraint}};var Zt=ee(55800);Le={enumerable:!0,get:function(){return Zt.getServiceIdentifierAsString}};var br=ee(70600);Le={enumerable:!0,get:function(){return br.multiBindToService}}},95228:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.Context=void 0;var Le=ee(37791),Te=function(){function y(Ie){this.id=Le.id(),this.container=Ie}return y.prototype.addPlan=function(Ie){this.plan=Ie},y.prototype.setCurrentRequest=function(Ie){this.currentRequest=Ie},y}();pe.Context=Te},47738:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.Metadata=void 0;var Le=ee(6867),Te=function(){function y(Ie,X){this.key=Ie,this.value=X}return y.prototype.toString=function(){return this.key===Le.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},y}();pe.Metadata=Te},51377:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.MetadataReader=void 0;var Le=ee(6867),Te=function(){function y(){}return y.prototype.getConstructorMetadata=function(Ie){var X=Reflect.getMetadata(Le.PARAM_TYPES,Ie),Se=Reflect.getMetadata(Le.TAGGED,Ie);return{compilerGeneratedMetadata:X,userGeneratedMetadata:Se||{}}},y.prototype.getPropertiesMetadata=function(Ie){var X=Reflect.getMetadata(Le.TAGGED_PROP,Ie)||[];return X},y}();pe.MetadataReader=Te},55314:function(sn,pe){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.Plan=void 0;var ee=function(){function Le(Te,y){this.parentContext=Te,this.rootRequest=y}return Le}();pe.Plan=ee},86311:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.getBindingDictionary=pe.createMockRequest=pe.plan=void 0;var Le=ee(23184),Te=ee(16674),y=ee(28421),Ie=ee(6867),X=ee(85265),Se=ee(55800),se=ee(95228),rt=ee(47738),ye=ee(55314),ot=ee(6e3),ct=ee(6748),bt=ee(18924);function Ot(J){return J._bindingDictionary}pe.getBindingDictionary=Ot;function vr(J,Et,Ct,pt,Ht,vt){var sr=J?Ie.MULTI_INJECT_TAG:Ie.INJECT_TAG,Ir=new rt.Metadata(sr,Ct),ae=new bt.Target(Et,pt,Ct,Ir);if(Ht!==void 0){var Ze=new rt.Metadata(Ht,vt);ae.metadata.push(Ze)}return ae}function Ft(J,Et,Ct,pt,Ht){var vt=It(Ct.container,Ht.serviceIdentifier),sr=[];return vt.length===Le.BindingCount.NoBindingsAvailable&&Ct.container.options.autoBindInjectable&&typeof Ht.serviceIdentifier=="function"&&J.getConstructorMetadata(Ht.serviceIdentifier).compilerGeneratedMetadata&&(Ct.container.bind(Ht.serviceIdentifier).toSelf(),vt=It(Ct.container,Ht.serviceIdentifier)),Et?sr=vt:sr=vt.filter(function(Ir){var ae=new ct.Request(Ir.serviceIdentifier,Ct,pt,Ir,Ht);return Ir.constraint(ae)}),gr(Ht.serviceIdentifier,sr,Ht,Ct.container),sr}function gr(J,Et,Ct,pt){switch(Et.length){case Le.BindingCount.NoBindingsAvailable:if(Ct.isOptional())return Et;var Ht=Se.getServiceIdentifierAsString(J),vt=Te.NOT_REGISTERED;throw vt+=Se.listMetadataForTarget(Ht,Ct),vt+=Se.listRegisteredBindingsForServiceIdentifier(pt,Ht,It),new Error(vt);case Le.BindingCount.OnlyOneBindingAvailable:if(!Ct.isArray())return Et;case Le.BindingCount.MultipleBindingsAvailable:default:if(Ct.isArray())return Et;var Ht=Se.getServiceIdentifierAsString(J),vt=Te.AMBIGUOUS_MATCH+" "+Ht;throw vt+=Se.listRegisteredBindingsForServiceIdentifier(pt,Ht,It),new Error(vt)}}function qt(J,Et,Ct,pt,Ht,vt){var sr,Ir;if(Ht===null){sr=Ft(J,Et,pt,null,vt),Ir=new ct.Request(Ct,pt,null,sr,vt);var ae=new ye.Plan(pt,Ir);pt.addPlan(ae)}else sr=Ft(J,Et,pt,Ht,vt),Ir=Ht.addChildRequest(vt.serviceIdentifier,sr,vt);sr.forEach(function(Ze){var Y=null;if(vt.isArray())Y=Ir.addChildRequest(Ze.serviceIdentifier,Ze,vt);else{if(Ze.cache)return;Y=Ir}if(Ze.type===y.BindingTypeEnum.Instance&&Ze.implementationType!==null){var ce=ot.getDependencies(J,Ze.implementationType);if(!pt.container.options.skipBaseClassChecks){var ue=ot.getBaseClassDependencyCount(J,Ze.implementationType);if(ce.length<ue){var Xe=Te.ARGUMENTS_LENGTH_MISMATCH(ot.getFunctionName(Ze.implementationType));throw new Error(Xe)}}ce.forEach(function(lt){qt(J,!1,lt.serviceIdentifier,pt,Y,lt)})}})}function It(J,Et){var Ct=[],pt=Ot(J);return pt.hasKey(Et)?Ct=pt.get(Et):J.parent!==null&&(Ct=It(J.parent,Et)),Ct}function Zt(J,Et,Ct,pt,Ht,vt,sr,Ir){Ir===void 0&&(Ir=!1);var ae=new se.Context(Et),Ze=vr(Ct,pt,Ht,"",vt,sr);try{return qt(J,Ir,Ht,ae,null,Ze),ae}catch(Y){throw X.isStackOverflowExeption(Y)&&ae.plan&&Se.circularDependencyToException(ae.plan.rootRequest),Y}}pe.plan=Zt;function br(J,Et,Ct,pt){var Ht=new bt.Target(y.TargetTypeEnum.Variable,"",Et,new rt.Metadata(Ct,pt)),vt=new se.Context(J),sr=new ct.Request(Et,vt,null,[],Ht);return sr}pe.createMockRequest=br},88460:function(sn,pe){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.QueryableString=void 0;var ee=function(){function Le(Te){this.str=Te}return Le.prototype.startsWith=function(Te){return this.str.indexOf(Te)===0},Le.prototype.endsWith=function(Te){var y="",Ie=Te.split("").reverse().join("");return y=this.str.split("").reverse().join(""),this.startsWith.call({str:y},Ie)},Le.prototype.contains=function(Te){return this.str.indexOf(Te)!==-1},Le.prototype.equals=function(Te){return this.str===Te},Le.prototype.value=function(){return this.str},Le}();pe.QueryableString=ee},6e3:function(sn,pe,ee){"use strict";var Le=this&&this.__spreadArray||function(Ft,gr){for(var qt=0,It=gr.length,Zt=Ft.length;qt<It;qt++,Zt++)Ft[Zt]=gr[qt];return Ft};Object.defineProperty(pe,"__esModule",{value:!0}),pe.getFunctionName=pe.getBaseClassDependencyCount=pe.getDependencies=void 0;var Te=ee(5744),y=ee(16674),Ie=ee(28421),X=ee(6867),Se=ee(55800);Object.defineProperty(pe,"getFunctionName",{enumerable:!0,get:function(){return Se.getFunctionName}});var se=ee(18924);function rt(Ft,gr){var qt=Se.getFunctionName(gr),It=ye(Ft,qt,gr,!1);return It}pe.getDependencies=rt;function ye(Ft,gr,qt,It){var Zt=Ft.getConstructorMetadata(qt),br=Zt.compilerGeneratedMetadata;if(br===void 0){var J=y.MISSING_INJECTABLE_ANNOTATION+" "+gr+".";throw new Error(J)}var Et=Zt.userGeneratedMetadata,Ct=Object.keys(Et),pt=qt.length===0&&Ct.length>0,Ht=Ct.length>qt.length,vt=pt||Ht?Ct.length:qt.length,sr=ct(It,gr,br,Et,vt),Ir=bt(Ft,qt),ae=Le(Le([],sr),Ir);return ae}function ot(Ft,gr,qt,It,Zt){var br=Zt[Ft.toString()]||[],J=vr(br),Et=J.unmanaged!==!0,Ct=It[Ft],pt=J.inject||J.multiInject;if(Ct=pt||Ct,Ct instanceof Te.LazyServiceIdentifer&&(Ct=Ct.unwrap()),Et){var Ht=Ct===Object,vt=Ct===Function,sr=Ct===void 0,Ir=Ht||vt||sr;if(!gr&&Ir){var ae=y.MISSING_INJECT_ANNOTATION+" argument "+Ft+" in class "+qt+".";throw new Error(ae)}var Ze=new se.Target(Ie.TargetTypeEnum.ConstructorArgument,J.targetName,Ct);return Ze.metadata=br,Ze}return null}function ct(Ft,gr,qt,It,Zt){for(var br=[],J=0;J<Zt;J++){var Et=J,Ct=ot(Et,Ft,gr,qt,It);Ct!==null&&br.push(Ct)}return br}function bt(Ft,gr){for(var qt=Ft.getPropertiesMetadata(gr),It=[],Zt=Object.keys(qt),br=0,J=Zt;br<J.length;br++){var Et=J[br],Ct=qt[Et],pt=vr(qt[Et]),Ht=pt.targetName||Et,vt=pt.inject||pt.multiInject,sr=new se.Target(Ie.TargetTypeEnum.ClassProperty,Ht,vt);sr.metadata=Ct,It.push(sr)}var Ir=Object.getPrototypeOf(gr.prototype).constructor;if(Ir!==Object){var ae=bt(Ft,Ir);It=Le(Le([],It),ae)}return It}function Ot(Ft,gr){var qt=Object.getPrototypeOf(gr.prototype).constructor;if(qt!==Object){var It=Se.getFunctionName(qt),Zt=ye(Ft,It,qt,!0),br=Zt.map(function(Ct){return Ct.metadata.filter(function(pt){return pt.key===X.UNMANAGED_TAG})}),J=[].concat.apply([],br).length,Et=Zt.length-J;return Et>0?Et:Ot(Ft,qt)}else return 0}pe.getBaseClassDependencyCount=Ot;function vr(Ft){var gr={};return Ft.forEach(function(qt){gr[qt.key.toString()]=qt.value}),{inject:gr[X.INJECT_TAG],multiInject:gr[X.MULTI_INJECT_TAG],targetName:gr[X.NAME_TAG],unmanaged:gr[X.UNMANAGED_TAG]}}},6748:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.Request=void 0;var Le=ee(37791),Te=function(){function y(Ie,X,Se,se,rt){this.id=Le.id(),this.serviceIdentifier=Ie,this.parentContext=X,this.parentRequest=Se,this.target=rt,this.childRequests=[],this.bindings=Array.isArray(se)?se:[se],this.requestScope=Se===null?new Map:null}return y.prototype.addChildRequest=function(Ie,X,Se){var se=new y(Ie,this.parentContext,this,X,Se);return this.childRequests.push(se),se},y}();pe.Request=Te},18924:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.Target=void 0;var Le=ee(6867),Te=ee(37791),y=ee(47738),Ie=ee(88460),X=function(){function Se(se,rt,ye,ot){this.id=Te.id(),this.type=se,this.serviceIdentifier=ye,this.name=new Ie.QueryableString(rt||""),this.metadata=new Array;var ct=null;typeof ot=="string"?ct=new y.Metadata(Le.NAMED_TAG,ot):ot instanceof y.Metadata&&(ct=ot),ct!==null&&this.metadata.push(ct)}return Se.prototype.hasTag=function(se){for(var rt=0,ye=this.metadata;rt<ye.length;rt++){var ot=ye[rt];if(ot.key===se)return!0}return!1},Se.prototype.isArray=function(){return this.hasTag(Le.MULTI_INJECT_TAG)},Se.prototype.matchesArray=function(se){return this.matchesTag(Le.MULTI_INJECT_TAG)(se)},Se.prototype.isNamed=function(){return this.hasTag(Le.NAMED_TAG)},Se.prototype.isTagged=function(){return this.metadata.some(function(se){return Le.NON_CUSTOM_TAG_KEYS.every(function(rt){return se.key!==rt})})},Se.prototype.isOptional=function(){return this.matchesTag(Le.OPTIONAL_TAG)(!0)},Se.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(se){return se.key===Le.NAMED_TAG})[0]:null},Se.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(se){return Le.NON_CUSTOM_TAG_KEYS.every(function(rt){return se.key!==rt})}):null},Se.prototype.matchesNamedTag=function(se){return this.matchesTag(Le.NAMED_TAG)(se)},Se.prototype.matchesTag=function(se){var rt=this;return function(ye){for(var ot=0,ct=rt.metadata;ot<ct.length;ot++){var bt=ct[ot];if(bt.key===se&&bt.value===ye)return!0}return!1}},Se}();pe.Target=X},52279:function(sn,pe,ee){"use strict";var Le=this&&this.__spreadArray||function(ye,ot){for(var ct=0,bt=ot.length,Ot=ye.length;ct<bt;ct++,Ot++)ye[Ot]=ot[ct];return ye};Object.defineProperty(pe,"__esModule",{value:!0}),pe.resolveInstance=void 0;var Te=ee(16674),y=ee(28421),Ie=ee(6867);function X(ye,ot,ct){var bt=ot.filter(function(vr){return vr.target!==null&&vr.target.type===y.TargetTypeEnum.ClassProperty}),Ot=bt.map(ct);return bt.forEach(function(vr,Ft){var gr="";gr=vr.target.name.value();var qt=Ot[Ft];ye[gr]=qt}),ye}function Se(ye,ot){return new(ye.bind.apply(ye,Le([void 0],ot)))}function se(ye,ot){if(Reflect.hasMetadata(Ie.POST_CONSTRUCT,ye)){var ct=Reflect.getMetadata(Ie.POST_CONSTRUCT,ye);try{ot[ct.value]()}catch(bt){throw new Error(Te.POST_CONSTRUCT_ERROR(ye.name,bt.message))}}}function rt(ye,ot,ct){var bt=null;if(ot.length>0){var Ot=ot.filter(function(Ft){return Ft.target!==null&&Ft.target.type===y.TargetTypeEnum.ConstructorArgument}),vr=Ot.map(ct);bt=Se(ye,vr),bt=X(bt,ot,ct)}else bt=new ye;return se(ye,bt),bt}pe.resolveInstance=rt},31927:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.resolve=void 0;var Le=ee(16674),Te=ee(28421),y=ee(85265),Ie=ee(55800),X=ee(52279),Se=function(ye,ot,ct){try{return ct()}catch(bt){throw y.isStackOverflowExeption(bt)?new Error(Le.CIRCULAR_DEPENDENCY_IN_FACTORY(ye,ot.toString())):bt}},se=function(ye){return function(ot){ot.parentContext.setCurrentRequest(ot);var ct=ot.bindings,bt=ot.childRequests,Ot=ot.target&&ot.target.isArray(),vr=!ot.parentRequest||!ot.parentRequest.target||!ot.target||!ot.parentRequest.target.matchesArray(ot.target.serviceIdentifier);if(Ot&&vr)return bt.map(function(br){var J=se(ye);return J(br)});var Ft=null;if(ot.target.isOptional()&&ct.length===0)return;var gr=ct[0],qt=gr.scope===Te.BindingScopeEnum.Singleton,It=gr.scope===Te.BindingScopeEnum.Request;if(qt&&gr.activated)return gr.cache;if(It&&ye!==null&&ye.has(gr.id))return ye.get(gr.id);if(gr.type===Te.BindingTypeEnum.ConstantValue)Ft=gr.cache,gr.activated=!0;else if(gr.type===Te.BindingTypeEnum.Function)Ft=gr.cache,gr.activated=!0;else if(gr.type===Te.BindingTypeEnum.Constructor)Ft=gr.implementationType;else if(gr.type===Te.BindingTypeEnum.DynamicValue&&gr.dynamicValue!==null)Ft=Se("toDynamicValue",gr.serviceIdentifier,function(){return gr.dynamicValue(ot.parentContext)});else if(gr.type===Te.BindingTypeEnum.Factory&&gr.factory!==null)Ft=Se("toFactory",gr.serviceIdentifier,function(){return gr.factory(ot.parentContext)});else if(gr.type===Te.BindingTypeEnum.Provider&&gr.provider!==null)Ft=Se("toProvider",gr.serviceIdentifier,function(){return gr.provider(ot.parentContext)});else if(gr.type===Te.BindingTypeEnum.Instance&&gr.implementationType!==null)Ft=X.resolveInstance(gr.implementationType,bt,se(ye));else{var Zt=Ie.getServiceIdentifierAsString(ot.serviceIdentifier);throw new Error(Le.INVALID_BINDING_TYPE+" "+Zt)}return typeof gr.onActivation=="function"&&(Ft=gr.onActivation(ot.parentContext,Ft)),qt&&(gr.cache=Ft,gr.activated=!0),It&&ye!==null&&!ye.has(gr.id)&&ye.set(gr.id,Ft),Ft}};function rt(ye){var ot=se(ye.plan.rootRequest.requestScope);return ot(ye.plan.rootRequest)}pe.resolve=rt},83366:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.BindingInSyntax=void 0;var Le=ee(28421),Te=ee(71325),y=function(){function Ie(X){this._binding=X}return Ie.prototype.inRequestScope=function(){return this._binding.scope=Le.BindingScopeEnum.Request,new Te.BindingWhenOnSyntax(this._binding)},Ie.prototype.inSingletonScope=function(){return this._binding.scope=Le.BindingScopeEnum.Singleton,new Te.BindingWhenOnSyntax(this._binding)},Ie.prototype.inTransientScope=function(){return this._binding.scope=Le.BindingScopeEnum.Transient,new Te.BindingWhenOnSyntax(this._binding)},Ie}();pe.BindingInSyntax=y},99812:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.BindingInWhenOnSyntax=void 0;var Le=ee(83366),Te=ee(51811),y=ee(98370),Ie=function(){function X(Se){this._binding=Se,this._bindingWhenSyntax=new y.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Te.BindingOnSyntax(this._binding),this._bindingInSyntax=new Le.BindingInSyntax(Se)}return X.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},X.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},X.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},X.prototype.when=function(Se){return this._bindingWhenSyntax.when(Se)},X.prototype.whenTargetNamed=function(Se){return this._bindingWhenSyntax.whenTargetNamed(Se)},X.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},X.prototype.whenTargetTagged=function(Se,se){return this._bindingWhenSyntax.whenTargetTagged(Se,se)},X.prototype.whenInjectedInto=function(Se){return this._bindingWhenSyntax.whenInjectedInto(Se)},X.prototype.whenParentNamed=function(Se){return this._bindingWhenSyntax.whenParentNamed(Se)},X.prototype.whenParentTagged=function(Se,se){return this._bindingWhenSyntax.whenParentTagged(Se,se)},X.prototype.whenAnyAncestorIs=function(Se){return this._bindingWhenSyntax.whenAnyAncestorIs(Se)},X.prototype.whenNoAncestorIs=function(Se){return this._bindingWhenSyntax.whenNoAncestorIs(Se)},X.prototype.whenAnyAncestorNamed=function(Se){return this._bindingWhenSyntax.whenAnyAncestorNamed(Se)},X.prototype.whenAnyAncestorTagged=function(Se,se){return this._bindingWhenSyntax.whenAnyAncestorTagged(Se,se)},X.prototype.whenNoAncestorNamed=function(Se){return this._bindingWhenSyntax.whenNoAncestorNamed(Se)},X.prototype.whenNoAncestorTagged=function(Se,se){return this._bindingWhenSyntax.whenNoAncestorTagged(Se,se)},X.prototype.whenAnyAncestorMatches=function(Se){return this._bindingWhenSyntax.whenAnyAncestorMatches(Se)},X.prototype.whenNoAncestorMatches=function(Se){return this._bindingWhenSyntax.whenNoAncestorMatches(Se)},X.prototype.onActivation=function(Se){return this._bindingOnSyntax.onActivation(Se)},X}();pe.BindingInWhenOnSyntax=Ie},51811:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.BindingOnSyntax=void 0;var Le=ee(98370),Te=function(){function y(Ie){this._binding=Ie}return y.prototype.onActivation=function(Ie){return this._binding.onActivation=Ie,new Le.BindingWhenSyntax(this._binding)},y}();pe.BindingOnSyntax=Te},51860:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.BindingToSyntax=void 0;var Le=ee(16674),Te=ee(28421),y=ee(99812),Ie=ee(71325),X=function(){function Se(se){this._binding=se}return Se.prototype.to=function(se){return this._binding.type=Te.BindingTypeEnum.Instance,this._binding.implementationType=se,new y.BindingInWhenOnSyntax(this._binding)},Se.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Le.INVALID_TO_SELF_VALUE);var se=this._binding.serviceIdentifier;return this.to(se)},Se.prototype.toConstantValue=function(se){return this._binding.type=Te.BindingTypeEnum.ConstantValue,this._binding.cache=se,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=Te.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},Se.prototype.toDynamicValue=function(se){return this._binding.type=Te.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=se,this._binding.implementationType=null,new y.BindingInWhenOnSyntax(this._binding)},Se.prototype.toConstructor=function(se){return this._binding.type=Te.BindingTypeEnum.Constructor,this._binding.implementationType=se,this._binding.scope=Te.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},Se.prototype.toFactory=function(se){return this._binding.type=Te.BindingTypeEnum.Factory,this._binding.factory=se,this._binding.scope=Te.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},Se.prototype.toFunction=function(se){if(typeof se!="function")throw new Error(Le.INVALID_FUNCTION_BINDING);var rt=this.toConstantValue(se);return this._binding.type=Te.BindingTypeEnum.Function,this._binding.scope=Te.BindingScopeEnum.Singleton,rt},Se.prototype.toAutoFactory=function(se){return this._binding.type=Te.BindingTypeEnum.Factory,this._binding.factory=function(rt){var ye=function(){return rt.container.get(se)};return ye},this._binding.scope=Te.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},Se.prototype.toProvider=function(se){return this._binding.type=Te.BindingTypeEnum.Provider,this._binding.provider=se,this._binding.scope=Te.BindingScopeEnum.Singleton,new Ie.BindingWhenOnSyntax(this._binding)},Se.prototype.toService=function(se){this.toDynamicValue(function(rt){return rt.container.get(se)})},Se}();pe.BindingToSyntax=X},71325:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.BindingWhenOnSyntax=void 0;var Le=ee(51811),Te=ee(98370),y=function(){function Ie(X){this._binding=X,this._bindingWhenSyntax=new Te.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Le.BindingOnSyntax(this._binding)}return Ie.prototype.when=function(X){return this._bindingWhenSyntax.when(X)},Ie.prototype.whenTargetNamed=function(X){return this._bindingWhenSyntax.whenTargetNamed(X)},Ie.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Ie.prototype.whenTargetTagged=function(X,Se){return this._bindingWhenSyntax.whenTargetTagged(X,Se)},Ie.prototype.whenInjectedInto=function(X){return this._bindingWhenSyntax.whenInjectedInto(X)},Ie.prototype.whenParentNamed=function(X){return this._bindingWhenSyntax.whenParentNamed(X)},Ie.prototype.whenParentTagged=function(X,Se){return this._bindingWhenSyntax.whenParentTagged(X,Se)},Ie.prototype.whenAnyAncestorIs=function(X){return this._bindingWhenSyntax.whenAnyAncestorIs(X)},Ie.prototype.whenNoAncestorIs=function(X){return this._bindingWhenSyntax.whenNoAncestorIs(X)},Ie.prototype.whenAnyAncestorNamed=function(X){return this._bindingWhenSyntax.whenAnyAncestorNamed(X)},Ie.prototype.whenAnyAncestorTagged=function(X,Se){return this._bindingWhenSyntax.whenAnyAncestorTagged(X,Se)},Ie.prototype.whenNoAncestorNamed=function(X){return this._bindingWhenSyntax.whenNoAncestorNamed(X)},Ie.prototype.whenNoAncestorTagged=function(X,Se){return this._bindingWhenSyntax.whenNoAncestorTagged(X,Se)},Ie.prototype.whenAnyAncestorMatches=function(X){return this._bindingWhenSyntax.whenAnyAncestorMatches(X)},Ie.prototype.whenNoAncestorMatches=function(X){return this._bindingWhenSyntax.whenNoAncestorMatches(X)},Ie.prototype.onActivation=function(X){return this._bindingOnSyntax.onActivation(X)},Ie}();pe.BindingWhenOnSyntax=y},98370:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.BindingWhenSyntax=void 0;var Le=ee(51811),Te=ee(80758),y=function(){function Ie(X){this._binding=X}return Ie.prototype.when=function(X){return this._binding.constraint=X,new Le.BindingOnSyntax(this._binding)},Ie.prototype.whenTargetNamed=function(X){return this._binding.constraint=Te.namedConstraint(X),new Le.BindingOnSyntax(this._binding)},Ie.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(X){var Se=X.target!==null&&!X.target.isNamed()&&!X.target.isTagged();return Se},new Le.BindingOnSyntax(this._binding)},Ie.prototype.whenTargetTagged=function(X,Se){return this._binding.constraint=Te.taggedConstraint(X)(Se),new Le.BindingOnSyntax(this._binding)},Ie.prototype.whenInjectedInto=function(X){return this._binding.constraint=function(Se){return Te.typeConstraint(X)(Se.parentRequest)},new Le.BindingOnSyntax(this._binding)},Ie.prototype.whenParentNamed=function(X){return this._binding.constraint=function(Se){return Te.namedConstraint(X)(Se.parentRequest)},new Le.BindingOnSyntax(this._binding)},Ie.prototype.whenParentTagged=function(X,Se){return this._binding.constraint=function(se){return Te.taggedConstraint(X)(Se)(se.parentRequest)},new Le.BindingOnSyntax(this._binding)},Ie.prototype.whenAnyAncestorIs=function(X){return this._binding.constraint=function(Se){return Te.traverseAncerstors(Se,Te.typeConstraint(X))},new Le.BindingOnSyntax(this._binding)},Ie.prototype.whenNoAncestorIs=function(X){return this._binding.constraint=function(Se){return!Te.traverseAncerstors(Se,Te.typeConstraint(X))},new Le.BindingOnSyntax(this._binding)},Ie.prototype.whenAnyAncestorNamed=function(X){return this._binding.constraint=function(Se){return Te.traverseAncerstors(Se,Te.namedConstraint(X))},new Le.BindingOnSyntax(this._binding)},Ie.prototype.whenNoAncestorNamed=function(X){return this._binding.constraint=function(Se){return!Te.traverseAncerstors(Se,Te.namedConstraint(X))},new Le.BindingOnSyntax(this._binding)},Ie.prototype.whenAnyAncestorTagged=function(X,Se){return this._binding.constraint=function(se){return Te.traverseAncerstors(se,Te.taggedConstraint(X)(Se))},new Le.BindingOnSyntax(this._binding)},Ie.prototype.whenNoAncestorTagged=function(X,Se){return this._binding.constraint=function(se){return!Te.traverseAncerstors(se,Te.taggedConstraint(X)(Se))},new Le.BindingOnSyntax(this._binding)},Ie.prototype.whenAnyAncestorMatches=function(X){return this._binding.constraint=function(Se){return Te.traverseAncerstors(Se,X)},new Le.BindingOnSyntax(this._binding)},Ie.prototype.whenNoAncestorMatches=function(X){return this._binding.constraint=function(Se){return!Te.traverseAncerstors(Se,X)},new Le.BindingOnSyntax(this._binding)},Ie}();pe.BindingWhenSyntax=y},80758:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.typeConstraint=pe.namedConstraint=pe.taggedConstraint=pe.traverseAncerstors=void 0;var Le=ee(6867),Te=ee(47738),y=function(se,rt){var ye=se.parentRequest;return ye!==null?rt(ye)?!0:y(ye,rt):!1};pe.traverseAncerstors=y;var Ie=function(se){return function(rt){var ye=function(ot){return ot!==null&&ot.target!==null&&ot.target.matchesTag(se)(rt)};return ye.metaData=new Te.Metadata(se,rt),ye}};pe.taggedConstraint=Ie;var X=Ie(Le.NAMED_TAG);pe.namedConstraint=X;var Se=function(se){return function(rt){var ye=null;if(rt!==null)if(ye=rt.bindings[0],typeof se=="string"){var ot=ye.serviceIdentifier;return ot===se}else{var ct=rt.bindings[0].implementationType;return se===ct}return!1}};pe.typeConstraint=Se},70600:function(sn,pe){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.multiBindToService=void 0;var ee=function(Le){return function(Te){return function(){for(var y=[],Ie=0;Ie<arguments.length;Ie++)y[Ie]=arguments[Ie];return y.forEach(function(X){return Le.bind(X).toService(Te)})}}};pe.multiBindToService=ee},85265:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.isStackOverflowExeption=void 0;var Le=ee(16674);function Te(y){return y instanceof RangeError||y.message===Le.STACK_OVERFLOW}pe.isStackOverflowExeption=Te},37791:function(sn,pe){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.id=void 0;var ee=0;function Le(){return ee++}pe.id=Le},55800:function(sn,pe,ee){"use strict";Object.defineProperty(pe,"__esModule",{value:!0}),pe.circularDependencyToException=pe.listMetadataForTarget=pe.listRegisteredBindingsForServiceIdentifier=pe.getServiceIdentifierAsString=pe.getFunctionName=void 0;var Le=ee(16674);function Te(ye){if(typeof ye=="function"){var ot=ye;return ot.name}else{if(typeof ye=="symbol")return ye.toString();var ot=ye;return ot}}pe.getServiceIdentifierAsString=Te;function y(ye,ot,ct){var bt="",Ot=ct(ye,ot);return Ot.length!==0&&(bt=`
Registered bindings:`,Ot.forEach(function(vr){var Ft="Object";vr.implementationType!==null&&(Ft=rt(vr.implementationType)),bt=bt+`
 `+Ft,vr.constraint.metaData&&(bt=bt+" - "+vr.constraint.metaData)})),bt}pe.listRegisteredBindingsForServiceIdentifier=y;function Ie(ye,ot){return ye.parentRequest===null?!1:ye.parentRequest.serviceIdentifier===ot?!0:Ie(ye.parentRequest,ot)}function X(ye){function ot(bt,Ot){Ot===void 0&&(Ot=[]);var vr=Te(bt.serviceIdentifier);return Ot.push(vr),bt.parentRequest!==null?ot(bt.parentRequest,Ot):Ot}var ct=ot(ye);return ct.reverse().join(" --> ")}function Se(ye){ye.childRequests.forEach(function(ot){if(Ie(ot,ot.serviceIdentifier)){var ct=X(ot);throw new Error(Le.CIRCULAR_DEPENDENCY+" "+ct)}else Se(ot)})}pe.circularDependencyToException=Se;function se(ye,ot){if(ot.isTagged()||ot.isNamed()){var ct="",bt=ot.getNamedTag(),Ot=ot.getCustomTags();return bt!==null&&(ct+=bt.toString()+`
`),Ot!==null&&Ot.forEach(function(vr){ct+=vr.toString()+`
`})," "+ye+`
 `+ye+" - "+ct}else return" "+ye}pe.listMetadataForTarget=se;function rt(ye){if(ye.name)return ye.name;var ot=ye.toString(),ct=ot.match(/^function\s*([^\s(]+)/);return ct?ct[1]:"Anonymous function: "+ot}pe.getFunctionName=rt},31745:function(sn){"use strict";sn.exports=ee,sn.exports.default=ee;var pe=1e20;function ee(X,Se,se,rt,ye,ot){this.fontSize=X||24,this.buffer=Se===void 0?3:Se,this.cutoff=rt||.25,this.fontFamily=ye||"sans-serif",this.fontWeight=ot||"normal",this.radius=se||8;var ct=this.size=this.fontSize+this.buffer*2,bt=ct+this.buffer*2,Ot=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;Ot?this.canvas=my.createOffscreenCanvas(ct,ct,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=ct),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(bt*bt),this.gridInner=new Float64Array(bt*bt),this.f=new Float64Array(bt),this.z=new Float64Array(bt+1),this.v=new Uint16Array(bt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Ot?this.middle=Math.round(ct/2*1):this.middle=Math.round(ct/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Le(X,Se,se,rt,ye,ot,ct){ot.fill(pe,0,Se*se),ct.fill(0,0,Se*se);for(var bt=(Se-rt)/2,Ot=0;Ot<ye;Ot++)for(var vr=0;vr<rt;vr++){var Ft=(Ot+bt)*Se+vr+bt,gr=X.data[4*(Ot*rt+vr)+3]/255;if(gr===1)ot[Ft]=0,ct[Ft]=pe;else if(gr===0)ot[Ft]=pe,ct[Ft]=0;else{var qt=Math.max(0,.5-gr),It=Math.max(0,gr-.5);ot[Ft]=qt*qt,ct[Ft]=It*It}}}function Te(X,Se,se,rt,ye,ot,ct){for(var bt=0;bt<Se*se;bt++){var Ot=Math.sqrt(rt[bt])-Math.sqrt(ye[bt]);X[bt]=Math.round(255-255*(Ot/ot+ct))}}ee.prototype._draw=function(X,Se){var se=this.ctx.measureText(X),rt=se.width,ye=2*this.buffer,ot,ct,bt,Ot,vr,Ft,gr,qt;Se&&this.useMetrics?(vr=Math.floor(se.actualBoundingBoxAscent),qt=this.buffer+Math.ceil(se.actualBoundingBoxAscent),Ft=this.buffer,gr=this.buffer,ct=Math.min(this.size,Math.ceil(se.actualBoundingBoxRight-se.actualBoundingBoxLeft)),Ot=Math.min(this.size-Ft,Math.ceil(se.actualBoundingBoxAscent+se.actualBoundingBoxDescent)),ot=ct+ye,bt=Ot+ye,this.ctx.textBaseline="alphabetic"):(ot=ct=this.size,bt=Ot=this.size,vr=19*this.fontSize/24,Ft=gr=0,qt=this.middle,this.ctx.textBaseline="middle");var It;ct&&Ot&&(this.ctx.clearRect(gr,Ft,ct,Ot),this.ctx.fillText(X,this.buffer,qt),It=this.ctx.getImageData(gr,Ft,ct,Ot));var Zt=new Uint8ClampedArray(ot*bt);return Le(It,ot,bt,ct,Ot,this.gridOuter,this.gridInner),y(this.gridOuter,ot,bt,this.f,this.v,this.z),y(this.gridInner,ot,bt,this.f,this.v,this.z),Te(Zt,ot,bt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:Zt,metrics:{width:ct,height:Ot,sdfWidth:ot,sdfHeight:bt,top:vr,left:0,advance:rt}}},ee.prototype.draw=function(X){return this._draw(X,!1).data},ee.prototype.drawWithMetrics=function(X){return this._draw(X,!0)};function y(X,Se,se,rt,ye,ot){for(var ct=0;ct<Se;ct++)Ie(X,ct,Se,se,rt,ye,ot);for(var bt=0;bt<se;bt++)Ie(X,bt*Se,1,Se,rt,ye,ot)}function Ie(X,Se,se,rt,ye,ot,ct){var bt,Ot,vr,Ft;for(ot[0]=0,ct[0]=-pe,ct[1]=pe,bt=0;bt<rt;bt++)ye[bt]=X[Se+bt*se];for(bt=1,Ot=0,vr=0;bt<rt;bt++){do Ft=ot[Ot],vr=(ye[bt]-ye[Ft]+bt*bt-Ft*Ft)/(bt-Ft)/2;while(vr<=ct[Ot]&&--Ot>-1);Ot++,ot[Ot]=bt,ct[Ot]=vr,ct[Ot+1]=pe}for(bt=0,Ot=0;bt<rt;bt++){for(;ct[Ot+1]<bt;)Ot++;Ft=ot[Ot],X[Se+bt*se]=ye[Ft]+(bt-Ft)*(bt-Ft)}}},18857:function(sn,pe,ee){"use strict";ee.r(pe),ee.d(pe,{Function:function(){return vu},Interpreter:function(){return bo},default:function(){return sl},evaluate:function(){return ol},vm:function(){return Le}});var Le={};ee.r(Le),ee.d(Le,{Script:function(){return Il},compileFunction:function(){return fc},createContext:function(){return Gu},runInContext:function(){return Hu},runInNewContext:function(){return Bc}});var Te={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},y="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Ie={5:y,"5module":y+" export import",6:y+" const class extends export import super"},X=/^in(stanceof)?$/,Se="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",se="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",rt=new RegExp("["+Se+"]"),ye=new RegExp("["+Se+se+"]");Se=se=null;var ot=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],ct=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function bt(b,k){for(var Z=65536,R=0;R<k.length;R+=2){if(Z+=k[R],Z>b)return!1;if(Z+=k[R+1],Z>=b)return!0}}function Ot(b,k){return b<65?b===36:b<91?!0:b<97?b===95:b<123?!0:b<=65535?b>=170&&rt.test(String.fromCharCode(b)):k===!1?!1:bt(b,ot)}function vr(b,k){return b<48?b===36:b<58?!0:b<65?!1:b<91?!0:b<97?b===95:b<123?!0:b<=65535?b>=170&&ye.test(String.fromCharCode(b)):k===!1?!1:bt(b,ot)||bt(b,ct)}var Ft=function(k,Z){Z===void 0&&(Z={}),this.label=k,this.keyword=Z.keyword,this.beforeExpr=!!Z.beforeExpr,this.startsExpr=!!Z.startsExpr,this.isLoop=!!Z.isLoop,this.isAssign=!!Z.isAssign,this.prefix=!!Z.prefix,this.postfix=!!Z.postfix,this.binop=Z.binop||null,this.updateContext=null};function gr(b,k){return new Ft(b,{beforeExpr:!0,binop:k})}var qt={beforeExpr:!0},It={startsExpr:!0},Zt={};function br(b,k){return k===void 0&&(k={}),k.keyword=b,Zt[b]=new Ft(b,k)}var J={num:new Ft("num",It),regexp:new Ft("regexp",It),string:new Ft("string",It),name:new Ft("name",It),eof:new Ft("eof"),bracketL:new Ft("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Ft("]"),braceL:new Ft("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Ft("}"),parenL:new Ft("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Ft(")"),comma:new Ft(",",qt),semi:new Ft(";",qt),colon:new Ft(":",qt),dot:new Ft("."),question:new Ft("?",qt),questionDot:new Ft("?."),arrow:new Ft("=>",qt),template:new Ft("template"),invalidTemplate:new Ft("invalidTemplate"),ellipsis:new Ft("...",qt),backQuote:new Ft("`",It),dollarBraceL:new Ft("${",{beforeExpr:!0,startsExpr:!0}),eq:new Ft("=",{beforeExpr:!0,isAssign:!0}),assign:new Ft("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Ft("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Ft("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:gr("||",1),logicalAND:gr("&&",2),bitwiseOR:gr("|",3),bitwiseXOR:gr("^",4),bitwiseAND:gr("&",5),equality:gr("==/!=/===/!==",6),relational:gr("</>/<=/>=",7),bitShift:gr("<</>>/>>>",8),plusMin:new Ft("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:gr("%",10),star:gr("*",10),slash:gr("/",10),starstar:new Ft("**",{beforeExpr:!0}),coalesce:gr("??",1),_break:br("break"),_case:br("case",qt),_catch:br("catch"),_continue:br("continue"),_debugger:br("debugger"),_default:br("default",qt),_do:br("do",{isLoop:!0,beforeExpr:!0}),_else:br("else",qt),_finally:br("finally"),_for:br("for",{isLoop:!0}),_function:br("function",It),_if:br("if"),_return:br("return",qt),_switch:br("switch"),_throw:br("throw",qt),_try:br("try"),_var:br("var"),_const:br("const"),_while:br("while",{isLoop:!0}),_with:br("with"),_new:br("new",{beforeExpr:!0,startsExpr:!0}),_this:br("this",It),_super:br("super",It),_class:br("class",It),_extends:br("extends",qt),_export:br("export"),_import:br("import",It),_null:br("null",It),_true:br("true",It),_false:br("false",It),_in:br("in",{beforeExpr:!0,binop:7}),_instanceof:br("instanceof",{beforeExpr:!0,binop:7}),_typeof:br("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:br("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:br("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Et=/\r\n?|\n|\u2028|\u2029/,Ct=new RegExp(Et.source,"g");function pt(b,k){return b===10||b===13||!k&&(b===8232||b===8233)}var Ht=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,vt=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,sr=Object.prototype,Ir=sr.hasOwnProperty,ae=sr.toString;function Ze(b,k){return Ir.call(b,k)}var Y=Array.isArray||function(b){return ae.call(b)==="[object Array]"};function ce(b){return new RegExp("^(?:"+b.replace(/ /g,"|")+")$")}var ue=function(k,Z){this.line=k,this.column=Z};ue.prototype.offset=function(k){return new ue(this.line,this.column+k)};var Xe=function(k,Z,R){this.start=Z,this.end=R,k.sourceFile!==null&&(this.source=k.sourceFile)};function lt(b,k){for(var Z=1,R=0;;){Ct.lastIndex=R;var te=Ct.exec(b);if(te&&te.index<k)++Z,R=te.index+te[0].length;else return new ue(Z,k-R)}}var _t={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Xt(b){var k={};for(var Z in _t)k[Z]=b&&Ze(b,Z)?b[Z]:_t[Z];if(k.ecmaVersion>=2015&&(k.ecmaVersion-=2009),k.allowReserved==null&&(k.allowReserved=k.ecmaVersion<5),Y(k.onToken)){var R=k.onToken;k.onToken=function(te){return R.push(te)}}return Y(k.onComment)&&(k.onComment=hr(k,k.onComment)),k}function hr(b,k){return function(Z,R,te,Me,at,Rt){var Lt={type:Z?"Block":"Line",value:R,start:te,end:Me};b.locations&&(Lt.loc=new Xe(this,at,Rt)),b.ranges&&(Lt.range=[te,Me]),k.push(Lt)}}var Yr=1,Hr=2,vi=Yr|Hr,Vn=4,Xn=8,ma=16,Pi=32,mi=64,ca=128;function Gi(b,k){return Hr|(b?Vn:0)|(k?Xn:0)}var Si=0,ei=1,cr=2,mt=3,Wa=4,xa=5,gt=function(k,Z,R){this.options=k=Xt(k),this.sourceFile=k.sourceFile,this.keywords=ce(Ie[k.ecmaVersion>=6?6:k.sourceType==="module"?"5module":5]);var te="";if(k.allowReserved!==!0){for(var Me=k.ecmaVersion;!(te=Te[Me]);Me--);k.sourceType==="module"&&(te+=" await")}this.reservedWords=ce(te);var at=(te?te+" ":"")+Te.strict;this.reservedWordsStrict=ce(at),this.reservedWordsStrictBind=ce(at+" "+Te.strictBind),this.input=String(Z),this.containsEsc=!1,R?(this.pos=R,this.lineStart=this.input.lastIndexOf(`
`,R-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Et).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=J.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=k.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&k.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Yr),this.regexpState=null},he={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};gt.prototype.parse=function(){var k=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(k)},he.inFunction.get=function(){return(this.currentVarScope().flags&Hr)>0},he.inGenerator.get=function(){return(this.currentVarScope().flags&Xn)>0},he.inAsync.get=function(){return(this.currentVarScope().flags&Vn)>0},he.allowSuper.get=function(){return(this.currentThisScope().flags&mi)>0},he.allowDirectSuper.get=function(){return(this.currentThisScope().flags&ca)>0},he.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},gt.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&Hr)>0},gt.extend=function(){for(var k=[],Z=arguments.length;Z--;)k[Z]=arguments[Z];for(var R=this,te=0;te<k.length;te++)R=k[te](R);return R},gt.parse=function(k,Z){return new this(Z,k).parse()},gt.parseExpressionAt=function(k,Z,R){var te=new this(R,k,Z);return te.nextToken(),te.parseExpression()},gt.tokenizer=function(k,Z){return new this(Z,k)},Object.defineProperties(gt.prototype,he);var ie=gt.prototype,_e=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;ie.strictDirective=function(b){for(;;){vt.lastIndex=b,b+=vt.exec(this.input)[0].length;var k=_e.exec(this.input.slice(b));if(!k)return!1;if((k[1]||k[2])==="use strict"){vt.lastIndex=b+k[0].length;var Z=vt.exec(this.input),R=Z.index+Z[0].length,te=this.input.charAt(R);return te===";"||te==="}"||Et.test(Z[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(te)||te==="!"&&this.input.charAt(R+1)==="=")}b+=k[0].length,vt.lastIndex=b,b+=vt.exec(this.input)[0].length,this.input[b]===";"&&b++}},ie.eat=function(b){return this.type===b?(this.next(),!0):!1},ie.isContextual=function(b){return this.type===J.name&&this.value===b&&!this.containsEsc},ie.eatContextual=function(b){return this.isContextual(b)?(this.next(),!0):!1},ie.expectContextual=function(b){this.eatContextual(b)||this.unexpected()},ie.canInsertSemicolon=function(){return this.type===J.eof||this.type===J.braceR||Et.test(this.input.slice(this.lastTokEnd,this.start))},ie.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},ie.semicolon=function(){!this.eat(J.semi)&&!this.insertSemicolon()&&this.unexpected()},ie.afterTrailingComma=function(b,k){if(this.type===b)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),k||this.next(),!0},ie.expect=function(b){this.eat(b)||this.unexpected()},ie.unexpected=function(b){this.raise(b!=null?b:this.start,"Unexpected token")};function N(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}ie.checkPatternErrors=function(b,k){if(!!b){b.trailingComma>-1&&this.raiseRecoverable(b.trailingComma,"Comma is not permitted after the rest element");var Z=k?b.parenthesizedAssign:b.parenthesizedBind;Z>-1&&this.raiseRecoverable(Z,"Parenthesized pattern")}},ie.checkExpressionErrors=function(b,k){if(!b)return!1;var Z=b.shorthandAssign,R=b.doubleProto;if(!k)return Z>=0||R>=0;Z>=0&&this.raise(Z,"Shorthand property assignments are valid only in destructuring patterns"),R>=0&&this.raiseRecoverable(R,"Redefinition of __proto__ property")},ie.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},ie.isSimpleAssignTarget=function(b){return b.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(b.expression):b.type==="Identifier"||b.type==="MemberExpression"};var qe=gt.prototype;qe.parseTopLevel=function(b){var k={};for(b.body||(b.body=[]);this.type!==J.eof;){var Z=this.parseStatement(null,!0,k);b.body.push(Z)}if(this.inModule)for(var R=0,te=Object.keys(this.undefinedExports);R<te.length;R+=1){var Me=te[R];this.raiseRecoverable(this.undefinedExports[Me].start,"Export '"+Me+"' is not defined")}return this.adaptDirectivePrologue(b.body),this.next(),b.sourceType=this.options.sourceType,this.finishNode(b,"Program")};var Qt={kind:"loop"},Nr={kind:"switch"};qe.isLet=function(b){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;vt.lastIndex=this.pos;var k=vt.exec(this.input),Z=this.pos+k[0].length,R=this.input.charCodeAt(Z);if(R===91)return!0;if(b)return!1;if(R===123)return!0;if(Ot(R,!0)){for(var te=Z+1;vr(this.input.charCodeAt(te),!0);)++te;var Me=this.input.slice(Z,te);if(!X.test(Me))return!0}return!1},qe.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;vt.lastIndex=this.pos;var b=vt.exec(this.input),k=this.pos+b[0].length;return!Et.test(this.input.slice(this.pos,k))&&this.input.slice(k,k+8)==="function"&&(k+8===this.input.length||!vr(this.input.charAt(k+8)))},qe.parseStatement=function(b,k,Z){var R=this.type,te=this.startNode(),Me;switch(this.isLet(b)&&(R=J._var,Me="let"),R){case J._break:case J._continue:return this.parseBreakContinueStatement(te,R.keyword);case J._debugger:return this.parseDebuggerStatement(te);case J._do:return this.parseDoStatement(te);case J._for:return this.parseForStatement(te);case J._function:return b&&(this.strict||b!=="if"&&b!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(te,!1,!b);case J._class:return b&&this.unexpected(),this.parseClass(te,!0);case J._if:return this.parseIfStatement(te);case J._return:return this.parseReturnStatement(te);case J._switch:return this.parseSwitchStatement(te);case J._throw:return this.parseThrowStatement(te);case J._try:return this.parseTryStatement(te);case J._const:case J._var:return Me=Me||this.value,b&&Me!=="var"&&this.unexpected(),this.parseVarStatement(te,Me);case J._while:return this.parseWhileStatement(te);case J._with:return this.parseWithStatement(te);case J.braceL:return this.parseBlock(!0,te);case J.semi:return this.parseEmptyStatement(te);case J._export:case J._import:if(this.options.ecmaVersion>10&&R===J._import){vt.lastIndex=this.pos;var at=vt.exec(this.input),Rt=this.pos+at[0].length,Lt=this.input.charCodeAt(Rt);if(Lt===40||Lt===46)return this.parseExpressionStatement(te,this.parseExpression())}return this.options.allowImportExportEverywhere||(k||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),R===J._import?this.parseImport(te):this.parseExport(te,Z);default:if(this.isAsyncFunction())return b&&this.unexpected(),this.next(),this.parseFunctionStatement(te,!0,!b);var Ar=this.value,Tr=this.parseExpression();return R===J.name&&Tr.type==="Identifier"&&this.eat(J.colon)?this.parseLabeledStatement(te,Ar,Tr,b):this.parseExpressionStatement(te,Tr)}},qe.parseBreakContinueStatement=function(b,k){var Z=k==="break";this.next(),this.eat(J.semi)||this.insertSemicolon()?b.label=null:this.type!==J.name?this.unexpected():(b.label=this.parseIdent(),this.semicolon());for(var R=0;R<this.labels.length;++R){var te=this.labels[R];if((b.label==null||te.name===b.label.name)&&(te.kind!=null&&(Z||te.kind==="loop")||b.label&&Z))break}return R===this.labels.length&&this.raise(b.start,"Unsyntactic "+k),this.finishNode(b,Z?"BreakStatement":"ContinueStatement")},qe.parseDebuggerStatement=function(b){return this.next(),this.semicolon(),this.finishNode(b,"DebuggerStatement")},qe.parseDoStatement=function(b){return this.next(),this.labels.push(Qt),b.body=this.parseStatement("do"),this.labels.pop(),this.expect(J._while),b.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(J.semi):this.semicolon(),this.finishNode(b,"DoWhileStatement")},qe.parseForStatement=function(b){this.next();var k=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Qt),this.enterScope(0),this.expect(J.parenL),this.type===J.semi)return k>-1&&this.unexpected(k),this.parseFor(b,null);var Z=this.isLet();if(this.type===J._var||this.type===J._const||Z){var R=this.startNode(),te=Z?"let":this.value;return this.next(),this.parseVar(R,!0,te),this.finishNode(R,"VariableDeclaration"),(this.type===J._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&R.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===J._in?k>-1&&this.unexpected(k):b.await=k>-1),this.parseForIn(b,R)):(k>-1&&this.unexpected(k),this.parseFor(b,R))}var Me=new N,at=this.parseExpression(!0,Me);return this.type===J._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===J._in?k>-1&&this.unexpected(k):b.await=k>-1),this.toAssignable(at,!1,Me),this.checkLVal(at),this.parseForIn(b,at)):(this.checkExpressionErrors(Me,!0),k>-1&&this.unexpected(k),this.parseFor(b,at))},qe.parseFunctionStatement=function(b,k,Z){return this.next(),this.parseFunction(b,Pt|(Z?0:pr),!1,k)},qe.parseIfStatement=function(b){return this.next(),b.test=this.parseParenExpression(),b.consequent=this.parseStatement("if"),b.alternate=this.eat(J._else)?this.parseStatement("if"):null,this.finishNode(b,"IfStatement")},qe.parseReturnStatement=function(b){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(J.semi)||this.insertSemicolon()?b.argument=null:(b.argument=this.parseExpression(),this.semicolon()),this.finishNode(b,"ReturnStatement")},qe.parseSwitchStatement=function(b){this.next(),b.discriminant=this.parseParenExpression(),b.cases=[],this.expect(J.braceL),this.labels.push(Nr),this.enterScope(0);for(var k,Z=!1;this.type!==J.braceR;)if(this.type===J._case||this.type===J._default){var R=this.type===J._case;k&&this.finishNode(k,"SwitchCase"),b.cases.push(k=this.startNode()),k.consequent=[],this.next(),R?k.test=this.parseExpression():(Z&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),Z=!0,k.test=null),this.expect(J.colon)}else k||this.unexpected(),k.consequent.push(this.parseStatement(null));return this.exitScope(),k&&this.finishNode(k,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(b,"SwitchStatement")},qe.parseThrowStatement=function(b){return this.next(),Et.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),b.argument=this.parseExpression(),this.semicolon(),this.finishNode(b,"ThrowStatement")};var Ye=[];qe.parseTryStatement=function(b){if(this.next(),b.block=this.parseBlock(),b.handler=null,this.type===J._catch){var k=this.startNode();if(this.next(),this.eat(J.parenL)){k.param=this.parseBindingAtom();var Z=k.param.type==="Identifier";this.enterScope(Z?Pi:0),this.checkLVal(k.param,Z?Wa:cr),this.expect(J.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),k.param=null,this.enterScope(0);k.body=this.parseBlock(!1),this.exitScope(),b.handler=this.finishNode(k,"CatchClause")}return b.finalizer=this.eat(J._finally)?this.parseBlock():null,!b.handler&&!b.finalizer&&this.raise(b.start,"Missing catch or finally clause"),this.finishNode(b,"TryStatement")},qe.parseVarStatement=function(b,k){return this.next(),this.parseVar(b,!1,k),this.semicolon(),this.finishNode(b,"VariableDeclaration")},qe.parseWhileStatement=function(b){return this.next(),b.test=this.parseParenExpression(),this.labels.push(Qt),b.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(b,"WhileStatement")},qe.parseWithStatement=function(b){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),b.object=this.parseParenExpression(),b.body=this.parseStatement("with"),this.finishNode(b,"WithStatement")},qe.parseEmptyStatement=function(b){return this.next(),this.finishNode(b,"EmptyStatement")},qe.parseLabeledStatement=function(b,k,Z,R){for(var te=0,Me=this.labels;te<Me.length;te+=1){var at=Me[te];at.name===k&&this.raise(Z.start,"Label '"+k+"' is already declared")}for(var Rt=this.type.isLoop?"loop":this.type===J._switch?"switch":null,Lt=this.labels.length-1;Lt>=0;Lt--){var Ar=this.labels[Lt];if(Ar.statementStart===b.start)Ar.statementStart=this.start,Ar.kind=Rt;else break}return this.labels.push({name:k,kind:Rt,statementStart:this.start}),b.body=this.parseStatement(R?R.indexOf("label")===-1?R+"label":R:"label"),this.labels.pop(),b.label=Z,this.finishNode(b,"LabeledStatement")},qe.parseExpressionStatement=function(b,k){return b.expression=k,this.semicolon(),this.finishNode(b,"ExpressionStatement")},qe.parseBlock=function(b,k,Z){for(b===void 0&&(b=!0),k===void 0&&(k=this.startNode()),k.body=[],this.expect(J.braceL),b&&this.enterScope(0);this.type!==J.braceR;){var R=this.parseStatement(null);k.body.push(R)}return Z&&(this.strict=!1),this.next(),b&&this.exitScope(),this.finishNode(k,"BlockStatement")},qe.parseFor=function(b,k){return b.init=k,this.expect(J.semi),b.test=this.type===J.semi?null:this.parseExpression(),this.expect(J.semi),b.update=this.type===J.parenR?null:this.parseExpression(),this.expect(J.parenR),b.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(b,"ForStatement")},qe.parseForIn=function(b,k){var Z=this.type===J._in;return this.next(),k.type==="VariableDeclaration"&&k.declarations[0].init!=null&&(!Z||this.options.ecmaVersion<8||this.strict||k.kind!=="var"||k.declarations[0].id.type!=="Identifier")?this.raise(k.start,(Z?"for-in":"for-of")+" loop variable declaration may not have an initializer"):k.type==="AssignmentPattern"&&this.raise(k.start,"Invalid left-hand side in for-loop"),b.left=k,b.right=Z?this.parseExpression():this.parseMaybeAssign(),this.expect(J.parenR),b.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(b,Z?"ForInStatement":"ForOfStatement")},qe.parseVar=function(b,k,Z){for(b.declarations=[],b.kind=Z;;){var R=this.startNode();if(this.parseVarId(R,Z),this.eat(J.eq)?R.init=this.parseMaybeAssign(k):Z==="const"&&!(this.type===J._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():R.id.type!=="Identifier"&&!(k&&(this.type===J._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):R.init=null,b.declarations.push(this.finishNode(R,"VariableDeclarator")),!this.eat(J.comma))break}return b},qe.parseVarId=function(b,k){b.id=this.parseBindingAtom(),this.checkLVal(b.id,k==="var"?ei:cr,!1)};var Pt=1,pr=2,Pr=4;qe.parseFunction=function(b,k,Z,R){this.initFunction(b),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!R)&&(this.type===J.star&&k&pr&&this.unexpected(),b.generator=this.eat(J.star)),this.options.ecmaVersion>=8&&(b.async=!!R),k&Pt&&(b.id=k&Pr&&this.type!==J.name?null:this.parseIdent(),b.id&&!(k&pr)&&this.checkLVal(b.id,this.strict||b.generator||b.async?this.treatFunctionsAsVar?ei:cr:mt));var te=this.yieldPos,Me=this.awaitPos,at=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Gi(b.async,b.generator)),k&Pt||(b.id=this.type===J.name?this.parseIdent():null),this.parseFunctionParams(b),this.parseFunctionBody(b,Z,!1),this.yieldPos=te,this.awaitPos=Me,this.awaitIdentPos=at,this.finishNode(b,k&Pt?"FunctionDeclaration":"FunctionExpression")},qe.parseFunctionParams=function(b){this.expect(J.parenL),b.params=this.parseBindingList(J.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},qe.parseClass=function(b,k){this.next();var Z=this.strict;this.strict=!0,this.parseClassId(b,k),this.parseClassSuper(b);var R=this.startNode(),te=!1;for(R.body=[],this.expect(J.braceL);this.type!==J.braceR;){var Me=this.parseClassElement(b.superClass!==null);Me&&(R.body.push(Me),Me.type==="MethodDefinition"&&Me.kind==="constructor"&&(te&&this.raise(Me.start,"Duplicate constructor in the same class"),te=!0))}return this.strict=Z,this.next(),b.body=this.finishNode(R,"ClassBody"),this.finishNode(b,k?"ClassDeclaration":"ClassExpression")},qe.parseClassElement=function(b){var k=this;if(this.eat(J.semi))return null;var Z=this.startNode(),R=function(Lt,Ar){Ar===void 0&&(Ar=!1);var Tr=k.start,Fn=k.startLoc;return k.eatContextual(Lt)?k.type!==J.parenL&&(!Ar||!k.canInsertSemicolon())?!0:(Z.key&&k.unexpected(),Z.computed=!1,Z.key=k.startNodeAt(Tr,Fn),Z.key.name=Lt,k.finishNode(Z.key,"Identifier"),!1):!1};Z.kind="method",Z.static=R("static");var te=this.eat(J.star),Me=!1;te||(this.options.ecmaVersion>=8&&R("async",!0)?(Me=!0,te=this.options.ecmaVersion>=9&&this.eat(J.star)):R("get")?Z.kind="get":R("set")&&(Z.kind="set")),Z.key||this.parsePropertyName(Z);var at=Z.key,Rt=!1;return!Z.computed&&!Z.static&&(at.type==="Identifier"&&at.name==="constructor"||at.type==="Literal"&&at.value==="constructor")?(Z.kind!=="method"&&this.raise(at.start,"Constructor can't have get/set modifier"),te&&this.raise(at.start,"Constructor can't be a generator"),Me&&this.raise(at.start,"Constructor can't be an async method"),Z.kind="constructor",Rt=b):Z.static&&at.type==="Identifier"&&at.name==="prototype"&&this.raise(at.start,"Classes may not have a static property named prototype"),this.parseClassMethod(Z,te,Me,Rt),Z.kind==="get"&&Z.value.params.length!==0&&this.raiseRecoverable(Z.value.start,"getter should have no params"),Z.kind==="set"&&Z.value.params.length!==1&&this.raiseRecoverable(Z.value.start,"setter should have exactly one param"),Z.kind==="set"&&Z.value.params[0].type==="RestElement"&&this.raiseRecoverable(Z.value.params[0].start,"Setter cannot use rest params"),Z},qe.parseClassMethod=function(b,k,Z,R){return b.value=this.parseMethod(k,Z,R),this.finishNode(b,"MethodDefinition")},qe.parseClassId=function(b,k){this.type===J.name?(b.id=this.parseIdent(),k&&this.checkLVal(b.id,cr,!1)):(k===!0&&this.unexpected(),b.id=null)},qe.parseClassSuper=function(b){b.superClass=this.eat(J._extends)?this.parseExprSubscripts():null},qe.parseExport=function(b,k){if(this.next(),this.eat(J.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(b.exported=this.parseIdent(!0),this.checkExport(k,b.exported.name,this.lastTokStart)):b.exported=null),this.expectContextual("from"),this.type!==J.string&&this.unexpected(),b.source=this.parseExprAtom(),this.semicolon(),this.finishNode(b,"ExportAllDeclaration");if(this.eat(J._default)){this.checkExport(k,"default",this.lastTokStart);var Z;if(this.type===J._function||(Z=this.isAsyncFunction())){var R=this.startNode();this.next(),Z&&this.next(),b.declaration=this.parseFunction(R,Pt|Pr,!1,Z)}else if(this.type===J._class){var te=this.startNode();b.declaration=this.parseClass(te,"nullableID")}else b.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(b,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())b.declaration=this.parseStatement(null),b.declaration.type==="VariableDeclaration"?this.checkVariableExport(k,b.declaration.declarations):this.checkExport(k,b.declaration.id.name,b.declaration.id.start),b.specifiers=[],b.source=null;else{if(b.declaration=null,b.specifiers=this.parseExportSpecifiers(k),this.eatContextual("from"))this.type!==J.string&&this.unexpected(),b.source=this.parseExprAtom();else{for(var Me=0,at=b.specifiers;Me<at.length;Me+=1){var Rt=at[Me];this.checkUnreserved(Rt.local),this.checkLocalExport(Rt.local)}b.source=null}this.semicolon()}return this.finishNode(b,"ExportNamedDeclaration")},qe.checkExport=function(b,k,Z){!b||(Ze(b,k)&&this.raiseRecoverable(Z,"Duplicate export '"+k+"'"),b[k]=!0)},qe.checkPatternExport=function(b,k){var Z=k.type;if(Z==="Identifier")this.checkExport(b,k.name,k.start);else if(Z==="ObjectPattern")for(var R=0,te=k.properties;R<te.length;R+=1){var Me=te[R];this.checkPatternExport(b,Me)}else if(Z==="ArrayPattern")for(var at=0,Rt=k.elements;at<Rt.length;at+=1){var Lt=Rt[at];Lt&&this.checkPatternExport(b,Lt)}else Z==="Property"?this.checkPatternExport(b,k.value):Z==="AssignmentPattern"?this.checkPatternExport(b,k.left):Z==="RestElement"?this.checkPatternExport(b,k.argument):Z==="ParenthesizedExpression"&&this.checkPatternExport(b,k.expression)},qe.checkVariableExport=function(b,k){if(!!b)for(var Z=0,R=k;Z<R.length;Z+=1){var te=R[Z];this.checkPatternExport(b,te.id)}},qe.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},qe.parseExportSpecifiers=function(b){var k=[],Z=!0;for(this.expect(J.braceL);!this.eat(J.braceR);){if(Z)Z=!1;else if(this.expect(J.comma),this.afterTrailingComma(J.braceR))break;var R=this.startNode();R.local=this.parseIdent(!0),R.exported=this.eatContextual("as")?this.parseIdent(!0):R.local,this.checkExport(b,R.exported.name,R.exported.start),k.push(this.finishNode(R,"ExportSpecifier"))}return k},qe.parseImport=function(b){return this.next(),this.type===J.string?(b.specifiers=Ye,b.source=this.parseExprAtom()):(b.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),b.source=this.type===J.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(b,"ImportDeclaration")},qe.parseImportSpecifiers=function(){var b=[],k=!0;if(this.type===J.name){var Z=this.startNode();if(Z.local=this.parseIdent(),this.checkLVal(Z.local,cr),b.push(this.finishNode(Z,"ImportDefaultSpecifier")),!this.eat(J.comma))return b}if(this.type===J.star){var R=this.startNode();return this.next(),this.expectContextual("as"),R.local=this.parseIdent(),this.checkLVal(R.local,cr),b.push(this.finishNode(R,"ImportNamespaceSpecifier")),b}for(this.expect(J.braceL);!this.eat(J.braceR);){if(k)k=!1;else if(this.expect(J.comma),this.afterTrailingComma(J.braceR))break;var te=this.startNode();te.imported=this.parseIdent(!0),this.eatContextual("as")?te.local=this.parseIdent():(this.checkUnreserved(te.imported),te.local=te.imported),this.checkLVal(te.local,cr),b.push(this.finishNode(te,"ImportSpecifier"))}return b},qe.adaptDirectivePrologue=function(b){for(var k=0;k<b.length&&this.isDirectiveCandidate(b[k]);++k)b[k].directive=b[k].expression.raw.slice(1,-1)},qe.isDirectiveCandidate=function(b){return b.type==="ExpressionStatement"&&b.expression.type==="Literal"&&typeof b.expression.value=="string"&&(this.input[b.start]==='"'||this.input[b.start]==="'")};var Wr=gt.prototype;Wr.toAssignable=function(b,k,Z){if(this.options.ecmaVersion>=6&&b)switch(b.type){case"Identifier":this.inAsync&&b.name==="await"&&this.raise(b.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":b.type="ObjectPattern",Z&&this.checkPatternErrors(Z,!0);for(var R=0,te=b.properties;R<te.length;R+=1){var Me=te[R];this.toAssignable(Me,k),Me.type==="RestElement"&&(Me.argument.type==="ArrayPattern"||Me.argument.type==="ObjectPattern")&&this.raise(Me.argument.start,"Unexpected token")}break;case"Property":b.kind!=="init"&&this.raise(b.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(b.value,k);break;case"ArrayExpression":b.type="ArrayPattern",Z&&this.checkPatternErrors(Z,!0),this.toAssignableList(b.elements,k);break;case"SpreadElement":b.type="RestElement",this.toAssignable(b.argument,k),b.argument.type==="AssignmentPattern"&&this.raise(b.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":b.operator!=="="&&this.raise(b.left.end,"Only '=' operator can be used for specifying default value."),b.type="AssignmentPattern",delete b.operator,this.toAssignable(b.left,k);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(b.expression,k,Z);break;case"ChainExpression":this.raiseRecoverable(b.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!k)break;default:this.raise(b.start,"Assigning to rvalue")}else Z&&this.checkPatternErrors(Z,!0);return b},Wr.toAssignableList=function(b,k){for(var Z=b.length,R=0;R<Z;R++){var te=b[R];te&&this.toAssignable(te,k)}if(Z){var Me=b[Z-1];this.options.ecmaVersion===6&&k&&Me&&Me.type==="RestElement"&&Me.argument.type!=="Identifier"&&this.unexpected(Me.argument.start)}return b},Wr.parseSpread=function(b){var k=this.startNode();return this.next(),k.argument=this.parseMaybeAssign(!1,b),this.finishNode(k,"SpreadElement")},Wr.parseRestBinding=function(){var b=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==J.name&&this.unexpected(),b.argument=this.parseBindingAtom(),this.finishNode(b,"RestElement")},Wr.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case J.bracketL:var b=this.startNode();return this.next(),b.elements=this.parseBindingList(J.bracketR,!0,!0),this.finishNode(b,"ArrayPattern");case J.braceL:return this.parseObj(!0)}return this.parseIdent()},Wr.parseBindingList=function(b,k,Z){for(var R=[],te=!0;!this.eat(b);)if(te?te=!1:this.expect(J.comma),k&&this.type===J.comma)R.push(null);else{if(Z&&this.afterTrailingComma(b))break;if(this.type===J.ellipsis){var Me=this.parseRestBinding();this.parseBindingListItem(Me),R.push(Me),this.type===J.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(b);break}else{var at=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(at),R.push(at)}}return R},Wr.parseBindingListItem=function(b){return b},Wr.parseMaybeDefault=function(b,k,Z){if(Z=Z||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(J.eq))return Z;var R=this.startNodeAt(b,k);return R.left=Z,R.right=this.parseMaybeAssign(),this.finishNode(R,"AssignmentPattern")},Wr.checkLVal=function(b,k,Z){switch(k===void 0&&(k=Si),b.type){case"Identifier":k===cr&&b.name==="let"&&this.raiseRecoverable(b.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(b.name)&&this.raiseRecoverable(b.start,(k?"Binding ":"Assigning to ")+b.name+" in strict mode"),Z&&(Ze(Z,b.name)&&this.raiseRecoverable(b.start,"Argument name clash"),Z[b.name]=!0),k!==Si&&k!==xa&&this.declareName(b.name,k,b.start);break;case"ChainExpression":this.raiseRecoverable(b.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":k&&this.raiseRecoverable(b.start,"Binding member expression");break;case"ObjectPattern":for(var R=0,te=b.properties;R<te.length;R+=1){var Me=te[R];this.checkLVal(Me,k,Z)}break;case"Property":this.checkLVal(b.value,k,Z);break;case"ArrayPattern":for(var at=0,Rt=b.elements;at<Rt.length;at+=1){var Lt=Rt[at];Lt&&this.checkLVal(Lt,k,Z)}break;case"AssignmentPattern":this.checkLVal(b.left,k,Z);break;case"RestElement":this.checkLVal(b.argument,k,Z);break;case"ParenthesizedExpression":this.checkLVal(b.expression,k,Z);break;default:this.raise(b.start,(k?"Binding":"Assigning to")+" rvalue")}};var tn=gt.prototype;tn.checkPropClash=function(b,k,Z){if(!(this.options.ecmaVersion>=9&&b.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(b.computed||b.method||b.shorthand))){var R=b.key,te;switch(R.type){case"Identifier":te=R.name;break;case"Literal":te=String(R.value);break;default:return}var Me=b.kind;if(this.options.ecmaVersion>=6){te==="__proto__"&&Me==="init"&&(k.proto&&(Z?Z.doubleProto<0&&(Z.doubleProto=R.start):this.raiseRecoverable(R.start,"Redefinition of __proto__ property")),k.proto=!0);return}te="$"+te;var at=k[te];if(at){var Rt;Me==="init"?Rt=this.strict&&at.init||at.get||at.set:Rt=at.init||at[Me],Rt&&this.raiseRecoverable(R.start,"Redefinition of property")}else at=k[te]={init:!1,get:!1,set:!1};at[Me]=!0}},tn.parseExpression=function(b,k){var Z=this.start,R=this.startLoc,te=this.parseMaybeAssign(b,k);if(this.type===J.comma){var Me=this.startNodeAt(Z,R);for(Me.expressions=[te];this.eat(J.comma);)Me.expressions.push(this.parseMaybeAssign(b,k));return this.finishNode(Me,"SequenceExpression")}return te},tn.parseMaybeAssign=function(b,k,Z){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(b);this.exprAllowed=!1}var R=!1,te=-1,Me=-1;k?(te=k.parenthesizedAssign,Me=k.trailingComma,k.parenthesizedAssign=k.trailingComma=-1):(k=new N,R=!0);var at=this.start,Rt=this.startLoc;(this.type===J.parenL||this.type===J.name)&&(this.potentialArrowAt=this.start);var Lt=this.parseMaybeConditional(b,k);if(Z&&(Lt=Z.call(this,Lt,at,Rt)),this.type.isAssign){var Ar=this.startNodeAt(at,Rt);return Ar.operator=this.value,Ar.left=this.type===J.eq?this.toAssignable(Lt,!1,k):Lt,R||(k.parenthesizedAssign=k.trailingComma=k.doubleProto=-1),k.shorthandAssign>=Ar.left.start&&(k.shorthandAssign=-1),this.checkLVal(Lt),this.next(),Ar.right=this.parseMaybeAssign(b),this.finishNode(Ar,"AssignmentExpression")}else R&&this.checkExpressionErrors(k,!0);return te>-1&&(k.parenthesizedAssign=te),Me>-1&&(k.trailingComma=Me),Lt},tn.parseMaybeConditional=function(b,k){var Z=this.start,R=this.startLoc,te=this.parseExprOps(b,k);if(this.checkExpressionErrors(k))return te;if(this.eat(J.question)){var Me=this.startNodeAt(Z,R);return Me.test=te,Me.consequent=this.parseMaybeAssign(),this.expect(J.colon),Me.alternate=this.parseMaybeAssign(b),this.finishNode(Me,"ConditionalExpression")}return te},tn.parseExprOps=function(b,k){var Z=this.start,R=this.startLoc,te=this.parseMaybeUnary(k,!1);return this.checkExpressionErrors(k)||te.start===Z&&te.type==="ArrowFunctionExpression"?te:this.parseExprOp(te,Z,R,-1,b)},tn.parseExprOp=function(b,k,Z,R,te){var Me=this.type.binop;if(Me!=null&&(!te||this.type!==J._in)&&Me>R){var at=this.type===J.logicalOR||this.type===J.logicalAND,Rt=this.type===J.coalesce;Rt&&(Me=J.logicalAND.binop);var Lt=this.value;this.next();var Ar=this.start,Tr=this.startLoc,Fn=this.parseExprOp(this.parseMaybeUnary(null,!1),Ar,Tr,Me,te),Ai=this.buildBinary(k,Z,b,Fn,Lt,at||Rt);return(at&&this.type===J.coalesce||Rt&&(this.type===J.logicalOR||this.type===J.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Ai,k,Z,R,te)}return b},tn.buildBinary=function(b,k,Z,R,te,Me){var at=this.startNodeAt(b,k);return at.left=Z,at.operator=te,at.right=R,this.finishNode(at,Me?"LogicalExpression":"BinaryExpression")},tn.parseMaybeUnary=function(b,k){var Z=this.start,R=this.startLoc,te;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))te=this.parseAwait(),k=!0;else if(this.type.prefix){var Me=this.startNode(),at=this.type===J.incDec;Me.operator=this.value,Me.prefix=!0,this.next(),Me.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(b,!0),at?this.checkLVal(Me.argument):this.strict&&Me.operator==="delete"&&Me.argument.type==="Identifier"?this.raiseRecoverable(Me.start,"Deleting local variable in strict mode"):k=!0,te=this.finishNode(Me,at?"UpdateExpression":"UnaryExpression")}else{if(te=this.parseExprSubscripts(b),this.checkExpressionErrors(b))return te;for(;this.type.postfix&&!this.canInsertSemicolon();){var Rt=this.startNodeAt(Z,R);Rt.operator=this.value,Rt.prefix=!1,Rt.argument=te,this.checkLVal(te),this.next(),te=this.finishNode(Rt,"UpdateExpression")}}return!k&&this.eat(J.starstar)?this.buildBinary(Z,R,te,this.parseMaybeUnary(null,!1),"**",!1):te},tn.parseExprSubscripts=function(b){var k=this.start,Z=this.startLoc,R=this.parseExprAtom(b);if(R.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return R;var te=this.parseSubscripts(R,k,Z);return b&&te.type==="MemberExpression"&&(b.parenthesizedAssign>=te.start&&(b.parenthesizedAssign=-1),b.parenthesizedBind>=te.start&&(b.parenthesizedBind=-1)),te},tn.parseSubscripts=function(b,k,Z,R){for(var te=this.options.ecmaVersion>=8&&b.type==="Identifier"&&b.name==="async"&&this.lastTokEnd===b.end&&!this.canInsertSemicolon()&&b.end-b.start==5&&this.potentialArrowAt===b.start,Me=!1;;){var at=this.parseSubscript(b,k,Z,R,te,Me);if(at.optional&&(Me=!0),at===b||at.type==="ArrowFunctionExpression"){if(Me){var Rt=this.startNodeAt(k,Z);Rt.expression=at,at=this.finishNode(Rt,"ChainExpression")}return at}b=at}},tn.parseSubscript=function(b,k,Z,R,te,Me){var at=this.options.ecmaVersion>=11,Rt=at&&this.eat(J.questionDot);R&&Rt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var Lt=this.eat(J.bracketL);if(Lt||Rt&&this.type!==J.parenL&&this.type!==J.backQuote||this.eat(J.dot)){var Ar=this.startNodeAt(k,Z);Ar.object=b,Ar.property=Lt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),Ar.computed=!!Lt,Lt&&this.expect(J.bracketR),at&&(Ar.optional=Rt),b=this.finishNode(Ar,"MemberExpression")}else if(!R&&this.eat(J.parenL)){var Tr=new N,Fn=this.yieldPos,Ai=this.awaitPos,_i=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Di=this.parseExprList(J.parenR,this.options.ecmaVersion>=8,!1,Tr);if(te&&!Rt&&!this.canInsertSemicolon()&&this.eat(J.arrow))return this.checkPatternErrors(Tr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Fn,this.awaitPos=Ai,this.awaitIdentPos=_i,this.parseArrowExpression(this.startNodeAt(k,Z),Di,!0);this.checkExpressionErrors(Tr,!0),this.yieldPos=Fn||this.yieldPos,this.awaitPos=Ai||this.awaitPos,this.awaitIdentPos=_i||this.awaitIdentPos;var Ia=this.startNodeAt(k,Z);Ia.callee=b,Ia.arguments=Di,at&&(Ia.optional=Rt),b=this.finishNode(Ia,"CallExpression")}else if(this.type===J.backQuote){(Rt||Me)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Da=this.startNodeAt(k,Z);Da.tag=b,Da.quasi=this.parseTemplate({isTagged:!0}),b=this.finishNode(Da,"TaggedTemplateExpression")}return b},tn.parseExprAtom=function(b){this.type===J.slash&&this.readRegexp();var k,Z=this.potentialArrowAt===this.start;switch(this.type){case J._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),k=this.startNode(),this.next(),this.type===J.parenL&&!this.allowDirectSuper&&this.raise(k.start,"super() call outside constructor of a subclass"),this.type!==J.dot&&this.type!==J.bracketL&&this.type!==J.parenL&&this.unexpected(),this.finishNode(k,"Super");case J._this:return k=this.startNode(),this.next(),this.finishNode(k,"ThisExpression");case J.name:var R=this.start,te=this.startLoc,Me=this.containsEsc,at=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!Me&&at.name==="async"&&!this.canInsertSemicolon()&&this.eat(J._function))return this.parseFunction(this.startNodeAt(R,te),0,!1,!0);if(Z&&!this.canInsertSemicolon()){if(this.eat(J.arrow))return this.parseArrowExpression(this.startNodeAt(R,te),[at],!1);if(this.options.ecmaVersion>=8&&at.name==="async"&&this.type===J.name&&!Me)return at=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(J.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(R,te),[at],!0)}return at;case J.regexp:var Rt=this.value;return k=this.parseLiteral(Rt.value),k.regex={pattern:Rt.pattern,flags:Rt.flags},k;case J.num:case J.string:return this.parseLiteral(this.value);case J._null:case J._true:case J._false:return k=this.startNode(),k.value=this.type===J._null?null:this.type===J._true,k.raw=this.type.keyword,this.next(),this.finishNode(k,"Literal");case J.parenL:var Lt=this.start,Ar=this.parseParenAndDistinguishExpression(Z);return b&&(b.parenthesizedAssign<0&&!this.isSimpleAssignTarget(Ar)&&(b.parenthesizedAssign=Lt),b.parenthesizedBind<0&&(b.parenthesizedBind=Lt)),Ar;case J.bracketL:return k=this.startNode(),this.next(),k.elements=this.parseExprList(J.bracketR,!0,!0,b),this.finishNode(k,"ArrayExpression");case J.braceL:return this.parseObj(!1,b);case J._function:return k=this.startNode(),this.next(),this.parseFunction(k,0);case J._class:return this.parseClass(this.startNode(),!1);case J._new:return this.parseNew();case J.backQuote:return this.parseTemplate();case J._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},tn.parseExprImport=function(){var b=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var k=this.parseIdent(!0);switch(this.type){case J.parenL:return this.parseDynamicImport(b);case J.dot:return b.meta=k,this.parseImportMeta(b);default:this.unexpected()}},tn.parseDynamicImport=function(b){if(this.next(),b.source=this.parseMaybeAssign(),!this.eat(J.parenR)){var k=this.start;this.eat(J.comma)&&this.eat(J.parenR)?this.raiseRecoverable(k,"Trailing comma is not allowed in import()"):this.unexpected(k)}return this.finishNode(b,"ImportExpression")},tn.parseImportMeta=function(b){this.next();var k=this.containsEsc;return b.property=this.parseIdent(!0),b.property.name!=="meta"&&this.raiseRecoverable(b.property.start,"The only valid meta property for import is 'import.meta'"),k&&this.raiseRecoverable(b.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(b.start,"Cannot use 'import.meta' outside a module"),this.finishNode(b,"MetaProperty")},tn.parseLiteral=function(b){var k=this.startNode();return k.value=b,k.raw=this.input.slice(this.start,this.end),k.raw.charCodeAt(k.raw.length-1)===110&&(k.bigint=k.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(k,"Literal")},tn.parseParenExpression=function(){this.expect(J.parenL);var b=this.parseExpression();return this.expect(J.parenR),b},tn.parseParenAndDistinguishExpression=function(b){var k=this.start,Z=this.startLoc,R,te=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var Me=this.start,at=this.startLoc,Rt=[],Lt=!0,Ar=!1,Tr=new N,Fn=this.yieldPos,Ai=this.awaitPos,_i;for(this.yieldPos=0,this.awaitPos=0;this.type!==J.parenR;)if(Lt?Lt=!1:this.expect(J.comma),te&&this.afterTrailingComma(J.parenR,!0)){Ar=!0;break}else if(this.type===J.ellipsis){_i=this.start,Rt.push(this.parseParenItem(this.parseRestBinding())),this.type===J.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Rt.push(this.parseMaybeAssign(!1,Tr,this.parseParenItem));var Di=this.start,Ia=this.startLoc;if(this.expect(J.parenR),b&&!this.canInsertSemicolon()&&this.eat(J.arrow))return this.checkPatternErrors(Tr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Fn,this.awaitPos=Ai,this.parseParenArrowList(k,Z,Rt);(!Rt.length||Ar)&&this.unexpected(this.lastTokStart),_i&&this.unexpected(_i),this.checkExpressionErrors(Tr,!0),this.yieldPos=Fn||this.yieldPos,this.awaitPos=Ai||this.awaitPos,Rt.length>1?(R=this.startNodeAt(Me,at),R.expressions=Rt,this.finishNodeAt(R,"SequenceExpression",Di,Ia)):R=Rt[0]}else R=this.parseParenExpression();if(this.options.preserveParens){var Da=this.startNodeAt(k,Z);return Da.expression=R,this.finishNode(Da,"ParenthesizedExpression")}else return R},tn.parseParenItem=function(b){return b},tn.parseParenArrowList=function(b,k,Z){return this.parseArrowExpression(this.startNodeAt(b,k),Z)};var Yn=[];tn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var b=this.startNode(),k=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(J.dot)){b.meta=k;var Z=this.containsEsc;return b.property=this.parseIdent(!0),b.property.name!=="target"&&this.raiseRecoverable(b.property.start,"The only valid meta property for new is 'new.target'"),Z&&this.raiseRecoverable(b.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(b.start,"'new.target' can only be used in functions"),this.finishNode(b,"MetaProperty")}var R=this.start,te=this.startLoc,Me=this.type===J._import;return b.callee=this.parseSubscripts(this.parseExprAtom(),R,te,!0),Me&&b.callee.type==="ImportExpression"&&this.raise(R,"Cannot use new with import()"),this.eat(J.parenL)?b.arguments=this.parseExprList(J.parenR,this.options.ecmaVersion>=8,!1):b.arguments=Yn,this.finishNode(b,"NewExpression")},tn.parseTemplateElement=function(b){var k=b.isTagged,Z=this.startNode();return this.type===J.invalidTemplate?(k||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),Z.value={raw:this.value,cooked:null}):Z.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),Z.tail=this.type===J.backQuote,this.finishNode(Z,"TemplateElement")},tn.parseTemplate=function(b){b===void 0&&(b={});var k=b.isTagged;k===void 0&&(k=!1);var Z=this.startNode();this.next(),Z.expressions=[];var R=this.parseTemplateElement({isTagged:k});for(Z.quasis=[R];!R.tail;)this.type===J.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(J.dollarBraceL),Z.expressions.push(this.parseExpression()),this.expect(J.braceR),Z.quasis.push(R=this.parseTemplateElement({isTagged:k}));return this.next(),this.finishNode(Z,"TemplateLiteral")},tn.isAsyncProp=function(b){return!b.computed&&b.key.type==="Identifier"&&b.key.name==="async"&&(this.type===J.name||this.type===J.num||this.type===J.string||this.type===J.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===J.star)&&!Et.test(this.input.slice(this.lastTokEnd,this.start))},tn.parseObj=function(b,k){var Z=this.startNode(),R=!0,te={};for(Z.properties=[],this.next();!this.eat(J.braceR);){if(R)R=!1;else if(this.expect(J.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(J.braceR))break;var Me=this.parseProperty(b,k);b||this.checkPropClash(Me,te,k),Z.properties.push(Me)}return this.finishNode(Z,b?"ObjectPattern":"ObjectExpression")},tn.parseProperty=function(b,k){var Z=this.startNode(),R,te,Me,at;if(this.options.ecmaVersion>=9&&this.eat(J.ellipsis))return b?(Z.argument=this.parseIdent(!1),this.type===J.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(Z,"RestElement")):(this.type===J.parenL&&k&&(k.parenthesizedAssign<0&&(k.parenthesizedAssign=this.start),k.parenthesizedBind<0&&(k.parenthesizedBind=this.start)),Z.argument=this.parseMaybeAssign(!1,k),this.type===J.comma&&k&&k.trailingComma<0&&(k.trailingComma=this.start),this.finishNode(Z,"SpreadElement"));this.options.ecmaVersion>=6&&(Z.method=!1,Z.shorthand=!1,(b||k)&&(Me=this.start,at=this.startLoc),b||(R=this.eat(J.star)));var Rt=this.containsEsc;return this.parsePropertyName(Z),!b&&!Rt&&this.options.ecmaVersion>=8&&!R&&this.isAsyncProp(Z)?(te=!0,R=this.options.ecmaVersion>=9&&this.eat(J.star),this.parsePropertyName(Z,k)):te=!1,this.parsePropertyValue(Z,b,R,te,Me,at,k,Rt),this.finishNode(Z,"Property")},tn.parsePropertyValue=function(b,k,Z,R,te,Me,at,Rt){if((Z||R)&&this.type===J.colon&&this.unexpected(),this.eat(J.colon))b.value=k?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,at),b.kind="init";else if(this.options.ecmaVersion>=6&&this.type===J.parenL)k&&this.unexpected(),b.kind="init",b.method=!0,b.value=this.parseMethod(Z,R);else if(!k&&!Rt&&this.options.ecmaVersion>=5&&!b.computed&&b.key.type==="Identifier"&&(b.key.name==="get"||b.key.name==="set")&&this.type!==J.comma&&this.type!==J.braceR&&this.type!==J.eq){(Z||R)&&this.unexpected(),b.kind=b.key.name,this.parsePropertyName(b),b.value=this.parseMethod(!1);var Lt=b.kind==="get"?0:1;if(b.value.params.length!==Lt){var Ar=b.value.start;b.kind==="get"?this.raiseRecoverable(Ar,"getter should have no params"):this.raiseRecoverable(Ar,"setter should have exactly one param")}else b.kind==="set"&&b.value.params[0].type==="RestElement"&&this.raiseRecoverable(b.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!b.computed&&b.key.type==="Identifier"?((Z||R)&&this.unexpected(),this.checkUnreserved(b.key),b.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=te),b.kind="init",k?b.value=this.parseMaybeDefault(te,Me,b.key):this.type===J.eq&&at?(at.shorthandAssign<0&&(at.shorthandAssign=this.start),b.value=this.parseMaybeDefault(te,Me,b.key)):b.value=b.key,b.shorthand=!0):this.unexpected()},tn.parsePropertyName=function(b){if(this.options.ecmaVersion>=6){if(this.eat(J.bracketL))return b.computed=!0,b.key=this.parseMaybeAssign(),this.expect(J.bracketR),b.key;b.computed=!1}return b.key=this.type===J.num||this.type===J.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},tn.initFunction=function(b){b.id=null,this.options.ecmaVersion>=6&&(b.generator=b.expression=!1),this.options.ecmaVersion>=8&&(b.async=!1)},tn.parseMethod=function(b,k,Z){var R=this.startNode(),te=this.yieldPos,Me=this.awaitPos,at=this.awaitIdentPos;return this.initFunction(R),this.options.ecmaVersion>=6&&(R.generator=b),this.options.ecmaVersion>=8&&(R.async=!!k),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Gi(k,R.generator)|mi|(Z?ca:0)),this.expect(J.parenL),R.params=this.parseBindingList(J.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(R,!1,!0),this.yieldPos=te,this.awaitPos=Me,this.awaitIdentPos=at,this.finishNode(R,"FunctionExpression")},tn.parseArrowExpression=function(b,k,Z){var R=this.yieldPos,te=this.awaitPos,Me=this.awaitIdentPos;return this.enterScope(Gi(Z,!1)|ma),this.initFunction(b),this.options.ecmaVersion>=8&&(b.async=!!Z),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,b.params=this.toAssignableList(k,!0),this.parseFunctionBody(b,!0,!1),this.yieldPos=R,this.awaitPos=te,this.awaitIdentPos=Me,this.finishNode(b,"ArrowFunctionExpression")},tn.parseFunctionBody=function(b,k,Z){var R=k&&this.type!==J.braceL,te=this.strict,Me=!1;if(R)b.body=this.parseMaybeAssign(),b.expression=!0,this.checkParams(b,!1);else{var at=this.options.ecmaVersion>=7&&!this.isSimpleParamList(b.params);(!te||at)&&(Me=this.strictDirective(this.end),Me&&at&&this.raiseRecoverable(b.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Rt=this.labels;this.labels=[],Me&&(this.strict=!0),this.checkParams(b,!te&&!Me&&!k&&!Z&&this.isSimpleParamList(b.params)),this.strict&&b.id&&this.checkLVal(b.id,xa),b.body=this.parseBlock(!1,void 0,Me&&!te),b.expression=!1,this.adaptDirectivePrologue(b.body.body),this.labels=Rt}this.exitScope()},tn.isSimpleParamList=function(b){for(var k=0,Z=b;k<Z.length;k+=1){var R=Z[k];if(R.type!=="Identifier")return!1}return!0},tn.checkParams=function(b,k){for(var Z={},R=0,te=b.params;R<te.length;R+=1){var Me=te[R];this.checkLVal(Me,ei,k?null:Z)}},tn.parseExprList=function(b,k,Z,R){for(var te=[],Me=!0;!this.eat(b);){if(Me)Me=!1;else if(this.expect(J.comma),k&&this.afterTrailingComma(b))break;var at=void 0;Z&&this.type===J.comma?at=null:this.type===J.ellipsis?(at=this.parseSpread(R),R&&this.type===J.comma&&R.trailingComma<0&&(R.trailingComma=this.start)):at=this.parseMaybeAssign(!1,R),te.push(at)}return te},tn.checkUnreserved=function(b){var k=b.start,Z=b.end,R=b.name;if(this.inGenerator&&R==="yield"&&this.raiseRecoverable(k,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&R==="await"&&this.raiseRecoverable(k,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(R)&&this.raise(k,"Unexpected keyword '"+R+"'"),!(this.options.ecmaVersion<6&&this.input.slice(k,Z).indexOf("\\")!==-1)){var te=this.strict?this.reservedWordsStrict:this.reservedWords;te.test(R)&&(!this.inAsync&&R==="await"&&this.raiseRecoverable(k,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(k,"The keyword '"+R+"' is reserved"))}},tn.parseIdent=function(b,k){var Z=this.startNode();return this.type===J.name?Z.name=this.value:this.type.keyword?(Z.name=this.type.keyword,(Z.name==="class"||Z.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!b),this.finishNode(Z,"Identifier"),b||(this.checkUnreserved(Z),Z.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=Z.start)),Z},tn.parseYield=function(b){this.yieldPos||(this.yieldPos=this.start);var k=this.startNode();return this.next(),this.type===J.semi||this.canInsertSemicolon()||this.type!==J.star&&!this.type.startsExpr?(k.delegate=!1,k.argument=null):(k.delegate=this.eat(J.star),k.argument=this.parseMaybeAssign(b)),this.finishNode(k,"YieldExpression")},tn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var b=this.startNode();return this.next(),b.argument=this.parseMaybeUnary(null,!1),this.finishNode(b,"AwaitExpression")};var jn=gt.prototype;jn.raise=function(b,k){var Z=lt(this.input,b);k+=" ("+Z.line+":"+Z.column+")";var R=new SyntaxError(k);throw R.pos=b,R.loc=Z,R.raisedAt=this.pos,R},jn.raiseRecoverable=jn.raise,jn.curPosition=function(){if(this.options.locations)return new ue(this.curLine,this.pos-this.lineStart)};var an=gt.prototype,gi=function(k){this.flags=k,this.var=[],this.lexical=[],this.functions=[]};an.enterScope=function(b){this.scopeStack.push(new gi(b))},an.exitScope=function(){this.scopeStack.pop()},an.treatFunctionsAsVarInScope=function(b){return b.flags&Hr||!this.inModule&&b.flags&Yr},an.declareName=function(b,k,Z){var R=!1;if(k===cr){var te=this.currentScope();R=te.lexical.indexOf(b)>-1||te.functions.indexOf(b)>-1||te.var.indexOf(b)>-1,te.lexical.push(b),this.inModule&&te.flags&Yr&&delete this.undefinedExports[b]}else if(k===Wa){var Me=this.currentScope();Me.lexical.push(b)}else if(k===mt){var at=this.currentScope();this.treatFunctionsAsVar?R=at.lexical.indexOf(b)>-1:R=at.lexical.indexOf(b)>-1||at.var.indexOf(b)>-1,at.functions.push(b)}else for(var Rt=this.scopeStack.length-1;Rt>=0;--Rt){var Lt=this.scopeStack[Rt];if(Lt.lexical.indexOf(b)>-1&&!(Lt.flags&Pi&&Lt.lexical[0]===b)||!this.treatFunctionsAsVarInScope(Lt)&&Lt.functions.indexOf(b)>-1){R=!0;break}if(Lt.var.push(b),this.inModule&&Lt.flags&Yr&&delete this.undefinedExports[b],Lt.flags&vi)break}R&&this.raiseRecoverable(Z,"Identifier '"+b+"' has already been declared")},an.checkLocalExport=function(b){this.scopeStack[0].lexical.indexOf(b.name)===-1&&this.scopeStack[0].var.indexOf(b.name)===-1&&(this.undefinedExports[b.name]=b)},an.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},an.currentVarScope=function(){for(var b=this.scopeStack.length-1;;b--){var k=this.scopeStack[b];if(k.flags&vi)return k}},an.currentThisScope=function(){for(var b=this.scopeStack.length-1;;b--){var k=this.scopeStack[b];if(k.flags&vi&&!(k.flags&ma))return k}};var ci=function(k,Z,R){this.type="",this.start=Z,this.end=0,k.options.locations&&(this.loc=new Xe(k,R)),k.options.directSourceFile&&(this.sourceFile=k.options.directSourceFile),k.options.ranges&&(this.range=[Z,0])},fa=gt.prototype;fa.startNode=function(){return new ci(this,this.start,this.startLoc)},fa.startNodeAt=function(b,k){return new ci(this,b,k)};function ka(b,k,Z,R){return b.type=k,b.end=Z,this.options.locations&&(b.loc.end=R),this.options.ranges&&(b.range[1]=Z),b}fa.finishNode=function(b,k){return ka.call(this,b,k,this.lastTokEnd,this.lastTokEndLoc)},fa.finishNodeAt=function(b,k,Z,R){return ka.call(this,b,k,Z,R)};var Ua=function(k,Z,R,te,Me){this.token=k,this.isExpr=!!Z,this.preserveSpace=!!R,this.override=te,this.generator=!!Me},Ea={b_stat:new Ua("{",!1),b_expr:new Ua("{",!0),b_tmpl:new Ua("${",!1),p_stat:new Ua("(",!1),p_expr:new Ua("(",!0),q_tmpl:new Ua("`",!0,!0,function(b){return b.tryReadTemplateToken()}),f_stat:new Ua("function",!1),f_expr:new Ua("function",!0),f_expr_gen:new Ua("function",!0,!1,null,!0),f_gen:new Ua("function",!1,!1,null,!0)},Wi=gt.prototype;Wi.initialContext=function(){return[Ea.b_stat]},Wi.braceIsBlock=function(b){var k=this.curContext();return k===Ea.f_expr||k===Ea.f_stat?!0:b===J.colon&&(k===Ea.b_stat||k===Ea.b_expr)?!k.isExpr:b===J._return||b===J.name&&this.exprAllowed?Et.test(this.input.slice(this.lastTokEnd,this.start)):b===J._else||b===J.semi||b===J.eof||b===J.parenR||b===J.arrow?!0:b===J.braceL?k===Ea.b_stat:b===J._var||b===J._const||b===J.name?!1:!this.exprAllowed},Wi.inGeneratorContext=function(){for(var b=this.context.length-1;b>=1;b--){var k=this.context[b];if(k.token==="function")return k.generator}return!1},Wi.updateContext=function(b){var k,Z=this.type;Z.keyword&&b===J.dot?this.exprAllowed=!1:(k=Z.updateContext)?k.call(this,b):this.exprAllowed=Z.beforeExpr},J.parenR.updateContext=J.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var b=this.context.pop();b===Ea.b_stat&&this.curContext().token==="function"&&(b=this.context.pop()),this.exprAllowed=!b.isExpr},J.braceL.updateContext=function(b){this.context.push(this.braceIsBlock(b)?Ea.b_stat:Ea.b_expr),this.exprAllowed=!0},J.dollarBraceL.updateContext=function(){this.context.push(Ea.b_tmpl),this.exprAllowed=!0},J.parenL.updateContext=function(b){var k=b===J._if||b===J._for||b===J._with||b===J._while;this.context.push(k?Ea.p_stat:Ea.p_expr),this.exprAllowed=!0},J.incDec.updateContext=function(){},J._function.updateContext=J._class.updateContext=function(b){b.beforeExpr&&b!==J.semi&&b!==J._else&&!(b===J._return&&Et.test(this.input.slice(this.lastTokEnd,this.start)))&&!((b===J.colon||b===J.braceL)&&this.curContext()===Ea.b_stat)?this.context.push(Ea.f_expr):this.context.push(Ea.f_stat),this.exprAllowed=!1},J.backQuote.updateContext=function(){this.curContext()===Ea.q_tmpl?this.context.pop():this.context.push(Ea.q_tmpl),this.exprAllowed=!1},J.star.updateContext=function(b){if(b===J._function){var k=this.context.length-1;this.context[k]===Ea.f_expr?this.context[k]=Ea.f_expr_gen:this.context[k]=Ea.f_gen}this.exprAllowed=!0},J.name.updateContext=function(b){var k=!1;this.options.ecmaVersion>=6&&b!==J.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(k=!0),this.exprAllowed=k};var q="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",re=q+" Extended_Pictographic",le=re,Ce={9:q,10:re,11:le},Be="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",et="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",dt=et+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",me=dt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Ge={9:et,10:dt,11:me},Dt={};function Lr(b){var k=Dt[b]={binary:ce(Ce[b]+" "+Be),nonBinary:{General_Category:ce(Be),Script:ce(Ge[b])}};k.nonBinary.Script_Extensions=k.nonBinary.Script,k.nonBinary.gc=k.nonBinary.General_Category,k.nonBinary.sc=k.nonBinary.Script,k.nonBinary.scx=k.nonBinary.Script_Extensions}Lr(9),Lr(10),Lr(11);var er=gt.prototype,tr=function(k){this.parser=k,this.validFlags="gim"+(k.options.ecmaVersion>=6?"uy":"")+(k.options.ecmaVersion>=9?"s":""),this.unicodeProperties=Dt[k.options.ecmaVersion>=11?11:k.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};tr.prototype.reset=function(k,Z,R){var te=R.indexOf("u")!==-1;this.start=k|0,this.source=Z+"",this.flags=R,this.switchU=te&&this.parser.options.ecmaVersion>=6,this.switchN=te&&this.parser.options.ecmaVersion>=9},tr.prototype.raise=function(k){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+k)},tr.prototype.at=function(k,Z){Z===void 0&&(Z=!1);var R=this.source,te=R.length;if(k>=te)return-1;var Me=R.charCodeAt(k);if(!(Z||this.switchU)||Me<=55295||Me>=57344||k+1>=te)return Me;var at=R.charCodeAt(k+1);return at>=56320&&at<=57343?(Me<<10)+at-56613888:Me},tr.prototype.nextIndex=function(k,Z){Z===void 0&&(Z=!1);var R=this.source,te=R.length;if(k>=te)return te;var Me=R.charCodeAt(k),at;return!(Z||this.switchU)||Me<=55295||Me>=57344||k+1>=te||(at=R.charCodeAt(k+1))<56320||at>57343?k+1:k+2},tr.prototype.current=function(k){return k===void 0&&(k=!1),this.at(this.pos,k)},tr.prototype.lookahead=function(k){return k===void 0&&(k=!1),this.at(this.nextIndex(this.pos,k),k)},tr.prototype.advance=function(k){k===void 0&&(k=!1),this.pos=this.nextIndex(this.pos,k)},tr.prototype.eat=function(k,Z){return Z===void 0&&(Z=!1),this.current(Z)===k?(this.advance(Z),!0):!1};function Fr(b){return b<=65535?String.fromCharCode(b):(b-=65536,String.fromCharCode((b>>10)+55296,(b&1023)+56320))}er.validateRegExpFlags=function(b){for(var k=b.validFlags,Z=b.flags,R=0;R<Z.length;R++){var te=Z.charAt(R);k.indexOf(te)===-1&&this.raise(b.start,"Invalid regular expression flag"),Z.indexOf(te,R+1)>-1&&this.raise(b.start,"Duplicate regular expression flag")}},er.validateRegExpPattern=function(b){this.regexp_pattern(b),!b.switchN&&this.options.ecmaVersion>=9&&b.groupNames.length>0&&(b.switchN=!0,this.regexp_pattern(b))},er.regexp_pattern=function(b){b.pos=0,b.lastIntValue=0,b.lastStringValue="",b.lastAssertionIsQuantifiable=!1,b.numCapturingParens=0,b.maxBackReference=0,b.groupNames.length=0,b.backReferenceNames.length=0,this.regexp_disjunction(b),b.pos!==b.source.length&&(b.eat(41)&&b.raise("Unmatched ')'"),(b.eat(93)||b.eat(125))&&b.raise("Lone quantifier brackets")),b.maxBackReference>b.numCapturingParens&&b.raise("Invalid escape");for(var k=0,Z=b.backReferenceNames;k<Z.length;k+=1){var R=Z[k];b.groupNames.indexOf(R)===-1&&b.raise("Invalid named capture referenced")}},er.regexp_disjunction=function(b){for(this.regexp_alternative(b);b.eat(124);)this.regexp_alternative(b);this.regexp_eatQuantifier(b,!0)&&b.raise("Nothing to repeat"),b.eat(123)&&b.raise("Lone quantifier brackets")},er.regexp_alternative=function(b){for(;b.pos<b.source.length&&this.regexp_eatTerm(b););},er.regexp_eatTerm=function(b){return this.regexp_eatAssertion(b)?(b.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(b)&&b.switchU&&b.raise("Invalid quantifier"),!0):(b.switchU?this.regexp_eatAtom(b):this.regexp_eatExtendedAtom(b))?(this.regexp_eatQuantifier(b),!0):!1},er.regexp_eatAssertion=function(b){var k=b.pos;if(b.lastAssertionIsQuantifiable=!1,b.eat(94)||b.eat(36))return!0;if(b.eat(92)){if(b.eat(66)||b.eat(98))return!0;b.pos=k}if(b.eat(40)&&b.eat(63)){var Z=!1;if(this.options.ecmaVersion>=9&&(Z=b.eat(60)),b.eat(61)||b.eat(33))return this.regexp_disjunction(b),b.eat(41)||b.raise("Unterminated group"),b.lastAssertionIsQuantifiable=!Z,!0}return b.pos=k,!1},er.regexp_eatQuantifier=function(b,k){return k===void 0&&(k=!1),this.regexp_eatQuantifierPrefix(b,k)?(b.eat(63),!0):!1},er.regexp_eatQuantifierPrefix=function(b,k){return b.eat(42)||b.eat(43)||b.eat(63)||this.regexp_eatBracedQuantifier(b,k)},er.regexp_eatBracedQuantifier=function(b,k){var Z=b.pos;if(b.eat(123)){var R=0,te=-1;if(this.regexp_eatDecimalDigits(b)&&(R=b.lastIntValue,b.eat(44)&&this.regexp_eatDecimalDigits(b)&&(te=b.lastIntValue),b.eat(125)))return te!==-1&&te<R&&!k&&b.raise("numbers out of order in {} quantifier"),!0;b.switchU&&!k&&b.raise("Incomplete quantifier"),b.pos=Z}return!1},er.regexp_eatAtom=function(b){return this.regexp_eatPatternCharacters(b)||b.eat(46)||this.regexp_eatReverseSolidusAtomEscape(b)||this.regexp_eatCharacterClass(b)||this.regexp_eatUncapturingGroup(b)||this.regexp_eatCapturingGroup(b)},er.regexp_eatReverseSolidusAtomEscape=function(b){var k=b.pos;if(b.eat(92)){if(this.regexp_eatAtomEscape(b))return!0;b.pos=k}return!1},er.regexp_eatUncapturingGroup=function(b){var k=b.pos;if(b.eat(40)){if(b.eat(63)&&b.eat(58)){if(this.regexp_disjunction(b),b.eat(41))return!0;b.raise("Unterminated group")}b.pos=k}return!1},er.regexp_eatCapturingGroup=function(b){if(b.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(b):b.current()===63&&b.raise("Invalid group"),this.regexp_disjunction(b),b.eat(41))return b.numCapturingParens+=1,!0;b.raise("Unterminated group")}return!1},er.regexp_eatExtendedAtom=function(b){return b.eat(46)||this.regexp_eatReverseSolidusAtomEscape(b)||this.regexp_eatCharacterClass(b)||this.regexp_eatUncapturingGroup(b)||this.regexp_eatCapturingGroup(b)||this.regexp_eatInvalidBracedQuantifier(b)||this.regexp_eatExtendedPatternCharacter(b)},er.regexp_eatInvalidBracedQuantifier=function(b){return this.regexp_eatBracedQuantifier(b,!0)&&b.raise("Nothing to repeat"),!1},er.regexp_eatSyntaxCharacter=function(b){var k=b.current();return In(k)?(b.lastIntValue=k,b.advance(),!0):!1};function In(b){return b===36||b>=40&&b<=43||b===46||b===63||b>=91&&b<=94||b>=123&&b<=125}er.regexp_eatPatternCharacters=function(b){for(var k=b.pos,Z=0;(Z=b.current())!==-1&&!In(Z);)b.advance();return b.pos!==k},er.regexp_eatExtendedPatternCharacter=function(b){var k=b.current();return k!==-1&&k!==36&&!(k>=40&&k<=43)&&k!==46&&k!==63&&k!==91&&k!==94&&k!==124?(b.advance(),!0):!1},er.regexp_groupSpecifier=function(b){if(b.eat(63)){if(this.regexp_eatGroupName(b)){b.groupNames.indexOf(b.lastStringValue)!==-1&&b.raise("Duplicate capture group name"),b.groupNames.push(b.lastStringValue);return}b.raise("Invalid group")}},er.regexp_eatGroupName=function(b){if(b.lastStringValue="",b.eat(60)){if(this.regexp_eatRegExpIdentifierName(b)&&b.eat(62))return!0;b.raise("Invalid capture group name")}return!1},er.regexp_eatRegExpIdentifierName=function(b){if(b.lastStringValue="",this.regexp_eatRegExpIdentifierStart(b)){for(b.lastStringValue+=Fr(b.lastIntValue);this.regexp_eatRegExpIdentifierPart(b);)b.lastStringValue+=Fr(b.lastIntValue);return!0}return!1},er.regexp_eatRegExpIdentifierStart=function(b){var k=b.pos,Z=this.options.ecmaVersion>=11,R=b.current(Z);return b.advance(Z),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(b,Z)&&(R=b.lastIntValue),Pn(R)?(b.lastIntValue=R,!0):(b.pos=k,!1)};function Pn(b){return Ot(b,!0)||b===36||b===95}er.regexp_eatRegExpIdentifierPart=function(b){var k=b.pos,Z=this.options.ecmaVersion>=11,R=b.current(Z);return b.advance(Z),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(b,Z)&&(R=b.lastIntValue),$t(R)?(b.lastIntValue=R,!0):(b.pos=k,!1)};function $t(b){return vr(b,!0)||b===36||b===95||b===8204||b===8205}er.regexp_eatAtomEscape=function(b){return this.regexp_eatBackReference(b)||this.regexp_eatCharacterClassEscape(b)||this.regexp_eatCharacterEscape(b)||b.switchN&&this.regexp_eatKGroupName(b)?!0:(b.switchU&&(b.current()===99&&b.raise("Invalid unicode escape"),b.raise("Invalid escape")),!1)},er.regexp_eatBackReference=function(b){var k=b.pos;if(this.regexp_eatDecimalEscape(b)){var Z=b.lastIntValue;if(b.switchU)return Z>b.maxBackReference&&(b.maxBackReference=Z),!0;if(Z<=b.numCapturingParens)return!0;b.pos=k}return!1},er.regexp_eatKGroupName=function(b){if(b.eat(107)){if(this.regexp_eatGroupName(b))return b.backReferenceNames.push(b.lastStringValue),!0;b.raise("Invalid named reference")}return!1},er.regexp_eatCharacterEscape=function(b){return this.regexp_eatControlEscape(b)||this.regexp_eatCControlLetter(b)||this.regexp_eatZero(b)||this.regexp_eatHexEscapeSequence(b)||this.regexp_eatRegExpUnicodeEscapeSequence(b,!1)||!b.switchU&&this.regexp_eatLegacyOctalEscapeSequence(b)||this.regexp_eatIdentityEscape(b)},er.regexp_eatCControlLetter=function(b){var k=b.pos;if(b.eat(99)){if(this.regexp_eatControlLetter(b))return!0;b.pos=k}return!1},er.regexp_eatZero=function(b){return b.current()===48&&!Ni(b.lookahead())?(b.lastIntValue=0,b.advance(),!0):!1},er.regexp_eatControlEscape=function(b){var k=b.current();return k===116?(b.lastIntValue=9,b.advance(),!0):k===110?(b.lastIntValue=10,b.advance(),!0):k===118?(b.lastIntValue=11,b.advance(),!0):k===102?(b.lastIntValue=12,b.advance(),!0):k===114?(b.lastIntValue=13,b.advance(),!0):!1},er.regexp_eatControlLetter=function(b){var k=b.current();return wn(k)?(b.lastIntValue=k%32,b.advance(),!0):!1};function wn(b){return b>=65&&b<=90||b>=97&&b<=122}er.regexp_eatRegExpUnicodeEscapeSequence=function(b,k){k===void 0&&(k=!1);var Z=b.pos,R=k||b.switchU;if(b.eat(117)){if(this.regexp_eatFixedHexDigits(b,4)){var te=b.lastIntValue;if(R&&te>=55296&&te<=56319){var Me=b.pos;if(b.eat(92)&&b.eat(117)&&this.regexp_eatFixedHexDigits(b,4)){var at=b.lastIntValue;if(at>=56320&&at<=57343)return b.lastIntValue=(te-55296)*1024+(at-56320)+65536,!0}b.pos=Me,b.lastIntValue=te}return!0}if(R&&b.eat(123)&&this.regexp_eatHexDigits(b)&&b.eat(125)&&fn(b.lastIntValue))return!0;R&&b.raise("Invalid unicode escape"),b.pos=Z}return!1};function fn(b){return b>=0&&b<=1114111}er.regexp_eatIdentityEscape=function(b){if(b.switchU)return this.regexp_eatSyntaxCharacter(b)?!0:b.eat(47)?(b.lastIntValue=47,!0):!1;var k=b.current();return k!==99&&(!b.switchN||k!==107)?(b.lastIntValue=k,b.advance(),!0):!1},er.regexp_eatDecimalEscape=function(b){b.lastIntValue=0;var k=b.current();if(k>=49&&k<=57){do b.lastIntValue=10*b.lastIntValue+(k-48),b.advance();while((k=b.current())>=48&&k<=57);return!0}return!1},er.regexp_eatCharacterClassEscape=function(b){var k=b.current();if(gn(k))return b.lastIntValue=-1,b.advance(),!0;if(b.switchU&&this.options.ecmaVersion>=9&&(k===80||k===112)){if(b.lastIntValue=-1,b.advance(),b.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(b)&&b.eat(125))return!0;b.raise("Invalid property name")}return!1};function gn(b){return b===100||b===68||b===115||b===83||b===119||b===87}er.regexp_eatUnicodePropertyValueExpression=function(b){var k=b.pos;if(this.regexp_eatUnicodePropertyName(b)&&b.eat(61)){var Z=b.lastStringValue;if(this.regexp_eatUnicodePropertyValue(b)){var R=b.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(b,Z,R),!0}}if(b.pos=k,this.regexp_eatLoneUnicodePropertyNameOrValue(b)){var te=b.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(b,te),!0}return!1},er.regexp_validateUnicodePropertyNameAndValue=function(b,k,Z){Ze(b.unicodeProperties.nonBinary,k)||b.raise("Invalid property name"),b.unicodeProperties.nonBinary[k].test(Z)||b.raise("Invalid property value")},er.regexp_validateUnicodePropertyNameOrValue=function(b,k){b.unicodeProperties.binary.test(k)||b.raise("Invalid property name")},er.regexp_eatUnicodePropertyName=function(b){var k=0;for(b.lastStringValue="";Ii(k=b.current());)b.lastStringValue+=Fr(k),b.advance();return b.lastStringValue!==""};function Ii(b){return wn(b)||b===95}er.regexp_eatUnicodePropertyValue=function(b){var k=0;for(b.lastStringValue="";xn(k=b.current());)b.lastStringValue+=Fr(k),b.advance();return b.lastStringValue!==""};function xn(b){return Ii(b)||Ni(b)}er.regexp_eatLoneUnicodePropertyNameOrValue=function(b){return this.regexp_eatUnicodePropertyValue(b)},er.regexp_eatCharacterClass=function(b){if(b.eat(91)){if(b.eat(94),this.regexp_classRanges(b),b.eat(93))return!0;b.raise("Unterminated character class")}return!1},er.regexp_classRanges=function(b){for(;this.regexp_eatClassAtom(b);){var k=b.lastIntValue;if(b.eat(45)&&this.regexp_eatClassAtom(b)){var Z=b.lastIntValue;b.switchU&&(k===-1||Z===-1)&&b.raise("Invalid character class"),k!==-1&&Z!==-1&&k>Z&&b.raise("Range out of order in character class")}}},er.regexp_eatClassAtom=function(b){var k=b.pos;if(b.eat(92)){if(this.regexp_eatClassEscape(b))return!0;if(b.switchU){var Z=b.current();(Z===99||Zi(Z))&&b.raise("Invalid class escape"),b.raise("Invalid escape")}b.pos=k}var R=b.current();return R!==93?(b.lastIntValue=R,b.advance(),!0):!1},er.regexp_eatClassEscape=function(b){var k=b.pos;if(b.eat(98))return b.lastIntValue=8,!0;if(b.switchU&&b.eat(45))return b.lastIntValue=45,!0;if(!b.switchU&&b.eat(99)){if(this.regexp_eatClassControlLetter(b))return!0;b.pos=k}return this.regexp_eatCharacterClassEscape(b)||this.regexp_eatCharacterEscape(b)},er.regexp_eatClassControlLetter=function(b){var k=b.current();return Ni(k)||k===95?(b.lastIntValue=k%32,b.advance(),!0):!1},er.regexp_eatHexEscapeSequence=function(b){var k=b.pos;if(b.eat(120)){if(this.regexp_eatFixedHexDigits(b,2))return!0;b.switchU&&b.raise("Invalid escape"),b.pos=k}return!1},er.regexp_eatDecimalDigits=function(b){var k=b.pos,Z=0;for(b.lastIntValue=0;Ni(Z=b.current());)b.lastIntValue=10*b.lastIntValue+(Z-48),b.advance();return b.pos!==k};function Ni(b){return b>=48&&b<=57}er.regexp_eatHexDigits=function(b){var k=b.pos,Z=0;for(b.lastIntValue=0;sa(Z=b.current());)b.lastIntValue=16*b.lastIntValue+Oi(Z),b.advance();return b.pos!==k};function sa(b){return b>=48&&b<=57||b>=65&&b<=70||b>=97&&b<=102}function Oi(b){return b>=65&&b<=70?10+(b-65):b>=97&&b<=102?10+(b-97):b-48}er.regexp_eatLegacyOctalEscapeSequence=function(b){if(this.regexp_eatOctalDigit(b)){var k=b.lastIntValue;if(this.regexp_eatOctalDigit(b)){var Z=b.lastIntValue;k<=3&&this.regexp_eatOctalDigit(b)?b.lastIntValue=k*64+Z*8+b.lastIntValue:b.lastIntValue=k*8+Z}else b.lastIntValue=k;return!0}return!1},er.regexp_eatOctalDigit=function(b){var k=b.current();return Zi(k)?(b.lastIntValue=k-48,b.advance(),!0):(b.lastIntValue=0,!1)};function Zi(b){return b>=48&&b<=55}er.regexp_eatFixedHexDigits=function(b,k){var Z=b.pos;b.lastIntValue=0;for(var R=0;R<k;++R){var te=b.current();if(!sa(te))return b.pos=Z,!1;b.lastIntValue=16*b.lastIntValue+Oi(te),b.advance()}return!0};var Fi=function(k){this.type=k.type,this.value=k.value,this.start=k.start,this.end=k.end,k.options.locations&&(this.loc=new Xe(k,k.startLoc,k.endLoc)),k.options.ranges&&(this.range=[k.start,k.end])},yi=gt.prototype;yi.next=function(b){!b&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Fi(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},yi.getToken=function(){return this.next(),new Fi(this)},typeof Symbol!="undefined"&&(yi[Symbol.iterator]=function(){var b=this;return{next:function(){var k=b.getToken();return{done:k.type===J.eof,value:k}}}}),yi.curContext=function(){return this.context[this.context.length-1]},yi.nextToken=function(){var b=this.curContext();if((!b||!b.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(J.eof);if(b.override)return b.override(this);this.readToken(this.fullCharCodeAtPos())},yi.readToken=function(b){return Ot(b,this.options.ecmaVersion>=6)||b===92?this.readWord():this.getTokenFromCode(b)},yi.fullCharCodeAtPos=function(){var b=this.input.charCodeAt(this.pos);if(b<=55295||b>=57344)return b;var k=this.input.charCodeAt(this.pos+1);return(b<<10)+k-56613888},yi.skipBlockComment=function(){var b=this.options.onComment&&this.curPosition(),k=this.pos,Z=this.input.indexOf("*/",this.pos+=2);if(Z===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=Z+2,this.options.locations){Ct.lastIndex=k;for(var R;(R=Ct.exec(this.input))&&R.index<this.pos;)++this.curLine,this.lineStart=R.index+R[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(k+2,Z),k,this.pos,b,this.curPosition())},yi.skipLineComment=function(b){for(var k=this.pos,Z=this.options.onComment&&this.curPosition(),R=this.input.charCodeAt(this.pos+=b);this.pos<this.input.length&&!pt(R);)R=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(k+b,this.pos),k,this.pos,Z,this.curPosition())},yi.skipSpace=function(){e:for(;this.pos<this.input.length;){var b=this.input.charCodeAt(this.pos);switch(b){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(b>8&&b<14||b>=5760&&Ht.test(String.fromCharCode(b)))++this.pos;else break e}}},yi.finishToken=function(b,k){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var Z=this.type;this.type=b,this.value=k,this.updateContext(Z)},yi.readToken_dot=function(){var b=this.input.charCodeAt(this.pos+1);if(b>=48&&b<=57)return this.readNumber(!0);var k=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&b===46&&k===46?(this.pos+=3,this.finishToken(J.ellipsis)):(++this.pos,this.finishToken(J.dot))},yi.readToken_slash=function(){var b=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):b===61?this.finishOp(J.assign,2):this.finishOp(J.slash,1)},yi.readToken_mult_modulo_exp=function(b){var k=this.input.charCodeAt(this.pos+1),Z=1,R=b===42?J.star:J.modulo;return this.options.ecmaVersion>=7&&b===42&&k===42&&(++Z,R=J.starstar,k=this.input.charCodeAt(this.pos+2)),k===61?this.finishOp(J.assign,Z+1):this.finishOp(R,Z)},yi.readToken_pipe_amp=function(b){var k=this.input.charCodeAt(this.pos+1);if(k===b){if(this.options.ecmaVersion>=12){var Z=this.input.charCodeAt(this.pos+2);if(Z===61)return this.finishOp(J.assign,3)}return this.finishOp(b===124?J.logicalOR:J.logicalAND,2)}return k===61?this.finishOp(J.assign,2):this.finishOp(b===124?J.bitwiseOR:J.bitwiseAND,1)},yi.readToken_caret=function(){var b=this.input.charCodeAt(this.pos+1);return b===61?this.finishOp(J.assign,2):this.finishOp(J.bitwiseXOR,1)},yi.readToken_plus_min=function(b){var k=this.input.charCodeAt(this.pos+1);return k===b?k===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Et.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(J.incDec,2):k===61?this.finishOp(J.assign,2):this.finishOp(J.plusMin,1)},yi.readToken_lt_gt=function(b){var k=this.input.charCodeAt(this.pos+1),Z=1;return k===b?(Z=b===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+Z)===61?this.finishOp(J.assign,Z+1):this.finishOp(J.bitShift,Z)):k===33&&b===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(k===61&&(Z=2),this.finishOp(J.relational,Z))},yi.readToken_eq_excl=function(b){var k=this.input.charCodeAt(this.pos+1);return k===61?this.finishOp(J.equality,this.input.charCodeAt(this.pos+2)===61?3:2):b===61&&k===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(J.arrow)):this.finishOp(b===61?J.eq:J.prefix,1)},yi.readToken_question=function(){var b=this.options.ecmaVersion;if(b>=11){var k=this.input.charCodeAt(this.pos+1);if(k===46){var Z=this.input.charCodeAt(this.pos+2);if(Z<48||Z>57)return this.finishOp(J.questionDot,2)}if(k===63){if(b>=12){var R=this.input.charCodeAt(this.pos+2);if(R===61)return this.finishOp(J.assign,3)}return this.finishOp(J.coalesce,2)}}return this.finishOp(J.question,1)},yi.getTokenFromCode=function(b){switch(b){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(J.parenL);case 41:return++this.pos,this.finishToken(J.parenR);case 59:return++this.pos,this.finishToken(J.semi);case 44:return++this.pos,this.finishToken(J.comma);case 91:return++this.pos,this.finishToken(J.bracketL);case 93:return++this.pos,this.finishToken(J.bracketR);case 123:return++this.pos,this.finishToken(J.braceL);case 125:return++this.pos,this.finishToken(J.braceR);case 58:return++this.pos,this.finishToken(J.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(J.backQuote);case 48:var k=this.input.charCodeAt(this.pos+1);if(k===120||k===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(k===111||k===79)return this.readRadixNumber(8);if(k===98||k===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(b);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(b);case 124:case 38:return this.readToken_pipe_amp(b);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(b);case 60:case 62:return this.readToken_lt_gt(b);case 61:case 33:return this.readToken_eq_excl(b);case 63:return this.readToken_question();case 126:return this.finishOp(J.prefix,1)}this.raise(this.pos,"Unexpected character '"+ga(b)+"'")},yi.finishOp=function(b,k){var Z=this.input.slice(this.pos,this.pos+k);return this.pos+=k,this.finishToken(b,Z)},yi.readRegexp=function(){for(var b,k,Z=this.pos;;){this.pos>=this.input.length&&this.raise(Z,"Unterminated regular expression");var R=this.input.charAt(this.pos);if(Et.test(R)&&this.raise(Z,"Unterminated regular expression"),b)b=!1;else{if(R==="[")k=!0;else if(R==="]"&&k)k=!1;else if(R==="/"&&!k)break;b=R==="\\"}++this.pos}var te=this.input.slice(Z,this.pos);++this.pos;var Me=this.pos,at=this.readWord1();this.containsEsc&&this.unexpected(Me);var Rt=this.regexpState||(this.regexpState=new tr(this));Rt.reset(Z,te,at),this.validateRegExpFlags(Rt),this.validateRegExpPattern(Rt);var Lt=null;try{Lt=new RegExp(te,at)}catch(Ar){}return this.finishToken(J.regexp,{pattern:te,flags:at,value:Lt})},yi.readInt=function(b,k,Z){for(var R=this.options.ecmaVersion>=12&&k===void 0,te=Z&&this.input.charCodeAt(this.pos)===48,Me=this.pos,at=0,Rt=0,Lt=0,Ar=k==null?Infinity:k;Lt<Ar;++Lt,++this.pos){var Tr=this.input.charCodeAt(this.pos),Fn=void 0;if(R&&Tr===95){te&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Rt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Lt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Rt=Tr;continue}if(Tr>=97?Fn=Tr-97+10:Tr>=65?Fn=Tr-65+10:Tr>=48&&Tr<=57?Fn=Tr-48:Fn=Infinity,Fn>=b)break;Rt=Tr,at=at*b+Fn}return R&&Rt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===Me||k!=null&&this.pos-Me!==k?null:at};function ha(b,k){return k?parseInt(b,8):parseFloat(b.replace(/_/g,""))}function Xa(b){return typeof BigInt!="function"?null:BigInt(b.replace(/_/g,""))}yi.readRadixNumber=function(b){var k=this.pos;this.pos+=2;var Z=this.readInt(b);return Z==null&&this.raise(this.start+2,"Expected number in radix "+b),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(Z=Xa(this.input.slice(k,this.pos)),++this.pos):Ot(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(J.num,Z)},yi.readNumber=function(b){var k=this.pos;!b&&this.readInt(10,void 0,!0)===null&&this.raise(k,"Invalid number");var Z=this.pos-k>=2&&this.input.charCodeAt(k)===48;Z&&this.strict&&this.raise(k,"Invalid number");var R=this.input.charCodeAt(this.pos);if(!Z&&!b&&this.options.ecmaVersion>=11&&R===110){var te=Xa(this.input.slice(k,this.pos));return++this.pos,Ot(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(J.num,te)}Z&&/[89]/.test(this.input.slice(k,this.pos))&&(Z=!1),R===46&&!Z&&(++this.pos,this.readInt(10),R=this.input.charCodeAt(this.pos)),(R===69||R===101)&&!Z&&(R=this.input.charCodeAt(++this.pos),(R===43||R===45)&&++this.pos,this.readInt(10)===null&&this.raise(k,"Invalid number")),Ot(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var Me=ha(this.input.slice(k,this.pos),Z);return this.finishToken(J.num,Me)},yi.readCodePoint=function(){var b=this.input.charCodeAt(this.pos),k;if(b===123){this.options.ecmaVersion<6&&this.unexpected();var Z=++this.pos;k=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,k>1114111&&this.invalidStringToken(Z,"Code point out of bounds")}else k=this.readHexChar(4);return k};function ga(b){return b<=65535?String.fromCharCode(b):(b-=65536,String.fromCharCode((b>>10)+55296,(b&1023)+56320))}yi.readString=function(b){for(var k="",Z=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var R=this.input.charCodeAt(this.pos);if(R===b)break;R===92?(k+=this.input.slice(Z,this.pos),k+=this.readEscapedChar(!1),Z=this.pos):(pt(R,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return k+=this.input.slice(Z,this.pos++),this.finishToken(J.string,k)};var zi={};yi.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(b){if(b===zi)this.readInvalidTemplateToken();else throw b}this.inTemplateElement=!1},yi.invalidStringToken=function(b,k){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw zi;this.raise(b,k)},yi.readTmplToken=function(){for(var b="",k=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var Z=this.input.charCodeAt(this.pos);if(Z===96||Z===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===J.template||this.type===J.invalidTemplate)?Z===36?(this.pos+=2,this.finishToken(J.dollarBraceL)):(++this.pos,this.finishToken(J.backQuote)):(b+=this.input.slice(k,this.pos),this.finishToken(J.template,b));if(Z===92)b+=this.input.slice(k,this.pos),b+=this.readEscapedChar(!0),k=this.pos;else if(pt(Z)){switch(b+=this.input.slice(k,this.pos),++this.pos,Z){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:b+=`
`;break;default:b+=String.fromCharCode(Z);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),k=this.pos}else++this.pos}},yi.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(J.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},yi.readEscapedChar=function(b){var k=this.input.charCodeAt(++this.pos);switch(++this.pos,k){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return ga(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(b){var Z=this.pos-1;return this.invalidStringToken(Z,"Invalid escape sequence in template string"),null}default:if(k>=48&&k<=55){var R=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],te=parseInt(R,8);return te>255&&(R=R.slice(0,-1),te=parseInt(R,8)),this.pos+=R.length-1,k=this.input.charCodeAt(this.pos),(R!=="0"||k===56||k===57)&&(this.strict||b)&&this.invalidStringToken(this.pos-1-R.length,b?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(te)}return pt(k)?"":String.fromCharCode(k)}},yi.readHexChar=function(b){var k=this.pos,Z=this.readInt(16,b);return Z===null&&this.invalidStringToken(k,"Bad character escape sequence"),Z},yi.readWord1=function(){this.containsEsc=!1;for(var b="",k=!0,Z=this.pos,R=this.options.ecmaVersion>=6;this.pos<this.input.length;){var te=this.fullCharCodeAtPos();if(vr(te,R))this.pos+=te<=65535?1:2;else if(te===92){this.containsEsc=!0,b+=this.input.slice(Z,this.pos);var Me=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var at=this.readCodePoint();(k?Ot:vr)(at,R)||this.invalidStringToken(Me,"Invalid Unicode escape"),b+=ga(at),Z=this.pos}else break;k=!1}return b+this.input.slice(Z,this.pos)},yi.readWord=function(){var b=this.readWord1(),k=J.name;return this.keywords.test(b)&&(k=Zt[b]),this.finishToken(k,b)};var Ji="7.4.1";gt.acorn={Parser:gt,version:Ji,defaultOptions:_t,Position:ue,SourceLocation:Xe,getLineInfo:lt,Node:ci,TokenType:Ft,tokTypes:J,keywordTypes:Zt,TokContext:Ua,tokContexts:Ea,isIdentifierChar:vr,isIdentifierStart:Ot,Token:Fi,isNewLine:pt,lineBreak:Et,lineBreakG:Ct,nonASCIIwhitespace:Ht};function Va(b,k){return gt.parse(b,k)}function tu(b,k,Z){return gt.parseExpressionAt(b,k,Z)}function $a(b,k){return gt.tokenizer(b,k)}function Fa(b,k){b.prototype=Object.create(k.prototype),b.prototype.constructor=b,b.__proto__=k}function Fs(b){var k=typeof Map=="function"?new Map:void 0;return Fs=function(R){if(R===null||!$s(R))return R;if(typeof R!="function")throw new TypeError("Super expression must either be null or a function");if(typeof k!="undefined"){if(k.has(R))return k.get(R);k.set(R,te)}function te(){return ur(R,arguments,Ja(this).constructor)}return te.prototype=Object.create(R.prototype,{constructor:{value:te,enumerable:!1,writable:!0,configurable:!0}}),uo(te,R)},Fs(b)}function $n(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(b){return!1}}function ur(b,k,Z){return $n()?ur=Reflect.construct:ur=function(te,Me,at){var Rt=[null];Rt.push.apply(Rt,Me);var Lt=Function.bind.apply(te,Rt),Ar=new Lt;return at&&uo(Ar,at.prototype),Ar},ur.apply(null,arguments)}function $s(b){return Function.toString.call(b).indexOf("[native code]")!==-1}function uo(b,k){return uo=Object.setPrototypeOf||function(R,te){return R.__proto__=te,R},uo(b,k)}function Ja(b){return Ja=Object.setPrototypeOf?Object.getPrototypeOf:function(Z){return Z.__proto__||Object.getPrototypeOf(Z)},Ja(b)}var eo=function(b){Fa(k,b);function k(){return b.apply(this,arguments)||this}return k}(Fs(Error)),wt=function(b){Fa(k,b);function k(){return b.apply(this,arguments)||this}return k}(Fs(SyntaxError)),zt=function(b){Fa(k,b);function k(){return b.apply(this,arguments)||this}return k}(Fs(ReferenceError)),rs=function(b){Fa(k,b);function k(){return b.apply(this,arguments)||this}return k}(Fs(TypeError)),du=function(b){Fa(k,b);function k(){return b.apply(this,arguments)||this}return k}(eo),Io=function(b){Fa(k,b);function k(){return b.apply(this,arguments)||this}return k}(wt),za=function(b){Fa(k,b);function k(){return b.apply(this,arguments)||this}return k}(zt),Sa={UnknownError:[3001,"%0",du],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",du],NodeTypeSyntaxError:[1001,"Unknown node type: %0",za],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",za],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",za],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",za],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",za],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",za],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",za],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",za],ParamTypeSyntaxError:[1009,"Unknown param type: %0",za],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",za],FunctionUndefinedReferenceError:[2001,"%0 is not a function",zt],VariableUndefinedReferenceError:[2002,"%0 is not defined",zt],IsNotConstructor:[2003,"%0 is not a constructor",rs]};function xo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(b){return!1}}function Dr(b,k,Z){return xo()?Dr=Reflect.construct:Dr=function(te,Me,at){var Rt=[null];Rt.push.apply(Rt,Me);var Lt=Function.bind.apply(te,Rt),Ar=new Lt;return at&&Rr(Ar,at.prototype),Ar},Dr.apply(null,arguments)}function Rr(b,k){return Rr=Object.setPrototypeOf||function(R,te){return R.__proto__=te,R},Rr(b,k)}var Qe="0.0.3";function Fu(b,k){Object.defineProperty(b,"name",{value:k,writable:!1,enumerable:!1,configurable:!0})}var He=Object.prototype.hasOwnProperty,fe=Symbol("Break"),Pe=Symbol("Continue"),ht=Symbol("DefaultCase"),Kt=Symbol("EmptyStatementReturn"),en=Symbol("WithScopeName"),qn=Symbol("SuperScopeName"),Ui=Symbol("RootScopeName"),lo=Symbol("GlobalScopeName");function Ya(b){return typeof b=="function"}var to=function(){function b(Z){this.interpreter=Z}var k=b.prototype;return k.generator=function(){var R=this.interpreter;function te(){return this.getCurrentScope()}function Me(){return this.getGlobalScope()}function at(){return this.getCurrentContext()}return{getOptions:R.getOptions.bind(R),getCurrentScope:te.bind(R),getGlobalScope:Me.bind(R),getCurrentContext:at.bind(R),getExecStartTime:R.getExecStartTime.bind(R)}},b}();function $o(b,k,Z){if(Z===void 0&&(Z=!0),!(b instanceof to))throw new Error("Illegal call");if(typeof k!="string")return k;if(!!k){var R=b.generator(),te=R.getOptions(),Me={timeout:te.timeout,_initEnv:function(){Z||this.setCurrentContext(R.getCurrentContext()),this.execStartTime=R.getExecStartTime(),this.execEndTime=this.execStartTime}},at=Z?R.getGlobalScope():R.getCurrentScope(),Rt=new bo(at,Me);return Rt.evaluate(k)}}Object.defineProperty($o,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function Ms(b){if(!(b instanceof to))throw new Error("Illegal call");for(var k=b.generator(),Z=arguments.length,R=new Array(Z>1?Z-1:0),te=1;te<Z;te++)R[te-1]=arguments[te];var Me=R.pop(),at=new bo(k.getGlobalScope(),k.getOptions()),Rt=`
		    (function anonymous(`+R.join(",")+`){
		        `+Me+`
		    });
		    `;return at.evaluate(Rt)}Object.defineProperty(Ms,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var Vo=function(k){this.value=k},fs=function(k){this.value=k},hs=function(k){this.value=k},ys=function(k,Z,R){Z===void 0&&(Z=null),this.name=R,this.parent=Z,this.data=k,this.labelStack=[]};function ks(){}function ru(b,k){return b===void 0&&(b=null),new ys(Object.create(null),b,k)}function _s(b){return Object.create(b)}var ya={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:$o,Function:Ms};typeof JSON!="undefined"&&(ya.JSON=JSON),typeof Promise!="undefined"&&(ya.Promise=Promise),typeof Set!="undefined"&&(ya.Set=Set),typeof Map!="undefined"&&(ya.Map=Map),typeof Symbol!="undefined"&&(ya.Symbol=Symbol),typeof Proxy!="undefined"&&(ya.Proxy=Proxy),typeof WeakMap!="undefined"&&(ya.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(ya.WeakSet=WeakSet),typeof Reflect!="undefined"&&(ya.Reflect=Reflect);var bo=function(){function b(Z,R){Z===void 0&&(Z=b.global),R===void 0&&(R={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:R.ecmaVersion||b.ecmaVersion,timeout:R.timeout||0,rootContext:R.rootContext,globalContextInFunction:R.globalContextInFunction===void 0?b.globalContextInFunction:R.globalContextInFunction,_initEnv:R._initEnv},this.context=Z||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var k=b.prototype;return k.initEnvironment=function(R){var te;if(R instanceof ys)te=R;else{var Me=null,at=this.createSuperScope(R);this.options.rootContext&&(Me=new ys(_s(this.options.rootContext),at,Ui)),te=new ys(R,Me||at,lo)}this.globalScope=te,this.currentScope=this.globalScope,this.globalContext=te.data,this.currentContext=te.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Rt=this.options._initEnv;Rt&&Rt.call(this)},k.getExecStartTime=function(){return this.execStartTime},k.getExecutionTime=function(){return this.execEndTime-this.execStartTime},k.setExecTimeout=function(R){R===void 0&&(R=0),this.options.timeout=R},k.getOptions=function(){return this.options},k.getGlobalScope=function(){return this.globalScope},k.getCurrentScope=function(){return this.currentScope},k.getCurrentContext=function(){return this.currentContext},k.isInterruptThrow=function(R){return R instanceof du||R instanceof za||R instanceof Io},k.createSuperScope=function(R){var te=Object.assign({},ya),Me=Object.keys(te);return Me.forEach(function(at){at in R&&delete te[at]}),new ys(te,null,qn)},k.setCurrentContext=function(R){this.currentContext=R},k.setCurrentScope=function(R){this.currentScope=R},k.evaluate=function(R){R===void 0&&(R="");var te;if(!!R)return te=Va(R,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||b.ecmaVersion}),this.evaluateNode(te,R)},k.appendCode=function(R){return this.evaluate(R)},k.evaluateNode=function(R,te){var Me=this;te===void 0&&(te=""),this.value=void 0,this.source=te,this.sourceList.push(te),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var at=this.getCurrentScope(),Rt=this.getCurrentContext(),Lt=at.labelStack.concat([]),Ar=this.callStack.concat([]),Tr=function(){Me.setCurrentScope(at),Me.setCurrentContext(Rt),at.labelStack=Lt,Me.callStack=Ar};try{var Fn=this.createClosure(R);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Fn()}catch(Ai){throw Ai}finally{Tr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},k.createErrorMessage=function(R,te,Me){var at=R[1].replace("%0",String(te));return Me!==null&&(at+=this.getNodePosition(Me||this.lastExecNode)),at},k.createError=function(R,te){return new te(R)},k.createThrowError=function(R,te){return this.createError(R,te)},k.createInternalThrowError=function(R,te,Me){return this.createError(this.createErrorMessage(R,te,Me),R[2])},k.checkTimeout=function(){if(!this.isRunning)return!1;var R=this.options.timeout||0,te=Date.now();return te-this.execStartTime>R},k.getNodePosition=function(R){if(R){var te="";return R.loc?" ["+R.loc.start.line+":"+R.loc.start.column+"]"+te:""}return""},k.createClosure=function(R){var te=this,Me;switch(R.type){case"BinaryExpression":Me=this.binaryExpressionHandler(R);break;case"LogicalExpression":Me=this.logicalExpressionHandler(R);break;case"UnaryExpression":Me=this.unaryExpressionHandler(R);break;case"UpdateExpression":Me=this.updateExpressionHandler(R);break;case"ObjectExpression":Me=this.objectExpressionHandler(R);break;case"ArrayExpression":Me=this.arrayExpressionHandler(R);break;case"CallExpression":Me=this.callExpressionHandler(R);break;case"NewExpression":Me=this.newExpressionHandler(R);break;case"MemberExpression":Me=this.memberExpressionHandler(R);break;case"ThisExpression":Me=this.thisExpressionHandler(R);break;case"SequenceExpression":Me=this.sequenceExpressionHandler(R);break;case"Literal":Me=this.literalHandler(R);break;case"Identifier":Me=this.identifierHandler(R);break;case"AssignmentExpression":Me=this.assignmentExpressionHandler(R);break;case"FunctionDeclaration":Me=this.functionDeclarationHandler(R);break;case"VariableDeclaration":Me=this.variableDeclarationHandler(R);break;case"BlockStatement":case"Program":Me=this.programHandler(R);break;case"ExpressionStatement":Me=this.expressionStatementHandler(R);break;case"EmptyStatement":Me=this.emptyStatementHandler(R);break;case"ReturnStatement":Me=this.returnStatementHandler(R);break;case"FunctionExpression":Me=this.functionExpressionHandler(R);break;case"IfStatement":Me=this.ifStatementHandler(R);break;case"ConditionalExpression":Me=this.conditionalExpressionHandler(R);break;case"ForStatement":Me=this.forStatementHandler(R);break;case"WhileStatement":Me=this.whileStatementHandler(R);break;case"DoWhileStatement":Me=this.doWhileStatementHandler(R);break;case"ForInStatement":Me=this.forInStatementHandler(R);break;case"WithStatement":Me=this.withStatementHandler(R);break;case"ThrowStatement":Me=this.throwStatementHandler(R);break;case"TryStatement":Me=this.tryStatementHandler(R);break;case"ContinueStatement":Me=this.continueStatementHandler(R);break;case"BreakStatement":Me=this.breakStatementHandler(R);break;case"SwitchStatement":Me=this.switchStatementHandler(R);break;case"LabeledStatement":Me=this.labeledStatementHandler(R);break;case"DebuggerStatement":Me=this.debuggerStatementHandler(R);break;default:throw this.createInternalThrowError(Sa.NodeTypeSyntaxError,R.type,R)}return function(){var at=te.options.timeout;if(at&&at>0&&te.checkTimeout())throw te.createInternalThrowError(Sa.ExecutionTimeOutError,at,null);return te.lastExecNode=R,Me.apply(void 0,arguments)}},k.binaryExpressionHandler=function(R){var te=this,Me=this.createClosure(R.left),at=this.createClosure(R.right);return function(){var Rt=Me(),Lt=at();switch(R.operator){case"==":return Rt==Lt;case"!=":return Rt!=Lt;case"===":return Rt===Lt;case"!==":return Rt!==Lt;case"<":return Rt<Lt;case"<=":return Rt<=Lt;case">":return Rt>Lt;case">=":return Rt>=Lt;case"<<":return Rt<<Lt;case">>":return Rt>>Lt;case">>>":return Rt>>>Lt;case"+":return Rt+Lt;case"-":return Rt-Lt;case"*":return Rt*Lt;case"**":return Math.pow(Rt,Lt);case"/":return Rt/Lt;case"%":return Rt%Lt;case"|":return Rt|Lt;case"^":return Rt^Lt;case"&":return Rt&Lt;case"in":return Rt in Lt;case"instanceof":return Rt instanceof Lt;default:throw te.createInternalThrowError(Sa.BinaryOperatorSyntaxError,R.operator,R)}}},k.logicalExpressionHandler=function(R){var te=this,Me=this.createClosure(R.left),at=this.createClosure(R.right);return function(){switch(R.operator){case"||":return Me()||at();case"&&":return Me()&&at();default:throw te.createInternalThrowError(Sa.LogicalOperatorSyntaxError,R.operator,R)}}},k.unaryExpressionHandler=function(R){var te=this;switch(R.operator){case"delete":var Me=this.createObjectGetter(R.argument),at=this.createNameGetter(R.argument);return function(){var Tr=Me(),Fn=at();return delete Tr[Fn]};default:var Rt;if(R.operator==="typeof"&&R.argument.type==="Identifier"){var Lt=this.createObjectGetter(R.argument),Ar=this.createNameGetter(R.argument);Rt=function(){return Lt()[Ar()]}}else Rt=this.createClosure(R.argument);return function(){var Tr=Rt();switch(R.operator){case"-":return-Tr;case"+":return+Tr;case"!":return!Tr;case"~":return~Tr;case"void":return;case"typeof":return typeof Tr;default:throw te.createInternalThrowError(Sa.UnaryOperatorSyntaxError,R.operator,R)}}}},k.updateExpressionHandler=function(R){var te=this,Me=this.createObjectGetter(R.argument),at=this.createNameGetter(R.argument);return function(){var Rt=Me(),Lt=at();switch(te.assertVariable(Rt,Lt,R),R.operator){case"++":return R.prefix?++Rt[Lt]:Rt[Lt]++;case"--":return R.prefix?--Rt[Lt]:Rt[Lt]--;default:throw te.createInternalThrowError(Sa.UpdateOperatorSyntaxError,R.operator,R)}}},k.objectExpressionHandler=function(R){var te=this,Me=[];function at(Lt){return Lt.type==="Identifier"?Lt.name:Lt.type==="Literal"?Lt.value:this.throwError(Sa.ObjectStructureSyntaxError,Lt.type,Lt)}var Rt=Object.create(null);return R.properties.forEach(function(Lt){var Ar=Lt.kind,Tr=at(Lt.key);(!Rt[Tr]||Ar==="init")&&(Rt[Tr]={}),Rt[Tr][Ar]=te.createClosure(Lt.value),Me.push({key:Tr,property:Lt})}),function(){for(var Lt={},Ar=Me.length,Tr=0;Tr<Ar;Tr++){var Fn=Me[Tr],Ai=Fn.key,_i=Rt[Ai],Di=_i.init?_i.init():void 0,Ia=_i.get?_i.get():function(){},Da=_i.set?_i.set():function(ul){};if("set"in _i||"get"in _i){var ea={configurable:!0,enumerable:!0,get:Ia,set:Da};Object.defineProperty(Lt,Ai,ea)}else{var xs=Fn.property,bu=xs.kind;xs.key.type==="Identifier"&&xs.value.type==="FunctionExpression"&&bu==="init"&&!xs.value.id&&Fu(Di,xs.key.name),Lt[Ai]=Di}}return Lt}},k.arrayExpressionHandler=function(R){var te=this,Me=R.elements.map(function(at){return at&&te.createClosure(at)});return function(){for(var at=Me.length,Rt=Array(at),Lt=0;Lt<at;Lt++){var Ar=Me[Lt];Ar&&(Rt[Lt]=Ar())}return Rt}},k.safeObjectGet=function(R,te,Me){return R[te]},k.createCallFunctionGetter=function(R){var te=this;switch(R.type){case"MemberExpression":var Me=this.createClosure(R.object),at=this.createMemberKeyGetter(R),Rt=this.source;return function(){var Ar=Me(),Tr=at(),Fn=te.safeObjectGet(Ar,Tr,R);if(!Fn||!Ya(Fn)){var Ai=Rt.slice(R.start,R.end);throw te.createInternalThrowError(Sa.FunctionUndefinedReferenceError,Ai,R)}return Fn.__IS_EVAL_FUNC?function(_i){return Fn(new to(te),_i,!0)}:Fn.__IS_FUNCTION_FUNC?function(){for(var _i=arguments.length,Di=new Array(_i),Ia=0;Ia<_i;Ia++)Di[Ia]=arguments[Ia];return Fn.apply(void 0,[new to(te)].concat(Di))}:Fn.bind(Ar)};default:var Lt=this.createClosure(R);return function(){var Ar="";R.type==="Identifier"&&(Ar=R.name);var Tr=Lt();if(!Tr||!Ya(Tr))throw te.createInternalThrowError(Sa.FunctionUndefinedReferenceError,Ar,R);if(R.type==="Identifier"&&Tr.__IS_EVAL_FUNC&&Ar==="eval")return function(_i){var Di=te.getScopeFromName(Ar,te.getCurrentScope()),Ia=Di.name===qn||Di.name===lo||Di.name===Ui;return Tr(new to(te),_i,!Ia)};if(Tr.__IS_EVAL_FUNC)return function(_i){return Tr(new to(te),_i,!0)};if(Tr.__IS_FUNCTION_FUNC)return function(){for(var _i=arguments.length,Di=new Array(_i),Ia=0;Ia<_i;Ia++)Di[Ia]=arguments[Ia];return Tr.apply(void 0,[new to(te)].concat(Di))};var Fn=te.options.globalContextInFunction;if(R.type==="Identifier"){var Ai=te.getIdentifierScope(R);Ai.name===en&&(Fn=Ai.data)}return Tr.bind(Fn)}}},k.callExpressionHandler=function(R){var te=this,Me=this.createCallFunctionGetter(R.callee),at=R.arguments.map(function(Rt){return te.createClosure(Rt)});return function(){return Me().apply(void 0,at.map(function(Rt){return Rt()}))}},k.functionExpressionHandler=function(R){var te=this,Me=this,at=this.source,Rt=this.collectDeclVars,Lt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Ar=R.id?R.id.name:"",Tr=R.params.length,Fn=R.params.map(function(Ia){return te.createParamNameGetter(Ia)}),Ai=this.createClosure(R.body),_i=this.collectDeclVars,Di=this.collectDeclFuncs;return this.collectDeclVars=Rt,this.collectDeclFuncs=Lt,function(){var Ia=Me.getCurrentScope(),Da=function ea(){for(var xs=arguments.length,bu=new Array(xs),ul=0;ul<xs;ul++)bu[ul]=arguments[ul];Me.callStack.push(""+Ar);var vf=Me.getCurrentScope(),mu=ru(Ia,"FunctionScope("+Ar+")");Me.setCurrentScope(mu),Me.addDeclarationsToScope(_i,Di,mu),Ar&&(mu.data[Ar]=ea),mu.data.arguments=arguments,Fn.forEach(function(gu,Bu){mu.data[gu()]=bu[Bu]});var Ds=Me.getCurrentContext();Me.setCurrentContext(this);var Du=Ai();if(Me.setCurrentContext(Ds),Me.setCurrentScope(vf),Me.callStack.pop(),Du instanceof Vo)return Du.value};return Fu(Da,Ar),Object.defineProperty(Da,"length",{value:Tr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Da,"toString",{value:function(){return at.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Da,"valueOf",{value:function(){return at.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Da}},k.newExpressionHandler=function(R){var te=this,Me=this.source,at=this.createClosure(R.callee),Rt=R.arguments.map(function(Lt){return te.createClosure(Lt)});return function(){var Lt=at();if(!Ya(Lt)||Lt.__IS_EVAL_FUNC){var Ar=R.callee,Tr=Me.slice(Ar.start,Ar.end);throw te.createInternalThrowError(Sa.IsNotConstructor,Tr,R)}return Lt.__IS_FUNCTION_FUNC?Lt.apply(void 0,[new to(te)].concat(Rt.map(function(Fn){return Fn()}))):Dr(Lt,Rt.map(function(Fn){return Fn()}))}},k.memberExpressionHandler=function(R){var te=this.createClosure(R.object),Me=this.createMemberKeyGetter(R);return function(){var at=te(),Rt=Me();return at[Rt]}},k.thisExpressionHandler=function(R){var te=this;return function(){return te.getCurrentContext()}},k.sequenceExpressionHandler=function(R){var te=this,Me=R.expressions.map(function(at){return te.createClosure(at)});return function(){for(var at,Rt=Me.length,Lt=0;Lt<Rt;Lt++){var Ar=Me[Lt];at=Ar()}return at}},k.literalHandler=function(R){return function(){return R.regex?new RegExp(R.regex.pattern,R.regex.flags):R.value}},k.identifierHandler=function(R){var te=this;return function(){var Me=te.getCurrentScope(),at=te.getScopeDataFromName(R.name,Me);return te.assertVariable(at,R.name,R),at[R.name]}},k.getIdentifierScope=function(R){var te=this.getCurrentScope(),Me=this.getScopeFromName(R.name,te);return Me},k.assignmentExpressionHandler=function(R){var te=this;R.left.type==="Identifier"&&R.right.type==="FunctionExpression"&&!R.right.id&&(R.right.id={type:"Identifier",name:R.left.name});var Me=this.createObjectGetter(R.left),at=this.createNameGetter(R.left),Rt=this.createClosure(R.right);return function(){var Lt=Me(),Ar=at(),Tr=Rt();switch(R.operator!=="="&&te.assertVariable(Lt,Ar,R),R.operator){case"=":return Lt[Ar]=Tr;case"+=":return Lt[Ar]+=Tr;case"-=":return Lt[Ar]-=Tr;case"*=":return Lt[Ar]*=Tr;case"**=":return Lt[Ar]=Math.pow(Lt[Ar],Tr);case"/=":return Lt[Ar]/=Tr;case"%=":return Lt[Ar]%=Tr;case"<<=":return Lt[Ar]<<=Tr;case">>=":return Lt[Ar]>>=Tr;case">>>=":return Lt[Ar]>>>=Tr;case"&=":return Lt[Ar]&=Tr;case"^=":return Lt[Ar]^=Tr;case"|=":return Lt[Ar]|=Tr;default:throw te.createInternalThrowError(Sa.AssignmentExpressionSyntaxError,R.type,R)}}},k.functionDeclarationHandler=function(R){if(R.id){var te=this.functionExpressionHandler(R);Object.defineProperty(te,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(R.id.name,te)}return function(){return Kt}},k.getVariableName=function(R){if(R.type==="Identifier")return R.name;throw this.createInternalThrowError(Sa.VariableTypeSyntaxError,R.type,R)},k.variableDeclarationHandler=function(R){for(var te=this,Me,at=[],Rt=0;Rt<R.declarations.length;Rt++){var Lt=R.declarations[Rt];this.varDeclaration(this.getVariableName(Lt.id)),Lt.init&&at.push({type:"AssignmentExpression",operator:"=",left:Lt.id,right:Lt.init})}return at.length&&(Me=this.createClosure({type:"BlockStatement",body:at})),function(){if(Me){var Ar=te.isVarDeclMode;te.isVarDeclMode=!0,Me(),te.isVarDeclMode=Ar}return Kt}},k.assertVariable=function(R,te,Me){if(R===this.globalScope.data&&!(te in R))throw this.createInternalThrowError(Sa.VariableUndefinedReferenceError,te,Me)},k.programHandler=function(R){var te=this,Me=R.body.map(function(at){return te.createClosure(at)});return function(){for(var at=Kt,Rt=0;Rt<Me.length;Rt++){var Lt=Me[Rt],Ar=te.setValue(Lt());if(Ar!==Kt&&(at=Ar,at instanceof Vo||at instanceof fs||at instanceof hs||at===fe||at===Pe))break}return at}},k.expressionStatementHandler=function(R){return this.createClosure(R.expression)},k.emptyStatementHandler=function(R){return function(){return Kt}},k.returnStatementHandler=function(R){var te=R.argument?this.createClosure(R.argument):ks;return function(){return new Vo(te())}},k.ifStatementHandler=function(R){var te=this.createClosure(R.test),Me=this.createClosure(R.consequent),at=R.alternate?this.createClosure(R.alternate):function(){return Kt};return function(){return te()?Me():at()}},k.conditionalExpressionHandler=function(R){return this.ifStatementHandler(R)},k.forStatementHandler=function(R){var te=this,Me=ks,at=R.test?this.createClosure(R.test):function(){return!0},Rt=ks,Lt=this.createClosure(R.body);return R.type==="ForStatement"&&(Me=R.init?this.createClosure(R.init):Me,Rt=R.update?this.createClosure(R.update):ks),function(Ar){var Tr,Fn=Kt,Ai=R.type==="DoWhileStatement";for(Ar&&Ar.type==="LabeledStatement"&&(Tr=Ar.label.name),Me();Ai||at();Rt()){Ai=!1;var _i=te.setValue(Lt());if(!(_i===Kt||_i===Pe)){if(_i===fe)break;if(Fn=_i,Fn instanceof hs&&Fn.value===Tr){Fn=Kt;continue}if(Fn instanceof Vo||Fn instanceof fs||Fn instanceof hs)break}}return Fn}},k.whileStatementHandler=function(R){return this.forStatementHandler(R)},k.doWhileStatementHandler=function(R){return this.forStatementHandler(R)},k.forInStatementHandler=function(R){var te=this,Me=R.left,at=this.createClosure(R.right),Rt=this.createClosure(R.body);return R.left.type==="VariableDeclaration"&&(this.createClosure(R.left)(),Me=R.left.declarations[0].id),function(Lt){var Ar,Tr=Kt,Fn;Lt&&Lt.type==="LabeledStatement"&&(Ar=Lt.label.name);var Ai=at();for(Fn in Ai){te.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:Me,right:{type:"Literal",value:Fn}})();var _i=te.setValue(Rt());if(!(_i===Kt||_i===Pe)){if(_i===fe)break;if(Tr=_i,Tr instanceof hs&&Tr.value===Ar){Tr=Kt;continue}if(Tr instanceof Vo||Tr instanceof fs||Tr instanceof hs)break}}return Tr}},k.withStatementHandler=function(R){var te=this,Me=this.createClosure(R.object),at=this.createClosure(R.body);return function(){var Rt=Me(),Lt=te.getCurrentScope(),Ar=new ys(Rt,Lt,en);te.setCurrentScope(Ar);var Tr=te.setValue(at());return te.setCurrentScope(Lt),Tr}},k.throwStatementHandler=function(R){var te=this,Me=this.createClosure(R.argument);return function(){throw te.setValue(void 0),Me()}},k.tryStatementHandler=function(R){var te=this,Me=this.createClosure(R.block),at=R.handler?this.catchClauseHandler(R.handler):null,Rt=R.finalizer?this.createClosure(R.finalizer):null;return function(){var Lt=te.getCurrentScope(),Ar=te.getCurrentContext(),Tr=Lt.labelStack.concat([]),Fn=te.callStack.concat([]),Ai=Kt,_i,Di,Ia=function(){te.setCurrentScope(Lt),te.setCurrentContext(Ar),Lt.labelStack=Tr,te.callStack=Fn};try{Ai=te.setValue(Me()),Ai instanceof Vo&&(_i=Ai)}catch(Da){if(Ia(),te.isInterruptThrow(Da))throw Da;if(at)try{Ai=te.setValue(at(Da)),Ai instanceof Vo&&(_i=Ai)}catch(ea){if(Ia(),te.isInterruptThrow(ea))throw ea;Di=ea}}if(Rt)try{Ai=Rt(),Ai instanceof Vo&&(_i=Ai)}catch(Da){if(Ia(),te.isInterruptThrow(Da))throw Da;Di=Da}if(Di)throw Di;return _i||Ai}},k.catchClauseHandler=function(R){var te=this,Me=this.createParamNameGetter(R.param),at=this.createClosure(R.body);return function(Rt){var Lt,Ar=te.getCurrentScope(),Tr=Ar.data,Fn=Me(),Ai=He.call(Tr,Fn),_i=Tr[Fn];return Tr[Fn]=Rt,Lt=at(),Ai?Tr[Fn]=_i:delete Tr[Fn],Lt}},k.continueStatementHandler=function(R){return function(){return R.label?new hs(R.label.name):Pe}},k.breakStatementHandler=function(R){return function(){return R.label?new fs(R.label.name):fe}},k.switchStatementHandler=function(R){var te=this,Me=this.createClosure(R.discriminant),at=R.cases.map(function(Rt){return te.switchCaseHandler(Rt)});return function(){for(var Rt=Me(),Lt=!1,Ar,Tr,Fn,Ai=0;Ai<at.length;Ai++){var _i=at[Ai](),Di=_i.testClosure();if(Di===ht){Fn=_i;continue}if(Lt||Di===Rt){if(Lt=!0,Tr=te.setValue(_i.bodyClosure()),Tr===Kt)continue;if(Tr===fe||(Ar=Tr,Ar instanceof Vo||Ar instanceof fs||Ar instanceof hs||Ar===Pe))break}}if(!Lt&&Fn){Tr=te.setValue(Fn.bodyClosure());var Ia=Tr===Kt||Tr===fe||Tr===Pe;Ia||(Ar=Tr)}return Ar}},k.switchCaseHandler=function(R){var te=R.test?this.createClosure(R.test):function(){return ht},Me=this.createClosure({type:"BlockStatement",body:R.consequent});return function(){return{testClosure:te,bodyClosure:Me}}},k.labeledStatementHandler=function(R){var te=this,Me=R.label.name,at=this.createClosure(R.body);return function(){var Rt,Lt=te.getCurrentScope();return Lt.labelStack.push(Me),Rt=at(R),Rt instanceof fs&&Rt.value===Me&&(Rt=Kt),Lt.labelStack.pop(),Rt}},k.debuggerStatementHandler=function(R){return function(){debugger;return Kt}},k.createParamNameGetter=function(R){if(R.type==="Identifier")return function(){return R.name};throw this.createInternalThrowError(Sa.ParamTypeSyntaxError,R.type,R)},k.createObjectKeyGetter=function(R){var te;return R.type==="Identifier"?te=function(){return R.name}:te=this.createClosure(R),function(){return te()}},k.createMemberKeyGetter=function(R){return R.computed?this.createClosure(R.property):this.createObjectKeyGetter(R.property)},k.createObjectGetter=function(R){var te=this;switch(R.type){case"Identifier":return function(){return te.getScopeDataFromName(R.name,te.getCurrentScope())};case"MemberExpression":return this.createClosure(R.object);default:throw this.createInternalThrowError(Sa.AssignmentTypeSyntaxError,R.type,R)}},k.createNameGetter=function(R){switch(R.type){case"Identifier":return function(){return R.name};case"MemberExpression":return this.createMemberKeyGetter(R);default:throw this.createInternalThrowError(Sa.AssignmentTypeSyntaxError,R.type,R)}},k.varDeclaration=function(R){var te=this.collectDeclVars;te[R]=void 0},k.funcDeclaration=function(R,te){var Me=this.collectDeclFuncs;Me[R]=te},k.addDeclarationsToScope=function(R,te,Me){var at=Me.data;for(var Rt in te){var Lt=te[Rt];at[Rt]=Lt&&Lt()}for(var Ar in R)Ar in at||(at[Ar]=void 0)},k.getScopeValue=function(R,te){var Me=this.getScopeFromName(R,te);return Me.data[R]},k.getScopeDataFromName=function(R,te){return this.getScopeFromName(R,te).data},k.getScopeFromName=function(R,te){var Me=te;do if(R in Me.data)return Me;while(Me=Me.parent);return this.globalScope},k.setValue=function(R){var te=this.callStack.length;return this.isVarDeclMode||te||R===Kt||R===fe||R===Pe||R instanceof fs||R instanceof hs||(this.value=R instanceof Vo?R.value:R),R},k.getValue=function(){return this.value},b}();bo.version=Qe,bo.eval=$o,bo.Function=Ms,bo.ecmaVersion=5,bo.globalContextInFunction=void 0,bo.global=Object.create(null);function Gu(b){return b===void 0&&(b=Object.create(null)),b}function fc(b,k,Z){k===void 0&&(k=[]),Z===void 0&&(Z={});var R=Z.parsingContext,te=Z.timeout===void 0?0:Z.timeout,Me=`
    (function anonymous(`+k.join(",")+`){
         `+b+`
    });
    `,at=new bo(R,{ecmaVersion:Z.ecmaVersion,timeout:te,rootContext:Z.rootContext,globalContextInFunction:Z.globalContextInFunction});return at.evaluate(Me)}function Hu(b,k,Z){var R=new bo(k,Z);return R.evaluate(b)}var Bc=Hu,Il=function(){function b(Z){this._code=Z}var k=b.prototype;return k.runInContext=function(R){return Hu(this._code,R)},k.runInNewContext=function(R){return Hu(this._code,R)},b}(),ol=function(b,k,Z){return Hu(b,k,Z)};function vu(){for(var b=arguments.length,k=new Array(b),Z=0;Z<b;Z++)k[Z]=arguments[Z];var R=k.pop();return fc(R||"",k)}var sl=ol},20396:function(sn,pe,ee){var Le;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(Te,y,Ie,X){"use strict";var Se=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,se=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),rt=Se||se,ye=["","webkit","Moz","MS","ms","o"],ot=rt?"":y.createElement("div"),ct="function",bt=Math.round,Ot=Math.abs,vr=Date.now;function Ft(fe,Pe,ht){return setTimeout(Ct(fe,ht),Pe)}function gr(fe,Pe,ht){return Array.isArray(fe)?(qt(fe,ht[Pe],ht),!0):!1}function qt(fe,Pe,ht){var Kt;if(!!fe)if(fe.forEach)fe.forEach(Pe,ht);else if(fe.length!==X)for(Kt=0;Kt<fe.length;)Pe.call(ht,fe[Kt],Kt,fe),Kt++;else for(Kt in fe)fe.hasOwnProperty(Kt)&&Pe.call(ht,fe[Kt],Kt,fe)}function It(fe,Pe,ht){var Kt="DEPRECATED METHOD: "+Pe+`
`+ht+` AT 
`;return function(){var en=new Error("get-stack-trace"),qn=en&&en.stack?en.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ui=Te.console&&(Te.console.warn||Te.console.log);return Ui&&Ui.call(Te.console,Kt,qn),fe.apply(this,arguments)}}var Zt;typeof Object.assign!="function"?Zt=function(Pe){if(Pe===X||Pe===null)throw new TypeError("Cannot convert undefined or null to object");for(var ht=Object(Pe),Kt=1;Kt<arguments.length;Kt++){var en=arguments[Kt];if(en!==X&&en!==null)for(var qn in en)en.hasOwnProperty(qn)&&(ht[qn]=en[qn])}return ht}:Zt=Object.assign;var br=It(function(Pe,ht,Kt){for(var en=Object.keys(ht),qn=0;qn<en.length;)(!Kt||Kt&&Pe[en[qn]]===X)&&(Pe[en[qn]]=ht[en[qn]]),qn++;return Pe},"extend","Use `assign`."),J=It(function(Pe,ht){return br(Pe,ht,!0)},"merge","Use `assign`.");function Et(fe,Pe,ht){var Kt=Pe.prototype,en;en=fe.prototype=Object.create(Kt),en.constructor=fe,en._super=Kt,ht&&Zt(en,ht)}function Ct(fe,Pe){return function(){return fe.apply(Pe,arguments)}}function pt(fe,Pe){return typeof fe==ct?fe.apply(Pe&&Pe[0]||X,Pe):fe}function Ht(fe,Pe){return fe===X?Pe:fe}function vt(fe,Pe,ht){qt(Ze(Pe),function(Kt){fe.addEventListener(Kt,ht,!1)})}function sr(fe,Pe,ht){qt(Ze(Pe),function(Kt){fe.removeEventListener(Kt,ht,!1)})}function Ir(fe,Pe){for(;fe;){if(fe==Pe)return!0;fe=fe.parentNode}return!1}function ae(fe,Pe){return fe.indexOf(Pe)>-1}function Ze(fe){return fe.trim().split(/\s+/g)}function Y(fe,Pe,ht){if(fe.indexOf&&!ht)return fe.indexOf(Pe);for(var Kt=0;Kt<fe.length;){if(ht&&fe[Kt][ht]==Pe||!ht&&fe[Kt]===Pe)return Kt;Kt++}return-1}function ce(fe){return Array.prototype.slice.call(fe,0)}function ue(fe,Pe,ht){for(var Kt=[],en=[],qn=0;qn<fe.length;){var Ui=Pe?fe[qn][Pe]:fe[qn];Y(en,Ui)<0&&Kt.push(fe[qn]),en[qn]=Ui,qn++}return ht&&(Pe?Kt=Kt.sort(function(Ya,to){return Ya[Pe]>to[Pe]}):Kt=Kt.sort()),Kt}function Xe(fe,Pe){for(var ht,Kt,en=Pe[0].toUpperCase()+Pe.slice(1),qn=0;qn<ye.length;){if(ht=ye[qn],Kt=ht?ht+en:Pe,Kt in fe)return Kt;qn++}return X}var lt=1;function _t(){return lt++}function Xt(fe){var Pe=fe.ownerDocument||fe;return Pe.defaultView||Pe.parentWindow||Te}var hr=/mobile|tablet|ip(ad|hone|od)|android/i,Yr="ontouchstart"in Te,Hr=Xe(Te,"PointerEvent")!==X,vi=Yr&&hr.test(navigator.userAgent),Vn="touch",Xn="pen",ma="mouse",Pi="kinect",mi=25,ca=1,Gi=2,Si=4,ei=8,cr=1,mt=2,Wa=4,xa=8,gt=16,he=mt|Wa,ie=xa|gt,_e=he|ie,N=["x","y"],qe=["clientX","clientY"];function Qt(fe,Pe){var ht=this;this.manager=fe,this.callback=Pe,this.element=fe.element,this.target=fe.options.inputTarget,this.domHandler=function(Kt){pt(fe.options.enable,[fe])&&ht.handler(Kt)},this.init()}Qt.prototype={handler:function(){},init:function(){this.evEl&&vt(this.element,this.evEl,this.domHandler),this.evTarget&&vt(this.target,this.evTarget,this.domHandler),this.evWin&&vt(Xt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&sr(this.element,this.evEl,this.domHandler),this.evTarget&&sr(this.target,this.evTarget,this.domHandler),this.evWin&&sr(Xt(this.element),this.evWin,this.domHandler)}};function Nr(fe){var Pe,ht=fe.options.inputClass;return ht?Pe=ht:Hr?Pe=Be:vi?Pe=tr:Yr?Pe=$t:Pe=Wi,new Pe(fe,Ye)}function Ye(fe,Pe,ht){var Kt=ht.pointers.length,en=ht.changedPointers.length,qn=Pe&ca&&Kt-en==0,Ui=Pe&(Si|ei)&&Kt-en==0;ht.isFirst=!!qn,ht.isFinal=!!Ui,qn&&(fe.session={}),ht.eventType=Pe,Pt(fe,ht),fe.emit("hammer.input",ht),fe.recognize(ht),fe.session.prevInput=ht}function Pt(fe,Pe){var ht=fe.session,Kt=Pe.pointers,en=Kt.length;ht.firstInput||(ht.firstInput=Wr(Pe)),en>1&&!ht.firstMultiple?ht.firstMultiple=Wr(Pe):en===1&&(ht.firstMultiple=!1);var qn=ht.firstInput,Ui=ht.firstMultiple,lo=Ui?Ui.center:qn.center,Ya=Pe.center=tn(Kt);Pe.timeStamp=vr(),Pe.deltaTime=Pe.timeStamp-qn.timeStamp,Pe.angle=gi(lo,Ya),Pe.distance=an(lo,Ya),pr(ht,Pe),Pe.offsetDirection=jn(Pe.deltaX,Pe.deltaY);var to=Yn(Pe.deltaTime,Pe.deltaX,Pe.deltaY);Pe.overallVelocityX=to.x,Pe.overallVelocityY=to.y,Pe.overallVelocity=Ot(to.x)>Ot(to.y)?to.x:to.y,Pe.scale=Ui?fa(Ui.pointers,Kt):1,Pe.rotation=Ui?ci(Ui.pointers,Kt):0,Pe.maxPointers=ht.prevInput?Pe.pointers.length>ht.prevInput.maxPointers?Pe.pointers.length:ht.prevInput.maxPointers:Pe.pointers.length,Pr(ht,Pe);var $o=fe.element;Ir(Pe.srcEvent.target,$o)&&($o=Pe.srcEvent.target),Pe.target=$o}function pr(fe,Pe){var ht=Pe.center,Kt=fe.offsetDelta||{},en=fe.prevDelta||{},qn=fe.prevInput||{};(Pe.eventType===ca||qn.eventType===Si)&&(en=fe.prevDelta={x:qn.deltaX||0,y:qn.deltaY||0},Kt=fe.offsetDelta={x:ht.x,y:ht.y}),Pe.deltaX=en.x+(ht.x-Kt.x),Pe.deltaY=en.y+(ht.y-Kt.y)}function Pr(fe,Pe){var ht=fe.lastInterval||Pe,Kt=Pe.timeStamp-ht.timeStamp,en,qn,Ui,lo;if(Pe.eventType!=ei&&(Kt>mi||ht.velocity===X)){var Ya=Pe.deltaX-ht.deltaX,to=Pe.deltaY-ht.deltaY,$o=Yn(Kt,Ya,to);qn=$o.x,Ui=$o.y,en=Ot($o.x)>Ot($o.y)?$o.x:$o.y,lo=jn(Ya,to),fe.lastInterval=Pe}else en=ht.velocity,qn=ht.velocityX,Ui=ht.velocityY,lo=ht.direction;Pe.velocity=en,Pe.velocityX=qn,Pe.velocityY=Ui,Pe.direction=lo}function Wr(fe){for(var Pe=[],ht=0;ht<fe.pointers.length;)Pe[ht]={clientX:bt(fe.pointers[ht].clientX),clientY:bt(fe.pointers[ht].clientY)},ht++;return{timeStamp:vr(),pointers:Pe,center:tn(Pe),deltaX:fe.deltaX,deltaY:fe.deltaY}}function tn(fe){var Pe=fe.length;if(Pe===1)return{x:bt(fe[0].clientX),y:bt(fe[0].clientY)};for(var ht=0,Kt=0,en=0;en<Pe;)ht+=fe[en].clientX,Kt+=fe[en].clientY,en++;return{x:bt(ht/Pe),y:bt(Kt/Pe)}}function Yn(fe,Pe,ht){return{x:Pe/fe||0,y:ht/fe||0}}function jn(fe,Pe){return fe===Pe?cr:Ot(fe)>=Ot(Pe)?fe<0?mt:Wa:Pe<0?xa:gt}function an(fe,Pe,ht){ht||(ht=N);var Kt=Pe[ht[0]]-fe[ht[0]],en=Pe[ht[1]]-fe[ht[1]];return Math.sqrt(Kt*Kt+en*en)}function gi(fe,Pe,ht){ht||(ht=N);var Kt=Pe[ht[0]]-fe[ht[0]],en=Pe[ht[1]]-fe[ht[1]];return Math.atan2(en,Kt)*180/Math.PI}function ci(fe,Pe){return gi(Pe[1],Pe[0],qe)+gi(fe[1],fe[0],qe)}function fa(fe,Pe){return an(Pe[0],Pe[1],qe)/an(fe[0],fe[1],qe)}var ka={mousedown:ca,mousemove:Gi,mouseup:Si},Ua="mousedown",Ea="mousemove mouseup";function Wi(){this.evEl=Ua,this.evWin=Ea,this.pressed=!1,Qt.apply(this,arguments)}Et(Wi,Qt,{handler:function(Pe){var ht=ka[Pe.type];ht&ca&&Pe.button===0&&(this.pressed=!0),ht&Gi&&Pe.which!==1&&(ht=Si),!!this.pressed&&(ht&Si&&(this.pressed=!1),this.callback(this.manager,ht,{pointers:[Pe],changedPointers:[Pe],pointerType:ma,srcEvent:Pe}))}});var q={pointerdown:ca,pointermove:Gi,pointerup:Si,pointercancel:ei,pointerout:ei},re={2:Vn,3:Xn,4:ma,5:Pi},le="pointerdown",Ce="pointermove pointerup pointercancel";!rt&&Te.MSPointerEvent&&!Te.PointerEvent&&(le="MSPointerDown",Ce="MSPointerMove MSPointerUp MSPointerCancel");function Be(){this.evEl=le,this.evWin=Ce,Qt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Et(Be,Qt,{handler:function(Pe){var ht=this.store,Kt=!1,en=Pe.type.toLowerCase().replace("ms",""),qn=q[en],Ui=re[Pe.pointerType]||Pe.pointerType,lo=Ui==Vn,Ya=Y(ht,Pe.pointerId,"pointerId");qn&ca&&(Pe.button===0||lo)?Ya<0&&(ht.push(Pe),Ya=ht.length-1):qn&(Si|ei)&&(Kt=!0),!(Ya<0)&&(ht[Ya]=Pe,this.callback(this.manager,qn,{pointers:ht,changedPointers:[Pe],pointerType:Ui,srcEvent:Pe}),Kt&&ht.splice(Ya,1))}});var et={touchstart:ca,touchmove:Gi,touchend:Si,touchcancel:ei},dt="touchstart",me="touchstart touchmove touchend touchcancel";function Ge(){this.evTarget=dt,this.evWin=me,this.started=!1,Qt.apply(this,arguments)}Et(Ge,Qt,{handler:function(Pe){var ht=et[Pe.type];if(ht===ca&&(this.started=!0),!!this.started){var Kt=Dt.call(this,Pe,ht);ht&(Si|ei)&&Kt[0].length-Kt[1].length==0&&(this.started=!1),this.callback(this.manager,ht,{pointers:Kt[0],changedPointers:Kt[1],pointerType:Vn,srcEvent:Pe})}}});function Dt(fe,Pe){var ht=ce(fe.touches),Kt=ce(fe.changedTouches);return Pe&(Si|ei)&&(ht=ue(ht.concat(Kt),"identifier",!0)),[ht,Kt]}var Lr={touchstart:ca,touchmove:Gi,touchend:Si,touchcancel:ei},er="touchstart touchmove touchend touchcancel";function tr(){this.evTarget=er,this.targetIds={},Qt.apply(this,arguments)}Et(tr,Qt,{handler:function(Pe){var ht=Lr[Pe.type],Kt=Fr.call(this,Pe,ht);!Kt||this.callback(this.manager,ht,{pointers:Kt[0],changedPointers:Kt[1],pointerType:Vn,srcEvent:Pe})}});function Fr(fe,Pe){var ht=ce(fe.touches),Kt=this.targetIds;if(Pe&(ca|Gi)&&ht.length===1)return Kt[ht[0].identifier]=!0,[ht,ht];var en,qn,Ui=ce(fe.changedTouches),lo=[],Ya=this.target;if(qn=ht.filter(function(to){return Ir(to.target,Ya)}),Pe===ca)for(en=0;en<qn.length;)Kt[qn[en].identifier]=!0,en++;for(en=0;en<Ui.length;)Kt[Ui[en].identifier]&&lo.push(Ui[en]),Pe&(Si|ei)&&delete Kt[Ui[en].identifier],en++;if(!!lo.length)return[ue(qn.concat(lo),"identifier",!0),lo]}var In=2500,Pn=25;function $t(){Qt.apply(this,arguments);var fe=Ct(this.handler,this);this.touch=new tr(this.manager,fe),this.mouse=new Wi(this.manager,fe),this.primaryTouch=null,this.lastTouches=[]}Et($t,Qt,{handler:function(Pe,ht,Kt){var en=Kt.pointerType==Vn,qn=Kt.pointerType==ma;if(!(qn&&Kt.sourceCapabilities&&Kt.sourceCapabilities.firesTouchEvents)){if(en)wn.call(this,ht,Kt);else if(qn&&gn.call(this,Kt))return;this.callback(Pe,ht,Kt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function wn(fe,Pe){fe&ca?(this.primaryTouch=Pe.changedPointers[0].identifier,fn.call(this,Pe)):fe&(Si|ei)&&fn.call(this,Pe)}function fn(fe){var Pe=fe.changedPointers[0];if(Pe.identifier===this.primaryTouch){var ht={x:Pe.clientX,y:Pe.clientY};this.lastTouches.push(ht);var Kt=this.lastTouches,en=function(){var qn=Kt.indexOf(ht);qn>-1&&Kt.splice(qn,1)};setTimeout(en,In)}}function gn(fe){for(var Pe=fe.srcEvent.clientX,ht=fe.srcEvent.clientY,Kt=0;Kt<this.lastTouches.length;Kt++){var en=this.lastTouches[Kt],qn=Math.abs(Pe-en.x),Ui=Math.abs(ht-en.y);if(qn<=Pn&&Ui<=Pn)return!0}return!1}var Ii=rt?X:Xe(ot.style,"touchAction"),xn=Ii!==X,Ni="compute",sa="auto",Oi="manipulation",Zi="none",Fi="pan-x",yi="pan-y",ha=zi();function Xa(fe,Pe){this.manager=fe,this.set(Pe)}Xa.prototype={set:function(fe){fe==Ni&&(fe=this.compute()),xn&&this.manager.element.style&&ha[fe]&&(this.manager.element.style[Ii]=fe),this.actions=fe.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var fe=[];return qt(this.manager.recognizers,function(Pe){pt(Pe.options.enable,[Pe])&&(fe=fe.concat(Pe.getTouchAction()))}),ga(fe.join(" "))},preventDefaults:function(fe){var Pe=fe.srcEvent,ht=fe.offsetDirection;if(this.manager.session.prevented){Pe.preventDefault();return}var Kt=this.actions,en=ae(Kt,Zi)&&!ha[Zi],qn=ae(Kt,yi)&&!ha[yi],Ui=ae(Kt,Fi)&&!ha[Fi];if(en){var lo=fe.pointers.length===1,Ya=fe.distance<2,to=fe.deltaTime<250;if(lo&&Ya&&to)return}if(!(Ui&&qn)&&(en||qn&&ht&he||Ui&&ht&ie))return this.preventSrc(Pe)},preventSrc:function(fe){this.manager.session.prevented=!0,fe.preventDefault()}};function ga(fe){if(ae(fe,Zi))return Zi;var Pe=ae(fe,Fi),ht=ae(fe,yi);return Pe&&ht?Zi:Pe||ht?Pe?Fi:yi:ae(fe,Oi)?Oi:sa}function zi(){if(!xn)return!1;var fe={};if(rt)return fe;var Pe=Te.CSS&&Te.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ht){fe[ht]=Pe?Te.CSS.supports("touch-action",ht):!0}),fe}var Ji=1,Va=2,tu=4,$a=8,Fa=$a,Fs=16,$n=32;function ur(fe){this.options=Zt({},this.defaults,fe||{}),this.id=_t(),this.manager=null,this.options.enable=Ht(this.options.enable,!0),this.state=Ji,this.simultaneous={},this.requireFail=[]}ur.prototype={defaults:{},set:function(fe){return Zt(this.options,fe),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(fe){if(gr(fe,"recognizeWith",this))return this;var Pe=this.simultaneous;return fe=Ja(fe,this),Pe[fe.id]||(Pe[fe.id]=fe,fe.recognizeWith(this)),this},dropRecognizeWith:function(fe){return gr(fe,"dropRecognizeWith",this)?this:(fe=Ja(fe,this),delete this.simultaneous[fe.id],this)},requireFailure:function(fe){if(gr(fe,"requireFailure",this))return this;var Pe=this.requireFail;return fe=Ja(fe,this),Y(Pe,fe)===-1&&(Pe.push(fe),fe.requireFailure(this)),this},dropRequireFailure:function(fe){if(gr(fe,"dropRequireFailure",this))return this;fe=Ja(fe,this);var Pe=Y(this.requireFail,fe);return Pe>-1&&this.requireFail.splice(Pe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(fe){return!!this.simultaneous[fe.id]},emit:function(fe){var Pe=this,ht=this.state;function Kt(en){Pe.manager.emit(en,fe)}ht<$a&&Kt(Pe.options.event+$s(ht)),Kt(Pe.options.event),fe.additionalEvent&&Kt(fe.additionalEvent),ht>=$a&&Kt(Pe.options.event+$s(ht))},tryEmit:function(fe){if(this.canEmit())return this.emit(fe);this.state=$n},canEmit:function(){for(var fe=0;fe<this.requireFail.length;){if(!(this.requireFail[fe].state&($n|Ji)))return!1;fe++}return!0},recognize:function(fe){var Pe=Zt({},fe);if(!pt(this.options.enable,[this,Pe])){this.reset(),this.state=$n;return}this.state&(Fa|Fs|$n)&&(this.state=Ji),this.state=this.process(Pe),this.state&(Va|tu|$a|Fs)&&this.tryEmit(Pe)},process:function(fe){},getTouchAction:function(){},reset:function(){}};function $s(fe){return fe&Fs?"cancel":fe&$a?"end":fe&tu?"move":fe&Va?"start":""}function uo(fe){return fe==gt?"down":fe==xa?"up":fe==mt?"left":fe==Wa?"right":""}function Ja(fe,Pe){var ht=Pe.manager;return ht?ht.get(fe):fe}function eo(){ur.apply(this,arguments)}Et(eo,ur,{defaults:{pointers:1},attrTest:function(fe){var Pe=this.options.pointers;return Pe===0||fe.pointers.length===Pe},process:function(fe){var Pe=this.state,ht=fe.eventType,Kt=Pe&(Va|tu),en=this.attrTest(fe);return Kt&&(ht&ei||!en)?Pe|Fs:Kt||en?ht&Si?Pe|$a:Pe&Va?Pe|tu:Va:$n}});function wt(){eo.apply(this,arguments),this.pX=null,this.pY=null}Et(wt,eo,{defaults:{event:"pan",threshold:10,pointers:1,direction:_e},getTouchAction:function(){var fe=this.options.direction,Pe=[];return fe&he&&Pe.push(yi),fe&ie&&Pe.push(Fi),Pe},directionTest:function(fe){var Pe=this.options,ht=!0,Kt=fe.distance,en=fe.direction,qn=fe.deltaX,Ui=fe.deltaY;return en&Pe.direction||(Pe.direction&he?(en=qn===0?cr:qn<0?mt:Wa,ht=qn!=this.pX,Kt=Math.abs(fe.deltaX)):(en=Ui===0?cr:Ui<0?xa:gt,ht=Ui!=this.pY,Kt=Math.abs(fe.deltaY))),fe.direction=en,ht&&Kt>Pe.threshold&&en&Pe.direction},attrTest:function(fe){return eo.prototype.attrTest.call(this,fe)&&(this.state&Va||!(this.state&Va)&&this.directionTest(fe))},emit:function(fe){this.pX=fe.deltaX,this.pY=fe.deltaY;var Pe=uo(fe.direction);Pe&&(fe.additionalEvent=this.options.event+Pe),this._super.emit.call(this,fe)}});function zt(){eo.apply(this,arguments)}Et(zt,eo,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Zi]},attrTest:function(fe){return this._super.attrTest.call(this,fe)&&(Math.abs(fe.scale-1)>this.options.threshold||this.state&Va)},emit:function(fe){if(fe.scale!==1){var Pe=fe.scale<1?"in":"out";fe.additionalEvent=this.options.event+Pe}this._super.emit.call(this,fe)}});function rs(){ur.apply(this,arguments),this._timer=null,this._input=null}Et(rs,ur,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[sa]},process:function(fe){var Pe=this.options,ht=fe.pointers.length===Pe.pointers,Kt=fe.distance<Pe.threshold,en=fe.deltaTime>Pe.time;if(this._input=fe,!Kt||!ht||fe.eventType&(Si|ei)&&!en)this.reset();else if(fe.eventType&ca)this.reset(),this._timer=Ft(function(){this.state=Fa,this.tryEmit()},Pe.time,this);else if(fe.eventType&Si)return Fa;return $n},reset:function(){clearTimeout(this._timer)},emit:function(fe){this.state===Fa&&(fe&&fe.eventType&Si?this.manager.emit(this.options.event+"up",fe):(this._input.timeStamp=vr(),this.manager.emit(this.options.event,this._input)))}});function du(){eo.apply(this,arguments)}Et(du,eo,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Zi]},attrTest:function(fe){return this._super.attrTest.call(this,fe)&&(Math.abs(fe.rotation)>this.options.threshold||this.state&Va)}});function Io(){eo.apply(this,arguments)}Et(Io,eo,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:he|ie,pointers:1},getTouchAction:function(){return wt.prototype.getTouchAction.call(this)},attrTest:function(fe){var Pe=this.options.direction,ht;return Pe&(he|ie)?ht=fe.overallVelocity:Pe&he?ht=fe.overallVelocityX:Pe&ie&&(ht=fe.overallVelocityY),this._super.attrTest.call(this,fe)&&Pe&fe.offsetDirection&&fe.distance>this.options.threshold&&fe.maxPointers==this.options.pointers&&Ot(ht)>this.options.velocity&&fe.eventType&Si},emit:function(fe){var Pe=uo(fe.offsetDirection);Pe&&this.manager.emit(this.options.event+Pe,fe),this.manager.emit(this.options.event,fe)}});function za(){ur.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Et(za,ur,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Oi]},process:function(fe){var Pe=this.options,ht=fe.pointers.length===Pe.pointers,Kt=fe.distance<Pe.threshold,en=fe.deltaTime<Pe.time;if(this.reset(),fe.eventType&ca&&this.count===0)return this.failTimeout();if(Kt&&en&&ht){if(fe.eventType!=Si)return this.failTimeout();var qn=this.pTime?fe.timeStamp-this.pTime<Pe.interval:!0,Ui=!this.pCenter||an(this.pCenter,fe.center)<Pe.posThreshold;this.pTime=fe.timeStamp,this.pCenter=fe.center,!Ui||!qn?this.count=1:this.count+=1,this._input=fe;var lo=this.count%Pe.taps;if(lo===0)return this.hasRequireFailures()?(this._timer=Ft(function(){this.state=Fa,this.tryEmit()},Pe.interval,this),Va):Fa}return $n},failTimeout:function(){return this._timer=Ft(function(){this.state=$n},this.options.interval,this),$n},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Fa&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Sa(fe,Pe){return Pe=Pe||{},Pe.recognizers=Ht(Pe.recognizers,Sa.defaults.preset),new Rr(fe,Pe)}Sa.VERSION="2.0.7",Sa.defaults={domEvents:!1,touchAction:Ni,enable:!0,inputTarget:null,inputClass:null,preset:[[du,{enable:!1}],[zt,{enable:!1},["rotate"]],[Io,{direction:he}],[wt,{direction:he},["swipe"]],[za],[za,{event:"doubletap",taps:2},["tap"]],[rs]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var xo=1,Dr=2;function Rr(fe,Pe){this.options=Zt({},Sa.defaults,Pe||{}),this.options.inputTarget=this.options.inputTarget||fe,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=fe,this.input=Nr(this),this.touchAction=new Xa(this,this.options.touchAction),Qe(this,!0),qt(this.options.recognizers,function(ht){var Kt=this.add(new ht[0](ht[1]));ht[2]&&Kt.recognizeWith(ht[2]),ht[3]&&Kt.requireFailure(ht[3])},this)}Rr.prototype={set:function(fe){return Zt(this.options,fe),fe.touchAction&&this.touchAction.update(),fe.inputTarget&&(this.input.destroy(),this.input.target=fe.inputTarget,this.input.init()),this},stop:function(fe){this.session.stopped=fe?Dr:xo},recognize:function(fe){var Pe=this.session;if(!Pe.stopped){this.touchAction.preventDefaults(fe);var ht,Kt=this.recognizers,en=Pe.curRecognizer;(!en||en&&en.state&Fa)&&(en=Pe.curRecognizer=null);for(var qn=0;qn<Kt.length;)ht=Kt[qn],Pe.stopped!==Dr&&(!en||ht==en||ht.canRecognizeWith(en))?ht.recognize(fe):ht.reset(),!en&&ht.state&(Va|tu|$a)&&(en=Pe.curRecognizer=ht),qn++}},get:function(fe){if(fe instanceof ur)return fe;for(var Pe=this.recognizers,ht=0;ht<Pe.length;ht++)if(Pe[ht].options.event==fe)return Pe[ht];return null},add:function(fe){if(gr(fe,"add",this))return this;var Pe=this.get(fe.options.event);return Pe&&this.remove(Pe),this.recognizers.push(fe),fe.manager=this,this.touchAction.update(),fe},remove:function(fe){if(gr(fe,"remove",this))return this;if(fe=this.get(fe),fe){var Pe=this.recognizers,ht=Y(Pe,fe);ht!==-1&&(Pe.splice(ht,1),this.touchAction.update())}return this},on:function(fe,Pe){if(fe!==X&&Pe!==X){var ht=this.handlers;return qt(Ze(fe),function(Kt){ht[Kt]=ht[Kt]||[],ht[Kt].push(Pe)}),this}},off:function(fe,Pe){if(fe!==X){var ht=this.handlers;return qt(Ze(fe),function(Kt){Pe?ht[Kt]&&ht[Kt].splice(Y(ht[Kt],Pe),1):delete ht[Kt]}),this}},emit:function(fe,Pe){this.options.domEvents&&Fu(fe,Pe);var ht=this.handlers[fe]&&this.handlers[fe].slice();if(!(!ht||!ht.length)){Pe.type=fe,Pe.preventDefault=function(){Pe.srcEvent.preventDefault()};for(var Kt=0;Kt<ht.length;)ht[Kt](Pe),Kt++}},destroy:function(){this.element&&Qe(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Qe(fe,Pe){var ht=fe.element;if(!!ht.style){var Kt;qt(fe.options.cssProps,function(en,qn){Kt=Xe(ht.style,qn),Pe?(fe.oldCssProps[Kt]=ht.style[Kt],ht.style[Kt]=en):ht.style[Kt]=fe.oldCssProps[Kt]||""}),Pe||(fe.oldCssProps={})}}function Fu(fe,Pe){if(!rt){var ht=y.createEvent("Event");ht.initEvent(fe,!0,!0),ht.gesture=Pe,Pe.target.dispatchEvent(ht)}}if(!rt){Zt(Sa,{INPUT_START:ca,INPUT_MOVE:Gi,INPUT_END:Si,INPUT_CANCEL:ei,STATE_POSSIBLE:Ji,STATE_BEGAN:Va,STATE_CHANGED:tu,STATE_ENDED:$a,STATE_RECOGNIZED:Fa,STATE_CANCELLED:Fs,STATE_FAILED:$n,DIRECTION_NONE:cr,DIRECTION_LEFT:mt,DIRECTION_RIGHT:Wa,DIRECTION_UP:xa,DIRECTION_DOWN:gt,DIRECTION_HORIZONTAL:he,DIRECTION_VERTICAL:ie,DIRECTION_ALL:_e,Manager:Rr,Input:Qt,TouchAction:Xa,TouchInput:tr,MouseInput:Wi,PointerEventInput:Be,TouchMouseInput:$t,SingleTouchInput:Ge,Recognizer:ur,AttrRecognizer:eo,Tap:za,Pan:wt,Swipe:Io,Pinch:zt,Rotate:du,Press:rs,on:vt,off:sr,each:qt,merge:J,extend:br,assign:Zt,inherit:Et,bindFn:Ct,prefixed:Xe});var He=typeof window!="undefined"?window:typeof self!="undefined"?self:{};He.Hammer=Sa,Le=function(){return Sa}.call(pe,ee,pe,sn),Le!==X&&(sn.exports=Le)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(sn,pe,ee){(function(Le,Te){sn.exports=Te(ee(18857))})(this,function(Le){"use strict";var Te=function(U){return U instanceof Uint8Array||U instanceof Uint16Array||U instanceof Uint32Array||U instanceof Int8Array||U instanceof Int16Array||U instanceof Int32Array||U instanceof Float32Array||U instanceof Float64Array||U instanceof Uint8ClampedArray},y=function(U,we){for(var $e=Object.keys(we),rr=0;rr<$e.length;++rr)U[$e[rr]]=we[$e[rr]];return U},Ie=`
`;function X(U){return typeof atob!="undefined"?atob(U):"base64:"+U}function Se(U){var we=new Error("(regl) "+U);throw console.error(we),we}function se(U,we){U||Se(we)}function rt(U){return U?": "+U:""}function ye(U,we,$e){U in we||Se("unknown parameter ("+U+")"+rt($e)+". possible values: "+Object.keys(we).join())}function ot(U,we){Te(U)||Se("invalid parameter type"+rt(we)+". must be a typed array")}function ct(U,we){switch(we){case"number":return typeof U=="number";case"object":return typeof U=="object";case"string":return typeof U=="string";case"boolean":return typeof U=="boolean";case"function":return typeof U=="function";case"undefined":return typeof U=="undefined";case"symbol":return typeof U=="symbol"}}function bt(U,we,$e){ct(U,we)||Se("invalid parameter type"+rt($e)+". expected "+we+", got "+typeof U)}function Ot(U,we){U>=0&&(U|0)===U||Se("invalid parameter type, ("+U+")"+rt(we)+". must be a nonnegative integer")}function vr(U,we,$e){we.indexOf(U)<0&&Se("invalid value"+rt($e)+". must be one of: "+we)}var Ft=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function gr(U){Object.keys(U).forEach(function(we){Ft.indexOf(we)<0&&Se('invalid regl constructor argument "'+we+'". must be one of '+Ft)})}function qt(U,we){for(U=U+"";U.length<we;)U=" "+U;return U}function It(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Zt(U,we){this.number=U,this.line=we,this.errors=[]}function br(U,we,$e){this.file=U,this.line=we,this.message=$e}function J(){var U=new Error,we=(U.stack||U).toString(),$e=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(we);if($e)return $e[1];var rr=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(we);return rr?rr[1]:"unknown"}function Et(){var U=new Error,we=(U.stack||U).toString(),$e=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(we);if($e)return $e[1];var rr=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(we);return rr?rr[1]:"unknown"}function Ct(U,we){var $e=U.split(`
`),rr=1,wr=0,Jt={unknown:new It,0:new It};Jt.unknown.name=Jt[0].name=we||J(),Jt.unknown.lines.push(new Zt(0,""));for(var yr=0;yr<$e.length;++yr){var kr=$e[yr],Br=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(kr);if(Br)switch(Br[1]){case"line":var Zr=/(\d+)(\s+\d+)?/.exec(Br[2]);Zr&&(rr=Zr[1]|0,Zr[2]&&(wr=Zr[2]|0,wr in Jt||(Jt[wr]=new It)));break;case"define":var $r=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Br[2]);$r&&(Jt[wr].name=$r[1]?X($r[2]):$r[2]);break}Jt[wr].lines.push(new Zt(rr++,kr))}return Object.keys(Jt).forEach(function(qr){var hn=Jt[qr];hn.lines.forEach(function(Ur){hn.index[Ur.number]=Ur})}),Jt}function pt(U){var we=[];return U.split(`
`).forEach(function($e){if(!($e.length<5)){var rr=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec($e);rr?we.push(new br(rr[1]|0,rr[2]|0,rr[3].trim())):$e.length>0&&we.push(new br("unknown",0,$e))}}),we}function Ht(U,we){we.forEach(function($e){var rr=U[$e.file];if(rr){var wr=rr.index[$e.line];if(wr){wr.errors.push($e),rr.hasErrors=!0;return}}U.unknown.hasErrors=!0,U.unknown.lines[0].errors.push($e)})}function vt(U,we,$e,rr,wr){if(!U.getShaderParameter(we,U.COMPILE_STATUS)){var Jt=U.getShaderInfoLog(we),yr=rr===U.FRAGMENT_SHADER?"fragment":"vertex";ue($e,"string",yr+" shader source must be a string",wr);var kr=Ct($e,wr),Br=pt(Jt);Ht(kr,Br),Object.keys(kr).forEach(function(Zr){var $r=kr[Zr];if(!$r.hasErrors)return;var qr=[""],hn=[""];function Ur(Kr,Tt){qr.push(Kr),hn.push(Tt||"")}Ur("file number "+Zr+": "+$r.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),$r.lines.forEach(function(Kr){if(Kr.errors.length>0){Ur(qt(Kr.number,4)+"|  ","background-color:yellow; font-weight:bold"),Ur(Kr.line+Ie,"color:red; background-color:yellow; font-weight:bold");var Tt=0;Kr.errors.forEach(function(ar){var Vr=ar.message,un=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Vr);if(un){var Er=un[1];switch(Vr=un[2],Er){case"assign":Er="=";break}Tt=Math.max(Kr.line.indexOf(Er,Tt),0)}else Tt=0;Ur(qt("| ",6)),Ur(qt("^^^",Tt+3)+Ie,"font-weight:bold"),Ur(qt("| ",6)),Ur(Vr+Ie,"font-weight:bold")}),Ur(qt("| ",6)+Ie)}else Ur(qt(Kr.number,4)+"|  "),Ur(Kr.line+Ie,"color:red")}),typeof document!="undefined"&&!window.chrome?(hn[0]=qr.join("%c"),console.log.apply(console,hn)):console.log(qr.join(""))}),se.raise("Error compiling "+yr+" shader, "+kr[0].name)}}function sr(U,we,$e,rr,wr){if(!U.getProgramParameter(we,U.LINK_STATUS)){var Jt=U.getProgramInfoLog(we),yr=Ct($e,wr),kr=Ct(rr,wr),Br='Error linking program with vertex shader, "'+kr[0].name+'", and fragment shader "'+yr[0].name+'"';typeof document!="undefined"?console.log("%c"+Br+Ie+"%c"+Jt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Br+Ie+Jt),se.raise(Br)}}function Ir(U){U._commandRef=J()}function ae(U,we,$e,rr){Ir(U);function wr(Br){return Br?rr.id(Br):0}U._fragId=wr(U.static.frag),U._vertId=wr(U.static.vert);function Jt(Br,Zr){Object.keys(Zr).forEach(function($r){Br[rr.id($r)]=!0})}var yr=U._uniformSet={};Jt(yr,we.static),Jt(yr,we.dynamic);var kr=U._attributeSet={};Jt(kr,$e.static),Jt(kr,$e.dynamic),U._hasCount="count"in U.static||"count"in U.dynamic||"elements"in U.static||"elements"in U.dynamic}function Ze(U,we){var $e=Et();Se(U+" in command "+(we||J())+($e==="unknown"?"":" called from "+$e))}function Y(U,we,$e){U||Ze(we,$e||J())}function ce(U,we,$e,rr){U in we||Ze("unknown parameter ("+U+")"+rt($e)+". possible values: "+Object.keys(we).join(),rr||J())}function ue(U,we,$e,rr){ct(U,we)||Ze("invalid parameter type"+rt($e)+". expected "+we+", got "+typeof U,rr||J())}function Xe(U){U()}function lt(U,we,$e){U.texture?vr(U.texture._texture.internalformat,we,"unsupported texture format for attachment"):vr(U.renderbuffer._renderbuffer.format,$e,"unsupported renderbuffer format for attachment")}var _t=33071,Xt=9728,hr=9984,Yr=9985,Hr=9986,vi=9987,Vn=5120,Xn=5121,ma=5122,Pi=5123,mi=5124,ca=5125,Gi=5126,Si=32819,ei=32820,cr=33635,mt=34042,Wa=36193,xa={};xa[Vn]=xa[Xn]=1,xa[ma]=xa[Pi]=xa[Wa]=xa[cr]=xa[Si]=xa[ei]=2,xa[mi]=xa[ca]=xa[Gi]=xa[mt]=4;function gt(U,we){return U===ei||U===Si||U===cr?2:U===mt?4:xa[U]*we}function he(U){return!(U&U-1)&&!!U}function ie(U,we,$e){var rr,wr=we.width,Jt=we.height,yr=we.channels;se(wr>0&&wr<=$e.maxTextureSize&&Jt>0&&Jt<=$e.maxTextureSize,"invalid texture shape"),(U.wrapS!==_t||U.wrapT!==_t)&&se(he(wr)&&he(Jt),"incompatible wrap mode for texture, both width and height must be power of 2"),we.mipmask===1?wr!==1&&Jt!==1&&se(U.minFilter!==hr&&U.minFilter!==Hr&&U.minFilter!==Yr&&U.minFilter!==vi,"min filter requires mipmap"):(se(he(wr)&&he(Jt),"texture must be a square power of 2 to support mipmapping"),se(we.mipmask===(wr<<1)-1,"missing or incomplete mipmap data")),we.type===Gi&&($e.extensions.indexOf("oes_texture_float_linear")<0&&se(U.minFilter===Xt&&U.magFilter===Xt,"filter not supported, must enable oes_texture_float_linear"),se(!U.genMipmaps,"mipmap generation not supported with float textures"));var kr=we.images;for(rr=0;rr<16;++rr)if(kr[rr]){var Br=wr>>rr,Zr=Jt>>rr;se(we.mipmask&1<<rr,"missing mipmap data");var $r=kr[rr];if(se($r.width===Br&&$r.height===Zr,"invalid shape for mip images"),se($r.format===we.format&&$r.internalformat===we.internalformat&&$r.type===we.type,"incompatible type for mip image"),!$r.compressed)if($r.data){var qr=Math.ceil(gt($r.type,yr)*Br/$r.unpackAlignment)*$r.unpackAlignment;se($r.data.byteLength===qr*Zr,"invalid data for image, buffer size is inconsistent with image format")}else $r.element||$r.copy}else U.genMipmaps||se((we.mipmask&1<<rr)==0,"extra mipmap data");we.compressed&&se(!U.genMipmaps,"mipmap generation for compressed images not supported")}function _e(U,we,$e,rr){var wr=U.width,Jt=U.height,yr=U.channels;se(wr>0&&wr<=rr.maxTextureSize&&Jt>0&&Jt<=rr.maxTextureSize,"invalid texture shape"),se(wr===Jt,"cube map must be square"),se(we.wrapS===_t&&we.wrapT===_t,"wrap mode not supported by cube map");for(var kr=0;kr<$e.length;++kr){var Br=$e[kr];se(Br.width===wr&&Br.height===Jt,"inconsistent cube map face shape"),we.genMipmaps&&(se(!Br.compressed,"can not generate mipmap for compressed textures"),se(Br.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Zr=Br.images,$r=0;$r<16;++$r){var qr=Zr[$r];if(qr){var hn=wr>>$r,Ur=Jt>>$r;se(Br.mipmask&1<<$r,"missing mipmap data"),se(qr.width===hn&&qr.height===Ur,"invalid shape for mip images"),se(qr.format===U.format&&qr.internalformat===U.internalformat&&qr.type===U.type,"incompatible type for mip image"),qr.compressed||(qr.data?se(qr.data.byteLength===hn*Ur*Math.max(gt(qr.type,yr),qr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):qr.element||qr.copy)}}}}var N=y(se,{optional:Xe,raise:Se,commandRaise:Ze,command:Y,parameter:ye,commandParameter:ce,constructor:gr,type:bt,commandType:ue,isTypedArray:ot,nni:Ot,oneOf:vr,shaderError:vt,linkError:sr,callSite:Et,saveCommandRef:Ir,saveDrawInfo:ae,framebufferFormat:lt,guessCommand:J,texture2D:ie,textureCube:_e}),qe=0,Qt=0,Nr=5,Ye=6;function Pt(U,we){this.id=qe++,this.type=U,this.data=we}function pr(U){return U.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Pr(U){if(U.length===0)return[];var we=U.charAt(0),$e=U.charAt(U.length-1);if(U.length>1&&we===$e&&(we==='"'||we==="'"))return['"'+pr(U.substr(1,U.length-2))+'"'];var rr=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(U);if(rr)return Pr(U.substr(0,rr.index)).concat(Pr(rr[1])).concat(Pr(U.substr(rr.index+rr[0].length)));var wr=U.split(".");if(wr.length===1)return['"'+pr(U)+'"'];for(var Jt=[],yr=0;yr<wr.length;++yr)Jt=Jt.concat(Pr(wr[yr]));return Jt}function Wr(U){return"["+Pr(U).join("][")+"]"}function tn(U,we){return new Pt(U,Wr(we+""))}function Yn(U){return typeof U=="function"&&!U._reglType||U instanceof Pt}function jn(U,we){if(typeof U=="function")return new Pt(Qt,U);if(typeof U=="number"||typeof U=="boolean")return new Pt(Nr,U);if(Array.isArray(U))return new Pt(Ye,U.map(function($e,rr){return jn($e,we+"["+rr+"]")}));if(U instanceof Pt)return U;N(!1,"invalid option type in uniform "+we)}var an={DynamicVariable:Pt,define:tn,isDynamic:Yn,unbox:jn,accessor:Wr},gi={next:typeof requestAnimationFrame=="function"?function(U){return requestAnimationFrame(U)}:function(U){return setTimeout(U,16)},cancel:typeof cancelAnimationFrame=="function"?function(U){return cancelAnimationFrame(U)}:clearTimeout},ci=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,fa=ci?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function ka(){var U={"":0},we=[""];return{id:function($e){var rr=U[$e];return rr||(rr=U[$e]=we.length,we.push($e),rr)},str:function($e){return we[$e]}}}function Ua(U,we,$e){var rr=document.createElement("canvas");y(rr.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),U.appendChild(rr),U===document.body&&(rr.style.position="absolute",y(U.style,{margin:0,padding:0}));function wr(){var kr=window.innerWidth,Br=window.innerHeight;if(U!==document.body){var Zr=rr.getBoundingClientRect();kr=Zr.right-Zr.left,Br=Zr.bottom-Zr.top}rr.width=$e*kr,rr.height=$e*Br}var Jt;U!==document.body&&typeof ResizeObserver=="function"?(Jt=new ResizeObserver(function(){setTimeout(wr)}),Jt.observe(U)):window.addEventListener("resize",wr,!1);function yr(){Jt?Jt.disconnect():window.removeEventListener("resize",wr),U.removeChild(rr)}return wr(),{canvas:rr,onDestroy:yr}}function Ea(U,we){function $e(rr){try{return U.getContext(rr,we)}catch(wr){return null}}return $e("webgl")||$e("experimental-webgl")||$e("webgl-experimental")}function Wi(U){return typeof U.nodeName=="string"&&typeof U.appendChild=="function"&&typeof U.getBoundingClientRect=="function"}function q(U){return typeof U.drawArrays=="function"||typeof U.drawElements=="function"}function re(U){return typeof U=="string"?U.split():(N(Array.isArray(U),"invalid extension array"),U)}function le(U){return typeof U=="string"?(N(typeof document!="undefined","not supported outside of DOM"),document.querySelector(U)):U}function Ce(U){var we=U||{},$e,rr,wr,Jt,yr={},kr=[],Br=[],Zr=typeof window=="undefined"?1:window.devicePixelRatio,$r=!1,qr=function(Kr){Kr&&N.raise(Kr)},hn=function(){};if(typeof we=="string"?(N(typeof document!="undefined","selector queries only supported in DOM environments"),$e=document.querySelector(we),N($e,"invalid query string for element")):typeof we=="object"?Wi(we)?$e=we:q(we)?(Jt=we,wr=Jt.canvas):(N.constructor(we),"gl"in we?Jt=we.gl:"canvas"in we?wr=le(we.canvas):"container"in we&&(rr=le(we.container)),"attributes"in we&&(yr=we.attributes,N.type(yr,"object","invalid context attributes")),"extensions"in we&&(kr=re(we.extensions)),"optionalExtensions"in we&&(Br=re(we.optionalExtensions)),"onDone"in we&&(N.type(we.onDone,"function","invalid or missing onDone callback"),qr=we.onDone),"profile"in we&&($r=!!we.profile),"pixelRatio"in we&&(Zr=+we.pixelRatio,N(Zr>0,"invalid pixel ratio"))):N.raise("invalid arguments to regl"),$e&&($e.nodeName.toLowerCase()==="canvas"?wr=$e:rr=$e),!Jt){if(!wr){N(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Ur=Ua(rr||document.body,qr,Zr);if(!Ur)return null;wr=Ur.canvas,hn=Ur.onDestroy}yr.premultipliedAlpha===void 0&&(yr.premultipliedAlpha=!0),Jt=Ea(wr,yr)}return Jt?{gl:Jt,canvas:wr,container:rr,extensions:kr,optionalExtensions:Br,pixelRatio:Zr,profile:$r,onDone:qr,onDestroy:hn}:(hn(),qr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Be(U,we){var $e={};function rr(kr){N.type(kr,"string","extension name must be string");var Br=kr.toLowerCase(),Zr;try{Zr=$e[Br]=wr(kr)}catch($r){}return!!Zr}function wr(kr){return U.getExtension(kr)?U.getExtension(kr):U.getExtension(kr.toLowerCase())?U.getExtension(kr.toLowerCase()):null}for(var Jt=0;Jt<we.extensions.length;++Jt){var yr=we.extensions[Jt];if(!rr(yr))return we.onDestroy(),we.onDone('"'+yr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return we.optionalExtensions.forEach(rr),{extensions:$e,restore:function(){Object.keys($e).forEach(function(kr){if($e[kr]&&!rr(kr))throw new Error("(regl): error restoring extension "+kr)})}}}function et(U,we){for(var $e=Array(U),rr=0;rr<U;++rr)$e[rr]=we(rr);return $e}var dt=5120,me=5121,Ge=5122,Dt=5123,Lr=5124,er=5125,tr=5126;function Fr(U){for(var we=16;we<=1<<28;we*=16)if(U<=we)return we;return 0}function In(U){var we,$e;return we=(U>65535)<<4,U>>>=we,$e=(U>255)<<3,U>>>=$e,we|=$e,$e=(U>15)<<2,U>>>=$e,we|=$e,$e=(U>3)<<1,U>>>=$e,we|=$e,we|U>>1}function Pn(){var U=et(8,function(){return[]});function we(Jt){var yr=Fr(Jt),kr=U[In(yr)>>2];return kr.length>0?kr.pop():new ArrayBuffer(yr)}function $e(Jt){U[In(Jt.byteLength)>>2].push(Jt)}function rr(Jt,yr){var kr=null;switch(Jt){case dt:kr=new Int8Array(we(yr),0,yr);break;case me:kr=new Uint8Array(we(yr),0,yr);break;case Ge:kr=new Int16Array(we(2*yr),0,yr);break;case Dt:kr=new Uint16Array(we(2*yr),0,yr);break;case Lr:kr=new Int32Array(we(4*yr),0,yr);break;case er:kr=new Uint32Array(we(4*yr),0,yr);break;case tr:kr=new Float32Array(we(4*yr),0,yr);break;default:return null}return kr.length!==yr?kr.subarray(0,yr):kr}function wr(Jt){$e(Jt.buffer)}return{alloc:we,free:$e,allocType:rr,freeType:wr}}var $t=Pn();$t.zero=Pn();var wn=3408,fn=3410,gn=3411,Ii=3412,xn=3413,Ni=3414,sa=3415,Oi=33901,Zi=33902,Fi=3379,yi=3386,ha=34921,Xa=36347,ga=36348,zi=35661,Ji=35660,Va=34930,tu=36349,$a=34076,Fa=34024,Fs=7936,$n=7937,ur=7938,$s=35724,uo=34047,Ja=36063,eo=34852,wt=3553,zt=34067,rs=34069,du=33984,Io=6408,za=5126,Sa=5121,xo=36160,Dr=36053,Rr=36064,Qe=16384,Fu=function(U,we){var $e=1;we.ext_texture_filter_anisotropic&&($e=U.getParameter(uo));var rr=1,wr=1;we.webgl_draw_buffers&&(rr=U.getParameter(eo),wr=U.getParameter(Ja));var Jt=!!we.oes_texture_float;if(Jt){var yr=U.createTexture();U.bindTexture(wt,yr),U.texImage2D(wt,0,Io,1,1,0,Io,za,null);var kr=U.createFramebuffer();if(U.bindFramebuffer(xo,kr),U.framebufferTexture2D(xo,Rr,wt,yr,0),U.bindTexture(wt,null),U.checkFramebufferStatus(xo)!==Dr)Jt=!1;else{U.viewport(0,0,1,1),U.clearColor(1,0,0,1),U.clear(Qe);var Br=$t.allocType(za,4);U.readPixels(0,0,1,1,Io,za,Br),U.getError()?Jt=!1:(U.deleteFramebuffer(kr),U.deleteTexture(yr),Jt=Br[0]===1),$t.freeType(Br)}}var Zr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),$r=!0;if(!Zr){var qr=U.createTexture(),hn=$t.allocType(Sa,36);U.activeTexture(du),U.bindTexture(zt,qr),U.texImage2D(rs,0,Io,3,3,0,Io,Sa,hn),$t.freeType(hn),U.bindTexture(zt,null),U.deleteTexture(qr),$r=!U.getError()}return{colorBits:[U.getParameter(fn),U.getParameter(gn),U.getParameter(Ii),U.getParameter(xn)],depthBits:U.getParameter(Ni),stencilBits:U.getParameter(sa),subpixelBits:U.getParameter(wn),extensions:Object.keys(we).filter(function(Ur){return!!we[Ur]}),maxAnisotropic:$e,maxDrawbuffers:rr,maxColorAttachments:wr,pointSizeDims:U.getParameter(Oi),lineWidthDims:U.getParameter(Zi),maxViewportDims:U.getParameter(yi),maxCombinedTextureUnits:U.getParameter(zi),maxCubeMapSize:U.getParameter($a),maxRenderbufferSize:U.getParameter(Fa),maxTextureUnits:U.getParameter(Va),maxTextureSize:U.getParameter(Fi),maxAttributes:U.getParameter(ha),maxVertexUniforms:U.getParameter(Xa),maxVertexTextureUnits:U.getParameter(Ji),maxVaryingVectors:U.getParameter(ga),maxFragmentUniforms:U.getParameter(tu),glsl:U.getParameter($s),renderer:U.getParameter($n),vendor:U.getParameter(Fs),version:U.getParameter(ur),readFloat:Jt,npotTextureCube:$r}};function He(U){return!!U&&typeof U=="object"&&Array.isArray(U.shape)&&Array.isArray(U.stride)&&typeof U.offset=="number"&&U.shape.length===U.stride.length&&(Array.isArray(U.data)||Te(U.data))}var fe=function(U){return Object.keys(U).map(function(we){return U[we]})},Pe={shape:lo,flatten:Ui};function ht(U,we,$e){for(var rr=0;rr<we;++rr)$e[rr]=U[rr]}function Kt(U,we,$e,rr){for(var wr=0,Jt=0;Jt<we;++Jt)for(var yr=U[Jt],kr=0;kr<$e;++kr)rr[wr++]=yr[kr]}function en(U,we,$e,rr,wr,Jt){for(var yr=Jt,kr=0;kr<we;++kr)for(var Br=U[kr],Zr=0;Zr<$e;++Zr)for(var $r=Br[Zr],qr=0;qr<rr;++qr)wr[yr++]=$r[qr]}function qn(U,we,$e,rr,wr){for(var Jt=1,yr=$e+1;yr<we.length;++yr)Jt*=we[yr];var kr=we[$e];if(we.length-$e==4){var Br=we[$e+1],Zr=we[$e+2],$r=we[$e+3];for(yr=0;yr<kr;++yr)en(U[yr],Br,Zr,$r,rr,wr),wr+=Jt}else for(yr=0;yr<kr;++yr)qn(U[yr],we,$e+1,rr,wr),wr+=Jt}function Ui(U,we,$e,rr){var wr=1;if(we.length)for(var Jt=0;Jt<we.length;++Jt)wr*=we[Jt];else wr=0;var yr=rr||$t.allocType($e,wr);switch(we.length){case 0:break;case 1:ht(U,we[0],yr);break;case 2:Kt(U,we[0],we[1],yr);break;case 3:en(U,we[0],we[1],we[2],yr,0);break;default:qn(U,we,0,yr,0)}return yr}function lo(U){for(var we=[],$e=U;$e.length;$e=$e[0])we.push($e.length);return we}var Ya={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},to=5120,$o=5122,Ms=5124,Vo=5121,fs=5123,hs=5125,ys=5126,ks=5126,ru={int8:to,int16:$o,int32:Ms,uint8:Vo,uint16:fs,uint32:hs,float:ys,float32:ks},_s=35048,ya=35040,bo={dynamic:_s,stream:ya,static:35044},Gu=Pe.flatten,fc=Pe.shape,Hu=35044,Bc=35040,Il=5121,ol=5126,vu=[];vu[5120]=1,vu[5122]=2,vu[5124]=4,vu[5121]=1,vu[5123]=2,vu[5125]=4,vu[5126]=4;function sl(U){return Ya[Object.prototype.toString.call(U)]|0}function b(U,we){for(var $e=0;$e<we.length;++$e)U[$e]=we[$e]}function k(U,we,$e,rr,wr,Jt,yr){for(var kr=0,Br=0;Br<$e;++Br)for(var Zr=0;Zr<rr;++Zr)U[kr++]=we[wr*Br+Jt*Zr+yr]}function Z(U,we,$e,rr){var wr=0,Jt={};function yr(Tt){this.id=wr++,this.buffer=U.createBuffer(),this.type=Tt,this.usage=Hu,this.byteLength=0,this.dimension=1,this.dtype=Il,this.persistentData=null,$e.profile&&(this.stats={size:0})}yr.prototype.bind=function(){U.bindBuffer(this.type,this.buffer)},yr.prototype.destroy=function(){hn(this)};var kr=[];function Br(Tt,ar){var Vr=kr.pop();return Vr||(Vr=new yr(Tt)),Vr.bind(),qr(Vr,ar,Bc,0,1,!1),Vr}function Zr(Tt){kr.push(Tt)}function $r(Tt,ar,Vr){Tt.byteLength=ar.byteLength,U.bufferData(Tt.type,ar,Vr)}function qr(Tt,ar,Vr,un,Er,Jr){var yn;if(Tt.usage=Vr,Array.isArray(ar)){if(Tt.dtype=un||ol,ar.length>0){var ai;if(Array.isArray(ar[0])){yn=fc(ar);for(var _r=1,Sr=1;Sr<yn.length;++Sr)_r*=yn[Sr];Tt.dimension=_r,ai=Gu(ar,yn,Tt.dtype),$r(Tt,ai,Vr),Jr?Tt.persistentData=ai:$t.freeType(ai)}else if(typeof ar[0]=="number"){Tt.dimension=Er;var Gn=$t.allocType(Tt.dtype,ar.length);b(Gn,ar),$r(Tt,Gn,Vr),Jr?Tt.persistentData=Gn:$t.freeType(Gn)}else Te(ar[0])?(Tt.dimension=ar[0].length,Tt.dtype=un||sl(ar[0])||ol,ai=Gu(ar,[ar.length,ar[0].length],Tt.dtype),$r(Tt,ai,Vr),Jr?Tt.persistentData=ai:$t.freeType(ai)):N.raise("invalid buffer data")}}else if(Te(ar))Tt.dtype=un||sl(ar),Tt.dimension=Er,$r(Tt,ar,Vr),Jr&&(Tt.persistentData=new Uint8Array(new Uint8Array(ar.buffer)));else if(He(ar)){yn=ar.shape;var nn=ar.stride,Gr=ar.offset,mn=0,_n=0,Ri=0,Ei=0;yn.length===1?(mn=yn[0],_n=1,Ri=nn[0],Ei=0):yn.length===2?(mn=yn[0],_n=yn[1],Ri=nn[0],Ei=nn[1]):N.raise("invalid shape"),Tt.dtype=un||sl(ar.data)||ol,Tt.dimension=_n;var pn=$t.allocType(Tt.dtype,mn*_n);k(pn,ar.data,mn,_n,Ri,Ei,Gr),$r(Tt,pn,Vr),Jr?Tt.persistentData=pn:$t.freeType(pn)}else ar instanceof ArrayBuffer?(Tt.dtype=Il,Tt.dimension=Er,$r(Tt,ar,Vr),Jr&&(Tt.persistentData=new Uint8Array(new Uint8Array(ar)))):N.raise("invalid buffer data")}function hn(Tt){we.bufferCount--,rr(Tt);var ar=Tt.buffer;N(ar,"buffer must not be deleted already"),U.deleteBuffer(ar),Tt.buffer=null,delete Jt[Tt.id]}function Ur(Tt,ar,Vr,un){we.bufferCount++;var Er=new yr(ar);Jt[Er.id]=Er;function Jr(_r){var Sr=Hu,Gn=null,nn=0,Gr=0,mn=1;return Array.isArray(_r)||Te(_r)||He(_r)||_r instanceof ArrayBuffer?Gn=_r:typeof _r=="number"?nn=_r|0:_r&&(N.type(_r,"object","buffer arguments must be an object, a number or an array"),"data"in _r&&(N(Gn===null||Array.isArray(Gn)||Te(Gn)||He(Gn),"invalid data for buffer"),Gn=_r.data),"usage"in _r&&(N.parameter(_r.usage,bo,"invalid buffer usage"),Sr=bo[_r.usage]),"type"in _r&&(N.parameter(_r.type,ru,"invalid buffer type"),Gr=ru[_r.type]),"dimension"in _r&&(N.type(_r.dimension,"number","invalid dimension"),mn=_r.dimension|0),"length"in _r&&(N.nni(nn,"buffer length must be a nonnegative integer"),nn=_r.length|0)),Er.bind(),Gn?qr(Er,Gn,Sr,Gr,mn,un):(nn&&U.bufferData(Er.type,nn,Sr),Er.dtype=Gr||Il,Er.usage=Sr,Er.dimension=mn,Er.byteLength=nn),$e.profile&&(Er.stats.size=Er.byteLength*vu[Er.dtype]),Jr}function yn(_r,Sr){N(Sr+_r.byteLength<=Er.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+_r.byteLength+" starting from offset "+Sr+" to a buffer of size "+Er.byteLength),U.bufferSubData(Er.type,Sr,_r)}function ai(_r,Sr){var Gn=(Sr||0)|0,nn;if(Er.bind(),Te(_r)||_r instanceof ArrayBuffer)yn(_r,Gn);else if(Array.isArray(_r)){if(_r.length>0)if(typeof _r[0]=="number"){var Gr=$t.allocType(Er.dtype,_r.length);b(Gr,_r),yn(Gr,Gn),$t.freeType(Gr)}else if(Array.isArray(_r[0])||Te(_r[0])){nn=fc(_r);var mn=Gu(_r,nn,Er.dtype);yn(mn,Gn),$t.freeType(mn)}else N.raise("invalid buffer data")}else if(He(_r)){nn=_r.shape;var _n=_r.stride,Ri=0,Ei=0,pn=0,Tn=0;nn.length===1?(Ri=nn[0],Ei=1,pn=_n[0],Tn=0):nn.length===2?(Ri=nn[0],Ei=nn[1],pn=_n[0],Tn=_n[1]):N.raise("invalid shape");var hi=Array.isArray(_r.data)?Er.dtype:sl(_r.data),Mi=$t.allocType(hi,Ri*Ei);k(Mi,_r.data,Ri,Ei,pn,Tn,_r.offset),yn(Mi,Gn),$t.freeType(Mi)}else N.raise("invalid data for buffer subdata");return Jr}return Vr||Jr(Tt),Jr._reglType="buffer",Jr._buffer=Er,Jr.subdata=ai,$e.profile&&(Jr.stats=Er.stats),Jr.destroy=function(){hn(Er)},Jr}function Kr(){fe(Jt).forEach(function(Tt){Tt.buffer=U.createBuffer(),U.bindBuffer(Tt.type,Tt.buffer),U.bufferData(Tt.type,Tt.persistentData||Tt.byteLength,Tt.usage)})}return $e.profile&&(we.getTotalBufferSize=function(){var Tt=0;return Object.keys(Jt).forEach(function(ar){Tt+=Jt[ar].stats.size}),Tt}),{create:Ur,createStream:Br,destroyStream:Zr,clear:function(){fe(Jt).forEach(hn),kr.forEach(hn)},getBuffer:function(Tt){return Tt&&Tt._buffer instanceof yr?Tt._buffer:null},restore:Kr,_initBuffer:qr}}var R=0,te=0,Me=1,at=1,Rt=4,Lt=4,Ar={points:R,point:te,lines:Me,line:at,triangles:Rt,triangle:Lt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Tr=0,Fn=1,Ai=4,_i=5120,Di=5121,Ia=5122,Da=5123,ea=5124,xs=5125,bu=34963,ul=35040,vf=35044;function mu(U,we,$e,rr){var wr={},Jt=0,yr={uint8:Di,uint16:Da};we.oes_element_index_uint&&(yr.uint32=xs);function kr(Kr){this.id=Jt++,wr[this.id]=this,this.buffer=Kr,this.primType=Ai,this.vertCount=0,this.type=0}kr.prototype.bind=function(){this.buffer.bind()};var Br=[];function Zr(Kr){var Tt=Br.pop();return Tt||(Tt=new kr($e.create(null,bu,!0,!1)._buffer)),qr(Tt,Kr,ul,-1,-1,0,0),Tt}function $r(Kr){Br.push(Kr)}function qr(Kr,Tt,ar,Vr,un,Er,Jr){Kr.buffer.bind();var yn;if(Tt){var ai=Jr;!Jr&&(!Te(Tt)||He(Tt)&&!Te(Tt.data))&&(ai=we.oes_element_index_uint?xs:Da),$e._initBuffer(Kr.buffer,Tt,ar,ai,3)}else U.bufferData(bu,Er,ar),Kr.buffer.dtype=yn||Di,Kr.buffer.usage=ar,Kr.buffer.dimension=3,Kr.buffer.byteLength=Er;if(yn=Jr,!Jr){switch(Kr.buffer.dtype){case Di:case _i:yn=Di;break;case Da:case Ia:yn=Da;break;case xs:case ea:yn=xs;break;default:N.raise("unsupported type for element array")}Kr.buffer.dtype=yn}Kr.type=yn,N(yn!==xs||!!we.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var _r=un;_r<0&&(_r=Kr.buffer.byteLength,yn===Da?_r>>=1:yn===xs&&(_r>>=2)),Kr.vertCount=_r;var Sr=Vr;if(Vr<0){Sr=Ai;var Gn=Kr.buffer.dimension;Gn===1&&(Sr=Tr),Gn===2&&(Sr=Fn),Gn===3&&(Sr=Ai)}Kr.primType=Sr}function hn(Kr){rr.elementsCount--,N(Kr.buffer!==null,"must not double destroy elements"),delete wr[Kr.id],Kr.buffer.destroy(),Kr.buffer=null}function Ur(Kr,Tt){var ar=$e.create(null,bu,!0),Vr=new kr(ar._buffer);rr.elementsCount++;function un(Er){if(!Er)ar(),Vr.primType=Ai,Vr.vertCount=0,Vr.type=Di;else if(typeof Er=="number")ar(Er),Vr.primType=Ai,Vr.vertCount=Er|0,Vr.type=Di;else{var Jr=null,yn=vf,ai=-1,_r=-1,Sr=0,Gn=0;Array.isArray(Er)||Te(Er)||He(Er)?Jr=Er:(N.type(Er,"object","invalid arguments for elements"),"data"in Er&&(Jr=Er.data,N(Array.isArray(Jr)||Te(Jr)||He(Jr),"invalid data for element buffer")),"usage"in Er&&(N.parameter(Er.usage,bo,"invalid element buffer usage"),yn=bo[Er.usage]),"primitive"in Er&&(N.parameter(Er.primitive,Ar,"invalid element buffer primitive"),ai=Ar[Er.primitive]),"count"in Er&&(N(typeof Er.count=="number"&&Er.count>=0,"invalid vertex count for elements"),_r=Er.count|0),"type"in Er&&(N.parameter(Er.type,yr,"invalid buffer type"),Gn=yr[Er.type]),"length"in Er?Sr=Er.length|0:(Sr=_r,Gn===Da||Gn===Ia?Sr*=2:(Gn===xs||Gn===ea)&&(Sr*=4))),qr(Vr,Jr,yn,ai,_r,Sr,Gn)}return un}return un(Kr),un._reglType="elements",un._elements=Vr,un.subdata=function(Er,Jr){return ar.subdata(Er,Jr),un},un.destroy=function(){hn(Vr)},un}return{create:Ur,createStream:Zr,destroyStream:$r,getElements:function(Kr){return typeof Kr=="function"&&Kr._elements instanceof kr?Kr._elements:null},clear:function(){fe(wr).forEach(hn)}}}var Ds=new Float32Array(1),Du=new Uint32Array(Ds.buffer),gu=5123;function Bu(U){for(var we=$t.allocType(gu,U.length),$e=0;$e<U.length;++$e)if(isNaN(U[$e]))we[$e]=65535;else if(U[$e]===Infinity)we[$e]=31744;else if(U[$e]===-Infinity)we[$e]=64512;else{Ds[0]=U[$e];var rr=Du[0],wr=rr>>>31<<15,Jt=(rr<<1>>>24)-127,yr=rr>>13&(1<<10)-1;if(Jt<-24)we[$e]=wr;else if(Jt<-14){var kr=-14-Jt;we[$e]=wr+(yr+(1<<10)>>kr)}else Jt>15?we[$e]=wr+31744:we[$e]=wr+(Jt+15<<10)+yr}return we}function Eo(U){return Array.isArray(U)||Te(U)}var Nc=function(U){return!(U&U-1)&&!!U},Is=34467,ns=3553,hc=34067,Po=34069,nu=6408,zc=6406,ll=6407,Pa=6409,Pl=6410,Gf=32854,Wu=32855,Hf=36194,tp=32819,Eh=32820,mf=33635,pc=34042,Rl=6402,Ll=34041,Ol=35904,cl=35906,Xu=36193,$u=33776,iu=33777,Wf=33778,gf=33779,Sh=35986,Ys=35987,dc=34798,Zc=35840,yf=35841,Fl=35842,_f=35843,Uc=36196,Dl=5121,Xf=5123,$f=5125,Bl=5126,Yf=10242,qf=10243,Kf=10497,fl=33071,wh=33648,Nl=10240,ro=10241,vc=9728,Eu=9729,Nu=9984,aa=9985,ja=9986,bs=9987,xf=33170,hl=4352,bf=4353,rp=4354,np=34046,Ef=3317,zl=37440,pl=37441,Yo=37443,Vc=37444,Zl=33984,Ro=[Nu,ja,aa,bs],Dn=[0,Pa,Pl,ll,nu],mo={};mo[Pa]=mo[zc]=mo[Rl]=1,mo[Ll]=mo[Pl]=2,mo[ll]=mo[Ol]=3,mo[nu]=mo[cl]=4;function jo(U){return"[object "+U+"]"}var Ul=jo("HTMLCanvasElement"),Xi=jo("OffscreenCanvas"),Bs=jo("CanvasRenderingContext2D"),Qf=jo("ImageBitmap"),vn=jo("HTMLImageElement"),jc=jo("HTMLVideoElement"),Sf=Object.keys(Ya).concat([Ul,Xi,Bs,Qf,vn,jc]),dl=[];dl[Dl]=1,dl[Bl]=4,dl[Xu]=2,dl[Xf]=2,dl[$f]=4;var ri=[];ri[Gf]=2,ri[Wu]=2,ri[Hf]=2,ri[Ll]=4,ri[$u]=.5,ri[iu]=.5,ri[Wf]=1,ri[gf]=1,ri[Sh]=.5,ri[Ys]=1,ri[dc]=1,ri[Zc]=.5,ri[yf]=.25,ri[Fl]=.5,ri[_f]=.25,ri[Uc]=.5;function no(U){return Array.isArray(U)&&(U.length===0||typeof U[0]=="number")}function Ns(U){if(!Array.isArray(U))return!1;var we=U.length;return!(we===0||!Eo(U[0]))}function Ps(U){return Object.prototype.toString.call(U)}function zs(U){return Ps(U)===Ul}function Su(U){return Ps(U)===Xi}function wf(U){return Ps(U)===Bs}function Cf(U){return Ps(U)===Qf}function Jf(U){return Ps(U)===vn}function Af(U){return Ps(U)===jc}function au(U){var we=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(we&&U&&U.getContext)}function ou(U){var we=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(we&&U&&"src"in U&&"crossOrigin"in U)}function Vi(U){if(!U)return!1;if(au(U)||ou(U))return!0;var we=Ps(U);return Sf.indexOf(we)>=0?!0:no(U)||Ns(U)||He(U)}function Ra(U){return Ya[Object.prototype.toString.call(U)]|0}function su(U,we){var $e=we.length;switch(U.type){case Dl:case Xf:case $f:case Bl:var rr=$t.allocType(U.type,$e);rr.set(we),U.data=rr;break;case Xu:U.data=Bu(we);break;default:N.raise("unsupported texture type, must specify a typed array")}}function qo(U,we){return $t.allocType(U.type===Xu?Bl:U.type,we)}function Vl(U,we){U.type===Xu?(U.data=Bu(we),$t.freeType(we)):U.data=we}function vl(U,we,$e,rr,wr,Jt){for(var yr=U.width,kr=U.height,Br=U.channels,Zr=yr*kr*Br,$r=qo(U,Zr),qr=0,hn=0;hn<kr;++hn)for(var Ur=0;Ur<yr;++Ur)for(var Kr=0;Kr<Br;++Kr)$r[qr++]=we[$e*Ur+rr*hn+wr*Kr+Jt];Vl(U,$r)}function qs(U,we,$e,rr,wr,Jt){var yr;if(typeof ri[U]!="undefined"?yr=ri[U]:yr=mo[U]*dl[we],Jt&&(yr*=6),wr){for(var kr=0,Br=$e;Br>=1;)kr+=yr*Br*Br,Br/=2;return kr}else return yr*$e*rr}function ps(U,we,$e,rr,wr,Jt,yr){var kr={"don't care":hl,"dont care":hl,nice:rp,fast:bf},Br={repeat:Kf,clamp:fl,mirror:wh},Zr={nearest:vc,linear:Eu},$r=y({mipmap:bs,"nearest mipmap nearest":Nu,"linear mipmap nearest":aa,"nearest mipmap linear":ja,"linear mipmap linear":bs},Zr),qr={none:0,browser:Vc},hn={uint8:Dl,rgba4:tp,rgb565:mf,"rgb5 a1":Eh},Ur={alpha:zc,luminance:Pa,"luminance alpha":Pl,rgb:ll,rgba:nu,rgba4:Gf,"rgb5 a1":Wu,rgb565:Hf},Kr={};we.ext_srgb&&(Ur.srgb=Ol,Ur.srgba=cl),we.oes_texture_float&&(hn.float32=hn.float=Bl),we.oes_texture_half_float&&(hn.float16=hn["half float"]=Xu),we.webgl_depth_texture&&(y(Ur,{depth:Rl,"depth stencil":Ll}),y(hn,{uint16:Xf,uint32:$f,"depth stencil":pc})),we.webgl_compressed_texture_s3tc&&y(Kr,{"rgb s3tc dxt1":$u,"rgba s3tc dxt1":iu,"rgba s3tc dxt3":Wf,"rgba s3tc dxt5":gf}),we.webgl_compressed_texture_atc&&y(Kr,{"rgb atc":Sh,"rgba atc explicit alpha":Ys,"rgba atc interpolated alpha":dc}),we.webgl_compressed_texture_pvrtc&&y(Kr,{"rgb pvrtc 4bppv1":Zc,"rgb pvrtc 2bppv1":yf,"rgba pvrtc 4bppv1":Fl,"rgba pvrtc 2bppv1":_f}),we.webgl_compressed_texture_etc1&&(Kr["rgb etc1"]=Uc);var Tt=Array.prototype.slice.call(U.getParameter(Is)||new Uint32Array(0));Object.keys(Kr).forEach(function(Ne){var nr=Kr[Ne];Tt.indexOf(nr)>=0&&(Ur[Ne]=nr)});var ar=Object.keys(Ur);$e.textureFormats=ar;var Vr=[];Object.keys(Ur).forEach(function(Ne){var nr=Ur[Ne];Vr[nr]=Ne});var un=[];Object.keys(hn).forEach(function(Ne){var nr=hn[Ne];un[nr]=Ne});var Er=[];Object.keys(Zr).forEach(function(Ne){var nr=Zr[Ne];Er[nr]=Ne});var Jr=[];Object.keys($r).forEach(function(Ne){var nr=$r[Ne];Jr[nr]=Ne});var yn=[];Object.keys(Br).forEach(function(Ne){var nr=Br[Ne];yn[nr]=Ne});var ai=ar.reduce(function(Ne,nr){var Vt=Ur[nr];return Vt===Pa||Vt===zc||Vt===Pa||Vt===Pl||Vt===Rl||Vt===Ll||we.ext_srgb&&(Vt===Ol||Vt===cl)?Ne[Vt]=Vt:Vt===Wu||nr.indexOf("rgba")>=0?Ne[Vt]=nu:Ne[Vt]=ll,Ne},{});function _r(){this.internalformat=nu,this.format=nu,this.type=Dl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Vc,this.width=0,this.height=0,this.channels=0}function Sr(Ne,nr){Ne.internalformat=nr.internalformat,Ne.format=nr.format,Ne.type=nr.type,Ne.compressed=nr.compressed,Ne.premultiplyAlpha=nr.premultiplyAlpha,Ne.flipY=nr.flipY,Ne.unpackAlignment=nr.unpackAlignment,Ne.colorSpace=nr.colorSpace,Ne.width=nr.width,Ne.height=nr.height,Ne.channels=nr.channels}function Gn(Ne,nr){if(!(typeof nr!="object"||!nr)){if("premultiplyAlpha"in nr&&(N.type(nr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ne.premultiplyAlpha=nr.premultiplyAlpha),"flipY"in nr&&(N.type(nr.flipY,"boolean","invalid texture flip"),Ne.flipY=nr.flipY),"alignment"in nr&&(N.oneOf(nr.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ne.unpackAlignment=nr.alignment),"colorSpace"in nr&&(N.parameter(nr.colorSpace,qr,"invalid colorSpace"),Ne.colorSpace=qr[nr.colorSpace]),"type"in nr){var Vt=nr.type;N(we.oes_texture_float||!(Vt==="float"||Vt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),N(we.oes_texture_half_float||!(Vt==="half float"||Vt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),N(we.webgl_depth_texture||!(Vt==="uint16"||Vt==="uint32"||Vt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),N.parameter(Vt,hn,"invalid texture type"),Ne.type=hn[Vt]}var Mn=Ne.width,ra=Ne.height,Re=Ne.channels,ve=!1;"shape"in nr?(N(Array.isArray(nr.shape)&&nr.shape.length>=2,"shape must be an array"),Mn=nr.shape[0],ra=nr.shape[1],nr.shape.length===3&&(Re=nr.shape[2],N(Re>0&&Re<=4,"invalid number of channels"),ve=!0),N(Mn>=0&&Mn<=$e.maxTextureSize,"invalid width"),N(ra>=0&&ra<=$e.maxTextureSize,"invalid height")):("radius"in nr&&(Mn=ra=nr.radius,N(Mn>=0&&Mn<=$e.maxTextureSize,"invalid radius")),"width"in nr&&(Mn=nr.width,N(Mn>=0&&Mn<=$e.maxTextureSize,"invalid width")),"height"in nr&&(ra=nr.height,N(ra>=0&&ra<=$e.maxTextureSize,"invalid height")),"channels"in nr&&(Re=nr.channels,N(Re>0&&Re<=4,"invalid number of channels"),ve=!0)),Ne.width=Mn|0,Ne.height=ra|0,Ne.channels=Re|0;var tt=!1;if("format"in nr){var Mt=nr.format;N(we.webgl_depth_texture||!(Mt==="depth"||Mt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),N.parameter(Mt,Ur,"invalid texture format");var Yt=Ne.internalformat=Ur[Mt];Ne.format=ai[Yt],Mt in hn&&("type"in nr||(Ne.type=hn[Mt])),Mt in Kr&&(Ne.compressed=!0),tt=!0}!ve&&tt?Ne.channels=mo[Ne.format]:ve&&!tt?Ne.channels!==Dn[Ne.format]&&(Ne.format=Ne.internalformat=Dn[Ne.channels]):tt&&ve&&N(Ne.channels===mo[Ne.format],"number of channels inconsistent with specified format")}}function nn(Ne){U.pixelStorei(zl,Ne.flipY),U.pixelStorei(pl,Ne.premultiplyAlpha),U.pixelStorei(Yo,Ne.colorSpace),U.pixelStorei(Ef,Ne.unpackAlignment)}function Gr(){_r.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function mn(Ne,nr){var Vt=null;if(Vi(nr)?Vt=nr:nr&&(N.type(nr,"object","invalid pixel data type"),Gn(Ne,nr),"x"in nr&&(Ne.xOffset=nr.x|0),"y"in nr&&(Ne.yOffset=nr.y|0),Vi(nr.data)&&(Vt=nr.data)),N(!Ne.compressed||Vt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),nr.copy){N(!Vt,"can not specify copy and data field for the same texture");var Mn=wr.viewportWidth,ra=wr.viewportHeight;Ne.width=Ne.width||Mn-Ne.xOffset,Ne.height=Ne.height||ra-Ne.yOffset,Ne.needsCopy=!0,N(Ne.xOffset>=0&&Ne.xOffset<Mn&&Ne.yOffset>=0&&Ne.yOffset<ra&&Ne.width>0&&Ne.width<=Mn&&Ne.height>0&&Ne.height<=ra,"copy texture read out of bounds")}else if(!Vt)Ne.width=Ne.width||1,Ne.height=Ne.height||1,Ne.channels=Ne.channels||4;else if(Te(Vt))Ne.channels=Ne.channels||4,Ne.data=Vt,!("type"in nr)&&Ne.type===Dl&&(Ne.type=Ra(Vt));else if(no(Vt))Ne.channels=Ne.channels||4,su(Ne,Vt),Ne.alignment=1,Ne.needsFree=!0;else if(He(Vt)){var Re=Vt.data;!Array.isArray(Re)&&Ne.type===Dl&&(Ne.type=Ra(Re));var ve=Vt.shape,tt=Vt.stride,Mt,Yt,ut,We,xt,Ae;ve.length===3?(ut=ve[2],Ae=tt[2]):(N(ve.length===2,"invalid ndarray pixel data, must be 2 or 3D"),ut=1,Ae=1),Mt=ve[0],Yt=ve[1],We=tt[0],xt=tt[1],Ne.alignment=1,Ne.width=Mt,Ne.height=Yt,Ne.channels=ut,Ne.format=Ne.internalformat=Dn[ut],Ne.needsFree=!0,vl(Ne,Re,We,xt,Ae,Vt.offset)}else if(au(Vt)||zs(Vt)||Su(Vt)||wf(Vt))au(Vt)||zs(Vt)||Su(Vt)?Ne.element=Vt:Ne.element=Vt.canvas,Ne.width=Ne.element.width,Ne.height=Ne.element.height,Ne.channels=4;else if(Cf(Vt))Ne.element=Vt,Ne.width=Vt.width,Ne.height=Vt.height,Ne.channels=4;else if(Jf(Vt))Ne.element=Vt,Ne.width=Vt.naturalWidth,Ne.height=Vt.naturalHeight,Ne.channels=4;else if(ou(Vt))Ne.element=Vt,Ne.width=Vt.width,Ne.height=Vt.height,Ne.channels=4;else if(Af(Vt))Ne.element=Vt,Ne.width=Vt.videoWidth,Ne.height=Vt.videoHeight,Ne.channels=4;else if(Ns(Vt)){var Je=Ne.width||Vt[0].length,Oe=Ne.height||Vt.length,kt=Ne.channels;Eo(Vt[0][0])?kt=kt||Vt[0][0].length:kt=kt||1;for(var Ut=Pe.shape(Vt),Mr=1,ln=0;ln<Ut.length;++ln)Mr*=Ut[ln];var cn=qo(Ne,Mr);Pe.flatten(Vt,Ut,"",cn),Vl(Ne,cn),Ne.alignment=1,Ne.width=Je,Ne.height=Oe,Ne.channels=kt,Ne.format=Ne.internalformat=Dn[kt],Ne.needsFree=!0}Ne.type===Bl?N($e.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ne.type===Xu&&N($e.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function _n(Ne,nr,Vt){var Mn=Ne.element,ra=Ne.data,Re=Ne.internalformat,ve=Ne.format,tt=Ne.type,Mt=Ne.width,Yt=Ne.height;nn(Ne),Mn?U.texImage2D(nr,Vt,ve,ve,tt,Mn):Ne.compressed?U.compressedTexImage2D(nr,Vt,Re,Mt,Yt,0,ra):Ne.needsCopy?(rr(),U.copyTexImage2D(nr,Vt,ve,Ne.xOffset,Ne.yOffset,Mt,Yt,0)):U.texImage2D(nr,Vt,ve,Mt,Yt,0,ve,tt,ra||null)}function Ri(Ne,nr,Vt,Mn,ra){var Re=Ne.element,ve=Ne.data,tt=Ne.internalformat,Mt=Ne.format,Yt=Ne.type,ut=Ne.width,We=Ne.height;nn(Ne),Re?U.texSubImage2D(nr,ra,Vt,Mn,Mt,Yt,Re):Ne.compressed?U.compressedTexSubImage2D(nr,ra,Vt,Mn,tt,ut,We,ve):Ne.needsCopy?(rr(),U.copyTexSubImage2D(nr,ra,Vt,Mn,Ne.xOffset,Ne.yOffset,ut,We)):U.texSubImage2D(nr,ra,Vt,Mn,ut,We,Mt,Yt,ve)}var Ei=[];function pn(){return Ei.pop()||new Gr}function Tn(Ne){Ne.needsFree&&$t.freeType(Ne.data),Gr.call(Ne),Ei.push(Ne)}function hi(){_r.call(this),this.genMipmaps=!1,this.mipmapHint=hl,this.mipmask=0,this.images=Array(16)}function Mi(Ne,nr,Vt){var Mn=Ne.images[0]=pn();Ne.mipmask=1,Mn.width=Ne.width=nr,Mn.height=Ne.height=Vt,Mn.channels=Ne.channels=4}function $i(Ne,nr){var Vt=null;if(Vi(nr))Vt=Ne.images[0]=pn(),Sr(Vt,Ne),mn(Vt,nr),Ne.mipmask=1;else if(Gn(Ne,nr),Array.isArray(nr.mipmap))for(var Mn=nr.mipmap,ra=0;ra<Mn.length;++ra)Vt=Ne.images[ra]=pn(),Sr(Vt,Ne),Vt.width>>=ra,Vt.height>>=ra,mn(Vt,Mn[ra]),Ne.mipmask|=1<<ra;else Vt=Ne.images[0]=pn(),Sr(Vt,Ne),mn(Vt,nr),Ne.mipmask=1;Sr(Ne,Ne.images[0]),Ne.compressed&&(Ne.internalformat===$u||Ne.internalformat===iu||Ne.internalformat===Wf||Ne.internalformat===gf)&&N(Ne.width%4==0&&Ne.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function fo(Ne,nr){for(var Vt=Ne.images,Mn=0;Mn<Vt.length;++Mn){if(!Vt[Mn])return;_n(Vt[Mn],nr,Mn)}}var Ao=[];function Yi(){var Ne=Ao.pop()||new hi;_r.call(Ne),Ne.mipmask=0;for(var nr=0;nr<16;++nr)Ne.images[nr]=null;return Ne}function os(Ne){for(var nr=Ne.images,Vt=0;Vt<nr.length;++Vt)nr[Vt]&&Tn(nr[Vt]),nr[Vt]=null;Ao.push(Ne)}function ao(){this.minFilter=vc,this.magFilter=vc,this.wrapS=fl,this.wrapT=fl,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=hl}function ss(Ne,nr){if("min"in nr){var Vt=nr.min;N.parameter(Vt,$r),Ne.minFilter=$r[Vt],Ro.indexOf(Ne.minFilter)>=0&&!("faces"in nr)&&(Ne.genMipmaps=!0)}if("mag"in nr){var Mn=nr.mag;N.parameter(Mn,Zr),Ne.magFilter=Zr[Mn]}var ra=Ne.wrapS,Re=Ne.wrapT;if("wrap"in nr){var ve=nr.wrap;typeof ve=="string"?(N.parameter(ve,Br),ra=Re=Br[ve]):Array.isArray(ve)&&(N.parameter(ve[0],Br),N.parameter(ve[1],Br),ra=Br[ve[0]],Re=Br[ve[1]])}else{if("wrapS"in nr){var tt=nr.wrapS;N.parameter(tt,Br),ra=Br[tt]}if("wrapT"in nr){var Mt=nr.wrapT;N.parameter(Mt,Br),Re=Br[Mt]}}if(Ne.wrapS=ra,Ne.wrapT=Re,"anisotropic"in nr){var Yt=nr.anisotropic;N(typeof Yt=="number"&&Yt>=1&&Yt<=$e.maxAnisotropic,"aniso samples must be between 1 and "),Ne.anisotropic=nr.anisotropic}if("mipmap"in nr){var ut=!1;switch(typeof nr.mipmap){case"string":N.parameter(nr.mipmap,kr,"invalid mipmap hint"),Ne.mipmapHint=kr[nr.mipmap],Ne.genMipmaps=!0,ut=!0;break;case"boolean":ut=Ne.genMipmaps=nr.mipmap;break;case"object":N(Array.isArray(nr.mipmap),"invalid mipmap type"),Ne.genMipmaps=!1,ut=!0;break;default:N.raise("invalid mipmap type")}ut&&!("min"in nr)&&(Ne.minFilter=Nu)}}function Ho(Ne,nr){U.texParameteri(nr,ro,Ne.minFilter),U.texParameteri(nr,Nl,Ne.magFilter),U.texParameteri(nr,Yf,Ne.wrapS),U.texParameteri(nr,qf,Ne.wrapT),we.ext_texture_filter_anisotropic&&U.texParameteri(nr,np,Ne.anisotropic),Ne.genMipmaps&&(U.hint(xf,Ne.mipmapHint),U.generateMipmap(nr))}var us=0,Qo={},ds=$e.maxTextureUnits,To=Array(ds).map(function(){return null});function Li(Ne){_r.call(this),this.mipmask=0,this.internalformat=nu,this.id=us++,this.refCount=1,this.target=Ne,this.texture=U.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new ao,yr.profile&&(this.stats={size:0})}function Wo(Ne){U.activeTexture(Zl),U.bindTexture(Ne.target,Ne.texture)}function da(){var Ne=To[0];Ne?U.bindTexture(Ne.target,Ne.texture):U.bindTexture(ns,null)}function vs(Ne){var nr=Ne.texture;N(nr,"must not double destroy texture");var Vt=Ne.unit,Mn=Ne.target;Vt>=0&&(U.activeTexture(Zl+Vt),U.bindTexture(Mn,null),To[Vt]=null),U.deleteTexture(nr),Ne.texture=null,Ne.params=null,Ne.pixels=null,Ne.refCount=0,delete Qo[Ne.id],Jt.textureCount--}y(Li.prototype,{bind:function(){var Ne=this;Ne.bindCount+=1;var nr=Ne.unit;if(nr<0){for(var Vt=0;Vt<ds;++Vt){var Mn=To[Vt];if(Mn){if(Mn.bindCount>0)continue;Mn.unit=-1}To[Vt]=Ne,nr=Vt;break}nr>=ds&&N.raise("insufficient number of texture units"),yr.profile&&Jt.maxTextureUnits<nr+1&&(Jt.maxTextureUnits=nr+1),Ne.unit=nr,U.activeTexture(Zl+nr),U.bindTexture(Ne.target,Ne.texture)}return nr},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&vs(this)}});function xi(Ne,nr){var Vt=new Li(ns);Qo[Vt.id]=Vt,Jt.textureCount++;function Mn(ve,tt){var Mt=Vt.texInfo;ao.call(Mt);var Yt=Yi();return typeof ve=="number"?typeof tt=="number"?Mi(Yt,ve|0,tt|0):Mi(Yt,ve|0,ve|0):ve?(N.type(ve,"object","invalid arguments to regl.texture"),ss(Mt,ve),$i(Yt,ve)):Mi(Yt,1,1),Mt.genMipmaps&&(Yt.mipmask=(Yt.width<<1)-1),Vt.mipmask=Yt.mipmask,Sr(Vt,Yt),N.texture2D(Mt,Yt,$e),Vt.internalformat=Yt.internalformat,Mn.width=Yt.width,Mn.height=Yt.height,Wo(Vt),fo(Yt,ns),Ho(Mt,ns),da(),os(Yt),yr.profile&&(Vt.stats.size=qs(Vt.internalformat,Vt.type,Yt.width,Yt.height,Mt.genMipmaps,!1)),Mn.format=Vr[Vt.internalformat],Mn.type=un[Vt.type],Mn.mag=Er[Mt.magFilter],Mn.min=Jr[Mt.minFilter],Mn.wrapS=yn[Mt.wrapS],Mn.wrapT=yn[Mt.wrapT],Mn}function ra(ve,tt,Mt,Yt){N(!!ve,"must specify image data");var ut=tt|0,We=Mt|0,xt=Yt|0,Ae=pn();return Sr(Ae,Vt),Ae.width=0,Ae.height=0,mn(Ae,ve),Ae.width=Ae.width||(Vt.width>>xt)-ut,Ae.height=Ae.height||(Vt.height>>xt)-We,N(Vt.type===Ae.type&&Vt.format===Ae.format&&Vt.internalformat===Ae.internalformat,"incompatible format for texture.subimage"),N(ut>=0&&We>=0&&ut+Ae.width<=Vt.width&&We+Ae.height<=Vt.height,"texture.subimage write out of bounds"),N(Vt.mipmask&1<<xt,"missing mipmap data"),N(Ae.data||Ae.element||Ae.needsCopy,"missing image data"),Wo(Vt),Ri(Ae,ns,ut,We,xt),da(),Tn(Ae),Mn}function Re(ve,tt){var Mt=ve|0,Yt=tt|0||Mt;if(Mt===Vt.width&&Yt===Vt.height)return Mn;Mn.width=Vt.width=Mt,Mn.height=Vt.height=Yt,Wo(Vt);for(var ut=0;Vt.mipmask>>ut;++ut){var We=Mt>>ut,xt=Yt>>ut;if(!We||!xt)break;U.texImage2D(ns,ut,Vt.format,We,xt,0,Vt.format,Vt.type,null)}return da(),yr.profile&&(Vt.stats.size=qs(Vt.internalformat,Vt.type,Mt,Yt,!1,!1)),Mn}return Mn(Ne,nr),Mn.subimage=ra,Mn.resize=Re,Mn._reglType="texture2d",Mn._texture=Vt,yr.profile&&(Mn.stats=Vt.stats),Mn.destroy=function(){Vt.decRef()},Mn}function qi(Ne,nr,Vt,Mn,ra,Re){var ve=new Li(hc);Qo[ve.id]=ve,Jt.cubeCount++;var tt=new Array(6);function Mt(We,xt,Ae,Je,Oe,kt){var Ut,Mr=ve.texInfo;for(ao.call(Mr),Ut=0;Ut<6;++Ut)tt[Ut]=Yi();if(typeof We=="number"||!We){var ln=We|0||1;for(Ut=0;Ut<6;++Ut)Mi(tt[Ut],ln,ln)}else if(typeof We=="object")if(xt)$i(tt[0],We),$i(tt[1],xt),$i(tt[2],Ae),$i(tt[3],Je),$i(tt[4],Oe),$i(tt[5],kt);else if(ss(Mr,We),Gn(ve,We),"faces"in We){var cn=We.faces;for(N(Array.isArray(cn)&&cn.length===6,"cube faces must be a length 6 array"),Ut=0;Ut<6;++Ut)N(typeof cn[Ut]=="object"&&!!cn[Ut],"invalid input for cube map face"),Sr(tt[Ut],ve),$i(tt[Ut],cn[Ut])}else for(Ut=0;Ut<6;++Ut)$i(tt[Ut],We);else N.raise("invalid arguments to cube map");for(Sr(ve,tt[0]),N.optional(function(){$e.npotTextureCube||N(Nc(ve.width)&&Nc(ve.height),"your browser does not support non power or two texture dimensions")}),Mr.genMipmaps?ve.mipmask=(tt[0].width<<1)-1:ve.mipmask=tt[0].mipmask,N.textureCube(ve,Mr,tt,$e),ve.internalformat=tt[0].internalformat,Mt.width=tt[0].width,Mt.height=tt[0].height,Wo(ve),Ut=0;Ut<6;++Ut)fo(tt[Ut],Po+Ut);for(Ho(Mr,hc),da(),yr.profile&&(ve.stats.size=qs(ve.internalformat,ve.type,Mt.width,Mt.height,Mr.genMipmaps,!0)),Mt.format=Vr[ve.internalformat],Mt.type=un[ve.type],Mt.mag=Er[Mr.magFilter],Mt.min=Jr[Mr.minFilter],Mt.wrapS=yn[Mr.wrapS],Mt.wrapT=yn[Mr.wrapT],Ut=0;Ut<6;++Ut)os(tt[Ut]);return Mt}function Yt(We,xt,Ae,Je,Oe){N(!!xt,"must specify image data"),N(typeof We=="number"&&We===(We|0)&&We>=0&&We<6,"invalid face");var kt=Ae|0,Ut=Je|0,Mr=Oe|0,ln=pn();return Sr(ln,ve),ln.width=0,ln.height=0,mn(ln,xt),ln.width=ln.width||(ve.width>>Mr)-kt,ln.height=ln.height||(ve.height>>Mr)-Ut,N(ve.type===ln.type&&ve.format===ln.format&&ve.internalformat===ln.internalformat,"incompatible format for texture.subimage"),N(kt>=0&&Ut>=0&&kt+ln.width<=ve.width&&Ut+ln.height<=ve.height,"texture.subimage write out of bounds"),N(ve.mipmask&1<<Mr,"missing mipmap data"),N(ln.data||ln.element||ln.needsCopy,"missing image data"),Wo(ve),Ri(ln,Po+We,kt,Ut,Mr),da(),Tn(ln),Mt}function ut(We){var xt=We|0;if(xt!==ve.width){Mt.width=ve.width=xt,Mt.height=ve.height=xt,Wo(ve);for(var Ae=0;Ae<6;++Ae)for(var Je=0;ve.mipmask>>Je;++Je)U.texImage2D(Po+Ae,Je,ve.format,xt>>Je,xt>>Je,0,ve.format,ve.type,null);return da(),yr.profile&&(ve.stats.size=qs(ve.internalformat,ve.type,Mt.width,Mt.height,!1,!0)),Mt}}return Mt(Ne,nr,Vt,Mn,ra,Re),Mt.subimage=Yt,Mt.resize=ut,Mt._reglType="textureCube",Mt._texture=ve,yr.profile&&(Mt.stats=ve.stats),Mt.destroy=function(){ve.decRef()},Mt}function Ca(){for(var Ne=0;Ne<ds;++Ne)U.activeTexture(Zl+Ne),U.bindTexture(ns,null),To[Ne]=null;fe(Qo).forEach(vs),Jt.cubeCount=0,Jt.textureCount=0}yr.profile&&(Jt.getTotalTextureSize=function(){var Ne=0;return Object.keys(Qo).forEach(function(nr){Ne+=Qo[nr].stats.size}),Ne});function zo(){for(var Ne=0;Ne<ds;++Ne){var nr=To[Ne];nr&&(nr.bindCount=0,nr.unit=-1,To[Ne]=null)}fe(Qo).forEach(function(Vt){Vt.texture=U.createTexture(),U.bindTexture(Vt.target,Vt.texture);for(var Mn=0;Mn<32;++Mn)if((Vt.mipmask&1<<Mn)!=0)if(Vt.target===ns)U.texImage2D(ns,Mn,Vt.internalformat,Vt.width>>Mn,Vt.height>>Mn,0,Vt.internalformat,Vt.type,null);else for(var ra=0;ra<6;++ra)U.texImage2D(Po+ra,Mn,Vt.internalformat,Vt.width>>Mn,Vt.height>>Mn,0,Vt.internalformat,Vt.type,null);Ho(Vt.texInfo,Vt.target)})}function Sl(){for(var Ne=0;Ne<ds;++Ne){var nr=To[Ne];nr&&(nr.bindCount=0,nr.unit=-1,To[Ne]=null),U.activeTexture(Zl+Ne),U.bindTexture(ns,null),U.bindTexture(hc,null)}}return{create2D:xi,createCube:qi,clear:Ca,getTexture:function(Ne){return null},restore:zo,refresh:Sl}}var Rs=36161,Qn=32854,Bn=32855,Gc=36194,Es=33189,uu=36168,is=34041,wu=35907,mc=34836,jl=34842,wa=34843,Ga=[];Ga[Qn]=2,Ga[Bn]=2,Ga[Gc]=2,Ga[Es]=2,Ga[uu]=1,Ga[is]=4,Ga[wu]=4,Ga[mc]=16,Ga[jl]=8,Ga[wa]=6;function eh(U,we,$e){return Ga[U]*we*$e}var Gl=function(U,we,$e,rr,wr){var Jt={rgba4:Qn,rgb565:Gc,"rgb5 a1":Bn,depth:Es,stencil:uu,"depth stencil":is};we.ext_srgb&&(Jt.srgba=wu),we.ext_color_buffer_half_float&&(Jt.rgba16f=jl,Jt.rgb16f=wa),we.webgl_color_buffer_float&&(Jt.rgba32f=mc);var yr=[];Object.keys(Jt).forEach(function(Ur){var Kr=Jt[Ur];yr[Kr]=Ur});var kr=0,Br={};function Zr(Ur){this.id=kr++,this.refCount=1,this.renderbuffer=Ur,this.format=Qn,this.width=0,this.height=0,wr.profile&&(this.stats={size:0})}Zr.prototype.decRef=function(){--this.refCount<=0&&$r(this)};function $r(Ur){var Kr=Ur.renderbuffer;N(Kr,"must not double destroy renderbuffer"),U.bindRenderbuffer(Rs,null),U.deleteRenderbuffer(Kr),Ur.renderbuffer=null,Ur.refCount=0,delete Br[Ur.id],rr.renderbufferCount--}function qr(Ur,Kr){var Tt=new Zr(U.createRenderbuffer());Br[Tt.id]=Tt,rr.renderbufferCount++;function ar(un,Er){var Jr=0,yn=0,ai=Qn;if(typeof un=="object"&&un){var _r=un;if("shape"in _r){var Sr=_r.shape;N(Array.isArray(Sr)&&Sr.length>=2,"invalid renderbuffer shape"),Jr=Sr[0]|0,yn=Sr[1]|0}else"radius"in _r&&(Jr=yn=_r.radius|0),"width"in _r&&(Jr=_r.width|0),"height"in _r&&(yn=_r.height|0);"format"in _r&&(N.parameter(_r.format,Jt,"invalid renderbuffer format"),ai=Jt[_r.format])}else typeof un=="number"?(Jr=un|0,typeof Er=="number"?yn=Er|0:yn=Jr):un?N.raise("invalid arguments to renderbuffer constructor"):Jr=yn=1;if(N(Jr>0&&yn>0&&Jr<=$e.maxRenderbufferSize&&yn<=$e.maxRenderbufferSize,"invalid renderbuffer size"),!(Jr===Tt.width&&yn===Tt.height&&ai===Tt.format))return ar.width=Tt.width=Jr,ar.height=Tt.height=yn,Tt.format=ai,U.bindRenderbuffer(Rs,Tt.renderbuffer),U.renderbufferStorage(Rs,ai,Jr,yn),N(U.getError()===0,"invalid render buffer format"),wr.profile&&(Tt.stats.size=eh(Tt.format,Tt.width,Tt.height)),ar.format=yr[Tt.format],ar}function Vr(un,Er){var Jr=un|0,yn=Er|0||Jr;return Jr===Tt.width&&yn===Tt.height||(N(Jr>0&&yn>0&&Jr<=$e.maxRenderbufferSize&&yn<=$e.maxRenderbufferSize,"invalid renderbuffer size"),ar.width=Tt.width=Jr,ar.height=Tt.height=yn,U.bindRenderbuffer(Rs,Tt.renderbuffer),U.renderbufferStorage(Rs,Tt.format,Jr,yn),N(U.getError()===0,"invalid render buffer format"),wr.profile&&(Tt.stats.size=eh(Tt.format,Tt.width,Tt.height))),ar}return ar(Ur,Kr),ar.resize=Vr,ar._reglType="renderbuffer",ar._renderbuffer=Tt,wr.profile&&(ar.stats=Tt.stats),ar.destroy=function(){Tt.decRef()},ar}wr.profile&&(rr.getTotalRenderbufferSize=function(){var Ur=0;return Object.keys(Br).forEach(function(Kr){Ur+=Br[Kr].stats.size}),Ur});function hn(){fe(Br).forEach(function(Ur){Ur.renderbuffer=U.createRenderbuffer(),U.bindRenderbuffer(Rs,Ur.renderbuffer),U.renderbufferStorage(Rs,Ur.format,Ur.width,Ur.height)}),U.bindRenderbuffer(Rs,null)}return{create:qr,clear:function(){fe(Br).forEach($r)},restore:hn}},Ks=36160,lu=36161,Ko=3553,Yu=34069,Cu=36064,gc=36096,Hl=36128,ml=33306,Tf=36053,gl=36054,yc=36055,Ch=36057,qu=36061,yl=36193,Mf=5121,zu=5126,Zs=6407,_c=6408,Hc=6402,xc=[Zs,_c],bc=[];bc[_c]=4,bc[Zs]=3;var f=[];f[Mf]=1,f[zu]=4,f[yl]=2;var d=32854,h=32855,g=36194,w=33189,M=36168,I=34041,O=35907,G=34836,Q=34842,ge=34843,xe=[d,h,g,O,Q,ge,G],Ee={};Ee[Tf]="complete",Ee[gl]="incomplete attachment",Ee[Ch]="incomplete dimensions",Ee[yc]="incomplete, missing attachment",Ee[qu]="unsupported";function je(U,we,$e,rr,wr,Jt){var yr={cur:null,next:null,dirty:!1,setFBO:null},kr=["rgba"],Br=["rgba4","rgb565","rgb5 a1"];we.ext_srgb&&Br.push("srgba"),we.ext_color_buffer_half_float&&Br.push("rgba16f","rgb16f"),we.webgl_color_buffer_float&&Br.push("rgba32f");var Zr=["uint8"];we.oes_texture_half_float&&Zr.push("half float","float16"),we.oes_texture_float&&Zr.push("float","float32");function $r(Gr,mn,_n){this.target=Gr,this.texture=mn,this.renderbuffer=_n;var Ri=0,Ei=0;mn?(Ri=mn.width,Ei=mn.height):_n&&(Ri=_n.width,Ei=_n.height),this.width=Ri,this.height=Ei}function qr(Gr){Gr&&(Gr.texture&&Gr.texture._texture.decRef(),Gr.renderbuffer&&Gr.renderbuffer._renderbuffer.decRef())}function hn(Gr,mn,_n){if(!!Gr)if(Gr.texture){var Ri=Gr.texture._texture,Ei=Math.max(1,Ri.width),pn=Math.max(1,Ri.height);N(Ei===mn&&pn===_n,"inconsistent width/height for supplied texture"),Ri.refCount+=1}else{var Tn=Gr.renderbuffer._renderbuffer;N(Tn.width===mn&&Tn.height===_n,"inconsistent width/height for renderbuffer"),Tn.refCount+=1}}function Ur(Gr,mn){mn&&(mn.texture?U.framebufferTexture2D(Ks,Gr,mn.target,mn.texture._texture.texture,0):U.framebufferRenderbuffer(Ks,Gr,lu,mn.renderbuffer._renderbuffer.renderbuffer))}function Kr(Gr){var mn=Ko,_n=null,Ri=null,Ei=Gr;typeof Gr=="object"&&(Ei=Gr.data,"target"in Gr&&(mn=Gr.target|0)),N.type(Ei,"function","invalid attachment data");var pn=Ei._reglType;return pn==="texture2d"?(_n=Ei,N(mn===Ko)):pn==="textureCube"?(_n=Ei,N(mn>=Yu&&mn<Yu+6,"invalid cube map target")):pn==="renderbuffer"?(Ri=Ei,mn=lu):N.raise("invalid regl object for attachment"),new $r(mn,_n,Ri)}function Tt(Gr,mn,_n,Ri,Ei){if(_n){var pn=rr.create2D({width:Gr,height:mn,format:Ri,type:Ei});return pn._texture.refCount=0,new $r(Ko,pn,null)}else{var Tn=wr.create({width:Gr,height:mn,format:Ri});return Tn._renderbuffer.refCount=0,new $r(lu,null,Tn)}}function ar(Gr){return Gr&&(Gr.texture||Gr.renderbuffer)}function Vr(Gr,mn,_n){Gr&&(Gr.texture?Gr.texture.resize(mn,_n):Gr.renderbuffer&&Gr.renderbuffer.resize(mn,_n),Gr.width=mn,Gr.height=_n)}var un=0,Er={};function Jr(){this.id=un++,Er[this.id]=this,this.framebuffer=U.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function yn(Gr){Gr.colorAttachments.forEach(qr),qr(Gr.depthAttachment),qr(Gr.stencilAttachment),qr(Gr.depthStencilAttachment)}function ai(Gr){var mn=Gr.framebuffer;N(mn,"must not double destroy framebuffer"),U.deleteFramebuffer(mn),Gr.framebuffer=null,Jt.framebufferCount--,delete Er[Gr.id]}function _r(Gr){var mn;U.bindFramebuffer(Ks,Gr.framebuffer);var _n=Gr.colorAttachments;for(mn=0;mn<_n.length;++mn)Ur(Cu+mn,_n[mn]);for(mn=_n.length;mn<$e.maxColorAttachments;++mn)U.framebufferTexture2D(Ks,Cu+mn,Ko,null,0);U.framebufferTexture2D(Ks,ml,Ko,null,0),U.framebufferTexture2D(Ks,gc,Ko,null,0),U.framebufferTexture2D(Ks,Hl,Ko,null,0),Ur(gc,Gr.depthAttachment),Ur(Hl,Gr.stencilAttachment),Ur(ml,Gr.depthStencilAttachment);var Ri=U.checkFramebufferStatus(Ks);!U.isContextLost()&&Ri!==Tf&&N.raise("framebuffer configuration not supported, status = "+Ee[Ri]),U.bindFramebuffer(Ks,yr.next?yr.next.framebuffer:null),yr.cur=yr.next,U.getError()}function Sr(Gr,mn){var _n=new Jr;Jt.framebufferCount++;function Ri(pn,Tn){var hi;N(yr.next!==_n,"can not update framebuffer which is currently in use");var Mi=0,$i=0,fo=!0,Ao=!0,Yi=null,os=!0,ao="rgba",ss="uint8",Ho=1,us=null,Qo=null,ds=null,To=!1;if(typeof pn=="number")Mi=pn|0,$i=Tn|0||Mi;else if(!pn)Mi=$i=1;else{N.type(pn,"object","invalid arguments for framebuffer");var Li=pn;if("shape"in Li){var Wo=Li.shape;N(Array.isArray(Wo)&&Wo.length>=2,"invalid shape for framebuffer"),Mi=Wo[0],$i=Wo[1]}else"radius"in Li&&(Mi=$i=Li.radius),"width"in Li&&(Mi=Li.width),"height"in Li&&($i=Li.height);("color"in Li||"colors"in Li)&&(Yi=Li.color||Li.colors,Array.isArray(Yi)&&N(Yi.length===1||we.webgl_draw_buffers,"multiple render targets not supported")),Yi||("colorCount"in Li&&(Ho=Li.colorCount|0,N(Ho>0,"invalid color buffer count")),"colorTexture"in Li&&(os=!!Li.colorTexture,ao="rgba4"),"colorType"in Li&&(ss=Li.colorType,os?(N(we.oes_texture_float||!(ss==="float"||ss==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),N(we.oes_texture_half_float||!(ss==="half float"||ss==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):ss==="half float"||ss==="float16"?(N(we.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),ao="rgba16f"):(ss==="float"||ss==="float32")&&(N(we.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),ao="rgba32f"),N.oneOf(ss,Zr,"invalid color type")),"colorFormat"in Li&&(ao=Li.colorFormat,kr.indexOf(ao)>=0?os=!0:Br.indexOf(ao)>=0?os=!1:N.optional(function(){os?N.oneOf(Li.colorFormat,kr,"invalid color format for texture"):N.oneOf(Li.colorFormat,Br,"invalid color format for renderbuffer")}))),("depthTexture"in Li||"depthStencilTexture"in Li)&&(To=!!(Li.depthTexture||Li.depthStencilTexture),N(!To||we.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Li&&(typeof Li.depth=="boolean"?fo=Li.depth:(us=Li.depth,Ao=!1)),"stencil"in Li&&(typeof Li.stencil=="boolean"?Ao=Li.stencil:(Qo=Li.stencil,fo=!1)),"depthStencil"in Li&&(typeof Li.depthStencil=="boolean"?fo=Ao=Li.depthStencil:(ds=Li.depthStencil,fo=!1,Ao=!1))}var da=null,vs=null,xi=null,qi=null;if(Array.isArray(Yi))da=Yi.map(Kr);else if(Yi)da=[Kr(Yi)];else for(da=new Array(Ho),hi=0;hi<Ho;++hi)da[hi]=Tt(Mi,$i,os,ao,ss);N(we.webgl_draw_buffers||da.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),N(da.length<=$e.maxColorAttachments,"too many color attachments, not supported"),Mi=Mi||da[0].width,$i=$i||da[0].height,us?vs=Kr(us):fo&&!Ao&&(vs=Tt(Mi,$i,To,"depth","uint32")),Qo?xi=Kr(Qo):Ao&&!fo&&(xi=Tt(Mi,$i,!1,"stencil","uint8")),ds?qi=Kr(ds):!us&&!Qo&&Ao&&fo&&(qi=Tt(Mi,$i,To,"depth stencil","depth stencil")),N(!!us+!!Qo+!!ds<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Ca=null;for(hi=0;hi<da.length;++hi)if(hn(da[hi],Mi,$i),N(!da[hi]||da[hi].texture&&xc.indexOf(da[hi].texture._texture.format)>=0||da[hi].renderbuffer&&xe.indexOf(da[hi].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+hi+" is invalid"),da[hi]&&da[hi].texture){var zo=bc[da[hi].texture._texture.format]*f[da[hi].texture._texture.type];Ca===null?Ca=zo:N(Ca===zo,"all color attachments much have the same number of bits per pixel.")}return hn(vs,Mi,$i),N(!vs||vs.texture&&vs.texture._texture.format===Hc||vs.renderbuffer&&vs.renderbuffer._renderbuffer.format===w,"invalid depth attachment for framebuffer object"),hn(xi,Mi,$i),N(!xi||xi.renderbuffer&&xi.renderbuffer._renderbuffer.format===M,"invalid stencil attachment for framebuffer object"),hn(qi,Mi,$i),N(!qi||qi.texture&&qi.texture._texture.format===I||qi.renderbuffer&&qi.renderbuffer._renderbuffer.format===I,"invalid depth-stencil attachment for framebuffer object"),yn(_n),_n.width=Mi,_n.height=$i,_n.colorAttachments=da,_n.depthAttachment=vs,_n.stencilAttachment=xi,_n.depthStencilAttachment=qi,Ri.color=da.map(ar),Ri.depth=ar(vs),Ri.stencil=ar(xi),Ri.depthStencil=ar(qi),Ri.width=_n.width,Ri.height=_n.height,_r(_n),Ri}function Ei(pn,Tn){N(yr.next!==_n,"can not resize a framebuffer which is currently in use");var hi=Math.max(pn|0,1),Mi=Math.max(Tn|0||hi,1);if(hi===_n.width&&Mi===_n.height)return Ri;for(var $i=_n.colorAttachments,fo=0;fo<$i.length;++fo)Vr($i[fo],hi,Mi);return Vr(_n.depthAttachment,hi,Mi),Vr(_n.stencilAttachment,hi,Mi),Vr(_n.depthStencilAttachment,hi,Mi),_n.width=Ri.width=hi,_n.height=Ri.height=Mi,_r(_n),Ri}return Ri(Gr,mn),y(Ri,{resize:Ei,_reglType:"framebuffer",_framebuffer:_n,destroy:function(){ai(_n),yn(_n)},use:function(pn){yr.setFBO({framebuffer:Ri},pn)}})}function Gn(Gr){var mn=Array(6);function _n(Ei){var pn;N(mn.indexOf(yr.next)<0,"can not update framebuffer which is currently in use");var Tn={color:null},hi=0,Mi=null,$i="rgba",fo="uint8",Ao=1;if(typeof Ei=="number")hi=Ei|0;else if(!Ei)hi=1;else{N.type(Ei,"object","invalid arguments for framebuffer");var Yi=Ei;if("shape"in Yi){var os=Yi.shape;N(Array.isArray(os)&&os.length>=2,"invalid shape for framebuffer"),N(os[0]===os[1],"cube framebuffer must be square"),hi=os[0]}else"radius"in Yi&&(hi=Yi.radius|0),"width"in Yi?(hi=Yi.width|0,"height"in Yi&&N(Yi.height===hi,"must be square")):"height"in Yi&&(hi=Yi.height|0);("color"in Yi||"colors"in Yi)&&(Mi=Yi.color||Yi.colors,Array.isArray(Mi)&&N(Mi.length===1||we.webgl_draw_buffers,"multiple render targets not supported")),Mi||("colorCount"in Yi&&(Ao=Yi.colorCount|0,N(Ao>0,"invalid color buffer count")),"colorType"in Yi&&(N.oneOf(Yi.colorType,Zr,"invalid color type"),fo=Yi.colorType),"colorFormat"in Yi&&($i=Yi.colorFormat,N.oneOf(Yi.colorFormat,kr,"invalid color format for texture"))),"depth"in Yi&&(Tn.depth=Yi.depth),"stencil"in Yi&&(Tn.stencil=Yi.stencil),"depthStencil"in Yi&&(Tn.depthStencil=Yi.depthStencil)}var ao;if(Mi)if(Array.isArray(Mi))for(ao=[],pn=0;pn<Mi.length;++pn)ao[pn]=Mi[pn];else ao=[Mi];else{ao=Array(Ao);var ss={radius:hi,format:$i,type:fo};for(pn=0;pn<Ao;++pn)ao[pn]=rr.createCube(ss)}for(Tn.color=Array(ao.length),pn=0;pn<ao.length;++pn){var Ho=ao[pn];N(typeof Ho=="function"&&Ho._reglType==="textureCube","invalid cube map"),hi=hi||Ho.width,N(Ho.width===hi&&Ho.height===hi,"invalid cube map shape"),Tn.color[pn]={target:Yu,data:ao[pn]}}for(pn=0;pn<6;++pn){for(var us=0;us<ao.length;++us)Tn.color[us].target=Yu+pn;pn>0&&(Tn.depth=mn[0].depth,Tn.stencil=mn[0].stencil,Tn.depthStencil=mn[0].depthStencil),mn[pn]?mn[pn](Tn):mn[pn]=Sr(Tn)}return y(_n,{width:hi,height:hi,color:ao})}function Ri(Ei){var pn,Tn=Ei|0;if(N(Tn>0&&Tn<=$e.maxCubeMapSize,"invalid radius for cube fbo"),Tn===_n.width)return _n;var hi=_n.color;for(pn=0;pn<hi.length;++pn)hi[pn].resize(Tn);for(pn=0;pn<6;++pn)mn[pn].resize(Tn);return _n.width=_n.height=Tn,_n}return _n(Gr),y(_n,{faces:mn,resize:Ri,_reglType:"framebufferCube",destroy:function(){mn.forEach(function(Ei){Ei.destroy()})}})}function nn(){yr.cur=null,yr.next=null,yr.dirty=!0,fe(Er).forEach(function(Gr){Gr.framebuffer=U.createFramebuffer(),_r(Gr)})}return y(yr,{getFramebuffer:function(Gr){if(typeof Gr=="function"&&Gr._reglType==="framebuffer"){var mn=Gr._framebuffer;if(mn instanceof Jr)return mn}return null},create:Sr,createCube:Gn,clear:function(){fe(Er).forEach(ai)},restore:nn})}var Ve=5126,nt=34962,Fe=34963,it=["attributes","elements","offset","count","primitive","instances"];function yt(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ve,this.offset=0,this.stride=0,this.divisor=0}function Bt(U,we,$e,rr,wr,Jt,yr){for(var kr=$e.maxAttributes,Br=new Array(kr),Zr=0;Zr<kr;++Zr)Br[Zr]=new yt;var $r=0,qr={},hn={Record:yt,scope:{},state:Br,currentVAO:null,targetVAO:null,restore:Kr()?yn:function(){},createVAO:ai,getVAO:ar,destroyBuffer:Ur,setVAO:Kr()?Vr:un,clear:Kr()?Er:function(){}};function Ur(_r){for(var Sr=0;Sr<Br.length;++Sr){var Gn=Br[Sr];Gn.buffer===_r&&(U.disableVertexAttribArray(Sr),Gn.buffer=null)}}function Kr(){return we.oes_vertex_array_object}function Tt(){return we.angle_instanced_arrays}function ar(_r){return typeof _r=="function"&&_r._vao?_r._vao:null}function Vr(_r){if(_r!==hn.currentVAO){var Sr=Kr();_r?Sr.bindVertexArrayOES(_r.vao):Sr.bindVertexArrayOES(null),hn.currentVAO=_r}}function un(_r){if(_r!==hn.currentVAO){if(_r)_r.bindAttrs();else{for(var Sr=Tt(),Gn=0;Gn<Br.length;++Gn){var nn=Br[Gn];nn.buffer?(U.enableVertexAttribArray(Gn),nn.buffer.bind(),U.vertexAttribPointer(Gn,nn.size,nn.type,nn.normalized,nn.stride,nn.offfset),Sr&&nn.divisor&&Sr.vertexAttribDivisorANGLE(Gn,nn.divisor)):(U.disableVertexAttribArray(Gn),U.vertexAttrib4f(Gn,nn.x,nn.y,nn.z,nn.w))}yr.elements?U.bindBuffer(Fe,yr.elements.buffer.buffer):U.bindBuffer(Fe,null)}hn.currentVAO=_r}}function Er(){fe(qr).forEach(function(_r){_r.destroy()})}function Jr(){this.id=++$r,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var _r=Kr();_r?this.vao=_r.createVertexArrayOES():this.vao=null,qr[this.id]=this,this.buffers=[]}Jr.prototype.bindAttrs=function(){for(var _r=Tt(),Sr=this.attributes,Gn=0;Gn<Sr.length;++Gn){var nn=Sr[Gn];nn.buffer?(U.enableVertexAttribArray(Gn),U.bindBuffer(nt,nn.buffer.buffer),U.vertexAttribPointer(Gn,nn.size,nn.type,nn.normalized,nn.stride,nn.offset),_r&&nn.divisor&&_r.vertexAttribDivisorANGLE(Gn,nn.divisor)):(U.disableVertexAttribArray(Gn),U.vertexAttrib4f(Gn,nn.x,nn.y,nn.z,nn.w))}for(var Gr=Sr.length;Gr<kr;++Gr)U.disableVertexAttribArray(Gr);var mn=Jt.getElements(this.elements);mn?U.bindBuffer(Fe,mn.buffer.buffer):U.bindBuffer(Fe,null)},Jr.prototype.refresh=function(){var _r=Kr();_r&&(_r.bindVertexArrayOES(this.vao),this.bindAttrs(),hn.currentVAO=null,_r.bindVertexArrayOES(null))},Jr.prototype.destroy=function(){if(this.vao){var _r=Kr();this===hn.currentVAO&&(hn.currentVAO=null,_r.bindVertexArrayOES(null)),_r.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),qr[this.id]&&(delete qr[this.id],rr.vaoCount-=1)};function yn(){var _r=Kr();_r&&fe(qr).forEach(function(Sr){Sr.refresh()})}function ai(_r){var Sr=new Jr;rr.vaoCount+=1;function Gn(nn){var Gr;if(Array.isArray(nn))Gr=nn,Sr.elements&&Sr.ownsElements&&Sr.elements.destroy(),Sr.elements=null,Sr.ownsElements=!1,Sr.offset=0,Sr.count=0,Sr.instances=-1,Sr.primitive=4;else{if(N(typeof nn=="object","invalid arguments for create vao"),N("attributes"in nn,"must specify attributes for vao"),nn.elements){var mn=nn.elements;Sr.ownsElements?typeof mn=="function"&&mn._reglType==="elements"?(Sr.elements.destroy(),Sr.ownsElements=!1):(Sr.elements(mn),Sr.ownsElements=!1):Jt.getElements(nn.elements)?(Sr.elements=nn.elements,Sr.ownsElements=!1):(Sr.elements=Jt.create(nn.elements),Sr.ownsElements=!0)}else Sr.elements=null,Sr.ownsElements=!1;Gr=nn.attributes,Sr.offset=0,Sr.count=-1,Sr.instances=-1,Sr.primitive=4,Sr.elements&&(Sr.count=Sr.elements._elements.vertCount,Sr.primitive=Sr.elements._elements.primType),"offset"in nn&&(Sr.offset=nn.offset|0),"count"in nn&&(Sr.count=nn.count|0),"instances"in nn&&(Sr.instances=nn.instances|0),"primitive"in nn&&(N(nn.primitive in Ar,"bad primitive type: "+nn.primitive),Sr.primitive=Ar[nn.primitive]),N.optional(function(){for(var fo=Object.keys(nn),Ao=0;Ao<fo.length;++Ao)N(it.indexOf(fo[Ao])>=0,'invalid option for vao: "'+fo[Ao]+'" valid options are '+it)}),N(Array.isArray(Gr),"attributes must be an array")}N(Gr.length<kr,"too many attributes"),N(Gr.length>0,"must specify at least one attribute");var _n={},Ri=Sr.attributes;Ri.length=Gr.length;for(var Ei=0;Ei<Gr.length;++Ei){var pn=Gr[Ei],Tn=Ri[Ei]=new yt,hi=pn.data||pn;if(Array.isArray(hi)||Te(hi)||He(hi)){var Mi;Sr.buffers[Ei]&&(Mi=Sr.buffers[Ei],Te(hi)&&Mi._buffer.byteLength>=hi.byteLength?Mi.subdata(hi):(Mi.destroy(),Sr.buffers[Ei]=null)),Sr.buffers[Ei]||(Mi=Sr.buffers[Ei]=wr.create(pn,nt,!1,!0)),Tn.buffer=wr.getBuffer(Mi),Tn.size=Tn.buffer.dimension|0,Tn.normalized=!1,Tn.type=Tn.buffer.dtype,Tn.offset=0,Tn.stride=0,Tn.divisor=0,Tn.state=1,_n[Ei]=1}else wr.getBuffer(pn)?(Tn.buffer=wr.getBuffer(pn),Tn.size=Tn.buffer.dimension|0,Tn.normalized=!1,Tn.type=Tn.buffer.dtype,Tn.offset=0,Tn.stride=0,Tn.divisor=0,Tn.state=1):wr.getBuffer(pn.buffer)?(Tn.buffer=wr.getBuffer(pn.buffer),Tn.size=(+pn.size||Tn.buffer.dimension)|0,Tn.normalized=!!pn.normalized||!1,"type"in pn?(N.parameter(pn.type,ru,"invalid buffer type"),Tn.type=ru[pn.type]):Tn.type=Tn.buffer.dtype,Tn.offset=(pn.offset||0)|0,Tn.stride=(pn.stride||0)|0,Tn.divisor=(pn.divisor||0)|0,Tn.state=1,N(Tn.size>=1&&Tn.size<=4,"size must be between 1 and 4"),N(Tn.offset>=0,"invalid offset"),N(Tn.stride>=0&&Tn.stride<=255,"stride must be between 0 and 255"),N(Tn.divisor>=0,"divisor must be positive"),N(!Tn.divisor||!!we.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in pn?(N(Ei>0,"first attribute must not be a constant"),Tn.x=+pn.x||0,Tn.y=+pn.y||0,Tn.z=+pn.z||0,Tn.w=+pn.w||0,Tn.state=2):N(!1,"invalid attribute spec for location "+Ei)}for(var $i=0;$i<Sr.buffers.length;++$i)!_n[$i]&&Sr.buffers[$i]&&(Sr.buffers[$i].destroy(),Sr.buffers[$i]=null);return Sr.refresh(),Gn}return Gn.destroy=function(){for(var nn=0;nn<Sr.buffers.length;++nn)Sr.buffers[nn]&&Sr.buffers[nn].destroy();Sr.buffers.length=0,Sr.ownsElements&&(Sr.elements.destroy(),Sr.elements=null,Sr.ownsElements=!1),Sr.destroy()},Gn._vao=Sr,Gn._reglType="vao",Gn(_r)}return hn}var fr=35632,ir=35633,mr=35718,Or=35721;function on(U,we,$e,rr){var wr={},Jt={};function yr(Tt,ar,Vr,un){this.name=Tt,this.id=ar,this.location=Vr,this.info=un}function kr(Tt,ar){for(var Vr=0;Vr<Tt.length;++Vr)if(Tt[Vr].id===ar.id){Tt[Vr].location=ar.location;return}Tt.push(ar)}function Br(Tt,ar,Vr){var un=Tt===fr?wr:Jt,Er=un[ar];if(!Er){var Jr=we.str(ar);Er=U.createShader(Tt),U.shaderSource(Er,Jr),U.compileShader(Er),N.shaderError(U,Er,Jr,Tt,Vr),un[ar]=Er}return Er}var Zr={},$r=[],qr=0;function hn(Tt,ar){this.id=qr++,this.fragId=Tt,this.vertId=ar,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,rr.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Ur(Tt,ar,Vr){var un,Er,Jr=Br(fr,Tt.fragId),yn=Br(ir,Tt.vertId),ai=Tt.program=U.createProgram();if(U.attachShader(ai,Jr),U.attachShader(ai,yn),Vr)for(un=0;un<Vr.length;++un){var _r=Vr[un];U.bindAttribLocation(ai,_r[0],_r[1])}U.linkProgram(ai),N.linkError(U,ai,we.str(Tt.fragId),we.str(Tt.vertId),ar);var Sr=U.getProgramParameter(ai,mr);rr.profile&&(Tt.stats.uniformsCount=Sr);var Gn=Tt.uniforms;for(un=0;un<Sr;++un)if(Er=U.getActiveUniform(ai,un),Er)if(Er.size>1)for(var nn=0;nn<Er.size;++nn){var Gr=Er.name.replace("[0]","["+nn+"]");kr(Gn,new yr(Gr,we.id(Gr),U.getUniformLocation(ai,Gr),Er))}else kr(Gn,new yr(Er.name,we.id(Er.name),U.getUniformLocation(ai,Er.name),Er));var mn=U.getProgramParameter(ai,Or);rr.profile&&(Tt.stats.attributesCount=mn);var _n=Tt.attributes;for(un=0;un<mn;++un)Er=U.getActiveAttrib(ai,un),Er&&kr(_n,new yr(Er.name,we.id(Er.name),U.getAttribLocation(ai,Er.name),Er))}rr.profile&&($e.getMaxUniformsCount=function(){var Tt=0;return $r.forEach(function(ar){ar.stats.uniformsCount>Tt&&(Tt=ar.stats.uniformsCount)}),Tt},$e.getMaxAttributesCount=function(){var Tt=0;return $r.forEach(function(ar){ar.stats.attributesCount>Tt&&(Tt=ar.stats.attributesCount)}),Tt});function Kr(){wr={},Jt={};for(var Tt=0;Tt<$r.length;++Tt)Ur($r[Tt],null,$r[Tt].attributes.map(function(ar){return[ar.location,ar.name]}))}return{clear:function(){var Tt=U.deleteShader.bind(U);fe(wr).forEach(Tt),wr={},fe(Jt).forEach(Tt),Jt={},$r.forEach(function(ar){U.deleteProgram(ar.program)}),$r.length=0,Zr={},$e.shaderCount=0},program:function(Tt,ar,Vr,un){N.command(Tt>=0,"missing vertex shader",Vr),N.command(ar>=0,"missing fragment shader",Vr);var Er=Zr[ar];Er||(Er=Zr[ar]={});var Jr=Er[Tt];if(Jr&&(Jr.refCount++,!un))return Jr;var yn=new hn(ar,Tt);return $e.shaderCount++,Ur(yn,Vr,un),Jr||(Er[Tt]=yn),$r.push(yn),y(yn,{destroy:function(){if(yn.refCount--,yn.refCount<=0){U.deleteProgram(yn.program);var ai=$r.indexOf(yn);$r.splice(ai,1),$e.shaderCount--}Er[yn.vertId].refCount<=0&&(U.deleteShader(Jt[yn.vertId]),delete Jt[yn.vertId],delete Zr[yn.fragId][yn.vertId]),Object.keys(Zr[yn.fragId]).length||(U.deleteShader(wr[yn.fragId]),delete wr[yn.fragId],delete Zr[yn.fragId])}})},restore:Kr,shader:Br,frag:-1,vert:-1}}var jr=6408,Cn=5121,ni=3333,ii=5126;function oi(U,we,$e,rr,wr,Jt,yr){function kr($r){var qr;we.next===null?(N(wr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),qr=Cn):(N(we.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),qr=we.next.colorAttachments[0].texture._texture.type,N.optional(function(){Jt.oes_texture_float?(N(qr===Cn||qr===ii,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),qr===ii&&N(yr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):N(qr===Cn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var hn=0,Ur=0,Kr=rr.framebufferWidth,Tt=rr.framebufferHeight,ar=null;Te($r)?ar=$r:$r&&(N.type($r,"object","invalid arguments to regl.read()"),hn=$r.x|0,Ur=$r.y|0,N(hn>=0&&hn<rr.framebufferWidth,"invalid x offset for regl.read"),N(Ur>=0&&Ur<rr.framebufferHeight,"invalid y offset for regl.read"),Kr=($r.width||rr.framebufferWidth-hn)|0,Tt=($r.height||rr.framebufferHeight-Ur)|0,ar=$r.data||null),ar&&(qr===Cn?N(ar instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):qr===ii&&N(ar instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),N(Kr>0&&Kr+hn<=rr.framebufferWidth,"invalid width for read pixels"),N(Tt>0&&Tt+Ur<=rr.framebufferHeight,"invalid height for read pixels"),$e();var Vr=Kr*Tt*4;return ar||(qr===Cn?ar=new Uint8Array(Vr):qr===ii&&(ar=ar||new Float32Array(Vr))),N.isTypedArray(ar,"data buffer for regl.read() must be a typedarray"),N(ar.byteLength>=Vr,"data buffer for regl.read() too small"),U.pixelStorei(ni,4),U.readPixels(hn,Ur,Kr,Tt,jr,qr,ar),ar}function Br($r){var qr;return we.setFBO({framebuffer:$r.framebuffer},function(){qr=kr($r)}),qr}function Zr($r){return!$r||!("framebuffer"in $r)?kr($r):Br($r)}return Zr}function ta(U){return Array.prototype.slice.call(U)}function An(U){return ta(U).join("")}function Ci(){var U=0,we=[],$e=[];function rr(qr){for(var hn=0;hn<$e.length;++hn)if($e[hn]===qr)return we[hn];var Ur="g"+U++;return we.push(Ur),$e.push(qr),Ur}function wr(){var qr=[];function hn(){qr.push.apply(qr,ta(arguments))}var Ur=[];function Kr(){var Tt="v"+U++;return Ur.push(Tt),arguments.length>0&&(qr.push(Tt,"="),qr.push.apply(qr,ta(arguments)),qr.push(";")),Tt}return y(hn,{def:Kr,toString:function(){return An([Ur.length>0?"var "+Ur.join(",")+";":"",An(qr)])}})}function Jt(){var qr=wr(),hn=wr(),Ur=qr.toString,Kr=hn.toString;function Tt(ar,Vr){hn(ar,Vr,"=",qr.def(ar,Vr),";")}return y(function(){qr.apply(qr,ta(arguments))},{def:qr.def,entry:qr,exit:hn,save:Tt,set:function(ar,Vr,un){Tt(ar,Vr),qr(ar,Vr,"=",un,";")},toString:function(){return Ur()+Kr()}})}function yr(){var qr=An(arguments),hn=Jt(),Ur=Jt(),Kr=hn.toString,Tt=Ur.toString;return y(hn,{then:function(){return hn.apply(hn,ta(arguments)),this},else:function(){return Ur.apply(Ur,ta(arguments)),this},toString:function(){var ar=Tt();return ar&&(ar="else{"+ar+"}"),An(["if(",qr,"){",Kr(),"}",ar])}})}var kr=wr(),Br={};function Zr(qr,hn){var Ur=[];function Kr(){var Er="a"+Ur.length;return Ur.push(Er),Er}hn=hn||0;for(var Tt=0;Tt<hn;++Tt)Kr();var ar=Jt(),Vr=ar.toString,un=Br[qr]=y(ar,{arg:Kr,toString:function(){return An(["function(",Ur.join(),"){",Vr(),"}"])}});return un}function $r(){var qr=['"use strict";',kr,"return {"];Object.keys(Br).forEach(function(Tt){qr.push('"',Tt,'":',Br[Tt].toString(),",")}),qr.push("}");var hn=An(qr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Ur=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Kr=Ur?Le.Function.apply(null,we.concat(hn)):Function.apply(null,we.concat(hn));return Kr.apply(null,$e)}return{global:kr,link:rr,block:wr,proc:Zr,scope:Jt,cond:yr,compile:$r}}var En="xyzw".split(""),li=5121,Jn=1,Ti=2,di=0,fi=1,Lo=2,co=3,Oo=4,Fo=5,qa=6,io="dither",Ls="blend.enable",Hi="blend.color",Wt="blend.equation",Ss="blend.func",be="depth.enable",ws="depth.func",yu="depth.range",Ec="depth.mask",Ku="colorMask",Sc="cull.enable",Wc="cull.face",Au="frontFace",Wl="lineWidth",Tu="polygonOffset.enable",Do="polygonOffset.offset",_u="sample.alpha",Qu="sample.enable",Ju="sample.coverage",pa="stencil.enable",Qs="stencil.mask",as="stencil.func",Zu="stencil.opFront",Xl="stencil.opBack",Xc="scissor.enable",$c="scissor.box",Os="viewport",$l="profile",cu="framebuffer",_l="vert",Yc="frag",Us="elements",Go="primitive",qc="count",th="offset",Ah="instances",Kc="vao",ip="Width",el="Height",Yl=cu+ip,rh=cu+el,Th=Os+ip,Id=Os+el,wc="drawingBuffer",Qc=wc+ip,ap=wc+el,zv=[Ss,Wt,as,Zu,Xl,Ju,Os,$c,Do],nh=34962,op=34963,Pd=35632,Rd=35633,Wp=3553,sp=34067,Ld=2884,kf=3042,Mh=3024,Bo=2960,kh=2929,Xp=3089,ih=32823,ah=32926,Jc=32928,up=5126,oh=35664,Cc=35665,If=35666,Ih=5124,lp=35667,xl=35668,Pf=35669,ef=35670,Rf=35671,Lf=35672,Vs=35673,W=35674,Xr=35675,Ac=35676,Ph=35678,No=35680,tl=4,fu=1028,ql=1029,Kl=2304,Ql=2305,Rh=32775,Zv=32776,Od=519,Js=7680,Lh=0,tf=1,rf=32774,bl=513,Fd=36160,Dd=36064,El={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Of=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Tc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Jl={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},$p={frag:Pd,vert:Rd},sh={cw:Kl,ccw:Ql};function uh(U){return Array.isArray(U)||Te(U)||He(U)}function cp(U){return U.sort(function(we,$e){return we===Os?-1:$e===Os?1:we<$e?-1:1})}function Ta(U,we,$e,rr){this.thisDep=U,this.contextDep=we,this.propDep=$e,this.append=rr}function Mc(U){return U&&!(U.thisDep||U.contextDep||U.propDep)}function go(U){return new Ta(!1,!1,!1,U)}function hu(U,we){var $e=U.type;if($e===di){var rr=U.data.length;return new Ta(!0,rr>=1,rr>=2,we)}else if($e===Oo){var wr=U.data;return new Ta(wr.thisDep,wr.contextDep,wr.propDep,we)}else{if($e===Fo)return new Ta(!1,!1,!1,we);if($e===qa){for(var Jt=!1,yr=!1,kr=!1,Br=0;Br<U.data.length;++Br){var Zr=U.data[Br];if(Zr.type===fi)kr=!0;else if(Zr.type===Lo)yr=!0;else if(Zr.type===co)Jt=!0;else if(Zr.type===di){Jt=!0;var $r=Zr.data;$r>=1&&(yr=!0),$r>=2&&(kr=!0)}else Zr.type===Oo&&(Jt=Jt||Zr.data.thisDep,yr=yr||Zr.data.contextDep,kr=kr||Zr.data.propDep)}return new Ta(Jt,yr,kr,we)}else return new Ta($e===co,$e===Lo,$e===fi,we)}}var Yp=new Ta(!1,!1,!1,function(){});function qp(U,we,$e,rr,wr,Jt,yr,kr,Br,Zr,$r,qr,hn,Ur,Kr){var Tt=Zr.Record,ar={add:32774,subtract:32778,"reverse subtract":32779};$e.ext_blend_minmax&&(ar.min=Rh,ar.max=Zv);var Vr=$e.angle_instanced_arrays,un=$e.webgl_draw_buffers,Er=$e.oes_vertex_array_object,Jr={dirty:!0,profile:Kr.profile},yn={},ai=[],_r={},Sr={};function Gn(Re){return Re.replace(".","_")}function nn(Re,ve,tt){var Mt=Gn(Re);ai.push(Re),yn[Mt]=Jr[Mt]=!!tt,_r[Mt]=ve}function Gr(Re,ve,tt){var Mt=Gn(Re);ai.push(Re),Array.isArray(tt)?(Jr[Mt]=tt.slice(),yn[Mt]=tt.slice()):Jr[Mt]=yn[Mt]=tt,Sr[Mt]=ve}nn(io,Mh),nn(Ls,kf),Gr(Hi,"blendColor",[0,0,0,0]),Gr(Wt,"blendEquationSeparate",[rf,rf]),Gr(Ss,"blendFuncSeparate",[tf,Lh,tf,Lh]),nn(be,kh,!0),Gr(ws,"depthFunc",bl),Gr(yu,"depthRange",[0,1]),Gr(Ec,"depthMask",!0),Gr(Ku,Ku,[!0,!0,!0,!0]),nn(Sc,Ld),Gr(Wc,"cullFace",ql),Gr(Au,Au,Ql),Gr(Wl,Wl,1),nn(Tu,ih),Gr(Do,"polygonOffset",[0,0]),nn(_u,ah),nn(Qu,Jc),Gr(Ju,"sampleCoverage",[1,!1]),nn(pa,Bo),Gr(Qs,"stencilMask",-1),Gr(as,"stencilFunc",[Od,0,-1]),Gr(Zu,"stencilOpSeparate",[fu,Js,Js,Js]),Gr(Xl,"stencilOpSeparate",[ql,Js,Js,Js]),nn(Xc,Xp),Gr($c,"scissor",[0,0,U.drawingBufferWidth,U.drawingBufferHeight]),Gr(Os,Os,[0,0,U.drawingBufferWidth,U.drawingBufferHeight]);var mn={gl:U,context:hn,strings:we,next:yn,current:Jr,draw:qr,elements:Jt,buffer:wr,shader:$r,attributes:Zr.state,vao:Zr,uniforms:Br,framebuffer:kr,extensions:$e,timer:Ur,isBufferArgs:uh},_n={primTypes:Ar,compareFuncs:Tc,blendFuncs:El,blendEquations:ar,stencilOps:Jl,glTypes:ru,orientationType:sh};N.optional(function(){mn.isArrayLike=Eo}),un&&(_n.backBuffer=[ql],_n.drawBuffer=et(rr.maxDrawbuffers,function(Re){return Re===0?[0]:et(Re,function(ve){return Dd+ve})}));var Ri=0;function Ei(){var Re=Ci(),ve=Re.link,tt=Re.global;Re.id=Ri++,Re.batchId="0";var Mt=ve(mn),Yt=Re.shared={props:"a0"};Object.keys(mn).forEach(function(Je){Yt[Je]=tt.def(Mt,".",Je)}),N.optional(function(){Re.CHECK=ve(N),Re.commandStr=N.guessCommand(),Re.command=ve(Re.commandStr),Re.assert=function(Je,Oe,kt){Je("if(!(",Oe,"))",this.CHECK,".commandRaise(",ve(kt),",",this.command,");")},_n.invalidBlendCombinations=Of});var ut=Re.next={},We=Re.current={};Object.keys(Sr).forEach(function(Je){Array.isArray(Jr[Je])&&(ut[Je]=tt.def(Yt.next,".",Je),We[Je]=tt.def(Yt.current,".",Je))});var xt=Re.constants={};Object.keys(_n).forEach(function(Je){xt[Je]=tt.def(JSON.stringify(_n[Je]))}),Re.invoke=function(Je,Oe){switch(Oe.type){case di:var kt=["this",Yt.context,Yt.props,Re.batchId];return Je.def(ve(Oe.data),".call(",kt.slice(0,Math.max(Oe.data.length+1,4)),")");case fi:return Je.def(Yt.props,Oe.data);case Lo:return Je.def(Yt.context,Oe.data);case co:return Je.def("this",Oe.data);case Oo:return Oe.data.append(Re,Je),Oe.data.ref;case Fo:return Oe.data.toString();case qa:return Oe.data.map(function(Ut){return Re.invoke(Je,Ut)})}},Re.attribCache={};var Ae={};return Re.scopeAttrib=function(Je){var Oe=we.id(Je);if(Oe in Ae)return Ae[Oe];var kt=Zr.scope[Oe];kt||(kt=Zr.scope[Oe]=new Tt);var Ut=Ae[Oe]=ve(kt);return Ut},Re}function pn(Re){var ve=Re.static,tt=Re.dynamic,Mt;if($l in ve){var Yt=!!ve[$l];Mt=go(function(We,xt){return Yt}),Mt.enable=Yt}else if($l in tt){var ut=tt[$l];Mt=hu(ut,function(We,xt){return We.invoke(xt,ut)})}return Mt}function Tn(Re,ve){var tt=Re.static,Mt=Re.dynamic;if(cu in tt){var Yt=tt[cu];return Yt?(Yt=kr.getFramebuffer(Yt),N.command(Yt,"invalid framebuffer object"),go(function(We,xt){var Ae=We.link(Yt),Je=We.shared;xt.set(Je.framebuffer,".next",Ae);var Oe=Je.context;return xt.set(Oe,"."+Yl,Ae+".width"),xt.set(Oe,"."+rh,Ae+".height"),Ae})):go(function(We,xt){var Ae=We.shared;xt.set(Ae.framebuffer,".next","null");var Je=Ae.context;return xt.set(Je,"."+Yl,Je+"."+Qc),xt.set(Je,"."+rh,Je+"."+ap),"null"})}else if(cu in Mt){var ut=Mt[cu];return hu(ut,function(We,xt){var Ae=We.invoke(xt,ut),Je=We.shared,Oe=Je.framebuffer,kt=xt.def(Oe,".getFramebuffer(",Ae,")");N.optional(function(){We.assert(xt,"!"+Ae+"||"+kt,"invalid framebuffer object")}),xt.set(Oe,".next",kt);var Ut=Je.context;return xt.set(Ut,"."+Yl,kt+"?"+kt+".width:"+Ut+"."+Qc),xt.set(Ut,"."+rh,kt+"?"+kt+".height:"+Ut+"."+ap),kt})}else return null}function hi(Re,ve,tt){var Mt=Re.static,Yt=Re.dynamic;function ut(Ae){if(Ae in Mt){var Je=Mt[Ae];N.commandType(Je,"object","invalid "+Ae,tt.commandStr);var Oe=!0,kt=Je.x|0,Ut=Je.y|0,Mr,ln;return"width"in Je?(Mr=Je.width|0,N.command(Mr>=0,"invalid "+Ae,tt.commandStr)):Oe=!1,"height"in Je?(ln=Je.height|0,N.command(ln>=0,"invalid "+Ae,tt.commandStr)):Oe=!1,new Ta(!Oe&&ve&&ve.thisDep,!Oe&&ve&&ve.contextDep,!Oe&&ve&&ve.propDep,function(rn,Hn){var kn=rn.shared.context,Zn=Mr;"width"in Je||(Zn=Hn.def(kn,".",Yl,"-",kt));var Un=ln;return"height"in Je||(Un=Hn.def(kn,".",rh,"-",Ut)),[kt,Ut,Zn,Un]})}else if(Ae in Yt){var cn=Yt[Ae],Sn=hu(cn,function(rn,Hn){var kn=rn.invoke(Hn,cn);N.optional(function(){rn.assert(Hn,kn+"&&typeof "+kn+'==="object"',"invalid "+Ae)});var Zn=rn.shared.context,Un=Hn.def(kn,".x|0"),Ln=Hn.def(kn,".y|0"),pi=Hn.def('"width" in ',kn,"?",kn,".width|0:","(",Zn,".",Yl,"-",Un,")"),La=Hn.def('"height" in ',kn,"?",kn,".height|0:","(",Zn,".",rh,"-",Ln,")");return N.optional(function(){rn.assert(Hn,pi+">=0&&"+La+">=0","invalid "+Ae)}),[Un,Ln,pi,La]});return ve&&(Sn.thisDep=Sn.thisDep||ve.thisDep,Sn.contextDep=Sn.contextDep||ve.contextDep,Sn.propDep=Sn.propDep||ve.propDep),Sn}else return ve?new Ta(ve.thisDep,ve.contextDep,ve.propDep,function(rn,Hn){var kn=rn.shared.context;return[0,0,Hn.def(kn,".",Yl),Hn.def(kn,".",rh)]}):null}var We=ut(Os);if(We){var xt=We;We=new Ta(We.thisDep,We.contextDep,We.propDep,function(Ae,Je){var Oe=xt.append(Ae,Je),kt=Ae.shared.context;return Je.set(kt,"."+Th,Oe[2]),Je.set(kt,"."+Id,Oe[3]),Oe})}return{viewport:We,scissor_box:ut($c)}}function Mi(Re,ve){var tt=Re.static,Mt=typeof tt[Yc]=="string"&&typeof tt[_l]=="string";if(Mt){if(Object.keys(ve.dynamic).length>0)return null;var Yt=ve.static,ut=Object.keys(Yt);if(ut.length>0&&typeof Yt[ut[0]]=="number"){for(var We=[],xt=0;xt<ut.length;++xt)N(typeof Yt[ut[xt]]=="number","must specify all vertex attribute locations when using vaos"),We.push([Yt[ut[xt]]|0,ut[xt]]);return We}}return null}function $i(Re,ve,tt){var Mt=Re.static,Yt=Re.dynamic;function ut(Oe){if(Oe in Mt){var kt=we.id(Mt[Oe]);N.optional(function(){$r.shader($p[Oe],kt,N.guessCommand())});var Ut=go(function(){return kt});return Ut.id=kt,Ut}else if(Oe in Yt){var Mr=Yt[Oe];return hu(Mr,function(ln,cn){var Sn=ln.invoke(cn,Mr),rn=cn.def(ln.shared.strings,".id(",Sn,")");return N.optional(function(){cn(ln.shared.shader,".shader(",$p[Oe],",",rn,",",ln.command,");")}),rn})}return null}var We=ut(Yc),xt=ut(_l),Ae=null,Je;return Mc(We)&&Mc(xt)?(Ae=$r.program(xt.id,We.id,null,tt),Je=go(function(Oe,kt){return Oe.link(Ae)})):Je=new Ta(We&&We.thisDep||xt&&xt.thisDep,We&&We.contextDep||xt&&xt.contextDep,We&&We.propDep||xt&&xt.propDep,function(Oe,kt){var Ut=Oe.shared.shader,Mr;We?Mr=We.append(Oe,kt):Mr=kt.def(Ut,".",Yc);var ln;xt?ln=xt.append(Oe,kt):ln=kt.def(Ut,".",_l);var cn=Ut+".program("+ln+","+Mr;return N.optional(function(){cn+=","+Oe.command}),kt.def(cn+")")}),{frag:We,vert:xt,progVar:Je,program:Ae}}function fo(Re,ve){var tt=Re.static,Mt=Re.dynamic,Yt={},ut=!1;function We(){if(Kc in tt){var Hn=tt[Kc];return Hn!==null&&Zr.getVAO(Hn)===null&&(Hn=Zr.createVAO(Hn)),ut=!0,Yt.vao=Hn,go(function(Zn){var Un=Zr.getVAO(Hn);return Un?Zn.link(Un):"null"})}else if(Kc in Mt){ut=!0;var kn=Mt[Kc];return hu(kn,function(Zn,Un){var Ln=Zn.invoke(Un,kn);return Un.def(Zn.shared.vao+".getVAO("+Ln+")")})}return null}var xt=We(),Ae=!1;function Je(){if(Us in tt){var Hn=tt[Us];if(Yt.elements=Hn,uh(Hn)){var kn=Yt.elements=Jt.create(Hn,!0);Hn=Jt.getElements(kn),Ae=!0}else Hn&&(Hn=Jt.getElements(Hn),Ae=!0,N.command(Hn,"invalid elements",ve.commandStr));var Zn=go(function(Ln,pi){if(Hn){var La=Ln.link(Hn);return Ln.ELEMENTS=La,La}return Ln.ELEMENTS=null,null});return Zn.value=Hn,Zn}else if(Us in Mt){Ae=!0;var Un=Mt[Us];return hu(Un,function(Ln,pi){var La=Ln.shared,ms=La.isBufferArgs,Ba=La.elements,_a=Ln.invoke(pi,Un),wl=pi.def("null"),Gs=pi.def(ms,"(",_a,")"),rl=Ln.cond(Gs).then(wl,"=",Ba,".createStream(",_a,");").else(wl,"=",Ba,".getElements(",_a,");");return N.optional(function(){Ln.assert(rl.else,"!"+_a+"||"+wl,"invalid elements")}),pi.entry(rl),pi.exit(Ln.cond(Gs).then(Ba,".destroyStream(",wl,");")),Ln.ELEMENTS=wl,wl})}else if(ut)return new Ta(xt.thisDep,xt.contextDep,xt.propDep,function(Ln,pi){return pi.def(Ln.shared.vao+".currentVAO?"+Ln.shared.elements+".getElements("+Ln.shared.vao+".currentVAO.elements):null")});return null}var Oe=Je();function kt(){if(Go in tt){var Hn=tt[Go];return Yt.primitive=Hn,N.commandParameter(Hn,Ar,"invalid primitve",ve.commandStr),go(function(Zn,Un){return Ar[Hn]})}else if(Go in Mt){var kn=Mt[Go];return hu(kn,function(Zn,Un){var Ln=Zn.constants.primTypes,pi=Zn.invoke(Un,kn);return N.optional(function(){Zn.assert(Un,pi+" in "+Ln,"invalid primitive, must be one of "+Object.keys(Ar))}),Un.def(Ln,"[",pi,"]")})}else{if(Ae)return Mc(Oe)?Oe.value?go(function(Zn,Un){return Un.def(Zn.ELEMENTS,".primType")}):go(function(){return tl}):new Ta(Oe.thisDep,Oe.contextDep,Oe.propDep,function(Zn,Un){var Ln=Zn.ELEMENTS;return Un.def(Ln,"?",Ln,".primType:",tl)});if(ut)return new Ta(xt.thisDep,xt.contextDep,xt.propDep,function(Zn,Un){return Un.def(Zn.shared.vao+".currentVAO?"+Zn.shared.vao+".currentVAO.primitive:"+tl)})}return null}function Ut(Hn,kn){if(Hn in tt){var Zn=tt[Hn]|0;return kn?Yt.offset=Zn:Yt.instances=Zn,N.command(!kn||Zn>=0,"invalid "+Hn,ve.commandStr),go(function(Ln,pi){return kn&&(Ln.OFFSET=Zn),Zn})}else if(Hn in Mt){var Un=Mt[Hn];return hu(Un,function(Ln,pi){var La=Ln.invoke(pi,Un);return kn&&(Ln.OFFSET=La,N.optional(function(){Ln.assert(pi,La+">=0","invalid "+Hn)})),La})}else if(kn){if(Ae)return go(function(Ln,pi){return Ln.OFFSET=0,0});if(ut)return new Ta(xt.thisDep,xt.contextDep,xt.propDep,function(Ln,pi){return pi.def(Ln.shared.vao+".currentVAO?"+Ln.shared.vao+".currentVAO.offset:0")})}else if(ut)return new Ta(xt.thisDep,xt.contextDep,xt.propDep,function(Ln,pi){return pi.def(Ln.shared.vao+".currentVAO?"+Ln.shared.vao+".currentVAO.instances:-1")});return null}var Mr=Ut(th,!0);function ln(){if(qc in tt){var Hn=tt[qc]|0;return Yt.count=Hn,N.command(typeof Hn=="number"&&Hn>=0,"invalid vertex count",ve.commandStr),go(function(){return Hn})}else if(qc in Mt){var kn=Mt[qc];return hu(kn,function(pi,La){var ms=pi.invoke(La,kn);return N.optional(function(){pi.assert(La,"typeof "+ms+'==="number"&&'+ms+">=0&&"+ms+"===("+ms+"|0)","invalid vertex count")}),ms})}else if(Ae)if(Mc(Oe)){if(Oe)return Mr?new Ta(Mr.thisDep,Mr.contextDep,Mr.propDep,function(pi,La){var ms=La.def(pi.ELEMENTS,".vertCount-",pi.OFFSET);return N.optional(function(){pi.assert(La,ms+">=0","invalid vertex offset/element buffer too small")}),ms}):go(function(pi,La){return La.def(pi.ELEMENTS,".vertCount")});var Zn=go(function(){return-1});return N.optional(function(){Zn.MISSING=!0}),Zn}else{var Un=new Ta(Oe.thisDep||Mr.thisDep,Oe.contextDep||Mr.contextDep,Oe.propDep||Mr.propDep,function(pi,La){var ms=pi.ELEMENTS;return pi.OFFSET?La.def(ms,"?",ms,".vertCount-",pi.OFFSET,":-1"):La.def(ms,"?",ms,".vertCount:-1")});return N.optional(function(){Un.DYNAMIC=!0}),Un}else if(ut){var Ln=new Ta(xt.thisDep,xt.contextDep,xt.propDep,function(pi,La){return La.def(pi.shared.vao,".currentVAO?",pi.shared.vao,".currentVAO.count:-1")});return Ln}return null}var cn=kt(),Sn=ln(),rn=Ut(Ah,!1);return{elements:Oe,primitive:cn,count:Sn,instances:rn,offset:Mr,vao:xt,vaoActive:ut,elementsActive:Ae,static:Yt}}function Ao(Re,ve){var tt=Re.static,Mt=Re.dynamic,Yt={};return ai.forEach(function(ut){var We=Gn(ut);function xt(Ae,Je){if(ut in tt){var Oe=Ae(tt[ut]);Yt[We]=go(function(){return Oe})}else if(ut in Mt){var kt=Mt[ut];Yt[We]=hu(kt,function(Ut,Mr){return Je(Ut,Mr,Ut.invoke(Mr,kt))})}}switch(ut){case Sc:case Ls:case io:case pa:case be:case Xc:case Tu:case _u:case Qu:case Ec:return xt(function(Ae){return N.commandType(Ae,"boolean",ut,ve.commandStr),Ae},function(Ae,Je,Oe){return N.optional(function(){Ae.assert(Je,"typeof "+Oe+'==="boolean"',"invalid flag "+ut,Ae.commandStr)}),Oe});case ws:return xt(function(Ae){return N.commandParameter(Ae,Tc,"invalid "+ut,ve.commandStr),Tc[Ae]},function(Ae,Je,Oe){var kt=Ae.constants.compareFuncs;return N.optional(function(){Ae.assert(Je,Oe+" in "+kt,"invalid "+ut+", must be one of "+Object.keys(Tc))}),Je.def(kt,"[",Oe,"]")});case yu:return xt(function(Ae){return N.command(Eo(Ae)&&Ae.length===2&&typeof Ae[0]=="number"&&typeof Ae[1]=="number"&&Ae[0]<=Ae[1],"depth range is 2d array",ve.commandStr),Ae},function(Ae,Je,Oe){N.optional(function(){Ae.assert(Je,Ae.shared.isArrayLike+"("+Oe+")&&"+Oe+".length===2&&typeof "+Oe+'[0]==="number"&&typeof '+Oe+'[1]==="number"&&'+Oe+"[0]<="+Oe+"[1]","depth range must be a 2d array")});var kt=Je.def("+",Oe,"[0]"),Ut=Je.def("+",Oe,"[1]");return[kt,Ut]});case Ss:return xt(function(Ae){N.commandType(Ae,"object","blend.func",ve.commandStr);var Je="srcRGB"in Ae?Ae.srcRGB:Ae.src,Oe="srcAlpha"in Ae?Ae.srcAlpha:Ae.src,kt="dstRGB"in Ae?Ae.dstRGB:Ae.dst,Ut="dstAlpha"in Ae?Ae.dstAlpha:Ae.dst;return N.commandParameter(Je,El,We+".srcRGB",ve.commandStr),N.commandParameter(Oe,El,We+".srcAlpha",ve.commandStr),N.commandParameter(kt,El,We+".dstRGB",ve.commandStr),N.commandParameter(Ut,El,We+".dstAlpha",ve.commandStr),N.command(Of.indexOf(Je+", "+kt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Je+", "+kt+")",ve.commandStr),[El[Je],El[kt],El[Oe],El[Ut]]},function(Ae,Je,Oe){var kt=Ae.constants.blendFuncs;N.optional(function(){Ae.assert(Je,Oe+"&&typeof "+Oe+'==="object"',"invalid blend func, must be an object")});function Ut(kn,Zn){var Un=Je.def('"',kn,Zn,'" in ',Oe,"?",Oe,".",kn,Zn,":",Oe,".",kn);return N.optional(function(){Ae.assert(Je,Un+" in "+kt,"invalid "+ut+"."+kn+Zn+", must be one of "+Object.keys(El))}),Un}var Mr=Ut("src","RGB"),ln=Ut("dst","RGB");N.optional(function(){var kn=Ae.constants.invalidBlendCombinations;Ae.assert(Je,kn+".indexOf("+Mr+'+", "+'+ln+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var cn=Je.def(kt,"[",Mr,"]"),Sn=Je.def(kt,"[",Ut("src","Alpha"),"]"),rn=Je.def(kt,"[",ln,"]"),Hn=Je.def(kt,"[",Ut("dst","Alpha"),"]");return[cn,rn,Sn,Hn]});case Wt:return xt(function(Ae){if(typeof Ae=="string")return N.commandParameter(Ae,ar,"invalid "+ut,ve.commandStr),[ar[Ae],ar[Ae]];if(typeof Ae=="object")return N.commandParameter(Ae.rgb,ar,ut+".rgb",ve.commandStr),N.commandParameter(Ae.alpha,ar,ut+".alpha",ve.commandStr),[ar[Ae.rgb],ar[Ae.alpha]];N.commandRaise("invalid blend.equation",ve.commandStr)},function(Ae,Je,Oe){var kt=Ae.constants.blendEquations,Ut=Je.def(),Mr=Je.def(),ln=Ae.cond("typeof ",Oe,'==="string"');return N.optional(function(){function cn(Sn,rn,Hn){Ae.assert(Sn,Hn+" in "+kt,"invalid "+rn+", must be one of "+Object.keys(ar))}cn(ln.then,ut,Oe),Ae.assert(ln.else,Oe+"&&typeof "+Oe+'==="object"',"invalid "+ut),cn(ln.else,ut+".rgb",Oe+".rgb"),cn(ln.else,ut+".alpha",Oe+".alpha")}),ln.then(Ut,"=",Mr,"=",kt,"[",Oe,"];"),ln.else(Ut,"=",kt,"[",Oe,".rgb];",Mr,"=",kt,"[",Oe,".alpha];"),Je(ln),[Ut,Mr]});case Hi:return xt(function(Ae){return N.command(Eo(Ae)&&Ae.length===4,"blend.color must be a 4d array",ve.commandStr),et(4,function(Je){return+Ae[Je]})},function(Ae,Je,Oe){return N.optional(function(){Ae.assert(Je,Ae.shared.isArrayLike+"("+Oe+")&&"+Oe+".length===4","blend.color must be a 4d array")}),et(4,function(kt){return Je.def("+",Oe,"[",kt,"]")})});case Qs:return xt(function(Ae){return N.commandType(Ae,"number",We,ve.commandStr),Ae|0},function(Ae,Je,Oe){return N.optional(function(){Ae.assert(Je,"typeof "+Oe+'==="number"',"invalid stencil.mask")}),Je.def(Oe,"|0")});case as:return xt(function(Ae){N.commandType(Ae,"object",We,ve.commandStr);var Je=Ae.cmp||"keep",Oe=Ae.ref||0,kt="mask"in Ae?Ae.mask:-1;return N.commandParameter(Je,Tc,ut+".cmp",ve.commandStr),N.commandType(Oe,"number",ut+".ref",ve.commandStr),N.commandType(kt,"number",ut+".mask",ve.commandStr),[Tc[Je],Oe,kt]},function(Ae,Je,Oe){var kt=Ae.constants.compareFuncs;N.optional(function(){function cn(){Ae.assert(Je,Array.prototype.join.call(arguments,""),"invalid stencil.func")}cn(Oe+"&&typeof ",Oe,'==="object"'),cn('!("cmp" in ',Oe,")||(",Oe,".cmp in ",kt,")")});var Ut=Je.def('"cmp" in ',Oe,"?",kt,"[",Oe,".cmp]",":",Js),Mr=Je.def(Oe,".ref|0"),ln=Je.def('"mask" in ',Oe,"?",Oe,".mask|0:-1");return[Ut,Mr,ln]});case Zu:case Xl:return xt(function(Ae){N.commandType(Ae,"object",We,ve.commandStr);var Je=Ae.fail||"keep",Oe=Ae.zfail||"keep",kt=Ae.zpass||"keep";return N.commandParameter(Je,Jl,ut+".fail",ve.commandStr),N.commandParameter(Oe,Jl,ut+".zfail",ve.commandStr),N.commandParameter(kt,Jl,ut+".zpass",ve.commandStr),[ut===Xl?ql:fu,Jl[Je],Jl[Oe],Jl[kt]]},function(Ae,Je,Oe){var kt=Ae.constants.stencilOps;N.optional(function(){Ae.assert(Je,Oe+"&&typeof "+Oe+'==="object"',"invalid "+ut)});function Ut(Mr){return N.optional(function(){Ae.assert(Je,'!("'+Mr+'" in '+Oe+")||("+Oe+"."+Mr+" in "+kt+")","invalid "+ut+"."+Mr+", must be one of "+Object.keys(Jl))}),Je.def('"',Mr,'" in ',Oe,"?",kt,"[",Oe,".",Mr,"]:",Js)}return[ut===Xl?ql:fu,Ut("fail"),Ut("zfail"),Ut("zpass")]});case Do:return xt(function(Ae){N.commandType(Ae,"object",We,ve.commandStr);var Je=Ae.factor|0,Oe=Ae.units|0;return N.commandType(Je,"number",We+".factor",ve.commandStr),N.commandType(Oe,"number",We+".units",ve.commandStr),[Je,Oe]},function(Ae,Je,Oe){N.optional(function(){Ae.assert(Je,Oe+"&&typeof "+Oe+'==="object"',"invalid "+ut)});var kt=Je.def(Oe,".factor|0"),Ut=Je.def(Oe,".units|0");return[kt,Ut]});case Wc:return xt(function(Ae){var Je=0;return Ae==="front"?Je=fu:Ae==="back"&&(Je=ql),N.command(!!Je,We,ve.commandStr),Je},function(Ae,Je,Oe){return N.optional(function(){Ae.assert(Je,Oe+'==="front"||'+Oe+'==="back"',"invalid cull.face")}),Je.def(Oe,'==="front"?',fu,":",ql)});case Wl:return xt(function(Ae){return N.command(typeof Ae=="number"&&Ae>=rr.lineWidthDims[0]&&Ae<=rr.lineWidthDims[1],"invalid line width, must be a positive number between "+rr.lineWidthDims[0]+" and "+rr.lineWidthDims[1],ve.commandStr),Ae},function(Ae,Je,Oe){return N.optional(function(){Ae.assert(Je,"typeof "+Oe+'==="number"&&'+Oe+">="+rr.lineWidthDims[0]+"&&"+Oe+"<="+rr.lineWidthDims[1],"invalid line width")}),Oe});case Au:return xt(function(Ae){return N.commandParameter(Ae,sh,We,ve.commandStr),sh[Ae]},function(Ae,Je,Oe){return N.optional(function(){Ae.assert(Je,Oe+'==="cw"||'+Oe+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Je.def(Oe+'==="cw"?'+Kl+":"+Ql)});case Ku:return xt(function(Ae){return N.command(Eo(Ae)&&Ae.length===4,"color.mask must be length 4 array",ve.commandStr),Ae.map(function(Je){return!!Je})},function(Ae,Je,Oe){return N.optional(function(){Ae.assert(Je,Ae.shared.isArrayLike+"("+Oe+")&&"+Oe+".length===4","invalid color.mask")}),et(4,function(kt){return"!!"+Oe+"["+kt+"]"})});case Ju:return xt(function(Ae){N.command(typeof Ae=="object"&&Ae,We,ve.commandStr);var Je="value"in Ae?Ae.value:1,Oe=!!Ae.invert;return N.command(typeof Je=="number"&&Je>=0&&Je<=1,"sample.coverage.value must be a number between 0 and 1",ve.commandStr),[Je,Oe]},function(Ae,Je,Oe){N.optional(function(){Ae.assert(Je,Oe+"&&typeof "+Oe+'==="object"',"invalid sample.coverage")});var kt=Je.def('"value" in ',Oe,"?+",Oe,".value:1"),Ut=Je.def("!!",Oe,".invert");return[kt,Ut]})}}),Yt}function Yi(Re,ve){var tt=Re.static,Mt=Re.dynamic,Yt={};return Object.keys(tt).forEach(function(ut){var We=tt[ut],xt;if(typeof We=="number"||typeof We=="boolean")xt=go(function(){return We});else if(typeof We=="function"){var Ae=We._reglType;Ae==="texture2d"||Ae==="textureCube"?xt=go(function(Je){return Je.link(We)}):Ae==="framebuffer"||Ae==="framebufferCube"?(N.command(We.color.length>0,'missing color attachment for framebuffer sent to uniform "'+ut+'"',ve.commandStr),xt=go(function(Je){return Je.link(We.color[0])})):N.commandRaise('invalid data for uniform "'+ut+'"',ve.commandStr)}else Eo(We)?xt=go(function(Je){var Oe=Je.global.def("[",et(We.length,function(kt){return N.command(typeof We[kt]=="number"||typeof We[kt]=="boolean","invalid uniform "+ut,Je.commandStr),We[kt]}),"]");return Oe}):N.commandRaise('invalid or missing data for uniform "'+ut+'"',ve.commandStr);xt.value=We,Yt[ut]=xt}),Object.keys(Mt).forEach(function(ut){var We=Mt[ut];Yt[ut]=hu(We,function(xt,Ae){return xt.invoke(Ae,We)})}),Yt}function os(Re,ve){var tt=Re.static,Mt=Re.dynamic,Yt={};return Object.keys(tt).forEach(function(ut){var We=tt[ut],xt=we.id(ut),Ae=new Tt;if(uh(We))Ae.state=Jn,Ae.buffer=wr.getBuffer(wr.create(We,nh,!1,!0)),Ae.type=0;else{var Je=wr.getBuffer(We);if(Je)Ae.state=Jn,Ae.buffer=Je,Ae.type=0;else if(N.command(typeof We=="object"&&We,"invalid data for attribute "+ut,ve.commandStr),"constant"in We){var Oe=We.constant;Ae.buffer="null",Ae.state=Ti,typeof Oe=="number"?Ae.x=Oe:(N.command(Eo(Oe)&&Oe.length>0&&Oe.length<=4,"invalid constant for attribute "+ut,ve.commandStr),En.forEach(function(rn,Hn){Hn<Oe.length&&(Ae[rn]=Oe[Hn])}))}else{uh(We.buffer)?Je=wr.getBuffer(wr.create(We.buffer,nh,!1,!0)):Je=wr.getBuffer(We.buffer),N.command(!!Je,'missing buffer for attribute "'+ut+'"',ve.commandStr);var kt=We.offset|0;N.command(kt>=0,'invalid offset for attribute "'+ut+'"',ve.commandStr);var Ut=We.stride|0;N.command(Ut>=0&&Ut<256,'invalid stride for attribute "'+ut+'", must be integer betweeen [0, 255]',ve.commandStr);var Mr=We.size|0;N.command(!("size"in We)||Mr>0&&Mr<=4,'invalid size for attribute "'+ut+'", must be 1,2,3,4',ve.commandStr);var ln=!!We.normalized,cn=0;"type"in We&&(N.commandParameter(We.type,ru,"invalid type for attribute "+ut,ve.commandStr),cn=ru[We.type]);var Sn=We.divisor|0;N.optional(function(){"divisor"in We&&(N.command(Sn===0||Vr,'cannot specify divisor for attribute "'+ut+'", instancing not supported',ve.commandStr),N.command(Sn>=0,'invalid divisor for attribute "'+ut+'"',ve.commandStr));var rn=ve.commandStr,Hn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(We).forEach(function(kn){N.command(Hn.indexOf(kn)>=0,'unknown parameter "'+kn+'" for attribute pointer "'+ut+'" (valid parameters are '+Hn+")",rn)})}),Ae.buffer=Je,Ae.state=Jn,Ae.size=Mr,Ae.normalized=ln,Ae.type=cn||Je.dtype,Ae.offset=kt,Ae.stride=Ut,Ae.divisor=Sn}}Yt[ut]=go(function(rn,Hn){var kn=rn.attribCache;if(xt in kn)return kn[xt];var Zn={isStream:!1};return Object.keys(Ae).forEach(function(Un){Zn[Un]=Ae[Un]}),Ae.buffer&&(Zn.buffer=rn.link(Ae.buffer),Zn.type=Zn.type||Zn.buffer+".dtype"),kn[xt]=Zn,Zn})}),Object.keys(Mt).forEach(function(ut){var We=Mt[ut];function xt(Ae,Je){var Oe=Ae.invoke(Je,We),kt=Ae.shared,Ut=Ae.constants,Mr=kt.isBufferArgs,ln=kt.buffer;N.optional(function(){Ae.assert(Je,Oe+"&&(typeof "+Oe+'==="object"||typeof '+Oe+'==="function")&&('+Mr+"("+Oe+")||"+ln+".getBuffer("+Oe+")||"+ln+".getBuffer("+Oe+".buffer)||"+Mr+"("+Oe+'.buffer)||("constant" in '+Oe+"&&(typeof "+Oe+'.constant==="number"||'+kt.isArrayLike+"("+Oe+".constant))))",'invalid dynamic attribute "'+ut+'"')});var cn={isStream:Je.def(!1)},Sn=new Tt;Sn.state=Jn,Object.keys(Sn).forEach(function(Zn){cn[Zn]=Je.def(""+Sn[Zn])});var rn=cn.buffer,Hn=cn.type;Je("if(",Mr,"(",Oe,")){",cn.isStream,"=true;",rn,"=",ln,".createStream(",nh,",",Oe,");",Hn,"=",rn,".dtype;","}else{",rn,"=",ln,".getBuffer(",Oe,");","if(",rn,"){",Hn,"=",rn,".dtype;",'}else if("constant" in ',Oe,"){",cn.state,"=",Ti,";","if(typeof "+Oe+'.constant === "number"){',cn[En[0]],"=",Oe,".constant;",En.slice(1).map(function(Zn){return cn[Zn]}).join("="),"=0;","}else{",En.map(function(Zn,Un){return cn[Zn]+"="+Oe+".constant.length>"+Un+"?"+Oe+".constant["+Un+"]:0;"}).join(""),"}}else{","if(",Mr,"(",Oe,".buffer)){",rn,"=",ln,".createStream(",nh,",",Oe,".buffer);","}else{",rn,"=",ln,".getBuffer(",Oe,".buffer);","}",Hn,'="type" in ',Oe,"?",Ut.glTypes,"[",Oe,".type]:",rn,".dtype;",cn.normalized,"=!!",Oe,".normalized;");function kn(Zn){Je(cn[Zn],"=",Oe,".",Zn,"|0;")}return kn("size"),kn("offset"),kn("stride"),kn("divisor"),Je("}}"),Je.exit("if(",cn.isStream,"){",ln,".destroyStream(",rn,");","}"),cn}Yt[ut]=hu(We,xt)}),Yt}function ao(Re){var ve=Re.static,tt=Re.dynamic,Mt={};return Object.keys(ve).forEach(function(Yt){var ut=ve[Yt];Mt[Yt]=go(function(We,xt){return typeof ut=="number"||typeof ut=="boolean"?""+ut:We.link(ut)})}),Object.keys(tt).forEach(function(Yt){var ut=tt[Yt];Mt[Yt]=hu(ut,function(We,xt){return We.invoke(xt,ut)})}),Mt}function ss(Re,ve,tt,Mt,Yt){var ut=Re.static,We=Re.dynamic;N.optional(function(){var kn=[cu,_l,Yc,Us,Go,th,qc,Ah,$l,Kc].concat(ai);function Zn(Un){Object.keys(Un).forEach(function(Ln){N.command(kn.indexOf(Ln)>=0,'unknown parameter "'+Ln+'"',Yt.commandStr)})}Zn(ut),Zn(We)});var xt=Mi(Re,ve),Ae=Tn(Re,Yt),Je=hi(Re,Ae,Yt),Oe=fo(Re,Yt),kt=Ao(Re,Yt),Ut=$i(Re,Yt,xt);function Mr(kn){var Zn=Je[kn];Zn&&(kt[kn]=Zn)}Mr(Os),Mr(Gn($c));var ln=Object.keys(kt).length>0,cn={framebuffer:Ae,draw:Oe,shader:Ut,state:kt,dirty:ln,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(cn.profile=pn(Re,Yt),cn.uniforms=Yi(tt,Yt),cn.drawVAO=cn.scopeVAO=Oe.vao,!cn.drawVAO&&Ut.program&&!xt&&$e.angle_instanced_arrays&&Oe.static.elements){var Sn=!0,rn=Ut.program.attributes.map(function(kn){var Zn=ve.static[kn];return Sn=Sn&&!!Zn,Zn});if(Sn&&rn.length>0){var Hn=Zr.getVAO(Zr.createVAO({attributes:rn,elements:Oe.static.elements}));cn.drawVAO=new Ta(null,null,null,function(kn,Zn){return kn.link(Hn)}),cn.useVAO=!0}}return xt?cn.useVAO=!0:cn.attributes=os(ve,Yt),cn.context=ao(Mt,Yt),cn}function Ho(Re,ve,tt){var Mt=Re.shared,Yt=Mt.context,ut=Re.scope();Object.keys(tt).forEach(function(We){ve.save(Yt,"."+We);var xt=tt[We],Ae=xt.append(Re,ve);Array.isArray(Ae)?ut(Yt,".",We,"=[",Ae.join(),"];"):ut(Yt,".",We,"=",Ae,";")}),ve(ut)}function us(Re,ve,tt,Mt){var Yt=Re.shared,ut=Yt.gl,We=Yt.framebuffer,xt;un&&(xt=ve.def(Yt.extensions,".webgl_draw_buffers"));var Ae=Re.constants,Je=Ae.drawBuffer,Oe=Ae.backBuffer,kt;tt?kt=tt.append(Re,ve):kt=ve.def(We,".next"),Mt||ve("if(",kt,"!==",We,".cur){"),ve("if(",kt,"){",ut,".bindFramebuffer(",Fd,",",kt,".framebuffer);"),un&&ve(xt,".drawBuffersWEBGL(",Je,"[",kt,".colorAttachments.length]);"),ve("}else{",ut,".bindFramebuffer(",Fd,",null);"),un&&ve(xt,".drawBuffersWEBGL(",Oe,");"),ve("}",We,".cur=",kt,";"),Mt||ve("}")}function Qo(Re,ve,tt){var Mt=Re.shared,Yt=Mt.gl,ut=Re.current,We=Re.next,xt=Mt.current,Ae=Mt.next,Je=Re.cond(xt,".dirty");ai.forEach(function(Oe){var kt=Gn(Oe);if(!(kt in tt.state)){var Ut,Mr;if(kt in We){Ut=We[kt],Mr=ut[kt];var ln=et(Jr[kt].length,function(Sn){return Je.def(Ut,"[",Sn,"]")});Je(Re.cond(ln.map(function(Sn,rn){return Sn+"!=="+Mr+"["+rn+"]"}).join("||")).then(Yt,".",Sr[kt],"(",ln,");",ln.map(function(Sn,rn){return Mr+"["+rn+"]="+Sn}).join(";"),";"))}else{Ut=Je.def(Ae,".",kt);var cn=Re.cond(Ut,"!==",xt,".",kt);Je(cn),kt in _r?cn(Re.cond(Ut).then(Yt,".enable(",_r[kt],");").else(Yt,".disable(",_r[kt],");"),xt,".",kt,"=",Ut,";"):cn(Yt,".",Sr[kt],"(",Ut,");",xt,".",kt,"=",Ut,";")}}}),Object.keys(tt.state).length===0&&Je(xt,".dirty=false;"),ve(Je)}function ds(Re,ve,tt,Mt){var Yt=Re.shared,ut=Re.current,We=Yt.current,xt=Yt.gl;cp(Object.keys(tt)).forEach(function(Ae){var Je=tt[Ae];if(!(Mt&&!Mt(Je))){var Oe=Je.append(Re,ve);if(_r[Ae]){var kt=_r[Ae];Mc(Je)?Oe?ve(xt,".enable(",kt,");"):ve(xt,".disable(",kt,");"):ve(Re.cond(Oe).then(xt,".enable(",kt,");").else(xt,".disable(",kt,");")),ve(We,".",Ae,"=",Oe,";")}else if(Eo(Oe)){var Ut=ut[Ae];ve(xt,".",Sr[Ae],"(",Oe,");",Oe.map(function(Mr,ln){return Ut+"["+ln+"]="+Mr}).join(";"),";")}else ve(xt,".",Sr[Ae],"(",Oe,");",We,".",Ae,"=",Oe,";")}})}function To(Re,ve){Vr&&(Re.instancing=ve.def(Re.shared.extensions,".angle_instanced_arrays"))}function Li(Re,ve,tt,Mt,Yt){var ut=Re.shared,We=Re.stats,xt=ut.current,Ae=ut.timer,Je=tt.profile;function Oe(){var kn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return kn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var kt,Ut;function Mr(kn){kt=ve.def(),kn(kt,"=",Oe(),";"),typeof Yt=="string"?kn(We,".count+=",Yt,";"):kn(We,".count++;"),Ur&&(Mt?(Ut=ve.def(),kn(Ut,"=",Ae,".getNumPendingQueries();")):kn(Ae,".beginQuery(",We,");"))}function ln(kn){kn(We,".cpuTime+=",Oe(),"-",kt,";"),Ur&&(Mt?kn(Ae,".pushScopeStats(",Ut,",",Ae,".getNumPendingQueries(),",We,");"):kn(Ae,".endQuery();"))}function cn(kn){var Zn=ve.def(xt,".profile");ve(xt,".profile=",kn,";"),ve.exit(xt,".profile=",Zn,";")}var Sn;if(Je){if(Mc(Je)){Je.enable?(Mr(ve),ln(ve.exit),cn("true")):cn("false");return}Sn=Je.append(Re,ve),cn(Sn)}else Sn=ve.def(xt,".profile");var rn=Re.block();Mr(rn),ve("if(",Sn,"){",rn,"}");var Hn=Re.block();ln(Hn),ve.exit("if(",Sn,"){",Hn,"}")}function Wo(Re,ve,tt,Mt,Yt){var ut=Re.shared;function We(Ae){switch(Ae){case oh:case lp:case Rf:return 2;case Cc:case xl:case Lf:return 3;case If:case Pf:case Vs:return 4;default:return 1}}function xt(Ae,Je,Oe){var kt=ut.gl,Ut=ve.def(Ae,".location"),Mr=ve.def(ut.attributes,"[",Ut,"]"),ln=Oe.state,cn=Oe.buffer,Sn=[Oe.x,Oe.y,Oe.z,Oe.w],rn=["buffer","normalized","offset","stride"];function Hn(){ve("if(!",Mr,".buffer){",kt,".enableVertexAttribArray(",Ut,");}");var Zn=Oe.type,Un;if(Oe.size?Un=ve.def(Oe.size,"||",Je):Un=Je,ve("if(",Mr,".type!==",Zn,"||",Mr,".size!==",Un,"||",rn.map(function(pi){return Mr+"."+pi+"!=="+Oe[pi]}).join("||"),"){",kt,".bindBuffer(",nh,",",cn,".buffer);",kt,".vertexAttribPointer(",[Ut,Un,Zn,Oe.normalized,Oe.stride,Oe.offset],");",Mr,".type=",Zn,";",Mr,".size=",Un,";",rn.map(function(pi){return Mr+"."+pi+"="+Oe[pi]+";"}).join(""),"}"),Vr){var Ln=Oe.divisor;ve("if(",Mr,".divisor!==",Ln,"){",Re.instancing,".vertexAttribDivisorANGLE(",[Ut,Ln],");",Mr,".divisor=",Ln,";}")}}function kn(){ve("if(",Mr,".buffer){",kt,".disableVertexAttribArray(",Ut,");",Mr,".buffer=null;","}if(",En.map(function(Zn,Un){return Mr+"."+Zn+"!=="+Sn[Un]}).join("||"),"){",kt,".vertexAttrib4f(",Ut,",",Sn,");",En.map(function(Zn,Un){return Mr+"."+Zn+"="+Sn[Un]+";"}).join(""),"}")}ln===Jn?Hn():ln===Ti?kn():(ve("if(",ln,"===",Jn,"){"),Hn(),ve("}else{"),kn(),ve("}"))}Mt.forEach(function(Ae){var Je=Ae.name,Oe=tt.attributes[Je],kt;if(Oe){if(!Yt(Oe))return;kt=Oe.append(Re,ve)}else{if(!Yt(Yp))return;var Ut=Re.scopeAttrib(Je);N.optional(function(){Re.assert(ve,Ut+".state","missing attribute "+Je)}),kt={},Object.keys(new Tt).forEach(function(Mr){kt[Mr]=ve.def(Ut,".",Mr)})}xt(Re.link(Ae),We(Ae.info.type),kt)})}function da(Re,ve,tt,Mt,Yt,ut){for(var We=Re.shared,xt=We.gl,Ae,Je=0;Je<Mt.length;++Je){var Oe=Mt[Je],kt=Oe.name,Ut=Oe.info.type,Mr=tt.uniforms[kt],ln=Re.link(Oe),cn=ln+".location",Sn;if(Mr){if(!Yt(Mr))continue;if(Mc(Mr)){var rn=Mr.value;if(N.command(rn!==null&&typeof rn!="undefined",'missing uniform "'+kt+'"',Re.commandStr),Ut===Ph||Ut===No){N.command(typeof rn=="function"&&(Ut===Ph&&(rn._reglType==="texture2d"||rn._reglType==="framebuffer")||Ut===No&&(rn._reglType==="textureCube"||rn._reglType==="framebufferCube")),"invalid texture for uniform "+kt,Re.commandStr);var Hn=Re.link(rn._texture||rn.color[0]._texture);ve(xt,".uniform1i(",cn,",",Hn+".bind());"),ve.exit(Hn,".unbind();")}else if(Ut===W||Ut===Xr||Ut===Ac){N.optional(function(){N.command(Eo(rn),"invalid matrix for uniform "+kt,Re.commandStr),N.command(Ut===W&&rn.length===4||Ut===Xr&&rn.length===9||Ut===Ac&&rn.length===16,"invalid length for matrix uniform "+kt,Re.commandStr)});var kn=Re.global.def("new Float32Array(["+Array.prototype.slice.call(rn)+"])"),Zn=2;Ut===Xr?Zn=3:Ut===Ac&&(Zn=4),ve(xt,".uniformMatrix",Zn,"fv(",cn,",false,",kn,");")}else{switch(Ut){case up:N.commandType(rn,"number","uniform "+kt,Re.commandStr),Ae="1f";break;case oh:N.command(Eo(rn)&&rn.length===2,"uniform "+kt,Re.commandStr),Ae="2f";break;case Cc:N.command(Eo(rn)&&rn.length===3,"uniform "+kt,Re.commandStr),Ae="3f";break;case If:N.command(Eo(rn)&&rn.length===4,"uniform "+kt,Re.commandStr),Ae="4f";break;case ef:N.commandType(rn,"boolean","uniform "+kt,Re.commandStr),Ae="1i";break;case Ih:N.commandType(rn,"number","uniform "+kt,Re.commandStr),Ae="1i";break;case Rf:N.command(Eo(rn)&&rn.length===2,"uniform "+kt,Re.commandStr),Ae="2i";break;case lp:N.command(Eo(rn)&&rn.length===2,"uniform "+kt,Re.commandStr),Ae="2i";break;case Lf:N.command(Eo(rn)&&rn.length===3,"uniform "+kt,Re.commandStr),Ae="3i";break;case xl:N.command(Eo(rn)&&rn.length===3,"uniform "+kt,Re.commandStr),Ae="3i";break;case Vs:N.command(Eo(rn)&&rn.length===4,"uniform "+kt,Re.commandStr),Ae="4i";break;case Pf:N.command(Eo(rn)&&rn.length===4,"uniform "+kt,Re.commandStr),Ae="4i";break}ve(xt,".uniform",Ae,"(",cn,",",Eo(rn)?Array.prototype.slice.call(rn):rn,");")}continue}else Sn=Mr.append(Re,ve)}else{if(!Yt(Yp))continue;Sn=ve.def(We.uniforms,"[",we.id(kt),"]")}Ut===Ph?(N(!Array.isArray(Sn),"must specify a scalar prop for textures"),ve("if(",Sn,"&&",Sn,'._reglType==="framebuffer"){',Sn,"=",Sn,".color[0];","}")):Ut===No&&(N(!Array.isArray(Sn),"must specify a scalar prop for cube maps"),ve("if(",Sn,"&&",Sn,'._reglType==="framebufferCube"){',Sn,"=",Sn,".color[0];","}")),N.optional(function(){function Gs(ku,kc){Re.assert(ve,ku,'bad data or missing for uniform "'+kt+'".  '+kc)}function rl(ku){N(!Array.isArray(Sn),"must not specify an array type for uniform"),Gs("typeof "+Sn+'==="'+ku+'"',"invalid type, expected "+ku)}function Mu(ku,kc){Array.isArray(Sn)?N(Sn.length===ku,"must have length "+ku):Gs(We.isArrayLike+"("+Sn+")&&"+Sn+".length==="+ku,"invalid vector, should have length "+ku,Re.commandStr)}function pp(ku){N(!Array.isArray(Sn),"must not specify a value type"),Gs("typeof "+Sn+'==="function"&&'+Sn+'._reglType==="texture'+(ku===Wp?"2d":"Cube")+'"',"invalid texture type",Re.commandStr)}switch(Ut){case Ih:rl("number");break;case lp:Mu(2,"number");break;case xl:Mu(3,"number");break;case Pf:Mu(4,"number");break;case up:rl("number");break;case oh:Mu(2,"number");break;case Cc:Mu(3,"number");break;case If:Mu(4,"number");break;case ef:rl("boolean");break;case Rf:Mu(2,"boolean");break;case Lf:Mu(3,"boolean");break;case Vs:Mu(4,"boolean");break;case W:Mu(4,"number");break;case Xr:Mu(9,"number");break;case Ac:Mu(16,"number");break;case Ph:pp(Wp);break;case No:pp(sp);break}});var Un=1;switch(Ut){case Ph:case No:var Ln=ve.def(Sn,"._texture");ve(xt,".uniform1i(",cn,",",Ln,".bind());"),ve.exit(Ln,".unbind();");continue;case Ih:case ef:Ae="1i";break;case lp:case Rf:Ae="2i",Un=2;break;case xl:case Lf:Ae="3i",Un=3;break;case Pf:case Vs:Ae="4i",Un=4;break;case up:Ae="1f";break;case oh:Ae="2f",Un=2;break;case Cc:Ae="3f",Un=3;break;case If:Ae="4f",Un=4;break;case W:Ae="Matrix2fv";break;case Xr:Ae="Matrix3fv";break;case Ac:Ae="Matrix4fv";break}if(Ae.charAt(0)==="M"){ve(xt,".uniform",Ae,"(",cn,",");var pi=Math.pow(Ut-W+2,2),La=Re.global.def("new Float32Array(",pi,")");Array.isArray(Sn)?ve("false,(",et(pi,function(Gs){return La+"["+Gs+"]="+Sn[Gs]}),",",La,")"):ve("false,(Array.isArray(",Sn,")||",Sn," instanceof Float32Array)?",Sn,":(",et(pi,function(Gs){return La+"["+Gs+"]="+Sn+"["+Gs+"]"}),",",La,")"),ve(");")}else if(Un>1){for(var ms=[],Ba=[],_a=0;_a<Un;++_a)Array.isArray(Sn)?Ba.push(Sn[_a]):Ba.push(ve.def(Sn+"["+_a+"]")),ut&&ms.push(ve.def());ut&&ve("if(!",Re.batchId,"||",ms.map(function(Gs,rl){return Gs+"!=="+Ba[rl]}).join("||"),"){",ms.map(function(Gs,rl){return Gs+"="+Ba[rl]+";"}).join("")),ve(xt,".uniform",Ae,"(",cn,",",Ba.join(","),");"),ut&&ve("}")}else{if(N(!Array.isArray(Sn),"uniform value must not be an array"),ut){var wl=ve.def();ve("if(!",Re.batchId,"||",wl,"!==",Sn,"){",wl,"=",Sn,";")}ve(xt,".uniform",Ae,"(",cn,",",Sn,");"),ut&&ve("}")}}}function vs(Re,ve,tt,Mt){var Yt=Re.shared,ut=Yt.gl,We=Yt.draw,xt=Mt.draw;function Ae(){var Un=xt.elements,Ln,pi=ve;return Un?((Un.contextDep&&Mt.contextDynamic||Un.propDep)&&(pi=tt),Ln=Un.append(Re,pi),xt.elementsActive&&pi("if("+Ln+")"+ut+".bindBuffer("+op+","+Ln+".buffer.buffer);")):(Ln=pi.def(),pi(Ln,"=",We,".",Us,";","if(",Ln,"){",ut,".bindBuffer(",op,",",Ln,".buffer.buffer);}","else if(",Yt.vao,".currentVAO){",Ln,"=",Re.shared.elements+".getElements("+Yt.vao,".currentVAO.elements);",Er?"":"if("+Ln+")"+ut+".bindBuffer("+op+","+Ln+".buffer.buffer);","}")),Ln}function Je(){var Un=xt.count,Ln,pi=ve;return Un?((Un.contextDep&&Mt.contextDynamic||Un.propDep)&&(pi=tt),Ln=Un.append(Re,pi),N.optional(function(){Un.MISSING&&Re.assert(ve,"false","missing vertex count"),Un.DYNAMIC&&Re.assert(pi,Ln+">=0","missing vertex count")})):(Ln=pi.def(We,".",qc),N.optional(function(){Re.assert(pi,Ln+">=0","missing vertex count")})),Ln}var Oe=Ae();function kt(Un){var Ln=xt[Un];return Ln?Ln.contextDep&&Mt.contextDynamic||Ln.propDep?Ln.append(Re,tt):Ln.append(Re,ve):ve.def(We,".",Un)}var Ut=kt(Go),Mr=kt(th),ln=Je();if(typeof ln=="number"){if(ln===0)return}else tt("if(",ln,"){"),tt.exit("}");var cn,Sn;Vr&&(cn=kt(Ah),Sn=Re.instancing);var rn=Oe+".type",Hn=xt.elements&&Mc(xt.elements)&&!xt.vaoActive;function kn(){function Un(){tt(Sn,".drawElementsInstancedANGLE(",[Ut,ln,rn,Mr+"<<(("+rn+"-"+li+")>>1)",cn],");")}function Ln(){tt(Sn,".drawArraysInstancedANGLE(",[Ut,Mr,ln,cn],");")}Oe&&Oe!=="null"?Hn?Un():(tt("if(",Oe,"){"),Un(),tt("}else{"),Ln(),tt("}")):Ln()}function Zn(){function Un(){tt(ut+".drawElements("+[Ut,ln,rn,Mr+"<<(("+rn+"-"+li+")>>1)"]+");")}function Ln(){tt(ut+".drawArrays("+[Ut,Mr,ln]+");")}Oe&&Oe!=="null"?Hn?Un():(tt("if(",Oe,"){"),Un(),tt("}else{"),Ln(),tt("}")):Ln()}Vr&&(typeof cn!="number"||cn>=0)?typeof cn=="string"?(tt("if(",cn,">0){"),kn(),tt("}else if(",cn,"<0){"),Zn(),tt("}")):kn():Zn()}function xi(Re,ve,tt,Mt,Yt){var ut=Ei(),We=ut.proc("body",Yt);return N.optional(function(){ut.commandStr=ve.commandStr,ut.command=ut.link(ve.commandStr)}),Vr&&(ut.instancing=We.def(ut.shared.extensions,".angle_instanced_arrays")),Re(ut,We,tt,Mt),ut.compile().body}function qi(Re,ve,tt,Mt){To(Re,ve),tt.useVAO?tt.drawVAO?ve(Re.shared.vao,".setVAO(",tt.drawVAO.append(Re,ve),");"):ve(Re.shared.vao,".setVAO(",Re.shared.vao,".targetVAO);"):(ve(Re.shared.vao,".setVAO(null);"),Wo(Re,ve,tt,Mt.attributes,function(){return!0})),da(Re,ve,tt,Mt.uniforms,function(){return!0},!1),vs(Re,ve,ve,tt)}function Ca(Re,ve){var tt=Re.proc("draw",1);To(Re,tt),Ho(Re,tt,ve.context),us(Re,tt,ve.framebuffer),Qo(Re,tt,ve),ds(Re,tt,ve.state),Li(Re,tt,ve,!1,!0);var Mt=ve.shader.progVar.append(Re,tt);if(tt(Re.shared.gl,".useProgram(",Mt,".program);"),ve.shader.program)qi(Re,tt,ve,ve.shader.program);else{tt(Re.shared.vao,".setVAO(null);");var Yt=Re.global.def("{}"),ut=tt.def(Mt,".id"),We=tt.def(Yt,"[",ut,"]");tt(Re.cond(We).then(We,".call(this,a0);").else(We,"=",Yt,"[",ut,"]=",Re.link(function(xt){return xi(qi,Re,ve,xt,1)}),"(",Mt,");",We,".call(this,a0);"))}Object.keys(ve.state).length>0&&tt(Re.shared.current,".dirty=true;"),Re.shared.vao&&tt(Re.shared.vao,".setVAO(null);")}function zo(Re,ve,tt,Mt){Re.batchId="a1",To(Re,ve);function Yt(){return!0}Wo(Re,ve,tt,Mt.attributes,Yt),da(Re,ve,tt,Mt.uniforms,Yt,!1),vs(Re,ve,ve,tt)}function Sl(Re,ve,tt,Mt){To(Re,ve);var Yt=tt.contextDep,ut=ve.def(),We="a0",xt="a1",Ae=ve.def();Re.shared.props=Ae,Re.batchId=ut;var Je=Re.scope(),Oe=Re.scope();ve(Je.entry,"for(",ut,"=0;",ut,"<",xt,";++",ut,"){",Ae,"=",We,"[",ut,"];",Oe,"}",Je.exit);function kt(rn){return rn.contextDep&&Yt||rn.propDep}function Ut(rn){return!kt(rn)}if(tt.needsContext&&Ho(Re,Oe,tt.context),tt.needsFramebuffer&&us(Re,Oe,tt.framebuffer),ds(Re,Oe,tt.state,kt),tt.profile&&kt(tt.profile)&&Li(Re,Oe,tt,!1,!0),Mt)tt.useVAO?tt.drawVAO?kt(tt.drawVAO)?Oe(Re.shared.vao,".setVAO(",tt.drawVAO.append(Re,Oe),");"):Je(Re.shared.vao,".setVAO(",tt.drawVAO.append(Re,Je),");"):Je(Re.shared.vao,".setVAO(",Re.shared.vao,".targetVAO);"):(Je(Re.shared.vao,".setVAO(null);"),Wo(Re,Je,tt,Mt.attributes,Ut),Wo(Re,Oe,tt,Mt.attributes,kt)),da(Re,Je,tt,Mt.uniforms,Ut,!1),da(Re,Oe,tt,Mt.uniforms,kt,!0),vs(Re,Je,Oe,tt);else{var Mr=Re.global.def("{}"),ln=tt.shader.progVar.append(Re,Oe),cn=Oe.def(ln,".id"),Sn=Oe.def(Mr,"[",cn,"]");Oe(Re.shared.gl,".useProgram(",ln,".program);","if(!",Sn,"){",Sn,"=",Mr,"[",cn,"]=",Re.link(function(rn){return xi(zo,Re,tt,rn,2)}),"(",ln,");}",Sn,".call(this,a0[",ut,"],",ut,");")}}function Ne(Re,ve){var tt=Re.proc("batch",2);Re.batchId="0",To(Re,tt);var Mt=!1,Yt=!0;Object.keys(ve.context).forEach(function(Mr){Mt=Mt||ve.context[Mr].propDep}),Mt||(Ho(Re,tt,ve.context),Yt=!1);var ut=ve.framebuffer,We=!1;ut?(ut.propDep?Mt=We=!0:ut.contextDep&&Mt&&(We=!0),We||us(Re,tt,ut)):us(Re,tt,null),ve.state.viewport&&ve.state.viewport.propDep&&(Mt=!0);function xt(Mr){return Mr.contextDep&&Mt||Mr.propDep}Qo(Re,tt,ve),ds(Re,tt,ve.state,function(Mr){return!xt(Mr)}),(!ve.profile||!xt(ve.profile))&&Li(Re,tt,ve,!1,"a1"),ve.contextDep=Mt,ve.needsContext=Yt,ve.needsFramebuffer=We;var Ae=ve.shader.progVar;if(Ae.contextDep&&Mt||Ae.propDep)Sl(Re,tt,ve,null);else{var Je=Ae.append(Re,tt);if(tt(Re.shared.gl,".useProgram(",Je,".program);"),ve.shader.program)Sl(Re,tt,ve,ve.shader.program);else{tt(Re.shared.vao,".setVAO(null);");var Oe=Re.global.def("{}"),kt=tt.def(Je,".id"),Ut=tt.def(Oe,"[",kt,"]");tt(Re.cond(Ut).then(Ut,".call(this,a0,a1);").else(Ut,"=",Oe,"[",kt,"]=",Re.link(function(Mr){return xi(Sl,Re,ve,Mr,2)}),"(",Je,");",Ut,".call(this,a0,a1);"))}}Object.keys(ve.state).length>0&&tt(Re.shared.current,".dirty=true;"),Re.shared.vao&&tt(Re.shared.vao,".setVAO(null);")}function nr(Re,ve){var tt=Re.proc("scope",3);Re.batchId="a2";var Mt=Re.shared,Yt=Mt.current;Ho(Re,tt,ve.context),ve.framebuffer&&ve.framebuffer.append(Re,tt),cp(Object.keys(ve.state)).forEach(function(We){var xt=ve.state[We],Ae=xt.append(Re,tt);Eo(Ae)?Ae.forEach(function(Je,Oe){tt.set(Re.next[We],"["+Oe+"]",Je)}):tt.set(Mt.next,"."+We,Ae)}),Li(Re,tt,ve,!0,!0),[Us,th,qc,Ah,Go].forEach(function(We){var xt=ve.draw[We];!xt||tt.set(Mt.draw,"."+We,""+xt.append(Re,tt))}),Object.keys(ve.uniforms).forEach(function(We){var xt=ve.uniforms[We].append(Re,tt);Array.isArray(xt)&&(xt="["+xt.join()+"]"),tt.set(Mt.uniforms,"["+we.id(We)+"]",xt)}),Object.keys(ve.attributes).forEach(function(We){var xt=ve.attributes[We].append(Re,tt),Ae=Re.scopeAttrib(We);Object.keys(new Tt).forEach(function(Je){tt.set(Ae,"."+Je,xt[Je])})}),ve.scopeVAO&&tt.set(Mt.vao,".targetVAO",ve.scopeVAO.append(Re,tt));function ut(We){var xt=ve.shader[We];xt&&tt.set(Mt.shader,"."+We,xt.append(Re,tt))}ut(_l),ut(Yc),Object.keys(ve.state).length>0&&(tt(Yt,".dirty=true;"),tt.exit(Yt,".dirty=true;")),tt("a1(",Re.shared.context,",a0,",Re.batchId,");")}function Vt(Re){if(!(typeof Re!="object"||Eo(Re))){for(var ve=Object.keys(Re),tt=0;tt<ve.length;++tt)if(an.isDynamic(Re[ve[tt]]))return!0;return!1}}function Mn(Re,ve,tt){var Mt=ve.static[tt];if(!Mt||!Vt(Mt))return;var Yt=Re.global,ut=Object.keys(Mt),We=!1,xt=!1,Ae=!1,Je=Re.global.def("{}");ut.forEach(function(kt){var Ut=Mt[kt];if(an.isDynamic(Ut)){typeof Ut=="function"&&(Ut=Mt[kt]=an.unbox(Ut));var Mr=hu(Ut,null);We=We||Mr.thisDep,Ae=Ae||Mr.propDep,xt=xt||Mr.contextDep}else{switch(Yt(Je,".",kt,"="),typeof Ut){case"number":Yt(Ut);break;case"string":Yt('"',Ut,'"');break;case"object":Array.isArray(Ut)&&Yt("[",Ut.join(),"]");break;default:Yt(Re.link(Ut));break}Yt(";")}});function Oe(kt,Ut){ut.forEach(function(Mr){var ln=Mt[Mr];if(!!an.isDynamic(ln)){var cn=kt.invoke(Ut,ln);Ut(Je,".",Mr,"=",cn,";")}})}ve.dynamic[tt]=new an.DynamicVariable(Oo,{thisDep:We,contextDep:xt,propDep:Ae,ref:Je,append:Oe}),delete ve.static[tt]}function ra(Re,ve,tt,Mt,Yt){var ut=Ei();ut.stats=ut.link(Yt),Object.keys(ve.static).forEach(function(xt){Mn(ut,ve,xt)}),zv.forEach(function(xt){Mn(ut,Re,xt)});var We=ss(Re,ve,tt,Mt,ut);return Ca(ut,We),nr(ut,We),Ne(ut,We),y(ut.compile(),{destroy:function(){We.shader.program.destroy()}})}return{next:yn,current:Jr,procs:function(){var Re=Ei(),ve=Re.proc("poll"),tt=Re.proc("refresh"),Mt=Re.block();ve(Mt),tt(Mt);var Yt=Re.shared,ut=Yt.gl,We=Yt.next,xt=Yt.current;Mt(xt,".dirty=false;"),us(Re,ve),us(Re,tt,null,!0);var Ae;Vr&&(Ae=Re.link(Vr)),$e.oes_vertex_array_object&&tt(Re.link($e.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Je=0;Je<rr.maxAttributes;++Je){var Oe=tt.def(Yt.attributes,"[",Je,"]"),kt=Re.cond(Oe,".buffer");kt.then(ut,".enableVertexAttribArray(",Je,");",ut,".bindBuffer(",nh,",",Oe,".buffer.buffer);",ut,".vertexAttribPointer(",Je,",",Oe,".size,",Oe,".type,",Oe,".normalized,",Oe,".stride,",Oe,".offset);").else(ut,".disableVertexAttribArray(",Je,");",ut,".vertexAttrib4f(",Je,",",Oe,".x,",Oe,".y,",Oe,".z,",Oe,".w);",Oe,".buffer=null;"),tt(kt),Vr&&tt(Ae,".vertexAttribDivisorANGLE(",Je,",",Oe,".divisor);")}return tt(Re.shared.vao,".currentVAO=null;",Re.shared.vao,".setVAO(",Re.shared.vao,".targetVAO);"),Object.keys(_r).forEach(function(Ut){var Mr=_r[Ut],ln=Mt.def(We,".",Ut),cn=Re.block();cn("if(",ln,"){",ut,".enable(",Mr,")}else{",ut,".disable(",Mr,")}",xt,".",Ut,"=",ln,";"),tt(cn),ve("if(",ln,"!==",xt,".",Ut,"){",cn,"}")}),Object.keys(Sr).forEach(function(Ut){var Mr=Sr[Ut],ln=Jr[Ut],cn,Sn,rn=Re.block();if(rn(ut,".",Mr,"("),Eo(ln)){var Hn=ln.length;cn=Re.global.def(We,".",Ut),Sn=Re.global.def(xt,".",Ut),rn(et(Hn,function(kn){return cn+"["+kn+"]"}),");",et(Hn,function(kn){return Sn+"["+kn+"]="+cn+"["+kn+"];"}).join("")),ve("if(",et(Hn,function(kn){return cn+"["+kn+"]!=="+Sn+"["+kn+"]"}).join("||"),"){",rn,"}")}else cn=Mt.def(We,".",Ut),Sn=Mt.def(xt,".",Ut),rn(cn,");",xt,".",Ut,"=",cn,";"),ve("if(",cn,"!==",Sn,"){",rn,"}");tt(rn)}),Re.compile()}(),compile:ra}}function Bd(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Nd=34918,fp=34919,ec=35007,Oh=function(U,we){if(!we.ext_disjoint_timer_query)return null;var $e=[];function rr(){return $e.pop()||we.ext_disjoint_timer_query.createQueryEXT()}function wr(Vr){$e.push(Vr)}var Jt=[];function yr(Vr){var un=rr();we.ext_disjoint_timer_query.beginQueryEXT(ec,un),Jt.push(un),Ur(Jt.length-1,Jt.length,Vr)}function kr(){we.ext_disjoint_timer_query.endQueryEXT(ec)}function Br(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Zr=[];function $r(){return Zr.pop()||new Br}function qr(Vr){Zr.push(Vr)}var hn=[];function Ur(Vr,un,Er){var Jr=$r();Jr.startQueryIndex=Vr,Jr.endQueryIndex=un,Jr.sum=0,Jr.stats=Er,hn.push(Jr)}var Kr=[],Tt=[];function ar(){var Vr,un,Er=Jt.length;if(Er!==0){Tt.length=Math.max(Tt.length,Er+1),Kr.length=Math.max(Kr.length,Er+1),Kr[0]=0,Tt[0]=0;var Jr=0;for(Vr=0,un=0;un<Jt.length;++un){var yn=Jt[un];we.ext_disjoint_timer_query.getQueryObjectEXT(yn,fp)?(Jr+=we.ext_disjoint_timer_query.getQueryObjectEXT(yn,Nd),wr(yn)):Jt[Vr++]=yn,Kr[un+1]=Jr,Tt[un+1]=Vr}for(Jt.length=Vr,Vr=0,un=0;un<hn.length;++un){var ai=hn[un],_r=ai.startQueryIndex,Sr=ai.endQueryIndex;ai.sum+=Kr[Sr]-Kr[_r];var Gn=Tt[_r],nn=Tt[Sr];nn===Gn?(ai.stats.gpuTime+=ai.sum/1e6,qr(ai)):(ai.startQueryIndex=Gn,ai.endQueryIndex=nn,hn[Vr++]=ai)}hn.length=Vr}}return{beginQuery:yr,endQuery:kr,pushScopeStats:Ur,update:ar,getNumPendingQueries:function(){return Jt.length},clear:function(){$e.push.apply($e,Jt);for(var Vr=0;Vr<$e.length;Vr++)we.ext_disjoint_timer_query.deleteQueryEXT($e[Vr]);Jt.length=0,$e.length=0},restore:function(){Jt.length=0,$e.length=0}}},zd=16384,lh=256,Zd=1024,nf=34962,js="webglcontextlost",Za="webglcontextrestored",Fh=1,Uu=2,Ff=3;function hp(U,we){for(var $e=0;$e<U.length;++$e)if(U[$e]===we)return $e;return-1}function Ud(U){var we=Ce(U);if(!we)return null;var $e=we.gl,rr=$e.getContextAttributes(),wr=$e.isContextLost(),Jt=Be($e,we);if(!Jt)return null;var yr=ka(),kr=Bd(),Br=Jt.extensions,Zr=Oh($e,Br),$r=fa(),qr=$e.drawingBufferWidth,hn=$e.drawingBufferHeight,Ur={tick:0,time:0,viewportWidth:qr,viewportHeight:hn,framebufferWidth:qr,framebufferHeight:hn,drawingBufferWidth:qr,drawingBufferHeight:hn,pixelRatio:we.pixelRatio},Kr={},Tt={elements:null,primitive:4,count:-1,offset:0,instances:-1},ar=Fu($e,Br),Vr=Z($e,kr,we,Jr),un=mu($e,Br,Vr,kr),Er=Bt($e,Br,ar,kr,Vr,un,Tt);function Jr(xi){return Er.destroyBuffer(xi)}var yn=on($e,yr,kr,we),ai=ps($e,Br,ar,function(){Gn.procs.poll()},Ur,kr,we),_r=Gl($e,Br,ar,kr,we),Sr=je($e,Br,ar,ai,_r,kr),Gn=qp($e,yr,Br,ar,Vr,un,ai,Sr,Kr,Er,yn,Tt,Ur,Zr,we),nn=oi($e,Sr,Gn.procs.poll,Ur,rr,Br,ar),Gr=Gn.next,mn=$e.canvas,_n=[],Ri=[],Ei=[],pn=[we.onDestroy],Tn=null;function hi(){if(_n.length===0){Zr&&Zr.update(),Tn=null;return}Tn=gi.next(hi),To();for(var xi=_n.length-1;xi>=0;--xi){var qi=_n[xi];qi&&qi(Ur,null,0)}$e.flush(),Zr&&Zr.update()}function Mi(){!Tn&&_n.length>0&&(Tn=gi.next(hi))}function $i(){Tn&&(gi.cancel(hi),Tn=null)}function fo(xi){xi.preventDefault(),wr=!0,$i(),Ri.forEach(function(qi){qi()})}function Ao(xi){$e.getError(),wr=!1,Jt.restore(),yn.restore(),Vr.restore(),ai.restore(),_r.restore(),Sr.restore(),Er.restore(),Zr&&Zr.restore(),Gn.procs.refresh(),Mi(),Ei.forEach(function(qi){qi()})}var Yi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!Yi&&mn&&(mn.addEventListener(js,fo,!1),mn.addEventListener(Za,Ao,!1));function os(){_n.length=0,$i(),!Yi&&mn&&(mn.removeEventListener(js,fo),mn.removeEventListener(Za,Ao)),yn.clear(),Sr.clear(),_r.clear(),Er.clear(),ai.clear(),un.clear(),Vr.clear(),Zr&&Zr.clear(),pn.forEach(function(xi){xi()})}function ao(xi){N(!!xi,"invalid args to regl({...})"),N.type(xi,"object","invalid args to regl({...})");function qi(ut){var We=y({},ut);delete We.uniforms,delete We.attributes,delete We.context,delete We.vao,"stencil"in We&&We.stencil.op&&(We.stencil.opBack=We.stencil.opFront=We.stencil.op,delete We.stencil.op);function xt(Ae){if(Ae in We){var Je=We[Ae];delete We[Ae],Object.keys(Je).forEach(function(Oe){We[Ae+"."+Oe]=Je[Oe]})}}return xt("blend"),xt("depth"),xt("cull"),xt("stencil"),xt("polygonOffset"),xt("scissor"),xt("sample"),"vao"in ut&&(We.vao=ut.vao),We}function Ca(ut,We){var xt={},Ae={};return Object.keys(ut).forEach(function(Je){var Oe=ut[Je];if(an.isDynamic(Oe)){Ae[Je]=an.unbox(Oe,Je);return}else if(We&&Array.isArray(Oe)){for(var kt=0;kt<Oe.length;++kt)if(an.isDynamic(Oe[kt])){Ae[Je]=an.unbox(Oe,Je);return}}xt[Je]=Oe}),{dynamic:Ae,static:xt}}var zo=Ca(xi.context||{},!0),Sl=Ca(xi.uniforms||{},!0),Ne=Ca(xi.attributes||{},!1),nr=Ca(qi(xi),!1),Vt={gpuTime:0,cpuTime:0,count:0},Mn=Gn.compile(nr,Ne,Sl,zo,Vt),ra=Mn.draw,Re=Mn.batch,ve=Mn.scope,tt=[];function Mt(ut){for(;tt.length<ut;)tt.push(null);return tt}function Yt(ut,We){var xt;if(wr&&N.raise("context lost"),typeof ut=="function")return ve.call(this,null,ut,0);if(typeof We=="function")if(typeof ut=="number")for(xt=0;xt<ut;++xt)ve.call(this,null,We,xt);else if(Array.isArray(ut))for(xt=0;xt<ut.length;++xt)ve.call(this,ut[xt],We,xt);else return ve.call(this,ut,We,0);else if(typeof ut=="number"){if(ut>0)return Re.call(this,Mt(ut|0),ut|0)}else if(Array.isArray(ut)){if(ut.length)return Re.call(this,ut,ut.length)}else return ra.call(this,ut)}return y(Yt,{stats:Vt,destroy:function(){Mn.destroy()}})}var ss=Sr.setFBO=ao({framebuffer:an.define.call(null,Fh,"framebuffer")});function Ho(xi,qi){var Ca=0;Gn.procs.poll();var zo=qi.color;zo&&($e.clearColor(+zo[0]||0,+zo[1]||0,+zo[2]||0,+zo[3]||0),Ca|=zd),"depth"in qi&&($e.clearDepth(+qi.depth),Ca|=lh),"stencil"in qi&&($e.clearStencil(qi.stencil|0),Ca|=Zd),N(!!Ca,"called regl.clear with no buffer specified"),$e.clear(Ca)}function us(xi){if(N(typeof xi=="object"&&xi,"regl.clear() takes an object as input"),"framebuffer"in xi)if(xi.framebuffer&&xi.framebuffer_reglType==="framebufferCube")for(var qi=0;qi<6;++qi)ss(y({framebuffer:xi.framebuffer.faces[qi]},xi),Ho);else ss(xi,Ho);else Ho(null,xi)}function Qo(xi){N.type(xi,"function","regl.frame() callback must be a function"),_n.push(xi);function qi(){var Ca=hp(_n,xi);N(Ca>=0,"cannot cancel a frame twice");function zo(){var Sl=hp(_n,zo);_n[Sl]=_n[_n.length-1],_n.length-=1,_n.length<=0&&$i()}_n[Ca]=zo}return Mi(),{cancel:qi}}function ds(){var xi=Gr.viewport,qi=Gr.scissor_box;xi[0]=xi[1]=qi[0]=qi[1]=0,Ur.viewportWidth=Ur.framebufferWidth=Ur.drawingBufferWidth=xi[2]=qi[2]=$e.drawingBufferWidth,Ur.viewportHeight=Ur.framebufferHeight=Ur.drawingBufferHeight=xi[3]=qi[3]=$e.drawingBufferHeight}function To(){Ur.tick+=1,Ur.time=Wo(),ds(),Gn.procs.poll()}function Li(){ai.refresh(),ds(),Gn.procs.refresh(),Zr&&Zr.update()}function Wo(){return(fa()-$r)/1e3}Li();function da(xi,qi){N.type(qi,"function","listener callback must be a function");var Ca;switch(xi){case"frame":return Qo(qi);case"lost":Ca=Ri;break;case"restore":Ca=Ei;break;case"destroy":Ca=pn;break;default:N.raise("invalid event, must be one of frame,lost,restore,destroy")}return Ca.push(qi),{cancel:function(){for(var zo=0;zo<Ca.length;++zo)if(Ca[zo]===qi){Ca[zo]=Ca[Ca.length-1],Ca.pop();return}}}}var vs=y(ao,{clear:us,prop:an.define.bind(null,Fh),context:an.define.bind(null,Uu),this:an.define.bind(null,Ff),draw:ao({}),buffer:function(xi){return Vr.create(xi,nf,!1,!1)},elements:function(xi){return un.create(xi,!1)},texture:ai.create2D,cube:ai.createCube,renderbuffer:_r.create,framebuffer:Sr.create,framebufferCube:Sr.createCube,vao:Er.createVAO,attributes:rr,frame:Qo,on:da,limits:ar,hasExtension:function(xi){return ar.extensions.indexOf(xi.toLowerCase())>=0},read:nn,destroy:os,_gl:$e,_refresh:Li,poll:function(){To(),Zr&&Zr.update()},now:Wo,stats:kr});return we.onDone(null,vs),vs}return Ud})},60442:function(sn,pe,ee){var Le=ee(90939);function Te(y,Ie){return Le(y,Ie)}sn.exports=Te},6158:function(sn){(function(pe,ee){sn.exports=ee()})(this,function(){"use strict";var pe,ee,Le;function Te(y,Ie){if(!pe)pe=Ie;else if(!ee)ee=Ie;else{var X="var sharedChunk = {}; ("+pe+")(sharedChunk); ("+ee+")(sharedChunk);",Se={};pe(Se),Le=Ie(Se),typeof window!="undefined"&&(Le.workerUrl=window.URL.createObjectURL(new Blob([X],{type:"text/javascript"})))}}return Te(["exports"],function(y){"use strict";function Ie(a,s){return a(s={exports:{}},s.exports),s.exports}var X=Se;function Se(a,s,c,m){this.cx=3*a,this.bx=3*(c-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=m,this.p2x=c,this.p2y=m}Se.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},Se.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},Se.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},Se.prototype.solveCurveX=function(a,s){var c,m,_,S,C;for(s===void 0&&(s=1e-6),_=a,C=0;C<8;C++){if(S=this.sampleCurveX(_)-a,Math.abs(S)<s)return _;var P=this.sampleCurveDerivativeX(_);if(Math.abs(P)<1e-6)break;_-=S/P}if((_=a)<(c=0))return c;if(_>(m=1))return m;for(;c<m;){if(S=this.sampleCurveX(_),Math.abs(S-a)<s)return _;a>S?c=_:m=_,_=.5*(m-c)+c}return _},Se.prototype.solve=function(a,s){return this.sampleCurveY(this.solveCurveX(a,s))};var se=rt;function rt(a,s){this.x=a,this.y=s}rt.prototype={clone:function(){return new rt(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,s){return this.clone()._rotateAround(a,s)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var s=a.x-this.x,c=a.y-this.y;return s*s+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,s){return Math.atan2(this.x*s-this.y*a,this.x*a+this.y*s)},_matMult:function(a){var s=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=s,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var s=Math.cos(a),c=Math.sin(a),m=c*this.x+s*this.y;return this.x=s*this.x-c*this.y,this.y=m,this},_rotateAround:function(a,s){var c=Math.cos(a),m=Math.sin(a),_=s.y+m*(this.x-s.x)+c*(this.y-s.y);return this.x=s.x+c*(this.x-s.x)-m*(this.y-s.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},rt.convert=function(a){return a instanceof rt?a:Array.isArray(a)?new rt(a[0],a[1]):a};var ye=typeof self!="undefined"?self:{},ot=Math.pow(2,53)-1;function ct(a,s,c,m){var _=new X(a,s,c,m);return function(S){return _.solve(S)}}var bt=ct(.25,.1,.25,1);function Ot(a,s,c){return Math.min(c,Math.max(s,a))}function vr(a,s,c){var m=c-s,_=((a-s)%m+m)%m+s;return _===s?c:_}function Ft(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];for(var m=0,_=s;m<_.length;m+=1){var S=_[m];for(var C in S)a[C]=S[C]}return a}var gr=1;function qt(){return gr++}function It(){return function a(s){return s?(s^16*Math.random()>>s/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function Zt(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function br(a,s){a.forEach(function(c){s[c]&&(s[c]=s[c].bind(s))})}function J(a,s){return a.indexOf(s,a.length-s.length)!==-1}function Et(a,s,c){var m={};for(var _ in a)m[_]=s.call(c||this,a[_],_,a);return m}function Ct(a,s,c){var m={};for(var _ in a)s.call(c||this,a[_],_,a)&&(m[_]=a[_]);return m}function pt(a){return Array.isArray(a)?a.map(pt):typeof a=="object"&&a?Et(a,pt):a}var Ht={};function vt(a){Ht[a]||(typeof console!="undefined"&&console.warn(a),Ht[a]=!0)}function sr(a,s,c){return(c.y-a.y)*(s.x-a.x)>(s.y-a.y)*(c.x-a.x)}function Ir(a){for(var s=0,c=0,m=a.length,_=m-1,S=void 0,C=void 0;c<m;_=c++)s+=((C=a[_]).x-(S=a[c]).x)*(S.y+C.y);return s}function ae(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Ze(a){var s={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(m,_,S,C){var P=S||C;return s[_]=!P||P.toLowerCase(),""}),s["max-age"]){var c=parseInt(s["max-age"],10);isNaN(c)?delete s["max-age"]:s["max-age"]=c}return s}var Y=null;function ce(a){if(Y==null){var s=a.navigator?a.navigator.userAgent:null;Y=!!a.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Y}function ue(a){try{var s=ye[a];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch(c){return!1}}var Xe,lt,_t,Xt,hr=ye.performance&&ye.performance.now?ye.performance.now.bind(ye.performance):Date.now.bind(Date),Yr=ye.requestAnimationFrame||ye.mozRequestAnimationFrame||ye.webkitRequestAnimationFrame||ye.msRequestAnimationFrame,Hr=ye.cancelAnimationFrame||ye.mozCancelAnimationFrame||ye.webkitCancelAnimationFrame||ye.msCancelAnimationFrame,vi={now:hr,frame:function(a){var s=Yr(a);return{cancel:function(){return Hr(s)}}},getImageData:function(a,s){s===void 0&&(s=0);var c=ye.document.createElement("canvas"),m=c.getContext("2d");if(!m)throw new Error("failed to create canvas 2d context");return c.width=a.width,c.height=a.height,m.drawImage(a,0,0,a.width,a.height),m.getImageData(-s,-s,a.width+2*s,a.height+2*s)},resolveURL:function(a){return Xe||(Xe=ye.document.createElement("a")),Xe.href=a,Xe.href},hardwareConcurrency:ye.navigator&&ye.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ye.devicePixelRatio},get prefersReducedMotion(){return!!ye.matchMedia&&(lt==null&&(lt=ye.matchMedia("(prefers-reduced-motion: reduce)")),lt.matches)}},Vn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Xn={supported:!1,testSupport:function(a){!ma&&Xt&&(Pi?mi(a):_t=a)}},ma=!1,Pi=!1;function mi(a){var s=a.createTexture();a.bindTexture(a.TEXTURE_2D,s);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Xt),a.isContextLost())return;Xn.supported=!0}catch(c){}a.deleteTexture(s),ma=!0}ye.document&&((Xt=ye.document.createElement("img")).onload=function(){_t&&mi(_t),_t=null,Pi=!0},Xt.onerror=function(){ma=!0,_t=null},Xt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var ca="01",Gi=function(a,s){this._transformRequestFn=a,this._customAccessToken=s,this._createSkuToken()};function Si(a){return a.indexOf("mapbox:")===0}Gi.prototype._createSkuToken=function(){var a=function(){for(var s="",c=0;c<10;c++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ca,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},Gi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Gi.prototype.transformRequest=function(a,s){return this._transformRequestFn&&this._transformRequestFn(a,s)||{url:a}},Gi.prototype.normalizeStyleURL=function(a,s){if(!Si(a))return a;var c=Wa(a);return c.path="/styles/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||s)},Gi.prototype.normalizeGlyphsURL=function(a,s){if(!Si(a))return a;var c=Wa(a);return c.path="/fonts/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||s)},Gi.prototype.normalizeSourceURL=function(a,s){if(!Si(a))return a;var c=Wa(a);return c.path="/v4/"+c.authority+".json",c.params.push("secure"),this._makeAPIURL(c,this._customAccessToken||s)},Gi.prototype.normalizeSpriteURL=function(a,s,c,m){var _=Wa(a);return Si(a)?(_.path="/styles/v1"+_.path+"/sprite"+s+c,this._makeAPIURL(_,this._customAccessToken||m)):(_.path+=""+s+c,xa(_))},Gi.prototype.normalizeTileURL=function(a,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Si(a))return a;var c=Wa(a);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,(vi.devicePixelRatio>=2||s===512?"@2x":"")+(Xn.supported?".webp":"$1")),c.path=c.path.replace(/^.+\/v4\//,"/"),c.path="/v4"+c.path;var m=this._customAccessToken||function(_){for(var S=0,C=_;S<C.length;S+=1){var P=C[S].match(/^access_token=(.*)$/);if(P)return P[1]}return null}(c.params)||Vn.ACCESS_TOKEN;return Vn.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&c.params.push("sku="+this._skuToken),this._makeAPIURL(c,m)},Gi.prototype.canonicalizeTileURL=function(a,s){var c=Wa(a);if(!c.path.match(/(^\/v4\/)/)||!c.path.match(/\.[\w]+$/))return a;var m="mapbox://tiles/";m+=c.path.replace("/v4/","");var _=c.params;return s&&(_=_.filter(function(S){return!S.match(/^access_token=/)})),_.length&&(m+="?"+_.join("&")),m},Gi.prototype.canonicalizeTileset=function(a,s){for(var c=!!s&&Si(s),m=[],_=0,S=a.tiles||[];_<S.length;_+=1){var C=S[_];cr(C)?m.push(this.canonicalizeTileURL(C,c)):m.push(C)}return m},Gi.prototype._makeAPIURL=function(a,s){var c="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",m=Wa(Vn.API_URL);if(a.protocol=m.protocol,a.authority=m.authority,a.protocol==="http"){var _=a.params.indexOf("secure");_>=0&&a.params.splice(_,1)}if(m.path!=="/"&&(a.path=""+m.path+a.path),!Vn.REQUIRE_ACCESS_TOKEN)return xa(a);if(!(s=s||Vn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+c);if(s[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+c);return a.params=a.params.filter(function(S){return S.indexOf("access_token")===-1}),a.params.push("access_token="+s),xa(a)};var ei=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function cr(a){return ei.test(a)}var mt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Wa(a){var s=a.match(mt);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function xa(a){var s=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+s}function gt(a){if(!a)return null;var s=a.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(decodeURIComponent(ye.atob(s[1]).split("").map(function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(c){return null}}var he=function(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};he.prototype.getStorageKey=function(a){var s,c=gt(Vn.ACCESS_TOKEN);return s=c&&c.u?ye.btoa(encodeURIComponent(c.u).replace(/%([0-9A-F]{2})/g,function(m,_){return String.fromCharCode(Number("0x"+_))})):Vn.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+s:"mapbox.eventData:"+s},he.prototype.fetchEventData=function(){var a=ue("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(a)try{var m=ye.localStorage.getItem(s);m&&(this.eventData=JSON.parse(m));var _=ye.localStorage.getItem(c);_&&(this.anonId=_)}catch(S){vt("Unable to read from LocalStorage")}},he.prototype.saveEventData=function(){var a=ue("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(a)try{ye.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&ye.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(m){vt("Unable to write to LocalStorage")}},he.prototype.processRequests=function(a){},he.prototype.postEvent=function(a,s,c,m){var _=this;if(Vn.EVENTS_URL){var S=Wa(Vn.EVENTS_URL);S.params.push("access_token="+(m||Vn.ACCESS_TOKEN||""));var C={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:ca,userId:this.anonId},P=s?Ft(C,s):C,D={url:xa(S),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=Wi(D,function(j){_.pendingRequest=null,c(j),_.saveEventData(),_.processRequests(m)})}},he.prototype.queueRequest=function(a,s){this.queue.push(a),this.processRequests(s)};var ie,_e,N=function(a){function s(){a.call(this,"map.load"),this.success={},this.skuToken=""}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.postMapLoadEvent=function(c,m,_,S){this.skuToken=_;var C=!(!S&&!Vn.ACCESS_TOKEN),P=Array.isArray(c)&&c.some(function(D){return Si(D)||cr(D)});Vn.EVENTS_URL&&C&&P&&this.queueRequest({id:m,timestamp:Date.now()},S)},s.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){var _=this.queue.shift(),S=_.id,C=_.timestamp;S&&this.success[S]||(this.anonId||this.fetchEventData(),Zt(this.anonId)||(this.anonId=It()),this.postEvent(C,{skuToken:this.skuToken},function(P){P||S&&(m.success[S]=!0)},c))}},s}(he),qe=new(function(a){function s(c){a.call(this,"appUserTurnstile"),this._customAccessToken=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.postTurnstileEvent=function(c,m){Vn.EVENTS_URL&&Vn.ACCESS_TOKEN&&Array.isArray(c)&&c.some(function(_){return Si(_)||cr(_)})&&this.queueRequest(Date.now(),m)},s.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var _=gt(Vn.ACCESS_TOKEN),S=_?_.u:Vn.ACCESS_TOKEN,C=S!==this.eventData.tokenU;Zt(this.anonId)||(this.anonId=It(),C=!0);var P=this.queue.shift();if(this.eventData.lastSuccess){var D=new Date(this.eventData.lastSuccess),j=new Date(P),B=(P-this.eventData.lastSuccess)/864e5;C=C||B>=1||B<-1||D.getDate()!==j.getDate()}else C=!0;if(!C)return this.processRequests();this.postEvent(P,{"enabled.telemetry":!1},function(K){K||(m.eventData.lastSuccess=P,m.eventData.tokenU=S)},c)}},s}(he)),Qt=qe.postTurnstileEvent.bind(qe),Nr=new N,Ye=Nr.postMapLoadEvent.bind(Nr),Pt=500,pr=50;function Pr(){ye.caches&&!ie&&(ie=ye.caches.open("mapbox-tiles"))}function Wr(a){var s=a.indexOf("?");return s<0?a:a.slice(0,s)}var tn,Yn=1/0;function jn(){return tn==null&&(tn=ye.OffscreenCanvas&&new ye.OffscreenCanvas(1,1).getContext("2d")&&typeof ye.createImageBitmap=="function"),tn}var an={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(an);var gi=function(a){function s(c,m,_){m===401&&cr(_)&&(c+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,c),this.status=m,this.url=_,this.name=this.constructor.name,this.message=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},s}(Error),ci=ae()?function(){return self.worker&&self.worker.referrer}:function(){return(ye.location.protocol==="blob:"?ye.parent:ye).location.href},fa,ka,Ua=function(a,s){if(!(/^file:/.test(c=a.url)||/^file:/.test(ci())&&!/^\w+:/.test(c))){if(ye.fetch&&ye.Request&&ye.AbortController&&ye.Request.prototype.hasOwnProperty("signal"))return function(m,_){var S,C=new ye.AbortController,P=new ye.Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,referrer:ci(),signal:C.signal}),D=!1,j=!1,B=(S=P.url).indexOf("sku=")>0&&cr(S);m.type==="json"&&P.headers.set("Accept","application/json");var K=function(de,ze,Ue){if(!j){if(de&&de.message!=="SecurityError"&&vt(de),ze&&Ue)return V(ze);var st=Date.now();ye.fetch(P).then(function(Ke){if(Ke.ok){var St=B?Ke.clone():null;return V(Ke,St,st)}return _(new gi(Ke.statusText,Ke.status,m.url))}).catch(function(Ke){Ke.code!==20&&_(new Error(Ke.message))})}},V=function(de,ze,Ue){(m.type==="arrayBuffer"?de.arrayBuffer():m.type==="json"?de.json():de.text()).then(function(st){j||(ze&&Ue&&function(Ke,St,jt){if(Pr(),ie){var or={status:St.status,statusText:St.statusText,headers:new ye.Headers};St.headers.forEach(function(Cr,Qr){return or.headers.set(Qr,Cr)});var lr=Ze(St.headers.get("Cache-Control")||"");lr["no-store"]||(lr["max-age"]&&or.headers.set("Expires",new Date(jt+1e3*lr["max-age"]).toUTCString()),new Date(or.headers.get("Expires")).getTime()-jt<42e4||function(Cr,Qr){if(_e===void 0)try{new Response(new ReadableStream),_e=!0}catch(dn){_e=!1}_e?Qr(Cr.body):Cr.blob().then(Qr)}(St,function(Cr){var Qr=new ye.Response(Cr,or);Pr(),ie&&ie.then(function(dn){return dn.put(Wr(Ke.url),Qr)}).catch(function(dn){return vt(dn.message)})}))}}(P,ze,Ue),D=!0,_(null,st,de.headers.get("Cache-Control"),de.headers.get("Expires")))}).catch(function(st){j||_(new Error(st.message))})};return B?function(de,ze){if(Pr(),!ie)return ze(null);var Ue=Wr(de.url);ie.then(function(st){st.match(Ue).then(function(Ke){var St=function(jt){if(!jt)return!1;var or=new Date(jt.headers.get("Expires")||0),lr=Ze(jt.headers.get("Cache-Control")||"");return or>Date.now()&&!lr["no-cache"]}(Ke);st.delete(Ue),St&&st.put(Ue,Ke.clone()),ze(null,Ke,St)}).catch(ze)}).catch(ze)}(P,K):K(null,null),{cancel:function(){j=!0,D||C.abort()}}}(a,s);if(ae()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,s,void 0,!0)}var c;return function(m,_){var S=new ye.XMLHttpRequest;for(var C in S.open(m.method||"GET",m.url,!0),m.type==="arrayBuffer"&&(S.responseType="arraybuffer"),m.headers)S.setRequestHeader(C,m.headers[C]);return m.type==="json"&&(S.responseType="text",S.setRequestHeader("Accept","application/json")),S.withCredentials=m.credentials==="include",S.onerror=function(){_(new Error(S.statusText))},S.onload=function(){if((S.status>=200&&S.status<300||S.status===0)&&S.response!==null){var P=S.response;if(m.type==="json")try{P=JSON.parse(S.response)}catch(D){return _(D)}_(null,P,S.getResponseHeader("Cache-Control"),S.getResponseHeader("Expires"))}else _(new gi(S.statusText,S.status,m.url))},S.send(m.body),{cancel:function(){return S.abort()}}}(a,s)},Ea=function(a,s){return Ua(Ft(a,{type:"arrayBuffer"}),s)},Wi=function(a,s){return Ua(Ft(a,{method:"POST"}),s)},q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";fa=[],ka=0;var re=function(a,s){if(Xn.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),ka>=Vn.MAX_PARALLEL_IMAGE_REQUESTS){var c={requestParameters:a,callback:s,cancelled:!1,cancel:function(){this.cancelled=!0}};return fa.push(c),c}ka++;var m=!1,_=function(){if(!m)for(m=!0,ka--;fa.length&&ka<Vn.MAX_PARALLEL_IMAGE_REQUESTS;){var C=fa.shift();C.cancelled||(C.cancel=re(C.requestParameters,C.callback).cancel)}},S=Ea(a,function(C,P,D,j){_(),C?s(C):P&&(jn()?function(B,K){var V=new ye.Blob([new Uint8Array(B)],{type:"image/png"});ye.createImageBitmap(V).then(function(de){K(null,de)}).catch(function(de){K(new Error("Could not load image because of "+de.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(P,s):function(B,K,V,de){var ze=new ye.Image,Ue=ye.URL;ze.onload=function(){K(null,ze),Ue.revokeObjectURL(ze.src),ze.onload=null,ye.requestAnimationFrame(function(){ze.src=q})},ze.onerror=function(){return K(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var st=new ye.Blob([new Uint8Array(B)],{type:"image/png"});ze.cacheControl=V,ze.expires=de,ze.src=B.byteLength?Ue.createObjectURL(st):q}(P,s,D,j))});return{cancel:function(){S.cancel(),_()}}};function le(a,s,c){c[a]&&c[a].indexOf(s)!==-1||(c[a]=c[a]||[],c[a].push(s))}function Ce(a,s,c){if(c&&c[a]){var m=c[a].indexOf(s);m!==-1&&c[a].splice(m,1)}}var Be=function(a,s){s===void 0&&(s={}),Ft(this,s),this.type=a},et=function(a){function s(c,m){m===void 0&&(m={}),a.call(this,"error",Ft({error:c},m))}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Be),dt=function(){};dt.prototype.on=function(a,s){return this._listeners=this._listeners||{},le(a,s,this._listeners),this},dt.prototype.off=function(a,s){return Ce(a,s,this._listeners),Ce(a,s,this._oneTimeListeners),this},dt.prototype.once=function(a,s){return this._oneTimeListeners=this._oneTimeListeners||{},le(a,s,this._oneTimeListeners),this},dt.prototype.fire=function(a,s){typeof a=="string"&&(a=new Be(a,s||{}));var c=a.type;if(this.listens(c)){a.target=this;for(var m=0,_=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];m<_.length;m+=1)_[m].call(this,a);for(var S=0,C=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];S<C.length;S+=1){var P=C[S];Ce(c,P,this._oneTimeListeners),P.call(this,a)}var D=this._eventedParent;D&&(Ft(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(a))}else a instanceof et&&console.error(a.error);return this},dt.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},dt.prototype.setEventedParent=function(a,s){return this._eventedParent=a,this._eventedParentData=s,this};var me={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Ge=function(a,s,c,m){this.message=(a?a+": ":"")+c,m&&(this.identifier=m),s!=null&&s.__line__&&(this.line=s.__line__)};function Dt(a){var s=a.value;return s?[new Ge(a.key,s,"constants have been deprecated as of v8")]:[]}function Lr(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];for(var m=0,_=s;m<_.length;m+=1){var S=_[m];for(var C in S)a[C]=S[C]}return a}function er(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function tr(a){if(Array.isArray(a))return a.map(tr);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var s={};for(var c in a)s[c]=tr(a[c]);return s}return er(a)}var Fr=function(a){function s(c,m){a.call(this,m),this.message=m,this.key=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Error),In=function(a,s){s===void 0&&(s=[]),this.parent=a,this.bindings={};for(var c=0,m=s;c<m.length;c+=1){var _=m[c];this.bindings[_[0]]=_[1]}};In.prototype.concat=function(a){return new In(this,a)},In.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},In.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var Pn={kind:"null"},$t={kind:"number"},wn={kind:"string"},fn={kind:"boolean"},gn={kind:"color"},Ii={kind:"object"},xn={kind:"value"},Ni={kind:"collator"},sa={kind:"formatted"},Oi={kind:"resolvedImage"};function Zi(a,s){return{kind:"array",itemType:a,N:s}}function Fi(a){if(a.kind==="array"){var s=Fi(a.itemType);return typeof a.N=="number"?"array<"+s+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+s+">"}return a.kind}var yi=[Pn,$t,wn,fn,gn,sa,Ii,Zi(xn),Oi];function ha(a,s){if(s.kind==="error")return null;if(a.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!ha(a.itemType,s.itemType))&&(typeof a.N!="number"||a.N===s.N))return null}else{if(a.kind===s.kind)return null;if(a.kind==="value"){for(var c=0,m=yi;c<m.length;c+=1)if(!ha(m[c],s))return null}}return"Expected "+Fi(a)+" but found "+Fi(s)+" instead."}function Xa(a,s){return s.some(function(c){return c.kind===a.kind})}function ga(a,s){return s.some(function(c){return c==="null"?a===null:c==="array"?Array.isArray(a):c==="object"?a&&!Array.isArray(a)&&typeof a=="object":c===typeof a})}var zi=Ie(function(a,s){var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function m(P){return(P=Math.round(P))<0?0:P>255?255:P}function _(P){return m(P[P.length-1]==="%"?parseFloat(P)/100*255:parseInt(P))}function S(P){return(D=P[P.length-1]==="%"?parseFloat(P)/100:parseFloat(P))<0?0:D>1?1:D;var D}function C(P,D,j){return j<0?j+=1:j>1&&(j-=1),6*j<1?P+(D-P)*j*6:2*j<1?D:3*j<2?P+(D-P)*(2/3-j)*6:P}try{s.parseCSSColor=function(P){var D,j=P.replace(/ /g,"").toLowerCase();if(j in c)return c[j].slice();if(j[0]==="#")return j.length===4?(D=parseInt(j.substr(1),16))>=0&&D<=4095?[(3840&D)>>4|(3840&D)>>8,240&D|(240&D)>>4,15&D|(15&D)<<4,1]:null:j.length===7&&(D=parseInt(j.substr(1),16))>=0&&D<=16777215?[(16711680&D)>>16,(65280&D)>>8,255&D,1]:null;var B=j.indexOf("("),K=j.indexOf(")");if(B!==-1&&K+1===j.length){var V=j.substr(0,B),de=j.substr(B+1,K-(B+1)).split(","),ze=1;switch(V){case"rgba":if(de.length!==4)return null;ze=S(de.pop());case"rgb":return de.length!==3?null:[_(de[0]),_(de[1]),_(de[2]),ze];case"hsla":if(de.length!==4)return null;ze=S(de.pop());case"hsl":if(de.length!==3)return null;var Ue=(parseFloat(de[0])%360+360)%360/360,st=S(de[1]),Ke=S(de[2]),St=Ke<=.5?Ke*(st+1):Ke+st-Ke*st,jt=2*Ke-St;return[m(255*C(jt,St,Ue+1/3)),m(255*C(jt,St,Ue)),m(255*C(jt,St,Ue-1/3)),ze];default:return null}}return null}}catch(P){}}).parseCSSColor,Ji=function(a,s,c,m){m===void 0&&(m=1),this.r=a,this.g=s,this.b=c,this.a=m};Ji.parse=function(a){if(a){if(a instanceof Ji)return a;if(typeof a=="string"){var s=zi(a);if(s)return new Ji(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3])}}},Ji.prototype.toString=function(){var a=this.toArray(),s=a[1],c=a[2],m=a[3];return"rgba("+Math.round(a[0])+","+Math.round(s)+","+Math.round(c)+","+m+")"},Ji.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},Ji.black=new Ji(0,0,0,1),Ji.white=new Ji(1,1,1,1),Ji.transparent=new Ji(0,0,0,0),Ji.red=new Ji(1,0,0,1);var Va=function(a,s,c){this.sensitivity=a?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Va.prototype.compare=function(a,s){return this.collator.compare(a,s)},Va.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var tu=function(a,s,c,m,_){this.text=a,this.image=s,this.scale=c,this.fontStack=m,this.textColor=_},$a=function(a){this.sections=a};$a.fromString=function(a){return new $a([new tu(a,null,null,null,null)])},$a.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(a){return a.text.length!==0||a.image&&a.image.name.length!==0})},$a.factory=function(a){return a instanceof $a?a:$a.fromString(a)},$a.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(a){return a.text}).join("")},$a.prototype.serialize=function(){for(var a=["format"],s=0,c=this.sections;s<c.length;s+=1){var m=c[s];if(m.image)a.push(["image",m.image.name]);else{a.push(m.text);var _={};m.fontStack&&(_["text-font"]=["literal",m.fontStack.split(",")]),m.scale&&(_["font-scale"]=m.scale),m.textColor&&(_["text-color"]=["rgba"].concat(m.textColor.toArray())),a.push(_)}}return a};var Fa=function(a){this.name=a.name,this.available=a.available};function Fs(a,s,c,m){return typeof a=="number"&&a>=0&&a<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof c=="number"&&c>=0&&c<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:"Invalid rgba value ["+[a,s,c,m].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof m=="number"?[a,s,c,m]:[a,s,c]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function $n(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Ji||a instanceof Va||a instanceof $a||a instanceof Fa)return!0;if(Array.isArray(a)){for(var s=0,c=a;s<c.length;s+=1)if(!$n(c[s]))return!1;return!0}if(typeof a=="object"){for(var m in a)if(!$n(a[m]))return!1;return!0}return!1}function ur(a){if(a===null)return Pn;if(typeof a=="string")return wn;if(typeof a=="boolean")return fn;if(typeof a=="number")return $t;if(a instanceof Ji)return gn;if(a instanceof Va)return Ni;if(a instanceof $a)return sa;if(a instanceof Fa)return Oi;if(Array.isArray(a)){for(var s,c=a.length,m=0,_=a;m<_.length;m+=1){var S=ur(_[m]);if(s){if(s===S)continue;s=xn;break}s=S}return Zi(s||xn,c)}return Ii}function $s(a){var s=typeof a;return a===null?"":s==="string"||s==="number"||s==="boolean"?String(a):a instanceof Ji||a instanceof $a||a instanceof Fa?a.toString():JSON.stringify(a)}Fa.prototype.toString=function(){return this.name},Fa.fromString=function(a){return a?new Fa({name:a,available:!1}):null},Fa.prototype.serialize=function(){return["image",this.name]};var uo=function(a,s){this.type=a,this.value=s};uo.parse=function(a,s){if(a.length!==2)return s.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!$n(a[1]))return s.error("invalid value");var c=a[1],m=ur(c),_=s.expectedType;return m.kind!=="array"||m.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(m=_),new uo(m,c)},uo.prototype.evaluate=function(){return this.value},uo.prototype.eachChild=function(){},uo.prototype.outputDefined=function(){return!0},uo.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ji?["rgba"].concat(this.value.toArray()):this.value instanceof $a?this.value.serialize():this.value};var Ja=function(a){this.name="ExpressionEvaluationError",this.message=a};Ja.prototype.toJSON=function(){return this.message};var eo={string:wn,number:$t,boolean:fn,object:Ii},wt=function(a,s){this.type=a,this.args=s};wt.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var c,m=1,_=a[0];if(_==="array"){var S,C;if(a.length>2){var P=a[1];if(typeof P!="string"||!(P in eo)||P==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);S=eo[P],m++}else S=xn;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return s.error('The length argument to "array" must be a positive integer literal',2);C=a[2],m++}c=Zi(S,C)}else c=eo[_];for(var D=[];m<a.length;m++){var j=s.parse(a[m],m,xn);if(!j)return null;D.push(j)}return new wt(c,D)},wt.prototype.evaluate=function(a){for(var s=0;s<this.args.length;s++){var c=this.args[s].evaluate(a);if(!ha(this.type,ur(c)))return c;if(s===this.args.length-1)throw new Ja("Expected value to be of type "+Fi(this.type)+", but found "+Fi(ur(c))+" instead.")}return null},wt.prototype.eachChild=function(a){this.args.forEach(a)},wt.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},wt.prototype.serialize=function(){var a=this.type,s=[a.kind];if(a.kind==="array"){var c=a.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){s.push(c.kind);var m=a.N;(typeof m=="number"||this.args.length>1)&&s.push(m)}}return s.concat(this.args.map(function(_){return _.serialize()}))};var zt=function(a){this.type=sa,this.sections=a};zt.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var c=a[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");for(var m=[],_=!1,S=1;S<=a.length-1;++S){var C=a[S];if(_&&typeof C=="object"&&!Array.isArray(C)){_=!1;var P=null;if(C["font-scale"]&&!(P=s.parse(C["font-scale"],1,$t)))return null;var D=null;if(C["text-font"]&&!(D=s.parse(C["text-font"],1,Zi(wn))))return null;var j=null;if(C["text-color"]&&!(j=s.parse(C["text-color"],1,gn)))return null;var B=m[m.length-1];B.scale=P,B.font=D,B.textColor=j}else{var K=s.parse(a[S],1,xn);if(!K)return null;var V=K.type.kind;if(V!=="string"&&V!=="value"&&V!=="null"&&V!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,m.push({content:K,scale:null,font:null,textColor:null})}}return new zt(m)},zt.prototype.evaluate=function(a){return new $a(this.sections.map(function(s){var c=s.content.evaluate(a);return ur(c)===Oi?new tu("",c,null,null,null):new tu($s(c),null,s.scale?s.scale.evaluate(a):null,s.font?s.font.evaluate(a).join(","):null,s.textColor?s.textColor.evaluate(a):null)}))},zt.prototype.eachChild=function(a){for(var s=0,c=this.sections;s<c.length;s+=1){var m=c[s];a(m.content),m.scale&&a(m.scale),m.font&&a(m.font),m.textColor&&a(m.textColor)}},zt.prototype.outputDefined=function(){return!1},zt.prototype.serialize=function(){for(var a=["format"],s=0,c=this.sections;s<c.length;s+=1){var m=c[s];a.push(m.content.serialize());var _={};m.scale&&(_["font-scale"]=m.scale.serialize()),m.font&&(_["text-font"]=m.font.serialize()),m.textColor&&(_["text-color"]=m.textColor.serialize()),a.push(_)}return a};var rs=function(a){this.type=Oi,this.input=a};rs.parse=function(a,s){if(a.length!==2)return s.error("Expected two arguments.");var c=s.parse(a[1],1,wn);return c?new rs(c):s.error("No image name provided.")},rs.prototype.evaluate=function(a){var s=this.input.evaluate(a),c=Fa.fromString(s);return c&&a.availableImages&&(c.available=a.availableImages.indexOf(s)>-1),c},rs.prototype.eachChild=function(a){a(this.input)},rs.prototype.outputDefined=function(){return!1},rs.prototype.serialize=function(){return["image",this.input.serialize()]};var du={"to-boolean":fn,"to-color":gn,"to-number":$t,"to-string":wn},Io=function(a,s){this.type=a,this.args=s};Io.parse=function(a,s){if(a.length<2)return s.error("Expected at least one argument.");var c=a[0];if((c==="to-boolean"||c==="to-string")&&a.length!==2)return s.error("Expected one argument.");for(var m=du[c],_=[],S=1;S<a.length;S++){var C=s.parse(a[S],S,xn);if(!C)return null;_.push(C)}return new Io(m,_)},Io.prototype.evaluate=function(a){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(a));if(this.type.kind==="color"){for(var s,c,m=0,_=this.args;m<_.length;m+=1){if(c=null,(s=_[m].evaluate(a))instanceof Ji)return s;if(typeof s=="string"){var S=a.parseColor(s);if(S)return S}else if(Array.isArray(s)&&!(c=s.length<3||s.length>4?"Invalid rbga value "+JSON.stringify(s)+": expected an array containing either three or four numeric values.":Fs(s[0],s[1],s[2],s[3])))return new Ji(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Ja(c||"Could not parse color from value '"+(typeof s=="string"?s:String(JSON.stringify(s)))+"'")}if(this.type.kind==="number"){for(var C=null,P=0,D=this.args;P<D.length;P+=1){if((C=D[P].evaluate(a))===null)return 0;var j=Number(C);if(!isNaN(j))return j}throw new Ja("Could not convert "+JSON.stringify(C)+" to number.")}return this.type.kind==="formatted"?$a.fromString($s(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?Fa.fromString($s(this.args[0].evaluate(a))):$s(this.args[0].evaluate(a))},Io.prototype.eachChild=function(a){this.args.forEach(a)},Io.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Io.prototype.serialize=function(){if(this.type.kind==="formatted")return new zt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new rs(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild(function(s){a.push(s.serialize())}),a};var za=["Unknown","Point","LineString","Polygon"],Sa=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Sa.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Sa.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?za[this.feature.type]:this.feature.type:null},Sa.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Sa.prototype.canonicalID=function(){return this.canonical},Sa.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Sa.prototype.parseColor=function(a){var s=this._parseColorCache[a];return s||(s=this._parseColorCache[a]=Ji.parse(a)),s};var xo=function(a,s,c,m){this.name=a,this.type=s,this._evaluate=c,this.args=m};xo.prototype.evaluate=function(a){return this._evaluate(a,this.args)},xo.prototype.eachChild=function(a){this.args.forEach(a)},xo.prototype.outputDefined=function(){return!1},xo.prototype.serialize=function(){return[this.name].concat(this.args.map(function(a){return a.serialize()}))},xo.parse=function(a,s){var c,m=a[0],_=xo.definitions[m];if(!_)return s.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0);for(var S=Array.isArray(_)?_[0]:_.type,C=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,P=C.filter(function(si){var On=si[0];return!Array.isArray(On)||On.length===a.length-1}),D=null,j=0,B=P;j<B.length;j+=1){var K=B[j],V=K[0],de=K[1];D=new ks(s.registry,s.path,null,s.scope);for(var ze=[],Ue=!1,st=1;st<a.length;st++){var Ke=a[st],St=Array.isArray(V)?V[st-1]:V.type,jt=D.parse(Ke,1+ze.length,St);if(!jt){Ue=!0;break}ze.push(jt)}if(!Ue)if(Array.isArray(V)&&V.length!==ze.length)D.error("Expected "+V.length+" arguments, but found "+ze.length+" instead.");else{for(var or=0;or<ze.length;or++){var lr=Array.isArray(V)?V[or]:V.type,Cr=ze[or];D.concat(or+1).checkSubtype(lr,Cr.type)}if(D.errors.length===0)return new xo(m,S,de,ze)}}if(P.length===1)(c=s.errors).push.apply(c,D.errors);else{for(var Qr=(P.length?P:C).map(function(si){var On;return On=si[0],Array.isArray(On)?"("+On.map(Fi).join(", ")+")":"("+Fi(On.type)+"...)"}).join(" | "),dn=[],ti=1;ti<a.length;ti++){var Rn=s.parse(a[ti],1+dn.length);if(!Rn)return null;dn.push(Fi(Rn.type))}s.error("Expected arguments of type "+Qr+", but found ("+dn.join(", ")+") instead.")}return null},xo.register=function(a,s){for(var c in xo.definitions=s,s)a[c]=xo};var Dr=function(a,s,c){this.type=Ni,this.locale=c,this.caseSensitive=a,this.diacriticSensitive=s};function Rr(a,s){a[0]=Math.min(a[0],s[0]),a[1]=Math.min(a[1],s[1]),a[2]=Math.max(a[2],s[0]),a[3]=Math.max(a[3],s[1])}function Qe(a,s){return!(a[0]<=s[0]||a[2]>=s[2]||a[1]<=s[1]||a[3]>=s[3])}function Fu(a,s){var c=(180+a[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,_=Math.pow(2,s.z);return[Math.round(c*_*8192),Math.round(m*_*8192)]}function He(a,s,c){return s[1]>a[1]!=c[1]>a[1]&&a[0]<(c[0]-s[0])*(a[1]-s[1])/(c[1]-s[1])+s[0]}function fe(a,s){for(var c,m,_,S,C,P,D,j=!1,B=0,K=s.length;B<K;B++)for(var V=s[B],de=0,ze=V.length;de<ze-1;de++){if((S=(c=a)[0]-(m=V[de])[0])*(D=c[1]-(_=V[de+1])[1])-(P=c[0]-_[0])*(C=c[1]-m[1])==0&&S*P<=0&&C*D<=0)return!1;He(a,V[de],V[de+1])&&(j=!j)}return j}function Pe(a,s){for(var c=0;c<s.length;c++)if(fe(a,s[c]))return!0;return!1}function ht(a,s,c,m){var _=m[0]-c[0],S=m[1]-c[1],C=(a[0]-c[0])*S-_*(a[1]-c[1]),P=(s[0]-c[0])*S-_*(s[1]-c[1]);return C>0&&P<0||C<0&&P>0}function Kt(a,s,c){for(var m=0,_=c;m<_.length;m+=1)for(var S=_[m],C=0;C<S.length-1;++C)if((K=[(B=S[C+1])[0]-(j=S[C])[0],B[1]-j[1]])[0]*(V=[(D=s)[0]-(P=a)[0],D[1]-P[1]])[1]-K[1]*V[0]!=0&&ht(P,D,j,B)&&ht(j,B,P,D))return!0;var P,D,j,B,K,V;return!1}function en(a,s){for(var c=0;c<a.length;++c)if(!fe(a[c],s))return!1;for(var m=0;m<a.length-1;++m)if(Kt(a[m],a[m+1],s))return!1;return!0}function qn(a,s){for(var c=0;c<s.length;c++)if(en(a,s[c]))return!0;return!1}function Ui(a,s,c){for(var m=[],_=0;_<a.length;_++){for(var S=[],C=0;C<a[_].length;C++){var P=Fu(a[_][C],c);Rr(s,P),S.push(P)}m.push(S)}return m}function lo(a,s,c){for(var m=[],_=0;_<a.length;_++){var S=Ui(a[_],s,c);m.push(S)}return m}function Ya(a,s,c,m){if(a[0]<c[0]||a[0]>c[2]){var _=.5*m,S=a[0]-c[0]>_?-m:c[0]-a[0]>_?m:0;S===0&&(S=a[0]-c[2]>_?-m:c[2]-a[0]>_?m:0),a[0]+=S}Rr(s,a)}function to(a,s,c,m){for(var _=8192*Math.pow(2,m.z),S=[8192*m.x,8192*m.y],C=[],P=0,D=a;P<D.length;P+=1)for(var j=0,B=D[P];j<B.length;j+=1){var K=B[j],V=[K.x+S[0],K.y+S[1]];Ya(V,s,c,_),C.push(V)}return C}function $o(a,s,c,m){for(var _,S=8192*Math.pow(2,m.z),C=[8192*m.x,8192*m.y],P=[],D=0,j=a;D<j.length;D+=1){for(var B=[],K=0,V=j[D];K<V.length;K+=1){var de=V[K],ze=[de.x+C[0],de.y+C[1]];Rr(s,ze),B.push(ze)}P.push(B)}if(s[2]-s[0]<=S/2){(_=s)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(var Ue=0,st=P;Ue<st.length;Ue+=1)for(var Ke=0,St=st[Ue];Ke<St.length;Ke+=1)Ya(St[Ke],s,c,S)}return P}Dr.parse=function(a,s){if(a.length!==2)return s.error("Expected one argument.");var c=a[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");var m=s.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,fn);if(!m)return null;var _=s.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,fn);if(!_)return null;var S=null;return c.locale&&!(S=s.parse(c.locale,1,wn))?null:new Dr(m,_,S)},Dr.prototype.evaluate=function(a){return new Va(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},Dr.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},Dr.prototype.outputDefined=function(){return!1},Dr.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var Ms=function(a,s){this.type=fn,this.geojson=a,this.geometries=s};function Vo(a){if(a instanceof xo&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Ms)return!1;var s=!0;return a.eachChild(function(c){s&&!Vo(c)&&(s=!1)}),s}function fs(a){if(a instanceof xo&&a.name==="feature-state")return!1;var s=!0;return a.eachChild(function(c){s&&!fs(c)&&(s=!1)}),s}function hs(a,s){if(a instanceof xo&&s.indexOf(a.name)>=0)return!1;var c=!0;return a.eachChild(function(m){c&&!hs(m,s)&&(c=!1)}),c}Ms.parse=function(a,s){if(a.length!==2)return s.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if($n(a[1])){var c=a[1];if(c.type==="FeatureCollection")for(var m=0;m<c.features.length;++m){var _=c.features[m].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Ms(c,c.features[m].geometry)}else if(c.type==="Feature"){var S=c.geometry.type;if(S==="Polygon"||S==="MultiPolygon")return new Ms(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Ms(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Ms.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(s,c){var m=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],S=s.canonicalID();if(c.type==="Polygon"){var C=Ui(c.coordinates,_,S),P=to(s.geometry(),m,_,S);if(!Qe(m,_))return!1;for(var D=0,j=P;D<j.length;D+=1)if(!fe(j[D],C))return!1}if(c.type==="MultiPolygon"){var B=lo(c.coordinates,_,S),K=to(s.geometry(),m,_,S);if(!Qe(m,_))return!1;for(var V=0,de=K;V<de.length;V+=1)if(!Pe(de[V],B))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(s,c){var m=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],S=s.canonicalID();if(c.type==="Polygon"){var C=Ui(c.coordinates,_,S),P=$o(s.geometry(),m,_,S);if(!Qe(m,_))return!1;for(var D=0,j=P;D<j.length;D+=1)if(!en(j[D],C))return!1}if(c.type==="MultiPolygon"){var B=lo(c.coordinates,_,S),K=$o(s.geometry(),m,_,S);if(!Qe(m,_))return!1;for(var V=0,de=K;V<de.length;V+=1)if(!qn(de[V],B))return!1}return!0}(a,this.geometries)}return!1},Ms.prototype.eachChild=function(){},Ms.prototype.outputDefined=function(){return!0},Ms.prototype.serialize=function(){return["within",this.geojson]};var ys=function(a,s){this.type=s.type,this.name=a,this.boundExpression=s};ys.parse=function(a,s){if(a.length!==2||typeof a[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");var c=a[1];return s.scope.has(c)?new ys(c,s.scope.get(c)):s.error('Unknown variable "'+c+'". Make sure "'+c+'" has been bound in an enclosing "let" expression before using it.',1)},ys.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},ys.prototype.eachChild=function(){},ys.prototype.outputDefined=function(){return!1},ys.prototype.serialize=function(){return["var",this.name]};var ks=function(a,s,c,m,_){s===void 0&&(s=[]),m===void 0&&(m=new In),_===void 0&&(_=[]),this.registry=a,this.path=s,this.key=s.map(function(S){return"["+S+"]"}).join(""),this.scope=m,this.errors=_,this.expectedType=c};function ru(a,s){for(var c,m=a.length-1,_=0,S=m,C=0;_<=S;)if((c=a[C=Math.floor((_+S)/2)])<=s){if(C===m||s<a[C+1])return C;_=C+1}else{if(!(c>s))throw new Ja("Input is not a number.");S=C-1}return 0}ks.prototype.parse=function(a,s,c,m,_){return _===void 0&&(_={}),s?this.concat(s,c,m)._parse(a,_):this._parse(a,_)},ks.prototype._parse=function(a,s){function c(j,B,K){return K==="assert"?new wt(B,[j]):K==="coerce"?new Io(B,[j]):j}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var m=a[0];if(typeof m!="string")return this.error("Expression name must be a string, but found "+typeof m+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var _=this.registry[m];if(_){var S=_.parse(a,this);if(!S)return null;if(this.expectedType){var C=this.expectedType,P=S.type;if(C.kind!=="string"&&C.kind!=="number"&&C.kind!=="boolean"&&C.kind!=="object"&&C.kind!=="array"||P.kind!=="value")if(C.kind!=="color"&&C.kind!=="formatted"&&C.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(C,P))return null}else S=c(S,C,s.typeAnnotation||"coerce");else S=c(S,C,s.typeAnnotation||"assert")}if(!(S instanceof uo)&&S.type.kind!=="resolvedImage"&&function j(B){if(B instanceof ys)return j(B.boundExpression);if(B instanceof xo&&B.name==="error"||B instanceof Dr||B instanceof Ms)return!1;var K=B instanceof Io||B instanceof wt,V=!0;return B.eachChild(function(de){V=K?V&&j(de):V&&de instanceof uo}),!!V&&Vo(B)&&hs(B,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(S)){var D=new Sa;try{S=new uo(S.type,S.evaluate(D))}catch(j){return this.error(j.message),null}}return S}return this.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},ks.prototype.concat=function(a,s,c){var m=typeof a=="number"?this.path.concat(a):this.path,_=c?this.scope.concat(c):this.scope;return new ks(this.registry,m,s||null,_,this.errors)},ks.prototype.error=function(a){for(var s=[],c=arguments.length-1;c-- >0;)s[c]=arguments[c+1];var m=""+this.key+s.map(function(_){return"["+_+"]"}).join("");this.errors.push(new Fr(m,a))},ks.prototype.checkSubtype=function(a,s){var c=ha(a,s);return c&&this.error(c),c};var _s=function(a,s,c){this.type=a,this.input=s,this.labels=[],this.outputs=[];for(var m=0,_=c;m<_.length;m+=1){var S=_[m],C=S[1];this.labels.push(S[0]),this.outputs.push(C)}};function ya(a,s,c){return a*(1-c)+s*c}_s.parse=function(a,s){if(a.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return s.error("Expected an even number of arguments.");var c=s.parse(a[1],1,$t);if(!c)return null;var m=[],_=null;s.expectedType&&s.expectedType.kind!=="value"&&(_=s.expectedType);for(var S=1;S<a.length;S+=2){var C=S===1?-1/0:a[S],P=a[S+1],D=S,j=S+1;if(typeof C!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(m.length&&m[m.length-1][0]>=C)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);var B=s.parse(P,j,_);if(!B)return null;_=_||B.type,m.push([C,B])}return new _s(_,c,m)},_s.prototype.evaluate=function(a){var s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(a);var m=this.input.evaluate(a);if(m<=s[0])return c[0].evaluate(a);var _=s.length;return m>=s[_-1]?c[_-1].evaluate(a):c[ru(s,m)].evaluate(a)},_s.prototype.eachChild=function(a){a(this.input);for(var s=0,c=this.outputs;s<c.length;s+=1)a(c[s])},_s.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},_s.prototype.serialize=function(){for(var a=["step",this.input.serialize()],s=0;s<this.labels.length;s++)s>0&&a.push(this.labels[s]),a.push(this.outputs[s].serialize());return a};var bo=Object.freeze({__proto__:null,number:ya,color:function(a,s,c){return new Ji(ya(a.r,s.r,c),ya(a.g,s.g,c),ya(a.b,s.b,c),ya(a.a,s.a,c))},array:function(a,s,c){return a.map(function(m,_){return ya(m,s[_],c)})}}),Gu=6/29*3*(6/29),fc=Math.PI/180,Hu=180/Math.PI;function Bc(a){return a>.008856451679035631?Math.pow(a,1/3):a/Gu+4/29}function Il(a){return a>6/29?a*a*a:Gu*(a-4/29)}function ol(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function vu(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function sl(a){var s=vu(a.r),c=vu(a.g),m=vu(a.b),_=Bc((.4124564*s+.3575761*c+.1804375*m)/.95047),S=Bc((.2126729*s+.7151522*c+.072175*m)/1);return{l:116*S-16,a:500*(_-S),b:200*(S-Bc((.0193339*s+.119192*c+.9503041*m)/1.08883)),alpha:a.a}}function b(a){var s=(a.l+16)/116,c=isNaN(a.a)?s:s+a.a/500,m=isNaN(a.b)?s:s-a.b/200;return s=1*Il(s),c=.95047*Il(c),m=1.08883*Il(m),new Ji(ol(3.2404542*c-1.5371385*s-.4985314*m),ol(-.969266*c+1.8760108*s+.041556*m),ol(.0556434*c-.2040259*s+1.0572252*m),a.alpha)}function k(a,s,c){var m=s-a;return a+c*(m>180||m<-180?m-360*Math.round(m/360):m)}var Z={forward:sl,reverse:b,interpolate:function(a,s,c){return{l:ya(a.l,s.l,c),a:ya(a.a,s.a,c),b:ya(a.b,s.b,c),alpha:ya(a.alpha,s.alpha,c)}}},R={forward:function(a){var s=sl(a),c=s.l,m=s.a,_=s.b,S=Math.atan2(_,m)*Hu;return{h:S<0?S+360:S,c:Math.sqrt(m*m+_*_),l:c,alpha:a.a}},reverse:function(a){var s=a.h*fc,c=a.c;return b({l:a.l,a:Math.cos(s)*c,b:Math.sin(s)*c,alpha:a.alpha})},interpolate:function(a,s,c){return{h:k(a.h,s.h,c),c:ya(a.c,s.c,c),l:ya(a.l,s.l,c),alpha:ya(a.alpha,s.alpha,c)}}},te=Object.freeze({__proto__:null,lab:Z,hcl:R}),Me=function(a,s,c,m,_){this.type=a,this.operator=s,this.interpolation=c,this.input=m,this.labels=[],this.outputs=[];for(var S=0,C=_;S<C.length;S+=1){var P=C[S],D=P[1];this.labels.push(P[0]),this.outputs.push(D)}};function at(a,s,c,m){var _=m-c,S=a-c;return _===0?0:s===1?S/_:(Math.pow(s,S)-1)/(Math.pow(s,_)-1)}Me.interpolationFactor=function(a,s,c,m){var _=0;if(a.name==="exponential")_=at(s,a.base,c,m);else if(a.name==="linear")_=at(s,1,c,m);else if(a.name==="cubic-bezier"){var S=a.controlPoints;_=new X(S[0],S[1],S[2],S[3]).solve(at(s,1,c,m))}return _},Me.parse=function(a,s){var c=a[0],m=a[1],_=a[2],S=a.slice(3);if(!Array.isArray(m)||m.length===0)return s.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){var C=m[1];if(typeof C!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:C}}else{if(m[0]!=="cubic-bezier")return s.error("Unknown interpolation type "+String(m[0]),1,0);var P=m.slice(1);if(P.length!==4||P.some(function(st){return typeof st!="number"||st<0||st>1}))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:P}}if(a.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(!(_=s.parse(_,2,$t)))return null;var D=[],j=null;c==="interpolate-hcl"||c==="interpolate-lab"?j=gn:s.expectedType&&s.expectedType.kind!=="value"&&(j=s.expectedType);for(var B=0;B<S.length;B+=2){var K=S[B],V=S[B+1],de=B+3,ze=B+4;if(typeof K!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',de);if(D.length&&D[D.length-1][0]>=K)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',de);var Ue=s.parse(V,ze,j);if(!Ue)return null;j=j||Ue.type,D.push([K,Ue])}return j.kind==="number"||j.kind==="color"||j.kind==="array"&&j.itemType.kind==="number"&&typeof j.N=="number"?new Me(j,c,m,_,D):s.error("Type "+Fi(j)+" is not interpolatable.")},Me.prototype.evaluate=function(a){var s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(a);var m=this.input.evaluate(a);if(m<=s[0])return c[0].evaluate(a);var _=s.length;if(m>=s[_-1])return c[_-1].evaluate(a);var S=ru(s,m),C=Me.interpolationFactor(this.interpolation,m,s[S],s[S+1]),P=c[S].evaluate(a),D=c[S+1].evaluate(a);return this.operator==="interpolate"?bo[this.type.kind.toLowerCase()](P,D,C):this.operator==="interpolate-hcl"?R.reverse(R.interpolate(R.forward(P),R.forward(D),C)):Z.reverse(Z.interpolate(Z.forward(P),Z.forward(D),C))},Me.prototype.eachChild=function(a){a(this.input);for(var s=0,c=this.outputs;s<c.length;s+=1)a(c[s])},Me.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Me.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var s=[this.operator,a,this.input.serialize()],c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s};var Rt=function(a,s){this.type=a,this.args=s};Rt.parse=function(a,s){if(a.length<2)return s.error("Expectected at least one argument.");var c=null,m=s.expectedType;m&&m.kind!=="value"&&(c=m);for(var _=[],S=0,C=a.slice(1);S<C.length;S+=1){var P=s.parse(C[S],1+_.length,c,void 0,{typeAnnotation:"omit"});if(!P)return null;c=c||P.type,_.push(P)}var D=m&&_.some(function(j){return ha(m,j.type)});return new Rt(D?xn:c,_)},Rt.prototype.evaluate=function(a){for(var s,c=null,m=0,_=0,S=this.args;_<S.length&&(m++,(c=S[_].evaluate(a))&&c instanceof Fa&&!c.available&&(s||(s=c.name),c=null,m===this.args.length&&(c=s)),c===null);_+=1);return c},Rt.prototype.eachChild=function(a){this.args.forEach(a)},Rt.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Rt.prototype.serialize=function(){var a=["coalesce"];return this.eachChild(function(s){a.push(s.serialize())}),a};var Lt=function(a,s){this.type=s.type,this.bindings=[].concat(a),this.result=s};Lt.prototype.evaluate=function(a){return this.result.evaluate(a)},Lt.prototype.eachChild=function(a){for(var s=0,c=this.bindings;s<c.length;s+=1)a(c[s][1]);a(this.result)},Lt.parse=function(a,s){if(a.length<4)return s.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var c=[],m=1;m<a.length-1;m+=2){var _=a[m];if(typeof _!="string")return s.error("Expected string, but found "+typeof _+" instead.",m);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",m);var S=s.parse(a[m+1],m+1);if(!S)return null;c.push([_,S])}var C=s.parse(a[a.length-1],a.length-1,s.expectedType,c);return C?new Lt(c,C):null},Lt.prototype.outputDefined=function(){return this.result.outputDefined()},Lt.prototype.serialize=function(){for(var a=["let"],s=0,c=this.bindings;s<c.length;s+=1){var m=c[s];a.push(m[0],m[1].serialize())}return a.push(this.result.serialize()),a};var Ar=function(a,s,c){this.type=a,this.index=s,this.input=c};Ar.parse=function(a,s){if(a.length!==3)return s.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,$t),m=s.parse(a[2],2,Zi(s.expectedType||xn));return c&&m?new Ar(m.type.itemType,c,m):null},Ar.prototype.evaluate=function(a){var s=this.index.evaluate(a),c=this.input.evaluate(a);if(s<0)throw new Ja("Array index out of bounds: "+s+" < 0.");if(s>=c.length)throw new Ja("Array index out of bounds: "+s+" > "+(c.length-1)+".");if(s!==Math.floor(s))throw new Ja("Array index must be an integer, but found "+s+" instead.");return c[s]},Ar.prototype.eachChild=function(a){a(this.index),a(this.input)},Ar.prototype.outputDefined=function(){return!1},Ar.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Tr=function(a,s){this.type=fn,this.needle=a,this.haystack=s};Tr.parse=function(a,s){if(a.length!==3)return s.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,xn),m=s.parse(a[2],2,xn);return c&&m?Xa(c.type,[fn,wn,$t,Pn,xn])?new Tr(c,m):s.error("Expected first argument to be of type boolean, string, number or null, but found "+Fi(c.type)+" instead"):null},Tr.prototype.evaluate=function(a){var s=this.needle.evaluate(a),c=this.haystack.evaluate(a);if(!c)return!1;if(!ga(s,["boolean","string","number","null"]))throw new Ja("Expected first argument to be of type boolean, string, number or null, but found "+Fi(ur(s))+" instead.");if(!ga(c,["string","array"]))throw new Ja("Expected second argument to be of type array or string, but found "+Fi(ur(c))+" instead.");return c.indexOf(s)>=0},Tr.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},Tr.prototype.outputDefined=function(){return!0},Tr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Fn=function(a,s,c){this.type=$t,this.needle=a,this.haystack=s,this.fromIndex=c};Fn.parse=function(a,s){if(a.length<=2||a.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,xn),m=s.parse(a[2],2,xn);if(!c||!m)return null;if(!Xa(c.type,[fn,wn,$t,Pn,xn]))return s.error("Expected first argument to be of type boolean, string, number or null, but found "+Fi(c.type)+" instead");if(a.length===4){var _=s.parse(a[3],3,$t);return _?new Fn(c,m,_):null}return new Fn(c,m)},Fn.prototype.evaluate=function(a){var s=this.needle.evaluate(a),c=this.haystack.evaluate(a);if(!ga(s,["boolean","string","number","null"]))throw new Ja("Expected first argument to be of type boolean, string, number or null, but found "+Fi(ur(s))+" instead.");if(!ga(c,["string","array"]))throw new Ja("Expected second argument to be of type array or string, but found "+Fi(ur(c))+" instead.");if(this.fromIndex){var m=this.fromIndex.evaluate(a);return c.indexOf(s,m)}return c.indexOf(s)},Fn.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},Fn.prototype.outputDefined=function(){return!1},Fn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Ai=function(a,s,c,m,_,S){this.inputType=a,this.type=s,this.input=c,this.cases=m,this.outputs=_,this.otherwise=S};Ai.parse=function(a,s){if(a.length<5)return s.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return s.error("Expected an even number of arguments.");var c,m;s.expectedType&&s.expectedType.kind!=="value"&&(m=s.expectedType);for(var _={},S=[],C=2;C<a.length-1;C+=2){var P=a[C],D=a[C+1];Array.isArray(P)||(P=[P]);var j=s.concat(C);if(P.length===0)return j.error("Expected at least one branch label.");for(var B=0,K=P;B<K.length;B+=1){var V=K[B];if(typeof V!="number"&&typeof V!="string")return j.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return j.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof V=="number"&&Math.floor(V)!==V)return j.error("Numeric branch labels must be integer values.");if(c){if(j.checkSubtype(c,ur(V)))return null}else c=ur(V);if(_[String(V)]!==void 0)return j.error("Branch labels must be unique.");_[String(V)]=S.length}var de=s.parse(D,C,m);if(!de)return null;m=m||de.type,S.push(de)}var ze=s.parse(a[1],1,xn);if(!ze)return null;var Ue=s.parse(a[a.length-1],a.length-1,m);return Ue?ze.type.kind!=="value"&&s.concat(1).checkSubtype(c,ze.type)?null:new Ai(c,m,ze,_,S,Ue):null},Ai.prototype.evaluate=function(a){var s=this.input.evaluate(a);return(ur(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(a)},Ai.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},Ai.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})&&this.otherwise.outputDefined()},Ai.prototype.serialize=function(){for(var a=this,s=["match",this.input.serialize()],c=[],m={},_=0,S=Object.keys(this.cases).sort();_<S.length;_+=1){var C=S[_];(K=m[this.cases[C]])===void 0?(m[this.cases[C]]=c.length,c.push([this.cases[C],[C]])):c[K][1].push(C)}for(var P=function(de){return a.inputType.kind==="number"?Number(de):de},D=0,j=c;D<j.length;D+=1){var B=j[D],K=B[0],V=B[1];s.push(V.length===1?P(V[0]):V.map(P)),s.push(this.outputs[outputIndex$1].serialize())}return s.push(this.otherwise.serialize()),s};var _i=function(a,s,c){this.type=a,this.branches=s,this.otherwise=c};_i.parse=function(a,s){if(a.length<4)return s.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return s.error("Expected an odd number of arguments.");var c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);for(var m=[],_=1;_<a.length-1;_+=2){var S=s.parse(a[_],_,fn);if(!S)return null;var C=s.parse(a[_+1],_+1,c);if(!C)return null;m.push([S,C]),c=c||C.type}var P=s.parse(a[a.length-1],a.length-1,c);return P?new _i(c,m,P):null},_i.prototype.evaluate=function(a){for(var s=0,c=this.branches;s<c.length;s+=1){var m=c[s],_=m[1];if(m[0].evaluate(a))return _.evaluate(a)}return this.otherwise.evaluate(a)},_i.prototype.eachChild=function(a){for(var s=0,c=this.branches;s<c.length;s+=1){var m=c[s],_=m[1];a(m[0]),a(_)}a(this.otherwise)},_i.prototype.outputDefined=function(){return this.branches.every(function(a){return a[1].outputDefined()})&&this.otherwise.outputDefined()},_i.prototype.serialize=function(){var a=["case"];return this.eachChild(function(s){a.push(s.serialize())}),a};var Di=function(a,s,c,m){this.type=a,this.input=s,this.beginIndex=c,this.endIndex=m};function Ia(a,s){return a==="=="||a==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function Da(a,s,c,m){return m.compare(s,c)===0}function ea(a,s,c){var m=a!=="=="&&a!=="!=";return function(){function _(S,C,P){this.type=fn,this.lhs=S,this.rhs=C,this.collator=P,this.hasUntypedArgument=S.type.kind==="value"||C.type.kind==="value"}return _.parse=function(S,C){if(S.length!==3&&S.length!==4)return C.error("Expected two or three arguments.");var P=S[0],D=C.parse(S[1],1,xn);if(!D)return null;if(!Ia(P,D.type))return C.concat(1).error('"'+P+`" comparisons are not supported for type '`+Fi(D.type)+"'.");var j=C.parse(S[2],2,xn);if(!j)return null;if(!Ia(P,j.type))return C.concat(2).error('"'+P+`" comparisons are not supported for type '`+Fi(j.type)+"'.");if(D.type.kind!==j.type.kind&&D.type.kind!=="value"&&j.type.kind!=="value")return C.error("Cannot compare types '"+Fi(D.type)+"' and '"+Fi(j.type)+"'.");m&&(D.type.kind==="value"&&j.type.kind!=="value"?D=new wt(j.type,[D]):D.type.kind!=="value"&&j.type.kind==="value"&&(j=new wt(D.type,[j])));var B=null;if(S.length===4){if(D.type.kind!=="string"&&j.type.kind!=="string"&&D.type.kind!=="value"&&j.type.kind!=="value")return C.error("Cannot use collator to compare non-string types.");if(!(B=C.parse(S[3],3,Ni)))return null}return new _(D,j,B)},_.prototype.evaluate=function(S){var C=this.lhs.evaluate(S),P=this.rhs.evaluate(S);if(m&&this.hasUntypedArgument){var D=ur(C),j=ur(P);if(D.kind!==j.kind||D.kind!=="string"&&D.kind!=="number")throw new Ja('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+D.kind+", "+j.kind+") instead.")}if(this.collator&&!m&&this.hasUntypedArgument){var B=ur(C),K=ur(P);if(B.kind!=="string"||K.kind!=="string")return s(S,C,P)}return this.collator?c(S,C,P,this.collator.evaluate(S)):s(S,C,P)},_.prototype.eachChild=function(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)},_.prototype.outputDefined=function(){return!0},_.prototype.serialize=function(){var S=[a];return this.eachChild(function(C){S.push(C.serialize())}),S},_}()}Di.parse=function(a,s){if(a.length<=2||a.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1,xn),m=s.parse(a[2],2,$t);if(!c||!m)return null;if(!Xa(c.type,[Zi(xn),wn,xn]))return s.error("Expected first argument to be of type array or string, but found "+Fi(c.type)+" instead");if(a.length===4){var _=s.parse(a[3],3,$t);return _?new Di(c.type,c,m,_):null}return new Di(c.type,c,m)},Di.prototype.evaluate=function(a){var s=this.input.evaluate(a),c=this.beginIndex.evaluate(a);if(!ga(s,["string","array"]))throw new Ja("Expected first argument to be of type array or string, but found "+Fi(ur(s))+" instead.");if(this.endIndex){var m=this.endIndex.evaluate(a);return s.slice(c,m)}return s.slice(c)},Di.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},Di.prototype.outputDefined=function(){return!1},Di.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var xs=ea("==",function(a,s,c){return s===c},Da),bu=ea("!=",function(a,s,c){return s!==c},function(a,s,c,m){return!Da(0,s,c,m)}),ul=ea("<",function(a,s,c){return s<c},function(a,s,c,m){return m.compare(s,c)<0}),vf=ea(">",function(a,s,c){return s>c},function(a,s,c,m){return m.compare(s,c)>0}),mu=ea("<=",function(a,s,c){return s<=c},function(a,s,c,m){return m.compare(s,c)<=0}),Ds=ea(">=",function(a,s,c){return s>=c},function(a,s,c,m){return m.compare(s,c)>=0}),Du=function(a,s,c,m,_){this.type=wn,this.number=a,this.locale=s,this.currency=c,this.minFractionDigits=m,this.maxFractionDigits=_};Du.parse=function(a,s){if(a.length!==3)return s.error("Expected two arguments.");var c=s.parse(a[1],1,$t);if(!c)return null;var m=a[2];if(typeof m!="object"||Array.isArray(m))return s.error("NumberFormat options argument must be an object.");var _=null;if(m.locale&&!(_=s.parse(m.locale,1,wn)))return null;var S=null;if(m.currency&&!(S=s.parse(m.currency,1,wn)))return null;var C=null;if(m["min-fraction-digits"]&&!(C=s.parse(m["min-fraction-digits"],1,$t)))return null;var P=null;return m["max-fraction-digits"]&&!(P=s.parse(m["max-fraction-digits"],1,$t))?null:new Du(c,_,S,C,P)},Du.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},Du.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},Du.prototype.outputDefined=function(){return!1},Du.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var gu=function(a){this.type=$t,this.input=a};gu.parse=function(a,s){if(a.length!==2)return s.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var c=s.parse(a[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error("Expected argument of type string or array, but found "+Fi(c.type)+" instead."):new gu(c):null},gu.prototype.evaluate=function(a){var s=this.input.evaluate(a);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Ja("Expected value to be of type string or array, but found "+Fi(ur(s))+" instead.")},gu.prototype.eachChild=function(a){a(this.input)},gu.prototype.outputDefined=function(){return!1},gu.prototype.serialize=function(){var a=["length"];return this.eachChild(function(s){a.push(s.serialize())}),a};var Bu={"==":xs,"!=":bu,">":vf,"<":ul,">=":Ds,"<=":mu,array:wt,at:Ar,boolean:wt,case:_i,coalesce:Rt,collator:Dr,format:zt,image:rs,in:Tr,"index-of":Fn,interpolate:Me,"interpolate-hcl":Me,"interpolate-lab":Me,length:gu,let:Lt,literal:uo,match:Ai,number:wt,"number-format":Du,object:wt,slice:Di,step:_s,string:wt,"to-boolean":Io,"to-color":Io,"to-number":Io,"to-string":Io,var:ys,within:Ms};function Eo(a,s){var c=s[0],m=s[1],_=s[2],S=s[3];c=c.evaluate(a),m=m.evaluate(a),_=_.evaluate(a);var C=S?S.evaluate(a):1,P=Fs(c,m,_,C);if(P)throw new Ja(P);return new Ji(c/255*C,m/255*C,_/255*C,C)}function Nc(a,s){return a in s}function Is(a,s){var c=s[a];return c===void 0?null:c}function ns(a){return{type:a}}function hc(a){return{result:"success",value:a}}function Po(a){return{result:"error",value:a}}function nu(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function zc(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function ll(a){return!!a.expression&&a.expression.interpolated}function Pa(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function Pl(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function Gf(a){return a}function Wu(a,s,c){return a!==void 0?a:s!==void 0?s:c!==void 0?c:void 0}function Hf(a,s,c,m,_){return Wu(typeof c===_?m[c]:void 0,a.default,s.default)}function tp(a,s,c){if(Pa(c)!=="number")return Wu(a.default,s.default);var m=a.stops.length;if(m===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[m-1][0])return a.stops[m-1][1];var _=ru(a.stops.map(function(S){return S[0]}),c);return a.stops[_][1]}function Eh(a,s,c){var m=a.base!==void 0?a.base:1;if(Pa(c)!=="number")return Wu(a.default,s.default);var _=a.stops.length;if(_===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[_-1][0])return a.stops[_-1][1];var S=ru(a.stops.map(function(K){return K[0]}),c),C=function(K,V,de,ze){var Ue=ze-de,st=K-de;return Ue===0?0:V===1?st/Ue:(Math.pow(V,st)-1)/(Math.pow(V,Ue)-1)}(c,m,a.stops[S][0],a.stops[S+1][0]),P=a.stops[S][1],D=a.stops[S+1][1],j=bo[s.type]||Gf;if(a.colorSpace&&a.colorSpace!=="rgb"){var B=te[a.colorSpace];j=function(K,V){return B.reverse(B.interpolate(B.forward(K),B.forward(V),C))}}return typeof P.evaluate=="function"?{evaluate:function(){for(var K=[],V=arguments.length;V--;)K[V]=arguments[V];var de=P.evaluate.apply(void 0,K),ze=D.evaluate.apply(void 0,K);if(de!==void 0&&ze!==void 0)return j(de,ze,C)}}:j(P,D,C)}function mf(a,s,c){return s.type==="color"?c=Ji.parse(c):s.type==="formatted"?c=$a.fromString(c.toString()):s.type==="resolvedImage"?c=Fa.fromString(c.toString()):Pa(c)===s.type||s.type==="enum"&&s.values[c]||(c=void 0),Wu(c,a.default,s.default)}xo.register(Bu,{error:[{kind:"error"},[wn],function(a,s){throw new Ja(s[0].evaluate(a))}],typeof:[wn,[xn],function(a,s){return Fi(ur(s[0].evaluate(a)))}],"to-rgba":[Zi($t,4),[gn],function(a,s){return s[0].evaluate(a).toArray()}],rgb:[gn,[$t,$t,$t],Eo],rgba:[gn,[$t,$t,$t,$t],Eo],has:{type:fn,overloads:[[[wn],function(a,s){return Nc(s[0].evaluate(a),a.properties())}],[[wn,Ii],function(a,s){var c=s[1];return Nc(s[0].evaluate(a),c.evaluate(a))}]]},get:{type:xn,overloads:[[[wn],function(a,s){return Is(s[0].evaluate(a),a.properties())}],[[wn,Ii],function(a,s){var c=s[1];return Is(s[0].evaluate(a),c.evaluate(a))}]]},"feature-state":[xn,[wn],function(a,s){return Is(s[0].evaluate(a),a.featureState||{})}],properties:[Ii,[],function(a){return a.properties()}],"geometry-type":[wn,[],function(a){return a.geometryType()}],id:[xn,[],function(a){return a.id()}],zoom:[$t,[],function(a){return a.globals.zoom}],"heatmap-density":[$t,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[$t,[],function(a){return a.globals.lineProgress||0}],accumulated:[xn,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[$t,ns($t),function(a,s){for(var c=0,m=0,_=s;m<_.length;m+=1)c+=_[m].evaluate(a);return c}],"*":[$t,ns($t),function(a,s){for(var c=1,m=0,_=s;m<_.length;m+=1)c*=_[m].evaluate(a);return c}],"-":{type:$t,overloads:[[[$t,$t],function(a,s){var c=s[1];return s[0].evaluate(a)-c.evaluate(a)}],[[$t],function(a,s){return-s[0].evaluate(a)}]]},"/":[$t,[$t,$t],function(a,s){var c=s[1];return s[0].evaluate(a)/c.evaluate(a)}],"%":[$t,[$t,$t],function(a,s){var c=s[1];return s[0].evaluate(a)%c.evaluate(a)}],ln2:[$t,[],function(){return Math.LN2}],pi:[$t,[],function(){return Math.PI}],e:[$t,[],function(){return Math.E}],"^":[$t,[$t,$t],function(a,s){var c=s[1];return Math.pow(s[0].evaluate(a),c.evaluate(a))}],sqrt:[$t,[$t],function(a,s){return Math.sqrt(s[0].evaluate(a))}],log10:[$t,[$t],function(a,s){return Math.log(s[0].evaluate(a))/Math.LN10}],ln:[$t,[$t],function(a,s){return Math.log(s[0].evaluate(a))}],log2:[$t,[$t],function(a,s){return Math.log(s[0].evaluate(a))/Math.LN2}],sin:[$t,[$t],function(a,s){return Math.sin(s[0].evaluate(a))}],cos:[$t,[$t],function(a,s){return Math.cos(s[0].evaluate(a))}],tan:[$t,[$t],function(a,s){return Math.tan(s[0].evaluate(a))}],asin:[$t,[$t],function(a,s){return Math.asin(s[0].evaluate(a))}],acos:[$t,[$t],function(a,s){return Math.acos(s[0].evaluate(a))}],atan:[$t,[$t],function(a,s){return Math.atan(s[0].evaluate(a))}],min:[$t,ns($t),function(a,s){return Math.min.apply(Math,s.map(function(c){return c.evaluate(a)}))}],max:[$t,ns($t),function(a,s){return Math.max.apply(Math,s.map(function(c){return c.evaluate(a)}))}],abs:[$t,[$t],function(a,s){return Math.abs(s[0].evaluate(a))}],round:[$t,[$t],function(a,s){var c=s[0].evaluate(a);return c<0?-Math.round(-c):Math.round(c)}],floor:[$t,[$t],function(a,s){return Math.floor(s[0].evaluate(a))}],ceil:[$t,[$t],function(a,s){return Math.ceil(s[0].evaluate(a))}],"filter-==":[fn,[wn,xn],function(a,s){var c=s[0],m=s[1];return a.properties()[c.value]===m.value}],"filter-id-==":[fn,[xn],function(a,s){var c=s[0];return a.id()===c.value}],"filter-type-==":[fn,[wn],function(a,s){var c=s[0];return a.geometryType()===c.value}],"filter-<":[fn,[wn,xn],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],S=m.value;return typeof _==typeof S&&_<S}],"filter-id-<":[fn,[xn],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m<_}],"filter->":[fn,[wn,xn],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],S=m.value;return typeof _==typeof S&&_>S}],"filter-id->":[fn,[xn],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m>_}],"filter-<=":[fn,[wn,xn],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],S=m.value;return typeof _==typeof S&&_<=S}],"filter-id-<=":[fn,[xn],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m<=_}],"filter->=":[fn,[wn,xn],function(a,s){var c=s[0],m=s[1],_=a.properties()[c.value],S=m.value;return typeof _==typeof S&&_>=S}],"filter-id->=":[fn,[xn],function(a,s){var c=s[0],m=a.id(),_=c.value;return typeof m==typeof _&&m>=_}],"filter-has":[fn,[xn],function(a,s){return s[0].value in a.properties()}],"filter-has-id":[fn,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[fn,[Zi(wn)],function(a,s){return s[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[fn,[Zi(xn)],function(a,s){return s[0].value.indexOf(a.id())>=0}],"filter-in-small":[fn,[wn,Zi(xn)],function(a,s){var c=s[0];return s[1].value.indexOf(a.properties()[c.value])>=0}],"filter-in-large":[fn,[wn,Zi(xn)],function(a,s){var c=s[0],m=s[1];return function(_,S,C,P){for(;C<=P;){var D=C+P>>1;if(S[D]===_)return!0;S[D]>_?P=D-1:C=D+1}return!1}(a.properties()[c.value],m.value,0,m.value.length-1)}],all:{type:fn,overloads:[[[fn,fn],function(a,s){var c=s[1];return s[0].evaluate(a)&&c.evaluate(a)}],[ns(fn),function(a,s){for(var c=0,m=s;c<m.length;c+=1)if(!m[c].evaluate(a))return!1;return!0}]]},any:{type:fn,overloads:[[[fn,fn],function(a,s){var c=s[1];return s[0].evaluate(a)||c.evaluate(a)}],[ns(fn),function(a,s){for(var c=0,m=s;c<m.length;c+=1)if(m[c].evaluate(a))return!0;return!1}]]},"!":[fn,[fn],function(a,s){return!s[0].evaluate(a)}],"is-supported-script":[fn,[wn],function(a,s){var c=a.globals&&a.globals.isSupportedScript;return!c||c(s[0].evaluate(a))}],upcase:[wn,[wn],function(a,s){return s[0].evaluate(a).toUpperCase()}],downcase:[wn,[wn],function(a,s){return s[0].evaluate(a).toLowerCase()}],concat:[wn,ns(xn),function(a,s){return s.map(function(c){return $s(c.evaluate(a))}).join("")}],"resolved-locale":[wn,[Ni],function(a,s){return s[0].evaluate(a).resolvedLocale()}]});var pc=function(a,s){this.expression=a,this._warningHistory={},this._evaluator=new Sa,this._defaultValue=s?function(c){return c.type==="color"&&Pl(c.default)?new Ji(0,0,0,0):c.type==="color"?Ji.parse(c.default)||null:c.default===void 0?null:c.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null};function Rl(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Bu}function Ll(a,s){var c=new ks(Bu,[],s?function(_){var S={color:gn,string:wn,number:$t,enum:wn,boolean:fn,formatted:sa,resolvedImage:Oi};return _.type==="array"?Zi(S[_.value]||xn,_.length):S[_.type]}(s):void 0),m=c.parse(a,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?hc(new pc(m,s)):Po(c.errors)}pc.prototype.evaluateWithoutErrorHandling=function(a,s,c,m,_,S){return this._evaluator.globals=a,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=S,this.expression.evaluate(this._evaluator)},pc.prototype.evaluate=function(a,s,c,m,_,S){this._evaluator.globals=a,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=m,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=S||null;try{var C=this.expression.evaluate(this._evaluator);if(C==null||typeof C=="number"&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new Ja("Expected value to be one of "+Object.keys(this._enumValues).map(function(P){return JSON.stringify(P)}).join(", ")+", but found "+JSON.stringify(C)+" instead.");return C}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console!="undefined"&&console.warn(P.message)),this._defaultValue}};var Ol=function(a,s){this.kind=a,this._styleExpression=s,this.isStateDependent=a!=="constant"&&!fs(s.expression)};Ol.prototype.evaluateWithoutErrorHandling=function(a,s,c,m,_,S){return this._styleExpression.evaluateWithoutErrorHandling(a,s,c,m,_,S)},Ol.prototype.evaluate=function(a,s,c,m,_,S){return this._styleExpression.evaluate(a,s,c,m,_,S)};var cl=function(a,s,c,m){this.kind=a,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=a!=="camera"&&!fs(s.expression),this.interpolationType=m};function Xu(a,s){if((a=Ll(a,s)).result==="error")return a;var c=a.value.expression,m=Vo(c);if(!m&&!nu(s))return Po([new Fr("","data expressions not supported")]);var _=hs(c,["zoom"]);if(!_&&!zc(s))return Po([new Fr("","zoom expressions not supported")]);var S=function C(P){var D=null;if(P instanceof Lt)D=C(P.result);else if(P instanceof Rt)for(var j=0,B=P.args;j<B.length&&!(D=C(B[j]));j+=1);else(P instanceof _s||P instanceof Me)&&P.input instanceof xo&&P.input.name==="zoom"&&(D=P);return D instanceof Fr||P.eachChild(function(K){var V=C(K);V instanceof Fr?D=V:!D&&V?D=new Fr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):D&&V&&D!==V&&(D=new Fr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),D}(c);return S||_?S instanceof Fr?Po([S]):S instanceof Me&&!ll(s)?Po([new Fr("",'"interpolate" expressions cannot be used with this property')]):hc(S?new cl(m?"camera":"composite",a.value,S.labels,S instanceof Me?S.interpolation:void 0):new Ol(m?"constant":"source",a.value)):Po([new Fr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}cl.prototype.evaluateWithoutErrorHandling=function(a,s,c,m,_,S){return this._styleExpression.evaluateWithoutErrorHandling(a,s,c,m,_,S)},cl.prototype.evaluate=function(a,s,c,m,_,S){return this._styleExpression.evaluate(a,s,c,m,_,S)},cl.prototype.interpolationFactor=function(a,s,c){return this.interpolationType?Me.interpolationFactor(this.interpolationType,a,s,c):0};var $u=function(a,s){this._parameters=a,this._specification=s,Lr(this,function c(m,_){var S,C,P,D=_.type==="color",j=m.stops&&typeof m.stops[0][0]=="object",B=j||!(j||m.property!==void 0),K=m.type||(ll(_)?"exponential":"interval");if(D&&((m=Lr({},m)).stops&&(m.stops=m.stops.map(function(Rn){return[Rn[0],Ji.parse(Rn[1])]})),m.default=Ji.parse(m.default?m.default:_.default)),m.colorSpace&&m.colorSpace!=="rgb"&&!te[m.colorSpace])throw new Error("Unknown color space: "+m.colorSpace);if(K==="exponential")S=Eh;else if(K==="interval")S=tp;else if(K==="categorical"){S=Hf,C=Object.create(null);for(var V=0,de=m.stops;V<de.length;V+=1){var ze=de[V];C[ze[0]]=ze[1]}P=typeof m.stops[0][0]}else{if(K!=="identity")throw new Error('Unknown function type "'+K+'"');S=mf}if(j){for(var Ue={},st=[],Ke=0;Ke<m.stops.length;Ke++){var St=m.stops[Ke],jt=St[0].zoom;Ue[jt]===void 0&&(Ue[jt]={zoom:jt,type:m.type,property:m.property,default:m.default,stops:[]},st.push(jt)),Ue[jt].stops.push([St[0].value,St[1]])}for(var or=[],lr=0,Cr=st;lr<Cr.length;lr+=1){var Qr=Cr[lr];or.push([Ue[Qr].zoom,c(Ue[Qr],_)])}var dn={name:"linear"};return{kind:"composite",interpolationType:dn,interpolationFactor:Me.interpolationFactor.bind(void 0,dn),zoomStops:or.map(function(Rn){return Rn[0]}),evaluate:function(Rn,si){var On=Rn.zoom;return Eh({stops:or,base:m.base},_,On).evaluate(On,si)}}}if(B){var ti=K==="exponential"?{name:"exponential",base:m.base!==void 0?m.base:1}:null;return{kind:"camera",interpolationType:ti,interpolationFactor:Me.interpolationFactor.bind(void 0,ti),zoomStops:m.stops.map(function(Rn){return Rn[0]}),evaluate:function(Rn){return S(m,_,Rn.zoom,C,P)}}}return{kind:"source",evaluate:function(Rn,si){var On=si&&si.properties?si.properties[m.property]:void 0;return On===void 0?Wu(m.default,_.default):S(m,_,On,C,P)}}}(this._parameters,this._specification))};function iu(a){var s=a.key,c=a.value,m=a.valueSpec||{},_=a.objectElementValidators||{},S=a.style,C=a.styleSpec,P=[],D=Pa(c);if(D!=="object")return[new Ge(s,c,"object expected, "+D+" found")];for(var j in c){var B=j.split(".")[0],K=m[B]||m["*"],V=void 0;if(_[B])V=_[B];else if(m[B])V=aa;else if(_["*"])V=_["*"];else{if(!m["*"]){P.push(new Ge(s,c[j],'unknown property "'+j+'"'));continue}V=aa}P=P.concat(V({key:(s&&s+".")+j,value:c[j],valueSpec:K,style:S,styleSpec:C,object:c,objectKey:j},c))}for(var de in m)_[de]||m[de].required&&m[de].default===void 0&&c[de]===void 0&&P.push(new Ge(s,c,'missing required property "'+de+'"'));return P}function Wf(a){var s=a.value,c=a.valueSpec,m=a.style,_=a.styleSpec,S=a.key,C=a.arrayElementValidator||aa;if(Pa(s)!=="array")return[new Ge(S,s,"array expected, "+Pa(s)+" found")];if(c.length&&s.length!==c.length)return[new Ge(S,s,"array length "+c.length+" expected, length "+s.length+" found")];if(c["min-length"]&&s.length<c["min-length"])return[new Ge(S,s,"array length at least "+c["min-length"]+" expected, length "+s.length+" found")];var P={type:c.value,values:c.values};_.$version<7&&(P.function=c.function),Pa(c.value)==="object"&&(P=c.value);for(var D=[],j=0;j<s.length;j++)D=D.concat(C({array:s,arrayIndex:j,value:s[j],valueSpec:P,style:m,styleSpec:_,key:S+"["+j+"]"}));return D}function gf(a){var s=a.key,c=a.value,m=a.valueSpec,_=Pa(c);return _==="number"&&c!=c&&(_="NaN"),_!=="number"?[new Ge(s,c,"number expected, "+_+" found")]:"minimum"in m&&c<m.minimum?[new Ge(s,c,c+" is less than the minimum value "+m.minimum)]:"maximum"in m&&c>m.maximum?[new Ge(s,c,c+" is greater than the maximum value "+m.maximum)]:[]}function Sh(a){var s,c,m,_=a.valueSpec,S=er(a.value.type),C={},P=S!=="categorical"&&a.value.property===void 0,D=!P,j=Pa(a.value.stops)==="array"&&Pa(a.value.stops[0])==="array"&&Pa(a.value.stops[0][0])==="object",B=iu({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(de){if(S==="identity")return[new Ge(de.key,de.value,'identity function may not have a "stops" property')];var ze=[],Ue=de.value;return ze=ze.concat(Wf({key:de.key,value:Ue,valueSpec:de.valueSpec,style:de.style,styleSpec:de.styleSpec,arrayElementValidator:K})),Pa(Ue)==="array"&&Ue.length===0&&ze.push(new Ge(de.key,Ue,"array must have at least one stop")),ze},default:function(de){return aa({key:de.key,value:de.value,valueSpec:_,style:de.style,styleSpec:de.styleSpec})}}});return S==="identity"&&P&&B.push(new Ge(a.key,a.value,'missing required property "property"')),S==="identity"||a.value.stops||B.push(new Ge(a.key,a.value,'missing required property "stops"')),S==="exponential"&&a.valueSpec.expression&&!ll(a.valueSpec)&&B.push(new Ge(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(D&&!nu(a.valueSpec)?B.push(new Ge(a.key,a.value,"property functions not supported")):P&&!zc(a.valueSpec)&&B.push(new Ge(a.key,a.value,"zoom functions not supported"))),S!=="categorical"&&!j||a.value.property!==void 0||B.push(new Ge(a.key,a.value,'"property" property is required')),B;function K(de){var ze=[],Ue=de.value,st=de.key;if(Pa(Ue)!=="array")return[new Ge(st,Ue,"array expected, "+Pa(Ue)+" found")];if(Ue.length!==2)return[new Ge(st,Ue,"array length 2 expected, length "+Ue.length+" found")];if(j){if(Pa(Ue[0])!=="object")return[new Ge(st,Ue,"object expected, "+Pa(Ue[0])+" found")];if(Ue[0].zoom===void 0)return[new Ge(st,Ue,"object stop key must have zoom")];if(Ue[0].value===void 0)return[new Ge(st,Ue,"object stop key must have value")];if(m&&m>er(Ue[0].zoom))return[new Ge(st,Ue[0].zoom,"stop zoom values must appear in ascending order")];er(Ue[0].zoom)!==m&&(m=er(Ue[0].zoom),c=void 0,C={}),ze=ze.concat(iu({key:st+"[0]",value:Ue[0],valueSpec:{zoom:{}},style:de.style,styleSpec:de.styleSpec,objectElementValidators:{zoom:gf,value:V}}))}else ze=ze.concat(V({key:st+"[0]",value:Ue[0],valueSpec:{},style:de.style,styleSpec:de.styleSpec},Ue));return Rl(tr(Ue[1]))?ze.concat([new Ge(st+"[1]",Ue[1],"expressions are not allowed in function stops.")]):ze.concat(aa({key:st+"[1]",value:Ue[1],valueSpec:_,style:de.style,styleSpec:de.styleSpec}))}function V(de,ze){var Ue=Pa(de.value),st=er(de.value),Ke=de.value!==null?de.value:ze;if(s){if(Ue!==s)return[new Ge(de.key,Ke,Ue+" stop domain type must match previous stop domain type "+s)]}else s=Ue;if(Ue!=="number"&&Ue!=="string"&&Ue!=="boolean")return[new Ge(de.key,Ke,"stop domain value must be a number, string, or boolean")];if(Ue!=="number"&&S!=="categorical"){var St="number expected, "+Ue+" found";return nu(_)&&S===void 0&&(St+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ge(de.key,Ke,St)]}return S!=="categorical"||Ue!=="number"||isFinite(st)&&Math.floor(st)===st?S!=="categorical"&&Ue==="number"&&c!==void 0&&st<c?[new Ge(de.key,Ke,"stop domain values must appear in ascending order")]:(c=st,S==="categorical"&&st in C?[new Ge(de.key,Ke,"stop domain values must be unique")]:(C[st]=!0,[])):[new Ge(de.key,Ke,"integer expected, found "+st)]}}function Ys(a){var s=(a.expressionContext==="property"?Xu:Ll)(tr(a.value),a.valueSpec);if(s.result==="error")return s.value.map(function(m){return new Ge(""+a.key+m.key,a.value,m.message)});var c=s.value.expression||s.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!c.outputDefined())return[new Ge(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!fs(c))return[new Ge(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!fs(c))return[new Ge(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!hs(c,["zoom","feature-state"]))return[new Ge(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Vo(c))return[new Ge(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function dc(a){var s=a.key,c=a.value,m=a.valueSpec,_=[];return Array.isArray(m.values)?m.values.indexOf(er(c))===-1&&_.push(new Ge(s,c,"expected one of ["+m.values.join(", ")+"], "+JSON.stringify(c)+" found")):Object.keys(m.values).indexOf(er(c))===-1&&_.push(new Ge(s,c,"expected one of ["+Object.keys(m.values).join(", ")+"], "+JSON.stringify(c)+" found")),_}function Zc(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var s=0,c=a.slice(1);s<c.length;s+=1){var m=c[s];if(!Zc(m)&&typeof m!="boolean")return!1}return!0;default:return!0}}$u.deserialize=function(a){return new $u(a._parameters,a._specification)},$u.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var yf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Fl(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};Zc(a)||(a=Uc(a));var s=Ll(a,yf);if(s.result==="error")throw new Error(s.value.map(function(c){return c.key+": "+c.message}).join(", "));return{filter:function(c,m,_){return s.value.evaluate(c,m,{},_)},needGeometry:function c(m){if(!Array.isArray(m))return!1;if(m[0]==="within")return!0;for(var _=1;_<m.length;_++)if(c(m[_]))return!0;return!1}(a)}}function _f(a,s){return a<s?-1:a>s?1:0}function Uc(a){if(!a)return!0;var s,c=a[0];return a.length<=1?c!=="any":c==="=="?Dl(a[1],a[2],"=="):c==="!="?Bl(Dl(a[1],a[2],"==")):c==="<"||c===">"||c==="<="||c===">="?Dl(a[1],a[2],c):c==="any"?(s=a.slice(1),["any"].concat(s.map(Uc))):c==="all"?["all"].concat(a.slice(1).map(Uc)):c==="none"?["all"].concat(a.slice(1).map(Uc).map(Bl)):c==="in"?Xf(a[1],a.slice(2)):c==="!in"?Bl(Xf(a[1],a.slice(2))):c==="has"?$f(a[1]):c==="!has"?Bl($f(a[1])):c!=="within"||a}function Dl(a,s,c){switch(a){case"$type":return["filter-type-"+c,s];case"$id":return["filter-id-"+c,s];default:return["filter-"+c,a,s]}}function Xf(a,s){if(s.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(function(c){return typeof c!=typeof s[0]})?["filter-in-large",a,["literal",s.sort(_f)]]:["filter-in-small",a,["literal",s]]}}function $f(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Bl(a){return["!",a]}function Yf(a){return Zc(tr(a.value))?Ys(Lr({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function s(c){var m=c.value,_=c.key;if(Pa(m)!=="array")return[new Ge(_,m,"array expected, "+Pa(m)+" found")];var S,C=c.styleSpec,P=[];if(m.length<1)return[new Ge(_,m,"filter array must have at least 1 element")];switch(P=P.concat(dc({key:_+"[0]",value:m[0],valueSpec:C.filter_operator,style:c.style,styleSpec:c.styleSpec})),er(m[0])){case"<":case"<=":case">":case">=":m.length>=2&&er(m[1])==="$type"&&P.push(new Ge(_,m,'"$type" cannot be use with operator "'+m[0]+'"'));case"==":case"!=":m.length!==3&&P.push(new Ge(_,m,'filter array for operator "'+m[0]+'" must have 3 elements'));case"in":case"!in":m.length>=2&&(S=Pa(m[1]))!=="string"&&P.push(new Ge(_+"[1]",m[1],"string expected, "+S+" found"));for(var D=2;D<m.length;D++)S=Pa(m[D]),er(m[1])==="$type"?P=P.concat(dc({key:_+"["+D+"]",value:m[D],valueSpec:C.geometry_type,style:c.style,styleSpec:c.styleSpec})):S!=="string"&&S!=="number"&&S!=="boolean"&&P.push(new Ge(_+"["+D+"]",m[D],"string, number, or boolean expected, "+S+" found"));break;case"any":case"all":case"none":for(var j=1;j<m.length;j++)P=P.concat(s({key:_+"["+j+"]",value:m[j],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":S=Pa(m[1]),m.length!==2?P.push(new Ge(_,m,'filter array for "'+m[0]+'" operator must have 2 elements')):S!=="string"&&P.push(new Ge(_+"[1]",m[1],"string expected, "+S+" found"));break;case"within":S=Pa(m[1]),m.length!==2?P.push(new Ge(_,m,'filter array for "'+m[0]+'" operator must have 2 elements')):S!=="object"&&P.push(new Ge(_+"[1]",m[1],"object expected, "+S+" found"))}return P}(a)}function qf(a,s){var c=a.key,m=a.style,_=a.styleSpec,S=a.value,C=a.objectKey,P=_[s+"_"+a.layerType];if(!P)return[];var D=C.match(/^(.*)-transition$/);if(s==="paint"&&D&&P[D[1]]&&P[D[1]].transition)return aa({key:c,value:S,valueSpec:_.transition,style:m,styleSpec:_});var j,B=a.valueSpec||P[C];if(!B)return[new Ge(c,S,'unknown property "'+C+'"')];if(Pa(S)==="string"&&nu(B)&&!B.tokens&&(j=/^{([^}]+)}$/.exec(S)))return[new Ge(c,S,'"'+C+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(j[1])+" }`.")];var K=[];return a.layerType==="symbol"&&(C==="text-field"&&m&&!m.glyphs&&K.push(new Ge(c,S,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&Pl(tr(S))&&er(S.type)==="identity"&&K.push(new Ge(c,S,'"text-font" does not support identity functions'))),K.concat(aa({key:a.key,value:S,valueSpec:B,style:m,styleSpec:_,expressionContext:"property",propertyType:s,propertyKey:C}))}function Kf(a){return qf(a,"paint")}function fl(a){return qf(a,"layout")}function wh(a){var s=[],c=a.value,m=a.key,_=a.style,S=a.styleSpec;c.type||c.ref||s.push(new Ge(m,c,'either "type" or "ref" is required'));var C,P=er(c.type),D=er(c.ref);if(c.id)for(var j=er(c.id),B=0;B<a.arrayIndex;B++){var K=_.layers[B];er(K.id)===j&&s.push(new Ge(m,c.id,'duplicate layer id "'+c.id+'", previously used at line '+K.id.__line__))}if("ref"in c)["type","source","source-layer","filter","layout"].forEach(function(ze){ze in c&&s.push(new Ge(m,c[ze],'"'+ze+'" is prohibited for ref layers'))}),_.layers.forEach(function(ze){er(ze.id)===D&&(C=ze)}),C?C.ref?s.push(new Ge(m,c.ref,"ref cannot reference another ref layer")):P=er(C.type):s.push(new Ge(m,c.ref,'ref layer "'+D+'" not found'));else if(P!=="background")if(c.source){var V=_.sources&&_.sources[c.source],de=V&&er(V.type);V?de==="vector"&&P==="raster"?s.push(new Ge(m,c.source,'layer "'+c.id+'" requires a raster source')):de==="raster"&&P!=="raster"?s.push(new Ge(m,c.source,'layer "'+c.id+'" requires a vector source')):de!=="vector"||c["source-layer"]?de==="raster-dem"&&P!=="hillshade"?s.push(new Ge(m,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="line"||!c.paint||!c.paint["line-gradient"]||de==="geojson"&&V.lineMetrics||s.push(new Ge(m,c,'layer "'+c.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):s.push(new Ge(m,c,'layer "'+c.id+'" must specify a "source-layer"')):s.push(new Ge(m,c.source,'source "'+c.source+'" not found'))}else s.push(new Ge(m,c,'missing required property "source"'));return s=s.concat(iu({key:m,value:c,valueSpec:S.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return aa({key:m+".type",value:c.type,valueSpec:S.layer.type,style:a.style,styleSpec:a.styleSpec,object:c,objectKey:"type"})},filter:Yf,layout:function(ze){return iu({layer:c,key:ze.key,value:ze.value,style:ze.style,styleSpec:ze.styleSpec,objectElementValidators:{"*":function(Ue){return fl(Lr({layerType:P},Ue))}}})},paint:function(ze){return iu({layer:c,key:ze.key,value:ze.value,style:ze.style,styleSpec:ze.styleSpec,objectElementValidators:{"*":function(Ue){return Kf(Lr({layerType:P},Ue))}}})}}}))}function Nl(a){var s=a.value,c=a.key,m=Pa(s);return m!=="string"?[new Ge(c,s,"string expected, "+m+" found")]:[]}var ro={promoteId:function(a){var s=a.key,c=a.value;if(Pa(c)==="string")return Nl({key:s,value:c});var m=[];for(var _ in c)m.push.apply(m,Nl({key:s+"."+_,value:c[_]}));return m}};function vc(a){var s=a.value,c=a.key,m=a.styleSpec,_=a.style;if(!s.type)return[new Ge(c,s,'"type" is required')];var S,C=er(s.type);switch(C){case"vector":case"raster":case"raster-dem":return iu({key:c,value:s,valueSpec:m["source_"+C.replace("-","_")],style:a.style,styleSpec:m,objectElementValidators:ro});case"geojson":if(S=iu({key:c,value:s,valueSpec:m.source_geojson,style:_,styleSpec:m,objectElementValidators:ro}),s.cluster)for(var P in s.clusterProperties){var D=s.clusterProperties[P],j=D[0],B=typeof j=="string"?[j,["accumulated"],["get",P]]:j;S.push.apply(S,Ys({key:c+"."+P+".map",value:D[1],expressionContext:"cluster-map"})),S.push.apply(S,Ys({key:c+"."+P+".reduce",value:B,expressionContext:"cluster-reduce"}))}return S;case"video":return iu({key:c,value:s,valueSpec:m.source_video,style:_,styleSpec:m});case"image":return iu({key:c,value:s,valueSpec:m.source_image,style:_,styleSpec:m});case"canvas":return[new Ge(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return dc({key:c+".type",value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,styleSpec:m})}}function Eu(a){var s=a.value,c=a.styleSpec,m=c.light,_=a.style,S=[],C=Pa(s);if(s===void 0)return S;if(C!=="object")return S.concat([new Ge("light",s,"object expected, "+C+" found")]);for(var P in s){var D=P.match(/^(.*)-transition$/);S=S.concat(D&&m[D[1]]&&m[D[1]].transition?aa({key:P,value:s[P],valueSpec:c.transition,style:_,styleSpec:c}):m[P]?aa({key:P,value:s[P],valueSpec:m[P],style:_,styleSpec:c}):[new Ge(P,s[P],'unknown property "'+P+'"')])}return S}var Nu={"*":function(){return[]},array:Wf,boolean:function(a){var s=a.value,c=a.key,m=Pa(s);return m!=="boolean"?[new Ge(c,s,"boolean expected, "+m+" found")]:[]},number:gf,color:function(a){var s=a.key,c=a.value,m=Pa(c);return m!=="string"?[new Ge(s,c,"color expected, "+m+" found")]:zi(c)===null?[new Ge(s,c,'color expected, "'+c+'" found')]:[]},constants:Dt,enum:dc,filter:Yf,function:Sh,layer:wh,object:iu,source:vc,light:Eu,string:Nl,formatted:function(a){return Nl(a).length===0?[]:Ys(a)},resolvedImage:function(a){return Nl(a).length===0?[]:Ys(a)}};function aa(a){var s=a.value,c=a.valueSpec,m=a.styleSpec;return c.expression&&Pl(er(s))?Sh(a):c.expression&&Rl(tr(s))?Ys(a):c.type&&Nu[c.type]?Nu[c.type](a):iu(Lr({},a,{valueSpec:c.type?m[c.type]:c}))}function ja(a){var s=a.value,c=a.key,m=Nl(a);return m.length||(s.indexOf("{fontstack}")===-1&&m.push(new Ge(c,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&m.push(new Ge(c,s,'"glyphs" url must include a "{range}" token'))),m}function bs(a,s){s===void 0&&(s=me);var c=[];return c=c.concat(aa({key:"",value:a,valueSpec:s.$root,styleSpec:s,style:a,objectElementValidators:{glyphs:ja,"*":function(){return[]}}})),a.constants&&(c=c.concat(Dt({key:"constants",value:a.constants,style:a,styleSpec:s}))),xf(c)}function xf(a){return[].concat(a).sort(function(s,c){return s.line-c.line})}function hl(a){return function(){for(var s=[],c=arguments.length;c--;)s[c]=arguments[c];return xf(a.apply(this,s))}}bs.source=hl(vc),bs.light=hl(Eu),bs.layer=hl(wh),bs.filter=hl(Yf),bs.paintProperty=hl(Kf),bs.layoutProperty=hl(fl);var bf=bs,rp=bf.light,np=bf.paintProperty,Ef=bf.layoutProperty;function zl(a,s){var c=!1;if(s&&s.length)for(var m=0,_=s;m<_.length;m+=1)a.fire(new et(new Error(_[m].message))),c=!0;return c}var pl=Yo;function Yo(a,s,c){var m=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var _=new Int32Array(this.arrayBuffer);a=_[0],this.d=(s=_[1])+2*(c=_[2]);for(var S=0;S<this.d*this.d;S++){var C=_[3+S],P=_[3+S+1];m.push(C===P?null:_.subarray(C,P))}var D=_[3+m.length+1];this.keys=_.subarray(_[3+m.length],D),this.bboxes=_.subarray(D),this.insert=this._insertReadonly}else{this.d=s+2*c;for(var j=0;j<this.d*this.d;j++)m.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=a,this.padding=c,this.scale=s/a,this.uid=0;var B=c/s*a;this.min=-B,this.max=a+B}Yo.prototype.insert=function(a,s,c,m,_){this._forEachCell(s,c,m,_,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(_)},Yo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Yo.prototype._insertCell=function(a,s,c,m,_,S){this.cells[_].push(S)},Yo.prototype.query=function(a,s,c,m,_){var S=this.min,C=this.max;if(a<=S&&s<=S&&C<=c&&C<=m&&!_)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(a,s,c,m,this._queryCell,P,{},_),P},Yo.prototype._queryCell=function(a,s,c,m,_,S,C,P){var D=this.cells[_];if(D!==null)for(var j=this.keys,B=this.bboxes,K=0;K<D.length;K++){var V=D[K];if(C[V]===void 0){var de=4*V;(P?P(B[de+0],B[de+1],B[de+2],B[de+3]):a<=B[de+2]&&s<=B[de+3]&&c>=B[de+0]&&m>=B[de+1])?(C[V]=!0,S.push(j[V])):C[V]=!1}}},Yo.prototype._forEachCell=function(a,s,c,m,_,S,C,P){for(var D=this._convertToCellCoord(a),j=this._convertToCellCoord(s),B=this._convertToCellCoord(c),K=this._convertToCellCoord(m),V=D;V<=B;V++)for(var de=j;de<=K;de++){var ze=this.d*de+V;if((!P||P(this._convertFromCellCoord(V),this._convertFromCellCoord(de),this._convertFromCellCoord(V+1),this._convertFromCellCoord(de+1)))&&_.call(this,a,s,c,m,ze,S,C,P))return}},Yo.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Yo.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Yo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,s=3+this.cells.length+1+1,c=0,m=0;m<this.cells.length;m++)c+=this.cells[m].length;var _=new Int32Array(s+c+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var S=s,C=0;C<a.length;C++){var P=a[C];_[3+C]=S,_.set(P,S),S+=P.length}return _[3+a.length]=S,_.set(this.keys,S),_[3+a.length+1]=S+=this.keys.length,_.set(this.bboxes,S),S+=this.bboxes.length,_.buffer};var Vc=ye.ImageData,Zl=ye.ImageBitmap,Ro={};function Dn(a,s,c){c===void 0&&(c={}),Object.defineProperty(s,"_classRegistryKey",{value:a,writeable:!1}),Ro[a]={klass:s,omit:c.omit||[],shallow:c.shallow||[]}}for(var mo in Dn("Object",Object),pl.serialize=function(a,s){var c=a.toArrayBuffer();return s&&s.push(c),{buffer:c}},pl.deserialize=function(a){return new pl(a.buffer)},Dn("Grid",pl),Dn("Color",Ji),Dn("Error",Error),Dn("ResolvedImage",Fa),Dn("StylePropertyFunction",$u),Dn("StyleExpression",pc,{omit:["_evaluator"]}),Dn("ZoomDependentExpression",cl),Dn("ZoomConstantExpression",Ol),Dn("CompoundExpression",xo,{omit:["_evaluate"]}),Bu)Bu[mo]._classRegistryKey||Dn("Expression_"+mo,Bu[mo]);function jo(a){return a&&typeof ArrayBuffer!="undefined"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Ul(a){return Zl&&a instanceof Zl}function Xi(a,s){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(jo(a)||Ul(a))return s&&s.push(a),a;if(ArrayBuffer.isView(a)){var c=a;return s&&s.push(c.buffer),c}if(a instanceof Vc)return s&&s.push(a.data.buffer),a;if(Array.isArray(a)){for(var m=[],_=0,S=a;_<S.length;_+=1)m.push(Xi(S[_],s));return m}if(typeof a=="object"){var C=a.constructor,P=C._classRegistryKey;if(!P)throw new Error("can't serialize object of unregistered class");var D=C.serialize?C.serialize(a,s):{};if(!C.serialize){for(var j in a)if(a.hasOwnProperty(j)&&!(Ro[P].omit.indexOf(j)>=0)){var B=a[j];D[j]=Ro[P].shallow.indexOf(j)>=0?B:Xi(B,s)}a instanceof Error&&(D.message=a.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return P!=="Object"&&(D.$name=P),D}throw new Error("can't serialize object of type "+typeof a)}function Bs(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||jo(a)||Ul(a)||ArrayBuffer.isView(a)||a instanceof Vc)return a;if(Array.isArray(a))return a.map(Bs);if(typeof a=="object"){var s=a.$name||"Object",c=Ro[s].klass;if(!c)throw new Error("can't deserialize unregistered class "+s);if(c.deserialize)return c.deserialize(a);for(var m=Object.create(c.prototype),_=0,S=Object.keys(a);_<S.length;_+=1){var C=S[_];if(C!=="$name"){var P=a[C];m[C]=Ro[s].shallow.indexOf(C)>=0?P:Bs(P)}}return m}throw new Error("can't deserialize object of type "+typeof a)}var Qf=function(){this.first=!0};Qf.prototype.update=function(a,s){var c=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=s),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=c,!0))};var vn={"Latin-1 Supplement":function(a){return a>=128&&a<=255},Arabic:function(a){return a>=1536&&a<=1791},"Arabic Supplement":function(a){return a>=1872&&a<=1919},"Arabic Extended-A":function(a){return a>=2208&&a<=2303},"Hangul Jamo":function(a){return a>=4352&&a<=4607},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&a<=5759},Khmer:function(a){return a>=6016&&a<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&a<=6399},"General Punctuation":function(a){return a>=8192&&a<=8303},"Letterlike Symbols":function(a){return a>=8448&&a<=8527},"Number Forms":function(a){return a>=8528&&a<=8591},"Miscellaneous Technical":function(a){return a>=8960&&a<=9215},"Control Pictures":function(a){return a>=9216&&a<=9279},"Optical Character Recognition":function(a){return a>=9280&&a<=9311},"Enclosed Alphanumerics":function(a){return a>=9312&&a<=9471},"Geometric Shapes":function(a){return a>=9632&&a<=9727},"Miscellaneous Symbols":function(a){return a>=9728&&a<=9983},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&a<=11263},"CJK Radicals Supplement":function(a){return a>=11904&&a<=12031},"Kangxi Radicals":function(a){return a>=12032&&a<=12255},"Ideographic Description Characters":function(a){return a>=12272&&a<=12287},"CJK Symbols and Punctuation":function(a){return a>=12288&&a<=12351},Hiragana:function(a){return a>=12352&&a<=12447},Katakana:function(a){return a>=12448&&a<=12543},Bopomofo:function(a){return a>=12544&&a<=12591},"Hangul Compatibility Jamo":function(a){return a>=12592&&a<=12687},Kanbun:function(a){return a>=12688&&a<=12703},"Bopomofo Extended":function(a){return a>=12704&&a<=12735},"CJK Strokes":function(a){return a>=12736&&a<=12783},"Katakana Phonetic Extensions":function(a){return a>=12784&&a<=12799},"Enclosed CJK Letters and Months":function(a){return a>=12800&&a<=13055},"CJK Compatibility":function(a){return a>=13056&&a<=13311},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&a<=19903},"Yijing Hexagram Symbols":function(a){return a>=19904&&a<=19967},"CJK Unified Ideographs":function(a){return a>=19968&&a<=40959},"Yi Syllables":function(a){return a>=40960&&a<=42127},"Yi Radicals":function(a){return a>=42128&&a<=42191},"Hangul Jamo Extended-A":function(a){return a>=43360&&a<=43391},"Hangul Syllables":function(a){return a>=44032&&a<=55215},"Hangul Jamo Extended-B":function(a){return a>=55216&&a<=55295},"Private Use Area":function(a){return a>=57344&&a<=63743},"CJK Compatibility Ideographs":function(a){return a>=63744&&a<=64255},"Arabic Presentation Forms-A":function(a){return a>=64336&&a<=65023},"Vertical Forms":function(a){return a>=65040&&a<=65055},"CJK Compatibility Forms":function(a){return a>=65072&&a<=65103},"Small Form Variants":function(a){return a>=65104&&a<=65135},"Arabic Presentation Forms-B":function(a){return a>=65136&&a<=65279},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&a<=65519}};function jc(a){for(var s=0,c=a;s<c.length;s+=1)if(Sf(c[s].charCodeAt(0)))return!0;return!1}function Sf(a){return!(a!==746&&a!==747&&(a<4352||!(vn["Bopomofo Extended"](a)||vn.Bopomofo(a)||vn["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||vn["CJK Compatibility Ideographs"](a)||vn["CJK Compatibility"](a)||vn["CJK Radicals Supplement"](a)||vn["CJK Strokes"](a)||!(!vn["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||vn["CJK Unified Ideographs Extension A"](a)||vn["CJK Unified Ideographs"](a)||vn["Enclosed CJK Letters and Months"](a)||vn["Hangul Compatibility Jamo"](a)||vn["Hangul Jamo Extended-A"](a)||vn["Hangul Jamo Extended-B"](a)||vn["Hangul Jamo"](a)||vn["Hangul Syllables"](a)||vn.Hiragana(a)||vn["Ideographic Description Characters"](a)||vn.Kanbun(a)||vn["Kangxi Radicals"](a)||vn["Katakana Phonetic Extensions"](a)||vn.Katakana(a)&&a!==12540||!(!vn["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!vn["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||vn["Unified Canadian Aboriginal Syllabics"](a)||vn["Unified Canadian Aboriginal Syllabics Extended"](a)||vn["Vertical Forms"](a)||vn["Yijing Hexagram Symbols"](a)||vn["Yi Syllables"](a)||vn["Yi Radicals"](a))))}function dl(a){return!(Sf(a)||function(s){return!!(vn["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||vn["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||vn["Letterlike Symbols"](s)||vn["Number Forms"](s)||vn["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||vn["Control Pictures"](s)&&s!==9251||vn["Optical Character Recognition"](s)||vn["Enclosed Alphanumerics"](s)||vn["Geometric Shapes"](s)||vn["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||vn["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||vn["CJK Symbols and Punctuation"](s)||vn.Katakana(s)||vn["Private Use Area"](s)||vn["CJK Compatibility Forms"](s)||vn["Small Form Variants"](s)||vn["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(a))}function ri(a){return a>=1424&&a<=2303||vn["Arabic Presentation Forms-A"](a)||vn["Arabic Presentation Forms-B"](a)}function no(a,s){return!(!s&&ri(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||vn.Khmer(a))}function Ns(a){for(var s=0,c=a;s<c.length;s+=1)if(ri(c[s].charCodeAt(0)))return!0;return!1}var Ps=null,zs="unavailable",Su=null,wf=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(zs="error"),Ps&&Ps(a)};function Cf(){Jf.fire(new Be("pluginStateChange",{pluginStatus:zs,pluginURL:Su}))}var Jf=new dt,Af=function(){return zs},au=function(){if(zs!=="deferred"||!Su)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");zs="loading",Cf(),Su&&Ea({url:Su},function(a){a?wf(a):(zs="loaded",Cf())})},ou={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return zs==="loaded"||ou.applyArabicShaping!=null},isLoading:function(){return zs==="loading"},setState:function(a){zs=a.pluginStatus,Su=a.pluginURL},isParsed:function(){return ou.applyArabicShaping!=null&&ou.processBidirectionalText!=null&&ou.processStyledBidirectionalText!=null},getPluginURL:function(){return Su}},Vi=function(a,s){this.zoom=a,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Qf,this.transition={})};Vi.prototype.isSupportedScript=function(a){return function(s,c){for(var m=0,_=s;m<_.length;m+=1)if(!no(_[m].charCodeAt(0),c))return!1;return!0}(a,ou.isLoaded())},Vi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Vi.prototype.getCrossfadeParameters=function(){var a=this.zoom,s=a-Math.floor(a),c=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*s}};var Ra=function(a,s){this.property=a,this.value=s,this.expression=function(c,m){if(Pl(c))return new $u(c,m);if(Rl(c)){var _=Xu(c,m);if(_.result==="error")throw new Error(_.value.map(function(C){return C.key+": "+C.message}).join(", "));return _.value}var S=c;return typeof c=="string"&&m.type==="color"&&(S=Ji.parse(c)),{kind:"constant",evaluate:function(){return S}}}(s===void 0?a.specification.default:s,a.specification)};Ra.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Ra.prototype.possiblyEvaluate=function(a,s,c){return this.property.possiblyEvaluate(this,a,s,c)};var su=function(a){this.property=a,this.value=new Ra(a,void 0)};su.prototype.transitioned=function(a,s){return new Vl(this.property,this.value,s,Ft({},a.transition,this.transition),a.now)},su.prototype.untransitioned=function(){return new Vl(this.property,this.value,null,{},0)};var qo=function(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)};qo.prototype.getValue=function(a){return pt(this._values[a].value.value)},qo.prototype.setValue=function(a,s){this._values.hasOwnProperty(a)||(this._values[a]=new su(this._values[a].property)),this._values[a].value=new Ra(this._values[a].property,s===null?void 0:pt(s))},qo.prototype.getTransition=function(a){return pt(this._values[a].transition)},qo.prototype.setTransition=function(a,s){this._values.hasOwnProperty(a)||(this._values[a]=new su(this._values[a].property)),this._values[a].transition=pt(s)||void 0},qo.prototype.serialize=function(){for(var a={},s=0,c=Object.keys(this._values);s<c.length;s+=1){var m=c[s],_=this.getValue(m);_!==void 0&&(a[m]=_);var S=this.getTransition(m);S!==void 0&&(a[m+"-transition"]=S)}return a},qo.prototype.transitioned=function(a,s){for(var c=new vl(this._properties),m=0,_=Object.keys(this._values);m<_.length;m+=1){var S=_[m];c._values[S]=this._values[S].transitioned(a,s._values[S])}return c},qo.prototype.untransitioned=function(){for(var a=new vl(this._properties),s=0,c=Object.keys(this._values);s<c.length;s+=1){var m=c[s];a._values[m]=this._values[m].untransitioned()}return a};var Vl=function(a,s,c,m,_){this.property=a,this.value=s,this.begin=_+m.delay||0,this.end=this.begin+m.duration||0,a.specification.transition&&(m.delay||m.duration)&&(this.prior=c)};Vl.prototype.possiblyEvaluate=function(a,s,c){var m=a.now||0,_=this.value.possiblyEvaluate(a,s,c),S=this.prior;if(S){if(m>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(m<this.begin)return S.possiblyEvaluate(a,s,c);var C=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(a,s,c),_,function(P){if(P<=0)return 0;if(P>=1)return 1;var D=P*P,j=D*P;return 4*(P<.5?j:3*(P-D)+j-.75)}(C))}return _};var vl=function(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)};vl.prototype.possiblyEvaluate=function(a,s,c){for(var m=new Rs(this._properties),_=0,S=Object.keys(this._values);_<S.length;_+=1){var C=S[_];m._values[C]=this._values[C].possiblyEvaluate(a,s,c)}return m},vl.prototype.hasTransition=function(){for(var a=0,s=Object.keys(this._values);a<s.length;a+=1)if(this._values[s[a]].prior)return!0;return!1};var qs=function(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)};qs.prototype.getValue=function(a){return pt(this._values[a].value)},qs.prototype.setValue=function(a,s){this._values[a]=new Ra(this._values[a].property,s===null?void 0:pt(s))},qs.prototype.serialize=function(){for(var a={},s=0,c=Object.keys(this._values);s<c.length;s+=1){var m=c[s],_=this.getValue(m);_!==void 0&&(a[m]=_)}return a},qs.prototype.possiblyEvaluate=function(a,s,c){for(var m=new Rs(this._properties),_=0,S=Object.keys(this._values);_<S.length;_+=1){var C=S[_];m._values[C]=this._values[C].possiblyEvaluate(a,s,c)}return m};var ps=function(a,s,c){this.property=a,this.value=s,this.parameters=c};ps.prototype.isConstant=function(){return this.value.kind==="constant"},ps.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},ps.prototype.evaluate=function(a,s,c,m){return this.property.evaluate(this.value,this.parameters,a,s,c,m)};var Rs=function(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)};Rs.prototype.get=function(a){return this._values[a]};var Qn=function(a){this.specification=a};Qn.prototype.possiblyEvaluate=function(a,s){return a.expression.evaluate(s)},Qn.prototype.interpolate=function(a,s,c){var m=bo[this.specification.type];return m?m(a,s,c):a};var Bn=function(a,s){this.specification=a,this.overrides=s};Bn.prototype.possiblyEvaluate=function(a,s,c,m){return new ps(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(s,null,{},c,m)}:a.expression,s)},Bn.prototype.interpolate=function(a,s,c){if(a.value.kind!=="constant"||s.value.kind!=="constant")return a;if(a.value.value===void 0||s.value.value===void 0)return new ps(this,{kind:"constant",value:void 0},a.parameters);var m=bo[this.specification.type];return m?new ps(this,{kind:"constant",value:m(a.value.value,s.value.value,c)},a.parameters):a},Bn.prototype.evaluate=function(a,s,c,m,_,S){return a.kind==="constant"?a.value:a.evaluate(s,c,m,_,S)};var Gc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(c,m,_,S){if(c.value===void 0)return new ps(this,{kind:"constant",value:void 0},m);if(c.expression.kind==="constant"){var C=c.expression.evaluate(m,null,{},_,S),P=c.property.specification.type==="resolvedImage"&&typeof C!="string"?C.name:C,D=this._calculate(P,P,P,m);return new ps(this,{kind:"constant",value:D},m)}if(c.expression.kind==="camera"){var j=this._calculate(c.expression.evaluate({zoom:m.zoom-1}),c.expression.evaluate({zoom:m.zoom}),c.expression.evaluate({zoom:m.zoom+1}),m);return new ps(this,{kind:"constant",value:j},m)}return new ps(this,c.expression,m)},s.prototype.evaluate=function(c,m,_,S,C,P){if(c.kind==="source"){var D=c.evaluate(m,_,S,C,P);return this._calculate(D,D,D,m)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(m.zoom)-1},_,S),c.evaluate({zoom:Math.floor(m.zoom)},_,S),c.evaluate({zoom:Math.floor(m.zoom)+1},_,S),m):c.value},s.prototype._calculate=function(c,m,_,S){return S.zoom>S.zoomHistory.lastIntegerZoom?{from:c,to:m}:{from:_,to:m}},s.prototype.interpolate=function(c){return c},s}(Bn),Es=function(a){this.specification=a};Es.prototype.possiblyEvaluate=function(a,s,c,m){if(a.value!==void 0){if(a.expression.kind==="constant"){var _=a.expression.evaluate(s,null,{},c,m);return this._calculate(_,_,_,s)}return this._calculate(a.expression.evaluate(new Vi(Math.floor(s.zoom-1),s)),a.expression.evaluate(new Vi(Math.floor(s.zoom),s)),a.expression.evaluate(new Vi(Math.floor(s.zoom+1),s)),s)}},Es.prototype._calculate=function(a,s,c,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:a,to:s}:{from:c,to:s}},Es.prototype.interpolate=function(a){return a};var uu=function(a){this.specification=a};uu.prototype.possiblyEvaluate=function(a,s,c,m){return!!a.expression.evaluate(s,null,{},c,m)},uu.prototype.interpolate=function(){return!1};var is=function(a){for(var s in this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],a){var c=a[s];c.specification.overridable&&this.overridableProperties.push(s);var m=this.defaultPropertyValues[s]=new Ra(c,void 0),_=this.defaultTransitionablePropertyValues[s]=new su(c);this.defaultTransitioningPropertyValues[s]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=m.possiblyEvaluate({})}};Dn("DataDrivenProperty",Bn),Dn("DataConstantProperty",Qn),Dn("CrossFadedDataDrivenProperty",Gc),Dn("CrossFadedProperty",Es),Dn("ColorRampProperty",uu);var wu=function(a){function s(c,m){if(a.call(this),this.id=c.id,this.type=c.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},c.type!=="custom"&&(this.metadata=(c=c).metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),m.layout&&(this._unevaluatedLayout=new qs(m.layout)),m.paint)){for(var _ in this._transitionablePaint=new qo(m.paint),c.paint)this.setPaintProperty(_,c.paint[_],{validate:!1});for(var S in c.layout)this.setLayoutProperty(S,c.layout[S],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Rs(m.paint)}}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},s.prototype.getLayoutProperty=function(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)},s.prototype.setLayoutProperty=function(c,m,_){_===void 0&&(_={}),m!=null&&this._validate(Ef,"layers."+this.id+".layout."+c,c,m,_)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,m):this.visibility=m)},s.prototype.getPaintProperty=function(c){return J(c,"-transition")?this._transitionablePaint.getTransition(c.slice(0,-"-transition".length)):this._transitionablePaint.getValue(c)},s.prototype.setPaintProperty=function(c,m,_){if(_===void 0&&(_={}),m!=null&&this._validate(np,"layers."+this.id+".paint."+c,c,m,_))return!1;if(J(c,"-transition"))return this._transitionablePaint.setTransition(c.slice(0,-"-transition".length),m||void 0),!1;var S=this._transitionablePaint._values[c],C=S.property.specification["property-type"]==="cross-faded-data-driven",P=S.value.isDataDriven(),D=S.value;this._transitionablePaint.setValue(c,m),this._handleSpecialPaintPropertyUpdate(c);var j=this._transitionablePaint._values[c].value;return j.isDataDriven()||P||C||this._handleOverridablePaintPropertyUpdate(c,D,j)},s.prototype._handleSpecialPaintPropertyUpdate=function(c){},s.prototype._handleOverridablePaintPropertyUpdate=function(c,m,_){return!1},s.prototype.isHidden=function(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"},s.prototype.updateTransitions=function(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)},s.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},s.prototype.recalculate=function(c,m){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,m)},s.prototype.serialize=function(){var c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),Ct(c,function(m,_){return!(m===void 0||_==="layout"&&!Object.keys(m).length||_==="paint"&&!Object.keys(m).length)})},s.prototype._validate=function(c,m,_,S,C){return C===void 0&&(C={}),(!C||C.validate!==!1)&&zl(this,c.call(bf,{key:m,layerType:this.type,objectKey:_,value:S,styleSpec:me,style:{glyphs:!0,sprite:!0}}))},s.prototype.is3D=function(){return!1},s.prototype.isTileClipped=function(){return!1},s.prototype.hasOffscreenPass=function(){return!1},s.prototype.resize=function(){},s.prototype.isStateDependent=function(){for(var c in this.paint._values){var m=this.paint.get(c);if(m instanceof ps&&nu(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1},s}(dt),mc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},jl=function(a,s){this._structArray=a,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},wa=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Ga(a,s){s===void 0&&(s=1);var c=0,m=0;return{members:a.map(function(_){var S=mc[_.type].BYTES_PER_ELEMENT,C=c=eh(c,Math.max(s,S)),P=_.components||1;return m=Math.max(m,S),c+=S*P,{name:_.name,type:_.type,components:P,offset:C}}),size:eh(c,Math.max(m,s)),alignment:s}}function eh(a,s){return Math.ceil(a/s)*s}wa.serialize=function(a,s){return a._trim(),s&&(a.isTransferred=!0,s.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},wa.deserialize=function(a){var s=Object.create(this.prototype);return s.arrayBuffer=a.arrayBuffer,s.length=a.length,s.capacity=a.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s},wa.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},wa.prototype.clear=function(){this.length=0},wa.prototype.resize=function(a){this.reserve(a),this.length=a},wa.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}},wa.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Gl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m){var _=this.length;return this.resize(_+1),this.emplace(_,c,m)},s.prototype.emplace=function(c,m,_){var S=2*c;return this.int16[S+0]=m,this.int16[S+1]=_,c},s}(wa);Gl.prototype.bytesPerElement=4,Dn("StructArrayLayout2i4",Gl);var Ks=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S){var C=this.length;return this.resize(C+1),this.emplace(C,c,m,_,S)},s.prototype.emplace=function(c,m,_,S,C){var P=4*c;return this.int16[P+0]=m,this.int16[P+1]=_,this.int16[P+2]=S,this.int16[P+3]=C,c},s}(wa);Ks.prototype.bytesPerElement=8,Dn("StructArrayLayout4i8",Ks);var lu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,C,P){var D=this.length;return this.resize(D+1),this.emplace(D,c,m,_,S,C,P)},s.prototype.emplace=function(c,m,_,S,C,P,D){var j=6*c;return this.int16[j+0]=m,this.int16[j+1]=_,this.int16[j+2]=S,this.int16[j+3]=C,this.int16[j+4]=P,this.int16[j+5]=D,c},s}(wa);lu.prototype.bytesPerElement=12,Dn("StructArrayLayout2i4i12",lu);var Ko=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,C,P){var D=this.length;return this.resize(D+1),this.emplace(D,c,m,_,S,C,P)},s.prototype.emplace=function(c,m,_,S,C,P,D){var j=4*c,B=8*c;return this.int16[j+0]=m,this.int16[j+1]=_,this.uint8[B+4]=S,this.uint8[B+5]=C,this.uint8[B+6]=P,this.uint8[B+7]=D,c},s}(wa);Ko.prototype.bytesPerElement=8,Dn("StructArrayLayout2i4ub8",Ko);var Yu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m){var _=this.length;return this.resize(_+1),this.emplace(_,c,m)},s.prototype.emplace=function(c,m,_){var S=2*c;return this.float32[S+0]=m,this.float32[S+1]=_,c},s}(wa);Yu.prototype.bytesPerElement=8,Dn("StructArrayLayout2f8",Yu);var Cu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,C,P,D,j,B,K){var V=this.length;return this.resize(V+1),this.emplace(V,c,m,_,S,C,P,D,j,B,K)},s.prototype.emplace=function(c,m,_,S,C,P,D,j,B,K,V){var de=10*c;return this.uint16[de+0]=m,this.uint16[de+1]=_,this.uint16[de+2]=S,this.uint16[de+3]=C,this.uint16[de+4]=P,this.uint16[de+5]=D,this.uint16[de+6]=j,this.uint16[de+7]=B,this.uint16[de+8]=K,this.uint16[de+9]=V,c},s}(wa);Cu.prototype.bytesPerElement=20,Dn("StructArrayLayout10ui20",Cu);var gc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,C,P,D,j,B,K,V,de){var ze=this.length;return this.resize(ze+1),this.emplace(ze,c,m,_,S,C,P,D,j,B,K,V,de)},s.prototype.emplace=function(c,m,_,S,C,P,D,j,B,K,V,de,ze){var Ue=12*c;return this.int16[Ue+0]=m,this.int16[Ue+1]=_,this.int16[Ue+2]=S,this.int16[Ue+3]=C,this.uint16[Ue+4]=P,this.uint16[Ue+5]=D,this.uint16[Ue+6]=j,this.uint16[Ue+7]=B,this.int16[Ue+8]=K,this.int16[Ue+9]=V,this.int16[Ue+10]=de,this.int16[Ue+11]=ze,c},s}(wa);gc.prototype.bytesPerElement=24,Dn("StructArrayLayout4i4ui4i24",gc);var Hl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var S=this.length;return this.resize(S+1),this.emplace(S,c,m,_)},s.prototype.emplace=function(c,m,_,S){var C=3*c;return this.float32[C+0]=m,this.float32[C+1]=_,this.float32[C+2]=S,c},s}(wa);Hl.prototype.bytesPerElement=12,Dn("StructArrayLayout3f12",Hl);var ml=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},s.prototype.emplace=function(c,m){return this.uint32[1*c+0]=m,c},s}(wa);ml.prototype.bytesPerElement=4,Dn("StructArrayLayout1ul4",ml);var Tf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,C,P,D,j,B){var K=this.length;return this.resize(K+1),this.emplace(K,c,m,_,S,C,P,D,j,B)},s.prototype.emplace=function(c,m,_,S,C,P,D,j,B,K){var V=10*c,de=5*c;return this.int16[V+0]=m,this.int16[V+1]=_,this.int16[V+2]=S,this.int16[V+3]=C,this.int16[V+4]=P,this.int16[V+5]=D,this.uint32[de+3]=j,this.uint16[V+8]=B,this.uint16[V+9]=K,c},s}(wa);Tf.prototype.bytesPerElement=20,Dn("StructArrayLayout6i1ul2ui20",Tf);var gl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,C,P){var D=this.length;return this.resize(D+1),this.emplace(D,c,m,_,S,C,P)},s.prototype.emplace=function(c,m,_,S,C,P,D){var j=6*c;return this.int16[j+0]=m,this.int16[j+1]=_,this.int16[j+2]=S,this.int16[j+3]=C,this.int16[j+4]=P,this.int16[j+5]=D,c},s}(wa);gl.prototype.bytesPerElement=12,Dn("StructArrayLayout2i2i2i12",gl);var yc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,C){var P=this.length;return this.resize(P+1),this.emplace(P,c,m,_,S,C)},s.prototype.emplace=function(c,m,_,S,C,P){var D=4*c,j=8*c;return this.float32[D+0]=m,this.float32[D+1]=_,this.float32[D+2]=S,this.int16[j+6]=C,this.int16[j+7]=P,c},s}(wa);yc.prototype.bytesPerElement=16,Dn("StructArrayLayout2f1f2i16",yc);var Ch=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S){var C=this.length;return this.resize(C+1),this.emplace(C,c,m,_,S)},s.prototype.emplace=function(c,m,_,S,C){var P=12*c,D=3*c;return this.uint8[P+0]=m,this.uint8[P+1]=_,this.float32[D+1]=S,this.float32[D+2]=C,c},s}(wa);Ch.prototype.bytesPerElement=12,Dn("StructArrayLayout2ub2f12",Ch);var qu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var S=this.length;return this.resize(S+1),this.emplace(S,c,m,_)},s.prototype.emplace=function(c,m,_,S){var C=3*c;return this.uint16[C+0]=m,this.uint16[C+1]=_,this.uint16[C+2]=S,c},s}(wa);qu.prototype.bytesPerElement=6,Dn("StructArrayLayout3ui6",qu);var yl=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,C,P,D,j,B,K,V,de,ze,Ue,st,Ke,St){var jt=this.length;return this.resize(jt+1),this.emplace(jt,c,m,_,S,C,P,D,j,B,K,V,de,ze,Ue,st,Ke,St)},s.prototype.emplace=function(c,m,_,S,C,P,D,j,B,K,V,de,ze,Ue,st,Ke,St,jt){var or=24*c,lr=12*c,Cr=48*c;return this.int16[or+0]=m,this.int16[or+1]=_,this.uint16[or+2]=S,this.uint16[or+3]=C,this.uint32[lr+2]=P,this.uint32[lr+3]=D,this.uint32[lr+4]=j,this.uint16[or+10]=B,this.uint16[or+11]=K,this.uint16[or+12]=V,this.float32[lr+7]=de,this.float32[lr+8]=ze,this.uint8[Cr+36]=Ue,this.uint8[Cr+37]=st,this.uint8[Cr+38]=Ke,this.uint32[lr+10]=St,this.int16[or+22]=jt,c},s}(wa);yl.prototype.bytesPerElement=48,Dn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",yl);var Mf=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S,C,P,D,j,B,K,V,de,ze,Ue,st,Ke,St,jt,or,lr,Cr,Qr,dn,ti,Rn,si,On,ji){var bi=this.length;return this.resize(bi+1),this.emplace(bi,c,m,_,S,C,P,D,j,B,K,V,de,ze,Ue,st,Ke,St,jt,or,lr,Cr,Qr,dn,ti,Rn,si,On,ji)},s.prototype.emplace=function(c,m,_,S,C,P,D,j,B,K,V,de,ze,Ue,st,Ke,St,jt,or,lr,Cr,Qr,dn,ti,Rn,si,On,ji,bi){var Kn=34*c,na=17*c;return this.int16[Kn+0]=m,this.int16[Kn+1]=_,this.int16[Kn+2]=S,this.int16[Kn+3]=C,this.int16[Kn+4]=P,this.int16[Kn+5]=D,this.int16[Kn+6]=j,this.int16[Kn+7]=B,this.uint16[Kn+8]=K,this.uint16[Kn+9]=V,this.uint16[Kn+10]=de,this.uint16[Kn+11]=ze,this.uint16[Kn+12]=Ue,this.uint16[Kn+13]=st,this.uint16[Kn+14]=Ke,this.uint16[Kn+15]=St,this.uint16[Kn+16]=jt,this.uint16[Kn+17]=or,this.uint16[Kn+18]=lr,this.uint16[Kn+19]=Cr,this.uint16[Kn+20]=Qr,this.uint16[Kn+21]=dn,this.uint16[Kn+22]=ti,this.uint32[na+12]=Rn,this.float32[na+13]=si,this.float32[na+14]=On,this.float32[na+15]=ji,this.float32[na+16]=bi,c},s}(wa);Mf.prototype.bytesPerElement=68,Dn("StructArrayLayout8i15ui1ul4f68",Mf);var zu=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},s.prototype.emplace=function(c,m){return this.float32[1*c+0]=m,c},s}(wa);zu.prototype.bytesPerElement=4,Dn("StructArrayLayout1f4",zu);var Zs=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var S=this.length;return this.resize(S+1),this.emplace(S,c,m,_)},s.prototype.emplace=function(c,m,_,S){var C=3*c;return this.int16[C+0]=m,this.int16[C+1]=_,this.int16[C+2]=S,c},s}(wa);Zs.prototype.bytesPerElement=6,Dn("StructArrayLayout3i6",Zs);var _c=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_){var S=this.length;return this.resize(S+1),this.emplace(S,c,m,_)},s.prototype.emplace=function(c,m,_,S){var C=4*c;return this.uint32[2*c+0]=m,this.uint16[C+2]=_,this.uint16[C+3]=S,c},s}(wa);_c.prototype.bytesPerElement=8,Dn("StructArrayLayout1ul2ui8",_c);var Hc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m){var _=this.length;return this.resize(_+1),this.emplace(_,c,m)},s.prototype.emplace=function(c,m,_){var S=2*c;return this.uint16[S+0]=m,this.uint16[S+1]=_,c},s}(wa);Hc.prototype.bytesPerElement=4,Dn("StructArrayLayout2ui4",Hc);var xc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},s.prototype.emplace=function(c,m){return this.uint16[1*c+0]=m,c},s}(wa);xc.prototype.bytesPerElement=2,Dn("StructArrayLayout1ui2",xc);var bc=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(c,m,_,S){var C=this.length;return this.resize(C+1),this.emplace(C,c,m,_,S)},s.prototype.emplace=function(c,m,_,S,C){var P=4*c;return this.float32[P+0]=m,this.float32[P+1]=_,this.float32[P+2]=S,this.float32[P+3]=C,c},s}(wa);bc.prototype.bytesPerElement=16,Dn("StructArrayLayout4f16",bc);var f=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return c.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},c.x1.get=function(){return this._structArray.int16[this._pos2+2]},c.y1.get=function(){return this._structArray.int16[this._pos2+3]},c.x2.get=function(){return this._structArray.int16[this._pos2+4]},c.y2.get=function(){return this._structArray.int16[this._pos2+5]},c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.anchorPoint.get=function(){return new se(this.anchorPointX,this.anchorPointY)},Object.defineProperties(s.prototype,c),s}(jl);f.prototype.size=20;var d=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new f(this,c)},s}(Tf);Dn("CollisionBoxArray",d);var h=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},c.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},c.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},c.segment.get=function(){return this._structArray.uint16[this._pos2+10]},c.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},c.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},c.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},c.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},c.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},c.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},c.placedOrientation.set=function(m){this._structArray.uint8[this._pos1+37]=m},c.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},c.hidden.set=function(m){this._structArray.uint8[this._pos1+38]=m},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+10]=m},c.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(s.prototype,c),s}(jl);h.prototype.size=48;var g=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new h(this,c)},s}(yl);Dn("PlacedSymbolArray",g);var w=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},c.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},c.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},c.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},c.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},c.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},c.key.get=function(){return this._structArray.uint16[this._pos2+8]},c.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},c.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},c.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},c.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},c.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},c.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},c.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},c.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},c.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},c.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},c.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},c.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},c.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+12]=m},c.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},c.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},c.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},c.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(s.prototype,c),s}(jl);w.prototype.size=68;var M=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new w(this,c)},s}(Mf);Dn("SymbolInstanceArray",M);var I=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getoffsetX=function(c){return this.float32[1*c+0]},s}(zu);Dn("GlyphOffsetArray",I);var O=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.getx=function(c){return this.int16[3*c+0]},s.prototype.gety=function(c){return this.int16[3*c+1]},s.prototype.gettileUnitDistanceFromAnchor=function(c){return this.int16[3*c+2]},s}(Zs);Dn("SymbolLineVertexArray",O);var G=function(a){function s(){a.apply(this,arguments)}a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s;var c={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(s.prototype,c),s}(jl);G.prototype.size=8;var Q=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.get=function(c){return new G(this,c)},s}(_c);Dn("FeatureIndexArray",Q);var ge=Ga([{name:"a_pos",components:2,type:"Int16"}],4).members,xe=function(a){a===void 0&&(a=[]),this.segments=a};function Ee(a,s){return 256*(a=Ot(Math.floor(a),0,255))+Ot(Math.floor(s),0,255)}xe.prototype.prepareSegment=function(a,s,c,m){var _=this.segments[this.segments.length-1];return a>xe.MAX_VERTEX_ARRAY_LENGTH&&vt("Max vertices per segment is "+xe.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!_||_.vertexLength+a>xe.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==m)&&(_={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},m!==void 0&&(_.sortKey=m),this.segments.push(_)),_},xe.prototype.get=function(){return this.segments},xe.prototype.destroy=function(){for(var a=0,s=this.segments;a<s.length;a+=1){var c=s[a];for(var m in c.vaos)c.vaos[m].destroy()}},xe.simpleSegment=function(a,s,c,m){return new xe([{vertexOffset:a,primitiveOffset:s,vertexLength:c,primitiveLength:m,vaos:{},sortKey:0}])},xe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Dn("SegmentVector",xe);var je=Ga([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ve=Ie(function(a){a.exports=function(s,c){var m,_,S,C,P,D,j,B;for(_=s.length-(m=3&s.length),S=c,P=3432918353,D=461845907,B=0;B<_;)j=255&s.charCodeAt(B)|(255&s.charCodeAt(++B))<<8|(255&s.charCodeAt(++B))<<16|(255&s.charCodeAt(++B))<<24,++B,S=27492+(65535&(C=5*(65535&(S=(S^=j=(65535&(j=(j=(65535&j)*P+(((j>>>16)*P&65535)<<16)&4294967295)<<15|j>>>17))*D+(((j>>>16)*D&65535)<<16)&4294967295)<<13|S>>>19))+((5*(S>>>16)&65535)<<16)&4294967295))+((58964+(C>>>16)&65535)<<16);switch(j=0,m){case 3:j^=(255&s.charCodeAt(B+2))<<16;case 2:j^=(255&s.charCodeAt(B+1))<<8;case 1:S^=j=(65535&(j=(j=(65535&(j^=255&s.charCodeAt(B)))*P+(((j>>>16)*P&65535)<<16)&4294967295)<<15|j>>>17))*D+(((j>>>16)*D&65535)<<16)&4294967295}return S^=s.length,S=2246822507*(65535&(S^=S>>>16))+((2246822507*(S>>>16)&65535)<<16)&4294967295,S=3266489909*(65535&(S^=S>>>13))+((3266489909*(S>>>16)&65535)<<16)&4294967295,(S^=S>>>16)>>>0}}),nt=Ie(function(a){a.exports=function(s,c){for(var m,_=s.length,S=c^_,C=0;_>=4;)m=1540483477*(65535&(m=255&s.charCodeAt(C)|(255&s.charCodeAt(++C))<<8|(255&s.charCodeAt(++C))<<16|(255&s.charCodeAt(++C))<<24))+((1540483477*(m>>>16)&65535)<<16),S=1540483477*(65535&S)+((1540483477*(S>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),_-=4,++C;switch(_){case 3:S^=(255&s.charCodeAt(C+2))<<16;case 2:S^=(255&s.charCodeAt(C+1))<<8;case 1:S=1540483477*(65535&(S^=255&s.charCodeAt(C)))+((1540483477*(S>>>16)&65535)<<16)}return S=1540483477*(65535&(S^=S>>>13))+((1540483477*(S>>>16)&65535)<<16),(S^=S>>>15)>>>0}}),Fe=Ve,it=nt;Fe.murmur3=Ve,Fe.murmur2=it;var yt=function(){this.ids=[],this.positions=[],this.indexed=!1};yt.prototype.add=function(a,s,c,m){this.ids.push(fr(a)),this.positions.push(s,c,m)},yt.prototype.getPositions=function(a){for(var s=fr(a),c=0,m=this.ids.length-1;c<m;){var _=c+m>>1;this.ids[_]>=s?m=_:c=_+1}for(var S=[];this.ids[c]===s;)S.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return S},yt.serialize=function(a,s){var c=new Float64Array(a.ids),m=new Uint32Array(a.positions);return function _(S,C,P,D){for(;P<D;){for(var j=S[P+D>>1],B=P-1,K=D+1;;){do B++;while(S[B]<j);do K--;while(S[K]>j);if(B>=K)break;ir(S,B,K),ir(C,3*B,3*K),ir(C,3*B+1,3*K+1),ir(C,3*B+2,3*K+2)}K-P<D-K?(_(S,C,P,K),P=K+1):(_(S,C,K+1,D),D=K)}}(c,m,0,c.length-1),s&&s.push(c.buffer,m.buffer),{ids:c,positions:m}},yt.deserialize=function(a){var s=new yt;return s.ids=a.ids,s.positions=a.positions,s.indexed=!0,s};var Bt=Math.pow(2,53)-1;function fr(a){var s=+a;return!isNaN(s)&&s<=Bt?s:Fe(String(a))}function ir(a,s,c){var m=a[s];a[s]=a[c],a[c]=m}Dn("FeaturePositionMap",yt);var mr=function(a,s){this.gl=a.gl,this.location=s},Or=function(a){function s(c,m){a.call(this,c,m),this.current=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))},s}(mr),on=function(a){function s(c,m){a.call(this,c,m),this.current=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))},s}(mr),jr=function(a){function s(c,m){a.call(this,c,m),this.current=[0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))},s}(mr),Cn=function(a){function s(c,m){a.call(this,c,m),this.current=[0,0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))},s}(mr),ni=function(a){function s(c,m){a.call(this,c,m),this.current=[0,0,0,0]}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))},s}(mr),ii=function(a){function s(c,m){a.call(this,c,m),this.current=Ji.transparent}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))},s}(mr),oi=new Float32Array(16),ta=function(a){function s(c,m){a.call(this,c,m),this.current=oi}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.set=function(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(var m=1;m<16;m++)if(c[m]!==this.current[m]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}},s}(mr);function An(a){return[Ee(255*a.r,255*a.g),Ee(255*a.b,255*a.a)]}var Ci=function(a,s,c){this.value=a,this.uniformNames=s.map(function(m){return"u_"+m}),this.type=c};Ci.prototype.setUniform=function(a,s,c){a.set(c.constantOr(this.value))},Ci.prototype.getBinding=function(a,s,c){return this.type==="color"?new ii(a,s):new on(a,s)};var En=function(a,s){this.uniformNames=s.map(function(c){return"u_"+c}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};En.prototype.setConstantPatternPositions=function(a,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=a.tlbr},En.prototype.setUniform=function(a,s,c,m){var _=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&a.set(_)},En.prototype.getBinding=function(a,s,c){return c.substr(0,9)==="u_pattern"?new ni(a,s):new on(a,s)};var li=function(a,s,c,m){this.expression=a,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(function(_){return{name:"a_"+_,type:"Float32",components:c==="color"?2:1,offset:0}}),this.paintVertexArray=new m};li.prototype.populatePaintArray=function(a,s,c,m,_){var S=this.paintVertexArray.length,C=this.expression.evaluate(new Vi(0),s,{},m,[],_);this.paintVertexArray.resize(a),this._setPaintValue(S,a,C)},li.prototype.updatePaintArray=function(a,s,c,m){var _=this.expression.evaluate({zoom:0},c,m);this._setPaintValue(a,s,_)},li.prototype._setPaintValue=function(a,s,c){if(this.type==="color")for(var m=An(c),_=a;_<s;_++)this.paintVertexArray.emplace(_,m[0],m[1]);else{for(var S=a;S<s;S++)this.paintVertexArray.emplace(S,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}},li.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},li.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Jn=function(a,s,c,m,_,S){this.expression=a,this.uniformNames=s.map(function(C){return"u_"+C+"_t"}),this.type=c,this.useIntegerZoom=m,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=s.map(function(C){return{name:"a_"+C,type:"Float32",components:c==="color"?4:2,offset:0}}),this.paintVertexArray=new S};Jn.prototype.populatePaintArray=function(a,s,c,m,_){var S=this.expression.evaluate(new Vi(this.zoom),s,{},m,[],_),C=this.expression.evaluate(new Vi(this.zoom+1),s,{},m,[],_),P=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(P,a,S,C)},Jn.prototype.updatePaintArray=function(a,s,c,m){var _=this.expression.evaluate({zoom:this.zoom},c,m),S=this.expression.evaluate({zoom:this.zoom+1},c,m);this._setPaintValue(a,s,_,S)},Jn.prototype._setPaintValue=function(a,s,c,m){if(this.type==="color")for(var _=An(c),S=An(m),C=a;C<s;C++)this.paintVertexArray.emplace(C,_[0],_[1],S[0],S[1]);else{for(var P=a;P<s;P++)this.paintVertexArray.emplace(P,c,m);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(m))}},Jn.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Jn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Jn.prototype.setUniform=function(a,s){var c=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,m=Ot(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);a.set(m)},Jn.prototype.getBinding=function(a,s,c){return new on(a,s)};var Ti=function(a,s,c,m,_,S){this.expression=a,this.type=s,this.useIntegerZoom=c,this.zoom=m,this.layerId=S,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _};Ti.prototype.populatePaintArray=function(a,s,c){var m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(m,a,s.patterns&&s.patterns[this.layerId],c)},Ti.prototype.updatePaintArray=function(a,s,c,m,_){this._setPaintValues(a,s,c.patterns&&c.patterns[this.layerId],_)},Ti.prototype._setPaintValues=function(a,s,c,m){if(m&&c){var _=m[c.min],S=m[c.mid],C=m[c.max];if(_&&S&&C)for(var P=a;P<s;P++)this.zoomInPaintVertexArray.emplace(P,S.tl[0],S.tl[1],S.br[0],S.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],S.pixelRatio,_.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,S.tl[0],S.tl[1],S.br[0],S.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],S.pixelRatio,C.pixelRatio)}},Ti.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,je.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,je.members,this.expression.isStateDependent))},Ti.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var di=function(a,s,c){this.binders={},this._buffers=[];var m=[];for(var _ in a.paint._values)if(c(_)){var S=a.paint.get(_);if(S instanceof ps&&nu(S.property.specification)){var C=Lo(_,a.type),P=S.value,D=S.property.specification.type,j=S.property.useIntegerZoom,B=S.property.specification["property-type"],K=B==="cross-faded"||B==="cross-faded-data-driven";if(P.kind==="constant")this.binders[_]=K?new En(P.value,C):new Ci(P.value,C,D),m.push("/u_"+_);else if(P.kind==="source"||K){var V=co(_,D,"source");this.binders[_]=K?new Ti(P,D,j,s,V,a.id):new li(P,C,D,V),m.push("/a_"+_)}else{var de=co(_,D,"composite");this.binders[_]=new Jn(P,C,D,j,s,de),m.push("/z_"+_)}}}this.cacheKey=m.sort().join("")};di.prototype.getMaxValue=function(a){var s=this.binders[a];return s instanceof li||s instanceof Jn?s.maxValue:0},di.prototype.populatePaintArrays=function(a,s,c,m,_){for(var S in this.binders){var C=this.binders[S];(C instanceof li||C instanceof Jn||C instanceof Ti)&&C.populatePaintArray(a,s,c,m,_)}},di.prototype.setConstantPatternPositions=function(a,s){for(var c in this.binders){var m=this.binders[c];m instanceof En&&m.setConstantPatternPositions(a,s)}},di.prototype.updatePaintArrays=function(a,s,c,m,_){var S=!1;for(var C in a)for(var P=0,D=s.getPositions(C);P<D.length;P+=1){var j=D[P],B=c.feature(j.index);for(var K in this.binders){var V=this.binders[K];if((V instanceof li||V instanceof Jn||V instanceof Ti)&&V.expression.isStateDependent===!0){var de=m.paint.get(K);V.expression=de.value,V.updatePaintArray(j.start,j.end,B,a[C],_),S=!0}}}return S},di.prototype.defines=function(){var a=[];for(var s in this.binders){var c=this.binders[s];(c instanceof Ci||c instanceof En)&&a.push.apply(a,c.uniformNames.map(function(m){return"#define HAS_UNIFORM_"+m}))}return a},di.prototype.getBinderAttributes=function(){var a=[];for(var s in this.binders){var c=this.binders[s];if(c instanceof li||c instanceof Jn)for(var m=0;m<c.paintVertexAttributes.length;m++)a.push(c.paintVertexAttributes[m].name);else if(c instanceof Ti)for(var _=0;_<je.members.length;_++)a.push(je.members[_].name)}return a},di.prototype.getBinderUniforms=function(){var a=[];for(var s in this.binders){var c=this.binders[s];if(c instanceof Ci||c instanceof En||c instanceof Jn)for(var m=0,_=c.uniformNames;m<_.length;m+=1)a.push(_[m])}return a},di.prototype.getPaintVertexBuffers=function(){return this._buffers},di.prototype.getUniforms=function(a,s){var c=[];for(var m in this.binders){var _=this.binders[m];if(_ instanceof Ci||_ instanceof En||_ instanceof Jn)for(var S=0,C=_.uniformNames;S<C.length;S+=1){var P=C[S];if(s[P]){var D=_.getBinding(a,s[P],P);c.push({name:P,property:m,binding:D})}}}return c},di.prototype.setUniforms=function(a,s,c,m){for(var _=0,S=s;_<S.length;_+=1){var C=S[_],P=C.name,D=C.property;this.binders[D].setUniform(C.binding,m,c.get(D),P)}},di.prototype.updatePaintBuffers=function(a){for(var s in this._buffers=[],this.binders){var c=this.binders[s];if(a&&c instanceof Ti){var m=a.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(c instanceof li||c instanceof Jn)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}},di.prototype.upload=function(a){for(var s in this.binders){var c=this.binders[s];(c instanceof li||c instanceof Jn||c instanceof Ti)&&c.upload(a)}this.updatePaintBuffers()},di.prototype.destroy=function(){for(var a in this.binders){var s=this.binders[a];(s instanceof li||s instanceof Jn||s instanceof Ti)&&s.destroy()}};var fi=function(a,s,c){c===void 0&&(c=function(){return!0}),this.programConfigurations={};for(var m=0,_=a;m<_.length;m+=1){var S=_[m];this.programConfigurations[S.id]=new di(S,s,c)}this.needsUpload=!1,this._featureMap=new yt,this._bufferOffset=0};function Lo(a,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(s+"-","").replace(/-/g,"_")]}function co(a,s,c){var m={color:{source:Yu,composite:bc},number:{source:zu,composite:Yu}},_=function(S){return{"line-pattern":{source:Cu,composite:Cu},"fill-pattern":{source:Cu,composite:Cu},"fill-extrusion-pattern":{source:Cu,composite:Cu}}[S]}(a);return _&&_[c]||m[s][c]}fi.prototype.populatePaintArrays=function(a,s,c,m,_,S){for(var C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(a,s,m,_,S);s.id!==void 0&&this._featureMap.add(s.id,c,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},fi.prototype.updatePaintArrays=function(a,s,c,m){for(var _=0,S=c;_<S.length;_+=1){var C=S[_];this.needsUpload=this.programConfigurations[C.id].updatePaintArrays(a,this._featureMap,s,C,m)||this.needsUpload}},fi.prototype.get=function(a){return this.programConfigurations[a]},fi.prototype.upload=function(a){if(this.needsUpload){for(var s in this.programConfigurations)this.programConfigurations[s].upload(a);this.needsUpload=!1}},fi.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},Dn("ConstantBinder",Ci),Dn("CrossFadedConstantBinder",En),Dn("SourceExpressionBinder",li),Dn("CrossFadedCompositeBinder",Ti),Dn("CompositeExpressionBinder",Jn),Dn("ProgramConfiguration",di,{omit:["_buffers"]}),Dn("ProgramConfigurationSet",fi);var Oo=Math.pow(2,14)-1,Fo=-Oo-1;function qa(a){for(var s=8192/a.extent,c=a.loadGeometry(),m=0;m<c.length;m++)for(var _=c[m],S=0;S<_.length;S++){var C=_[S],P=Math.round(C.x*s),D=Math.round(C.y*s);C.x=Ot(P,Fo,Oo),C.y=Ot(D,Fo,Oo),(P<C.x||P>C.x+1||D<C.y||D>C.y+1)&&vt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return c}function io(a,s){return{type:a.type,id:a.id,properties:a.properties,geometry:s?qa(a):[]}}function Ls(a,s,c,m,_){a.emplaceBack(2*s+(m+1)/2,2*c+(_+1)/2)}var Hi=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Gl,this.indexArray=new qu,this.segments=new xe,this.programConfigurations=new fi(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function Wt(a,s){for(var c=0;c<a.length;c++)if(Au(s,a[c]))return!0;for(var m=0;m<s.length;m++)if(Au(a,s[m]))return!0;return!!yu(a,s)}function Ss(a,s,c){return!!Au(a,s)||!!Ku(s,a,c)}function be(a,s){if(a.length===1)return Wc(s,a[0]);for(var c=0;c<s.length;c++)for(var m=s[c],_=0;_<m.length;_++)if(Au(a,m[_]))return!0;for(var S=0;S<a.length;S++)if(Wc(s,a[S]))return!0;for(var C=0;C<s.length;C++)if(yu(a,s[C]))return!0;return!1}function ws(a,s,c){if(a.length>1){if(yu(a,s))return!0;for(var m=0;m<s.length;m++)if(Ku(s[m],a,c))return!0}for(var _=0;_<a.length;_++)if(Ku(a[_],s,c))return!0;return!1}function yu(a,s){if(a.length===0||s.length===0)return!1;for(var c=0;c<a.length-1;c++)for(var m=a[c],_=a[c+1],S=0;S<s.length-1;S++)if(Ec(m,_,s[S],s[S+1]))return!0;return!1}function Ec(a,s,c,m){return sr(a,c,m)!==sr(s,c,m)&&sr(a,s,c)!==sr(a,s,m)}function Ku(a,s,c){var m=c*c;if(s.length===1)return a.distSqr(s[0])<m;for(var _=1;_<s.length;_++)if(Sc(a,s[_-1],s[_])<m)return!0;return!1}function Sc(a,s,c){var m=s.distSqr(c);if(m===0)return a.distSqr(s);var _=((a.x-s.x)*(c.x-s.x)+(a.y-s.y)*(c.y-s.y))/m;return a.distSqr(_<0?s:_>1?c:c.sub(s)._mult(_)._add(s))}function Wc(a,s){for(var c,m,_,S=!1,C=0;C<a.length;C++)for(var P=0,D=(c=a[C]).length-1;P<c.length;D=P++)(m=c[P]).y>s.y!=(_=c[D]).y>s.y&&s.x<(_.x-m.x)*(s.y-m.y)/(_.y-m.y)+m.x&&(S=!S);return S}function Au(a,s){for(var c=!1,m=0,_=a.length-1;m<a.length;_=m++){var S=a[m],C=a[_];S.y>s.y!=C.y>s.y&&s.x<(C.x-S.x)*(s.y-S.y)/(C.y-S.y)+S.x&&(c=!c)}return c}function Wl(a,s,c){var m=c[0],_=c[2];if(a.x<m.x&&s.x<m.x||a.x>_.x&&s.x>_.x||a.y<m.y&&s.y<m.y||a.y>_.y&&s.y>_.y)return!1;var S=sr(a,s,c[0]);return S!==sr(a,s,c[1])||S!==sr(a,s,c[2])||S!==sr(a,s,c[3])}function Tu(a,s,c){var m=s.paint.get(a).value;return m.kind==="constant"?m.value:c.programConfigurations.get(s.id).getMaxValue(a)}function Do(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function _u(a,s,c,m,_){if(!s[0]&&!s[1])return a;var S=se.convert(s)._mult(_);c==="viewport"&&S._rotate(-m);for(var C=[],P=0;P<a.length;P++)C.push(a[P].sub(S));return C}Hi.prototype.populate=function(a,s,c){var m=this.layers[0],_=[],S=null;m.type==="circle"&&(S=m.layout.get("circle-sort-key"));for(var C=0,P=a;C<P.length;C+=1){var D=P[C],j=D.feature,B=D.id,K=D.index,V=D.sourceLayerIndex,de=this.layers[0]._featureFilter.needGeometry,ze=io(j,de);if(this.layers[0]._featureFilter.filter(new Vi(this.zoom),ze,c)){var Ue=S?S.evaluate(ze,{},c):void 0,st={id:B,properties:j.properties,type:j.type,sourceLayerIndex:V,index:K,geometry:de?ze.geometry:qa(j),patterns:{},sortKey:Ue};_.push(st)}}S&&_.sort(function(dn,ti){return dn.sortKey-ti.sortKey});for(var Ke=0,St=_;Ke<St.length;Ke+=1){var jt=St[Ke],or=jt.geometry,lr=jt.index,Cr=jt.sourceLayerIndex,Qr=a[lr].feature;this.addFeature(jt,or,lr,c),s.featureIndex.insert(Qr,or,lr,Cr,this.index)}},Hi.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},Hi.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Hi.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Hi.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,ge),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Hi.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Hi.prototype.addFeature=function(a,s,c,m){for(var _=0,S=s;_<S.length;_+=1)for(var C=0,P=S[_];C<P.length;C+=1){var D=P[C],j=D.x,B=D.y;if(!(j<0||j>=8192||B<0||B>=8192)){var K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),V=K.vertexLength;Ls(this.layoutVertexArray,j,B,-1,-1),Ls(this.layoutVertexArray,j,B,1,-1),Ls(this.layoutVertexArray,j,B,1,1),Ls(this.layoutVertexArray,j,B,-1,1),this.indexArray.emplaceBack(V,V+1,V+2),this.indexArray.emplaceBack(V,V+3,V+2),K.vertexLength+=4,K.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,{},m)},Dn("CircleBucket",Hi,{omit:["layers"]});var Qu=new is({"circle-sort-key":new Bn(me.layout_circle["circle-sort-key"])}),Ju={paint:new is({"circle-radius":new Bn(me.paint_circle["circle-radius"]),"circle-color":new Bn(me.paint_circle["circle-color"]),"circle-blur":new Bn(me.paint_circle["circle-blur"]),"circle-opacity":new Bn(me.paint_circle["circle-opacity"]),"circle-translate":new Qn(me.paint_circle["circle-translate"]),"circle-translate-anchor":new Qn(me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Qn(me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Qn(me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Bn(me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Bn(me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Bn(me.paint_circle["circle-stroke-opacity"])}),layout:Qu},pa=typeof Float32Array!="undefined"?Float32Array:Array;function Qs(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function as(a,s,c){var m=s[0],_=s[1],S=s[2],C=s[3],P=s[4],D=s[5],j=s[6],B=s[7],K=s[8],V=s[9],de=s[10],ze=s[11],Ue=s[12],st=s[13],Ke=s[14],St=s[15],jt=c[0],or=c[1],lr=c[2],Cr=c[3];return a[0]=jt*m+or*P+lr*K+Cr*Ue,a[1]=jt*_+or*D+lr*V+Cr*st,a[2]=jt*S+or*j+lr*de+Cr*Ke,a[3]=jt*C+or*B+lr*ze+Cr*St,a[4]=(jt=c[4])*m+(or=c[5])*P+(lr=c[6])*K+(Cr=c[7])*Ue,a[5]=jt*_+or*D+lr*V+Cr*st,a[6]=jt*S+or*j+lr*de+Cr*Ke,a[7]=jt*C+or*B+lr*ze+Cr*St,a[8]=(jt=c[8])*m+(or=c[9])*P+(lr=c[10])*K+(Cr=c[11])*Ue,a[9]=jt*_+or*D+lr*V+Cr*st,a[10]=jt*S+or*j+lr*de+Cr*Ke,a[11]=jt*C+or*B+lr*ze+Cr*St,a[12]=(jt=c[12])*m+(or=c[13])*P+(lr=c[14])*K+(Cr=c[15])*Ue,a[13]=jt*_+or*D+lr*V+Cr*st,a[14]=jt*S+or*j+lr*de+Cr*Ke,a[15]=jt*C+or*B+lr*ze+Cr*St,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,s=0,c=arguments.length;c--;)s+=a[c]*a[c];return Math.sqrt(s)});var Zu,Xl=as;function Xc(a,s,c){var m=s[0],_=s[1],S=s[2],C=s[3];return a[0]=c[0]*m+c[4]*_+c[8]*S+c[12]*C,a[1]=c[1]*m+c[5]*_+c[9]*S+c[13]*C,a[2]=c[2]*m+c[6]*_+c[10]*S+c[14]*C,a[3]=c[3]*m+c[7]*_+c[11]*S+c[15]*C,a}Zu=new pa(3),pa!=Float32Array&&(Zu[0]=0,Zu[1]=0,Zu[2]=0),function(){var a=new pa(4);pa!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)}();var $c=(function(){var a=new pa(2);pa!=Float32Array&&(a[0]=0,a[1]=0)}(),function(a){function s(c){a.call(this,c,Ju)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(c){return new Hi(c)},s.prototype.queryRadius=function(c){var m=c;return Tu("circle-radius",this,m)+Tu("circle-stroke-width",this,m)+Do(this.paint.get("circle-translate"))},s.prototype.queryIntersectsFeature=function(c,m,_,S,C,P,D,j){for(var B=_u(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),P.angle,D),K=this.paint.get("circle-radius").evaluate(m,_)+this.paint.get("circle-stroke-width").evaluate(m,_),V=this.paint.get("circle-pitch-alignment")==="map",de=V?B:function(Qr,dn){return Qr.map(function(ti){return Os(ti,dn)})}(B,j),ze=V?K*D:K,Ue=0,st=S;Ue<st.length;Ue+=1)for(var Ke=0,St=st[Ue];Ke<St.length;Ke+=1){var jt=St[Ke],or=V?jt:Os(jt,j),lr=ze,Cr=Xc([],[jt.x,jt.y,0,1],j);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?lr*=Cr[3]/P.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(lr*=P.cameraToCenterDistance/Cr[3]),Ss(de,or,lr))return!0}return!1},s}(wu));function Os(a,s){var c=Xc([],[a.x,a.y,0,1],s);return new se(c[0]/c[3],c[1]/c[3])}var $l=function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(Hi);function cu(a,s,c,m){var _=s.width,S=s.height;if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==_*S*c)throw new RangeError("mismatched image size")}else m=new Uint8Array(_*S*c);return a.width=_,a.height=S,a.data=m,a}function _l(a,s,c){var m=s.width,_=s.height;if(m!==a.width||_!==a.height){var S=cu({},{width:m,height:_},c);Yc(a,S,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,m),height:Math.min(a.height,_)},c),a.width=m,a.height=_,a.data=S.data}}function Yc(a,s,c,m,_,S){if(_.width===0||_.height===0)return s;if(_.width>a.width||_.height>a.height||c.x>a.width-_.width||c.y>a.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>s.width||_.height>s.height||m.x>s.width-_.width||m.y>s.height-_.height)throw new RangeError("out of range destination coordinates for image copy");for(var C=a.data,P=s.data,D=0;D<_.height;D++)for(var j=((c.y+D)*a.width+c.x)*S,B=((m.y+D)*s.width+m.x)*S,K=0;K<_.width*S;K++)P[B+K]=C[j+K];return s}Dn("HeatmapBucket",$l,{omit:["layers"]});var Us=function(a,s){cu(this,a,1,s)};Us.prototype.resize=function(a){_l(this,a,1)},Us.prototype.clone=function(){return new Us({width:this.width,height:this.height},new Uint8Array(this.data))},Us.copy=function(a,s,c,m,_){Yc(a,s,c,m,_,1)};var Go=function(a,s){cu(this,a,4,s)};Go.prototype.resize=function(a){_l(this,a,4)},Go.prototype.replace=function(a,s){s?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},Go.prototype.clone=function(){return new Go({width:this.width,height:this.height},new Uint8Array(this.data))},Go.copy=function(a,s,c,m,_){Yc(a,s,c,m,_,4)},Dn("AlphaImage",Us),Dn("RGBAImage",Go);var qc={paint:new is({"heatmap-radius":new Bn(me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Bn(me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Qn(me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new uu(me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Qn(me.paint_heatmap["heatmap-opacity"])})};function th(a){var s={},c=a.resolution||256,m=a.clips?a.clips.length:1,_=a.image||new Go({width:c,height:m}),S=function(ze,Ue,st){s[a.evaluationKey]=st;var Ke=a.expression.evaluate(s);_.data[ze+Ue+0]=Math.floor(255*Ke.r/Ke.a),_.data[ze+Ue+1]=Math.floor(255*Ke.g/Ke.a),_.data[ze+Ue+2]=Math.floor(255*Ke.b/Ke.a),_.data[ze+Ue+3]=Math.floor(255*Ke.a)};if(a.clips)for(var C=0,P=0;C<m;++C,P+=4*c)for(var D=0,j=0;D<c;D++,j+=4){var B=D/(c-1),K=a.clips[C];S(P,j,K.start*(1-B)+K.end*B)}else for(var V=0,de=0;V<c;V++,de+=4)S(0,de,V/(c-1));return _}var Ah=function(a){function s(c){a.call(this,c,qc),this._updateColorRamp()}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(c){return new $l(c)},s.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="heatmap-color"&&this._updateColorRamp()},s.prototype._updateColorRamp=function(){this.colorRamp=th({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},s.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},s}(wu),Kc={paint:new is({"hillshade-illumination-direction":new Qn(me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Qn(me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Qn(me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Qn(me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Qn(me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Qn(me.paint_hillshade["hillshade-accent-color"])})},ip=function(a){function s(c){a.call(this,c,Kc)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},s}(wu),el=Ga([{name:"a_pos",components:2,type:"Int16"}],4).members,Yl=Th,rh=Th;function Th(a,s,c){c=c||2;var m,_,S,C,P,D,j,B=s&&s.length,K=B?s[0]*c:a.length,V=Id(a,0,K,c,!0),de=[];if(!V||V.next===V.prev)return de;if(B&&(V=function(Ue,st,Ke,St){var jt,or,lr,Cr=[];for(jt=0,or=st.length;jt<or;jt++)(lr=Id(Ue,st[jt]*St,jt<or-1?st[jt+1]*St:Ue.length,St,!1))===lr.next&&(lr.steiner=!0),Cr.push(Ld(lr));for(Cr.sort(Pd),jt=0;jt<Cr.length;jt++)Rd(Cr[jt],Ke),Ke=wc(Ke,Ke.next);return Ke}(a,s,V,c)),a.length>80*c){m=S=a[0],_=C=a[1];for(var ze=c;ze<K;ze+=c)(P=a[ze])<m&&(m=P),(D=a[ze+1])<_&&(_=D),P>S&&(S=P),D>C&&(C=D);j=(j=Math.max(S-m,C-_))!==0?1/j:0}return Qc(V,de,c,m,_,j),de}function Id(a,s,c,m,_){var S,C;if(_===Ih(a,s,c,m)>0)for(S=s;S<c;S+=m)C=oh(S,a[S],a[S+1],C);else for(S=c-m;S>=s;S-=m)C=oh(S,a[S],a[S+1],C);return C&&kh(C,C.next)&&(Cc(C),C=C.next),C}function wc(a,s){if(!a)return a;s||(s=a);var c,m=a;do if(c=!1,m.steiner||!kh(m,m.next)&&Bo(m.prev,m,m.next)!==0)m=m.next;else{if(Cc(m),(m=s=m.prev)===m.next)break;c=!0}while(c||m!==s);return s}function Qc(a,s,c,m,_,S,C){if(a){!C&&S&&function(B,K,V,de){var ze=B;do ze.z===null&&(ze.z=sp(ze.x,ze.y,K,V,de)),ze.prevZ=ze.prev,ze.nextZ=ze.next,ze=ze.next;while(ze!==B);ze.prevZ.nextZ=null,ze.prevZ=null,function(Ue){var st,Ke,St,jt,or,lr,Cr,Qr,dn=1;do{for(Ke=Ue,Ue=null,or=null,lr=0;Ke;){for(lr++,St=Ke,Cr=0,st=0;st<dn&&(Cr++,St=St.nextZ);st++);for(Qr=dn;Cr>0||Qr>0&&St;)Cr!==0&&(Qr===0||!St||Ke.z<=St.z)?(jt=Ke,Ke=Ke.nextZ,Cr--):(jt=St,St=St.nextZ,Qr--),or?or.nextZ=jt:Ue=jt,jt.prevZ=or,or=jt;Ke=St}or.nextZ=null,dn*=2}while(lr>1)}(ze)}(a,m,_,S);for(var P,D,j=a;a.prev!==a.next;)if(P=a.prev,D=a.next,S?zv(a,m,_,S):ap(a))s.push(P.i/c),s.push(a.i/c),s.push(D.i/c),Cc(a),a=D.next,j=D.next;else if((a=D)===j){C?C===1?Qc(a=nh(wc(a),s,c),s,c,m,_,S,2):C===2&&op(a,s,c,m,_,S):Qc(wc(a),s,c,m,_,S,1);break}}}function ap(a){var s=a.prev,c=a,m=a.next;if(Bo(s,c,m)>=0)return!1;for(var _=a.next.next;_!==a.prev;){if(kf(s.x,s.y,c.x,c.y,m.x,m.y,_.x,_.y)&&Bo(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function zv(a,s,c,m){var _=a.prev,S=a,C=a.next;if(Bo(_,S,C)>=0)return!1;for(var P=_.x>S.x?_.x>C.x?_.x:C.x:S.x>C.x?S.x:C.x,D=_.y>S.y?_.y>C.y?_.y:C.y:S.y>C.y?S.y:C.y,j=sp(_.x<S.x?_.x<C.x?_.x:C.x:S.x<C.x?S.x:C.x,_.y<S.y?_.y<C.y?_.y:C.y:S.y<C.y?S.y:C.y,s,c,m),B=sp(P,D,s,c,m),K=a.prevZ,V=a.nextZ;K&&K.z>=j&&V&&V.z<=B;){if(K!==a.prev&&K!==a.next&&kf(_.x,_.y,S.x,S.y,C.x,C.y,K.x,K.y)&&Bo(K.prev,K,K.next)>=0||(K=K.prevZ,V!==a.prev&&V!==a.next&&kf(_.x,_.y,S.x,S.y,C.x,C.y,V.x,V.y)&&Bo(V.prev,V,V.next)>=0))return!1;V=V.nextZ}for(;K&&K.z>=j;){if(K!==a.prev&&K!==a.next&&kf(_.x,_.y,S.x,S.y,C.x,C.y,K.x,K.y)&&Bo(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;V&&V.z<=B;){if(V!==a.prev&&V!==a.next&&kf(_.x,_.y,S.x,S.y,C.x,C.y,V.x,V.y)&&Bo(V.prev,V,V.next)>=0)return!1;V=V.nextZ}return!0}function nh(a,s,c){var m=a;do{var _=m.prev,S=m.next.next;!kh(_,S)&&Xp(_,m,m.next,S)&&Jc(_,S)&&Jc(S,_)&&(s.push(_.i/c),s.push(m.i/c),s.push(S.i/c),Cc(m),Cc(m.next),m=a=S),m=m.next}while(m!==a);return wc(m)}function op(a,s,c,m,_,S){var C=a;do{for(var P=C.next.next;P!==C.prev;){if(C.i!==P.i&&Mh(C,P)){var D=up(C,P);return C=wc(C,C.next),D=wc(D,D.next),Qc(C,s,c,m,_,S),void Qc(D,s,c,m,_,S)}P=P.next}C=C.next}while(C!==a)}function Pd(a,s){return a.x-s.x}function Rd(a,s){if(s=function(m,_){var S,C=_,P=m.x,D=m.y,j=-1/0;do{if(D<=C.y&&D>=C.next.y&&C.next.y!==C.y){var B=C.x+(D-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(B<=P&&B>j){if(j=B,B===P){if(D===C.y)return C;if(D===C.next.y)return C.next}S=C.x<C.next.x?C:C.next}}C=C.next}while(C!==_);if(!S)return null;if(P===j)return S;var K,V=S,de=S.x,ze=S.y,Ue=1/0;C=S;do P>=C.x&&C.x>=de&&P!==C.x&&kf(D<ze?P:j,D,de,ze,D<ze?j:P,D,C.x,C.y)&&(K=Math.abs(D-C.y)/(P-C.x),Jc(C,m)&&(K<Ue||K===Ue&&(C.x>S.x||C.x===S.x&&Wp(S,C)))&&(S=C,Ue=K)),C=C.next;while(C!==V);return S}(a,s)){var c=up(s,a);wc(s,s.next),wc(c,c.next)}}function Wp(a,s){return Bo(a.prev,a,s.prev)<0&&Bo(s.next,a,a.next)<0}function sp(a,s,c,m,_){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-c)*_)|a<<8))|a<<4))|a<<2))|a<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-m)*_)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function Ld(a){var s=a,c=a;do(s.x<c.x||s.x===c.x&&s.y<c.y)&&(c=s),s=s.next;while(s!==a);return c}function kf(a,s,c,m,_,S,C,P){return(_-C)*(s-P)-(a-C)*(S-P)>=0&&(a-C)*(m-P)-(c-C)*(s-P)>=0&&(c-C)*(S-P)-(_-C)*(m-P)>=0}function Mh(a,s){return a.next.i!==s.i&&a.prev.i!==s.i&&!function(c,m){var _=c;do{if(_.i!==c.i&&_.next.i!==c.i&&_.i!==m.i&&_.next.i!==m.i&&Xp(_,_.next,c,m))return!0;_=_.next}while(_!==c);return!1}(a,s)&&(Jc(a,s)&&Jc(s,a)&&function(c,m){var _=c,S=!1,C=(c.x+m.x)/2,P=(c.y+m.y)/2;do _.y>P!=_.next.y>P&&_.next.y!==_.y&&C<(_.next.x-_.x)*(P-_.y)/(_.next.y-_.y)+_.x&&(S=!S),_=_.next;while(_!==c);return S}(a,s)&&(Bo(a.prev,a,s.prev)||Bo(a,s.prev,s))||kh(a,s)&&Bo(a.prev,a,a.next)>0&&Bo(s.prev,s,s.next)>0)}function Bo(a,s,c){return(s.y-a.y)*(c.x-s.x)-(s.x-a.x)*(c.y-s.y)}function kh(a,s){return a.x===s.x&&a.y===s.y}function Xp(a,s,c,m){var _=ah(Bo(a,s,c)),S=ah(Bo(a,s,m)),C=ah(Bo(c,m,a)),P=ah(Bo(c,m,s));return _!==S&&C!==P||!(_!==0||!ih(a,c,s))||!(S!==0||!ih(a,m,s))||!(C!==0||!ih(c,a,m))||!(P!==0||!ih(c,s,m))}function ih(a,s,c){return s.x<=Math.max(a.x,c.x)&&s.x>=Math.min(a.x,c.x)&&s.y<=Math.max(a.y,c.y)&&s.y>=Math.min(a.y,c.y)}function ah(a){return a>0?1:a<0?-1:0}function Jc(a,s){return Bo(a.prev,a,a.next)<0?Bo(a,s,a.next)>=0&&Bo(a,a.prev,s)>=0:Bo(a,s,a.prev)<0||Bo(a,a.next,s)<0}function up(a,s){var c=new If(a.i,a.x,a.y),m=new If(s.i,s.x,s.y),_=a.next,S=s.prev;return a.next=s,s.prev=a,c.next=_,_.prev=c,m.next=c,c.prev=m,S.next=m,m.prev=S,m}function oh(a,s,c,m){var _=new If(a,s,c);return m?(_.next=m.next,_.prev=m,m.next.prev=_,m.next=_):(_.prev=_,_.next=_),_}function Cc(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function If(a,s,c){this.i=a,this.x=s,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ih(a,s,c,m){for(var _=0,S=s,C=c-m;S<c;S+=m)_+=(a[C]-a[S])*(a[S+1]+a[C+1]),C=S;return _}function lp(a,s,c,m,_){(function S(C,P,D,j,B){for(;j>D;){if(j-D>600){var K=j-D+1,V=P-D+1,de=Math.log(K),ze=.5*Math.exp(2*de/3),Ue=.5*Math.sqrt(de*ze*(K-ze)/K)*(V-K/2<0?-1:1);S(C,P,Math.max(D,Math.floor(P-V*ze/K+Ue)),Math.min(j,Math.floor(P+(K-V)*ze/K+Ue)),B)}var st=C[P],Ke=D,St=j;for(xl(C,D,P),B(C[j],st)>0&&xl(C,D,j);Ke<St;){for(xl(C,Ke,St),Ke++,St--;B(C[Ke],st)<0;)Ke++;for(;B(C[St],st)>0;)St--}B(C[D],st)===0?xl(C,D,St):xl(C,++St,j),St<=P&&(D=St+1),P<=St&&(j=St-1)}})(a,s,c||0,m||a.length-1,_||Pf)}function xl(a,s,c){var m=a[s];a[s]=a[c],a[c]=m}function Pf(a,s){return a<s?-1:a>s?1:0}function ef(a,s){var c=a.length;if(c<=1)return[a];for(var m,_,S=[],C=0;C<c;C++){var P=Ir(a[C]);P!==0&&(a[C].area=Math.abs(P),_===void 0&&(_=P<0),_===P<0?(m&&S.push(m),m=[a[C]]):m.push(a[C]))}if(m&&S.push(m),s>1)for(var D=0;D<S.length;D++)S[D].length<=s||(lp(S[D],s,1,S[D].length-1,Rf),S[D]=S[D].slice(0,s));return S}function Rf(a,s){return s.area-a.area}function Lf(a,s,c){for(var m=c.patternDependencies,_=!1,S=0,C=s;S<C.length;S+=1){var P=C[S].paint.get(a+"-pattern");P.isConstant()||(_=!0);var D=P.constantOr(null);D&&(_=!0,m[D.to]=!0,m[D.from]=!0)}return _}function Vs(a,s,c,m,_){for(var S=_.patternDependencies,C=0,P=s;C<P.length;C+=1){var D=P[C],j=D.paint.get(a+"-pattern").value;if(j.kind!=="constant"){var B=j.evaluate({zoom:m-1},c,{},_.availableImages),K=j.evaluate({zoom:m},c,{},_.availableImages),V=j.evaluate({zoom:m+1},c,{},_.availableImages);K=K&&K.name?K.name:K,V=V&&V.name?V.name:V,S[B=B&&B.name?B.name:B]=!0,S[K]=!0,S[V]=!0,c.patterns[D.id]={min:B,mid:K,max:V}}}return c}Th.deviation=function(a,s,c,m){var _=s&&s.length,S=Math.abs(Ih(a,0,_?s[0]*c:a.length,c));if(_)for(var C=0,P=s.length;C<P;C++)S-=Math.abs(Ih(a,s[C]*c,C<P-1?s[C+1]*c:a.length,c));var D=0;for(C=0;C<m.length;C+=3){var j=m[C]*c,B=m[C+1]*c,K=m[C+2]*c;D+=Math.abs((a[j]-a[K])*(a[B+1]-a[j+1])-(a[j]-a[B])*(a[K+1]-a[j+1]))}return S===0&&D===0?0:Math.abs((D-S)/S)},Th.flatten=function(a){for(var s=a[0][0].length,c={vertices:[],holes:[],dimensions:s},m=0,_=0;_<a.length;_++){for(var S=0;S<a[_].length;S++)for(var C=0;C<s;C++)c.vertices.push(a[_][S][C]);_>0&&c.holes.push(m+=a[_-1].length)}return c},Yl.default=rh;var W=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Gl,this.indexArray=new qu,this.indexArray2=new Hc,this.programConfigurations=new fi(a.layers,a.zoom),this.segments=new xe,this.segments2=new xe,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};W.prototype.populate=function(a,s,c){this.hasPattern=Lf("fill",this.layers,s);for(var m=this.layers[0].layout.get("fill-sort-key"),_=[],S=0,C=a;S<C.length;S+=1){var P=C[S],D=P.feature,j=P.id,B=P.index,K=P.sourceLayerIndex,V=this.layers[0]._featureFilter.needGeometry,de=io(D,V);if(this.layers[0]._featureFilter.filter(new Vi(this.zoom),de,c)){var ze=m?m.evaluate(de,{},c,s.availableImages):void 0,Ue={id:j,properties:D.properties,type:D.type,sourceLayerIndex:K,index:B,geometry:V?de.geometry:qa(D),patterns:{},sortKey:ze};_.push(Ue)}}m&&_.sort(function(Qr,dn){return Qr.sortKey-dn.sortKey});for(var st=0,Ke=_;st<Ke.length;st+=1){var St=Ke[st],jt=St.geometry,or=St.index,lr=St.sourceLayerIndex;if(this.hasPattern){var Cr=Vs("fill",this.layers,St,this.zoom,s);this.patternFeatures.push(Cr)}else this.addFeature(St,jt,or,c,{});s.featureIndex.insert(a[or].feature,jt,or,lr,this.index)}},W.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},W.prototype.addFeatures=function(a,s,c){for(var m=0,_=this.patternFeatures;m<_.length;m+=1){var S=_[m];this.addFeature(S,S.geometry,S.index,s,c)}},W.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},W.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},W.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,el),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},W.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},W.prototype.addFeature=function(a,s,c,m,_){for(var S=0,C=ef(s,500);S<C.length;S+=1){for(var P=C[S],D=0,j=0,B=P;j<B.length;j+=1)D+=B[j].length;for(var K=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),V=K.vertexLength,de=[],ze=[],Ue=0,st=P;Ue<st.length;Ue+=1){var Ke=st[Ue];if(Ke.length!==0){Ke!==P[0]&&ze.push(de.length/2);var St=this.segments2.prepareSegment(Ke.length,this.layoutVertexArray,this.indexArray2),jt=St.vertexLength;this.layoutVertexArray.emplaceBack(Ke[0].x,Ke[0].y),this.indexArray2.emplaceBack(jt+Ke.length-1,jt),de.push(Ke[0].x),de.push(Ke[0].y);for(var or=1;or<Ke.length;or++)this.layoutVertexArray.emplaceBack(Ke[or].x,Ke[or].y),this.indexArray2.emplaceBack(jt+or-1,jt+or),de.push(Ke[or].x),de.push(Ke[or].y);St.vertexLength+=Ke.length,St.primitiveLength+=Ke.length}}for(var lr=Yl(de,ze),Cr=0;Cr<lr.length;Cr+=3)this.indexArray.emplaceBack(V+lr[Cr],V+lr[Cr+1],V+lr[Cr+2]);K.vertexLength+=D,K.primitiveLength+=lr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,_,m)},Dn("FillBucket",W,{omit:["layers","patternFeatures"]});var Xr=new is({"fill-sort-key":new Bn(me.layout_fill["fill-sort-key"])}),Ac={paint:new is({"fill-antialias":new Qn(me.paint_fill["fill-antialias"]),"fill-opacity":new Bn(me.paint_fill["fill-opacity"]),"fill-color":new Bn(me.paint_fill["fill-color"]),"fill-outline-color":new Bn(me.paint_fill["fill-outline-color"]),"fill-translate":new Qn(me.paint_fill["fill-translate"]),"fill-translate-anchor":new Qn(me.paint_fill["fill-translate-anchor"]),"fill-pattern":new Gc(me.paint_fill["fill-pattern"])}),layout:Xr},Ph=function(a){function s(c){a.call(this,c,Ac)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.recalculate=function(c,m){a.prototype.recalculate.call(this,c,m);var _=this.paint._values["fill-outline-color"];_.value.kind==="constant"&&_.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},s.prototype.createBucket=function(c){return new W(c)},s.prototype.queryRadius=function(){return Do(this.paint.get("fill-translate"))},s.prototype.queryIntersectsFeature=function(c,m,_,S,C,P,D){return be(_u(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),P.angle,D),S)},s.prototype.isTileClipped=function(){return!0},s}(wu),No=Ga([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,tl=fu;function fu(a,s,c,m,_){this.properties={},this.extent=c,this.type=0,this._pbf=a,this._geometry=-1,this._keys=m,this._values=_,a.readFields(ql,this,s)}function ql(a,s,c){a==1?s.id=c.readVarint():a==2?function(m,_){for(var S=m.readVarint()+m.pos;m.pos<S;){var C=_._keys[m.readVarint()],P=_._values[m.readVarint()];_.properties[C]=P}}(c,s):a==3?s.type=c.readVarint():a==4&&(s._geometry=c.pos)}function Kl(a){for(var s,c,m=0,_=0,S=a.length,C=S-1;_<S;C=_++)m+=((c=a[C]).x-(s=a[_]).x)*(s.y+c.y);return m}fu.types=["Unknown","Point","LineString","Polygon"],fu.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var s,c=a.readVarint()+a.pos,m=1,_=0,S=0,C=0,P=[];a.pos<c;){if(_<=0){var D=a.readVarint();m=7&D,_=D>>3}if(_--,m===1||m===2)S+=a.readSVarint(),C+=a.readSVarint(),m===1&&(s&&P.push(s),s=[]),s.push(new se(S,C));else{if(m!==7)throw new Error("unknown command "+m);s&&s.push(s[0].clone())}}return s&&P.push(s),P},fu.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var s=a.readVarint()+a.pos,c=1,m=0,_=0,S=0,C=1/0,P=-1/0,D=1/0,j=-1/0;a.pos<s;){if(m<=0){var B=a.readVarint();c=7&B,m=B>>3}if(m--,c===1||c===2)(_+=a.readSVarint())<C&&(C=_),_>P&&(P=_),(S+=a.readSVarint())<D&&(D=S),S>j&&(j=S);else if(c!==7)throw new Error("unknown command "+c)}return[C,D,P,j]},fu.prototype.toGeoJSON=function(a,s,c){var m,_,S=this.extent*Math.pow(2,c),C=this.extent*a,P=this.extent*s,D=this.loadGeometry(),j=fu.types[this.type];function B(de){for(var ze=0;ze<de.length;ze++){var Ue=de[ze];de[ze]=[360*(Ue.x+C)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ue.y+P)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var K=[];for(m=0;m<D.length;m++)K[m]=D[m][0];B(D=K);break;case 2:for(m=0;m<D.length;m++)B(D[m]);break;case 3:for(D=function(de){var ze=de.length;if(ze<=1)return[de];for(var Ue,st,Ke=[],St=0;St<ze;St++){var jt=Kl(de[St]);jt!==0&&(st===void 0&&(st=jt<0),st===jt<0?(Ue&&Ke.push(Ue),Ue=[de[St]]):Ue.push(de[St]))}return Ue&&Ke.push(Ue),Ke}(D),m=0;m<D.length;m++)for(_=0;_<D[m].length;_++)B(D[m][_])}D.length===1?D=D[0]:j="Multi"+j;var V={type:"Feature",geometry:{type:j,coordinates:D},properties:this.properties};return"id"in this&&(V.id=this.id),V};var Ql=Rh;function Rh(a,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(Zv,this,s),this.length=this._features.length}function Zv(a,s,c){a===15?s.version=c.readVarint():a===1?s.name=c.readString():a===5?s.extent=c.readVarint():a===2?s._features.push(c.pos):a===3?s._keys.push(c.readString()):a===4&&s._values.push(function(m){for(var _=null,S=m.readVarint()+m.pos;m.pos<S;){var C=m.readVarint()>>3;_=C===1?m.readString():C===2?m.readFloat():C===3?m.readDouble():C===4?m.readVarint64():C===5?m.readVarint():C===6?m.readSVarint():C===7?m.readBoolean():null}return _}(c))}function Od(a,s,c){if(a===3){var m=new Ql(c,c.readVarint()+c.pos);m.length&&(s[m.name]=m)}}Rh.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var s=this._pbf.readVarint()+this._pbf.pos;return new tl(this._pbf,s,this.extent,this._keys,this._values)};var Js={VectorTile:function(a,s){this.layers=a.readFields(Od,{},s)},VectorTileFeature:tl,VectorTileLayer:Ql},Lh=Js.VectorTileFeature.types,tf=Math.pow(2,13);function rf(a,s,c,m,_,S,C,P){a.emplaceBack(s,c,2*Math.floor(m*tf)+C,_*tf*2,S*tf*2,Math.round(P))}var bl=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new lu,this.indexArray=new qu,this.programConfigurations=new fi(a.layers,a.zoom),this.segments=new xe,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function Fd(a,s){return a.x===s.x&&(a.x<0||a.x>8192)||a.y===s.y&&(a.y<0||a.y>8192)}bl.prototype.populate=function(a,s,c){this.features=[],this.hasPattern=Lf("fill-extrusion",this.layers,s);for(var m=0,_=a;m<_.length;m+=1){var S=_[m],C=S.feature,P=S.id,D=S.index,j=S.sourceLayerIndex,B=this.layers[0]._featureFilter.needGeometry,K=io(C,B);if(this.layers[0]._featureFilter.filter(new Vi(this.zoom),K,c)){var V={id:P,sourceLayerIndex:j,index:D,geometry:B?K.geometry:qa(C),properties:C.properties,type:C.type,patterns:{}};this.hasPattern?this.features.push(Vs("fill-extrusion",this.layers,V,this.zoom,s)):this.addFeature(V,V.geometry,D,c,{}),s.featureIndex.insert(C,V.geometry,D,j,this.index,!0)}}},bl.prototype.addFeatures=function(a,s,c){for(var m=0,_=this.features;m<_.length;m+=1){var S=_[m];this.addFeature(S,S.geometry,S.index,s,c)}},bl.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},bl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},bl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},bl.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,No),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},bl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},bl.prototype.addFeature=function(a,s,c,m,_){for(var S=0,C=ef(s,500);S<C.length;S+=1){for(var P=C[S],D=0,j=0,B=P;j<B.length;j+=1)D+=B[j].length;for(var K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),V=0,de=P;V<de.length;V+=1){var ze=de[V];if(ze.length!==0&&!((na=ze).every(function(Bi){return Bi.x<0})||na.every(function(Bi){return Bi.x>8192})||na.every(function(Bi){return Bi.y<0})||na.every(function(Bi){return Bi.y>8192})))for(var Ue=0,st=0;st<ze.length;st++){var Ke=ze[st];if(st>=1){var St=ze[st-1];if(!Fd(Ke,St)){K.vertexLength+4>xe.MAX_VERTEX_ARRAY_LENGTH&&(K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var jt=Ke.sub(St)._perp()._unit(),or=St.dist(Ke);Ue+or>32768&&(Ue=0),rf(this.layoutVertexArray,Ke.x,Ke.y,jt.x,jt.y,0,0,Ue),rf(this.layoutVertexArray,Ke.x,Ke.y,jt.x,jt.y,0,1,Ue),rf(this.layoutVertexArray,St.x,St.y,jt.x,jt.y,0,0,Ue+=or),rf(this.layoutVertexArray,St.x,St.y,jt.x,jt.y,0,1,Ue);var lr=K.vertexLength;this.indexArray.emplaceBack(lr,lr+2,lr+1),this.indexArray.emplaceBack(lr+1,lr+2,lr+3),K.vertexLength+=4,K.primitiveLength+=2}}}}if(K.vertexLength+D>xe.MAX_VERTEX_ARRAY_LENGTH&&(K=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray)),Lh[a.type]==="Polygon"){for(var Cr=[],Qr=[],dn=K.vertexLength,ti=0,Rn=P;ti<Rn.length;ti+=1){var si=Rn[ti];if(si.length!==0){si!==P[0]&&Qr.push(Cr.length/2);for(var On=0;On<si.length;On++){var ji=si[On];rf(this.layoutVertexArray,ji.x,ji.y,0,0,1,1,0),Cr.push(ji.x),Cr.push(ji.y)}}}for(var bi=Yl(Cr,Qr),Kn=0;Kn<bi.length;Kn+=3)this.indexArray.emplaceBack(dn+bi[Kn],dn+bi[Kn+2],dn+bi[Kn+1]);K.primitiveLength+=bi.length/3,K.vertexLength+=D}}var na;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,_,m)},Dn("FillExtrusionBucket",bl,{omit:["layers","features"]});var Dd={paint:new is({"fill-extrusion-opacity":new Qn(me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Bn(me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Qn(me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Qn(me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Gc(me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Bn(me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Bn(me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Qn(me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},El=function(a){function s(c){a.call(this,c,Dd)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.createBucket=function(c){return new bl(c)},s.prototype.queryRadius=function(){return Do(this.paint.get("fill-extrusion-translate"))},s.prototype.is3D=function(){return!0},s.prototype.queryIntersectsFeature=function(c,m,_,S,C,P,D,j){var B=_u(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),P.angle,D),K=this.paint.get("fill-extrusion-height").evaluate(m,_),V=this.paint.get("fill-extrusion-base").evaluate(m,_),de=function(Ue,st,Ke,St){for(var jt=[],or=0,lr=Ue;or<lr.length;or+=1){var Cr=lr[or],Qr=[Cr.x,Cr.y,0,1];Xc(Qr,Qr,st),jt.push(new se(Qr[0]/Qr[3],Qr[1]/Qr[3]))}return jt}(B,j),ze=function(Ue,st,Ke,St){for(var jt=[],or=[],lr=St[8]*st,Cr=St[9]*st,Qr=St[10]*st,dn=St[11]*st,ti=St[8]*Ke,Rn=St[9]*Ke,si=St[10]*Ke,On=St[11]*Ke,ji=0,bi=Ue;ji<bi.length;ji+=1){for(var Kn=[],na=[],Bi=0,va=bi[ji];Bi<va.length;Bi+=1){var ui=va[Bi],Aa=ui.x,ho=ui.y,Zo=St[0]*Aa+St[4]*ho+St[12],So=St[1]*Aa+St[5]*ho+St[13],yo=St[2]*Aa+St[6]*ho+St[14],Xo=St[3]*Aa+St[7]*ho+St[15],gs=yo+Qr,cs=Xo+dn,Hs=Zo+ti,As=So+Rn,Ws=yo+si,Uo=Xo+On,Ts=new se((Zo+lr)/cs,(So+Cr)/cs);Ts.z=gs/cs,Kn.push(Ts);var ua=new se(Hs/Uo,As/Uo);ua.z=Ws/Uo,na.push(ua)}jt.push(Kn),or.push(na)}return[jt,or]}(S,V,K,j);return function(Ue,st,Ke){var St=1/0;be(Ke,st)&&(St=Tc(Ke,st[0]));for(var jt=0;jt<st.length;jt++)for(var or=st[jt],lr=Ue[jt],Cr=0;Cr<or.length-1;Cr++){var Qr=or[Cr],dn=[Qr,or[Cr+1],lr[Cr+1],lr[Cr],Qr];Wt(Ke,dn)&&(St=Math.min(St,Tc(Ke,dn)))}return St!==1/0&&St}(ze[0],ze[1],de)},s}(wu);function Of(a,s){return a.x*s.x+a.y*s.y}function Tc(a,s){if(a.length===1){for(var c,m=0,_=s[m++];!c||_.equals(c);)if(!(c=s[m++]))return 1/0;for(;m<s.length;m++){var S=s[m],C=a[0],P=c.sub(_),D=S.sub(_),j=C.sub(_),B=Of(P,P),K=Of(P,D),V=Of(D,D),de=Of(j,P),ze=Of(j,D),Ue=B*V-K*K,st=(V*de-K*ze)/Ue,Ke=(B*ze-K*de)/Ue,St=_.z*(1-st-Ke)+c.z*st+S.z*Ke;if(isFinite(St))return St}return 1/0}for(var jt=1/0,or=0,lr=s;or<lr.length;or+=1)jt=Math.min(jt,lr[or].z);return jt}var Jl=Ga([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,$p=Ga([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,sh=Js.VectorTileFeature.types,uh=Math.cos(Math.PI/180*37.5),cp=Math.pow(2,14)/.5,Ta=function(a){var s=this;this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(c){return c.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(c){s.gradients[c.id]={}}),this.layoutVertexArray=new Ko,this.layoutVertexArray2=new Yu,this.indexArray=new qu,this.programConfigurations=new fi(a.layers,a.zoom),this.segments=new xe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(c){return c.isStateDependent()}).map(function(c){return c.id})};Ta.prototype.populate=function(a,s,c){this.hasPattern=Lf("line",this.layers,s);for(var m=this.layers[0].layout.get("line-sort-key"),_=[],S=0,C=a;S<C.length;S+=1){var P=C[S],D=P.feature,j=P.id,B=P.index,K=P.sourceLayerIndex,V=this.layers[0]._featureFilter.needGeometry,de=io(D,V);if(this.layers[0]._featureFilter.filter(new Vi(this.zoom),de,c)){var ze=m?m.evaluate(de,{},c):void 0,Ue={id:j,properties:D.properties,type:D.type,sourceLayerIndex:K,index:B,geometry:V?de.geometry:qa(D),patterns:{},sortKey:ze};_.push(Ue)}}m&&_.sort(function(Qr,dn){return Qr.sortKey-dn.sortKey});for(var st=0,Ke=_;st<Ke.length;st+=1){var St=Ke[st],jt=St.geometry,or=St.index,lr=St.sourceLayerIndex;if(this.hasPattern){var Cr=Vs("line",this.layers,St,this.zoom,s);this.patternFeatures.push(Cr)}else this.addFeature(St,jt,or,c,{});s.featureIndex.insert(a[or].feature,jt,or,lr,this.index)}},Ta.prototype.update=function(a,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,s,this.stateDependentLayers,c)},Ta.prototype.addFeatures=function(a,s,c){for(var m=0,_=this.patternFeatures;m<_.length;m+=1){var S=_[m];this.addFeature(S,S.geometry,S.index,s,c)}},Ta.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ta.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ta.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,$p)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Jl),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Ta.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ta.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},Ta.prototype.addFeature=function(a,s,c,m,_){var S=this.layers[0].layout,C=S.get("line-join").evaluate(a,{}),P=S.get("line-cap"),D=S.get("line-miter-limit"),j=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var B=0,K=s;B<K.length;B+=1)this.addLine(K[B],a,C,P,D,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,_,m)},Ta.prototype.addLine=function(a,s,c,m,_,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var C=0;C<a.length-1;C++)this.totalDistance+=a[C].dist(a[C+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var P=sh[s.type]==="Polygon",D=a.length;D>=2&&a[D-1].equals(a[D-2]);)D--;for(var j=0;j<D-1&&a[j].equals(a[j+1]);)j++;if(!(D<(P?3:2))){c==="bevel"&&(_=1.05);var B,K=this.overscaling<=16?122880/(512*this.overscaling):0,V=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),de=void 0,ze=void 0,Ue=void 0,st=void 0;this.e1=this.e2=-1,P&&(st=a[j].sub(B=a[D-2])._unit()._perp());for(var Ke=j;Ke<D;Ke++)if(!(ze=Ke===D-1?P?a[j+1]:void 0:a[Ke+1])||!a[Ke].equals(ze)){st&&(Ue=st),B&&(de=B),B=a[Ke],st=ze?ze.sub(B)._unit()._perp():Ue;var St=(Ue=Ue||st).add(st);St.x===0&&St.y===0||St._unit();var jt=Ue.x*st.x+Ue.y*st.y,or=St.x*st.x+St.y*st.y,lr=or!==0?1/or:1/0,Cr=2*Math.sqrt(2-2*or),Qr=or<uh&&de&&ze,dn=Ue.x*st.y-Ue.y*st.x>0;if(Qr&&Ke>j){var ti=B.dist(de);if(ti>2*K){var Rn=B.sub(B.sub(de)._mult(K/ti)._round());this.updateDistance(de,Rn),this.addCurrentVertex(Rn,Ue,0,0,V),de=Rn}}var si=de&&ze,On=si?c:P?"butt":m;if(si&&On==="round"&&(lr<S?On="miter":lr<=2&&(On="fakeround")),On==="miter"&&lr>_&&(On="bevel"),On==="bevel"&&(lr>2&&(On="flipbevel"),lr<_&&(On="miter")),de&&this.updateDistance(de,B),On==="miter")St._mult(lr),this.addCurrentVertex(B,St,0,0,V);else if(On==="flipbevel"){if(lr>100)St=st.mult(-1);else{var ji=lr*Ue.add(st).mag()/Ue.sub(st).mag();St._perp()._mult(ji*(dn?-1:1))}this.addCurrentVertex(B,St,0,0,V),this.addCurrentVertex(B,St.mult(-1),0,0,V)}else if(On==="bevel"||On==="fakeround"){var bi=-Math.sqrt(lr*lr-1),Kn=dn?bi:0,na=dn?0:bi;if(de&&this.addCurrentVertex(B,Ue,Kn,na,V),On==="fakeround")for(var Bi=Math.round(180*Cr/Math.PI/20),va=1;va<Bi;va++){var ui=va/Bi;if(ui!==.5){var Aa=ui-.5;ui+=ui*Aa*(ui-1)*((1.0904+jt*(jt*(3.55645-1.43519*jt)-3.2452))*Aa*Aa+(.848013+jt*(.215638*jt-1.06021)))}var ho=st.sub(Ue)._mult(ui)._add(Ue)._unit()._mult(dn?-1:1);this.addHalfVertex(B,ho.x,ho.y,!1,dn,0,V)}ze&&this.addCurrentVertex(B,st,-Kn,-na,V)}else if(On==="butt")this.addCurrentVertex(B,St,0,0,V);else if(On==="square"){var Zo=de?1:-1;this.addCurrentVertex(B,St,Zo,Zo,V)}else On==="round"&&(de&&(this.addCurrentVertex(B,Ue,0,0,V),this.addCurrentVertex(B,Ue,1,1,V,!0)),ze&&(this.addCurrentVertex(B,st,-1,-1,V,!0),this.addCurrentVertex(B,st,0,0,V)));if(Qr&&Ke<D-1){var So=B.dist(ze);if(So>2*K){var yo=B.add(ze.sub(B)._mult(K/So)._round());this.updateDistance(B,yo),this.addCurrentVertex(yo,st,0,0,V),B=yo}}}}},Ta.prototype.addCurrentVertex=function(a,s,c,m,_,S){S===void 0&&(S=!1);var C=s.y*m-s.x,P=-s.y-s.x*m;this.addHalfVertex(a,s.x+s.y*c,s.y-s.x*c,S,!1,c,_),this.addHalfVertex(a,C,P,S,!0,-m,_),this.distance>cp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,s,c,m,_,S))},Ta.prototype.addHalfVertex=function(a,s,c,m,_,S,C){var P=.5*(this.lineClips?this.scaledDistance*(cp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(m?1:0),(a.y<<1)+(_?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(S===0?0:S<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var D=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),C.primitiveLength++),_?this.e2=D:this.e1=D},Ta.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ta.prototype.updateDistance=function(a,s){this.distance+=a.dist(s),this.updateScaledDistance()},Dn("LineBucket",Ta,{omit:["layers","patternFeatures"]});var Mc=new is({"line-cap":new Qn(me.layout_line["line-cap"]),"line-join":new Bn(me.layout_line["line-join"]),"line-miter-limit":new Qn(me.layout_line["line-miter-limit"]),"line-round-limit":new Qn(me.layout_line["line-round-limit"]),"line-sort-key":new Bn(me.layout_line["line-sort-key"])}),go={paint:new is({"line-opacity":new Bn(me.paint_line["line-opacity"]),"line-color":new Bn(me.paint_line["line-color"]),"line-translate":new Qn(me.paint_line["line-translate"]),"line-translate-anchor":new Qn(me.paint_line["line-translate-anchor"]),"line-width":new Bn(me.paint_line["line-width"]),"line-gap-width":new Bn(me.paint_line["line-gap-width"]),"line-offset":new Bn(me.paint_line["line-offset"]),"line-blur":new Bn(me.paint_line["line-blur"]),"line-dasharray":new Es(me.paint_line["line-dasharray"]),"line-pattern":new Gc(me.paint_line["line-pattern"]),"line-gradient":new uu(me.paint_line["line-gradient"])}),layout:Mc},hu=new(function(a){function s(){a.apply(this,arguments)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(c,m){return m=new Vi(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),a.prototype.possiblyEvaluate.call(this,c,m)},s.prototype.evaluate=function(c,m,_,S){return m=Ft({},m,{zoom:Math.floor(m.zoom)}),a.prototype.evaluate.call(this,c,m,_,S)},s}(Bn))(go.paint.properties["line-width"].specification);hu.useIntegerZoom=!0;var Yp=function(a){function s(c){a.call(this,c,go),this.gradientVersion=0}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof _s,this.gradientVersion=(this.gradientVersion+1)%ot)},s.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},s.prototype.recalculate=function(c,m){a.prototype.recalculate.call(this,c,m),this.paint._values["line-floorwidth"]=hu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)},s.prototype.createBucket=function(c){return new Ta(c)},s.prototype.queryRadius=function(c){var m=c,_=qp(Tu("line-width",this,m),Tu("line-gap-width",this,m)),S=Tu("line-offset",this,m);return _/2+Math.abs(S)+Do(this.paint.get("line-translate"))},s.prototype.queryIntersectsFeature=function(c,m,_,S,C,P,D){var j=_u(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),P.angle,D),B=D/2*qp(this.paint.get("line-width").evaluate(m,_),this.paint.get("line-gap-width").evaluate(m,_)),K=this.paint.get("line-offset").evaluate(m,_);return K&&(S=function(V,de){for(var ze=[],Ue=new se(0,0),st=0;st<V.length;st++){for(var Ke=V[st],St=[],jt=0;jt<Ke.length;jt++){var or=Ke[jt],lr=Ke[jt+1],Cr=jt===0?Ue:or.sub(Ke[jt-1])._unit()._perp(),Qr=jt===Ke.length-1?Ue:lr.sub(or)._unit()._perp(),dn=Cr._add(Qr)._unit();dn._mult(1/(dn.x*Qr.x+dn.y*Qr.y)),St.push(dn._mult(de)._add(or))}ze.push(St)}return ze}(S,K*D)),function(V,de,ze){for(var Ue=0;Ue<de.length;Ue++){var st=de[Ue];if(V.length>=3){for(var Ke=0;Ke<st.length;Ke++)if(Au(V,st[Ke]))return!0}if(ws(V,st,ze))return!0}return!1}(j,S,B)},s.prototype.isTileClipped=function(){return!0},s}(wu);function qp(a,s){return s>0?s+2*a:a}var Bd=Ga([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Nd=Ga([{name:"a_projected_pos",components:3,type:"Float32"}],4),fp=(Ga([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ga([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),ec=(Ga([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ga([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Oh=Ga([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function zd(a,s,c){return a.sections.forEach(function(m){m.text=function(_,S,C){var P=S.layout.get("text-transform").evaluate(C,{});return P==="uppercase"?_=_.toLocaleUpperCase():P==="lowercase"&&(_=_.toLocaleLowerCase()),ou.applyArabicShaping&&(_=ou.applyArabicShaping(_)),_}(m.text,s,c)}),a}Ga([{name:"triangle",components:3,type:"Uint16"}]),Ga([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ga([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ga([{type:"Float32",name:"offsetX"}]),Ga([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var lh={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Zd=function(a,s,c,m,_){var S,C,P=8*_-m-1,D=(1<<P)-1,j=D>>1,B=-7,K=c?_-1:0,V=c?-1:1,de=a[s+K];for(K+=V,S=de&(1<<-B)-1,de>>=-B,B+=P;B>0;S=256*S+a[s+K],K+=V,B-=8);for(C=S&(1<<-B)-1,S>>=-B,B+=m;B>0;C=256*C+a[s+K],K+=V,B-=8);if(S===0)S=1-j;else{if(S===D)return C?NaN:1/0*(de?-1:1);C+=Math.pow(2,m),S-=j}return(de?-1:1)*C*Math.pow(2,S-m)},nf=function(a,s,c,m,_,S){var C,P,D,j=8*S-_-1,B=(1<<j)-1,K=B>>1,V=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,de=m?0:S-1,ze=m?1:-1,Ue=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(P=isNaN(s)?1:0,C=B):(C=Math.floor(Math.log(s)/Math.LN2),s*(D=Math.pow(2,-C))<1&&(C--,D*=2),(s+=C+K>=1?V/D:V*Math.pow(2,1-K))*D>=2&&(C++,D/=2),C+K>=B?(P=0,C=B):C+K>=1?(P=(s*D-1)*Math.pow(2,_),C+=K):(P=s*Math.pow(2,K-1)*Math.pow(2,_),C=0));_>=8;a[c+de]=255&P,de+=ze,P/=256,_-=8);for(C=C<<_|P,j+=_;j>0;a[c+de]=255&C,de+=ze,C/=256,j-=8);a[c+de-ze]|=128*Ue},js=Za;function Za(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Za.Varint=0,Za.Fixed64=1,Za.Bytes=2,Za.Fixed32=5;var Fh=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Uu(a){return a.type===Za.Bytes?a.readVarint()+a.pos:a.pos+1}function Ff(a,s,c){return c?4294967296*s+(a>>>0):4294967296*(s>>>0)+(a>>>0)}function hp(a,s,c){var m=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));c.realloc(m);for(var _=c.pos-1;_>=a;_--)c.buf[_+m]=c.buf[_]}function Ud(a,s){for(var c=0;c<a.length;c++)s.writeVarint(a[c])}function U(a,s){for(var c=0;c<a.length;c++)s.writeSVarint(a[c])}function we(a,s){for(var c=0;c<a.length;c++)s.writeFloat(a[c])}function $e(a,s){for(var c=0;c<a.length;c++)s.writeDouble(a[c])}function rr(a,s){for(var c=0;c<a.length;c++)s.writeBoolean(a[c])}function wr(a,s){for(var c=0;c<a.length;c++)s.writeFixed32(a[c])}function Jt(a,s){for(var c=0;c<a.length;c++)s.writeSFixed32(a[c])}function yr(a,s){for(var c=0;c<a.length;c++)s.writeFixed64(a[c])}function kr(a,s){for(var c=0;c<a.length;c++)s.writeSFixed64(a[c])}function Br(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+16777216*a[s+3]}function Zr(a,s,c){a[c]=s,a[c+1]=s>>>8,a[c+2]=s>>>16,a[c+3]=s>>>24}function $r(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+(a[s+3]<<24)}function qr(a,s,c){a===1&&c.readMessage(hn,s)}function hn(a,s,c){if(a===3){var m=c.readMessage(Ur,{}),_=m.width,S=m.height,C=m.left,P=m.top,D=m.advance;s.push({id:m.id,bitmap:new Us({width:_+6,height:S+6},m.bitmap),metrics:{width:_,height:S,left:C,top:P,advance:D}})}}function Ur(a,s,c){a===1?s.id=c.readVarint():a===2?s.bitmap=c.readBytes():a===3?s.width=c.readVarint():a===4?s.height=c.readVarint():a===5?s.left=c.readSVarint():a===6?s.top=c.readSVarint():a===7&&(s.advance=c.readVarint())}function Kr(a){for(var s=0,c=0,m=0,_=a;m<_.length;m+=1){var S=_[m];s+=S.w*S.h,c=Math.max(c,S.w)}a.sort(function(Ue,st){return st.h-Ue.h});for(var C=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),c),h:1/0}],P=0,D=0,j=0,B=a;j<B.length;j+=1)for(var K=B[j],V=C.length-1;V>=0;V--){var de=C[V];if(!(K.w>de.w||K.h>de.h)){if(K.x=de.x,K.y=de.y,D=Math.max(D,K.y+K.h),P=Math.max(P,K.x+K.w),K.w===de.w&&K.h===de.h){var ze=C.pop();V<C.length&&(C[V]=ze)}else K.h===de.h?(de.x+=K.w,de.w-=K.w):K.w===de.w?(de.y+=K.h,de.h-=K.h):(C.push({x:de.x+K.w,y:de.y,w:de.w-K.w,h:K.h}),de.y+=K.h,de.h-=K.h);break}}return{w:P,h:D,fill:s/(P*D)||0}}Za.prototype={destroy:function(){this.buf=null},readFields:function(a,s,c){for(c=c||this.length;this.pos<c;){var m=this.readVarint(),_=m>>3,S=this.pos;this.type=7&m,a(_,s,this),this.pos===S&&this.skip(m)}return s},readMessage:function(a,s){return this.readFields(a,s,this.readVarint()+this.pos)},readFixed32:function(){var a=Br(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=$r(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Br(this.buf,this.pos)+4294967296*Br(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=Br(this.buf,this.pos)+4294967296*$r(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=Zd(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=Zd(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var s,c,m=this.buf;return s=127&(c=m[this.pos++]),c<128?s:(s|=(127&(c=m[this.pos++]))<<7,c<128?s:(s|=(127&(c=m[this.pos++]))<<14,c<128?s:(s|=(127&(c=m[this.pos++]))<<21,c<128?s:function(_,S,C){var P,D,j=C.buf;if(P=(112&(D=j[C.pos++]))>>4,D<128||(P|=(127&(D=j[C.pos++]))<<3,D<128)||(P|=(127&(D=j[C.pos++]))<<10,D<128)||(P|=(127&(D=j[C.pos++]))<<17,D<128)||(P|=(127&(D=j[C.pos++]))<<24,D<128)||(P|=(1&(D=j[C.pos++]))<<31,D<128))return Ff(_,P,S);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(c=m[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,s=this.pos;return this.pos=a,a-s>=12&&Fh?function(c,m,_){return Fh.decode(c.subarray(m,_))}(this.buf,s,a):function(c,m,_){for(var S="",C=m;C<_;){var P,D,j,B=c[C],K=null,V=B>239?4:B>223?3:B>191?2:1;if(C+V>_)break;V===1?B<128&&(K=B):V===2?(192&(P=c[C+1]))==128&&(K=(31&B)<<6|63&P)<=127&&(K=null):V===3?(D=c[C+2],(192&(P=c[C+1]))==128&&(192&D)==128&&((K=(15&B)<<12|(63&P)<<6|63&D)<=2047||K>=55296&&K<=57343)&&(K=null)):V===4&&(D=c[C+2],j=c[C+3],(192&(P=c[C+1]))==128&&(192&D)==128&&(192&j)==128&&((K=(15&B)<<18|(63&P)<<12|(63&D)<<6|63&j)<=65535||K>=1114112)&&(K=null)),K===null?(K=65533,V=1):K>65535&&(K-=65536,S+=String.fromCharCode(K>>>10&1023|55296),K=56320|1023&K),S+=String.fromCharCode(K),C+=V}return S}(this.buf,s,a)},readBytes:function(){var a=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,a);return this.pos=a,s},readPackedVarint:function(a,s){if(this.type!==Za.Bytes)return a.push(this.readVarint(s));var c=Uu(this);for(a=a||[];this.pos<c;)a.push(this.readVarint(s));return a},readPackedSVarint:function(a){if(this.type!==Za.Bytes)return a.push(this.readSVarint());var s=Uu(this);for(a=a||[];this.pos<s;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Za.Bytes)return a.push(this.readBoolean());var s=Uu(this);for(a=a||[];this.pos<s;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Za.Bytes)return a.push(this.readFloat());var s=Uu(this);for(a=a||[];this.pos<s;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Za.Bytes)return a.push(this.readDouble());var s=Uu(this);for(a=a||[];this.pos<s;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Za.Bytes)return a.push(this.readFixed32());var s=Uu(this);for(a=a||[];this.pos<s;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Za.Bytes)return a.push(this.readSFixed32());var s=Uu(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Za.Bytes)return a.push(this.readFixed64());var s=Uu(this);for(a=a||[];this.pos<s;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Za.Bytes)return a.push(this.readSFixed64());var s=Uu(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed64());return a},skip:function(a){var s=7&a;if(s===Za.Varint)for(;this.buf[this.pos++]>127;);else if(s===Za.Bytes)this.pos=this.readVarint()+this.pos;else if(s===Za.Fixed32)this.pos+=4;else{if(s!==Za.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(a,s){this.writeVarint(a<<3|s)},realloc:function(a){for(var s=this.length||16;s<this.pos+a;)s*=2;if(s!==this.length){var c=new Uint8Array(s);c.set(this.buf),this.buf=c,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Zr(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Zr(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Zr(this.buf,-1&a,this.pos),Zr(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Zr(this.buf,-1&a,this.pos),Zr(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(s,c){var m,_;if(s>=0?(m=s%4294967296|0,_=s/4294967296|0):(_=~(-s/4294967296),4294967295^(m=~(-s%4294967296))?m=m+1|0:(m=0,_=_+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(S,C,P){P.buf[P.pos++]=127&S|128,S>>>=7,P.buf[P.pos++]=127&S|128,S>>>=7,P.buf[P.pos++]=127&S|128,S>>>=7,P.buf[P.pos++]=127&S|128,P.buf[P.pos]=127&(S>>>=7)}(m,0,c),function(S,C){var P=(7&S)<<4;C.buf[C.pos++]|=P|((S>>>=3)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S)))))}(_,c)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var s=this.pos;this.pos=function(m,_,S){for(var C,P,D=0;D<_.length;D++){if((C=_.charCodeAt(D))>55295&&C<57344){if(!P){C>56319||D+1===_.length?(m[S++]=239,m[S++]=191,m[S++]=189):P=C;continue}if(C<56320){m[S++]=239,m[S++]=191,m[S++]=189,P=C;continue}C=P-55296<<10|C-56320|65536,P=null}else P&&(m[S++]=239,m[S++]=191,m[S++]=189,P=null);C<128?m[S++]=C:(C<2048?m[S++]=C>>6|192:(C<65536?m[S++]=C>>12|224:(m[S++]=C>>18|240,m[S++]=C>>12&63|128),m[S++]=C>>6&63|128),m[S++]=63&C|128)}return S}(this.buf,a,this.pos);var c=this.pos-s;c>=128&&hp(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeFloat:function(a){this.realloc(4),nf(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),nf(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var s=a.length;this.writeVarint(s),this.realloc(s);for(var c=0;c<s;c++)this.buf[this.pos++]=a[c]},writeRawMessage:function(a,s){this.pos++;var c=this.pos;a(s,this);var m=this.pos-c;m>=128&&hp(c,m,this),this.pos=c-1,this.writeVarint(m),this.pos+=m},writeMessage:function(a,s,c){this.writeTag(a,Za.Bytes),this.writeRawMessage(s,c)},writePackedVarint:function(a,s){s.length&&this.writeMessage(a,Ud,s)},writePackedSVarint:function(a,s){s.length&&this.writeMessage(a,U,s)},writePackedBoolean:function(a,s){s.length&&this.writeMessage(a,rr,s)},writePackedFloat:function(a,s){s.length&&this.writeMessage(a,we,s)},writePackedDouble:function(a,s){s.length&&this.writeMessage(a,$e,s)},writePackedFixed32:function(a,s){s.length&&this.writeMessage(a,wr,s)},writePackedSFixed32:function(a,s){s.length&&this.writeMessage(a,Jt,s)},writePackedFixed64:function(a,s){s.length&&this.writeMessage(a,yr,s)},writePackedSFixed64:function(a,s){s.length&&this.writeMessage(a,kr,s)},writeBytesField:function(a,s){this.writeTag(a,Za.Bytes),this.writeBytes(s)},writeFixed32Field:function(a,s){this.writeTag(a,Za.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(a,s){this.writeTag(a,Za.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(a,s){this.writeTag(a,Za.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(a,s){this.writeTag(a,Za.Fixed64),this.writeSFixed64(s)},writeVarintField:function(a,s){this.writeTag(a,Za.Varint),this.writeVarint(s)},writeSVarintField:function(a,s){this.writeTag(a,Za.Varint),this.writeSVarint(s)},writeStringField:function(a,s){this.writeTag(a,Za.Bytes),this.writeString(s)},writeFloatField:function(a,s){this.writeTag(a,Za.Fixed32),this.writeFloat(s)},writeDoubleField:function(a,s){this.writeTag(a,Za.Fixed64),this.writeDouble(s)},writeBooleanField:function(a,s){this.writeVarintField(a,Boolean(s))}};var Tt=function(a,s){var c=s.pixelRatio,m=s.version,_=s.stretchX,S=s.stretchY,C=s.content;this.paddedRect=a,this.pixelRatio=c,this.stretchX=_,this.stretchY=S,this.content=C,this.version=m},ar={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};ar.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},ar.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},ar.tlbr.get=function(){return this.tl.concat(this.br)},ar.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Tt.prototype,ar);var Vr=function(a,s){var c={},m={};this.haveRenderCallbacks=[];var _=[];this.addImages(a,c,_),this.addImages(s,m,_);var S=Kr(_),C=new Go({width:S.w||1,height:S.h||1});for(var P in a){var D=a[P],j=c[P].paddedRect;Go.copy(D.data,C,{x:0,y:0},{x:j.x+1,y:j.y+1},D.data)}for(var B in s){var K=s[B],V=m[B].paddedRect,de=V.x+1,ze=V.y+1,Ue=K.data.width,st=K.data.height;Go.copy(K.data,C,{x:0,y:0},{x:de,y:ze},K.data),Go.copy(K.data,C,{x:0,y:st-1},{x:de,y:ze-1},{width:Ue,height:1}),Go.copy(K.data,C,{x:0,y:0},{x:de,y:ze+st},{width:Ue,height:1}),Go.copy(K.data,C,{x:Ue-1,y:0},{x:de-1,y:ze},{width:1,height:st}),Go.copy(K.data,C,{x:0,y:0},{x:de+Ue,y:ze},{width:1,height:st})}this.image=C,this.iconPositions=c,this.patternPositions=m};Vr.prototype.addImages=function(a,s,c){for(var m in a){var _=a[m],S={x:0,y:0,w:_.data.width+2,h:_.data.height+2};c.push(S),s[m]=new Tt(S,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(m)}},Vr.prototype.patchUpdatedImages=function(a,s){for(var c in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[c],a.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],a.getImage(c),s)},Vr.prototype.patchUpdatedImage=function(a,s,c){if(a&&s&&a.version!==s.version){a.version=s.version;var m=a.tl;c.update(s.data,void 0,{x:m[0],y:m[1]})}},Dn("ImagePosition",Tt),Dn("ImageAtlas",Vr);var un={horizontal:1,vertical:2,horizontalOnly:3},Er=function(){this.scale=1,this.fontStack="",this.imageName=null};Er.forText=function(a,s){var c=new Er;return c.scale=a||1,c.fontStack=s,c},Er.forImage=function(a){var s=new Er;return s.imageName=a,s};var Jr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function yn(a,s,c,m,_,S,C,P,D,j,B,K,V,de,ze,Ue){var st,Ke=Jr.fromFeature(a,_);K===un.vertical&&Ke.verticalizePunctuation();var St=ou.processBidirectionalText,jt=ou.processStyledBidirectionalText;if(St&&Ke.sections.length===1){st=[];for(var or=0,lr=St(Ke.toString(),mn(Ke,j,S,s,m,de,ze));or<lr.length;or+=1){var Cr=lr[or],Qr=new Jr;Qr.text=Cr,Qr.sections=Ke.sections;for(var dn=0;dn<Cr.length;dn++)Qr.sectionIndex.push(0);st.push(Qr)}}else if(jt){st=[];for(var ti=0,Rn=jt(Ke.text,Ke.sectionIndex,mn(Ke,j,S,s,m,de,ze));ti<Rn.length;ti+=1){var si=Rn[ti],On=new Jr;On.text=si[0],On.sectionIndex=si[1],On.sections=Ke.sections,st.push(On)}}else st=function(Kn,na){for(var Bi=[],va=Kn.text,ui=0,Aa=0,ho=na;Aa<ho.length;Aa+=1){var Zo=ho[Aa];Bi.push(Kn.substring(ui,Zo)),ui=Zo}return ui<va.length&&Bi.push(Kn.substring(ui,va.length)),Bi}(Ke,mn(Ke,j,S,s,m,de,ze));var ji=[],bi={positionedLines:ji,text:Ke.toString(),top:B[1],bottom:B[1],left:B[0],right:B[0],writingMode:K,iconsInText:!1,verticalizable:!1};return function(Kn,na,Bi,va,ui,Aa,ho,Zo,So,yo,Xo,gs){for(var cs=0,Hs=-17,As=0,Ws=0,Uo=Zo==="right"?1:Zo==="left"?0:.5,Ts=0,ua=0,Ka=ui;ua<Ka.length;ua+=1){var Na=Ka[ua];Na.trim();var la=Na.getMaxScale(),pu=24*(la-1),Ki={positionedGlyphs:[],lineOffset:0};Kn.positionedLines[Ts]=Ki;var Oa=Ki.positionedGlyphs,Jo=0;if(Na.length()){for(var Xs=0;Xs<Na.length();Xs++){var ba=Na.getSection(Xs),Ic=Na.getSectionIndex(Xs),Iu=Na.getCharCode(Xs),Pc=0,wo=null,Rc=null,Cl=null,Pu=24,tc=!(So===un.horizontal||!Xo&&!Sf(Iu)||Xo&&(ai[Iu]||(uf=Iu,vn.Arabic(uf)||vn["Arabic Supplement"](uf)||vn["Arabic Extended-A"](uf)||vn["Arabic Presentation Forms-A"](uf)||vn["Arabic Presentation Forms-B"](uf))));if(ba.imageName){var Lc=va[ba.imageName];if(!Lc)continue;Cl=ba.imageName,Kn.iconsInText=Kn.iconsInText||!0,Rc=Lc.paddedRect;var of=Lc.displaySize;ba.scale=24*ba.scale/gs,Pc=pu+(24-of[1]*ba.scale),Pu=(wo={width:of[0],height:of[1],left:1,top:-3,advance:tc?of[1]:of[0]}).advance;var sf=tc?of[0]*ba.scale-24*la:of[1]*ba.scale-24*la;sf>0&&sf>Jo&&(Jo=sf)}else{var Bh=Bi[ba.fontStack],Bf=Bh&&Bh[Iu];if(Bf&&Bf.rect)Rc=Bf.rect,wo=Bf.metrics;else{var Nh=na[ba.fontStack],td=Nh&&Nh[Iu];if(!td)continue;wo=td.metrics}Pc=24*(la-ba.scale)}tc?(Kn.verticalizable=!0,Oa.push({glyph:Iu,imageName:Cl,x:cs,y:Hs+Pc,vertical:tc,scale:ba.scale,fontStack:ba.fontStack,sectionIndex:Ic,metrics:wo,rect:Rc}),cs+=Pu*ba.scale+yo):(Oa.push({glyph:Iu,imageName:Cl,x:cs,y:Hs+Pc,vertical:tc,scale:ba.scale,fontStack:ba.fontStack,sectionIndex:Ic,metrics:wo,rect:Rc}),cs+=wo.advance*ba.scale+yo)}Oa.length!==0&&(As=Math.max(cs-yo,As),Ri(Oa,0,Oa.length-1,Uo,Jo)),cs=0;var rd=Aa*la+Jo;Ki.lineOffset=Math.max(Jo,pu),Hs+=rd,Ws=Math.max(rd,Ws),++Ts}else Hs+=Aa,++Ts}var uf,gp=Hs- -17,zh=_n(ho),lf=zh.horizontalAlign,Zh=zh.verticalAlign;(function(nd,yp,_p,xp,id,bp,Ep,Uh,Sp){var Vh,ad=(yp-_p)*id;Vh=bp!==Ep?-Uh*xp- -17:(-xp*Sp+.5)*Ep;for(var fh=0,wp=nd;fh<wp.length;fh+=1)for(var hh=0,Cp=wp[fh].positionedGlyphs;hh<Cp.length;hh+=1){var jh=Cp[hh];jh.x+=ad,jh.y+=Vh}})(Kn.positionedLines,Uo,lf,Zh,As,Ws,Aa,gp,ui.length),Kn.top+=-Zh*gp,Kn.bottom=Kn.top+gp,Kn.left+=-lf*As,Kn.right=Kn.left+As}(bi,s,c,m,st,C,P,D,K,j,V,Ue),!function(Kn){for(var na=0,Bi=Kn;na<Bi.length;na+=1)if(Bi[na].positionedGlyphs.length!==0)return!1;return!0}(ji)&&bi}Jr.fromFeature=function(a,s){for(var c=new Jr,m=0;m<a.sections.length;m++){var _=a.sections[m];_.image?c.addImageSection(_):c.addTextSection(_,s)}return c},Jr.prototype.length=function(){return this.text.length},Jr.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},Jr.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},Jr.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},Jr.prototype.verticalizePunctuation=function(){this.text=function(a){for(var s="",c=0;c<a.length;c++){var m=a.charCodeAt(c+1)||null,_=a.charCodeAt(c-1)||null;s+=m&&dl(m)&&!lh[a[c+1]]||_&&dl(_)&&!lh[a[c-1]]||!lh[a[c]]?a[c]:lh[a[c]]}return s}(this.text)},Jr.prototype.trim=function(){for(var a=0,s=0;s<this.text.length&&ai[this.text.charCodeAt(s)];s++)a++;for(var c=this.text.length,m=this.text.length-1;m>=0&&m>=a&&ai[this.text.charCodeAt(m)];m--)c--;this.text=this.text.substring(a,c),this.sectionIndex=this.sectionIndex.slice(a,c)},Jr.prototype.substring=function(a,s){var c=new Jr;return c.text=this.text.substring(a,s),c.sectionIndex=this.sectionIndex.slice(a,s),c.sections=this.sections,c},Jr.prototype.toString=function(){return this.text},Jr.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce(function(s,c){return Math.max(s,a.sections[c].scale)},0)},Jr.prototype.addTextSection=function(a,s){this.text+=a.text,this.sections.push(Er.forText(a.scale,a.fontStack||s));for(var c=this.sections.length-1,m=0;m<a.text.length;++m)this.sectionIndex.push(c)},Jr.prototype.addImageSection=function(a){var s=a.image?a.image.name:"";if(s.length!==0){var c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Er.forImage(s)),this.sectionIndex.push(this.sections.length-1)):vt("Reached maximum number of images 6401")}else vt("Can't add FormattedSection with an empty image.")},Jr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var ai={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},_r={};function Sr(a,s,c,m,_,S){if(s.imageName){var C=m[s.imageName];return C?C.displaySize[0]*s.scale*24/S+_:0}var P=c[s.fontStack],D=P&&P[a];return D?D.metrics.advance*s.scale+_:0}function Gn(a,s,c,m){var _=Math.pow(a-s,2);return m?a<s?_/2:2*_:_+Math.abs(c)*c}function nn(a,s,c){var m=0;return a===10&&(m-=1e4),c&&(m+=150),a!==40&&a!==65288||(m+=50),s!==41&&s!==65289||(m+=50),m}function Gr(a,s,c,m,_,S){for(var C=null,P=Gn(s,c,_,S),D=0,j=m;D<j.length;D+=1){var B=j[D],K=Gn(s-B.x,c,_,S)+B.badness;K<=P&&(C=B,P=K)}return{index:a,x:s,priorBreak:C,badness:P}}function mn(a,s,c,m,_,S,C){if(S!=="point")return[];if(!a)return[];for(var P,D=[],j=function(st,Ke,St,jt,or,lr){for(var Cr=0,Qr=0;Qr<st.length();Qr++){var dn=st.getSection(Qr);Cr+=Sr(st.getCharCode(Qr),dn,jt,or,Ke,lr)}return Cr/Math.max(1,Math.ceil(Cr/St))}(a,s,c,m,_,C),B=a.text.indexOf("\u200B")>=0,K=0,V=0;V<a.length();V++){var de=a.getSection(V),ze=a.getCharCode(V);if(ai[ze]||(K+=Sr(ze,de,m,_,s,C)),V<a.length()-1){var Ue=!((P=ze)<11904||!(vn["Bopomofo Extended"](P)||vn.Bopomofo(P)||vn["CJK Compatibility Forms"](P)||vn["CJK Compatibility Ideographs"](P)||vn["CJK Compatibility"](P)||vn["CJK Radicals Supplement"](P)||vn["CJK Strokes"](P)||vn["CJK Symbols and Punctuation"](P)||vn["CJK Unified Ideographs Extension A"](P)||vn["CJK Unified Ideographs"](P)||vn["Enclosed CJK Letters and Months"](P)||vn["Halfwidth and Fullwidth Forms"](P)||vn.Hiragana(P)||vn["Ideographic Description Characters"](P)||vn["Kangxi Radicals"](P)||vn["Katakana Phonetic Extensions"](P)||vn.Katakana(P)||vn["Vertical Forms"](P)||vn["Yi Radicals"](P)||vn["Yi Syllables"](P)));(_r[ze]||Ue||de.imageName)&&D.push(Gr(V+1,K,j,D,nn(ze,a.getCharCode(V+1),Ue&&B),!1))}}return function st(Ke){return Ke?st(Ke.priorBreak).concat(Ke.index):[]}(Gr(a.length(),K,j,D,0,!0))}function _n(a){var s=.5,c=.5;switch(a){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:s,verticalAlign:c}}function Ri(a,s,c,m,_){if(m||_)for(var S=a[c],C=(a[c].x+S.metrics.advance*S.scale)*m,P=s;P<=c;P++)a[P].x-=C,a[P].y+=_}function Ei(a,s,c,m,_,S){var C,P=a.image;if(P.content){var D=P.content,j=P.pixelRatio||1;C=[D[0]/j,D[1]/j,P.displaySize[0]-D[2]/j,P.displaySize[1]-D[3]/j]}var B,K,V,de,ze=s.left*S,Ue=s.right*S;c==="width"||c==="both"?(de=_[0]+ze-m[3],K=_[0]+Ue+m[1]):K=(de=_[0]+(ze+Ue-P.displaySize[0])/2)+P.displaySize[0];var st=s.top*S,Ke=s.bottom*S;return c==="height"||c==="both"?(B=_[1]+st-m[0],V=_[1]+Ke+m[2]):V=(B=_[1]+(st+Ke-P.displaySize[1])/2)+P.displaySize[1],{image:P,top:B,right:K,bottom:V,left:de,collisionPadding:C}}_r[10]=!0,_r[32]=!0,_r[38]=!0,_r[40]=!0,_r[41]=!0,_r[43]=!0,_r[45]=!0,_r[47]=!0,_r[173]=!0,_r[183]=!0,_r[8203]=!0,_r[8208]=!0,_r[8211]=!0,_r[8231]=!0;var pn=function(a){function s(c,m,_,S){a.call(this,c,m),this.angle=_,S!==void 0&&(this.segment=S)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.clone=function(){return new s(this.x,this.y,this.angle,this.segment)},s}(se);function Tn(a,s){var c=s.expression;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Vi(a+1))};if(c.kind==="source")return{kind:"source"};for(var m=c.zoomStops,_=c.interpolationType,S=0;S<m.length&&m[S]<=a;)S++;for(var C=S=Math.max(0,S-1);C<m.length&&m[C]<a+1;)C++;C=Math.min(m.length-1,C);var P=m[S],D=m[C];return c.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:D,interpolationType:_}:{kind:"camera",minZoom:P,maxZoom:D,minSize:c.evaluate(new Vi(P)),maxSize:c.evaluate(new Vi(D)),interpolationType:_}}function hi(a,s,c){var m=s.uSize,_=c.lowerSize;return a.kind==="source"?_/128:a.kind==="composite"?ya(_/128,c.upperSize/128,s.uSizeT):m}function Mi(a,s){var c=0,m=0;if(a.kind==="constant")m=a.layoutSize;else if(a.kind!=="source"){var _=a.interpolationType,S=_?Ot(Me.interpolationFactor(_,s,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?m=ya(a.minSize,a.maxSize,S):c=S}return{uSizeT:c,uSize:m}}Dn("Anchor",pn);var $i=Object.freeze({__proto__:null,getSizeData:Tn,evaluateSizeForFeature:hi,evaluateSizeForZoom:Mi,SIZE_PACK_FACTOR:128});function fo(a,s,c,m,_){if(s.segment===void 0)return!0;for(var S=s,C=s.segment+1,P=0;P>-c/2;){if(--C<0)return!1;P-=a[C].dist(S),S=a[C]}P+=a[C].dist(a[C+1]),C++;for(var D=[],j=0;P<c/2;){var B=a[C],K=a[C+1];if(!K)return!1;var V=a[C-1].angleTo(B)-B.angleTo(K);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:P,angleDelta:V}),j+=V;P-D[0].distance>m;)j-=D.shift().angleDelta;if(j>_)return!1;C++,P+=B.dist(K)}return!0}function Ao(a){for(var s=0,c=0;c<a.length-1;c++)s+=a[c].dist(a[c+1]);return s}function Yi(a,s,c){return a?.6*s*c:0}function os(a,s){return Math.max(a?a.right-a.left:0,s?s.right-s.left:0)}function ao(a,s,c,m,_,S){for(var C=Yi(c,_,S),P=os(c,m)*S,D=0,j=Ao(a)/2,B=0;B<a.length-1;B++){var K=a[B],V=a[B+1],de=K.dist(V);if(D+de>j){var ze=(j-D)/de,Ue=ya(K.x,V.x,ze),st=ya(K.y,V.y,ze),Ke=new pn(Ue,st,V.angleTo(K),B);return Ke._round(),!C||fo(a,Ke,P,C,s)?Ke:void 0}D+=de}}function ss(a,s,c,m,_,S,C,P,D){var j=Yi(m,S,C),B=os(m,_),K=B*C,V=a[0].x===0||a[0].x===D||a[0].y===0||a[0].y===D;return s-K<s/4&&(s=K+s/4),function de(ze,Ue,st,Ke,St,jt,or,lr,Cr){for(var Qr=jt/2,dn=Ao(ze),ti=0,Rn=Ue-st,si=[],On=0;On<ze.length-1;On++){for(var ji=ze[On],bi=ze[On+1],Kn=ji.dist(bi),na=bi.angleTo(ji);Rn+st<ti+Kn;){var Bi=((Rn+=st)-ti)/Kn,va=ya(ji.x,bi.x,Bi),ui=ya(ji.y,bi.y,Bi);if(va>=0&&va<Cr&&ui>=0&&ui<Cr&&Rn-Qr>=0&&Rn+Qr<=dn){var Aa=new pn(va,ui,na,On);Aa._round(),Ke&&!fo(ze,Aa,jt,Ke,St)||si.push(Aa)}}ti+=Kn}return lr||si.length||or||(si=de(ze,ti/2,st,Ke,St,jt,or,!0,Cr)),si}(a,V?s/2*P%s:(B/2+2*S)*C*P%s,s,j,c,K,V,!1,D)}function Ho(a,s,c,m,_){for(var S=[],C=0;C<a.length;C++)for(var P=a[C],D=void 0,j=0;j<P.length-1;j++){var B=P[j],K=P[j+1];B.x<s&&K.x<s||(B.x<s?B=new se(s,B.y+(s-B.x)/(K.x-B.x)*(K.y-B.y))._round():K.x<s&&(K=new se(s,B.y+(s-B.x)/(K.x-B.x)*(K.y-B.y))._round()),B.y<c&&K.y<c||(B.y<c?B=new se(B.x+(c-B.y)/(K.y-B.y)*(K.x-B.x),c)._round():K.y<c&&(K=new se(B.x+(c-B.y)/(K.y-B.y)*(K.x-B.x),c)._round()),B.x>=m&&K.x>=m||(B.x>=m?B=new se(m,B.y+(m-B.x)/(K.x-B.x)*(K.y-B.y))._round():K.x>=m&&(K=new se(m,B.y+(m-B.x)/(K.x-B.x)*(K.y-B.y))._round()),B.y>=_&&K.y>=_||(B.y>=_?B=new se(B.x+(_-B.y)/(K.y-B.y)*(K.x-B.x),_)._round():K.y>=_&&(K=new se(B.x+(_-B.y)/(K.y-B.y)*(K.x-B.x),_)._round()),D&&B.equals(D[D.length-1])||S.push(D=[B]),D.push(K)))))}return S}function us(a,s,c,m){var _=[],S=a.image,C=S.pixelRatio,P=S.paddedRect.w-2,D=S.paddedRect.h-2,j=a.right-a.left,B=a.bottom-a.top,K=S.stretchX||[[0,P]],V=S.stretchY||[[0,D]],de=function(va,ui){return va+ui[1]-ui[0]},ze=K.reduce(de,0),Ue=V.reduce(de,0),st=P-ze,Ke=D-Ue,St=0,jt=ze,or=0,lr=Ue,Cr=0,Qr=st,dn=0,ti=Ke;if(S.content&&m){var Rn=S.content;St=Qo(K,0,Rn[0]),or=Qo(V,0,Rn[1]),jt=Qo(K,Rn[0],Rn[2]),lr=Qo(V,Rn[1],Rn[3]),Cr=Rn[0]-St,dn=Rn[1]-or,Qr=Rn[2]-Rn[0]-jt,ti=Rn[3]-Rn[1]-lr}var si=function(va,ui,Aa,ho){var Zo=To(va.stretch-St,jt,j,a.left),So=Li(va.fixed-Cr,Qr,va.stretch,ze),yo=To(ui.stretch-or,lr,B,a.top),Xo=Li(ui.fixed-dn,ti,ui.stretch,Ue),gs=To(Aa.stretch-St,jt,j,a.left),cs=Li(Aa.fixed-Cr,Qr,Aa.stretch,ze),Hs=To(ho.stretch-or,lr,B,a.top),As=Li(ho.fixed-dn,ti,ho.stretch,Ue),Ws=new se(Zo,yo),Uo=new se(gs,yo),Ts=new se(gs,Hs),ua=new se(Zo,Hs),Ka=new se(So/C,Xo/C),Na=new se(cs/C,As/C),la=s*Math.PI/180;if(la){var pu=Math.sin(la),Ki=Math.cos(la),Oa=[Ki,-pu,pu,Ki];Ws._matMult(Oa),Uo._matMult(Oa),ua._matMult(Oa),Ts._matMult(Oa)}var Jo=va.stretch+va.fixed,Xs=ui.stretch+ui.fixed;return{tl:Ws,tr:Uo,bl:ua,br:Ts,tex:{x:S.paddedRect.x+1+Jo,y:S.paddedRect.y+1+Xs,w:Aa.stretch+Aa.fixed-Jo,h:ho.stretch+ho.fixed-Xs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ka,pixelOffsetBR:Na,minFontScaleX:Qr/C/j,minFontScaleY:ti/C/B,isSDF:c}};if(m&&(S.stretchX||S.stretchY))for(var On=ds(K,st,ze),ji=ds(V,Ke,Ue),bi=0;bi<On.length-1;bi++)for(var Kn=On[bi],na=On[bi+1],Bi=0;Bi<ji.length-1;Bi++)_.push(si(Kn,ji[Bi],na,ji[Bi+1]));else _.push(si({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:D+1}));return _}function Qo(a,s,c){for(var m=0,_=0,S=a;_<S.length;_+=1){var C=S[_];m+=Math.max(s,Math.min(c,C[1]))-Math.max(s,Math.min(c,C[0]))}return m}function ds(a,s,c){for(var m=[{fixed:-1,stretch:0}],_=0,S=a;_<S.length;_+=1){var C=S[_],P=C[0],D=C[1],j=m[m.length-1];m.push({fixed:P-j.stretch,stretch:j.stretch}),m.push({fixed:P-j.stretch,stretch:j.stretch+(D-P)})}return m.push({fixed:s+1,stretch:c}),m}function To(a,s,c,m){return a/s*c+m}function Li(a,s,c,m){return a-s*c/m}var Wo=function(a,s,c,m,_,S,C,P,D,j){if(this.boxStartIndex=a.length,D){var B=S.top,K=S.bottom,V=S.collisionPadding;V&&(B-=V[1],K+=V[3]);var de=K-B;de>0&&(de=Math.max(10,de),this.circleDiameter=de)}else{var ze=S.top*C-P,Ue=S.bottom*C+P,st=S.left*C-P,Ke=S.right*C+P,St=S.collisionPadding;if(St&&(st-=St[0]*C,ze-=St[1]*C,Ke+=St[2]*C,Ue+=St[3]*C),j){var jt=new se(st,ze),or=new se(Ke,ze),lr=new se(st,Ue),Cr=new se(Ke,Ue),Qr=j*Math.PI/180;jt._rotate(Qr),or._rotate(Qr),lr._rotate(Qr),Cr._rotate(Qr),st=Math.min(jt.x,or.x,lr.x,Cr.x),Ke=Math.max(jt.x,or.x,lr.x,Cr.x),ze=Math.min(jt.y,or.y,lr.y,Cr.y),Ue=Math.max(jt.y,or.y,lr.y,Cr.y)}a.emplaceBack(s.x,s.y,st,ze,Ke,Ue,c,m,_)}this.boxEndIndex=a.length},da=function(a,s){if(a===void 0&&(a=[]),s===void 0&&(s=vs),this.data=a,this.length=this.data.length,this.compare=s,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)};function vs(a,s){return a<s?-1:a>s?1:0}function xi(a,s,c){s===void 0&&(s=1),c===void 0&&(c=!1);for(var m=1/0,_=1/0,S=-1/0,C=-1/0,P=a[0],D=0;D<P.length;D++){var j=P[D];(!D||j.x<m)&&(m=j.x),(!D||j.y<_)&&(_=j.y),(!D||j.x>S)&&(S=j.x),(!D||j.y>C)&&(C=j.y)}var B=Math.min(S-m,C-_),K=B/2,V=new da([],qi);if(B===0)return new se(m,_);for(var de=m;de<S;de+=B)for(var ze=_;ze<C;ze+=B)V.push(new Ca(de+K,ze+K,K,a));for(var Ue=function(St){for(var jt=0,or=0,lr=0,Cr=St[0],Qr=0,dn=Cr.length,ti=dn-1;Qr<dn;ti=Qr++){var Rn=Cr[Qr],si=Cr[ti],On=Rn.x*si.y-si.x*Rn.y;or+=(Rn.x+si.x)*On,lr+=(Rn.y+si.y)*On,jt+=3*On}return new Ca(or/jt,lr/jt,0,St)}(a),st=V.length;V.length;){var Ke=V.pop();(Ke.d>Ue.d||!Ue.d)&&(Ue=Ke,c&&console.log("found best %d after %d probes",Math.round(1e4*Ke.d)/1e4,st)),Ke.max-Ue.d<=s||(V.push(new Ca(Ke.p.x-(K=Ke.h/2),Ke.p.y-K,K,a)),V.push(new Ca(Ke.p.x+K,Ke.p.y-K,K,a)),V.push(new Ca(Ke.p.x-K,Ke.p.y+K,K,a)),V.push(new Ca(Ke.p.x+K,Ke.p.y+K,K,a)),st+=4)}return c&&(console.log("num probes: "+st),console.log("best distance: "+Ue.d)),Ue.p}function qi(a,s){return s.max-a.max}function Ca(a,s,c,m){this.p=new se(a,s),this.h=c,this.d=function(_,S){for(var C=!1,P=1/0,D=0;D<S.length;D++)for(var j=S[D],B=0,K=j.length,V=K-1;B<K;V=B++){var de=j[B],ze=j[V];de.y>_.y!=ze.y>_.y&&_.x<(ze.x-de.x)*(_.y-de.y)/(ze.y-de.y)+de.x&&(C=!C),P=Math.min(P,Sc(_,de,ze))}return(C?1:-1)*Math.sqrt(P)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}da.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},da.prototype.pop=function(){if(this.length!==0){var a=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),a}},da.prototype.peek=function(){return this.data[0]},da.prototype._up=function(a){for(var s=this.data,c=this.compare,m=s[a];a>0;){var _=a-1>>1,S=s[_];if(c(m,S)>=0)break;s[a]=S,a=_}s[a]=m},da.prototype._down=function(a){for(var s=this.data,c=this.compare,m=this.length>>1,_=s[a];a<m;){var S=1+(a<<1),C=s[S],P=S+1;if(P<this.length&&c(s[P],C)<0&&(S=P,C=s[P]),c(C,_)>=0)break;s[a]=C,a=S}s[a]=_};var zo=Number.POSITIVE_INFINITY;function Sl(a,s){return s[1]!==zo?function(c,m,_){var S=0,C=0;switch(m=Math.abs(m),_=Math.abs(_),c){case"top-right":case"top-left":case"top":C=_-7;break;case"bottom-right":case"bottom-left":case"bottom":C=7-_}switch(c){case"top-right":case"bottom-right":case"right":S=-m;break;case"top-left":case"bottom-left":case"left":S=m}return[S,C]}(a,s[0],s[1]):function(c,m){var _=0,S=0;m<0&&(m=0);var C=m/Math.sqrt(2);switch(c){case"top-right":case"top-left":S=C-7;break;case"bottom-right":case"bottom-left":S=7-C;break;case"bottom":S=7-m;break;case"top":S=m-7}switch(c){case"top-right":case"bottom-right":_=-C;break;case"top-left":case"bottom-left":_=C;break;case"left":_=m;break;case"right":_=-m}return[_,S]}(a,s[0])}function Ne(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function nr(a,s,c,m,_,S,C,P,D,j,B,K,V,de,ze){var Ue=function(or,lr,Cr,Qr,dn,ti,Rn,si){for(var On=Qr.layout.get("text-rotate").evaluate(ti,{})*Math.PI/180,ji=[],bi=0,Kn=lr.positionedLines;bi<Kn.length;bi+=1)for(var na=Kn[bi],Bi=0,va=na.positionedGlyphs;Bi<va.length;Bi+=1){var ui=va[Bi];if(ui.rect){var Aa=ui.rect||{},ho=4,Zo=!0,So=1,yo=0,Xo=(dn||si)&&ui.vertical,gs=ui.metrics.advance*ui.scale/2;if(si&&lr.verticalizable&&(yo=na.lineOffset/2-(ui.imageName?-(24-ui.metrics.width*ui.scale)/2:24*(ui.scale-1))),ui.imageName){var cs=Rn[ui.imageName];Zo=cs.sdf,ho=1/(So=cs.pixelRatio)}var Hs=dn?[ui.x+gs,ui.y]:[0,0],As=dn?[0,0]:[ui.x+gs+Cr[0],ui.y+Cr[1]-yo],Ws=[0,0];Xo&&(Ws=As,As=[0,0]);var Uo=(ui.metrics.left-ho)*ui.scale-gs+As[0],Ts=(-ui.metrics.top-ho)*ui.scale+As[1],ua=Uo+Aa.w*ui.scale/So,Ka=Ts+Aa.h*ui.scale/So,Na=new se(Uo,Ts),la=new se(ua,Ts),pu=new se(Uo,Ka),Ki=new se(ua,Ka);if(Xo){var Oa=new se(-gs,gs- -17),Jo=-Math.PI/2,Xs=12-gs,ba=new se(22-Xs,-(ui.imageName?Xs:0)),Ic=new(Function.prototype.bind.apply(se,[null].concat(Ws)));Na._rotateAround(Jo,Oa)._add(ba)._add(Ic),la._rotateAround(Jo,Oa)._add(ba)._add(Ic),pu._rotateAround(Jo,Oa)._add(ba)._add(Ic),Ki._rotateAround(Jo,Oa)._add(ba)._add(Ic)}if(On){var Iu=Math.sin(On),Pc=Math.cos(On),wo=[Pc,-Iu,Iu,Pc];Na._matMult(wo),la._matMult(wo),pu._matMult(wo),Ki._matMult(wo)}var Rc=new se(0,0),Cl=new se(0,0);ji.push({tl:Na,tr:la,bl:pu,br:Ki,tex:Aa,writingMode:lr.writingMode,glyphOffset:Hs,sectionIndex:ui.sectionIndex,isSDF:Zo,pixelOffsetTL:Rc,pixelOffsetBR:Cl,minFontScaleX:0,minFontScaleY:0})}}return ji}(0,c,P,_,S,C,m,a.allowVerticalPlacement),st=a.textSizeData,Ke=null;st.kind==="source"?(Ke=[128*_.layout.get("text-size").evaluate(C,{})])[0]>32640&&vt(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):st.kind==="composite"&&((Ke=[128*de.compositeTextSizes[0].evaluate(C,{},ze),128*de.compositeTextSizes[1].evaluate(C,{},ze)])[0]>32640||Ke[1]>32640)&&vt(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,Ue,Ke,P,S,C,j,s,D.lineStartIndex,D.lineLength,V,ze);for(var St=0,jt=B;St<jt.length;St+=1)K[jt[St]]=a.text.placedSymbolArray.length-1;return 4*Ue.length}function Vt(a){for(var s in a)return a[s];return null}function Mn(a,s,c,m){var _=a.compareText;if(s in _){for(var S=_[s],C=S.length-1;C>=0;C--)if(m.dist(S[C])<c)return!0}else _[s]=[];return _[s].push(m),!1}var ra=Js.VectorTileFeature.types,Re=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ve(a,s,c,m,_,S,C,P,D,j,B,K,V){var de=P?Math.min(32640,Math.round(P[0])):0,ze=P?Math.min(32640,Math.round(P[1])):0;a.emplaceBack(s,c,Math.round(32*m),Math.round(32*_),S,C,(de<<1)+(D?1:0),ze,16*j,16*B,256*K,256*V)}function tt(a,s,c){a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c)}function Mt(a){for(var s=0,c=a.sections;s<c.length;s+=1)if(Ns(c[s].text))return!0;return!1}var Yt=function(a){this.layoutVertexArray=new gc,this.indexArray=new qu,this.programConfigurations=a,this.segments=new xe,this.dynamicLayoutVertexArray=new Hl,this.opacityVertexArray=new ml,this.placedSymbolArray=new g};Yt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Yt.prototype.upload=function(a,s,c,m){this.isEmpty()||(c&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Bd.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,Nd.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,Re,!0),this.opacityVertexBuffer.itemSize=1),(c||m)&&this.programConfigurations.upload(a))},Yt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Dn("SymbolBuffers",Yt);var ut=function(a,s,c){this.layoutVertexArray=new a,this.layoutAttributes=s,this.indexArray=new c,this.segments=new xe,this.collisionVertexArray=new Ch};ut.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,fp.members,!0)},ut.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Dn("CollisionBuffers",ut);var We=function(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(S){return S.id}),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Qs([]),this.placementViewportMatrix=Qs([]);var s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Tn(this.zoom,s["text-size"]),this.iconSizeData=Tn(this.zoom,s["icon-size"]);var c=this.layers[0].layout,m=c.get("symbol-sort-key"),_=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(function(S){return un[S]})),this.stateDependentLayerIds=this.layers.filter(function(S){return S.isStateDependent()}).map(function(S){return S.id}),this.sourceID=a.sourceID};We.prototype.createArrays=function(){this.text=new Yt(new fi(this.layers,this.zoom,function(a){return/^text/.test(a)})),this.icon=new Yt(new fi(this.layers,this.zoom,function(a){return/^icon/.test(a)})),this.glyphOffsetArray=new I,this.lineVertexArray=new O,this.symbolInstances=new M},We.prototype.calculateGlyphDependencies=function(a,s,c,m,_){for(var S=0;S<a.length;S++)if(s[a.charCodeAt(S)]=!0,(c||m)&&_){var C=lh[a.charAt(S)];C&&(s[C.charCodeAt(0)]=!0)}},We.prototype.populate=function(a,s,c){var m=this.layers[0],_=m.layout,S=_.get("text-font"),C=_.get("text-field"),P=_.get("icon-image"),D=(C.value.kind!=="constant"||C.value.value instanceof $a&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),j=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,B=_.get("symbol-sort-key");if(this.features=[],D||j){for(var K=s.iconDependencies,V=s.glyphDependencies,de=s.availableImages,ze=new Vi(this.zoom),Ue=0,st=a;Ue<st.length;Ue+=1){var Ke=st[Ue],St=Ke.feature,jt=Ke.id,or=Ke.index,lr=Ke.sourceLayerIndex,Cr=m._featureFilter.needGeometry,Qr=io(St,Cr);if(m._featureFilter.filter(ze,Qr,c)){Cr||(Qr.geometry=qa(St));var dn=void 0;if(D){var ti=m.getValueAndResolveTokens("text-field",Qr,c,de),Rn=$a.factory(ti);Mt(Rn)&&(this.hasRTLText=!0),(!this.hasRTLText||Af()==="unavailable"||this.hasRTLText&&ou.isParsed())&&(dn=zd(Rn,m,Qr))}var si=void 0;if(j){var On=m.getValueAndResolveTokens("icon-image",Qr,c,de);si=On instanceof Fa?On:Fa.fromString(On)}if(dn||si){var ji=this.sortFeaturesByKey?B.evaluate(Qr,{},c):void 0;if(this.features.push({id:jt,text:dn,icon:si,index:or,sourceLayerIndex:lr,geometry:Qr.geometry,properties:St.properties,type:ra[St.type],sortKey:ji}),si&&(K[si.name]=!0),dn){var bi=S.evaluate(Qr,{},c).join(","),Kn=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(un.vertical)>=0;for(var na=0,Bi=dn.sections;na<Bi.length;na+=1){var va=Bi[na];if(va.image)K[va.image.name]=!0;else{var ui=jc(dn.toString()),Aa=va.fontStack||bi,ho=V[Aa]=V[Aa]||{};this.calculateGlyphDependencies(va.text,ho,Kn,this.allowVerticalPlacement,ui)}}}}}}_.get("symbol-placement")==="line"&&(this.features=function(Zo){var So={},yo={},Xo=[],gs=0;function cs(Oa){Xo.push(Zo[Oa]),gs++}function Hs(Oa,Jo,Xs){var ba=yo[Oa];return delete yo[Oa],yo[Jo]=ba,Xo[ba].geometry[0].pop(),Xo[ba].geometry[0]=Xo[ba].geometry[0].concat(Xs[0]),ba}function As(Oa,Jo,Xs){var ba=So[Jo];return delete So[Jo],So[Oa]=ba,Xo[ba].geometry[0].shift(),Xo[ba].geometry[0]=Xs[0].concat(Xo[ba].geometry[0]),ba}function Ws(Oa,Jo,Xs){var ba=Xs?Jo[0][Jo[0].length-1]:Jo[0][0];return Oa+":"+ba.x+":"+ba.y}for(var Uo=0;Uo<Zo.length;Uo++){var Ts=Zo[Uo],ua=Ts.geometry,Ka=Ts.text?Ts.text.toString():null;if(Ka){var Na=Ws(Ka,ua),la=Ws(Ka,ua,!0);if(Na in yo&&la in So&&yo[Na]!==So[la]){var pu=As(Na,la,ua),Ki=Hs(Na,la,Xo[pu].geometry);delete So[Na],delete yo[la],yo[Ws(Ka,Xo[Ki].geometry,!0)]=Ki,Xo[pu].geometry=null}else Na in yo?Hs(Na,la,ua):la in So?As(Na,la,ua):(cs(Uo),So[Na]=gs-1,yo[la]=gs-1)}else cs(Uo)}return Xo.filter(function(Oa){return Oa.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Zo,So){return Zo.sortKey-So.sortKey})}},We.prototype.update=function(a,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,s,this.layers,c),this.icon.programConfigurations.updatePaintArrays(a,s,this.layers,c))},We.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},We.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},We.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},We.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},We.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},We.prototype.addToLineVertexArray=function(a,s){var c=this.lineVertexArray.length;if(a.segment!==void 0){for(var m=a.dist(s[a.segment+1]),_=a.dist(s[a.segment]),S={},C=a.segment+1;C<s.length;C++)S[C]={x:s[C].x,y:s[C].y,tileUnitDistanceFromAnchor:m},C<s.length-1&&(m+=s[C+1].dist(s[C]));for(var P=a.segment||0;P>=0;P--)S[P]={x:s[P].x,y:s[P].y,tileUnitDistanceFromAnchor:_},P>0&&(_+=s[P-1].dist(s[P]));for(var D=0;D<s.length;D++){var j=S[D];this.lineVertexArray.emplaceBack(j.x,j.y,j.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}},We.prototype.addSymbols=function(a,s,c,m,_,S,C,P,D,j,B,K){for(var V=a.indexArray,de=a.layoutVertexArray,ze=a.segments.prepareSegment(4*s.length,de,V,this.canOverlap?S.sortKey:void 0),Ue=this.glyphOffsetArray.length,st=ze.vertexLength,Ke=this.allowVerticalPlacement&&C===un.vertical?Math.PI/2:0,St=S.text&&S.text.sections,jt=0;jt<s.length;jt++){var or=s[jt],lr=or.tl,Cr=or.tr,Qr=or.bl,dn=or.br,ti=or.tex,Rn=or.pixelOffsetTL,si=or.pixelOffsetBR,On=or.minFontScaleX,ji=or.minFontScaleY,bi=or.glyphOffset,Kn=or.isSDF,na=or.sectionIndex,Bi=ze.vertexLength,va=bi[1];ve(de,P.x,P.y,lr.x,va+lr.y,ti.x,ti.y,c,Kn,Rn.x,Rn.y,On,ji),ve(de,P.x,P.y,Cr.x,va+Cr.y,ti.x+ti.w,ti.y,c,Kn,si.x,Rn.y,On,ji),ve(de,P.x,P.y,Qr.x,va+Qr.y,ti.x,ti.y+ti.h,c,Kn,Rn.x,si.y,On,ji),ve(de,P.x,P.y,dn.x,va+dn.y,ti.x+ti.w,ti.y+ti.h,c,Kn,si.x,si.y,On,ji),tt(a.dynamicLayoutVertexArray,P,Ke),V.emplaceBack(Bi,Bi+1,Bi+2),V.emplaceBack(Bi+1,Bi+2,Bi+3),ze.vertexLength+=4,ze.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(bi[0]),jt!==s.length-1&&na===s[jt+1].sectionIndex||a.programConfigurations.populatePaintArrays(de.length,S,S.index,{},K,St&&St[na])}a.placedSymbolArray.emplaceBack(P.x,P.y,Ue,this.glyphOffsetArray.length-Ue,st,D,j,P.segment,c?c[0]:0,c?c[1]:0,m[0],m[1],C,0,!1,0,B)},We.prototype._addCollisionDebugVertex=function(a,s,c,m,_,S){return s.emplaceBack(0,0),a.emplaceBack(c.x,c.y,m,_,Math.round(S.x),Math.round(S.y))},We.prototype.addCollisionDebugVertices=function(a,s,c,m,_,S,C){var P=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),D=P.vertexLength,j=_.layoutVertexArray,B=_.collisionVertexArray,K=C.anchorX,V=C.anchorY;this._addCollisionDebugVertex(j,B,S,K,V,new se(a,s)),this._addCollisionDebugVertex(j,B,S,K,V,new se(c,s)),this._addCollisionDebugVertex(j,B,S,K,V,new se(c,m)),this._addCollisionDebugVertex(j,B,S,K,V,new se(a,m)),P.vertexLength+=4;var de=_.indexArray;de.emplaceBack(D,D+1),de.emplaceBack(D+1,D+2),de.emplaceBack(D+2,D+3),de.emplaceBack(D+3,D),P.primitiveLength+=4},We.prototype.addDebugCollisionBoxes=function(a,s,c,m){for(var _=a;_<s;_++){var S=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(S.x1,S.y1,S.x2,S.y2,m?this.textCollisionBox:this.iconCollisionBox,S.anchorPoint,c)}},We.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ut(gl,ec.members,Hc),this.iconCollisionBox=new ut(gl,ec.members,Hc);for(var a=0;a<this.symbolInstances.length;a++){var s=this.symbolInstances.get(a);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}},We.prototype._deserializeCollisionBoxesForSymbol=function(a,s,c,m,_,S,C,P,D){for(var j={},B=s;B<c;B++){var K=a.get(B);j.textBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},j.textFeatureIndex=K.featureIndex;break}for(var V=m;V<_;V++){var de=a.get(V);j.verticalTextBox={x1:de.x1,y1:de.y1,x2:de.x2,y2:de.y2,anchorPointX:de.anchorPointX,anchorPointY:de.anchorPointY},j.verticalTextFeatureIndex=de.featureIndex;break}for(var ze=S;ze<C;ze++){var Ue=a.get(ze);j.iconBox={x1:Ue.x1,y1:Ue.y1,x2:Ue.x2,y2:Ue.y2,anchorPointX:Ue.anchorPointX,anchorPointY:Ue.anchorPointY},j.iconFeatureIndex=Ue.featureIndex;break}for(var st=P;st<D;st++){var Ke=a.get(st);j.verticalIconBox={x1:Ke.x1,y1:Ke.y1,x2:Ke.x2,y2:Ke.y2,anchorPointX:Ke.anchorPointX,anchorPointY:Ke.anchorPointY},j.verticalIconFeatureIndex=Ke.featureIndex;break}return j},We.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var s=0;s<this.symbolInstances.length;s++){var c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}},We.prototype.hasTextData=function(){return this.text.segments.get().length>0},We.prototype.hasIconData=function(){return this.icon.segments.get().length>0},We.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},We.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},We.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},We.prototype.addIndicesForPlacedSymbol=function(a,s){for(var c=a.placedSymbolArray.get(s),m=c.vertexStartIndex+4*c.numGlyphs,_=c.vertexStartIndex;_<m;_+=4)a.indexArray.emplaceBack(_,_+1,_+2),a.indexArray.emplaceBack(_+1,_+2,_+3)},We.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var s=Math.sin(a),c=Math.cos(a),m=[],_=[],S=[],C=0;C<this.symbolInstances.length;++C){S.push(C);var P=this.symbolInstances.get(C);m.push(0|Math.round(s*P.anchorX+c*P.anchorY)),_.push(P.featureIndex)}return S.sort(function(D,j){return m[D]-m[j]||_[j]-_[D]}),S},We.prototype.addToSortKeyRanges=function(a,s){var c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:a,symbolInstanceEnd:a+1})},We.prototype.sortFeatures=function(a){var s=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var c=0,m=this.symbolInstanceIndexes;c<m.length;c+=1){var _=this.symbolInstances.get(m[c]);this.featureSortOrder.push(_.featureIndex),[_.rightJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.leftJustifiedTextSymbolIndex].forEach(function(S,C,P){S>=0&&P.indexOf(S)===C&&s.addIndicesForPlacedSymbol(s.text,S)}),_.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,_.verticalPlacedTextSymbolIndex),_.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.placedIconSymbolIndex),_.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Dn("SymbolBucket",We,{omit:["layers","collisionBoxArray","features","compareText"]}),We.MAX_GLYPHS=65535,We.addDynamicAttributes=tt;var xt=new is({"symbol-placement":new Qn(me.layout_symbol["symbol-placement"]),"symbol-spacing":new Qn(me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Qn(me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Bn(me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Qn(me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Qn(me.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Qn(me.layout_symbol["icon-ignore-placement"]),"icon-optional":new Qn(me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Qn(me.layout_symbol["icon-rotation-alignment"]),"icon-size":new Bn(me.layout_symbol["icon-size"]),"icon-text-fit":new Qn(me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Qn(me.layout_symbol["icon-text-fit-padding"]),"icon-image":new Bn(me.layout_symbol["icon-image"]),"icon-rotate":new Bn(me.layout_symbol["icon-rotate"]),"icon-padding":new Qn(me.layout_symbol["icon-padding"]),"icon-keep-upright":new Qn(me.layout_symbol["icon-keep-upright"]),"icon-offset":new Bn(me.layout_symbol["icon-offset"]),"icon-anchor":new Bn(me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Qn(me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Qn(me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Qn(me.layout_symbol["text-rotation-alignment"]),"text-field":new Bn(me.layout_symbol["text-field"]),"text-font":new Bn(me.layout_symbol["text-font"]),"text-size":new Bn(me.layout_symbol["text-size"]),"text-max-width":new Bn(me.layout_symbol["text-max-width"]),"text-line-height":new Qn(me.layout_symbol["text-line-height"]),"text-letter-spacing":new Bn(me.layout_symbol["text-letter-spacing"]),"text-justify":new Bn(me.layout_symbol["text-justify"]),"text-radial-offset":new Bn(me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Qn(me.layout_symbol["text-variable-anchor"]),"text-anchor":new Bn(me.layout_symbol["text-anchor"]),"text-max-angle":new Qn(me.layout_symbol["text-max-angle"]),"text-writing-mode":new Qn(me.layout_symbol["text-writing-mode"]),"text-rotate":new Bn(me.layout_symbol["text-rotate"]),"text-padding":new Qn(me.layout_symbol["text-padding"]),"text-keep-upright":new Qn(me.layout_symbol["text-keep-upright"]),"text-transform":new Bn(me.layout_symbol["text-transform"]),"text-offset":new Bn(me.layout_symbol["text-offset"]),"text-allow-overlap":new Qn(me.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Qn(me.layout_symbol["text-ignore-placement"]),"text-optional":new Qn(me.layout_symbol["text-optional"])}),Ae={paint:new is({"icon-opacity":new Bn(me.paint_symbol["icon-opacity"]),"icon-color":new Bn(me.paint_symbol["icon-color"]),"icon-halo-color":new Bn(me.paint_symbol["icon-halo-color"]),"icon-halo-width":new Bn(me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Bn(me.paint_symbol["icon-halo-blur"]),"icon-translate":new Qn(me.paint_symbol["icon-translate"]),"icon-translate-anchor":new Qn(me.paint_symbol["icon-translate-anchor"]),"text-opacity":new Bn(me.paint_symbol["text-opacity"]),"text-color":new Bn(me.paint_symbol["text-color"],{runtimeType:gn,getOverride:function(a){return a.textColor},hasOverride:function(a){return!!a.textColor}}),"text-halo-color":new Bn(me.paint_symbol["text-halo-color"]),"text-halo-width":new Bn(me.paint_symbol["text-halo-width"]),"text-halo-blur":new Bn(me.paint_symbol["text-halo-blur"]),"text-translate":new Qn(me.paint_symbol["text-translate"]),"text-translate-anchor":new Qn(me.paint_symbol["text-translate-anchor"])}),layout:xt},Je=function(a){this.type=a.property.overrides?a.property.overrides.runtimeType:Pn,this.defaultValue=a};Je.prototype.evaluate=function(a){if(a.formattedSection){var s=this.defaultValue.property.overrides;if(s&&s.hasOverride(a.formattedSection))return s.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},Je.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},Je.prototype.outputDefined=function(){return!1},Je.prototype.serialize=function(){return null},Dn("FormatSectionOverride",Je,{omit:["defaultValue"]});var Oe=function(a){function s(c){a.call(this,c,Ae)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.recalculate=function(c,m){if(a.prototype.recalculate.call(this,c,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var _=this.layout.get("text-writing-mode");if(_){for(var S=[],C=0,P=_;C<P.length;C+=1){var D=P[C];S.indexOf(D)<0&&S.push(D)}this.layout._values["text-writing-mode"]=S}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},s.prototype.getValueAndResolveTokens=function(c,m,_,S){var C=this.layout.get(c).evaluate(m,{},_,S),P=this._unevaluatedLayout._values[c];return P.isDataDriven()||Rl(P.value)||!C?C:function(D,j){return j.replace(/{([^{}]+)}/g,function(B,K){return K in D?String(D[K]):""})}(m.properties,C)},s.prototype.createBucket=function(c){return new We(c)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype._setPaintOverrides=function(){for(var c=0,m=Ae.paint.overridableProperties;c<m.length;c+=1){var _=m[c];if(s.hasPaintOverride(this.layout,_)){var S,C=this.paint.get(_),P=new Je(C),D=new pc(P,C.property.specification);S=C.value.kind==="constant"||C.value.kind==="source"?new Ol("source",D):new cl("composite",D,C.value.zoomStops,C.value._interpolationType),this.paint._values[_]=new ps(C.property,S,C.parameters)}}},s.prototype._handleOverridablePaintPropertyUpdate=function(c,m,_){return!(!this.layout||m.isDataDriven()||_.isDataDriven())&&s.hasPaintOverride(this.layout,c)},s.hasPaintOverride=function(c,m){var _=c.get("text-field"),S=Ae.paint.properties[m],C=!1,P=function(B){for(var K=0,V=B;K<V.length;K+=1)if(S.overrides&&S.overrides.hasOverride(V[K]))return void(C=!0)};if(_.value.kind==="constant"&&_.value.value instanceof $a)P(_.value.value.sections);else if(_.value.kind==="source"){var D=function(B){C||(B instanceof uo&&ur(B.value)===sa?P(B.value.sections):B instanceof zt?P(B.sections):B.eachChild(D))},j=_.value;j._styleExpression&&D(j._styleExpression.expression)}return C},s}(wu),kt={paint:new is({"background-color":new Qn(me.paint_background["background-color"]),"background-pattern":new Es(me.paint_background["background-pattern"]),"background-opacity":new Qn(me.paint_background["background-opacity"])})},Ut=function(a){function s(c){a.call(this,c,kt)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(wu),Mr={paint:new is({"raster-opacity":new Qn(me.paint_raster["raster-opacity"]),"raster-hue-rotate":new Qn(me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Qn(me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Qn(me.paint_raster["raster-brightness-max"]),"raster-saturation":new Qn(me.paint_raster["raster-saturation"]),"raster-contrast":new Qn(me.paint_raster["raster-contrast"]),"raster-resampling":new Qn(me.paint_raster["raster-resampling"]),"raster-fade-duration":new Qn(me.paint_raster["raster-fade-duration"])})},ln=function(a){function s(c){a.call(this,c,Mr)}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s}(wu),cn=function(a){function s(c){a.call(this,c,{}),this.implementation=c}return a&&(s.__proto__=a),(s.prototype=Object.create(a&&a.prototype)).constructor=s,s.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},s.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},s.prototype.recalculate=function(){},s.prototype.updateTransitions=function(){},s.prototype.hasTransition=function(){},s.prototype.serialize=function(){},s.prototype.onAdd=function(c){this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},s.prototype.onRemove=function(c){this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},s}(wu),Sn={circle:$c,heatmap:Ah,hillshade:ip,fill:Ph,"fill-extrusion":El,line:Yp,symbol:Oe,background:Ut,raster:ln},rn=ye.HTMLImageElement,Hn=ye.HTMLCanvasElement,kn=ye.HTMLVideoElement,Zn=ye.ImageData,Un=ye.ImageBitmap,Ln=function(a,s,c,m){this.context=a,this.format=c,this.texture=a.gl.createTexture(),this.update(s,m)};Ln.prototype.update=function(a,s,c){var m=a.width,_=a.height,S=!(this.size&&this.size[0]===m&&this.size[1]===_||c),C=this.context,P=C.gl;if(this.useMipmap=Boolean(s&&s.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!s||s.premultiply!==!1)),S)this.size=[m,_],a instanceof rn||a instanceof Hn||a instanceof kn||a instanceof Zn||Un&&a instanceof Un?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,a):P.texImage2D(P.TEXTURE_2D,0,this.format,m,_,0,this.format,P.UNSIGNED_BYTE,a.data);else{var D=c||{x:0,y:0},j=D.x,B=D.y;a instanceof rn||a instanceof Hn||a instanceof kn||a instanceof Zn||Un&&a instanceof Un?P.texSubImage2D(P.TEXTURE_2D,0,j,B,P.RGBA,P.UNSIGNED_BYTE,a):P.texSubImage2D(P.TEXTURE_2D,0,j,B,m,_,P.RGBA,P.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)},Ln.prototype.bind=function(a,s,c){var m=this.context.gl;m.bindTexture(m.TEXTURE_2D,this.texture),c!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=m.LINEAR),a!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,c||a),this.filter=a),s!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s),this.wrap=s)},Ln.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Ln.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var pi=function(a){var s=this;this._callback=a,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){s._triggered=!1,s._callback()})};pi.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){a._triggered=!1,a._callback()},0))},pi.prototype.remove=function(){delete this._channel,this._callback=function(){}};var La=function(a,s,c){this.target=a,this.parent=s,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},br(["receive","process"],this),this.invoker=new pi(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ae()?a:ye};function ms(a,s,c){var m=2*Math.PI*6378137/256/Math.pow(2,c);return[a*m-2*Math.PI*6378137/2,s*m-2*Math.PI*6378137/2]}La.prototype.send=function(a,s,c,m,_){var S=this;_===void 0&&(_=!1);var C=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(this.callbacks[C]=c);var P=ce(this.globalScope)?void 0:[];return this.target.postMessage({id:C,type:a,hasCallback:!!c,targetMapId:m,mustQueue:_,sourceMapId:this.mapId,data:Xi(s,P)},P),{cancel:function(){c&&delete S.callbacks[C],S.target.postMessage({id:C,type:"<cancel>",targetMapId:m,sourceMapId:S.mapId})}}},La.prototype.receive=function(a){var s=a.data,c=s.id;if(c&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){delete this.tasks[c];var m=this.cancelCallbacks[c];delete this.cancelCallbacks[c],m&&m()}else ae()||s.mustQueue?(this.tasks[c]=s,this.taskQueue.push(c),this.invoker.trigger()):this.processTask(c,s)},La.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),s=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),s&&this.processTask(a,s)}},La.prototype.processTask=function(a,s){var c=this;if(s.type==="<response>"){var m=this.callbacks[a];delete this.callbacks[a],m&&(s.error?m(Bs(s.error)):m(null,Bs(s.data)))}else{var _=!1,S=ce(this.globalScope)?void 0:[],C=s.hasCallback?function(B,K){_=!0,delete c.cancelCallbacks[a],c.target.postMessage({id:a,type:"<response>",sourceMapId:c.mapId,error:B?Xi(B):null,data:Xi(K,S)},S)}:function(B){_=!0},P=null,D=Bs(s.data);if(this.parent[s.type])P=this.parent[s.type](s.sourceMapId,D,C);else if(this.parent.getWorkerSource){var j=s.type.split(".");P=this.parent.getWorkerSource(s.sourceMapId,j[0],D.source)[j[1]](D,C)}else C(new Error("Could not find function "+s.type));!_&&P&&P.cancel&&(this.cancelCallbacks[a]=P.cancel)}},La.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Ba=function(a,s){a&&(s?this.setSouthWest(a).setNorthEast(s):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};Ba.prototype.setNorthEast=function(a){return this._ne=a instanceof _a?new _a(a.lng,a.lat):_a.convert(a),this},Ba.prototype.setSouthWest=function(a){return this._sw=a instanceof _a?new _a(a.lng,a.lat):_a.convert(a),this},Ba.prototype.extend=function(a){var s,c,m=this._sw,_=this._ne;if(a instanceof _a)s=a,c=a;else{if(!(a instanceof Ba))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(Ba.convert(a)):this.extend(_a.convert(a)):this;if(c=a._ne,!(s=a._sw)||!c)return this}return m||_?(m.lng=Math.min(s.lng,m.lng),m.lat=Math.min(s.lat,m.lat),_.lng=Math.max(c.lng,_.lng),_.lat=Math.max(c.lat,_.lat)):(this._sw=new _a(s.lng,s.lat),this._ne=new _a(c.lng,c.lat)),this},Ba.prototype.getCenter=function(){return new _a((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Ba.prototype.getSouthWest=function(){return this._sw},Ba.prototype.getNorthEast=function(){return this._ne},Ba.prototype.getNorthWest=function(){return new _a(this.getWest(),this.getNorth())},Ba.prototype.getSouthEast=function(){return new _a(this.getEast(),this.getSouth())},Ba.prototype.getWest=function(){return this._sw.lng},Ba.prototype.getSouth=function(){return this._sw.lat},Ba.prototype.getEast=function(){return this._ne.lng},Ba.prototype.getNorth=function(){return this._ne.lat},Ba.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Ba.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Ba.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Ba.prototype.contains=function(a){var s=_a.convert(a),c=s.lng,m=s.lat,_=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&_},Ba.convert=function(a){return!a||a instanceof Ba?a:new Ba(a)};var _a=function(a,s){if(isNaN(a)||isNaN(s))throw new Error("Invalid LngLat object: ("+a+", "+s+")");if(this.lng=+a,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};_a.prototype.wrap=function(){return new _a(vr(this.lng,-180,180),this.lat)},_a.prototype.toArray=function(){return[this.lng,this.lat]},_a.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},_a.prototype.distanceTo=function(a){var s=Math.PI/180,c=this.lat*s,m=a.lat*s,_=Math.sin(c)*Math.sin(m)+Math.cos(c)*Math.cos(m)*Math.cos((a.lng-this.lng)*s);return 63710088e-1*Math.acos(Math.min(_,1))},_a.prototype.toBounds=function(a){a===void 0&&(a=0);var s=360*a/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new Ba(new _a(this.lng-c,this.lat-s),new _a(this.lng+c,this.lat+s))},_a.convert=function(a){if(a instanceof _a)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new _a(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new _a(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var wl=2*Math.PI*63710088e-1;function Gs(a){return wl*Math.cos(a*Math.PI/180)}function rl(a){return(180+a)/360}function Mu(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function pp(a,s){return a/Gs(s)}function ku(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var kc=function(a,s,c){c===void 0&&(c=0),this.x=+a,this.y=+s,this.z=+c};kc.fromLngLat=function(a,s){s===void 0&&(s=0);var c=_a.convert(a);return new kc(rl(c.lng),Mu(c.lat),pp(s,c.lat))},kc.prototype.toLngLat=function(){return new _a(360*this.x-180,ku(this.y))},kc.prototype.toAltitude=function(){return this.z*Gs(ku(this.y))},kc.prototype.meterInMercatorCoordinateUnits=function(){return 1/wl*(a=ku(this.y),1/Math.cos(a*Math.PI/180));var a};var ch=function(a,s,c){this.z=a,this.x=s,this.y=c,this.key=dp(0,a,a,s,c)};ch.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},ch.prototype.url=function(a,s){var c,m,_,S,C,P=(m=this.y,_=this.z,S=ms(256*(c=this.x),256*(m=Math.pow(2,_)-m-1),_),C=ms(256*(c+1),256*(m+1),_),S[0]+","+S[1]+","+C[0]+","+C[1]),D=function(j,B,K){for(var V,de="",ze=j;ze>0;ze--)de+=(B&(V=1<<ze-1)?1:0)+(K&V?2:0);return de}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",D).replace("{bbox-epsg-3857}",P)},ch.prototype.getTilePoint=function(a){var s=Math.pow(2,this.z);return new se(8192*(a.x*s-this.x),8192*(a.y*s-this.y))},ch.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Uv=function(a,s){this.wrap=a,this.canonical=s,this.key=dp(a,s.z,s.z,s.x,s.y)},ls=function(a,s,c,m,_){this.overscaledZ=a,this.wrap=s,this.canonical=new ch(c,+m,+_),this.key=dp(s,a,c,m,_)};function dp(a,s,c,m,_){(a*=2)<0&&(a=-1*a-1);var S=1<<c;return(S*S*a+S*_+m).toString(36)+c.toString(36)+s.toString(36)}ls.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},ls.prototype.scaledTo=function(a){var s=this.canonical.z-a;return a>this.canonical.z?new ls(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ls(a,this.wrap,a,this.canonical.x>>s,this.canonical.y>>s)},ls.prototype.calculateScaledKey=function(a,s){var c=this.canonical.z-a;return a>this.canonical.z?dp(this.wrap*+s,a,this.canonical.z,this.canonical.x,this.canonical.y):dp(this.wrap*+s,a,a,this.canonical.x>>c,this.canonical.y>>c)},ls.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var s=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>s&&a.canonical.y===this.canonical.y>>s},ls.prototype.children=function(a){if(this.overscaledZ>=a)return[new ls(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var s=this.canonical.z+1,c=2*this.canonical.x,m=2*this.canonical.y;return[new ls(s,this.wrap,s,c,m),new ls(s,this.wrap,s,c+1,m),new ls(s,this.wrap,s,c,m+1),new ls(s,this.wrap,s,c+1,m+1)]},ls.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},ls.prototype.wrapped=function(){return new ls(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},ls.prototype.unwrapTo=function(a){return new ls(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},ls.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},ls.prototype.toUnwrapped=function(){return new Uv(this.wrap,this.canonical)},ls.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},ls.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new kc(a.x-this.wrap,a.y))},Dn("CanonicalTileID",ch),Dn("OverscaledTileID",ls,{omit:["posMatrix"]});var nl=function(a,s,c){if(this.uid=a,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return vt('"'+c+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=s.height;var m=this.dim=s.height-2;this.data=new Uint32Array(s.data.buffer),this.encoding=c||"mapbox";for(var _=0;_<m;_++)this.data[this._idx(-1,_)]=this.data[this._idx(0,_)],this.data[this._idx(m,_)]=this.data[this._idx(m-1,_)],this.data[this._idx(_,-1)]=this.data[this._idx(_,0)],this.data[this._idx(_,m)]=this.data[this._idx(_,m-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(m,-1)]=this.data[this._idx(m-1,0)],this.data[this._idx(-1,m)]=this.data[this._idx(0,m-1)],this.data[this._idx(m,m)]=this.data[this._idx(m-1,m-1)]};nl.prototype.get=function(a,s){var c=new Uint8Array(this.data.buffer),m=4*this._idx(a,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(c[m],c[m+1],c[m+2])},nl.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},nl.prototype._idx=function(a,s){if(a<-1||a>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(a+1)},nl.prototype._unpackMapbox=function(a,s,c){return(256*a*256+256*s+c)/10-1e4},nl.prototype._unpackTerrarium=function(a,s,c){return 256*a+s+c/256-32768},nl.prototype.getPixels=function(){return new Go({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},nl.prototype.backfillBorder=function(a,s,c){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var m=s*this.dim,_=s*this.dim+this.dim,S=c*this.dim,C=c*this.dim+this.dim;switch(s){case-1:m=_-1;break;case 1:_=m+1}switch(c){case-1:S=C-1;break;case 1:C=S+1}for(var P=-s*this.dim,D=-c*this.dim,j=S;j<C;j++)for(var B=m;B<_;B++)this.data[this._idx(B,j)]=a.data[this._idx(B+P,j+D)]},Dn("DEMData",nl);var vp=function(a){this._stringToNumber={},this._numberToString=[];for(var s=0;s<a.length;s++){var c=a[s];this._stringToNumber[c]=s,this._numberToString[s]=c}};vp.prototype.encode=function(a){return this._stringToNumber[a]},vp.prototype.decode=function(a){return this._numberToString[a]};var Kp=function(a,s,c,m,_){this.type="Feature",this._vectorTileFeature=a,a._z=s,a._x=c,a._y=m,this.properties=a.properties,this.id=_},mp={geometry:{configurable:!0}};mp.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},mp.geometry.set=function(a){this._geometry=a},Kp.prototype.toJSON=function(){var a={geometry:this.geometry};for(var s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(a[s]=this[s]);return a},Object.defineProperties(Kp.prototype,mp);var Dh=function(){this.state={},this.stateChanges={},this.deletedStates={}};Dh.prototype.updateState=function(a,s,c){var m=String(s);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][m]=this.stateChanges[a][m]||{},Ft(this.stateChanges[a][m],c),this.deletedStates[a]===null)for(var _ in this.deletedStates[a]={},this.state[a])_!==m&&(this.deletedStates[a][_]=null);else if(this.deletedStates[a]&&this.deletedStates[a][m]===null)for(var S in this.deletedStates[a][m]={},this.state[a][m])c[S]||(this.deletedStates[a][m][S]=null);else for(var C in c)this.deletedStates[a]&&this.deletedStates[a][m]&&this.deletedStates[a][m][C]===null&&delete this.deletedStates[a][m][C]},Dh.prototype.removeFeatureState=function(a,s,c){if(this.deletedStates[a]!==null){var m=String(s);if(this.deletedStates[a]=this.deletedStates[a]||{},c&&s!==void 0)this.deletedStates[a][m]!==null&&(this.deletedStates[a][m]=this.deletedStates[a][m]||{},this.deletedStates[a][m][c]=null);else if(s!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][m])for(c in this.deletedStates[a][m]={},this.stateChanges[a][m])this.deletedStates[a][m][c]=null;else this.deletedStates[a][m]=null;else this.deletedStates[a]=null}},Dh.prototype.getState=function(a,s){var c=String(s),m=Ft({},(this.state[a]||{})[c],(this.stateChanges[a]||{})[c]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var _=this.deletedStates[a][s];if(_===null)return{};for(var S in _)delete m[S]}return m},Dh.prototype.initializeTileState=function(a,s){a.setFeatureState(this.state,s)},Dh.prototype.coalesceChanges=function(a,s){var c={};for(var m in this.stateChanges){this.state[m]=this.state[m]||{};var _={};for(var S in this.stateChanges[m])this.state[m][S]||(this.state[m][S]={}),Ft(this.state[m][S],this.stateChanges[m][S]),_[S]=this.state[m][S];c[m]=_}for(var C in this.deletedStates){this.state[C]=this.state[C]||{};var P={};if(this.deletedStates[C]===null)for(var D in this.state[C])P[D]={},this.state[C][D]={};else for(var j in this.deletedStates[C]){if(this.deletedStates[C][j]===null)this.state[C][j]={};else for(var B=0,K=Object.keys(this.deletedStates[C][j]);B<K.length;B+=1)delete this.state[C][j][K[B]];P[j]=this.state[C][j]}c[C]=c[C]||{},Ft(c[C],P)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(var V in a)a[V].setFeatureState(c,s)};var af=function(a,s){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new pl(8192,16,0),this.grid3D=new pl(8192,16,0),this.featureIndexArray=new Q,this.promoteId=s};function Qp(a,s,c,m,_){return Et(a,function(S,C){var P=s instanceof Rs?s.get(C):null;return P&&P.evaluate?P.evaluate(c,m,_):P})}function Jp(a){for(var s=1/0,c=1/0,m=-1/0,_=-1/0,S=0,C=a;S<C.length;S+=1){var P=C[S];s=Math.min(s,P.x),c=Math.min(c,P.y),m=Math.max(m,P.x),_=Math.max(_,P.y)}return{minX:s,minY:c,maxX:m,maxY:_}}function Vd(a,s){return s-a}af.prototype.insert=function(a,s,c,m,_,S){var C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,m,_);for(var P=S?this.grid3D:this.grid,D=0;D<s.length;D++){for(var j=s[D],B=[1/0,1/0,-1/0,-1/0],K=0;K<j.length;K++){var V=j[K];B[0]=Math.min(B[0],V.x),B[1]=Math.min(B[1],V.y),B[2]=Math.max(B[2],V.x),B[3]=Math.max(B[3],V.y)}B[0]<8192&&B[1]<8192&&B[2]>=0&&B[3]>=0&&P.insert(C,B[0],B[1],B[2],B[3])}},af.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Js.VectorTile(new js(this.rawTileData)).layers,this.sourceLayerCoder=new vp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},af.prototype.query=function(a,s,c,m){var _=this;this.loadVTLayers();for(var S=a.params||{},C=8192/a.tileSize/a.scale,P=Fl(S.filter),D=a.queryGeometry,j=a.queryPadding*C,B=Jp(D),K=this.grid.query(B.minX-j,B.minY-j,B.maxX+j,B.maxY+j),V=Jp(a.cameraQueryGeometry),de=this.grid3D.query(V.minX-j,V.minY-j,V.maxX+j,V.maxY+j,function(or,lr,Cr,Qr){return function(dn,ti,Rn,si,On){for(var ji=0,bi=dn;ji<bi.length;ji+=1){var Kn=bi[ji];if(ti<=Kn.x&&Rn<=Kn.y&&si>=Kn.x&&On>=Kn.y)return!0}var na=[new se(ti,Rn),new se(ti,On),new se(si,On),new se(si,Rn)];if(dn.length>2){for(var Bi=0,va=na;Bi<va.length;Bi+=1)if(Au(dn,va[Bi]))return!0}for(var ui=0;ui<dn.length-1;ui++)if(Wl(dn[ui],dn[ui+1],na))return!0;return!1}(a.cameraQueryGeometry,or-j,lr-j,Cr+j,Qr+j)}),ze=0,Ue=de;ze<Ue.length;ze+=1)K.push(Ue[ze]);K.sort(Vd);for(var st,Ke={},St=function(or){var lr=K[or];if(lr!==st){st=lr;var Cr=_.featureIndexArray.get(lr),Qr=null;_.loadMatchingFeature(Ke,Cr.bucketIndex,Cr.sourceLayerIndex,Cr.featureIndex,P,S.layers,S.availableImages,s,c,m,function(dn,ti,Rn){return Qr||(Qr=qa(dn)),ti.queryIntersectsFeature(D,dn,Rn,Qr,_.z,a.transform,C,a.pixelPosMatrix)})}},jt=0;jt<K.length;jt++)St(jt);return Ke},af.prototype.loadMatchingFeature=function(a,s,c,m,_,S,C,P,D,j,B){var K=this.bucketLayerIDs[s];if(!S||function(dn,ti){for(var Rn=0;Rn<dn.length;Rn++)if(ti.indexOf(dn[Rn])>=0)return!0;return!1}(S,K)){var V=this.sourceLayerCoder.decode(c),de=this.vtLayers[V].feature(m);if(_.needGeometry){var ze=io(de,!0);if(!_.filter(new Vi(this.tileID.overscaledZ),ze,this.tileID.canonical))return}else if(!_.filter(new Vi(this.tileID.overscaledZ),de))return;for(var Ue=this.getId(de,V),st=0;st<K.length;st++){var Ke=K[st];if(!(S&&S.indexOf(Ke)<0)){var St=P[Ke];if(St){var jt={};Ue!==void 0&&j&&(jt=j.getState(St.sourceLayer||"_geojsonTileLayer",Ue));var or=Ft({},D[Ke]);or.paint=Qp(or.paint,St.paint,de,jt,C),or.layout=Qp(or.layout,St.layout,de,jt,C);var lr=!B||B(de,St,jt);if(lr){var Cr=new Kp(de,this.z,this.x,this.y,Ue);Cr.layer=or;var Qr=a[Ke];Qr===void 0&&(Qr=a[Ke]=[]),Qr.push({featureIndex:m,feature:Cr,intersectionZ:lr})}}}}}},af.prototype.lookupSymbolFeatures=function(a,s,c,m,_,S,C,P){var D={};this.loadVTLayers();for(var j=Fl(_),B=0,K=a;B<K.length;B+=1)this.loadMatchingFeature(D,c,m,K[B],j,S,C,P,s);return D},af.prototype.hasLayer=function(a){for(var s=0,c=this.bucketLayerIDs;s<c.length;s+=1)for(var m=0,_=c[s];m<_.length;m+=1)if(a===_[m])return!0;return!1},af.prototype.getId=function(a,s){var c=a.id;return this.promoteId&&typeof(c=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]])=="boolean"&&(c=Number(c)),c},Dn("FeatureIndex",af,{omit:["rawTileData","sourceLayerCoder"]});var Cs=function(a,s){this.tileID=a,this.uid=qt(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Cs.prototype.registerFadeDuration=function(a){var s=a+this.timeAdded;s<vi.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)},Cs.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Cs.prototype.loadVectorData=function(a,s,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var m in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(j,B){var K={};if(!B)return K;for(var V=function(){var Ue=ze[de],st=Ue.layerIds.map(function(jt){return B.getLayer(jt)}).filter(Boolean);if(st.length!==0){Ue.layers=st,Ue.stateDependentLayerIds&&(Ue.stateDependentLayers=Ue.stateDependentLayerIds.map(function(jt){return st.filter(function(or){return or.id===jt})[0]}));for(var Ke=0,St=st;Ke<St.length;Ke+=1)K[St[Ke].id]=Ue}},de=0,ze=j;de<ze.length;de+=1)V();return K}(a.buckets,s.style),this.hasSymbolBuckets=!1,this.buckets){var _=this.buckets[m];if(_ instanceof We){if(this.hasSymbolBuckets=!0,!c)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var S in this.buckets){var C=this.buckets[S];if(C instanceof We&&C.hasRTLText){this.hasRTLText=!0,ou.isLoading()||ou.isLoaded()||Af()!=="deferred"||au();break}}for(var P in this.queryPadding=0,this.buckets){var D=this.buckets[P];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(P).queryRadius(D))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new d},Cs.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Cs.prototype.getBucket=function(a){return this.buckets[a.id]},Cs.prototype.upload=function(a){for(var s in this.buckets){var c=this.buckets[s];c.uploadPending()&&c.upload(a)}var m=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ln(a,this.imageAtlas.image,m.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ln(a,this.glyphAtlasImage,m.ALPHA),this.glyphAtlasImage=null)},Cs.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},Cs.prototype.queryRenderedFeatures=function(a,s,c,m,_,S,C,P,D,j){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:_,scale:S,tileSize:this.tileSize,pixelPosMatrix:j,transform:P,params:C,queryPadding:this.queryPadding*D},a,s,c):{}},Cs.prototype.querySourceFeatures=function(a,s){var c=this.latestFeatureIndex;if(c&&c.rawTileData){var m=c.loadVTLayers(),_=s?s.sourceLayer:"",S=m._geojsonTileLayer||m[_];if(S)for(var C=Fl(s&&s.filter),P=this.tileID.canonical,D=P.z,j=P.x,B=P.y,K={z:D,x:j,y:B},V=0;V<S.length;V++){var de=S.feature(V);if(C.needGeometry){var ze=io(de,!0);if(!C.filter(new Vi(this.tileID.overscaledZ),ze,this.tileID.canonical))continue}else if(!C.filter(new Vi(this.tileID.overscaledZ),de))continue;var Ue=c.getId(de,_),st=new Kp(de,D,j,B,Ue);st.tile=K,a.push(st)}}},Cs.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Cs.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Cs.prototype.setExpiryData=function(a){var s=this.expirationTime;if(a.cacheControl){var c=Ze(a.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var m=Date.now(),_=!1;if(this.expirationTime>m)_=!1;else if(s)if(this.expirationTime<s)_=!0;else{var S=this.expirationTime-s;S?this.expirationTime=m+Math.max(S,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Cs.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Cs.prototype.setFeatureState=function(a,s){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var c=this.latestFeatureIndex.loadVTLayers();for(var m in this.buckets)if(s.style.hasLayer(m)){var _=this.buckets[m],S=_.layers[0].sourceLayer||"_geojsonTileLayer",C=c[S],P=a[S];if(C&&P&&Object.keys(P).length!==0){_.update(P,C,this.imageAtlas&&this.imageAtlas.patternPositions||{});var D=s&&s.style&&s.style.getLayer(m);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(_)))}}}},Cs.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Cs.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<vi.now()},Cs.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Cs.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=vi.now()+a},Cs.prototype.setDependencies=function(a,s){for(var c={},m=0,_=s;m<_.length;m+=1)c[_[m]]=!0;this.dependencies[a]=c},Cs.prototype.hasDependency=function(a,s){for(var c=0,m=a;c<m.length;c+=1){var _=this.dependencies[m[c]];if(_){for(var S=0,C=s;S<C.length;S+=1)if(_[C[S]])return!0}}return!1};var Df=ye.performance,ed=function(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},Df.mark(this._marks.start)};ed.prototype.finish=function(){Df.mark(this._marks.end);var a=Df.getEntriesByName(this._marks.measure);return a.length===0&&(Df.measure(this._marks.measure,this._marks.start,this._marks.end),a=Df.getEntriesByName(this._marks.measure),Df.clearMarks(this._marks.start),Df.clearMarks(this._marks.end),Df.clearMeasures(this._marks.measure)),a},y.Actor=La,y.AlphaImage=Us,y.CanonicalTileID=ch,y.CollisionBoxArray=d,y.Color=Ji,y.DEMData=nl,y.DataConstantProperty=Qn,y.DictionaryCoder=vp,y.EXTENT=8192,y.ErrorEvent=et,y.EvaluationParameters=Vi,y.Event=Be,y.Evented=dt,y.FeatureIndex=af,y.FillBucket=W,y.FillExtrusionBucket=bl,y.ImageAtlas=Vr,y.ImagePosition=Tt,y.LineBucket=Ta,y.LngLat=_a,y.LngLatBounds=Ba,y.MercatorCoordinate=kc,y.ONE_EM=24,y.OverscaledTileID=ls,y.Point=se,y.Point$1=se,y.Properties=is,y.Protobuf=js,y.RGBAImage=Go,y.RequestManager=Gi,y.RequestPerformance=ed,y.ResourceType=an,y.SegmentVector=xe,y.SourceFeatureState=Dh,y.StructArrayLayout1ui2=xc,y.StructArrayLayout2f1f2i16=yc,y.StructArrayLayout2i4=Gl,y.StructArrayLayout3ui6=qu,y.StructArrayLayout4i8=Ks,y.SymbolBucket=We,y.Texture=Ln,y.Tile=Cs,y.Transitionable=qo,y.Uniform1f=on,y.Uniform1i=Or,y.Uniform2f=jr,y.Uniform3f=Cn,y.Uniform4f=ni,y.UniformColor=ii,y.UniformMatrix4f=ta,y.UnwrappedTileID=Uv,y.ValidationError=Ge,y.WritingMode=un,y.ZoomHistory=Qf,y.add=function(a,s,c){return a[0]=s[0]+c[0],a[1]=s[1]+c[1],a[2]=s[2]+c[2],a},y.addDynamicAttributes=tt,y.asyncAll=function(a,s,c){if(!a.length)return c(null,[]);var m=a.length,_=new Array(a.length),S=null;a.forEach(function(C,P){s(C,function(D,j){D&&(S=D),_[P]=j,--m==0&&c(S,_)})})},y.bezier=ct,y.bindAll=br,y.browser=vi,y.cacheEntryPossiblyAdded=function(a){++Yn>pr&&(a.getActor().send("enforceCacheSizeLimit",Pt),Yn=0)},y.clamp=Ot,y.clearTileCache=function(a){var s=ye.caches.delete("mapbox-tiles");a&&s.catch(a).then(function(){return a()})},y.clipLine=Ho,y.clone=function(a){var s=new pa(16);return s[0]=a[0],s[1]=a[1],s[2]=a[2],s[3]=a[3],s[4]=a[4],s[5]=a[5],s[6]=a[6],s[7]=a[7],s[8]=a[8],s[9]=a[9],s[10]=a[10],s[11]=a[11],s[12]=a[12],s[13]=a[13],s[14]=a[14],s[15]=a[15],s},y.clone$1=pt,y.clone$2=function(a){var s=new pa(3);return s[0]=a[0],s[1]=a[1],s[2]=a[2],s},y.collisionCircleLayout=Oh,y.config=Vn,y.create=function(){var a=new pa(16);return pa!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},y.create$1=function(){var a=new pa(9);return pa!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},y.create$2=function(){var a=new pa(4);return pa!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},y.createCommonjsModule=Ie,y.createExpression=Ll,y.createLayout=Ga,y.createStyleLayer=function(a){return a.type==="custom"?new cn(a):new Sn[a.type](a)},y.cross=function(a,s,c){var m=s[0],_=s[1],S=s[2],C=c[0],P=c[1],D=c[2];return a[0]=_*D-S*P,a[1]=S*C-m*D,a[2]=m*P-_*C,a},y.deepEqual=function a(s,c){if(Array.isArray(s)){if(!Array.isArray(c)||s.length!==c.length)return!1;for(var m=0;m<s.length;m++)if(!a(s[m],c[m]))return!1;return!0}if(typeof s=="object"&&s!==null&&c!==null){if(typeof c!="object"||Object.keys(s).length!==Object.keys(c).length)return!1;for(var _ in s)if(!a(s[_],c[_]))return!1;return!0}return s===c},y.dot=function(a,s){return a[0]*s[0]+a[1]*s[1]+a[2]*s[2]},y.dot$1=function(a,s){return a[0]*s[0]+a[1]*s[1]+a[2]*s[2]+a[3]*s[3]},y.ease=bt,y.emitValidationErrors=zl,y.endsWith=J,y.enforceCacheSizeLimit=function(a){Pr(),ie&&ie.then(function(s){s.keys().then(function(c){for(var m=0;m<c.length-a;m++)s.delete(c[m])})})},y.evaluateSizeForFeature=hi,y.evaluateSizeForZoom=Mi,y.evaluateVariableOffset=Sl,y.evented=Jf,y.extend=Ft,y.featureFilter=Fl,y.filterObject=Ct,y.fromRotation=function(a,s){var c=Math.sin(s),m=Math.cos(s);return a[0]=m,a[1]=c,a[2]=0,a[3]=-c,a[4]=m,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},y.getAnchorAlignment=_n,y.getAnchorJustification=Ne,y.getArrayBuffer=Ea,y.getImage=re,y.getJSON=function(a,s){return Ua(Ft(a,{type:"json"}),s)},y.getRTLTextPluginStatus=Af,y.getReferrer=ci,y.getVideo=function(a,s){var c,m,_=ye.document.createElement("video");_.muted=!0,_.onloadstart=function(){s(null,_)};for(var S=0;S<a.length;S++){var C=ye.document.createElement("source");c=a[S],m=void 0,(m=ye.document.createElement("a")).href=c,(m.protocol!==ye.document.location.protocol||m.host!==ye.document.location.host)&&(_.crossOrigin="Anonymous"),C.src=a[S],_.appendChild(C)}return{cancel:function(){}}},y.identity=Qs,y.invert=function(a,s){var c=s[0],m=s[1],_=s[2],S=s[3],C=s[4],P=s[5],D=s[6],j=s[7],B=s[8],K=s[9],V=s[10],de=s[11],ze=s[12],Ue=s[13],st=s[14],Ke=s[15],St=c*P-m*C,jt=c*D-_*C,or=c*j-S*C,lr=m*D-_*P,Cr=m*j-S*P,Qr=_*j-S*D,dn=B*Ue-K*ze,ti=B*st-V*ze,Rn=B*Ke-de*ze,si=K*st-V*Ue,On=K*Ke-de*Ue,ji=V*Ke-de*st,bi=St*ji-jt*On+or*si+lr*Rn-Cr*ti+Qr*dn;return bi?(a[0]=(P*ji-D*On+j*si)*(bi=1/bi),a[1]=(_*On-m*ji-S*si)*bi,a[2]=(Ue*Qr-st*Cr+Ke*lr)*bi,a[3]=(V*Cr-K*Qr-de*lr)*bi,a[4]=(D*Rn-C*ji-j*ti)*bi,a[5]=(c*ji-_*Rn+S*ti)*bi,a[6]=(st*or-ze*Qr-Ke*jt)*bi,a[7]=(B*Qr-V*or+de*jt)*bi,a[8]=(C*On-P*Rn+j*dn)*bi,a[9]=(m*Rn-c*On-S*dn)*bi,a[10]=(ze*Cr-Ue*or+Ke*St)*bi,a[11]=(K*or-B*Cr-de*St)*bi,a[12]=(P*ti-C*si-D*dn)*bi,a[13]=(c*si-m*ti+_*dn)*bi,a[14]=(Ue*jt-ze*lr-st*St)*bi,a[15]=(B*lr-K*jt+V*St)*bi,a):null},y.isChar=vn,y.isMapboxURL=Si,y.keysDifference=function(a,s){var c=[];for(var m in a)m in s||c.push(m);return c},y.makeRequest=Ua,y.mapObject=Et,y.mercatorXfromLng=rl,y.mercatorYfromLat=Mu,y.mercatorZfromAltitude=pp,y.mul=Xl,y.multiply=as,y.mvt=Js,y.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},y.normalize=function(a,s){var c=s[0],m=s[1],_=s[2],S=c*c+m*m+_*_;return S>0&&(S=1/Math.sqrt(S)),a[0]=s[0]*S,a[1]=s[1]*S,a[2]=s[2]*S,a},y.number=ya,y.offscreenCanvasSupported=jn,y.ortho=function(a,s,c,m,_,S,C){var P=1/(s-c),D=1/(m-_),j=1/(S-C);return a[0]=-2*P,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*D,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(s+c)*P,a[13]=(_+m)*D,a[14]=(C+S)*j,a[15]=1,a},y.parseGlyphPBF=function(a){return new js(a).readFields(qr,[])},y.pbf=js,y.performSymbolLayout=function(a,s,c,m,_,S,C){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var P=a.layers[0].layout,D=a.layers[0]._unevaluatedLayout._values,j={};if(a.textSizeData.kind==="composite"){var B=a.textSizeData,K=B.maxZoom;j.compositeTextSizes=[D["text-size"].possiblyEvaluate(new Vi(B.minZoom),C),D["text-size"].possiblyEvaluate(new Vi(K),C)]}if(a.iconSizeData.kind==="composite"){var V=a.iconSizeData,de=V.maxZoom;j.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new Vi(V.minZoom),C),D["icon-size"].possiblyEvaluate(new Vi(de),C)]}j.layoutTextSize=D["text-size"].possiblyEvaluate(new Vi(a.zoom+1),C),j.layoutIconSize=D["icon-size"].possiblyEvaluate(new Vi(a.zoom+1),C),j.textMaxSize=D["text-size"].possiblyEvaluate(new Vi(18));for(var ze=24*P.get("text-line-height"),Ue=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",st=P.get("text-keep-upright"),Ke=P.get("text-size"),St=function(){var lr=or[jt],Cr=P.get("text-font").evaluate(lr,{},C).join(","),Qr=Ke.evaluate(lr,{},C),dn=j.layoutTextSize.evaluate(lr,{},C),ti=j.layoutIconSize.evaluate(lr,{},C),Rn={horizontal:{},vertical:void 0},si=lr.text,On=[0,0];if(si){var ji=si.toString(),bi=24*P.get("text-letter-spacing").evaluate(lr,{},C),Kn=function(ua){for(var Ka=0,Na=ua;Ka<Na.length;Ka+=1)if(la=Na[Ka].charCodeAt(0),vn.Arabic(la)||vn["Arabic Supplement"](la)||vn["Arabic Extended-A"](la)||vn["Arabic Presentation Forms-A"](la)||vn["Arabic Presentation Forms-B"](la))return!1;var la;return!0}(ji)?bi:0,na=P.get("text-anchor").evaluate(lr,{},C),Bi=P.get("text-variable-anchor");if(!Bi){var va=P.get("text-radial-offset").evaluate(lr,{},C);On=va?Sl(na,[24*va,zo]):P.get("text-offset").evaluate(lr,{},C).map(function(ua){return 24*ua})}var ui=Ue?"center":P.get("text-justify").evaluate(lr,{},C),Aa=P.get("symbol-placement"),ho=Aa==="point"?24*P.get("text-max-width").evaluate(lr,{},C):0,Zo=function(){a.allowVerticalPlacement&&jc(ji)&&(Rn.vertical=yn(si,s,c,_,Cr,ho,ze,na,"left",Kn,On,un.vertical,!0,Aa,dn,Qr))};if(!Ue&&Bi){for(var So=ui==="auto"?Bi.map(function(ua){return Ne(ua)}):[ui],yo=!1,Xo=0;Xo<So.length;Xo++){var gs=So[Xo];if(!Rn.horizontal[gs])if(yo)Rn.horizontal[gs]=Rn.horizontal[0];else{var cs=yn(si,s,c,_,Cr,ho,ze,"center",gs,Kn,On,un.horizontal,!1,Aa,dn,Qr);cs&&(Rn.horizontal[gs]=cs,yo=cs.positionedLines.length===1)}}Zo()}else{ui==="auto"&&(ui=Ne(na));var Hs=yn(si,s,c,_,Cr,ho,ze,na,ui,Kn,On,un.horizontal,!1,Aa,dn,Qr);Hs&&(Rn.horizontal[ui]=Hs),Zo(),jc(ji)&&Ue&&st&&(Rn.vertical=yn(si,s,c,_,Cr,ho,ze,na,ui,Kn,On,un.vertical,!1,Aa,dn,Qr))}}var As=void 0,Ws=!1;if(lr.icon&&lr.icon.name){var Uo=m[lr.icon.name];Uo&&(As=function(ua,Ka,Na){var la=_n(Na),pu=Ka[0]-ua.displaySize[0]*la.horizontalAlign,Ki=Ka[1]-ua.displaySize[1]*la.verticalAlign;return{image:ua,top:Ki,bottom:Ki+ua.displaySize[1],left:pu,right:pu+ua.displaySize[0]}}(_[lr.icon.name],P.get("icon-offset").evaluate(lr,{},C),P.get("icon-anchor").evaluate(lr,{},C)),Ws=Uo.sdf,a.sdfIcons===void 0?a.sdfIcons=Uo.sdf:a.sdfIcons!==Uo.sdf&&vt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Uo.pixelRatio!==a.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var Ts=Vt(Rn.horizontal)||Rn.vertical;a.iconsInText=!!Ts&&Ts.iconsInText,(Ts||As)&&function(ua,Ka,Na,la,pu,Ki,Oa,Jo,Xs,ba,Ic){var Iu=Ki.textMaxSize.evaluate(Ka,{});Iu===void 0&&(Iu=Oa);var Pc,wo=ua.layers[0].layout,Rc=wo.get("icon-offset").evaluate(Ka,{},Ic),Cl=Vt(Na.horizontal),Pu=Oa/24,tc=ua.tilePixelRatio*Pu,Lc=ua.tilePixelRatio*Iu/24,of=ua.tilePixelRatio*Jo,sf=ua.tilePixelRatio*wo.get("symbol-spacing"),Bh=wo.get("text-padding")*ua.tilePixelRatio,Bf=wo.get("icon-padding")*ua.tilePixelRatio,Nh=wo.get("text-max-angle")/180*Math.PI,td=wo.get("text-rotation-alignment")==="map"&&wo.get("symbol-placement")!=="point",rd=wo.get("icon-rotation-alignment")==="map"&&wo.get("symbol-placement")!=="point",uf=wo.get("symbol-placement"),gp=sf/2,zh=wo.get("icon-text-fit");la&&zh!=="none"&&(ua.allowVerticalPlacement&&Na.vertical&&(Pc=Ei(la,Na.vertical,zh,wo.get("icon-text-fit-padding"),Rc,Pu)),Cl&&(la=Ei(la,Cl,zh,wo.get("icon-text-fit-padding"),Rc,Pu)));var lf=function(q0,Ap){Ap.x<0||Ap.x>=8192||Ap.y<0||Ap.y>=8192||function(Mo,rc,K0,cf,od,jv,Al,nc,Tp,Mp,sd,kp,Xd,Gv,Gh,$d,Hv,Yd,qd,Wv,Vu,ud,Kd,ic,Q0){var Xv,ph,ia,Qi,dh,Ip=Mo.addToLineVertexArray(rc,K0),$v=0,J0=0,em=0,tm=0,Yv=-1,qv=-1,Nf={},rm=Fe(""),Kv=0,Qv=0;if(nc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Kv=(Xv=nc.layout.get("text-offset").evaluate(Vu,{},ic).map(function(cd){return 24*cd}))[0],Qv=Xv[1]):(Kv=24*nc.layout.get("text-radial-offset").evaluate(Vu,{},ic),Qv=zo),Mo.allowVerticalPlacement&&cf.vertical){var nm=nc.layout.get("text-rotate").evaluate(Vu,{},ic)+90;Qi=new Wo(Tp,rc,Mp,sd,kp,cf.vertical,Xd,Gv,Gh,nm),Al&&(dh=new Wo(Tp,rc,Mp,sd,kp,Al,Hv,Yd,Gh,nm))}if(od){var Jv=nc.layout.get("icon-rotate").evaluate(Vu,{}),e0=nc.layout.get("icon-text-fit")!=="none",im=us(od,Jv,Kd,e0),t0=Al?us(Al,Jv,Kd,e0):void 0;ia=new Wo(Tp,rc,Mp,sd,kp,od,Hv,Yd,!1,Jv),$v=4*im.length;var am=Mo.iconSizeData,ld=null;am.kind==="source"?(ld=[128*nc.layout.get("icon-size").evaluate(Vu,{})])[0]>32640&&vt(Mo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):am.kind==="composite"&&((ld=[128*ud.compositeIconSizes[0].evaluate(Vu,{},ic),128*ud.compositeIconSizes[1].evaluate(Vu,{},ic)])[0]>32640||ld[1]>32640)&&vt(Mo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Mo.addSymbols(Mo.icon,im,ld,Wv,qd,Vu,!1,rc,Ip.lineStartIndex,Ip.lineLength,-1,ic),Yv=Mo.icon.placedSymbolArray.length-1,t0&&(J0=4*t0.length,Mo.addSymbols(Mo.icon,t0,ld,Wv,qd,Vu,un.vertical,rc,Ip.lineStartIndex,Ip.lineLength,-1,ic),qv=Mo.icon.placedSymbolArray.length-1)}for(var om in cf.horizontal){var Qd=cf.horizontal[om];if(!ph){rm=Fe(Qd.text);var Tg=nc.layout.get("text-rotate").evaluate(Vu,{},ic);ph=new Wo(Tp,rc,Mp,sd,kp,Qd,Xd,Gv,Gh,Tg)}var sm=Qd.positionedLines.length===1;if(em+=nr(Mo,rc,Qd,jv,nc,Gh,Vu,$d,Ip,cf.vertical?un.horizontal:un.horizontalOnly,sm?Object.keys(cf.horizontal):[om],Nf,Yv,ud,ic),sm)break}cf.vertical&&(tm+=nr(Mo,rc,cf.vertical,jv,nc,Gh,Vu,$d,Ip,un.vertical,["vertical"],Nf,qv,ud,ic));var Mg=ph?ph.boxStartIndex:Mo.collisionBoxArray.length,kg=ph?ph.boxEndIndex:Mo.collisionBoxArray.length,Ig=Qi?Qi.boxStartIndex:Mo.collisionBoxArray.length,Pg=Qi?Qi.boxEndIndex:Mo.collisionBoxArray.length,Jd=ia?ia.boxStartIndex:Mo.collisionBoxArray.length,Rg=ia?ia.boxEndIndex:Mo.collisionBoxArray.length,Lg=dh?dh.boxStartIndex:Mo.collisionBoxArray.length,Og=dh?dh.boxEndIndex:Mo.collisionBoxArray.length,ff=-1,ev=function(cd,lm){return cd&&cd.circleDiameter?Math.max(cd.circleDiameter,lm):lm};ff=ev(ph,ff),ff=ev(Qi,ff),ff=ev(ia,ff);var um=(ff=ev(dh,ff))>-1?1:0;um&&(ff*=Q0/24),Mo.glyphOffsetArray.length>=We.MAX_GLYPHS&&vt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Vu.sortKey!==void 0&&Mo.addToSortKeyRanges(Mo.symbolInstances.length,Vu.sortKey),Mo.symbolInstances.emplaceBack(rc.x,rc.y,Nf.right>=0?Nf.right:-1,Nf.center>=0?Nf.center:-1,Nf.left>=0?Nf.left:-1,Nf.vertical||-1,Yv,qv,rm,Mg,kg,Ig,Pg,Jd,Rg,Lg,Og,Mp,em,tm,$v,J0,um,0,Xd,Kv,Qv,ff)}(ua,Ap,q0,Na,la,pu,Pc,ua.layers[0],ua.collisionBoxArray,Ka.index,Ka.sourceLayerIndex,ua.index,tc,Bh,td,Xs,of,Bf,rd,Rc,Ka,Ki,ba,Ic,Oa)};if(uf==="line")for(var Zh=0,nd=Ho(Ka.geometry,0,0,8192,8192);Zh<nd.length;Zh+=1)for(var yp=nd[Zh],_p=0,xp=ss(yp,sf,Nh,Na.vertical||Cl,la,24,Lc,ua.overscaling,8192);_p<xp.length;_p+=1){var id=xp[_p];Cl&&Mn(ua,Cl.text,gp,id)||lf(yp,id)}else if(uf==="line-center")for(var bp=0,Ep=Ka.geometry;bp<Ep.length;bp+=1){var Uh=Ep[bp];if(Uh.length>1){var Sp=ao(Uh,Nh,Na.vertical||Cl,la,24,Lc);Sp&&lf(Uh,Sp)}}else if(Ka.type==="Polygon")for(var Vh=0,ad=ef(Ka.geometry,0);Vh<ad.length;Vh+=1){var fh=ad[Vh],wp=xi(fh,16);lf(fh[0],new pn(wp.x,wp.y,0))}else if(Ka.type==="LineString")for(var hh=0,Cp=Ka.geometry;hh<Cp.length;hh+=1){var jh=Cp[hh];lf(jh,new pn(jh[0].x,jh[0].y,0))}else if(Ka.type==="Point")for(var jd=0,Vv=Ka.geometry;jd<Vv.length;jd+=1)for(var Gd=0,Hd=Vv[jd];Gd<Hd.length;Gd+=1){var Wd=Hd[Gd];lf([Wd],new pn(Wd.x,Wd.y,0))}}(a,lr,Rn,As,m,j,dn,ti,On,Ws,C)},jt=0,or=a.features;jt<or.length;jt+=1)St();S&&a.generateCollisionDebugBuffers()},y.perspective=function(a,s,c,m,_){var S,C=1/Math.tan(s/2);return a[0]=C/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=C,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,_!=null&&_!==1/0?(a[10]=(_+m)*(S=1/(m-_)),a[14]=2*_*m*S):(a[10]=-1,a[14]=-2*m),a},y.pick=function(a,s){for(var c={},m=0;m<s.length;m++){var _=s[m];_ in a&&(c[_]=a[_])}return c},y.plugin=ou,y.polygonIntersectsPolygon=Wt,y.postMapLoadEvent=Ye,y.postTurnstileEvent=Qt,y.potpack=Kr,y.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],y.register=Dn,y.registerForPluginStateChange=function(a){return a({pluginStatus:zs,pluginURL:Su}),Jf.on("pluginStateChange",a),a},y.renderColorRamp=th,y.rotate=function(a,s,c){var m=s[0],_=s[1],S=s[2],C=s[3],P=Math.sin(c),D=Math.cos(c);return a[0]=m*D+S*P,a[1]=_*D+C*P,a[2]=m*-P+S*D,a[3]=_*-P+C*D,a},y.rotateX=function(a,s,c){var m=Math.sin(c),_=Math.cos(c),S=s[4],C=s[5],P=s[6],D=s[7],j=s[8],B=s[9],K=s[10],V=s[11];return s!==a&&(a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=s[3],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[4]=S*_+j*m,a[5]=C*_+B*m,a[6]=P*_+K*m,a[7]=D*_+V*m,a[8]=j*_-S*m,a[9]=B*_-C*m,a[10]=K*_-P*m,a[11]=V*_-D*m,a},y.rotateZ=function(a,s,c){var m=Math.sin(c),_=Math.cos(c),S=s[0],C=s[1],P=s[2],D=s[3],j=s[4],B=s[5],K=s[6],V=s[7];return s!==a&&(a[8]=s[8],a[9]=s[9],a[10]=s[10],a[11]=s[11],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[0]=S*_+j*m,a[1]=C*_+B*m,a[2]=P*_+K*m,a[3]=D*_+V*m,a[4]=j*_-S*m,a[5]=B*_-C*m,a[6]=K*_-P*m,a[7]=V*_-D*m,a},y.scale=function(a,s,c){var m=c[0],_=c[1],S=c[2];return a[0]=s[0]*m,a[1]=s[1]*m,a[2]=s[2]*m,a[3]=s[3]*m,a[4]=s[4]*_,a[5]=s[5]*_,a[6]=s[6]*_,a[7]=s[7]*_,a[8]=s[8]*S,a[9]=s[9]*S,a[10]=s[10]*S,a[11]=s[11]*S,a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15],a},y.scale$1=function(a,s,c){return a[0]=s[0]*c,a[1]=s[1]*c,a[2]=s[2]*c,a[3]=s[3]*c,a},y.scale$2=function(a,s,c){return a[0]=s[0]*c,a[1]=s[1]*c,a[2]=s[2]*c,a},y.setCacheLimits=function(a,s){Pt=a,pr=s},y.setRTLTextPlugin=function(a,s,c){if(c===void 0&&(c=!1),zs==="deferred"||zs==="loading"||zs==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Su=vi.resolveURL(a),zs="deferred",Ps=s,Cf(),c||au()},y.sphericalToCartesian=function(a){var s=a[0],c=a[1],m=a[2];return c+=90,c*=Math.PI/180,m*=Math.PI/180,{x:s*Math.cos(c)*Math.sin(m),y:s*Math.sin(c)*Math.sin(m),z:s*Math.cos(m)}},y.sqrLen=function(a){var s=a[0],c=a[1];return s*s+c*c},y.styleSpec=me,y.sub=function(a,s,c){return a[0]=s[0]-c[0],a[1]=s[1]-c[1],a[2]=s[2]-c[2],a},y.symbolSize=$i,y.transformMat3=function(a,s,c){var m=s[0],_=s[1],S=s[2];return a[0]=m*c[0]+_*c[3]+S*c[6],a[1]=m*c[1]+_*c[4]+S*c[7],a[2]=m*c[2]+_*c[5]+S*c[8],a},y.transformMat4=Xc,y.translate=function(a,s,c){var m,_,S,C,P,D,j,B,K,V,de,ze,Ue=c[0],st=c[1],Ke=c[2];return s===a?(a[12]=s[0]*Ue+s[4]*st+s[8]*Ke+s[12],a[13]=s[1]*Ue+s[5]*st+s[9]*Ke+s[13],a[14]=s[2]*Ue+s[6]*st+s[10]*Ke+s[14],a[15]=s[3]*Ue+s[7]*st+s[11]*Ke+s[15]):(_=s[1],S=s[2],C=s[3],P=s[4],D=s[5],j=s[6],B=s[7],K=s[8],V=s[9],de=s[10],ze=s[11],a[0]=m=s[0],a[1]=_,a[2]=S,a[3]=C,a[4]=P,a[5]=D,a[6]=j,a[7]=B,a[8]=K,a[9]=V,a[10]=de,a[11]=ze,a[12]=m*Ue+P*st+K*Ke+s[12],a[13]=_*Ue+D*st+V*Ke+s[13],a[14]=S*Ue+j*st+de*Ke+s[14],a[15]=C*Ue+B*st+ze*Ke+s[15]),a},y.triggerPluginCompletionEvent=wf,y.uniqueId=qt,y.validateCustomStyleLayer=function(a){var s=[],c=a.id;return c===void 0&&s.push({message:"layers."+c+': missing required property "id"'}),a.render===void 0&&s.push({message:"layers."+c+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&s.push({message:"layers."+c+': property "renderingMode" must be either "2d" or "3d"'}),s},y.validateLight=rp,y.validateStyle=bf,y.values=function(a){var s=[];for(var c in a)s.push(a[c]);return s},y.vectorTile=Js,y.version="1.13.3",y.warnOnce=vt,y.webpSupported=Xn,y.window=ye,y.wrap=vr}),Te(["./shared"],function(y){"use strict";function Ie(q){var re=typeof q;if(re==="number"||re==="boolean"||re==="string"||q==null)return JSON.stringify(q);if(Array.isArray(q)){for(var le="[",Ce=0,Be=q;Ce<Be.length;Ce+=1)le+=Ie(Be[Ce])+",";return le+"]"}for(var et=Object.keys(q).sort(),dt="{",me=0;me<et.length;me++)dt+=JSON.stringify(et[me])+":"+Ie(q[et[me]])+",";return dt+"}"}function X(q){for(var re="",le=0,Ce=y.refProperties;le<Ce.length;le+=1)re+="/"+Ie(q[Ce[le]]);return re}var Se=function(q){this.keyCache={},q&&this.replace(q)};Se.prototype.replace=function(q){this._layerConfigs={},this._layers={},this.update(q,[])},Se.prototype.update=function(q,re){for(var le=this,Ce=0,Be=q;Ce<Be.length;Ce+=1){var et=Be[Ce];this._layerConfigs[et.id]=et;var dt=this._layers[et.id]=y.createStyleLayer(et);dt._featureFilter=y.featureFilter(dt.filter),this.keyCache[et.id]&&delete this.keyCache[et.id]}for(var me=0,Ge=re;me<Ge.length;me+=1){var Dt=Ge[me];delete this.keyCache[Dt],delete this._layerConfigs[Dt],delete this._layers[Dt]}this.familiesBySource={};for(var Lr=0,er=function(fn,gn){for(var Ii={},xn=0;xn<fn.length;xn++){var Ni=gn&&gn[fn[xn].id]||X(fn[xn]);gn&&(gn[fn[xn].id]=Ni);var sa=Ii[Ni];sa||(sa=Ii[Ni]=[]),sa.push(fn[xn])}var Oi=[];for(var Zi in Ii)Oi.push(Ii[Zi]);return Oi}(y.values(this._layerConfigs),this.keyCache);Lr<er.length;Lr+=1){var tr=er[Lr].map(function(fn){return le._layers[fn.id]}),Fr=tr[0];if(Fr.visibility!=="none"){var In=Fr.source||"",Pn=this.familiesBySource[In];Pn||(Pn=this.familiesBySource[In]={});var $t=Fr.sourceLayer||"_geojsonTileLayer",wn=Pn[$t];wn||(wn=Pn[$t]=[]),wn.push(tr)}}};var se=function(q){var re={},le=[];for(var Ce in q){var Be=q[Ce],et=re[Ce]={};for(var dt in Be){var me=Be[+dt];if(me&&me.bitmap.width!==0&&me.bitmap.height!==0){var Ge={x:0,y:0,w:me.bitmap.width+2,h:me.bitmap.height+2};le.push(Ge),et[dt]={rect:Ge,metrics:me.metrics}}}}var Dt=y.potpack(le),Lr=new y.AlphaImage({width:Dt.w||1,height:Dt.h||1});for(var er in q){var tr=q[er];for(var Fr in tr){var In=tr[+Fr];if(In&&In.bitmap.width!==0&&In.bitmap.height!==0){var Pn=re[er][Fr].rect;y.AlphaImage.copy(In.bitmap,Lr,{x:0,y:0},{x:Pn.x+1,y:Pn.y+1},In.bitmap)}}}this.image=Lr,this.positions=re};y.register("GlyphAtlas",se);var rt=function(q){this.tileID=new y.OverscaledTileID(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.uid=q.uid,this.zoom=q.zoom,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=q.showCollisionBoxes,this.collectResourceTiming=!!q.collectResourceTiming,this.returnDependencies=!!q.returnDependencies,this.promoteId=q.promoteId};function ye(q,re,le){for(var Ce=new y.EvaluationParameters(re),Be=0,et=q;Be<et.length;Be+=1)et[Be].recalculate(Ce,le)}function ot(q,re){var le=y.getArrayBuffer(q.request,function(Ce,Be,et,dt){Ce?re(Ce):Be&&re(null,{vectorTile:new y.vectorTile.VectorTile(new y.pbf(Be)),rawData:Be,cacheControl:et,expires:dt})});return function(){le.cancel(),re()}}rt.prototype.parse=function(q,re,le,Ce,Be){var et=this;this.status="parsing",this.data=q,this.collisionBoxArray=new y.CollisionBoxArray;var dt=new y.DictionaryCoder(Object.keys(q.layers).sort()),me=new y.FeatureIndex(this.tileID,this.promoteId);me.bucketLayerIDs=[];var Ge,Dt,Lr,er,tr={},Fr={featureIndex:me,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:le},In=re.familiesBySource[this.source];for(var Pn in In){var $t=q.layers[Pn];if($t){$t.version===1&&y.warnOnce('Vector tile source "'+this.source+'" layer "'+Pn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var wn=dt.encode(Pn),fn=[],gn=0;gn<$t.length;gn++){var Ii=$t.feature(gn),xn=me.getId(Ii,Pn);fn.push({feature:Ii,id:xn,index:gn,sourceLayerIndex:wn})}for(var Ni=0,sa=In[Pn];Ni<sa.length;Ni+=1){var Oi=sa[Ni],Zi=Oi[0];Zi.minzoom&&this.zoom<Math.floor(Zi.minzoom)||Zi.maxzoom&&this.zoom>=Zi.maxzoom||Zi.visibility!=="none"&&(ye(Oi,this.zoom,le),(tr[Zi.id]=Zi.createBucket({index:me.bucketLayerIDs.length,layers:Oi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:wn,sourceID:this.source})).populate(fn,Fr,this.tileID.canonical),me.bucketLayerIDs.push(Oi.map(function(ga){return ga.id})))}}}var Fi=y.mapObject(Fr.glyphDependencies,function(ga){return Object.keys(ga).map(Number)});Object.keys(Fi).length?Ce.send("getGlyphs",{uid:this.uid,stacks:Fi},function(ga,zi){Ge||(Ge=ga,Dt=zi,Xa.call(et))}):Dt={};var yi=Object.keys(Fr.iconDependencies);yi.length?Ce.send("getImages",{icons:yi,source:this.source,tileID:this.tileID,type:"icons"},function(ga,zi){Ge||(Ge=ga,Lr=zi,Xa.call(et))}):Lr={};var ha=Object.keys(Fr.patternDependencies);function Xa(){if(Ge)return Be(Ge);if(Dt&&Lr&&er){var ga=new se(Dt),zi=new y.ImageAtlas(Lr,er);for(var Ji in tr){var Va=tr[Ji];Va instanceof y.SymbolBucket?(ye(Va.layers,this.zoom,le),y.performSymbolLayout(Va,Dt,ga.positions,Lr,zi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Va.hasPattern&&(Va instanceof y.LineBucket||Va instanceof y.FillBucket||Va instanceof y.FillExtrusionBucket)&&(ye(Va.layers,this.zoom,le),Va.addFeatures(Fr,this.tileID.canonical,zi.patternPositions))}this.status="done",Be(null,{buckets:y.values(tr).filter(function(tu){return!tu.isEmpty()}),featureIndex:me,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ga.image,imageAtlas:zi,glyphMap:this.returnDependencies?Dt:null,iconMap:this.returnDependencies?Lr:null,glyphPositions:this.returnDependencies?ga.positions:null})}}ha.length?Ce.send("getImages",{icons:ha,source:this.source,tileID:this.tileID,type:"patterns"},function(ga,zi){Ge||(Ge=ga,er=zi,Xa.call(et))}):er={},Xa.call(this)};var ct=function(q,re,le,Ce){this.actor=q,this.layerIndex=re,this.availableImages=le,this.loadVectorData=Ce||ot,this.loading={},this.loaded={}};ct.prototype.loadTile=function(q,re){var le=this,Ce=q.uid;this.loading||(this.loading={});var Be=!!(q&&q.request&&q.request.collectResourceTiming)&&new y.RequestPerformance(q.request),et=this.loading[Ce]=new rt(q);et.abort=this.loadVectorData(q,function(dt,me){if(delete le.loading[Ce],dt||!me)return et.status="done",le.loaded[Ce]=et,re(dt);var Ge=me.rawData,Dt={};me.expires&&(Dt.expires=me.expires),me.cacheControl&&(Dt.cacheControl=me.cacheControl);var Lr={};if(Be){var er=Be.finish();er&&(Lr.resourceTiming=JSON.parse(JSON.stringify(er)))}et.vectorTile=me.vectorTile,et.parse(me.vectorTile,le.layerIndex,le.availableImages,le.actor,function(tr,Fr){if(tr||!Fr)return re(tr);re(null,y.extend({rawTileData:Ge.slice(0)},Fr,Dt,Lr))}),le.loaded=le.loaded||{},le.loaded[Ce]=et})},ct.prototype.reloadTile=function(q,re){var le=this,Ce=this.loaded,Be=q.uid,et=this;if(Ce&&Ce[Be]){var dt=Ce[Be];dt.showCollisionBoxes=q.showCollisionBoxes;var me=function(Ge,Dt){var Lr=dt.reloadCallback;Lr&&(delete dt.reloadCallback,dt.parse(dt.vectorTile,et.layerIndex,le.availableImages,et.actor,Lr)),re(Ge,Dt)};dt.status==="parsing"?dt.reloadCallback=me:dt.status==="done"&&(dt.vectorTile?dt.parse(dt.vectorTile,this.layerIndex,this.availableImages,this.actor,me):me())}},ct.prototype.abortTile=function(q,re){var le=this.loading,Ce=q.uid;le&&le[Ce]&&le[Ce].abort&&(le[Ce].abort(),delete le[Ce]),re()},ct.prototype.removeTile=function(q,re){var le=this.loaded,Ce=q.uid;le&&le[Ce]&&delete le[Ce],re()};var bt=y.window.ImageBitmap,Ot=function(){this.loaded={}};function vr(q,re){if(q.length!==0){Ft(q[0],re);for(var le=1;le<q.length;le++)Ft(q[le],!re)}}function Ft(q,re){for(var le=0,Ce=0,Be=0,et=q.length,dt=et-1;Be<et;dt=Be++){var me=(q[Be][0]-q[dt][0])*(q[dt][1]+q[Be][1]),Ge=le+me;Ce+=Math.abs(le)>=Math.abs(me)?le-Ge+me:me-Ge+le,le=Ge}le+Ce>=0!=!!re&&q.reverse()}Ot.prototype.loadTile=function(q,re){var le=q.uid,Ce=q.encoding,Be=q.rawImageData,et=bt&&Be instanceof bt?this.getImageData(Be):Be,dt=new y.DEMData(le,et,Ce);this.loaded=this.loaded||{},this.loaded[le]=dt,re(null,dt)},Ot.prototype.getImageData=function(q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(q.width,q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=q.width,this.offscreenCanvas.height=q.height,this.offscreenCanvasContext.drawImage(q,0,0,q.width,q.height);var re=this.offscreenCanvasContext.getImageData(-1,-1,q.width+2,q.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new y.RGBAImage({width:re.width,height:re.height},re.data)},Ot.prototype.removeTile=function(q){var re=this.loaded,le=q.uid;re&&re[le]&&delete re[le]};var gr=y.vectorTile.VectorTileFeature.prototype.toGeoJSON,qt=function(q){this._feature=q,this.extent=y.EXTENT,this.type=q.type,this.properties=q.tags,"id"in q&&!isNaN(q.id)&&(this.id=parseInt(q.id,10))};qt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var q=[],re=0,le=this._feature.geometry;re<le.length;re+=1){var Ce=le[re];q.push([new y.Point$1(Ce[0],Ce[1])])}return q}for(var Be=[],et=0,dt=this._feature.geometry;et<dt.length;et+=1){for(var me=[],Ge=0,Dt=dt[et];Ge<Dt.length;Ge+=1){var Lr=Dt[Ge];me.push(new y.Point$1(Lr[0],Lr[1]))}Be.push(me)}return Be},qt.prototype.toGeoJSON=function(q,re,le){return gr.call(this,q,re,le)};var It=function(q){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.EXTENT,this.length=q.length,this._features=q};It.prototype.feature=function(q){return new qt(this._features[q])};var Zt=y.vectorTile.VectorTileFeature,br=J;function J(q,re){this.options=re||{},this.features=q,this.length=q.length}function Et(q,re){this.id=typeof q.id=="number"?q.id:void 0,this.type=q.type,this.rawGeometry=q.type===1?[q.geometry]:q.geometry,this.properties=q.tags,this.extent=re||4096}J.prototype.feature=function(q){return new Et(this.features[q],this.options.extent)},Et.prototype.loadGeometry=function(){var q=this.rawGeometry;this.geometry=[];for(var re=0;re<q.length;re++){for(var le=q[re],Ce=[],Be=0;Be<le.length;Be++)Ce.push(new y.Point$1(le[Be][0],le[Be][1]));this.geometry.push(Ce)}return this.geometry},Et.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var q=this.geometry,re=1/0,le=-1/0,Ce=1/0,Be=-1/0,et=0;et<q.length;et++)for(var dt=q[et],me=0;me<dt.length;me++){var Ge=dt[me];re=Math.min(re,Ge.x),le=Math.max(le,Ge.x),Ce=Math.min(Ce,Ge.y),Be=Math.max(Be,Ge.y)}return[re,Ce,le,Be]},Et.prototype.toGeoJSON=Zt.prototype.toGeoJSON;var Ct=Ht,pt=br;function Ht(q){var re=new y.pbf;return function(le,Ce){for(var Be in le.layers)Ce.writeMessage(3,vt,le.layers[Be])}(q,re),re.finish()}function vt(q,re){var le;re.writeVarintField(15,q.version||1),re.writeStringField(1,q.name||""),re.writeVarintField(5,q.extent||4096);var Ce={keys:[],values:[],keycache:{},valuecache:{}};for(le=0;le<q.length;le++)Ce.feature=q.feature(le),re.writeMessage(2,sr,Ce);var Be=Ce.keys;for(le=0;le<Be.length;le++)re.writeStringField(3,Be[le]);var et=Ce.values;for(le=0;le<et.length;le++)re.writeMessage(4,ce,et[le])}function sr(q,re){var le=q.feature;le.id!==void 0&&re.writeVarintField(1,le.id),re.writeMessage(2,Ir,q),re.writeVarintField(3,le.type),re.writeMessage(4,Y,le)}function Ir(q,re){var le=q.feature,Ce=q.keys,Be=q.values,et=q.keycache,dt=q.valuecache;for(var me in le.properties){var Ge=et[me];Ge===void 0&&(Ce.push(me),et[me]=Ge=Ce.length-1),re.writeVarint(Ge);var Dt=le.properties[me],Lr=typeof Dt;Lr!=="string"&&Lr!=="boolean"&&Lr!=="number"&&(Dt=JSON.stringify(Dt));var er=Lr+":"+Dt,tr=dt[er];tr===void 0&&(Be.push(Dt),dt[er]=tr=Be.length-1),re.writeVarint(tr)}}function ae(q,re){return(re<<3)+(7&q)}function Ze(q){return q<<1^q>>31}function Y(q,re){for(var le=q.loadGeometry(),Ce=q.type,Be=0,et=0,dt=le.length,me=0;me<dt;me++){var Ge=le[me],Dt=1;Ce===1&&(Dt=Ge.length),re.writeVarint(ae(1,Dt));for(var Lr=Ce===3?Ge.length-1:Ge.length,er=0;er<Lr;er++){er===1&&Ce!==1&&re.writeVarint(ae(2,Lr-1));var tr=Ge[er].x-Be,Fr=Ge[er].y-et;re.writeVarint(Ze(tr)),re.writeVarint(Ze(Fr)),Be+=tr,et+=Fr}Ce===3&&re.writeVarint(ae(7,1))}}function ce(q,re){var le=typeof q;le==="string"?re.writeStringField(1,q):le==="boolean"?re.writeBooleanField(7,q):le==="number"&&(q%1!=0?re.writeDoubleField(3,q):q<0?re.writeSVarintField(6,q):re.writeVarintField(5,q))}function ue(q,re,le,Ce){Xe(q,le,Ce),Xe(re,2*le,2*Ce),Xe(re,2*le+1,2*Ce+1)}function Xe(q,re,le){var Ce=q[re];q[re]=q[le],q[le]=Ce}function lt(q,re,le,Ce){var Be=q-le,et=re-Ce;return Be*Be+et*et}Ct.fromVectorTileJs=Ht,Ct.fromGeojsonVt=function(q,re){re=re||{};var le={};for(var Ce in q)le[Ce]=new br(q[Ce].features,re),le[Ce].name=Ce,le[Ce].version=re.version,le[Ce].extent=re.extent;return Ht({layers:le})},Ct.GeoJSONWrapper=pt;var _t=function(q){return q[0]},Xt=function(q){return q[1]},hr=function(q,re,le,Ce,Be){re===void 0&&(re=_t),le===void 0&&(le=Xt),Ce===void 0&&(Ce=64),Be===void 0&&(Be=Float64Array),this.nodeSize=Ce,this.points=q;for(var et=q.length<65536?Uint16Array:Uint32Array,dt=this.ids=new et(q.length),me=this.coords=new Be(2*q.length),Ge=0;Ge<q.length;Ge++)dt[Ge]=Ge,me[2*Ge]=re(q[Ge]),me[2*Ge+1]=le(q[Ge]);(function Dt(Lr,er,tr,Fr,In,Pn){if(!(In-Fr<=tr)){var $t=Fr+In>>1;(function wn(fn,gn,Ii,xn,Ni,sa){for(;Ni>xn;){if(Ni-xn>600){var Oi=Ni-xn+1,Zi=Ii-xn+1,Fi=Math.log(Oi),yi=.5*Math.exp(2*Fi/3),ha=.5*Math.sqrt(Fi*yi*(Oi-yi)/Oi)*(Zi-Oi/2<0?-1:1);wn(fn,gn,Ii,Math.max(xn,Math.floor(Ii-Zi*yi/Oi+ha)),Math.min(Ni,Math.floor(Ii+(Oi-Zi)*yi/Oi+ha)),sa)}var Xa=gn[2*Ii+sa],ga=xn,zi=Ni;for(ue(fn,gn,xn,Ii),gn[2*Ni+sa]>Xa&&ue(fn,gn,xn,Ni);ga<zi;){for(ue(fn,gn,ga,zi),ga++,zi--;gn[2*ga+sa]<Xa;)ga++;for(;gn[2*zi+sa]>Xa;)zi--}gn[2*xn+sa]===Xa?ue(fn,gn,xn,zi):ue(fn,gn,++zi,Ni),zi<=Ii&&(xn=zi+1),Ii<=zi&&(Ni=zi-1)}})(Lr,er,$t,Fr,In,Pn%2),Dt(Lr,er,tr,Fr,$t-1,Pn+1),Dt(Lr,er,tr,$t+1,In,Pn+1)}})(dt,me,Ce,0,dt.length-1,0)};hr.prototype.range=function(q,re,le,Ce){return function(Be,et,dt,me,Ge,Dt,Lr){for(var er,tr,Fr=[0,Be.length-1,0],In=[];Fr.length;){var Pn=Fr.pop(),$t=Fr.pop(),wn=Fr.pop();if($t-wn<=Lr)for(var fn=wn;fn<=$t;fn++)tr=et[2*fn+1],(er=et[2*fn])>=dt&&er<=Ge&&tr>=me&&tr<=Dt&&In.push(Be[fn]);else{var gn=Math.floor((wn+$t)/2);tr=et[2*gn+1],(er=et[2*gn])>=dt&&er<=Ge&&tr>=me&&tr<=Dt&&In.push(Be[gn]);var Ii=(Pn+1)%2;(Pn===0?dt<=er:me<=tr)&&(Fr.push(wn),Fr.push(gn-1),Fr.push(Ii)),(Pn===0?Ge>=er:Dt>=tr)&&(Fr.push(gn+1),Fr.push($t),Fr.push(Ii))}}return In}(this.ids,this.coords,q,re,le,Ce,this.nodeSize)},hr.prototype.within=function(q,re,le){return function(Ce,Be,et,dt,me,Ge){for(var Dt=[0,Ce.length-1,0],Lr=[],er=me*me;Dt.length;){var tr=Dt.pop(),Fr=Dt.pop(),In=Dt.pop();if(Fr-In<=Ge)for(var Pn=In;Pn<=Fr;Pn++)lt(Be[2*Pn],Be[2*Pn+1],et,dt)<=er&&Lr.push(Ce[Pn]);else{var $t=Math.floor((In+Fr)/2),wn=Be[2*$t],fn=Be[2*$t+1];lt(wn,fn,et,dt)<=er&&Lr.push(Ce[$t]);var gn=(tr+1)%2;(tr===0?et-me<=wn:dt-me<=fn)&&(Dt.push(In),Dt.push($t-1),Dt.push(gn)),(tr===0?et+me>=wn:dt+me>=fn)&&(Dt.push($t+1),Dt.push(Fr),Dt.push(gn))}}return Lr}(this.ids,this.coords,q,re,le,this.nodeSize)};var Yr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(q){return q}},Hr=function(q){this.options=ca(Object.create(Yr),q),this.trees=new Array(this.options.maxZoom+1)};function vi(q,re,le,Ce,Be){return{x:q,y:re,zoom:1/0,id:le,parentId:-1,numPoints:Ce,properties:Be}}function Vn(q,re){var le=q.geometry.coordinates,Ce=le[1];return{x:Pi(le[0]),y:mi(Ce),zoom:1/0,index:re,parentId:-1}}function Xn(q){return{type:"Feature",id:q.id,properties:ma(q),geometry:{type:"Point",coordinates:[(Ce=q.x,360*(Ce-.5)),(re=q.y,le=(180-360*re)*Math.PI/180,360*Math.atan(Math.exp(le))/Math.PI-90)]}};var re,le,Ce}function ma(q){var re=q.numPoints,le=re>=1e4?Math.round(re/1e3)+"k":re>=1e3?Math.round(re/100)/10+"k":re;return ca(ca({},q.properties),{cluster:!0,cluster_id:q.id,point_count:re,point_count_abbreviated:le})}function Pi(q){return q/360+.5}function mi(q){var re=Math.sin(q*Math.PI/180),le=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return le<0?0:le>1?1:le}function ca(q,re){for(var le in re)q[le]=re[le];return q}function Gi(q){return q.x}function Si(q){return q.y}function ei(q,re,le,Ce,Be,et){var dt=Be-le,me=et-Ce;if(dt!==0||me!==0){var Ge=((q-le)*dt+(re-Ce)*me)/(dt*dt+me*me);Ge>1?(le=Be,Ce=et):Ge>0&&(le+=dt*Ge,Ce+=me*Ge)}return(dt=q-le)*dt+(me=re-Ce)*me}function cr(q,re,le,Ce){var Be={id:q===void 0?null:q,type:re,geometry:le,tags:Ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(et){var dt=et.geometry,me=et.type;if(me==="Point"||me==="MultiPoint"||me==="LineString")mt(et,dt);else if(me==="Polygon"||me==="MultiLineString")for(var Ge=0;Ge<dt.length;Ge++)mt(et,dt[Ge]);else if(me==="MultiPolygon")for(Ge=0;Ge<dt.length;Ge++)for(var Dt=0;Dt<dt[Ge].length;Dt++)mt(et,dt[Ge][Dt])}(Be),Be}function mt(q,re){for(var le=0;le<re.length;le+=3)q.minX=Math.min(q.minX,re[le]),q.minY=Math.min(q.minY,re[le+1]),q.maxX=Math.max(q.maxX,re[le]),q.maxY=Math.max(q.maxY,re[le+1])}function Wa(q,re,le,Ce){if(re.geometry){var Be=re.geometry.coordinates,et=re.geometry.type,dt=Math.pow(le.tolerance/((1<<le.maxZoom)*le.extent),2),me=[],Ge=re.id;if(le.promoteId?Ge=re.properties[le.promoteId]:le.generateId&&(Ge=Ce||0),et==="Point")xa(Be,me);else if(et==="MultiPoint")for(var Dt=0;Dt<Be.length;Dt++)xa(Be[Dt],me);else if(et==="LineString")gt(Be,me,dt,!1);else if(et==="MultiLineString"){if(le.lineMetrics){for(Dt=0;Dt<Be.length;Dt++)gt(Be[Dt],me=[],dt,!1),q.push(cr(Ge,"LineString",me,re.properties));return}he(Be,me,dt,!1)}else if(et==="Polygon")he(Be,me,dt,!0);else{if(et!=="MultiPolygon"){if(et==="GeometryCollection"){for(Dt=0;Dt<re.geometry.geometries.length;Dt++)Wa(q,{id:Ge,geometry:re.geometry.geometries[Dt],properties:re.properties},le,Ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Dt=0;Dt<Be.length;Dt++){var Lr=[];he(Be[Dt],Lr,dt,!0),me.push(Lr)}}q.push(cr(Ge,et,me,re.properties))}}function xa(q,re){re.push(ie(q[0])),re.push(_e(q[1])),re.push(0)}function gt(q,re,le,Ce){for(var Be,et,dt=0,me=0;me<q.length;me++){var Ge=ie(q[me][0]),Dt=_e(q[me][1]);re.push(Ge),re.push(Dt),re.push(0),me>0&&(dt+=Ce?(Be*Dt-Ge*et)/2:Math.sqrt(Math.pow(Ge-Be,2)+Math.pow(Dt-et,2))),Be=Ge,et=Dt}var Lr=re.length-3;re[2]=1,function er(tr,Fr,In,Pn){for(var $t,wn=Pn,fn=In-Fr>>1,gn=In-Fr,Ii=tr[Fr],xn=tr[Fr+1],Ni=tr[In],sa=tr[In+1],Oi=Fr+3;Oi<In;Oi+=3){var Zi=ei(tr[Oi],tr[Oi+1],Ii,xn,Ni,sa);if(Zi>wn)$t=Oi,wn=Zi;else if(Zi===wn){var Fi=Math.abs(Oi-fn);Fi<gn&&($t=Oi,gn=Fi)}}wn>Pn&&($t-Fr>3&&er(tr,Fr,$t,Pn),tr[$t+2]=wn,In-$t>3&&er(tr,$t,In,Pn))}(re,0,Lr,le),re[Lr+2]=1,re.size=Math.abs(dt),re.start=0,re.end=re.size}function he(q,re,le,Ce){for(var Be=0;Be<q.length;Be++){var et=[];gt(q[Be],et,le,Ce),re.push(et)}}function ie(q){return q/360+.5}function _e(q){var re=Math.sin(q*Math.PI/180),le=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return le<0?0:le>1?1:le}function N(q,re,le,Ce,Be,et,dt,me){if(Ce/=re,et>=(le/=re)&&dt<Ce)return q;if(dt<le||et>=Ce)return null;for(var Ge=[],Dt=0;Dt<q.length;Dt++){var Lr=q[Dt],er=Lr.geometry,tr=Lr.type,Fr=Be===0?Lr.minX:Lr.minY,In=Be===0?Lr.maxX:Lr.maxY;if(Fr>=le&&In<Ce)Ge.push(Lr);else if(!(In<le||Fr>=Ce)){var Pn=[];if(tr==="Point"||tr==="MultiPoint")qe(er,Pn,le,Ce,Be);else if(tr==="LineString")Qt(er,Pn,le,Ce,Be,!1,me.lineMetrics);else if(tr==="MultiLineString")Ye(er,Pn,le,Ce,Be,!1);else if(tr==="Polygon")Ye(er,Pn,le,Ce,Be,!0);else if(tr==="MultiPolygon")for(var $t=0;$t<er.length;$t++){var wn=[];Ye(er[$t],wn,le,Ce,Be,!0),wn.length&&Pn.push(wn)}if(Pn.length){if(me.lineMetrics&&tr==="LineString"){for($t=0;$t<Pn.length;$t++)Ge.push(cr(Lr.id,tr,Pn[$t],Lr.tags));continue}tr!=="LineString"&&tr!=="MultiLineString"||(Pn.length===1?(tr="LineString",Pn=Pn[0]):tr="MultiLineString"),tr!=="Point"&&tr!=="MultiPoint"||(tr=Pn.length===3?"Point":"MultiPoint"),Ge.push(cr(Lr.id,tr,Pn,Lr.tags))}}}return Ge.length?Ge:null}function qe(q,re,le,Ce,Be){for(var et=0;et<q.length;et+=3){var dt=q[et+Be];dt>=le&&dt<=Ce&&(re.push(q[et]),re.push(q[et+1]),re.push(q[et+2]))}}function Qt(q,re,le,Ce,Be,et,dt){for(var me,Ge,Dt=Nr(q),Lr=Be===0?pr:Pr,er=q.start,tr=0;tr<q.length-3;tr+=3){var Fr=q[tr],In=q[tr+1],Pn=q[tr+2],$t=q[tr+3],wn=q[tr+4],fn=Be===0?Fr:In,gn=Be===0?$t:wn,Ii=!1;dt&&(me=Math.sqrt(Math.pow(Fr-$t,2)+Math.pow(In-wn,2))),fn<le?gn>le&&(Ge=Lr(Dt,Fr,In,$t,wn,le),dt&&(Dt.start=er+me*Ge)):fn>Ce?gn<Ce&&(Ge=Lr(Dt,Fr,In,$t,wn,Ce),dt&&(Dt.start=er+me*Ge)):Pt(Dt,Fr,In,Pn),gn<le&&fn>=le&&(Ge=Lr(Dt,Fr,In,$t,wn,le),Ii=!0),gn>Ce&&fn<=Ce&&(Ge=Lr(Dt,Fr,In,$t,wn,Ce),Ii=!0),!et&&Ii&&(dt&&(Dt.end=er+me*Ge),re.push(Dt),Dt=Nr(q)),dt&&(er+=me)}var xn=q.length-3;Fr=q[xn],In=q[xn+1],Pn=q[xn+2],(fn=Be===0?Fr:In)>=le&&fn<=Ce&&Pt(Dt,Fr,In,Pn),xn=Dt.length-3,et&&xn>=3&&(Dt[xn]!==Dt[0]||Dt[xn+1]!==Dt[1])&&Pt(Dt,Dt[0],Dt[1],Dt[2]),Dt.length&&re.push(Dt)}function Nr(q){var re=[];return re.size=q.size,re.start=q.start,re.end=q.end,re}function Ye(q,re,le,Ce,Be,et){for(var dt=0;dt<q.length;dt++)Qt(q[dt],re,le,Ce,Be,et,!1)}function Pt(q,re,le,Ce){q.push(re),q.push(le),q.push(Ce)}function pr(q,re,le,Ce,Be,et){var dt=(et-re)/(Ce-re);return q.push(et),q.push(le+(Be-le)*dt),q.push(1),dt}function Pr(q,re,le,Ce,Be,et){var dt=(et-le)/(Be-le);return q.push(re+(Ce-re)*dt),q.push(et),q.push(1),dt}function Wr(q,re){for(var le=[],Ce=0;Ce<q.length;Ce++){var Be,et=q[Ce],dt=et.type;if(dt==="Point"||dt==="MultiPoint"||dt==="LineString")Be=tn(et.geometry,re);else if(dt==="MultiLineString"||dt==="Polygon"){Be=[];for(var me=0;me<et.geometry.length;me++)Be.push(tn(et.geometry[me],re))}else if(dt==="MultiPolygon")for(Be=[],me=0;me<et.geometry.length;me++){for(var Ge=[],Dt=0;Dt<et.geometry[me].length;Dt++)Ge.push(tn(et.geometry[me][Dt],re));Be.push(Ge)}le.push(cr(et.id,dt,Be,et.tags))}return le}function tn(q,re){var le=[];le.size=q.size,q.start!==void 0&&(le.start=q.start,le.end=q.end);for(var Ce=0;Ce<q.length;Ce+=3)le.push(q[Ce]+re,q[Ce+1],q[Ce+2]);return le}function Yn(q,re){if(q.transformed)return q;var le,Ce,Be,et=1<<q.z,dt=q.x,me=q.y;for(le=0;le<q.features.length;le++){var Ge=q.features[le],Dt=Ge.geometry,Lr=Ge.type;if(Ge.geometry=[],Lr===1)for(Ce=0;Ce<Dt.length;Ce+=2)Ge.geometry.push(jn(Dt[Ce],Dt[Ce+1],re,et,dt,me));else for(Ce=0;Ce<Dt.length;Ce++){var er=[];for(Be=0;Be<Dt[Ce].length;Be+=2)er.push(jn(Dt[Ce][Be],Dt[Ce][Be+1],re,et,dt,me));Ge.geometry.push(er)}}return q.transformed=!0,q}function jn(q,re,le,Ce,Be,et){return[Math.round(le*(q*Ce-Be)),Math.round(le*(re*Ce-et))]}function an(q,re,le,Ce,Be){for(var et=re===Be.maxZoom?0:Be.tolerance/((1<<re)*Be.extent),dt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:le,y:Ce,z:re,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},me=0;me<q.length;me++){dt.numFeatures++,gi(dt,q[me],et,Be);var Ge=q[me].minX,Dt=q[me].minY,Lr=q[me].maxX,er=q[me].maxY;Ge<dt.minX&&(dt.minX=Ge),Dt<dt.minY&&(dt.minY=Dt),Lr>dt.maxX&&(dt.maxX=Lr),er>dt.maxY&&(dt.maxY=er)}return dt}function gi(q,re,le,Ce){var Be=re.geometry,et=re.type,dt=[];if(et==="Point"||et==="MultiPoint")for(var me=0;me<Be.length;me+=3)dt.push(Be[me]),dt.push(Be[me+1]),q.numPoints++,q.numSimplified++;else if(et==="LineString")ci(dt,Be,q,le,!1,!1);else if(et==="MultiLineString"||et==="Polygon")for(me=0;me<Be.length;me++)ci(dt,Be[me],q,le,et==="Polygon",me===0);else if(et==="MultiPolygon")for(var Ge=0;Ge<Be.length;Ge++){var Dt=Be[Ge];for(me=0;me<Dt.length;me++)ci(dt,Dt[me],q,le,!0,me===0)}if(dt.length){var Lr=re.tags||null;if(et==="LineString"&&Ce.lineMetrics){for(var er in Lr={},re.tags)Lr[er]=re.tags[er];Lr.mapbox_clip_start=Be.start/Be.size,Lr.mapbox_clip_end=Be.end/Be.size}var tr={geometry:dt,type:et==="Polygon"||et==="MultiPolygon"?3:et==="LineString"||et==="MultiLineString"?2:1,tags:Lr};re.id!==null&&(tr.id=re.id),q.features.push(tr)}}function ci(q,re,le,Ce,Be,et){var dt=Ce*Ce;if(Ce>0&&re.size<(Be?dt:Ce))le.numPoints+=re.length/3;else{for(var me=[],Ge=0;Ge<re.length;Ge+=3)(Ce===0||re[Ge+2]>dt)&&(le.numSimplified++,me.push(re[Ge]),me.push(re[Ge+1])),le.numPoints++;Be&&function(Dt,Lr){for(var er=0,tr=0,Fr=Dt.length,In=Fr-2;tr<Fr;In=tr,tr+=2)er+=(Dt[tr]-Dt[In])*(Dt[tr+1]+Dt[In+1]);if(er>0===Lr)for(tr=0,Fr=Dt.length;tr<Fr/2;tr+=2){var Pn=Dt[tr],$t=Dt[tr+1];Dt[tr]=Dt[Fr-2-tr],Dt[tr+1]=Dt[Fr-1-tr],Dt[Fr-2-tr]=Pn,Dt[Fr-1-tr]=$t}}(me,et),q.push(me)}}function fa(q,re){var le=(re=this.options=function(Be,et){for(var dt in et)Be[dt]=et[dt];return Be}(Object.create(this.options),re)).debug;if(le&&console.time("preprocess data"),re.maxZoom<0||re.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(re.promoteId&&re.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ce=function(Be,et){var dt=[];if(Be.type==="FeatureCollection")for(var me=0;me<Be.features.length;me++)Wa(dt,Be.features[me],et,me);else Wa(dt,Be.type==="Feature"?Be:{geometry:Be},et);return dt}(q,re);this.tiles={},this.tileCoords=[],le&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",re.indexMaxZoom,re.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Ce=function(Be,et){var dt=et.buffer/et.extent,me=Be,Ge=N(Be,1,-1-dt,dt,0,-1,2,et),Dt=N(Be,1,1-dt,2+dt,0,-1,2,et);return(Ge||Dt)&&(me=N(Be,1,-dt,1+dt,0,-1,2,et)||[],Ge&&(me=Wr(Ge,1).concat(me)),Dt&&(me=me.concat(Wr(Dt,-1)))),me}(Ce,re)).length&&this.splitTile(Ce,0,0,0),le&&(Ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ka(q,re,le){return 32*((1<<q)*le+re)+q}function Ua(q,re){var le=q.tileID.canonical;if(!this._geoJSONIndex)return re(null,null);var Ce=this._geoJSONIndex.getTile(le.z,le.x,le.y);if(!Ce)return re(null,null);var Be=new It(Ce.features),et=Ct(Be);et.byteOffset===0&&et.byteLength===et.buffer.byteLength||(et=new Uint8Array(et)),re(null,{vectorTile:Be,rawData:et.buffer})}Hr.prototype.load=function(q){var re=this.options,le=re.log,Ce=re.minZoom,Be=re.maxZoom,et=re.nodeSize;le&&console.time("total time");var dt="prepare "+q.length+" points";le&&console.time(dt),this.points=q;for(var me=[],Ge=0;Ge<q.length;Ge++)q[Ge].geometry&&me.push(Vn(q[Ge],Ge));this.trees[Be+1]=new hr(me,Gi,Si,et,Float32Array),le&&console.timeEnd(dt);for(var Dt=Be;Dt>=Ce;Dt--){var Lr=+Date.now();me=this._cluster(me,Dt),this.trees[Dt]=new hr(me,Gi,Si,et,Float32Array),le&&console.log("z%d: %d clusters in %dms",Dt,me.length,+Date.now()-Lr)}return le&&console.timeEnd("total time"),this},Hr.prototype.getClusters=function(q,re){var le=((q[0]+180)%360+360)%360-180,Ce=Math.max(-90,Math.min(90,q[1])),Be=q[2]===180?180:((q[2]+180)%360+360)%360-180,et=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)le=-180,Be=180;else if(le>Be){var dt=this.getClusters([le,Ce,180,et],re),me=this.getClusters([-180,Ce,Be,et],re);return dt.concat(me)}for(var Ge=this.trees[this._limitZoom(re)],Dt=[],Lr=0,er=Ge.range(Pi(le),mi(et),Pi(Be),mi(Ce));Lr<er.length;Lr+=1){var tr=Ge.points[er[Lr]];Dt.push(tr.numPoints?Xn(tr):this.points[tr.index])}return Dt},Hr.prototype.getChildren=function(q){var re=this._getOriginId(q),le=this._getOriginZoom(q),Ce="No cluster with the specified id.",Be=this.trees[le];if(!Be)throw new Error(Ce);var et=Be.points[re];if(!et)throw new Error(Ce);for(var dt=this.options.radius/(this.options.extent*Math.pow(2,le-1)),me=[],Ge=0,Dt=Be.within(et.x,et.y,dt);Ge<Dt.length;Ge+=1){var Lr=Be.points[Dt[Ge]];Lr.parentId===q&&me.push(Lr.numPoints?Xn(Lr):this.points[Lr.index])}if(me.length===0)throw new Error(Ce);return me},Hr.prototype.getLeaves=function(q,re,le){var Ce=[];return this._appendLeaves(Ce,q,re=re||10,le=le||0,0),Ce},Hr.prototype.getTile=function(q,re,le){var Ce=this.trees[this._limitZoom(q)],Be=Math.pow(2,q),et=this.options,dt=et.radius/et.extent,me=(le-dt)/Be,Ge=(le+1+dt)/Be,Dt={features:[]};return this._addTileFeatures(Ce.range((re-dt)/Be,me,(re+1+dt)/Be,Ge),Ce.points,re,le,Be,Dt),re===0&&this._addTileFeatures(Ce.range(1-dt/Be,me,1,Ge),Ce.points,Be,le,Be,Dt),re===Be-1&&this._addTileFeatures(Ce.range(0,me,dt/Be,Ge),Ce.points,-1,le,Be,Dt),Dt.features.length?Dt:null},Hr.prototype.getClusterExpansionZoom=function(q){for(var re=this._getOriginZoom(q)-1;re<=this.options.maxZoom;){var le=this.getChildren(q);if(re++,le.length!==1)break;q=le[0].properties.cluster_id}return re},Hr.prototype._appendLeaves=function(q,re,le,Ce,Be){for(var et=0,dt=this.getChildren(re);et<dt.length;et+=1){var me=dt[et],Ge=me.properties;if(Ge&&Ge.cluster?Be+Ge.point_count<=Ce?Be+=Ge.point_count:Be=this._appendLeaves(q,Ge.cluster_id,le,Ce,Be):Be<Ce?Be++:q.push(me),q.length===le)break}return Be},Hr.prototype._addTileFeatures=function(q,re,le,Ce,Be,et){for(var dt=0,me=q;dt<me.length;dt+=1){var Ge=re[me[dt]],Dt=Ge.numPoints,Lr={type:1,geometry:[[Math.round(this.options.extent*(Ge.x*Be-le)),Math.round(this.options.extent*(Ge.y*Be-Ce))]],tags:Dt?ma(Ge):this.points[Ge.index].properties},er=void 0;Dt?er=Ge.id:this.options.generateId?er=Ge.index:this.points[Ge.index].id&&(er=this.points[Ge.index].id),er!==void 0&&(Lr.id=er),et.features.push(Lr)}},Hr.prototype._limitZoom=function(q){return Math.max(this.options.minZoom,Math.min(+q,this.options.maxZoom+1))},Hr.prototype._cluster=function(q,re){for(var le=[],Ce=this.options,Be=Ce.reduce,et=Ce.minPoints,dt=Ce.radius/(Ce.extent*Math.pow(2,re)),me=0;me<q.length;me++){var Ge=q[me];if(!(Ge.zoom<=re)){Ge.zoom=re;for(var Dt=this.trees[re+1],Lr=Dt.within(Ge.x,Ge.y,dt),er=Ge.numPoints||1,tr=er,Fr=0,In=Lr;Fr<In.length;Fr+=1){var Pn=Dt.points[In[Fr]];Pn.zoom>re&&(tr+=Pn.numPoints||1)}if(tr>=et){for(var $t=Ge.x*er,wn=Ge.y*er,fn=Be&&er>1?this._map(Ge,!0):null,gn=(me<<5)+(re+1)+this.points.length,Ii=0,xn=Lr;Ii<xn.length;Ii+=1){var Ni=Dt.points[xn[Ii]];if(!(Ni.zoom<=re)){Ni.zoom=re;var sa=Ni.numPoints||1;$t+=Ni.x*sa,wn+=Ni.y*sa,Ni.parentId=gn,Be&&(fn||(fn=this._map(Ge,!0)),Be(fn,this._map(Ni)))}}Ge.parentId=gn,le.push(vi($t/tr,wn/tr,gn,tr,fn))}else if(le.push(Ge),tr>1)for(var Oi=0,Zi=Lr;Oi<Zi.length;Oi+=1){var Fi=Dt.points[Zi[Oi]];Fi.zoom<=re||(Fi.zoom=re,le.push(Fi))}}}return le},Hr.prototype._getOriginId=function(q){return q-this.points.length>>5},Hr.prototype._getOriginZoom=function(q){return(q-this.points.length)%32},Hr.prototype._map=function(q,re){if(q.numPoints)return re?ca({},q.properties):q.properties;var le=this.points[q.index].properties,Ce=this.options.map(le);return re&&Ce===le?ca({},Ce):Ce},fa.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},fa.prototype.splitTile=function(q,re,le,Ce,Be,et,dt){for(var me=[q,re,le,Ce],Ge=this.options,Dt=Ge.debug;me.length;){Ce=me.pop(),le=me.pop(),re=me.pop(),q=me.pop();var Lr=1<<re,er=ka(re,le,Ce),tr=this.tiles[er];if(!tr&&(Dt>1&&console.time("creation"),tr=this.tiles[er]=an(q,re,le,Ce,Ge),this.tileCoords.push({z:re,x:le,y:Ce}),Dt)){Dt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",re,le,Ce,tr.numFeatures,tr.numPoints,tr.numSimplified),console.timeEnd("creation"));var Fr="z"+re;this.stats[Fr]=(this.stats[Fr]||0)+1,this.total++}if(tr.source=q,Be){if(re===Ge.maxZoom||re===Be)continue;var In=1<<Be-re;if(le!==Math.floor(et/In)||Ce!==Math.floor(dt/In))continue}else if(re===Ge.indexMaxZoom||tr.numPoints<=Ge.indexMaxPoints)continue;if(tr.source=null,q.length!==0){Dt>1&&console.time("clipping");var Pn,$t,wn,fn,gn,Ii,xn=.5*Ge.buffer/Ge.extent,Ni=.5-xn,sa=.5+xn,Oi=1+xn;Pn=$t=wn=fn=null,gn=N(q,Lr,le-xn,le+sa,0,tr.minX,tr.maxX,Ge),Ii=N(q,Lr,le+Ni,le+Oi,0,tr.minX,tr.maxX,Ge),q=null,gn&&(Pn=N(gn,Lr,Ce-xn,Ce+sa,1,tr.minY,tr.maxY,Ge),$t=N(gn,Lr,Ce+Ni,Ce+Oi,1,tr.minY,tr.maxY,Ge),gn=null),Ii&&(wn=N(Ii,Lr,Ce-xn,Ce+sa,1,tr.minY,tr.maxY,Ge),fn=N(Ii,Lr,Ce+Ni,Ce+Oi,1,tr.minY,tr.maxY,Ge),Ii=null),Dt>1&&console.timeEnd("clipping"),me.push(Pn||[],re+1,2*le,2*Ce),me.push($t||[],re+1,2*le,2*Ce+1),me.push(wn||[],re+1,2*le+1,2*Ce),me.push(fn||[],re+1,2*le+1,2*Ce+1)}}},fa.prototype.getTile=function(q,re,le){var Ce=this.options,Be=Ce.extent,et=Ce.debug;if(q<0||q>24)return null;var dt=1<<q,me=ka(q,re=(re%dt+dt)%dt,le);if(this.tiles[me])return Yn(this.tiles[me],Be);et>1&&console.log("drilling down to z%d-%d-%d",q,re,le);for(var Ge,Dt=q,Lr=re,er=le;!Ge&&Dt>0;)Dt--,Lr=Math.floor(Lr/2),er=Math.floor(er/2),Ge=this.tiles[ka(Dt,Lr,er)];return Ge&&Ge.source?(et>1&&console.log("found parent tile z%d-%d-%d",Dt,Lr,er),et>1&&console.time("drilling down"),this.splitTile(Ge.source,Dt,Lr,er,q,re,le),et>1&&console.timeEnd("drilling down"),this.tiles[me]?Yn(this.tiles[me],Be):null):null};var Ea=function(q){function re(le,Ce,Be,et){q.call(this,le,Ce,Be,Ua),et&&(this.loadGeoJSON=et)}return q&&(re.__proto__=q),(re.prototype=Object.create(q&&q.prototype)).constructor=re,re.prototype.loadData=function(le,Ce){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=Ce,this._pendingLoadDataParams=le,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},re.prototype._loadData=function(){var le=this;if(this._pendingCallback&&this._pendingLoadDataParams){var Ce=this._pendingCallback,Be=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var et=!!(Be&&Be.request&&Be.request.collectResourceTiming)&&new y.RequestPerformance(Be.request);this.loadGeoJSON(Be,function(dt,me){if(dt||!me)return Ce(dt);if(typeof me!="object")return Ce(new Error("Input data given to '"+Be.source+"' is not a valid GeoJSON object."));(function tr(Fr,In){var Pn,$t=Fr&&Fr.type;if($t==="FeatureCollection")for(Pn=0;Pn<Fr.features.length;Pn++)tr(Fr.features[Pn],In);else if($t==="GeometryCollection")for(Pn=0;Pn<Fr.geometries.length;Pn++)tr(Fr.geometries[Pn],In);else if($t==="Feature")tr(Fr.geometry,In);else if($t==="Polygon")vr(Fr.coordinates,In);else if($t==="MultiPolygon")for(Pn=0;Pn<Fr.coordinates.length;Pn++)vr(Fr.coordinates[Pn],In);return Fr})(me,!0);try{if(Be.filter){var Ge=y.createExpression(Be.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ge.result==="error")throw new Error(Ge.value.map(function(tr){return tr.key+": "+tr.message}).join(", "));var Dt=me.features.filter(function(tr){return Ge.value.evaluate({zoom:0},tr)});me={type:"FeatureCollection",features:Dt}}le._geoJSONIndex=Be.cluster?new Hr(function(tr){var Fr=tr.superclusterOptions,In=tr.clusterProperties;if(!In||!Fr)return Fr;for(var Pn={},$t={},wn={accumulated:null,zoom:0},fn={properties:null},gn=Object.keys(In),Ii=0,xn=gn;Ii<xn.length;Ii+=1){var Ni=xn[Ii],sa=In[Ni],Oi=sa[0],Zi=y.createExpression(sa[1]),Fi=y.createExpression(typeof Oi=="string"?[Oi,["accumulated"],["get",Ni]]:Oi);Pn[Ni]=Zi.value,$t[Ni]=Fi.value}return Fr.map=function(yi){fn.properties=yi;for(var ha={},Xa=0,ga=gn;Xa<ga.length;Xa+=1){var zi=ga[Xa];ha[zi]=Pn[zi].evaluate(wn,fn)}return ha},Fr.reduce=function(yi,ha){fn.properties=ha;for(var Xa=0,ga=gn;Xa<ga.length;Xa+=1){var zi=ga[Xa];wn.accumulated=yi[zi],yi[zi]=$t[zi].evaluate(wn,fn)}},Fr}(Be)).load(me.features):function(tr,Fr){return new fa(tr,Fr)}(me,Be.geojsonVtOptions)}catch(tr){return Ce(tr)}le.loaded={};var Lr={};if(et){var er=et.finish();er&&(Lr.resourceTiming={},Lr.resourceTiming[Be.source]=JSON.parse(JSON.stringify(er)))}Ce(null,Lr)})}},re.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},re.prototype.reloadTile=function(le,Ce){var Be=this.loaded;return Be&&Be[le.uid]?q.prototype.reloadTile.call(this,le,Ce):this.loadTile(le,Ce)},re.prototype.loadGeoJSON=function(le,Ce){if(le.request)y.getJSON(le.request,Ce);else{if(typeof le.data!="string")return Ce(new Error("Input data given to '"+le.source+"' is not a valid GeoJSON object."));try{return Ce(null,JSON.parse(le.data))}catch(Be){return Ce(new Error("Input data given to '"+le.source+"' is not a valid GeoJSON object."))}}},re.prototype.removeSource=function(le,Ce){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Ce()},re.prototype.getClusterExpansionZoom=function(le,Ce){try{Ce(null,this._geoJSONIndex.getClusterExpansionZoom(le.clusterId))}catch(Be){Ce(Be)}},re.prototype.getClusterChildren=function(le,Ce){try{Ce(null,this._geoJSONIndex.getChildren(le.clusterId))}catch(Be){Ce(Be)}},re.prototype.getClusterLeaves=function(le,Ce){try{Ce(null,this._geoJSONIndex.getLeaves(le.clusterId,le.limit,le.offset))}catch(Be){Ce(Be)}},re}(ct),Wi=function(q){var re=this;this.self=q,this.actor=new y.Actor(q,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ct,geojson:Ea},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(le,Ce){if(re.workerSourceTypes[le])throw new Error('Worker source with name "'+le+'" already registered.');re.workerSourceTypes[le]=Ce},this.self.registerRTLTextPlugin=function(le){if(y.plugin.isParsed())throw new Error("RTL text plugin already registered.");y.plugin.applyArabicShaping=le.applyArabicShaping,y.plugin.processBidirectionalText=le.processBidirectionalText,y.plugin.processStyledBidirectionalText=le.processStyledBidirectionalText}};return Wi.prototype.setReferrer=function(q,re){this.referrer=re},Wi.prototype.setImages=function(q,re,le){for(var Ce in this.availableImages[q]=re,this.workerSources[q]){var Be=this.workerSources[q][Ce];for(var et in Be)Be[et].availableImages=re}le()},Wi.prototype.setLayers=function(q,re,le){this.getLayerIndex(q).replace(re),le()},Wi.prototype.updateLayers=function(q,re,le){this.getLayerIndex(q).update(re.layers,re.removedIds),le()},Wi.prototype.loadTile=function(q,re,le){this.getWorkerSource(q,re.type,re.source).loadTile(re,le)},Wi.prototype.loadDEMTile=function(q,re,le){this.getDEMWorkerSource(q,re.source).loadTile(re,le)},Wi.prototype.reloadTile=function(q,re,le){this.getWorkerSource(q,re.type,re.source).reloadTile(re,le)},Wi.prototype.abortTile=function(q,re,le){this.getWorkerSource(q,re.type,re.source).abortTile(re,le)},Wi.prototype.removeTile=function(q,re,le){this.getWorkerSource(q,re.type,re.source).removeTile(re,le)},Wi.prototype.removeDEMTile=function(q,re){this.getDEMWorkerSource(q,re.source).removeTile(re)},Wi.prototype.removeSource=function(q,re,le){if(this.workerSources[q]&&this.workerSources[q][re.type]&&this.workerSources[q][re.type][re.source]){var Ce=this.workerSources[q][re.type][re.source];delete this.workerSources[q][re.type][re.source],Ce.removeSource!==void 0?Ce.removeSource(re,le):le()}},Wi.prototype.loadWorkerSource=function(q,re,le){try{this.self.importScripts(re.url),le()}catch(Ce){le(Ce.toString())}},Wi.prototype.syncRTLPluginState=function(q,re,le){try{y.plugin.setState(re);var Ce=y.plugin.getPluginURL();if(y.plugin.isLoaded()&&!y.plugin.isParsed()&&Ce!=null){this.self.importScripts(Ce);var Be=y.plugin.isParsed();le(Be?void 0:new Error("RTL Text Plugin failed to import scripts from "+Ce),Be)}}catch(et){le(et.toString())}},Wi.prototype.getAvailableImages=function(q){var re=this.availableImages[q];return re||(re=[]),re},Wi.prototype.getLayerIndex=function(q){var re=this.layerIndexes[q];return re||(re=this.layerIndexes[q]=new Se),re},Wi.prototype.getWorkerSource=function(q,re,le){var Ce=this;return this.workerSources[q]||(this.workerSources[q]={}),this.workerSources[q][re]||(this.workerSources[q][re]={}),this.workerSources[q][re][le]||(this.workerSources[q][re][le]=new this.workerSourceTypes[re]({send:function(Be,et,dt){Ce.actor.send(Be,et,dt,q)}},this.getLayerIndex(q),this.getAvailableImages(q))),this.workerSources[q][re][le]},Wi.prototype.getDEMWorkerSource=function(q,re){return this.demWorkerSources[q]||(this.demWorkerSources[q]={}),this.demWorkerSources[q][re]||(this.demWorkerSources[q][re]=new Ot),this.demWorkerSources[q][re]},Wi.prototype.enforceCacheSizeLimit=function(q,re){y.enforceCacheSizeLimit(re)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Wi(self)),Wi}),Te(["./shared"],function(y){"use strict";var Ie=y.createCommonjsModule(function(f){function d(w){return!h(w)}function h(w){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var I,O,G=new Blob([""],{type:"text/javascript"}),Q=URL.createObjectURL(G);try{O=new Worker(Q),I=!0}catch(ge){I=!1}return O&&O.terminate(),URL.revokeObjectURL(Q),I}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var I=document.createElement("canvas");I.width=I.height=1;var O=I.getContext("2d");if(!O)return!1;var G=O.getImageData(0,0,1,1);return G&&G.width===I.width}()?(g[M=w&&w.failIfMajorPerformanceCaveat]===void 0&&(g[M]=function(I){var O=function(Q){var ge=document.createElement("canvas"),xe=Object.create(d.webGLContextAttributes);return xe.failIfMajorPerformanceCaveat=Q,ge.probablySupportsContext?ge.probablySupportsContext("webgl",xe)||ge.probablySupportsContext("experimental-webgl",xe):ge.supportsContext?ge.supportsContext("webgl",xe)||ge.supportsContext("experimental-webgl",xe):ge.getContext("webgl",xe)||ge.getContext("experimental-webgl",xe)}(I);if(!O)return!1;var G=O.createShader(O.VERTEX_SHADER);return!(!G||O.isContextLost())&&(O.shaderSource(G,"void main() {}"),O.compileShader(G),O.getShaderParameter(G,O.COMPILE_STATUS)===!0)}(M)),g[M]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var M}f.exports?f.exports=d:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=d,window.mapboxgl.notSupportedReason=h);var g={};d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),X={create:function(f,d,h){var g=y.window.document.createElement(f);return d!==void 0&&(g.className=d),h&&h.appendChild(g),g},createNS:function(f,d){return y.window.document.createElementNS(f,d)}},Se=y.window.document&&y.window.document.documentElement.style;function se(f){if(!Se)return f[0];for(var d=0;d<f.length;d++)if(f[d]in Se)return f[d];return f[0]}var rt,ye=se(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);X.disableDrag=function(){Se&&ye&&(rt=Se[ye],Se[ye]="none")},X.enableDrag=function(){Se&&ye&&(Se[ye]=rt)};var ot=se(["transform","WebkitTransform"]);X.setTransform=function(f,d){f.style[ot]=d};var ct=!1;try{var bt=Object.defineProperty({},"passive",{get:function(){ct=!0}});y.window.addEventListener("test",bt,bt),y.window.removeEventListener("test",bt,bt)}catch(f){ct=!1}X.addEventListener=function(f,d,h,g){g===void 0&&(g={}),f.addEventListener(d,h,"passive"in g&&ct?g:g.capture)},X.removeEventListener=function(f,d,h,g){g===void 0&&(g={}),f.removeEventListener(d,h,"passive"in g&&ct?g:g.capture)};var Ot=function(f){f.preventDefault(),f.stopPropagation(),y.window.removeEventListener("click",Ot,!0)};function vr(f){var d=f.userImage;return!!(d&&d.render&&d.render())&&(f.data.replace(new Uint8Array(d.data.buffer)),!0)}X.suppressClick=function(){y.window.addEventListener("click",Ot,!0),y.window.setTimeout(function(){y.window.removeEventListener("click",Ot,!0)},0)},X.mousePos=function(f,d){var h=f.getBoundingClientRect();return new y.Point(d.clientX-h.left-f.clientLeft,d.clientY-h.top-f.clientTop)},X.touchPos=function(f,d){for(var h=f.getBoundingClientRect(),g=[],w=0;w<d.length;w++)g.push(new y.Point(d[w].clientX-h.left-f.clientLeft,d[w].clientY-h.top-f.clientTop));return g},X.mouseButton=function(f){return y.window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&y.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button},X.remove=function(f){f.parentNode&&f.parentNode.removeChild(f)};var Ft=function(f){function d(){f.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.RGBAImage({width:1,height:1}),this.dirty=!0}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.isLoaded=function(){return this.loaded},d.prototype.setLoaded=function(h){if(this.loaded!==h&&(this.loaded=h,h)){for(var g=0,w=this.requestors;g<w.length;g+=1){var M=w[g];this._notify(M.ids,M.callback)}this.requestors=[]}},d.prototype.getImage=function(h){return this.images[h]},d.prototype.addImage=function(h,g){this._validate(h,g)&&(this.images[h]=g)},d.prototype._validate=function(h,g){var w=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchX" value'))),w=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchY" value'))),w=!1),this._validateContent(g.content,g)||(this.fire(new y.ErrorEvent(new Error('Image "'+h+'" has invalid "content" value'))),w=!1),w},d.prototype._validateStretch=function(h,g){if(!h)return!0;for(var w=0,M=0,I=h;M<I.length;M+=1){var O=I[M];if(O[0]<w||O[1]<O[0]||g<O[1])return!1;w=O[1]}return!0},d.prototype._validateContent=function(h,g){return!(h&&(h.length!==4||h[0]<0||g.data.width<h[0]||h[1]<0||g.data.height<h[1]||h[2]<0||g.data.width<h[2]||h[3]<0||g.data.height<h[3]||h[2]<h[0]||h[3]<h[1]))},d.prototype.updateImage=function(h,g){g.version=this.images[h].version+1,this.images[h]=g,this.updatedImages[h]=!0},d.prototype.removeImage=function(h){var g=this.images[h];delete this.images[h],delete this.patterns[h],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()},d.prototype.listImages=function(){return Object.keys(this.images)},d.prototype.getImages=function(h,g){var w=!0;if(!this.isLoaded())for(var M=0,I=h;M<I.length;M+=1)this.images[I[M]]||(w=!1);this.isLoaded()||w?this._notify(h,g):this.requestors.push({ids:h,callback:g})},d.prototype._notify=function(h,g){for(var w={},M=0,I=h;M<I.length;M+=1){var O=I[M];this.images[O]||this.fire(new y.Event("styleimagemissing",{id:O}));var G=this.images[O];G?w[O]={data:G.data.clone(),pixelRatio:G.pixelRatio,sdf:G.sdf,version:G.version,stretchX:G.stretchX,stretchY:G.stretchY,content:G.content,hasRenderCallback:Boolean(G.userImage&&G.userImage.render)}:y.warnOnce('Image "'+O+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}g(null,w)},d.prototype.getPixelSize=function(){var h=this.atlasImage;return{width:h.width,height:h.height}},d.prototype.getPattern=function(h){var g=this.patterns[h],w=this.getImage(h);if(!w)return null;if(g&&g.position.version===w.version)return g.position;if(g)g.position.version=w.version;else{var M={w:w.data.width+2,h:w.data.height+2,x:0,y:0},I=new y.ImagePosition(M,w);this.patterns[h]={bin:M,position:I}}return this._updatePatternAtlas(),this.patterns[h].position},d.prototype.bind=function(h){var g=h.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new y.Texture(h,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)},d.prototype._updatePatternAtlas=function(){var h=[];for(var g in this.patterns)h.push(this.patterns[g].bin);var w=y.potpack(h),M=w.w,I=w.h,O=this.atlasImage;for(var G in O.resize({width:M||1,height:I||1}),this.patterns){var Q=this.patterns[G].bin,ge=Q.x+1,xe=Q.y+1,Ee=this.images[G].data,je=Ee.width,Ve=Ee.height;y.RGBAImage.copy(Ee,O,{x:0,y:0},{x:ge,y:xe},{width:je,height:Ve}),y.RGBAImage.copy(Ee,O,{x:0,y:Ve-1},{x:ge,y:xe-1},{width:je,height:1}),y.RGBAImage.copy(Ee,O,{x:0,y:0},{x:ge,y:xe+Ve},{width:je,height:1}),y.RGBAImage.copy(Ee,O,{x:je-1,y:0},{x:ge-1,y:xe},{width:1,height:Ve}),y.RGBAImage.copy(Ee,O,{x:0,y:0},{x:ge+je,y:xe},{width:1,height:Ve})}this.dirty=!0},d.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},d.prototype.dispatchRenderCallbacks=function(h){for(var g=0,w=h;g<w.length;g+=1){var M=w[g];if(!this.callbackDispatchedThisFrame[M]){this.callbackDispatchedThisFrame[M]=!0;var I=this.images[M];vr(I)&&this.updateImage(M,I)}}},d}(y.Evented),gr=Zt,qt=Zt,It=1e20;function Zt(f,d,h,g,w,M){this.fontSize=f||24,this.buffer=d===void 0?3:d,this.cutoff=g||.25,this.fontFamily=w||"sans-serif",this.fontWeight=M||"normal",this.radius=h||8;var I=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=I,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.d=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Int16Array(I),this.middle=Math.round(I/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function br(f,d,h,g,w,M,I){for(var O=0;O<d;O++){for(var G=0;G<h;G++)g[G]=f[G*d+O];for(J(g,w,M,I,h),G=0;G<h;G++)f[G*d+O]=w[G]}for(G=0;G<h;G++){for(O=0;O<d;O++)g[O]=f[G*d+O];for(J(g,w,M,I,d),O=0;O<d;O++)f[G*d+O]=Math.sqrt(w[O])}}function J(f,d,h,g,w){h[0]=0,g[0]=-It,g[1]=+It;for(var M=1,I=0;M<w;M++){for(var O=(f[M]+M*M-(f[h[I]]+h[I]*h[I]))/(2*M-2*h[I]);O<=g[I];)I--,O=(f[M]+M*M-(f[h[I]]+h[I]*h[I]))/(2*M-2*h[I]);h[++I]=M,g[I]=O,g[I+1]=+It}for(M=0,I=0;M<w;M++){for(;g[I+1]<M;)I++;d[M]=(M-h[I])*(M-h[I])+f[h[I]]}}Zt.prototype.draw=function(f){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(f,this.buffer,this.middle);for(var d=this.ctx.getImageData(0,0,this.size,this.size),h=new Uint8ClampedArray(this.size*this.size),g=0;g<this.size*this.size;g++){var w=d.data[4*g+3]/255;this.gridOuter[g]=w===1?0:w===0?It:Math.pow(Math.max(0,.5-w),2),this.gridInner[g]=w===1?It:w===0?0:Math.pow(Math.max(0,w-.5),2)}for(br(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),br(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),g=0;g<this.size*this.size;g++)h[g]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[g]-this.gridInner[g])/this.radius+this.cutoff))));return h},gr.default=qt;var Et=function(f,d){this.requestManager=f,this.localIdeographFontFamily=d,this.entries={}};Et.prototype.setURL=function(f){this.url=f},Et.prototype.getGlyphs=function(f,d){var h=this,g=[];for(var w in f)for(var M=0,I=f[w];M<I.length;M+=1)g.push({stack:w,id:I[M]});y.asyncAll(g,function(O,G){var Q=O.stack,ge=O.id,xe=h.entries[Q];xe||(xe=h.entries[Q]={glyphs:{},requests:{},ranges:{}});var Ee=xe.glyphs[ge];if(Ee===void 0){if(Ee=h._tinySDF(xe,Q,ge))return xe.glyphs[ge]=Ee,void G(null,{stack:Q,id:ge,glyph:Ee});var je=Math.floor(ge/256);if(256*je>65535)G(new Error("glyphs > 65535 not supported"));else if(xe.ranges[je])G(null,{stack:Q,id:ge,glyph:Ee});else{var Ve=xe.requests[je];Ve||(Ve=xe.requests[je]=[],Et.loadGlyphRange(Q,je,h.url,h.requestManager,function(nt,Fe){if(Fe){for(var it in Fe)h._doesCharSupportLocalGlyph(+it)||(xe.glyphs[+it]=Fe[+it]);xe.ranges[je]=!0}for(var yt=0,Bt=Ve;yt<Bt.length;yt+=1)(0,Bt[yt])(nt,Fe);delete xe.requests[je]})),Ve.push(function(nt,Fe){nt?G(nt):Fe&&G(null,{stack:Q,id:ge,glyph:Fe[ge]||null})})}}else G(null,{stack:Q,id:ge,glyph:Ee})},function(O,G){if(O)d(O);else if(G){for(var Q={},ge=0,xe=G;ge<xe.length;ge+=1){var Ee=xe[ge],je=Ee.stack,Ve=Ee.id,nt=Ee.glyph;(Q[je]||(Q[je]={}))[Ve]=nt&&{id:nt.id,bitmap:nt.bitmap.clone(),metrics:nt.metrics}}d(null,Q)}})},Et.prototype._doesCharSupportLocalGlyph=function(f){return!!this.localIdeographFontFamily&&(y.isChar["CJK Unified Ideographs"](f)||y.isChar["Hangul Syllables"](f)||y.isChar.Hiragana(f)||y.isChar.Katakana(f))},Et.prototype._tinySDF=function(f,d,h){var g=this.localIdeographFontFamily;if(g&&this._doesCharSupportLocalGlyph(h)){var w=f.tinySDF;if(!w){var M="400";/bold/i.test(d)?M="900":/medium/i.test(d)?M="500":/light/i.test(d)&&(M="200"),w=f.tinySDF=new Et.TinySDF(24,3,8,.25,g,M)}return{id:h,bitmap:new y.AlphaImage({width:30,height:30},w.draw(String.fromCharCode(h))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Et.loadGlyphRange=function(f,d,h,g,w){var M=256*d,I=M+255,O=g.transformRequest(g.normalizeGlyphsURL(h).replace("{fontstack}",f).replace("{range}",M+"-"+I),y.ResourceType.Glyphs);y.getArrayBuffer(O,function(G,Q){if(G)w(G);else if(Q){for(var ge={},xe=0,Ee=y.parseGlyphPBF(Q);xe<Ee.length;xe+=1){var je=Ee[xe];ge[je.id]=je}w(null,ge)}})},Et.TinySDF=gr;var Ct=function(){this.specification=y.styleSpec.light.position};Ct.prototype.possiblyEvaluate=function(f,d){return y.sphericalToCartesian(f.expression.evaluate(d))},Ct.prototype.interpolate=function(f,d,h){return{x:y.number(f.x,d.x,h),y:y.number(f.y,d.y,h),z:y.number(f.z,d.z,h)}};var pt=new y.Properties({anchor:new y.DataConstantProperty(y.styleSpec.light.anchor),position:new Ct,color:new y.DataConstantProperty(y.styleSpec.light.color),intensity:new y.DataConstantProperty(y.styleSpec.light.intensity)}),Ht=function(f){function d(h){f.call(this),this._transitionable=new y.Transitionable(pt),this.setLight(h),this._transitioning=this._transitionable.untransitioned()}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getLight=function(){return this._transitionable.serialize()},d.prototype.setLight=function(h,g){if(g===void 0&&(g={}),!this._validate(y.validateLight,h,g))for(var w in h){var M=h[w];y.endsWith(w,"-transition")?this._transitionable.setTransition(w.slice(0,-"-transition".length),M):this._transitionable.setValue(w,M)}},d.prototype.updateTransitions=function(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)},d.prototype.hasTransition=function(){return this._transitioning.hasTransition()},d.prototype.recalculate=function(h){this.properties=this._transitioning.possiblyEvaluate(h)},d.prototype._validate=function(h,g,w){return(!w||w.validate!==!1)&&y.emitValidationErrors(this,h.call(y.validateStyle,y.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:y.styleSpec})))},d}(y.Evented),vt=function(f,d){this.width=f,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};vt.prototype.getDash=function(f,d){var h=f.join(",")+String(d);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(f,d)),this.dashEntry[h]},vt.prototype.getDashRanges=function(f,d,h){var g=[],w=f.length%2==1?-f[f.length-1]*h:0,M=f[0]*h,I=!0;g.push({left:w,right:M,isDash:I,zeroLength:f[0]===0});for(var O=f[0],G=1;G<f.length;G++){var Q=f[G];g.push({left:w=O*h,right:M=(O+=Q)*h,isDash:I=!I,zeroLength:Q===0})}return g},vt.prototype.addRoundDash=function(f,d,h){for(var g=d/2,w=-h;w<=h;w++)for(var M=this.width*(this.nextRow+h+w),I=0,O=f[I],G=0;G<this.width;G++){G/O.right>1&&(O=f[++I]);var Q=Math.abs(G-O.left),ge=Math.abs(G-O.right),xe=Math.min(Q,ge),Ee=void 0,je=w/h*(g+1);if(O.isDash){var Ve=g-Math.abs(je);Ee=Math.sqrt(xe*xe+Ve*Ve)}else Ee=g-Math.sqrt(xe*xe+je*je);this.data[M+G]=Math.max(0,Math.min(255,Ee+128))}},vt.prototype.addRegularDash=function(f){for(var d=f.length-1;d>=0;--d){var h=f[d],g=f[d+1];h.zeroLength?f.splice(d,1):g&&g.isDash===h.isDash&&(g.left=h.left,f.splice(d,1))}var w=f[0],M=f[f.length-1];w.isDash===M.isDash&&(w.left=M.left-this.width,M.right=w.right+this.width);for(var I=this.width*this.nextRow,O=0,G=f[O],Q=0;Q<this.width;Q++){Q/G.right>1&&(G=f[++O]);var ge=Math.abs(Q-G.left),xe=Math.abs(Q-G.right),Ee=Math.min(ge,xe);this.data[I+Q]=Math.max(0,Math.min(255,(G.isDash?Ee:-Ee)+128))}},vt.prototype.addDash=function(f,d){var h=d?7:0,g=2*h+1;if(this.nextRow+g>this.height)return y.warnOnce("LineAtlas out of space"),null;for(var w=0,M=0;M<f.length;M++)w+=f[M];if(w!==0){var I=this.width/w,O=this.getDashRanges(f,this.width,I);d?this.addRoundDash(O,I,h):this.addRegularDash(O)}var G={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:w};return this.nextRow+=g,this.dirty=!0,G},vt.prototype.bind=function(f){var d=f.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))};var sr=function f(d,h){this.workerPool=d,this.actors=[],this.currentActor=0,this.id=y.uniqueId();for(var g=this.workerPool.acquire(this.id),w=0;w<g.length;w++){var M=new f.Actor(g[w],h,this.id);M.name="Worker "+w,this.actors.push(M)}};function Ir(f,d,h){var g=function(w,M){if(w)return h(w);if(M){var I=y.pick(y.extend(M,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);M.vector_layers&&(I.vectorLayers=M.vector_layers,I.vectorLayerIds=I.vectorLayers.map(function(O){return O.id})),I.tiles=d.canonicalizeTileset(I,f.url),h(null,I)}};return f.url?y.getJSON(d.transformRequest(d.normalizeSourceURL(f.url),y.ResourceType.Source),g):y.browser.frame(function(){return g(null,f)})}sr.prototype.broadcast=function(f,d,h){y.asyncAll(this.actors,function(g,w){g.send(f,d,w)},h=h||function(){})},sr.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},sr.prototype.remove=function(){this.actors.forEach(function(f){f.remove()}),this.actors=[],this.workerPool.release(this.id)},sr.Actor=y.Actor;var ae=function(f,d,h){this.bounds=y.LngLatBounds.convert(this.validateBounds(f)),this.minzoom=d||0,this.maxzoom=h||24};ae.prototype.validateBounds=function(f){return Array.isArray(f)&&f.length===4?[Math.max(-180,f[0]),Math.max(-90,f[1]),Math.min(180,f[2]),Math.min(90,f[3])]:[-180,-90,180,90]},ae.prototype.contains=function(f){var d=Math.pow(2,f.z),h=Math.floor(y.mercatorXfromLng(this.bounds.getWest())*d),g=Math.floor(y.mercatorYfromLat(this.bounds.getNorth())*d),w=Math.ceil(y.mercatorXfromLng(this.bounds.getEast())*d),M=Math.ceil(y.mercatorYfromLat(this.bounds.getSouth())*d);return f.x>=h&&f.x<w&&f.y>=g&&f.y<M};var Ze=function(f){function d(h,g,w,M){if(f.call(this),this.id=h,this.dispatcher=w,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.extend(this,y.pick(g,["url","scheme","tileSize","promoteId"])),this._options=y.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(M)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ir(this._options,this.map._requestManager,function(g,w){h._tileJSONRequest=null,h._loaded=!0,g?h.fire(new y.ErrorEvent(g)):w&&(y.extend(h,w),w.bounds&&(h.tileBounds=new ae(w.bounds,h.minzoom,h.maxzoom)),y.postTurnstileEvent(w.tiles,h.map._requestManager._customAccessToken),y.postMapLoadEvent(w.tiles,h.map._getMapId(),h.map._requestManager._skuToken,h.map._requestManager._customAccessToken),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setSourceProperty=function(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},d.prototype.setTiles=function(h){var g=this;return this.setSourceProperty(function(){g._options.tiles=h}),this},d.prototype.setUrl=function(h){var g=this;return this.setSourceProperty(function(){g.url=h,g._options.url=h}),this},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return y.extend({},this._options)},d.prototype.loadTile=function(h,g){var w=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),M={request:this.map._requestManager.transformRequest(w,y.ResourceType.Tile),uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function I(O,G){return delete h.request,h.aborted?g(null):O&&O.status!==404?g(O):(G&&G.resourceTiming&&(h.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&h.setExpiryData(G),h.loadVectorData(G,this.map.painter),y.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}M.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired"?h.state==="loading"?h.reloadCallback=g:h.request=h.actor.send("reloadTile",M,I.bind(this)):(h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",M,I.bind(this)))},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.unloadTile=function(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.hasTransition=function(){return!1},d}(y.Evented),Y=function(f){function d(h,g,w,M){f.call(this),this.id=h,this.dispatcher=w,this.setEventedParent(M),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.extend({type:"raster"},g),y.extend(this,y.pick(g,["url","scheme","tileSize"]))}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ir(this._options,this.map._requestManager,function(g,w){h._tileJSONRequest=null,h._loaded=!0,g?h.fire(new y.ErrorEvent(g)):w&&(y.extend(h,w),w.bounds&&(h.tileBounds=new ae(w.bounds,h.minzoom,h.maxzoom)),y.postTurnstileEvent(w.tiles),y.postMapLoadEvent(w.tiles,h.map._getMapId(),h.map._requestManager._skuToken),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return y.extend({},this._options)},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.loadTile=function(h,g){var w=this,M=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);h.request=y.getImage(this.map._requestManager.transformRequest(M,y.ResourceType.Tile),function(I,O){if(delete h.request,h.aborted)h.state="unloaded",g(null);else if(I)h.state="errored",g(I);else if(O){w.map._refreshExpiredTiles&&h.setExpiryData(O),delete O.cacheControl,delete O.expires;var G=w.map.painter.context,Q=G.gl;h.texture=w.map.painter.getTileTexture(O.width),h.texture?h.texture.update(O,{useMipmap:!0}):(h.texture=new y.Texture(G,O,Q.RGBA,{useMipmap:!0}),h.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE,Q.LINEAR_MIPMAP_NEAREST),G.extTextureFilterAnisotropic&&Q.texParameterf(Q.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax)),h.state="loaded",y.cacheEntryPossiblyAdded(w.dispatcher),g(null)}})},d.prototype.abortTile=function(h,g){h.request&&(h.request.cancel(),delete h.request),g()},d.prototype.unloadTile=function(h,g){h.texture&&this.map.painter.saveTileTexture(h.texture),g()},d.prototype.hasTransition=function(){return!1},d}(y.Evented),ce=function(f){function d(h,g,w,M){f.call(this,h,g,w,M),this.type="raster-dem",this.maxzoom=22,this._options=y.extend({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox"}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},d.prototype.loadTile=function(h,g){var w=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function M(I,O){I&&(h.state="errored",g(I)),O&&(h.dem=O,h.needsHillshadePrepare=!0,h.state="loaded",g(null))}h.request=y.getImage(this.map._requestManager.transformRequest(w,y.ResourceType.Tile),function(I,O){if(delete h.request,h.aborted)h.state="unloaded",g(null);else if(I)h.state="errored",g(I);else if(O){this.map._refreshExpiredTiles&&h.setExpiryData(O),delete O.cacheControl,delete O.expires;var G=y.window.ImageBitmap&&O instanceof y.window.ImageBitmap&&y.offscreenCanvasSupported()?O:y.browser.getImageData(O,1),Q={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:G,encoding:this.encoding};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",Q,M.bind(this)))}}.bind(this)),h.neighboringTiles=this._getNeighboringTiles(h.tileID)},d.prototype._getNeighboringTiles=function(h){var g=h.canonical,w=Math.pow(2,g.z),M=(g.x-1+w)%w,I=g.x===0?h.wrap-1:h.wrap,O=(g.x+1+w)%w,G=g.x+1===w?h.wrap+1:h.wrap,Q={};return Q[new y.OverscaledTileID(h.overscaledZ,I,g.z,M,g.y).key]={backfilled:!1},Q[new y.OverscaledTileID(h.overscaledZ,G,g.z,O,g.y).key]={backfilled:!1},g.y>0&&(Q[new y.OverscaledTileID(h.overscaledZ,I,g.z,M,g.y-1).key]={backfilled:!1},Q[new y.OverscaledTileID(h.overscaledZ,h.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},Q[new y.OverscaledTileID(h.overscaledZ,G,g.z,O,g.y-1).key]={backfilled:!1}),g.y+1<w&&(Q[new y.OverscaledTileID(h.overscaledZ,I,g.z,M,g.y+1).key]={backfilled:!1},Q[new y.OverscaledTileID(h.overscaledZ,h.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},Q[new y.OverscaledTileID(h.overscaledZ,G,g.z,O,g.y+1).key]={backfilled:!1}),Q},d.prototype.unloadTile=function(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded",h.actor&&h.actor.send("removeDEMTile",{uid:h.uid,source:this.id})},d}(Y),ue=function(f){function d(h,g,w,M){f.call(this),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=w.getActor(),this.setEventedParent(M),this._data=g.data,this._options=y.extend({},g),this._collectResourceTiming=g.collectResourceTiming,this._resourceTiming=[],g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId;var I=y.EXTENT/this.tileSize;this.workerOptions=y.extend({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:(g.buffer!==void 0?g.buffer:128)*I,tolerance:(g.tolerance!==void 0?g.tolerance:.375)*I,extent:y.EXTENT,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:g.clusterMaxZoom!==void 0?Math.min(g.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,g.clusterMinPoints||2),extent:y.EXTENT,radius:(g.clusterRadius||50)*I,log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)h.fire(new y.ErrorEvent(g));else{var w={dataType:"source",sourceDataType:"metadata"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(w.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new y.Event("data",w))}})},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setData=function(h){var g=this;return this._data=h,this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(w){if(w)g.fire(new y.ErrorEvent(w));else{var M={dataType:"source",sourceDataType:"content"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(M.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new y.Event("data",M))}}),this},d.prototype.getClusterExpansionZoom=function(h,g){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},g),this},d.prototype.getClusterChildren=function(h,g){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},g),this},d.prototype.getClusterLeaves=function(h,g,w,M){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:g,offset:w},M),this},d.prototype._updateWorkerData=function(h){var g=this;this._loaded=!1;var w=y.extend({},this.workerOptions),M=this._data;typeof M=="string"?(w.request=this.map._requestManager.transformRequest(y.browser.resolveURL(M),y.ResourceType.Source),w.request.collectResourceTiming=this._collectResourceTiming):w.data=JSON.stringify(M),this.actor.send(this.type+".loadData",w,function(I,O){g._removed||O&&O.abandoned||(g._loaded=!0,O&&O.resourceTiming&&O.resourceTiming[g.id]&&(g._resourceTiming=O.resourceTiming[g.id].slice(0)),g.actor.send(g.type+".coalesce",{source:w.source},null),h(I))})},d.prototype.loaded=function(){return this._loaded},d.prototype.loadTile=function(h,g){var w=this,M=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(M,{type:this.type,uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(I,O){return delete h.request,h.unloadVectorData(),h.aborted?g(null):I?g(I):(h.loadVectorData(O,w.map.painter,M==="reloadTile"),g(null))})},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0},d.prototype.unloadTile=function(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})},d.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},d.prototype.serialize=function(){return y.extend({},this._options,{type:this.type,data:this._data})},d.prototype.hasTransition=function(){return!1},d}(y.Evented),Xe=y.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),lt=function(f){function d(h,g,w,M){f.call(this),this.id=h,this.dispatcher=w,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(M),this.options=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(h,g){var w=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this.url=this.options.url,y.getImage(this.map._requestManager.transformRequest(this.url,y.ResourceType.Image),function(M,I){w._loaded=!0,M?w.fire(new y.ErrorEvent(M)):I&&(w.image=I,h&&(w.coordinates=h),g&&g(),w._finishLoading())})},d.prototype.loaded=function(){return this._loaded},d.prototype.updateImage=function(h){var g=this;return this.image&&h.url?(this.options.url=h.url,this.load(h.coordinates,function(){g.texture=null}),this):this},d.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})))},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setCoordinates=function(h){var g=this;this.coordinates=h;var w=h.map(y.MercatorCoordinate.fromLngLat);this.tileID=function(I){for(var O=1/0,G=1/0,Q=-1/0,ge=-1/0,xe=0,Ee=I;xe<Ee.length;xe+=1){var je=Ee[xe];O=Math.min(O,je.x),G=Math.min(G,je.y),Q=Math.max(Q,je.x),ge=Math.max(ge,je.y)}var Ve=Math.max(Q-O,ge-G),nt=Math.max(0,Math.floor(-Math.log(Ve)/Math.LN2)),Fe=Math.pow(2,nt);return new y.CanonicalTileID(nt,Math.floor((O+Q)/2*Fe),Math.floor((G+ge)/2*Fe))}(w),this.minzoom=this.maxzoom=this.tileID.z;var M=w.map(function(I){return g.tileID.getTilePoint(I)._round()});return this._boundsArray=new y.StructArrayLayout4i8,this._boundsArray.emplaceBack(M[0].x,M[0].y,0,0),this._boundsArray.emplaceBack(M[1].x,M[1].y,y.EXTENT,0),this._boundsArray.emplaceBack(M[3].x,M[3].y,0,y.EXTENT),this._boundsArray.emplaceBack(M[2].x,M[2].y,y.EXTENT,y.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})),this},d.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var h=this.map.painter.context,g=h.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Xe.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new y.Texture(h,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var M=this.tiles[w];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture)}}},d.prototype.loadTile=function(h,g){this.tileID&&this.tileID.equals(h.tileID.canonical)?(this.tiles[String(h.tileID.wrap)]=h,h.buckets={},g(null)):(h.state="errored",g(null))},d.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return!1},d}(y.Evented),_t=function(f){function d(h,g,w,M){f.call(this,h,g,w,M),this.roundZoom=!0,this.type="video",this.options=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1;var g=this.options;this.urls=[];for(var w=0,M=g.urls;w<M.length;w+=1)this.urls.push(this.map._requestManager.transformRequest(M[w],y.ResourceType.Source).url);y.getVideo(this.urls,function(I,O){h._loaded=!0,I?h.fire(new y.ErrorEvent(I)):O&&(h.video=O,h.video.loop=!0,h.video.setAttribute("playsinline",""),h.video.addEventListener("playing",function(){h.map.triggerRepaint()}),h.map&&h.video.play(),h._finishLoading())})},d.prototype.pause=function(){this.video&&this.video.pause()},d.prototype.play=function(){this.video&&this.video.play()},d.prototype.seek=function(h){if(this.video){var g=this.video.seekable;h<g.start(0)||h>g.end(0)?this.fire(new y.ErrorEvent(new y.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+g.start(0)+" and "+g.end(0)+"-second mark."))):this.video.currentTime=h}},d.prototype.getVideo=function(){return this.video},d.prototype.onAdd=function(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},d.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var h=this.map.painter.context,g=h.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Xe.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new y.Texture(h,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var M=this.tiles[w];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this.video&&!this.video.paused},d}(lt),Xt=function(f){function d(h,g,w,M){f.call(this,h,g,w,M),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some(function(I){return!Array.isArray(I)||I.length!==2||I.some(function(O){return typeof O!="number"})})||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof y.window.HTMLCanvasElement||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+h,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof y.window.HTMLCanvasElement?this.options.canvas:y.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},d.prototype.getCanvas=function(){return this.canvas},d.prototype.onAdd=function(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()},d.prototype.onRemove=function(){this.pause()},d.prototype.prepare=function(){var h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var g=this.map.painter.context,w=g.gl;for(var M in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,Xe.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y.Texture(g,this.canvas,w.RGBA,{premultiply:!0}),this.tiles){var I=this.tiles[M];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this._playing},d.prototype._hasInvalidDimensions=function(){for(var h=0,g=[this.canvas.width,this.canvas.height];h<g.length;h+=1){var w=g[h];if(isNaN(w)||w<=0)return!0}return!1},d}(lt),hr={vector:Ze,raster:Y,"raster-dem":ce,geojson:ue,video:_t,image:lt,canvas:Xt};function Yr(f,d){var h=y.identity([]);return y.translate(h,h,[1,1,0]),y.scale(h,h,[.5*f.width,.5*f.height,1]),y.multiply(h,h,f.calculatePosMatrix(d.toUnwrapped()))}function Hr(f,d,h,g,w,M){var I=function(nt,Fe,it){if(nt)for(var yt=0,Bt=nt;yt<Bt.length;yt+=1){var fr=Fe[Bt[yt]];if(fr&&fr.source===it&&fr.type==="fill-extrusion")return!0}else for(var ir in Fe){var mr=Fe[ir];if(mr.source===it&&mr.type==="fill-extrusion")return!0}return!1}(w&&w.layers,d,f.id),O=M.maxPitchScaleFactor(),G=f.tilesIn(g,O,I);G.sort(vi);for(var Q=[],ge=0,xe=G;ge<xe.length;ge+=1){var Ee=xe[ge];Q.push({wrappedTileID:Ee.tileID.wrapped().key,queryResults:Ee.tile.queryRenderedFeatures(d,h,f._state,Ee.queryGeometry,Ee.cameraQueryGeometry,Ee.scale,w,M,O,Yr(f.transform,Ee.tileID))})}var je=function(nt){for(var Fe={},it={},yt=0,Bt=nt;yt<Bt.length;yt+=1){var fr=Bt[yt],ir=fr.queryResults,mr=fr.wrappedTileID,Or=it[mr]=it[mr]||{};for(var on in ir)for(var jr=ir[on],Cn=Or[on]=Or[on]||{},ni=Fe[on]=Fe[on]||[],ii=0,oi=jr;ii<oi.length;ii+=1){var ta=oi[ii];Cn[ta.featureIndex]||(Cn[ta.featureIndex]=!0,ni.push(ta))}}return Fe}(Q);for(var Ve in je)je[Ve].forEach(function(nt){var Fe=nt.feature,it=f.getFeatureState(Fe.layer["source-layer"],Fe.id);Fe.source=Fe.layer.source,Fe.layer["source-layer"]&&(Fe.sourceLayer=Fe.layer["source-layer"]),Fe.state=it});return je}function vi(f,d){var h=f.tileID,g=d.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}var Vn=function(f,d){this.max=f,this.onRemove=d,this.reset()};Vn.prototype.reset=function(){for(var f in this.data)for(var d=0,h=this.data[f];d<h.length;d+=1){var g=h[d];g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value)}return this.data={},this.order=[],this},Vn.prototype.add=function(f,d,h){var g=this,w=f.wrapped().key;this.data[w]===void 0&&(this.data[w]=[]);var M={value:d,timeout:void 0};if(h!==void 0&&(M.timeout=setTimeout(function(){g.remove(f,M)},h)),this.data[w].push(M),this.order.push(w),this.order.length>this.max){var I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this},Vn.prototype.has=function(f){return f.wrapped().key in this.data},Vn.prototype.getAndRemove=function(f){return this.has(f)?this._getAndRemoveByKey(f.wrapped().key):null},Vn.prototype._getAndRemoveByKey=function(f){var d=this.data[f].shift();return d.timeout&&clearTimeout(d.timeout),this.data[f].length===0&&delete this.data[f],this.order.splice(this.order.indexOf(f),1),d.value},Vn.prototype.getByKey=function(f){var d=this.data[f];return d?d[0].value:null},Vn.prototype.get=function(f){return this.has(f)?this.data[f.wrapped().key][0].value:null},Vn.prototype.remove=function(f,d){if(!this.has(f))return this;var h=f.wrapped().key,g=d===void 0?0:this.data[h].indexOf(d),w=this.data[h][g];return this.data[h].splice(g,1),w.timeout&&clearTimeout(w.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(w.value),this.order.splice(this.order.indexOf(h),1),this},Vn.prototype.setMaxSize=function(f){for(this.max=f;this.order.length>this.max;){var d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this},Vn.prototype.filter=function(f){var d=[];for(var h in this.data)for(var g=0,w=this.data[h];g<w.length;g+=1){var M=w[g];f(M.value)||d.push(M)}for(var I=0,O=d;I<O.length;I+=1){var G=O[I];this.remove(G.value.tileID,G)}};var Xn=function(f,d,h){this.context=f;var g=f.gl;this.buffer=g.createBuffer(),this.dynamicDraw=Boolean(h),this.context.unbindVAO(),f.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};Xn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Xn.prototype.updateData=function(f){var d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,f.arrayBuffer)},Xn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ma={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Pi=function(f,d,h,g){this.length=d.length,this.attributes=h,this.itemSize=d.bytesPerElement,this.dynamicDraw=g,this.context=f;var w=f.gl;this.buffer=w.createBuffer(),f.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};Pi.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Pi.prototype.updateData=function(f){var d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,f.arrayBuffer)},Pi.prototype.enableAttributes=function(f,d){for(var h=0;h<this.attributes.length;h++){var g=d.attributes[this.attributes[h].name];g!==void 0&&f.enableVertexAttribArray(g)}},Pi.prototype.setVertexAttribPointers=function(f,d,h){for(var g=0;g<this.attributes.length;g++){var w=this.attributes[g],M=d.attributes[w.name];M!==void 0&&f.vertexAttribPointer(M,w.components,f[ma[w.type]],!1,this.itemSize,w.offset+this.itemSize*(h||0))}},Pi.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var mi=function(f){this.gl=f.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};mi.prototype.get=function(){return this.current},mi.prototype.set=function(f){},mi.prototype.getDefault=function(){return this.default},mi.prototype.setDefault=function(){this.set(this.default)};var ca=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return y.Color.transparent},d.prototype.set=function(h){var g=this.current;(h.r!==g.r||h.g!==g.g||h.b!==g.b||h.a!==g.a||this.dirty)&&(this.gl.clearColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(mi),Gi=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 1},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearDepth(h),this.current=h,this.dirty=!1)},d}(mi),Si=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearStencil(h),this.current=h,this.dirty=!1)},d}(mi),ei=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return[!0,!0,!0,!0]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]||this.dirty)&&(this.gl.colorMask(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(mi),cr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthMask(h),this.current=h,this.dirty=!1)},d}(mi),mt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 255},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.stencilMask(h),this.current=h,this.dirty=!1)},d}(mi),Wa=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},d.prototype.set=function(h){var g=this.current;(h.func!==g.func||h.ref!==g.ref||h.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(h.func,h.ref,h.mask),this.current=h,this.dirty=!1)},d}(mi),xa=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.KEEP,h.KEEP,h.KEEP]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(h[0],h[1],h[2]),this.current=h,this.dirty=!1)},d}(mi),gt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=h,this.dirty=!1}},d}(mi),he=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return[0,1]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||this.dirty)&&(this.gl.depthRange(h[0],h[1]),this.current=h,this.dirty=!1)},d}(mi),ie=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=h,this.dirty=!1}},d}(mi),_e=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.LESS},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthFunc(h),this.current=h,this.dirty=!1)},d}(mi),N=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.BLEND):g.disable(g.BLEND),this.current=h,this.dirty=!1}},d}(mi),qe=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.ONE,h.ZERO]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(h[0],h[1]),this.current=h,this.dirty=!1)},d}(mi),Qt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return y.Color.transparent},d.prototype.set=function(h){var g=this.current;(h.r!==g.r||h.g!==g.g||h.b!==g.b||h.a!==g.a||this.dirty)&&(this.gl.blendColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(mi),Nr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.FUNC_ADD},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.blendEquation(h),this.current=h,this.dirty=!1)},d}(mi),Ye=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;h?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=h,this.dirty=!1}},d}(mi),Pt=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.BACK},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.cullFace(h),this.current=h,this.dirty=!1)},d}(mi),pr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.CCW},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.frontFace(h),this.current=h,this.dirty=!1)},d}(mi),Pr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)},d}(mi),Wr=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.TEXTURE0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.activeTexture(h),this.current=h,this.dirty=!1)},d}(mi),tn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[0,0,h.drawingBufferWidth,h.drawingBufferHeight]},d.prototype.set=function(h){var g=this.current;(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3]||this.dirty)&&(this.gl.viewport(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(mi),Yn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,h),this.current=h,this.dirty=!1}},d}(mi),jn=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(mi),an=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindTexture(g.TEXTURE_2D,h),this.current=h,this.dirty=!1}},d}(mi),gi=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,h),this.current=h,this.dirty=!1}},d}(mi),ci=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){var g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,h),this.current=h,this.dirty=!1},d}(mi),fa=function(f){function d(h){f.call(this,h),this.vao=h.extVertexArrayObject}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){this.vao&&(h!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(h),this.current=h,this.dirty=!1)},d}(mi),ka=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return 4},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,h),this.current=h,this.dirty=!1}},d}(mi),Ua=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),this.current=h,this.dirty=!1}},d}(mi),Ea=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,h),this.current=h,this.dirty=!1}},d}(mi),Wi=function(f){function d(h,g){f.call(this,h),this.context=h,this.parent=g}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d}(mi),q=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.setDirty=function(){this.dirty=!0},d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,h,0),this.current=h,this.dirty=!1}},d}(Wi),re=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(Wi),le=function(f,d,h,g){this.context=f,this.width=d,this.height=h;var w=this.framebuffer=f.gl.createFramebuffer();this.colorAttachment=new q(f,w),g&&(this.depthAttachment=new re(f,w))};le.prototype.destroy=function(){var f=this.context.gl,d=this.colorAttachment.get();if(d&&f.deleteTexture(d),this.depthAttachment){var h=this.depthAttachment.get();h&&f.deleteRenderbuffer(h)}f.deleteFramebuffer(this.framebuffer)};var Ce=function(f,d,h){this.func=f,this.mask=d,this.range=h};Ce.ReadOnly=!1,Ce.ReadWrite=!0,Ce.disabled=new Ce(519,Ce.ReadOnly,[0,1]);var Be=function(f,d,h,g,w,M){this.test=f,this.ref=d,this.mask=h,this.fail=g,this.depthFail=w,this.pass=M};Be.disabled=new Be({func:519,mask:0},0,0,7680,7680,7680);var et=function(f,d,h){this.blendFunction=f,this.blendColor=d,this.mask=h};et.disabled=new et(et.Replace=[1,0],y.Color.transparent,[!1,!1,!1,!1]),et.unblended=new et(et.Replace,y.Color.transparent,[!0,!0,!0,!0]),et.alphaBlended=new et([1,771],y.Color.transparent,[!0,!0,!0,!0]);var dt=function(f,d,h){this.enable=f,this.mode=d,this.frontFace=h};dt.disabled=new dt(!1,1029,2305),dt.backCCW=new dt(!0,1029,2305);var me=function(f){this.gl=f,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ca(this),this.clearDepth=new Gi(this),this.clearStencil=new Si(this),this.colorMask=new ei(this),this.depthMask=new cr(this),this.stencilMask=new mt(this),this.stencilFunc=new Wa(this),this.stencilOp=new xa(this),this.stencilTest=new gt(this),this.depthRange=new he(this),this.depthTest=new ie(this),this.depthFunc=new _e(this),this.blend=new N(this),this.blendFunc=new qe(this),this.blendColor=new Qt(this),this.blendEquation=new Nr(this),this.cullFace=new Ye(this),this.cullFaceSide=new Pt(this),this.frontFace=new pr(this),this.program=new Pr(this),this.activeTexture=new Wr(this),this.viewport=new tn(this),this.bindFramebuffer=new Yn(this),this.bindRenderbuffer=new jn(this),this.bindTexture=new an(this),this.bindVertexBuffer=new gi(this),this.bindElementBuffer=new ci(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new fa(this),this.pixelStoreUnpack=new ka(this),this.pixelStoreUnpackPremultiplyAlpha=new Ua(this),this.pixelStoreUnpackFlipY=new Ea(this),this.extTextureFilterAnisotropic=f.getExtension("EXT_texture_filter_anisotropic")||f.getExtension("MOZ_EXT_texture_filter_anisotropic")||f.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=f.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=f.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(f.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=f.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=f.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=f.getParameter(f.MAX_TEXTURE_SIZE)};me.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},me.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},me.prototype.createIndexBuffer=function(f,d){return new Xn(this,f,d)},me.prototype.createVertexBuffer=function(f,d,h){return new Pi(this,f,d,h)},me.prototype.createRenderbuffer=function(f,d,h){var g=this.gl,w=g.createRenderbuffer();return this.bindRenderbuffer.set(w),g.renderbufferStorage(g.RENDERBUFFER,f,d,h),this.bindRenderbuffer.set(null),w},me.prototype.createFramebuffer=function(f,d,h){return new le(this,f,d,h)},me.prototype.clear=function(f){var d=f.color,h=f.depth,g=this.gl,w=0;d&&(w|=g.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(w|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g.clear(w)},me.prototype.setCullFace=function(f){f.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(f.mode),this.frontFace.set(f.frontFace))},me.prototype.setDepthMode=function(f){f.func!==this.gl.ALWAYS||f.mask?(this.depthTest.set(!0),this.depthFunc.set(f.func),this.depthMask.set(f.mask),this.depthRange.set(f.range)):this.depthTest.set(!1)},me.prototype.setStencilMode=function(f){f.test.func!==this.gl.ALWAYS||f.mask?(this.stencilTest.set(!0),this.stencilMask.set(f.mask),this.stencilOp.set([f.fail,f.depthFail,f.pass]),this.stencilFunc.set({func:f.test.func,ref:f.ref,mask:f.test.mask})):this.stencilTest.set(!1)},me.prototype.setColorMode=function(f){y.deepEqual(f.blendFunction,et.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(f.blendFunction),this.blendColor.set(f.blendColor)),this.colorMask.set(f.mask)},me.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Ge=function(f){function d(h,g,w){var M=this;f.call(this),this.id=h,this.dispatcher=w,this.on("data",function(I){I.dataType==="source"&&I.sourceDataType==="metadata"&&(M._sourceLoaded=!0),M._sourceLoaded&&!M._paused&&I.dataType==="source"&&I.sourceDataType==="content"&&(M.reload(),M.transform&&M.update(M.transform))}),this.on("error",function(){M._sourceErrored=!0}),this._source=function(I,O,G,Q){var ge=new hr[O.type](I,O,G,Q);if(ge.id!==I)throw new Error("Expected Source id to be "+I+" instead of "+ge.id);return y.bindAll(["load","abort","unload","serialize","prepare"],ge),ge}(h,g,w,this),this._tiles={},this._cache=new Vn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new y.SourceFeatureState}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.onAdd=function(h){this.map=h,this._maxTileCacheSize=h?h._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(h)},d.prototype.onRemove=function(h){this._source&&this._source.onRemove&&this._source.onRemove(h)},d.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var h in this._tiles){var g=this._tiles[h];if(g.state!=="loaded"&&g.state!=="errored")return!1}return!0},d.prototype.getSource=function(){return this._source},d.prototype.pause=function(){this._paused=!0},d.prototype.resume=function(){if(this._paused){var h=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,h&&this.reload(),this.transform&&this.update(this.transform)}},d.prototype._loadTile=function(h,g){return this._source.loadTile(h,g)},d.prototype._unloadTile=function(h){if(this._source.unloadTile)return this._source.unloadTile(h,function(){})},d.prototype._abortTile=function(h){if(this._source.abortTile)return this._source.abortTile(h,function(){})},d.prototype.serialize=function(){return this._source.serialize()},d.prototype.prepare=function(h){for(var g in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var w=this._tiles[g];w.upload(h),w.prepare(this.map.style.imageManager)}},d.prototype.getIds=function(){return y.values(this._tiles).map(function(h){return h.tileID}).sort(Dt).map(function(h){return h.key})},d.prototype.getRenderableIds=function(h){var g=this,w=[];for(var M in this._tiles)this._isIdRenderable(M,h)&&w.push(this._tiles[M]);return h?w.sort(function(I,O){var G=I.tileID,Q=O.tileID,ge=new y.Point(G.canonical.x,G.canonical.y)._rotate(g.transform.angle),xe=new y.Point(Q.canonical.x,Q.canonical.y)._rotate(g.transform.angle);return G.overscaledZ-Q.overscaledZ||xe.y-ge.y||xe.x-ge.x}).map(function(I){return I.tileID.key}):w.map(function(I){return I.tileID}).sort(Dt).map(function(I){return I.key})},d.prototype.hasRenderableParent=function(h){var g=this.findLoadedParent(h,0);return!!g&&this._isIdRenderable(g.tileID.key)},d.prototype._isIdRenderable=function(h,g){return this._tiles[h]&&this._tiles[h].hasData()&&!this._coveredTiles[h]&&(g||!this._tiles[h].holdingForFade())},d.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var h in this._cache.reset(),this._tiles)this._tiles[h].state!=="errored"&&this._reloadTile(h,"reloading")},d.prototype._reloadTile=function(h,g){var w=this._tiles[h];w&&(w.state!=="loading"&&(w.state=g),this._loadTile(w,this._tileLoaded.bind(this,w,h,g)))},d.prototype._tileLoaded=function(h,g,w,M){if(M)return h.state="errored",void(M.status!==404?this._source.fire(new y.ErrorEvent(M,{tile:h})):this.update(this.transform));h.timeAdded=y.browser.now(),w==="expired"&&(h.refreshedUponExpiration=!0),this._setTileReloadTimer(g,h),this.getSource().type==="raster-dem"&&h.dem&&this._backfillDEM(h),this._state.initializeTileState(h,this.map?this.map.painter:null),this._source.fire(new y.Event("data",{dataType:"source",tile:h,coord:h.tileID}))},d.prototype._backfillDEM=function(h){for(var g=this.getRenderableIds(),w=0;w<g.length;w++){var M=g[w];if(h.neighboringTiles&&h.neighboringTiles[M]){var I=this.getTileByID(M);O(h,I),O(I,h)}}function O(G,Q){G.needsHillshadePrepare=!0;var ge=Q.tileID.canonical.x-G.tileID.canonical.x,xe=Q.tileID.canonical.y-G.tileID.canonical.y,Ee=Math.pow(2,G.tileID.canonical.z),je=Q.tileID.key;ge===0&&xe===0||Math.abs(xe)>1||(Math.abs(ge)>1&&(Math.abs(ge+Ee)===1?ge+=Ee:Math.abs(ge-Ee)===1&&(ge-=Ee)),Q.dem&&G.dem&&(G.dem.backfillBorder(Q.dem,ge,xe),G.neighboringTiles&&G.neighboringTiles[je]&&(G.neighboringTiles[je].backfilled=!0)))}},d.prototype.getTile=function(h){return this.getTileByID(h.key)},d.prototype.getTileByID=function(h){return this._tiles[h]},d.prototype._retainLoadedChildren=function(h,g,w,M){for(var I in this._tiles){var O=this._tiles[I];if(!(M[I]||!O.hasData()||O.tileID.overscaledZ<=g||O.tileID.overscaledZ>w)){for(var G=O.tileID;O&&O.tileID.overscaledZ>g+1;){var Q=O.tileID.scaledTo(O.tileID.overscaledZ-1);(O=this._tiles[Q.key])&&O.hasData()&&(G=Q)}for(var ge=G;ge.overscaledZ>g;)if(h[(ge=ge.scaledTo(ge.overscaledZ-1)).key]){M[G.key]=G;break}}}},d.prototype.findLoadedParent=function(h,g){if(h.key in this._loadedParentTiles){var w=this._loadedParentTiles[h.key];return w&&w.tileID.overscaledZ>=g?w:null}for(var M=h.overscaledZ-1;M>=g;M--){var I=h.scaledTo(M),O=this._getLoadedTile(I);if(O)return O}},d.prototype._getLoadedTile=function(h){var g=this._tiles[h.key];return g&&g.hasData()?g:this._cache.getByKey(h.wrapped().key)},d.prototype.updateCacheSize=function(h){var g=Math.ceil(h.width/this._source.tileSize)+1,w=Math.ceil(h.height/this._source.tileSize)+1,M=Math.floor(g*w*5),I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,M):M;this._cache.setMaxSize(I)},d.prototype.handleWrapJump=function(h){var g=Math.round((h-(this._prevLng===void 0?h:this._prevLng))/360);if(this._prevLng=h,g){var w={};for(var M in this._tiles){var I=this._tiles[M];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+g),w[I.tileID.key]=I}for(var O in this._tiles=w,this._timers)clearTimeout(this._timers[O]),delete this._timers[O];for(var G in this._tiles)this._setTileReloadTimer(G,this._tiles[G])}},d.prototype.update=function(h){var g=this;if(this.transform=h,this._sourceLoaded&&!this._paused){var w;this.updateCacheSize(h),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?w=h.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Or){return new y.OverscaledTileID(Or.canonical.z,Or.wrap,Or.canonical.z,Or.canonical.x,Or.canonical.y)}):(w=h.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(w=w.filter(function(Or){return g._source.hasTile(Or)}))):w=[];var M=h.coveringZoomLevel(this._source),I=Math.max(M-d.maxOverzooming,this._source.minzoom),O=Math.max(M+d.maxUnderzooming,this._source.minzoom),G=this._updateRetainedTiles(w,M);if(Lr(this._source.type)){for(var Q={},ge={},xe=0,Ee=Object.keys(G);xe<Ee.length;xe+=1){var je=Ee[xe],Ve=G[je],nt=this._tiles[je];if(nt&&!(nt.fadeEndTime&&nt.fadeEndTime<=y.browser.now())){var Fe=this.findLoadedParent(Ve,I);Fe&&(this._addTile(Fe.tileID),Q[Fe.tileID.key]=Fe.tileID),ge[je]=Ve}}for(var it in this._retainLoadedChildren(ge,M,O,G),Q)G[it]||(this._coveredTiles[it]=!0,G[it]=Q[it])}for(var yt in G)this._tiles[yt].clearFadeHold();for(var Bt=0,fr=y.keysDifference(this._tiles,G);Bt<fr.length;Bt+=1){var ir=fr[Bt],mr=this._tiles[ir];mr.hasSymbolBuckets&&!mr.holdingForFade()?mr.setHoldDuration(this.map._fadeDuration):mr.hasSymbolBuckets&&!mr.symbolFadeFinished()||this._removeTile(ir)}this._updateLoadedParentTileCache()}},d.prototype.releaseSymbolFadeTiles=function(){for(var h in this._tiles)this._tiles[h].holdingForFade()&&this._removeTile(h)},d.prototype._updateRetainedTiles=function(h,g){for(var w={},M={},I=Math.max(g-d.maxOverzooming,this._source.minzoom),O=Math.max(g+d.maxUnderzooming,this._source.minzoom),G={},Q=0,ge=h;Q<ge.length;Q+=1){var xe=ge[Q],Ee=this._addTile(xe);w[xe.key]=xe,Ee.hasData()||g<this._source.maxzoom&&(G[xe.key]=xe)}this._retainLoadedChildren(G,g,O,w);for(var je=0,Ve=h;je<Ve.length;je+=1){var nt=Ve[je],Fe=this._tiles[nt.key];if(!Fe.hasData()){if(g+1>this._source.maxzoom){var it=nt.children(this._source.maxzoom)[0],yt=this.getTile(it);if(yt&&yt.hasData()){w[it.key]=it;continue}}else{var Bt=nt.children(this._source.maxzoom);if(w[Bt[0].key]&&w[Bt[1].key]&&w[Bt[2].key]&&w[Bt[3].key])continue}for(var fr=Fe.wasRequested(),ir=nt.overscaledZ-1;ir>=I;--ir){var mr=nt.scaledTo(ir);if(M[mr.key]||(M[mr.key]=!0,!(Fe=this.getTile(mr))&&fr&&(Fe=this._addTile(mr)),Fe&&(w[mr.key]=mr,fr=Fe.wasRequested(),Fe.hasData())))break}}}return w},d.prototype._updateLoadedParentTileCache=function(){for(var h in this._loadedParentTiles={},this._tiles){for(var g=[],w=void 0,M=this._tiles[h].tileID;M.overscaledZ>0;){if(M.key in this._loadedParentTiles){w=this._loadedParentTiles[M.key];break}g.push(M.key);var I=M.scaledTo(M.overscaledZ-1);if(w=this._getLoadedTile(I))break;M=I}for(var O=0,G=g;O<G.length;O+=1)this._loadedParentTiles[G[O]]=w}},d.prototype._addTile=function(h){var g=this._tiles[h.key];if(g)return g;(g=this._cache.getAndRemove(h))&&(this._setTileReloadTimer(h.key,g),g.tileID=h,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[h.key]&&(clearTimeout(this._cacheTimers[h.key]),delete this._cacheTimers[h.key],this._setTileReloadTimer(h.key,g)));var w=Boolean(g);return w||(g=new y.Tile(h,this._source.tileSize*h.overscaleFactor()),this._loadTile(g,this._tileLoaded.bind(this,g,h.key,g.state))),g?(g.uses++,this._tiles[h.key]=g,w||this._source.fire(new y.Event("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g):null},d.prototype._setTileReloadTimer=function(h,g){var w=this;h in this._timers&&(clearTimeout(this._timers[h]),delete this._timers[h]);var M=g.getExpiryTimeout();M&&(this._timers[h]=setTimeout(function(){w._reloadTile(h,"expired"),delete w._timers[h]},M))},d.prototype._removeTile=function(h){var g=this._tiles[h];g&&(g.uses--,delete this._tiles[h],this._timers[h]&&(clearTimeout(this._timers[h]),delete this._timers[h]),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))},d.prototype.clearTiles=function(){for(var h in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(h);this._cache.reset()},d.prototype.tilesIn=function(h,g,w){var M=this,I=[],O=this.transform;if(!O)return I;for(var G=w?O.getCameraQueryGeometry(h):h,Q=h.map(function(ir){return O.pointCoordinate(ir)}),ge=G.map(function(ir){return O.pointCoordinate(ir)}),xe=this.getIds(),Ee=1/0,je=1/0,Ve=-1/0,nt=-1/0,Fe=0,it=ge;Fe<it.length;Fe+=1){var yt=it[Fe];Ee=Math.min(Ee,yt.x),je=Math.min(je,yt.y),Ve=Math.max(Ve,yt.x),nt=Math.max(nt,yt.y)}for(var Bt=function(ir){var mr=M._tiles[xe[ir]];if(!mr.holdingForFade()){var Or=mr.tileID,on=Math.pow(2,O.zoom-mr.tileID.overscaledZ),jr=g*mr.queryPadding*y.EXTENT/mr.tileSize/on,Cn=[Or.getTilePoint(new y.MercatorCoordinate(Ee,je)),Or.getTilePoint(new y.MercatorCoordinate(Ve,nt))];if(Cn[0].x-jr<y.EXTENT&&Cn[0].y-jr<y.EXTENT&&Cn[1].x+jr>=0&&Cn[1].y+jr>=0){var ni=Q.map(function(oi){return Or.getTilePoint(oi)}),ii=ge.map(function(oi){return Or.getTilePoint(oi)});I.push({tile:mr,tileID:Or,queryGeometry:ni,cameraQueryGeometry:ii,scale:on})}}},fr=0;fr<xe.length;fr++)Bt(fr);return I},d.prototype.getVisibleCoordinates=function(h){for(var g=this,w=this.getRenderableIds(h).map(function(G){return g._tiles[G].tileID}),M=0,I=w;M<I.length;M+=1){var O=I[M];O.posMatrix=this.transform.calculatePosMatrix(O.toUnwrapped())}return w},d.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Lr(this._source.type))for(var h in this._tiles){var g=this._tiles[h];if(g.fadeEndTime!==void 0&&g.fadeEndTime>=y.browser.now())return!0}return!1},d.prototype.setFeatureState=function(h,g,w){this._state.updateState(h=h||"_geojsonTileLayer",g,w)},d.prototype.removeFeatureState=function(h,g,w){this._state.removeFeatureState(h=h||"_geojsonTileLayer",g,w)},d.prototype.getFeatureState=function(h,g){return this._state.getState(h=h||"_geojsonTileLayer",g)},d.prototype.setDependencies=function(h,g,w){var M=this._tiles[h];M&&M.setDependencies(g,w)},d.prototype.reloadTilesForDependencies=function(h,g){for(var w in this._tiles)this._tiles[w].hasDependency(h,g)&&this._reloadTile(w,"reloading");this._cache.filter(function(M){return!M.hasDependency(h,g)})},d}(y.Evented);function Dt(f,d){var h=Math.abs(2*f.wrap)-+(f.wrap<0),g=Math.abs(2*d.wrap)-+(d.wrap<0);return f.overscaledZ-d.overscaledZ||g-h||d.canonical.y-f.canonical.y||d.canonical.x-f.canonical.x}function Lr(f){return f==="raster"||f==="image"||f==="video"}function er(){return new y.window.Worker(bc.workerUrl)}Ge.maxOverzooming=10,Ge.maxUnderzooming=3;var tr="mapboxgl_preloaded_worker_pool",Fr=function(){this.active={}};Fr.prototype.acquire=function(f){if(!this.workers)for(this.workers=[];this.workers.length<Fr.workerCount;)this.workers.push(new er);return this.active[f]=!0,this.workers.slice()},Fr.prototype.release=function(f){delete this.active[f],this.numActive()===0&&(this.workers.forEach(function(d){d.terminate()}),this.workers=null)},Fr.prototype.isPreloaded=function(){return!!this.active[tr]},Fr.prototype.numActive=function(){return Object.keys(this.active).length};var In,Pn=Math.floor(y.browser.hardwareConcurrency/2);function $t(){return In||(In=new Fr),In}function wn(f,d){var h={};for(var g in f)g!=="ref"&&(h[g]=f[g]);return y.refProperties.forEach(function(w){w in d&&(h[w]=d[w])}),h}function fn(f){f=f.slice();for(var d=Object.create(null),h=0;h<f.length;h++)d[f[h].id]=f[h];for(var g=0;g<f.length;g++)"ref"in f[g]&&(f[g]=wn(f[g],d[f[g].ref]));return f}Fr.workerCount=Math.max(Math.min(Pn,6),1);var gn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ii(f,d,h){h.push({command:gn.addSource,args:[f,d[f]]})}function xn(f,d,h){d.push({command:gn.removeSource,args:[f]}),h[f]=!0}function Ni(f,d,h,g){xn(f,h,g),Ii(f,d,h)}function sa(f,d,h){var g;for(g in f[h])if(f[h].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(f[h][g],d[h][g]))return!1;for(g in d[h])if(d[h].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(f[h][g],d[h][g]))return!1;return!0}function Oi(f,d,h,g,w,M){var I;for(I in d=d||{},f=f||{})f.hasOwnProperty(I)&&(y.deepEqual(f[I],d[I])||h.push({command:M,args:[g,I,d[I],w]}));for(I in d)d.hasOwnProperty(I)&&!f.hasOwnProperty(I)&&(y.deepEqual(f[I],d[I])||h.push({command:M,args:[g,I,d[I],w]}))}function Zi(f){return f.id}function Fi(f,d){return f[d.id]=d,f}var yi=function(f,d){this.reset(f,d)};yi.prototype.reset=function(f,d){this.points=f||[],this._distances=[0];for(var h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding},yi.prototype.lerp=function(f){if(this.points.length===1)return this.points[0];f=y.clamp(f,0,1);for(var d=1,h=this._distances[d],g=f*this.paddedLength+this.padding;h<g&&d<this._distances.length;)h=this._distances[++d];var w=d-1,M=this._distances[w],I=h-M,O=I>0?(g-M)/I:0;return this.points[w].mult(1-O).add(this.points[d].mult(O))};var ha=function(f,d,h){var g=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(f/h),this.yCellCount=Math.ceil(d/h);for(var M=0;M<this.xCellCount*this.yCellCount;M++)g.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=f,this.height=d,this.xScale=this.xCellCount/f,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0};function Xa(f,d,h,g,w){var M=y.create();return d?(y.scale(M,M,[1/w,1/w,1]),h||y.rotateZ(M,M,g.angle)):y.multiply(M,g.labelPlaneMatrix,f),M}function ga(f,d,h,g,w){if(d){var M=y.clone(f);return y.scale(M,M,[w,w,1]),h||y.rotateZ(M,M,-g.angle),M}return g.glCoordMatrix}function zi(f,d){var h=[f.x,f.y,0,1];Ja(h,h,d);var g=h[3];return{point:new y.Point(h[0]/g,h[1]/g),signedDistanceFromCamera:g}}function Ji(f,d){return .5+f/d*.5}function Va(f,d){var h=f[0]/f[3],g=f[1]/f[3];return h>=-d[0]&&h<=d[0]&&g>=-d[1]&&g<=d[1]}function tu(f,d,h,g,w,M,I,O){var G=g?f.textSizeData:f.iconSizeData,Q=y.evaluateSizeForZoom(G,h.transform.zoom),ge=[256/h.width*2+1,256/h.height*2+1],xe=g?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;xe.clear();for(var Ee=f.lineVertexArray,je=g?f.text.placedSymbolArray:f.icon.placedSymbolArray,Ve=h.transform.width/h.transform.height,nt=!1,Fe=0;Fe<je.length;Fe++){var it=je.get(Fe);if(it.hidden||it.writingMode===y.WritingMode.vertical&&!nt)uo(it.numGlyphs,xe);else{nt=!1;var yt=[it.anchorX,it.anchorY,0,1];if(y.transformMat4(yt,yt,d),Va(yt,ge)){var Bt=Ji(h.transform.cameraToCenterDistance,yt[3]),fr=y.evaluateSizeForFeature(G,Q,it),ir=I?fr/Bt:fr*Bt,mr=new y.Point(it.anchorX,it.anchorY),Or=zi(mr,w).point,on={},jr=Fs(it,ir,!1,O,d,w,M,f.glyphOffsetArray,Ee,xe,Or,mr,on,Ve);nt=jr.useVertical,(jr.notEnoughRoom||nt||jr.needsFlipping&&Fs(it,ir,!0,O,d,w,M,f.glyphOffsetArray,Ee,xe,Or,mr,on,Ve).notEnoughRoom)&&uo(it.numGlyphs,xe)}else uo(it.numGlyphs,xe)}}g?f.text.dynamicLayoutVertexBuffer.updateData(xe):f.icon.dynamicLayoutVertexBuffer.updateData(xe)}function $a(f,d,h,g,w,M,I,O,G,Q,ge){var xe=O.glyphStartIndex+O.numGlyphs,Ee=O.lineStartIndex,je=O.lineStartIndex+O.lineLength,Ve=d.getoffsetX(O.glyphStartIndex),nt=d.getoffsetX(xe-1),Fe=ur(f*Ve,h,g,w,M,I,O.segment,Ee,je,G,Q,ge);if(!Fe)return null;var it=ur(f*nt,h,g,w,M,I,O.segment,Ee,je,G,Q,ge);return it?{first:Fe,last:it}:null}function Fa(f,d,h,g){return f===y.WritingMode.horizontal&&Math.abs(h.y-d.y)>Math.abs(h.x-d.x)*g?{useVertical:!0}:(f===y.WritingMode.vertical?d.y<h.y:d.x>h.x)?{needsFlipping:!0}:null}function Fs(f,d,h,g,w,M,I,O,G,Q,ge,xe,Ee,je){var Ve,nt=d/24,Fe=f.lineOffsetX*nt,it=f.lineOffsetY*nt;if(f.numGlyphs>1){var yt=f.glyphStartIndex+f.numGlyphs,Bt=f.lineStartIndex,fr=f.lineStartIndex+f.lineLength,ir=$a(nt,O,Fe,it,h,ge,xe,f,G,M,Ee);if(!ir)return{notEnoughRoom:!0};var mr=zi(ir.first.point,I).point,Or=zi(ir.last.point,I).point;if(g&&!h){var on=Fa(f.writingMode,mr,Or,je);if(on)return on}Ve=[ir.first];for(var jr=f.glyphStartIndex+1;jr<yt-1;jr++)Ve.push(ur(nt*O.getoffsetX(jr),Fe,it,h,ge,xe,f.segment,Bt,fr,G,M,Ee));Ve.push(ir.last)}else{if(g&&!h){var Cn=zi(xe,w).point,ni=f.lineStartIndex+f.segment+1,ii=new y.Point(G.getx(ni),G.gety(ni)),oi=zi(ii,w),ta=oi.signedDistanceFromCamera>0?oi.point:$n(xe,ii,Cn,1,w),An=Fa(f.writingMode,Cn,ta,je);if(An)return An}var Ci=ur(nt*O.getoffsetX(f.glyphStartIndex),Fe,it,h,ge,xe,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,G,M,Ee);if(!Ci)return{notEnoughRoom:!0};Ve=[Ci]}for(var En=0,li=Ve;En<li.length;En+=1){var Jn=li[En];y.addDynamicAttributes(Q,Jn.point,Jn.angle)}return{}}function $n(f,d,h,g,w){var M=zi(f.add(f.sub(d)._unit()),w).point,I=h.sub(M);return h.add(I._mult(g/I.mag()))}function ur(f,d,h,g,w,M,I,O,G,Q,ge,xe){var Ee=g?f-d:f+d,je=Ee>0?1:-1,Ve=0;g&&(je*=-1,Ve=Math.PI),je<0&&(Ve+=Math.PI);for(var nt=je>0?O+I:O+I+1,Fe=w,it=w,yt=0,Bt=0,fr=Math.abs(Ee),ir=[];yt+Bt<=fr;){if((nt+=je)<O||nt>=G)return null;if(it=Fe,ir.push(Fe),(Fe=xe[nt])===void 0){var mr=new y.Point(Q.getx(nt),Q.gety(nt)),Or=zi(mr,ge);if(Or.signedDistanceFromCamera>0)Fe=xe[nt]=Or.point;else{var on=nt-je;Fe=$n(yt===0?M:new y.Point(Q.getx(on),Q.gety(on)),mr,it,fr-yt+1,ge)}}yt+=Bt,Bt=it.dist(Fe)}var jr=(fr-yt)/Bt,Cn=Fe.sub(it),ni=Cn.mult(jr)._add(it);ni._add(Cn._unit()._perp()._mult(h*je));var ii=Ve+Math.atan2(Fe.y-it.y,Fe.x-it.x);return ir.push(ni),{point:ni,angle:ii,path:ir}}ha.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},ha.prototype.insert=function(f,d,h,g,w){this._forEachCell(d,h,g,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(f),this.bboxes.push(d),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(w)},ha.prototype.insertCircle=function(f,d,h,g){this._forEachCell(d-g,h-g,d+g,h+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(f),this.circles.push(d),this.circles.push(h),this.circles.push(g)},ha.prototype._insertBoxCell=function(f,d,h,g,w,M){this.boxCells[w].push(M)},ha.prototype._insertCircleCell=function(f,d,h,g,w,M){this.circleCells[w].push(M)},ha.prototype._query=function(f,d,h,g,w,M){if(h<0||f>this.width||g<0||d>this.height)return!w&&[];var I=[];if(f<=0&&d<=0&&this.width<=h&&this.height<=g){if(w)return!0;for(var O=0;O<this.boxKeys.length;O++)I.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(var G=0;G<this.circleKeys.length;G++){var Q=this.circles[3*G],ge=this.circles[3*G+1],xe=this.circles[3*G+2];I.push({key:this.circleKeys[G],x1:Q-xe,y1:ge-xe,x2:Q+xe,y2:ge+xe})}return M?I.filter(M):I}return this._forEachCell(f,d,h,g,this._queryCell,I,{hitTest:w,seenUids:{box:{},circle:{}}},M),w?I.length>0:I},ha.prototype._queryCircle=function(f,d,h,g,w){var M=f-h,I=f+h,O=d-h,G=d+h;if(I<0||M>this.width||G<0||O>this.height)return!g&&[];var Q=[];return this._forEachCell(M,O,I,G,this._queryCellCircle,Q,{hitTest:g,circle:{x:f,y:d,radius:h},seenUids:{box:{},circle:{}}},w),g?Q.length>0:Q},ha.prototype.query=function(f,d,h,g,w){return this._query(f,d,h,g,!1,w)},ha.prototype.hitTest=function(f,d,h,g,w){return this._query(f,d,h,g,!0,w)},ha.prototype.hitTestCircle=function(f,d,h,g){return this._queryCircle(f,d,h,!0,g)},ha.prototype._queryCell=function(f,d,h,g,w,M,I,O){var G=I.seenUids,Q=this.boxCells[w];if(Q!==null)for(var ge=this.bboxes,xe=0,Ee=Q;xe<Ee.length;xe+=1){var je=Ee[xe];if(!G.box[je]){G.box[je]=!0;var Ve=4*je;if(f<=ge[Ve+2]&&d<=ge[Ve+3]&&h>=ge[Ve+0]&&g>=ge[Ve+1]&&(!O||O(this.boxKeys[je]))){if(I.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[je],x1:ge[Ve],y1:ge[Ve+1],x2:ge[Ve+2],y2:ge[Ve+3]})}}}var nt=this.circleCells[w];if(nt!==null)for(var Fe=this.circles,it=0,yt=nt;it<yt.length;it+=1){var Bt=yt[it];if(!G.circle[Bt]){G.circle[Bt]=!0;var fr=3*Bt;if(this._circleAndRectCollide(Fe[fr],Fe[fr+1],Fe[fr+2],f,d,h,g)&&(!O||O(this.circleKeys[Bt]))){if(I.hitTest)return M.push(!0),!0;var ir=Fe[fr],mr=Fe[fr+1],Or=Fe[fr+2];M.push({key:this.circleKeys[Bt],x1:ir-Or,y1:mr-Or,x2:ir+Or,y2:mr+Or})}}}},ha.prototype._queryCellCircle=function(f,d,h,g,w,M,I,O){var G=I.circle,Q=I.seenUids,ge=this.boxCells[w];if(ge!==null)for(var xe=this.bboxes,Ee=0,je=ge;Ee<je.length;Ee+=1){var Ve=je[Ee];if(!Q.box[Ve]){Q.box[Ve]=!0;var nt=4*Ve;if(this._circleAndRectCollide(G.x,G.y,G.radius,xe[nt+0],xe[nt+1],xe[nt+2],xe[nt+3])&&(!O||O(this.boxKeys[Ve])))return M.push(!0),!0}}var Fe=this.circleCells[w];if(Fe!==null)for(var it=this.circles,yt=0,Bt=Fe;yt<Bt.length;yt+=1){var fr=Bt[yt];if(!Q.circle[fr]){Q.circle[fr]=!0;var ir=3*fr;if(this._circlesCollide(it[ir],it[ir+1],it[ir+2],G.x,G.y,G.radius)&&(!O||O(this.circleKeys[fr])))return M.push(!0),!0}}},ha.prototype._forEachCell=function(f,d,h,g,w,M,I,O){for(var G=this._convertToXCellCoord(f),Q=this._convertToYCellCoord(d),ge=this._convertToXCellCoord(h),xe=this._convertToYCellCoord(g),Ee=G;Ee<=ge;Ee++)for(var je=Q;je<=xe;je++)if(w.call(this,f,d,h,g,this.xCellCount*je+Ee,M,I,O))return},ha.prototype._convertToXCellCoord=function(f){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(f*this.xScale)))},ha.prototype._convertToYCellCoord=function(f){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(f*this.yScale)))},ha.prototype._circlesCollide=function(f,d,h,g,w,M){var I=g-f,O=w-d,G=h+M;return G*G>I*I+O*O},ha.prototype._circleAndRectCollide=function(f,d,h,g,w,M,I){var O=(M-g)/2,G=Math.abs(f-(g+O));if(G>O+h)return!1;var Q=(I-w)/2,ge=Math.abs(d-(w+Q));if(ge>Q+h)return!1;if(G<=O||ge<=Q)return!0;var xe=G-O,Ee=ge-Q;return xe*xe+Ee*Ee<=h*h};var $s=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function uo(f,d){for(var h=0;h<f;h++){var g=d.length;d.resize(g+4),d.float32.set($s,3*g)}}function Ja(f,d,h){var g=d[0],w=d[1];return f[0]=h[0]*g+h[4]*w+h[12],f[1]=h[1]*g+h[5]*w+h[13],f[3]=h[3]*g+h[7]*w+h[15],f}var eo=function(f,d,h){d===void 0&&(d=new ha(f.width+200,f.height+200,25)),h===void 0&&(h=new ha(f.width+200,f.height+200,25)),this.transform=f,this.grid=d,this.ignoredGrid=h,this.pitchfactor=Math.cos(f._pitch)*f.cameraToCenterDistance,this.screenRightBoundary=f.width+100,this.screenBottomBoundary=f.height+100,this.gridRightBoundary=f.width+200,this.gridBottomBoundary=f.height+200};function wt(f,d,h){return d*(y.EXTENT/(f.tileSize*Math.pow(2,h-f.tileID.overscaledZ)))}eo.prototype.placeCollisionBox=function(f,d,h,g,w){var M=this.projectAndGetPerspectiveRatio(g,f.anchorPointX,f.anchorPointY),I=h*M.perspectiveRatio,O=f.x1*I+M.point.x,G=f.y1*I+M.point.y,Q=f.x2*I+M.point.x,ge=f.y2*I+M.point.y;return!this.isInsideGrid(O,G,Q,ge)||!d&&this.grid.hitTest(O,G,Q,ge,w)?{box:[],offscreen:!1}:{box:[O,G,Q,ge],offscreen:this.isOffscreen(O,G,Q,ge)}},eo.prototype.placeCollisionCircles=function(f,d,h,g,w,M,I,O,G,Q,ge,xe,Ee){var je=[],Ve=new y.Point(d.anchorX,d.anchorY),nt=zi(Ve,M),Fe=Ji(this.transform.cameraToCenterDistance,nt.signedDistanceFromCamera),it=(Q?w/Fe:w*Fe)/y.ONE_EM,yt=zi(Ve,I).point,Bt=$a(it,g,d.lineOffsetX*it,d.lineOffsetY*it,!1,yt,Ve,d,h,I,{}),fr=!1,ir=!1,mr=!0;if(Bt){for(var Or=.5*xe*Fe+Ee,on=new y.Point(-100,-100),jr=new y.Point(this.screenRightBoundary,this.screenBottomBoundary),Cn=new yi,ni=Bt.first,ii=Bt.last,oi=[],ta=ni.path.length-1;ta>=1;ta--)oi.push(ni.path[ta]);for(var An=1;An<ii.path.length;An++)oi.push(ii.path[An]);var Ci=2.5*Or;if(O){var En=oi.map(function(ws){return zi(ws,O)});oi=En.some(function(ws){return ws.signedDistanceFromCamera<=0})?[]:En.map(function(ws){return ws.point})}var li=[];if(oi.length>0){for(var Jn=oi[0].clone(),Ti=oi[0].clone(),di=1;di<oi.length;di++)Jn.x=Math.min(Jn.x,oi[di].x),Jn.y=Math.min(Jn.y,oi[di].y),Ti.x=Math.max(Ti.x,oi[di].x),Ti.y=Math.max(Ti.y,oi[di].y);li=Jn.x>=on.x&&Ti.x<=jr.x&&Jn.y>=on.y&&Ti.y<=jr.y?[oi]:Ti.x<on.x||Jn.x>jr.x||Ti.y<on.y||Jn.y>jr.y?[]:y.clipLine([oi],on.x,on.y,jr.x,jr.y)}for(var fi=0,Lo=li;fi<Lo.length;fi+=1){var co;Cn.reset(Lo[fi],.25*Or),co=Cn.length<=.5*Or?1:Math.ceil(Cn.paddedLength/Ci)+1;for(var Oo=0;Oo<co;Oo++){var Fo=Oo/Math.max(co-1,1),qa=Cn.lerp(Fo),io=qa.x+100,Ls=qa.y+100;je.push(io,Ls,Or,0);var Hi=io-Or,Wt=Ls-Or,Ss=io+Or,be=Ls+Or;if(mr=mr&&this.isOffscreen(Hi,Wt,Ss,be),ir=ir||this.isInsideGrid(Hi,Wt,Ss,be),!f&&this.grid.hitTestCircle(io,Ls,Or,ge)&&(fr=!0,!G))return{circles:[],offscreen:!1,collisionDetected:fr}}}}return{circles:!G&&fr||!ir?[]:je,offscreen:mr,collisionDetected:fr}},eo.prototype.queryRenderedSymbols=function(f){if(f.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var d=[],h=1/0,g=1/0,w=-1/0,M=-1/0,I=0,O=f;I<O.length;I+=1){var G=O[I],Q=new y.Point(G.x+100,G.y+100);h=Math.min(h,Q.x),g=Math.min(g,Q.y),w=Math.max(w,Q.x),M=Math.max(M,Q.y),d.push(Q)}for(var ge={},xe={},Ee=0,je=this.grid.query(h,g,w,M).concat(this.ignoredGrid.query(h,g,w,M));Ee<je.length;Ee+=1){var Ve=je[Ee],nt=Ve.key;if(ge[nt.bucketInstanceId]===void 0&&(ge[nt.bucketInstanceId]={}),!ge[nt.bucketInstanceId][nt.featureIndex]){var Fe=[new y.Point(Ve.x1,Ve.y1),new y.Point(Ve.x2,Ve.y1),new y.Point(Ve.x2,Ve.y2),new y.Point(Ve.x1,Ve.y2)];y.polygonIntersectsPolygon(d,Fe)&&(ge[nt.bucketInstanceId][nt.featureIndex]=!0,xe[nt.bucketInstanceId]===void 0&&(xe[nt.bucketInstanceId]=[]),xe[nt.bucketInstanceId].push(nt.featureIndex))}}return xe},eo.prototype.insertCollisionBox=function(f,d,h,g,w){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:g,collisionGroupID:w},f[0],f[1],f[2],f[3])},eo.prototype.insertCollisionCircles=function(f,d,h,g,w){for(var M=d?this.ignoredGrid:this.grid,I={bucketInstanceId:h,featureIndex:g,collisionGroupID:w},O=0;O<f.length;O+=4)M.insertCircle(I,f[O],f[O+1],f[O+2])},eo.prototype.projectAndGetPerspectiveRatio=function(f,d,h){var g=[d,h,0,1];return Ja(g,g,f),{point:new y.Point((g[0]/g[3]+1)/2*this.transform.width+100,(-g[1]/g[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}},eo.prototype.isOffscreen=function(f,d,h,g){return h<100||f>=this.screenRightBoundary||g<100||d>this.screenBottomBoundary},eo.prototype.isInsideGrid=function(f,d,h,g){return h>=0&&f<this.gridRightBoundary&&g>=0&&d<this.gridBottomBoundary},eo.prototype.getViewportMatrix=function(){var f=y.identity([]);return y.translate(f,f,[-100,-100,0]),f};var zt=function(f,d,h,g){this.opacity=f?Math.max(0,Math.min(1,f.opacity+(f.placed?d:-d))):g&&h?1:0,this.placed=h};zt.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var rs=function(f,d,h,g,w){this.text=new zt(f?f.text:null,d,h,w),this.icon=new zt(f?f.icon:null,d,g,w)};rs.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var du=function(f,d,h){this.text=f,this.icon=d,this.skipFade=h},Io=function(){this.invProjMatrix=y.create(),this.viewportMatrix=y.create(),this.circles=[]},za=function(f,d,h,g,w){this.bucketInstanceId=f,this.featureIndex=d,this.sourceLayerIndex=h,this.bucketIndex=g,this.tileID=w},Sa=function(f){this.crossSourceCollisions=f,this.maxGroupID=0,this.collisionGroups={}};function xo(f,d,h,g,w){var M=y.getAnchorAlignment(f),I=-(M.horizontalAlign-.5)*d,O=-(M.verticalAlign-.5)*h,G=y.evaluateVariableOffset(f,g);return new y.Point(I+G[0]*w,O+G[1]*w)}function Dr(f,d,h,g,w,M){var I=f.x1,O=f.x2,G=f.y1,Q=f.y2,ge=f.anchorPointX,xe=f.anchorPointY,Ee=new y.Point(d,h);return g&&Ee._rotate(w?M:-M),{x1:I+Ee.x,y1:G+Ee.y,x2:O+Ee.x,y2:Q+Ee.y,anchorPointX:ge,anchorPointY:xe}}Sa.prototype.get=function(f){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[f]){var d=++this.maxGroupID;this.collisionGroups[f]={ID:d,predicate:function(h){return h.collisionGroupID===d}}}return this.collisionGroups[f]};var Rr=function(f,d,h,g){this.transform=f.clone(),this.collisionIndex=new eo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Sa(h),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}};function Qe(f,d,h,g,w){f.emplaceBack(d?1:0,h?1:0,g||0,w||0),f.emplaceBack(d?1:0,h?1:0,g||0,w||0),f.emplaceBack(d?1:0,h?1:0,g||0,w||0),f.emplaceBack(d?1:0,h?1:0,g||0,w||0)}Rr.prototype.getBucketParts=function(f,d,h,g){var w=h.getBucket(d),M=h.latestFeatureIndex;if(w&&M&&d.id===w.layerIds[0]){var I=h.collisionBoxArray,O=w.layers[0].layout,G=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),Q=h.tileSize/y.EXTENT,ge=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),xe=O.get("text-pitch-alignment")==="map",Ee=O.get("text-rotation-alignment")==="map",je=wt(h,1,this.transform.zoom),Ve=Xa(ge,xe,Ee,this.transform,je),nt=null;if(xe){var Fe=ga(ge,xe,Ee,this.transform,je);nt=y.multiply([],this.transform.labelPlaneMatrix,Fe)}this.retainedQueryData[w.bucketInstanceId]=new za(w.bucketInstanceId,M,w.sourceLayerIndex,w.index,h.tileID);var it={bucket:w,layout:O,posMatrix:ge,textLabelPlaneMatrix:Ve,labelToScreenMatrix:nt,scale:G,textPixelRatio:Q,holdingForFade:h.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:y.evaluateSizeForZoom(w.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(g)for(var yt=0,Bt=w.sortKeyRanges;yt<Bt.length;yt+=1){var fr=Bt[yt];f.push({sortKey:fr.sortKey,symbolInstanceStart:fr.symbolInstanceStart,symbolInstanceEnd:fr.symbolInstanceEnd,parameters:it})}else f.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:it})}},Rr.prototype.attemptAnchorPlacement=function(f,d,h,g,w,M,I,O,G,Q,ge,xe,Ee,je,Ve){var nt,Fe=[xe.textOffset0,xe.textOffset1],it=xo(f,h,g,Fe,w),yt=this.collisionIndex.placeCollisionBox(Dr(d,it.x,it.y,M,I,this.transform.angle),ge,O,G,Q.predicate);if(!Ve||this.collisionIndex.placeCollisionBox(Dr(Ve,it.x,it.y,M,I,this.transform.angle),ge,O,G,Q.predicate).box.length!==0)return yt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[xe.crossTileID]&&this.prevPlacement.placements[xe.crossTileID]&&this.prevPlacement.placements[xe.crossTileID].text&&(nt=this.prevPlacement.variableOffsets[xe.crossTileID].anchor),this.variableOffsets[xe.crossTileID]={textOffset:Fe,width:h,height:g,anchor:f,textBoxScale:w,prevAnchor:nt},this.markUsedJustification(Ee,f,xe,je),Ee.allowVerticalPlacement&&(this.markUsedOrientation(Ee,je,xe),this.placedOrientations[xe.crossTileID]=je),{shift:it,placedGlyphBoxes:yt}):void 0},Rr.prototype.placeLayerBucketPart=function(f,d,h){var g=this,w=f.parameters,M=w.bucket,I=w.layout,O=w.posMatrix,G=w.textLabelPlaneMatrix,Q=w.labelToScreenMatrix,ge=w.textPixelRatio,xe=w.holdingForFade,Ee=w.collisionBoxArray,je=w.partiallyEvaluatedTextSize,Ve=w.collisionGroup,nt=I.get("text-optional"),Fe=I.get("icon-optional"),it=I.get("text-allow-overlap"),yt=I.get("icon-allow-overlap"),Bt=I.get("text-rotation-alignment")==="map",fr=I.get("text-pitch-alignment")==="map",ir=I.get("icon-text-fit")!=="none",mr=I.get("symbol-z-order")==="viewport-y",Or=it&&(yt||!M.hasIconData()||Fe),on=yt&&(it||!M.hasTextData()||nt);!M.collisionArrays&&Ee&&M.deserializeCollisionBoxes(Ee);var jr=function(An,Ci){if(!d[An.crossTileID])if(xe)g.placements[An.crossTileID]=new du(!1,!1,!1);else{var En,li=!1,Jn=!1,Ti=!0,di=null,fi={box:null,offscreen:null},Lo={box:null,offscreen:null},co=null,Oo=null,Fo=0,qa=0,io=0;Ci.textFeatureIndex?Fo=Ci.textFeatureIndex:An.useRuntimeCollisionCircles&&(Fo=An.featureIndex),Ci.verticalTextFeatureIndex&&(qa=Ci.verticalTextFeatureIndex);var Ls=Ci.textBox;if(Ls){var Hi=function(pa){var Qs=y.WritingMode.horizontal;if(M.allowVerticalPlacement&&!pa&&g.prevPlacement){var as=g.prevPlacement.placedOrientations[An.crossTileID];as&&(g.placedOrientations[An.crossTileID]=as,g.markUsedOrientation(M,Qs=as,An))}return Qs},Wt=function(pa,Qs){if(M.allowVerticalPlacement&&An.numVerticalGlyphVertices>0&&Ci.verticalTextBox)for(var as=0,Zu=M.writingModes;as<Zu.length&&(Zu[as]===y.WritingMode.vertical?(fi=Qs(),Lo=fi):fi=pa(),!(fi&&fi.box&&fi.box.length));as+=1);else fi=pa()};if(I.get("text-variable-anchor")){var Ss=I.get("text-variable-anchor");if(g.prevPlacement&&g.prevPlacement.variableOffsets[An.crossTileID]){var be=g.prevPlacement.variableOffsets[An.crossTileID];Ss.indexOf(be.anchor)>0&&(Ss=Ss.filter(function(pa){return pa!==be.anchor})).unshift(be.anchor)}var ws=function(pa,Qs,as){for(var Zu=pa.x2-pa.x1,Xl=pa.y2-pa.y1,Xc=An.textBoxScale,$c=ir&&!yt?Qs:null,Os={box:[],offscreen:!1},$l=it?2*Ss.length:Ss.length,cu=0;cu<$l;++cu){var _l=g.attemptAnchorPlacement(Ss[cu%Ss.length],pa,Zu,Xl,Xc,Bt,fr,ge,O,Ve,cu>=Ss.length,An,M,as,$c);if(_l&&(Os=_l.placedGlyphBoxes)&&Os.box&&Os.box.length){li=!0,di=_l.shift;break}}return Os};Wt(function(){return ws(Ls,Ci.iconBox,y.WritingMode.horizontal)},function(){var pa=Ci.verticalTextBox;return M.allowVerticalPlacement&&!(fi&&fi.box&&fi.box.length)&&An.numVerticalGlyphVertices>0&&pa?ws(pa,Ci.verticalIconBox,y.WritingMode.vertical):{box:null,offscreen:null}}),fi&&(li=fi.box,Ti=fi.offscreen);var yu=Hi(fi&&fi.box);if(!li&&g.prevPlacement){var Ec=g.prevPlacement.variableOffsets[An.crossTileID];Ec&&(g.variableOffsets[An.crossTileID]=Ec,g.markUsedJustification(M,Ec.anchor,An,yu))}}else{var Ku=function(pa,Qs){var as=g.collisionIndex.placeCollisionBox(pa,it,ge,O,Ve.predicate);return as&&as.box&&as.box.length&&(g.markUsedOrientation(M,Qs,An),g.placedOrientations[An.crossTileID]=Qs),as};Wt(function(){return Ku(Ls,y.WritingMode.horizontal)},function(){var pa=Ci.verticalTextBox;return M.allowVerticalPlacement&&An.numVerticalGlyphVertices>0&&pa?Ku(pa,y.WritingMode.vertical):{box:null,offscreen:null}}),Hi(fi&&fi.box&&fi.box.length)}}if(li=(En=fi)&&En.box&&En.box.length>0,Ti=En&&En.offscreen,An.useRuntimeCollisionCircles){var Sc=M.text.placedSymbolArray.get(An.centerJustifiedTextSymbolIndex),Wc=y.evaluateSizeForFeature(M.textSizeData,je,Sc),Au=I.get("text-padding");co=g.collisionIndex.placeCollisionCircles(it,Sc,M.lineVertexArray,M.glyphOffsetArray,Wc,O,G,Q,h,fr,Ve.predicate,An.collisionCircleDiameter,Au),li=it||co.circles.length>0&&!co.collisionDetected,Ti=Ti&&co.offscreen}if(Ci.iconFeatureIndex&&(io=Ci.iconFeatureIndex),Ci.iconBox){var Wl=function(pa){var Qs=ir&&di?Dr(pa,di.x,di.y,Bt,fr,g.transform.angle):pa;return g.collisionIndex.placeCollisionBox(Qs,yt,ge,O,Ve.predicate)};Jn=Lo&&Lo.box&&Lo.box.length&&Ci.verticalIconBox?(Oo=Wl(Ci.verticalIconBox)).box.length>0:(Oo=Wl(Ci.iconBox)).box.length>0,Ti=Ti&&Oo.offscreen}var Tu=nt||An.numHorizontalGlyphVertices===0&&An.numVerticalGlyphVertices===0,Do=Fe||An.numIconVertices===0;if(Tu||Do?Do?Tu||(Jn=Jn&&li):li=Jn&&li:Jn=li=Jn&&li,li&&En&&En.box&&g.collisionIndex.insertCollisionBox(En.box,I.get("text-ignore-placement"),M.bucketInstanceId,Lo&&Lo.box&&qa?qa:Fo,Ve.ID),Jn&&Oo&&g.collisionIndex.insertCollisionBox(Oo.box,I.get("icon-ignore-placement"),M.bucketInstanceId,io,Ve.ID),co&&(li&&g.collisionIndex.insertCollisionCircles(co.circles,I.get("text-ignore-placement"),M.bucketInstanceId,Fo,Ve.ID),h)){var _u=M.bucketInstanceId,Qu=g.collisionCircleArrays[_u];Qu===void 0&&(Qu=g.collisionCircleArrays[_u]=new Io);for(var Ju=0;Ju<co.circles.length;Ju+=4)Qu.circles.push(co.circles[Ju+0]),Qu.circles.push(co.circles[Ju+1]),Qu.circles.push(co.circles[Ju+2]),Qu.circles.push(co.collisionDetected?1:0)}g.placements[An.crossTileID]=new du(li||Or,Jn||on,Ti||M.justReloaded),d[An.crossTileID]=!0}};if(mr)for(var Cn=M.getSortedSymbolIndexes(this.transform.angle),ni=Cn.length-1;ni>=0;--ni){var ii=Cn[ni];jr(M.symbolInstances.get(ii),M.collisionArrays[ii])}else for(var oi=f.symbolInstanceStart;oi<f.symbolInstanceEnd;oi++)jr(M.symbolInstances.get(oi),M.collisionArrays[oi]);if(h&&M.bucketInstanceId in this.collisionCircleArrays){var ta=this.collisionCircleArrays[M.bucketInstanceId];y.invert(ta.invProjMatrix,O),ta.viewportMatrix=this.collisionIndex.getViewportMatrix()}M.justReloaded=!1},Rr.prototype.markUsedJustification=function(f,d,h,g){var w;w=g===y.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[y.getAnchorJustification(d)];for(var M=0,I=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];M<I.length;M+=1){var O=I[M];O>=0&&(f.text.placedSymbolArray.get(O).crossTileID=w>=0&&O!==w?0:h.crossTileID)}},Rr.prototype.markUsedOrientation=function(f,d,h){for(var g=d===y.WritingMode.horizontal||d===y.WritingMode.horizontalOnly?d:0,w=d===y.WritingMode.vertical?d:0,M=0,I=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];M<I.length;M+=1)f.text.placedSymbolArray.get(I[M]).placedOrientation=g;h.verticalPlacedTextSymbolIndex&&(f.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=w)},Rr.prototype.commit=function(f){this.commitTime=f,this.zoomAtLastRecencyCheck=this.transform.zoom;var d=this.prevPlacement,h=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;var g=d?d.symbolFadeChange(f):1,w=d?d.opacities:{},M=d?d.variableOffsets:{},I=d?d.placedOrientations:{};for(var O in this.placements){var G=this.placements[O],Q=w[O];Q?(this.opacities[O]=new rs(Q,g,G.text,G.icon),h=h||G.text!==Q.text.placed||G.icon!==Q.icon.placed):(this.opacities[O]=new rs(null,g,G.text,G.icon,G.skipFade),h=h||G.text||G.icon)}for(var ge in w){var xe=w[ge];if(!this.opacities[ge]){var Ee=new rs(xe,g,!1,!1);Ee.isHidden()||(this.opacities[ge]=Ee,h=h||xe.text.placed||xe.icon.placed)}}for(var je in M)this.variableOffsets[je]||!this.opacities[je]||this.opacities[je].isHidden()||(this.variableOffsets[je]=M[je]);for(var Ve in I)this.placedOrientations[Ve]||!this.opacities[Ve]||this.opacities[Ve].isHidden()||(this.placedOrientations[Ve]=I[Ve]);h?this.lastPlacementChangeTime=f:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:f)},Rr.prototype.updateLayerOpacities=function(f,d){for(var h={},g=0,w=d;g<w.length;g+=1){var M=w[g],I=M.getBucket(f);I&&M.latestFeatureIndex&&f.id===I.layerIds[0]&&this.updateBucketOpacities(I,h,M.collisionBoxArray)}},Rr.prototype.updateBucketOpacities=function(f,d,h){var g=this;f.hasTextData()&&f.text.opacityVertexArray.clear(),f.hasIconData()&&f.icon.opacityVertexArray.clear(),f.hasIconCollisionBoxData()&&f.iconCollisionBox.collisionVertexArray.clear(),f.hasTextCollisionBoxData()&&f.textCollisionBox.collisionVertexArray.clear();var w=f.layers[0].layout,M=new rs(null,0,!1,!1,!0),I=w.get("text-allow-overlap"),O=w.get("icon-allow-overlap"),G=w.get("text-variable-anchor"),Q=w.get("text-rotation-alignment")==="map",ge=w.get("text-pitch-alignment")==="map",xe=w.get("icon-text-fit")!=="none",Ee=new rs(null,0,I&&(O||!f.hasIconData()||w.get("icon-optional")),O&&(I||!f.hasTextData()||w.get("text-optional")),!0);!f.collisionArrays&&h&&(f.hasIconCollisionBoxData()||f.hasTextCollisionBoxData())&&f.deserializeCollisionBoxes(h);for(var je=function(it,yt,Bt){for(var fr=0;fr<yt/4;fr++)it.opacityVertexArray.emplaceBack(Bt)},Ve=function(it){var yt=f.symbolInstances.get(it),Bt=yt.numHorizontalGlyphVertices,fr=yt.numVerticalGlyphVertices,ir=yt.crossTileID,mr=g.opacities[ir];d[ir]?mr=M:mr||(g.opacities[ir]=mr=Ee),d[ir]=!0;var Or=yt.numIconVertices>0,on=g.placedOrientations[yt.crossTileID],jr=on===y.WritingMode.vertical,Cn=on===y.WritingMode.horizontal||on===y.WritingMode.horizontalOnly;if(Bt>0||fr>0){var ni=qn(mr.text);je(f.text,Bt,jr?Ui:ni),je(f.text,fr,Cn?Ui:ni);var ii=mr.text.isHidden();[yt.rightJustifiedTextSymbolIndex,yt.centerJustifiedTextSymbolIndex,yt.leftJustifiedTextSymbolIndex].forEach(function(fi){fi>=0&&(f.text.placedSymbolArray.get(fi).hidden=ii||jr?1:0)}),yt.verticalPlacedTextSymbolIndex>=0&&(f.text.placedSymbolArray.get(yt.verticalPlacedTextSymbolIndex).hidden=ii||Cn?1:0);var oi=g.variableOffsets[yt.crossTileID];oi&&g.markUsedJustification(f,oi.anchor,yt,on);var ta=g.placedOrientations[yt.crossTileID];ta&&(g.markUsedJustification(f,"left",yt,ta),g.markUsedOrientation(f,ta,yt))}if(Or){var An=qn(mr.icon),Ci=!(xe&&yt.verticalPlacedIconSymbolIndex&&jr);yt.placedIconSymbolIndex>=0&&(je(f.icon,yt.numIconVertices,Ci?An:Ui),f.icon.placedSymbolArray.get(yt.placedIconSymbolIndex).hidden=mr.icon.isHidden()),yt.verticalPlacedIconSymbolIndex>=0&&(je(f.icon,yt.numVerticalIconVertices,Ci?Ui:An),f.icon.placedSymbolArray.get(yt.verticalPlacedIconSymbolIndex).hidden=mr.icon.isHidden())}if(f.hasIconCollisionBoxData()||f.hasTextCollisionBoxData()){var En=f.collisionArrays[it];if(En){var li=new y.Point(0,0);if(En.textBox||En.verticalTextBox){var Jn=!0;if(G){var Ti=g.variableOffsets[ir];Ti?(li=xo(Ti.anchor,Ti.width,Ti.height,Ti.textOffset,Ti.textBoxScale),Q&&li._rotate(ge?g.transform.angle:-g.transform.angle)):Jn=!1}En.textBox&&Qe(f.textCollisionBox.collisionVertexArray,mr.text.placed,!Jn||jr,li.x,li.y),En.verticalTextBox&&Qe(f.textCollisionBox.collisionVertexArray,mr.text.placed,!Jn||Cn,li.x,li.y)}var di=Boolean(!Cn&&En.verticalIconBox);En.iconBox&&Qe(f.iconCollisionBox.collisionVertexArray,mr.icon.placed,di,xe?li.x:0,xe?li.y:0),En.verticalIconBox&&Qe(f.iconCollisionBox.collisionVertexArray,mr.icon.placed,!di,xe?li.x:0,xe?li.y:0)}}},nt=0;nt<f.symbolInstances.length;nt++)Ve(nt);if(f.sortFeatures(this.transform.angle),this.retainedQueryData[f.bucketInstanceId]&&(this.retainedQueryData[f.bucketInstanceId].featureSortOrder=f.featureSortOrder),f.hasTextData()&&f.text.opacityVertexBuffer&&f.text.opacityVertexBuffer.updateData(f.text.opacityVertexArray),f.hasIconData()&&f.icon.opacityVertexBuffer&&f.icon.opacityVertexBuffer.updateData(f.icon.opacityVertexArray),f.hasIconCollisionBoxData()&&f.iconCollisionBox.collisionVertexBuffer&&f.iconCollisionBox.collisionVertexBuffer.updateData(f.iconCollisionBox.collisionVertexArray),f.hasTextCollisionBoxData()&&f.textCollisionBox.collisionVertexBuffer&&f.textCollisionBox.collisionVertexBuffer.updateData(f.textCollisionBox.collisionVertexArray),f.bucketInstanceId in this.collisionCircleArrays){var Fe=this.collisionCircleArrays[f.bucketInstanceId];f.placementInvProjMatrix=Fe.invProjMatrix,f.placementViewportMatrix=Fe.viewportMatrix,f.collisionCircleArray=Fe.circles,delete this.collisionCircleArrays[f.bucketInstanceId]}},Rr.prototype.symbolFadeChange=function(f){return this.fadeDuration===0?1:(f-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Rr.prototype.zoomAdjustment=function(f){return Math.max(0,(this.transform.zoom-f)/1.5)},Rr.prototype.hasTransitions=function(f){return this.stale||f-this.lastPlacementChangeTime<this.fadeDuration},Rr.prototype.stillRecent=function(f,d){var h=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*h>f},Rr.prototype.setStale=function(){this.stale=!0};var Fu=Math.pow(2,25),He=Math.pow(2,24),fe=Math.pow(2,17),Pe=Math.pow(2,16),ht=Math.pow(2,9),Kt=Math.pow(2,8),en=Math.pow(2,1);function qn(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;var d=f.placed?1:0,h=Math.floor(127*f.opacity);return h*Fu+d*He+h*fe+d*Pe+h*ht+d*Kt+h*en+d}var Ui=0,lo=function(f){this._sortAcrossTiles=f.layout.get("symbol-z-order")!=="viewport-y"&&f.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};lo.prototype.continuePlacement=function(f,d,h,g,w){for(var M=this._bucketParts;this._currentTileIndex<f.length;)if(d.getBucketParts(M,g,f[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort(function(I,O){return I.sortKey-O.sortKey}));this._currentPartIndex<M.length;)if(d.placeLayerBucketPart(M[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,w())return!0;return!1};var Ya=function(f,d,h,g,w,M,I){this.placement=new Rr(f,w,M,I),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1};Ya.prototype.isDone=function(){return this._done},Ya.prototype.continuePlacement=function(f,d,h){for(var g=this,w=y.browser.now(),M=function(){var G=y.browser.now()-w;return!g._forceFullPlacement&&G>2};this._currentPlacementIndex>=0;){var I=d[f[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=O)&&(!I.maxzoom||I.maxzoom>O)){if(this._inProgressLayer||(this._inProgressLayer=new lo(I)),this._inProgressLayer.continuePlacement(h[I.source],this.placement,this._showCollisionBoxes,I,M))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Ya.prototype.commit=function(f){return this.placement.commit(f),this.placement};var to=512/y.EXTENT/2,$o=function(f,d,h){this.tileID=f,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(var g=0;g<d.length;g++){var w=d.get(g),M=w.key;this.indexedSymbolInstances[M]||(this.indexedSymbolInstances[M]=[]),this.indexedSymbolInstances[M].push({crossTileID:w.crossTileID,coord:this.getScaledCoordinates(w,f)})}};$o.prototype.getScaledCoordinates=function(f,d){var h=to/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*y.EXTENT+f.anchorX)*h),y:Math.floor((d.canonical.y*y.EXTENT+f.anchorY)*h)}},$o.prototype.findMatches=function(f,d,h){for(var g=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),w=0;w<f.length;w++){var M=f.get(w);if(!M.crossTileID){var I=this.indexedSymbolInstances[M.key];if(I)for(var O=this.getScaledCoordinates(M,d),G=0,Q=I;G<Q.length;G+=1){var ge=Q[G];if(Math.abs(ge.coord.x-O.x)<=g&&Math.abs(ge.coord.y-O.y)<=g&&!h[ge.crossTileID]){h[ge.crossTileID]=!0,M.crossTileID=ge.crossTileID;break}}}}};var Ms=function(){this.maxCrossTileID=0};Ms.prototype.generate=function(){return++this.maxCrossTileID};var Vo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Vo.prototype.handleWrapJump=function(f){var d=Math.round((f-this.lng)/360);if(d!==0)for(var h in this.indexes){var g=this.indexes[h],w={};for(var M in g){var I=g[M];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+d),w[I.tileID.key]=I}this.indexes[h]=w}this.lng=f},Vo.prototype.addBucket=function(f,d,h){if(this.indexes[f.overscaledZ]&&this.indexes[f.overscaledZ][f.key]){if(this.indexes[f.overscaledZ][f.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(f.overscaledZ,this.indexes[f.overscaledZ][f.key])}for(var g=0;g<d.symbolInstances.length;g++)d.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[f.overscaledZ]||(this.usedCrossTileIDs[f.overscaledZ]={});var w=this.usedCrossTileIDs[f.overscaledZ];for(var M in this.indexes){var I=this.indexes[M];if(Number(M)>f.overscaledZ)for(var O in I){var G=I[O];G.tileID.isChildOf(f)&&G.findMatches(d.symbolInstances,f,w)}else{var Q=I[f.scaledTo(Number(M)).key];Q&&Q.findMatches(d.symbolInstances,f,w)}}for(var ge=0;ge<d.symbolInstances.length;ge++){var xe=d.symbolInstances.get(ge);xe.crossTileID||(xe.crossTileID=h.generate(),w[xe.crossTileID]=!0)}return this.indexes[f.overscaledZ]===void 0&&(this.indexes[f.overscaledZ]={}),this.indexes[f.overscaledZ][f.key]=new $o(f,d.symbolInstances,d.bucketInstanceId),!0},Vo.prototype.removeBucketCrossTileIDs=function(f,d){for(var h in d.indexedSymbolInstances)for(var g=0,w=d.indexedSymbolInstances[h];g<w.length;g+=1)delete this.usedCrossTileIDs[f][w[g].crossTileID]},Vo.prototype.removeStaleBuckets=function(f){var d=!1;for(var h in this.indexes){var g=this.indexes[h];for(var w in g)f[g[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,g[w]),delete g[w],d=!0)}return d};var fs=function(){this.layerIndexes={},this.crossTileIDs=new Ms,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};fs.prototype.addLayer=function(f,d,h){var g=this.layerIndexes[f.id];g===void 0&&(g=this.layerIndexes[f.id]=new Vo);var w=!1,M={};g.handleWrapJump(h);for(var I=0,O=d;I<O.length;I+=1){var G=O[I],Q=G.getBucket(f);Q&&f.id===Q.layerIds[0]&&(Q.bucketInstanceId||(Q.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(G.tileID,Q,this.crossTileIDs)&&(w=!0),M[Q.bucketInstanceId]=!0)}return g.removeStaleBuckets(M)&&(w=!0),w},fs.prototype.pruneUnusedLayers=function(f){var d={};for(var h in f.forEach(function(g){d[g]=!0}),this.layerIndexes)d[h]||delete this.layerIndexes[h]};var hs=function(f,d){return y.emitValidationErrors(f,d&&d.filter(function(h){return h.identifier!=="source.canvas"}))},ys=y.pick(gn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),ks=y.pick(gn,["setCenter","setZoom","setBearing","setPitch"]),ru=function(){var f={},d=y.styleSpec.$version;for(var h in y.styleSpec.$root){var g,w=y.styleSpec.$root[h];w.required&&(g=h==="version"?d:w.type==="array"?[]:{})!=null&&(f[h]=g)}return f}(),_s=function(f){function d(h,g){var w=this;g===void 0&&(g={}),f.call(this),this.map=h,this.dispatcher=new sr($t(),this),this.imageManager=new Ft,this.imageManager.setEventedParent(this),this.glyphManager=new Et(h._requestManager,g.localIdeographFontFamily),this.lineAtlas=new vt(256,512),this.crossTileSymbolIndex=new fs,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",y.getReferrer());var M=this;this._rtlTextPluginCallback=d.registerForPluginStateChange(function(I){M.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:I.pluginStatus,pluginURL:I.pluginURL},function(O,G){if(y.triggerPluginCompletionEvent(O),G&&G.every(function(ge){return ge}))for(var Q in M.sourceCaches)M.sourceCaches[Q].reload()})}),this.on("data",function(I){if(I.dataType==="source"&&I.sourceDataType==="metadata"){var O=w.sourceCaches[I.sourceId];if(O){var G=O.getSource();if(G&&G.vectorLayerIds)for(var Q in w._layers){var ge=w._layers[Q];ge.source===G.id&&w._validateLayer(ge)}}}})}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.loadURL=function(h,g){var w=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"}));var M=typeof g.validate=="boolean"?g.validate:!y.isMapboxURL(h);h=this.map._requestManager.normalizeStyleURL(h,g.accessToken);var I=this.map._requestManager.transformRequest(h,y.ResourceType.Style);this._request=y.getJSON(I,function(O,G){w._request=null,O?w.fire(new y.ErrorEvent(O)):G&&w._load(G,M)})},d.prototype.loadJSON=function(h,g){var w=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"})),this._request=y.browser.frame(function(){w._request=null,w._load(h,g.validate!==!1)})},d.prototype.loadEmpty=function(){this.fire(new y.Event("dataloading",{dataType:"style"})),this._load(ru,!1)},d.prototype._load=function(h,g){if(!g||!hs(this,y.validateStyle(h))){for(var w in this._loaded=!0,this.stylesheet=h,h.sources)this.addSource(w,h.sources[w],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs);var M=fn(this.stylesheet.layers);this._order=M.map(function(Q){return Q.id}),this._layers={},this._serializedLayers={};for(var I=0,O=M;I<O.length;I+=1){var G=O[I];(G=y.createStyleLayer(G)).setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G,this._serializedLayers[G.id]=G.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ht(this.stylesheet.light),this.fire(new y.Event("data",{dataType:"style"})),this.fire(new y.Event("style.load"))}},d.prototype._loadSprite=function(h){var g=this;this._spriteRequest=function(w,M,I){var O,G,Q,ge=y.browser.devicePixelRatio>1?"@2x":"",xe=y.getJSON(M.transformRequest(M.normalizeSpriteURL(w,ge,".json"),y.ResourceType.SpriteJSON),function(Ve,nt){xe=null,Q||(Q=Ve,O=nt,je())}),Ee=y.getImage(M.transformRequest(M.normalizeSpriteURL(w,ge,".png"),y.ResourceType.SpriteImage),function(Ve,nt){Ee=null,Q||(Q=Ve,G=nt,je())});function je(){if(Q)I(Q);else if(O&&G){var Ve=y.browser.getImageData(G),nt={};for(var Fe in O){var it=O[Fe],yt=it.width,Bt=it.height,fr=it.x,ir=it.y,mr=it.sdf,Or=it.pixelRatio,on=it.stretchX,jr=it.stretchY,Cn=it.content,ni=new y.RGBAImage({width:yt,height:Bt});y.RGBAImage.copy(Ve,ni,{x:fr,y:ir},{x:0,y:0},{width:yt,height:Bt}),nt[Fe]={data:ni,pixelRatio:Or,sdf:mr,stretchX:on,stretchY:jr,content:Cn}}I(null,nt)}}return{cancel:function(){xe&&(xe.cancel(),xe=null),Ee&&(Ee.cancel(),Ee=null)}}}(h,this.map._requestManager,function(w,M){if(g._spriteRequest=null,w)g.fire(new y.ErrorEvent(w));else if(M)for(var I in M)g.imageManager.addImage(I,M[I]);g.imageManager.setLoaded(!0),g._availableImages=g.imageManager.listImages(),g.dispatcher.broadcast("setImages",g._availableImages),g.fire(new y.Event("data",{dataType:"style"}))})},d.prototype._validateLayer=function(h){var g=this.sourceCaches[h.source];if(g){var w=h.sourceLayer;if(w){var M=g.getSource();(M.type==="geojson"||M.vectorLayerIds&&M.vectorLayerIds.indexOf(w)===-1)&&this.fire(new y.ErrorEvent(new Error('Source layer "'+w+'" does not exist on source "'+M.id+'" as specified by style layer "'+h.id+'"')))}}},d.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var h in this.sourceCaches)if(!this.sourceCaches[h].loaded())return!1;return!!this.imageManager.isLoaded()},d.prototype._serializeLayers=function(h){for(var g=[],w=0,M=h;w<M.length;w+=1){var I=this._layers[M[w]];I.type!=="custom"&&g.push(I.serialize())}return g},d.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(var g in this._layers)if(this._layers[g].hasTransition())return!0;return!1},d.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},d.prototype.update=function(h){if(this._loaded){var g=this._changed;if(this._changed){var w=Object.keys(this._updatedLayers),M=Object.keys(this._removedLayers);for(var I in(w.length||M.length)&&this._updateWorkerLayers(w,M),this._updatedSources){var O=this._updatedSources[I];O==="reload"?this._reloadSource(I):O==="clear"&&this._clearSource(I)}for(var G in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[G].updateTransitions(h);this.light.updateTransitions(h),this._resetUpdates()}var Q={};for(var ge in this.sourceCaches){var xe=this.sourceCaches[ge];Q[ge]=xe.used,xe.used=!1}for(var Ee=0,je=this._order;Ee<je.length;Ee+=1){var Ve=this._layers[je[Ee]];Ve.recalculate(h,this._availableImages),!Ve.isHidden(h.zoom)&&Ve.source&&(this.sourceCaches[Ve.source].used=!0)}for(var nt in Q){var Fe=this.sourceCaches[nt];Q[nt]!==Fe.used&&Fe.fire(new y.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:nt}))}this.light.recalculate(h),this.z=h.zoom,g&&this.fire(new y.Event("data",{dataType:"style"}))}},d.prototype._updateTilesForChangedImages=function(){var h=Object.keys(this._changedImages);if(h.length){for(var g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],h);this._changedImages={}}},d.prototype._updateWorkerLayers=function(h,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(h),removedIds:g})},d.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},d.prototype.setState=function(h){var g=this;if(this._checkLoaded(),hs(this,y.validateStyle(h)))return!1;(h=y.clone$1(h)).layers=fn(h.layers);var w=function(I,O){if(!I)return[{command:gn.setStyle,args:[O]}];var G=[];try{if(!y.deepEqual(I.version,O.version))return[{command:gn.setStyle,args:[O]}];y.deepEqual(I.center,O.center)||G.push({command:gn.setCenter,args:[O.center]}),y.deepEqual(I.zoom,O.zoom)||G.push({command:gn.setZoom,args:[O.zoom]}),y.deepEqual(I.bearing,O.bearing)||G.push({command:gn.setBearing,args:[O.bearing]}),y.deepEqual(I.pitch,O.pitch)||G.push({command:gn.setPitch,args:[O.pitch]}),y.deepEqual(I.sprite,O.sprite)||G.push({command:gn.setSprite,args:[O.sprite]}),y.deepEqual(I.glyphs,O.glyphs)||G.push({command:gn.setGlyphs,args:[O.glyphs]}),y.deepEqual(I.transition,O.transition)||G.push({command:gn.setTransition,args:[O.transition]}),y.deepEqual(I.light,O.light)||G.push({command:gn.setLight,args:[O.light]});var Q={},ge=[];(function(Ee,je,Ve,nt){var Fe;for(Fe in je=je||{},Ee=Ee||{})Ee.hasOwnProperty(Fe)&&(je.hasOwnProperty(Fe)||xn(Fe,Ve,nt));for(Fe in je)je.hasOwnProperty(Fe)&&(Ee.hasOwnProperty(Fe)?y.deepEqual(Ee[Fe],je[Fe])||(Ee[Fe].type==="geojson"&&je[Fe].type==="geojson"&&sa(Ee,je,Fe)?Ve.push({command:gn.setGeoJSONSourceData,args:[Fe,je[Fe].data]}):Ni(Fe,je,Ve,nt)):Ii(Fe,je,Ve))})(I.sources,O.sources,ge,Q);var xe=[];I.layers&&I.layers.forEach(function(Ee){Q[Ee.source]?G.push({command:gn.removeLayer,args:[Ee.id]}):xe.push(Ee)}),G=G.concat(ge),function(Ee,je,Ve){je=je||[];var nt,Fe,it,yt,Bt,fr,ir,mr=(Ee=Ee||[]).map(Zi),Or=je.map(Zi),on=Ee.reduce(Fi,{}),jr=je.reduce(Fi,{}),Cn=mr.slice(),ni=Object.create(null);for(nt=0,Fe=0;nt<mr.length;nt++)jr.hasOwnProperty(it=mr[nt])?Fe++:(Ve.push({command:gn.removeLayer,args:[it]}),Cn.splice(Cn.indexOf(it,Fe),1));for(nt=0,Fe=0;nt<Or.length;nt++)Cn[Cn.length-1-nt]!==(it=Or[Or.length-1-nt])&&(on.hasOwnProperty(it)?(Ve.push({command:gn.removeLayer,args:[it]}),Cn.splice(Cn.lastIndexOf(it,Cn.length-Fe),1)):Fe++,Ve.push({command:gn.addLayer,args:[jr[it],fr=Cn[Cn.length-nt]]}),Cn.splice(Cn.length-nt,0,it),ni[it]=!0);for(nt=0;nt<Or.length;nt++)if(yt=on[it=Or[nt]],Bt=jr[it],!ni[it]&&!y.deepEqual(yt,Bt))if(y.deepEqual(yt.source,Bt.source)&&y.deepEqual(yt["source-layer"],Bt["source-layer"])&&y.deepEqual(yt.type,Bt.type)){for(ir in Oi(yt.layout,Bt.layout,Ve,it,null,gn.setLayoutProperty),Oi(yt.paint,Bt.paint,Ve,it,null,gn.setPaintProperty),y.deepEqual(yt.filter,Bt.filter)||Ve.push({command:gn.setFilter,args:[it,Bt.filter]}),y.deepEqual(yt.minzoom,Bt.minzoom)&&y.deepEqual(yt.maxzoom,Bt.maxzoom)||Ve.push({command:gn.setLayerZoomRange,args:[it,Bt.minzoom,Bt.maxzoom]}),yt)yt.hasOwnProperty(ir)&&ir!=="layout"&&ir!=="paint"&&ir!=="filter"&&ir!=="metadata"&&ir!=="minzoom"&&ir!=="maxzoom"&&(ir.indexOf("paint.")===0?Oi(yt[ir],Bt[ir],Ve,it,ir.slice(6),gn.setPaintProperty):y.deepEqual(yt[ir],Bt[ir])||Ve.push({command:gn.setLayerProperty,args:[it,ir,Bt[ir]]}));for(ir in Bt)Bt.hasOwnProperty(ir)&&!yt.hasOwnProperty(ir)&&ir!=="layout"&&ir!=="paint"&&ir!=="filter"&&ir!=="metadata"&&ir!=="minzoom"&&ir!=="maxzoom"&&(ir.indexOf("paint.")===0?Oi(yt[ir],Bt[ir],Ve,it,ir.slice(6),gn.setPaintProperty):y.deepEqual(yt[ir],Bt[ir])||Ve.push({command:gn.setLayerProperty,args:[it,ir,Bt[ir]]}))}else Ve.push({command:gn.removeLayer,args:[it]}),fr=Cn[Cn.lastIndexOf(it)+1],Ve.push({command:gn.addLayer,args:[Bt,fr]})}(xe,O.layers,G)}catch(Ee){console.warn("Unable to compute style diff:",Ee),G=[{command:gn.setStyle,args:[O]}]}return G}(this.serialize(),h).filter(function(I){return!(I.command in ks)});if(w.length===0)return!1;var M=w.filter(function(I){return!(I.command in ys)});if(M.length>0)throw new Error("Unimplemented: "+M.map(function(I){return I.command}).join(", ")+".");return w.forEach(function(I){I.command!=="setTransition"&&g[I.command].apply(g,I.args)}),this.stylesheet=h,!0},d.prototype.addImage=function(h,g){if(this.getImage(h))return this.fire(new y.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(h,g),this._afterImageUpdated(h)},d.prototype.updateImage=function(h,g){this.imageManager.updateImage(h,g)},d.prototype.getImage=function(h){return this.imageManager.getImage(h)},d.prototype.removeImage=function(h){if(!this.getImage(h))return this.fire(new y.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(h),this._afterImageUpdated(h)},d.prototype._afterImageUpdated=function(h){this._availableImages=this.imageManager.listImages(),this._changedImages[h]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))},d.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},d.prototype.addSource=function(h,g,w){var M=this;if(w===void 0&&(w={}),this._checkLoaded(),this.sourceCaches[h]!==void 0)throw new Error("There is already a source with this ID");if(!g.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(g).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(y.validateStyle.source,"sources."+h,g,null,w))){this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);var I=this.sourceCaches[h]=new Ge(h,g,this.dispatcher);I.style=this,I.setEventedParent(this,function(){return{isSourceLoaded:M.loaded(),source:I.serialize(),sourceId:h}}),I.onAdd(this.map),this._changed=!0}},d.prototype.removeSource=function(h){if(this._checkLoaded(),this.sourceCaches[h]===void 0)throw new Error("There is no source with this ID");for(var g in this._layers)if(this._layers[g].source===h)return this.fire(new y.ErrorEvent(new Error('Source "'+h+'" cannot be removed while layer "'+g+'" is using it.')));var w=this.sourceCaches[h];delete this.sourceCaches[h],delete this._updatedSources[h],w.fire(new y.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:h})),w.setEventedParent(null),w.clearTiles(),w.onRemove&&w.onRemove(this.map),this._changed=!0},d.prototype.setGeoJSONSourceData=function(h,g){this._checkLoaded(),this.sourceCaches[h].getSource().setData(g),this._changed=!0},d.prototype.getSource=function(h){return this.sourceCaches[h]&&this.sourceCaches[h].getSource()},d.prototype.addLayer=function(h,g,w){w===void 0&&(w={}),this._checkLoaded();var M=h.id;if(this.getLayer(M))this.fire(new y.ErrorEvent(new Error('Layer with id "'+M+'" already exists on this map')));else{var I;if(h.type==="custom"){if(hs(this,y.validateCustomStyleLayer(h)))return;I=y.createStyleLayer(h)}else{if(typeof h.source=="object"&&(this.addSource(M,h.source),h=y.clone$1(h),h=y.extend(h,{source:M})),this._validate(y.validateStyle.layer,"layers."+M,h,{arrayIndex:-1},w))return;I=y.createStyleLayer(h),this._validateLayer(I),I.setEventedParent(this,{layer:{id:M}}),this._serializedLayers[I.id]=I.serialize()}var O=g?this._order.indexOf(g):this._order.length;if(g&&O===-1)this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.')));else{if(this._order.splice(O,0,M),this._layerOrderChanged=!0,this._layers[M]=I,this._removedLayers[M]&&I.source&&I.type!=="custom"){var G=this._removedLayers[M];delete this._removedLayers[M],G.type!==I.type?this._updatedSources[I.source]="clear":(this._updatedSources[I.source]="reload",this.sourceCaches[I.source].pause())}this._updateLayer(I),I.onAdd&&I.onAdd(this.map)}}},d.prototype.moveLayer=function(h,g){if(this._checkLoaded(),this._changed=!0,this._layers[h]){if(h!==g){var w=this._order.indexOf(h);this._order.splice(w,1);var M=g?this._order.indexOf(g):this._order.length;g&&M===-1?this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.'))):(this._order.splice(M,0,h),this._layerOrderChanged=!0)}}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be moved.")))},d.prototype.removeLayer=function(h){this._checkLoaded();var g=this._layers[h];if(g){g.setEventedParent(null);var w=this._order.indexOf(h);this._order.splice(w,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[h]=g,delete this._layers[h],delete this._serializedLayers[h],delete this._updatedLayers[h],delete this._updatedPaintProps[h],g.onRemove&&g.onRemove(this.map)}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be removed.")))},d.prototype.getLayer=function(h){return this._layers[h]},d.prototype.hasLayer=function(h){return h in this._layers},d.prototype.setLayerZoomRange=function(h,g,w){this._checkLoaded();var M=this.getLayer(h);M?M.minzoom===g&&M.maxzoom===w||(g!=null&&(M.minzoom=g),w!=null&&(M.maxzoom=w),this._updateLayer(M)):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot have zoom extent.")))},d.prototype.setFilter=function(h,g,w){w===void 0&&(w={}),this._checkLoaded();var M=this.getLayer(h);if(M){if(!y.deepEqual(M.filter,g))return g==null?(M.filter=void 0,void this._updateLayer(M)):void(this._validate(y.validateStyle.filter,"layers."+M.id+".filter",g,null,w)||(M.filter=y.clone$1(g),this._updateLayer(M)))}else this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be filtered.")))},d.prototype.getFilter=function(h){return y.clone$1(this.getLayer(h).filter)},d.prototype.setLayoutProperty=function(h,g,w,M){M===void 0&&(M={}),this._checkLoaded();var I=this.getLayer(h);I?y.deepEqual(I.getLayoutProperty(g),w)||(I.setLayoutProperty(g,w,M),this._updateLayer(I)):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getLayoutProperty=function(h,g){var w=this.getLayer(h);if(w)return w.getLayoutProperty(g);this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style.")))},d.prototype.setPaintProperty=function(h,g,w,M){M===void 0&&(M={}),this._checkLoaded();var I=this.getLayer(h);I?y.deepEqual(I.getPaintProperty(g),w)||(I.setPaintProperty(g,w,M)&&this._updateLayer(I),this._changed=!0,this._updatedPaintProps[h]=!0):this.fire(new y.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getPaintProperty=function(h,g){return this.getLayer(h).getPaintProperty(g)},d.prototype.setFeatureState=function(h,g){this._checkLoaded();var w=h.source,M=h.sourceLayer,I=this.sourceCaches[w];if(I!==void 0){var O=I.getSource().type;O==="geojson"&&M?this.fire(new y.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):O!=="vector"||M?(h.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),I.setFeatureState(M,h.id,g)):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+w+"' does not exist in the map's style.")))},d.prototype.removeFeatureState=function(h,g){this._checkLoaded();var w=h.source,M=this.sourceCaches[w];if(M!==void 0){var I=M.getSource().type,O=I==="vector"?h.sourceLayer:void 0;I!=="vector"||O?g&&typeof h.id!="string"&&typeof h.id!="number"?this.fire(new y.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):M.removeFeatureState(O,h.id,g):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+w+"' does not exist in the map's style.")))},d.prototype.getFeatureState=function(h){this._checkLoaded();var g=h.source,w=h.sourceLayer,M=this.sourceCaches[g];if(M!==void 0){if(M.getSource().type!=="vector"||w)return h.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),M.getFeatureState(w,h.id);this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},d.prototype.getTransition=function(){return y.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},d.prototype.serialize=function(){return y.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:y.mapObject(this.sourceCaches,function(h){return h.serialize()}),layers:this._serializeLayers(this._order)},function(h){return h!==void 0})},d.prototype._updateLayer=function(h){this._updatedLayers[h.id]=!0,h.source&&!this._updatedSources[h.source]&&this.sourceCaches[h.source].getSource().type!=="raster"&&(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause()),this._changed=!0},d.prototype._flattenAndSortRenderedFeatures=function(h){for(var g=this,w=function(on){return g._layers[on].type==="fill-extrusion"},M={},I=[],O=this._order.length-1;O>=0;O--){var G=this._order[O];if(w(G)){M[G]=O;for(var Q=0,ge=h;Q<ge.length;Q+=1){var xe=ge[Q][G];if(xe)for(var Ee=0,je=xe;Ee<je.length;Ee+=1)I.push(je[Ee])}}}I.sort(function(on,jr){return jr.intersectionZ-on.intersectionZ});for(var Ve=[],nt=this._order.length-1;nt>=0;nt--){var Fe=this._order[nt];if(w(Fe))for(var it=I.length-1;it>=0;it--){var yt=I[it].feature;if(M[yt.layer.id]<nt)break;Ve.push(yt),I.pop()}else for(var Bt=0,fr=h;Bt<fr.length;Bt+=1){var ir=fr[Bt][Fe];if(ir)for(var mr=0,Or=ir;mr<Or.length;mr+=1)Ve.push(Or[mr].feature)}}return Ve},d.prototype.queryRenderedFeatures=function(h,g,w){g&&g.filter&&this._validate(y.validateStyle.filter,"queryRenderedFeatures.filter",g.filter,null,g);var M={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new y.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var I=0,O=g.layers;I<O.length;I+=1){var G=O[I],Q=this._layers[G];if(!Q)return this.fire(new y.ErrorEvent(new Error("The layer '"+G+"' does not exist in the map's style and cannot be queried for features."))),[];M[Q.source]=!0}}var ge=[];for(var xe in g.availableImages=this._availableImages,this.sourceCaches)g.layers&&!M[xe]||ge.push(Hr(this.sourceCaches[xe],this._layers,this._serializedLayers,h,g,w));return this.placement&&ge.push(function(Ee,je,Ve,nt,Fe,it,yt){for(var Bt={},fr=it.queryRenderedSymbols(nt),ir=[],mr=0,Or=Object.keys(fr).map(Number);mr<Or.length;mr+=1)ir.push(yt[Or[mr]]);ir.sort(vi);for(var on=function(){var oi=Cn[jr],ta=oi.featureIndex.lookupSymbolFeatures(fr[oi.bucketInstanceId],je,oi.bucketIndex,oi.sourceLayerIndex,Fe.filter,Fe.layers,Fe.availableImages,Ee);for(var An in ta){var Ci=Bt[An]=Bt[An]||[],En=ta[An];En.sort(function(Ti,di){var fi=oi.featureSortOrder;if(fi){var Lo=fi.indexOf(Ti.featureIndex);return fi.indexOf(di.featureIndex)-Lo}return di.featureIndex-Ti.featureIndex});for(var li=0,Jn=En;li<Jn.length;li+=1)Ci.push(Jn[li])}},jr=0,Cn=ir;jr<Cn.length;jr+=1)on();var ni=function(oi){Bt[oi].forEach(function(ta){var An=ta.feature,Ci=Ve[Ee[oi].source].getFeatureState(An.layer["source-layer"],An.id);An.source=An.layer.source,An.layer["source-layer"]&&(An.sourceLayer=An.layer["source-layer"]),An.state=Ci})};for(var ii in Bt)ni(ii);return Bt}(this._layers,this._serializedLayers,this.sourceCaches,h,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ge)},d.prototype.querySourceFeatures=function(h,g){g&&g.filter&&this._validate(y.validateStyle.filter,"querySourceFeatures.filter",g.filter,null,g);var w=this.sourceCaches[h];return w?function(M,I){for(var O=M.getRenderableIds().map(function(je){return M.getTileByID(je)}),G=[],Q={},ge=0;ge<O.length;ge++){var xe=O[ge],Ee=xe.tileID.canonical.key;Q[Ee]||(Q[Ee]=!0,xe.querySourceFeatures(G,I))}return G}(w,g):[]},d.prototype.addSourceType=function(h,g,w){return d.getSourceType(h)?w(new Error('A source type called "'+h+'" already exists.')):(d.setSourceType(h,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:h,url:g.workerSourceURL},w):w(null,null))},d.prototype.getLight=function(){return this.light.getLight()},d.prototype.setLight=function(h,g){g===void 0&&(g={}),this._checkLoaded();var w=this.light.getLight(),M=!1;for(var I in h)if(!y.deepEqual(h[I],w[I])){M=!0;break}if(M){var O={now:y.browser.now(),transition:y.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(h,g),this.light.updateTransitions(O)}},d.prototype._validate=function(h,g,w,M,I){return I===void 0&&(I={}),(!I||I.validate!==!1)&&hs(this,h.call(y.validateStyle,y.extend({key:g,style:this.serialize(),value:w,styleSpec:y.styleSpec},M)))},d.prototype._remove=function(){for(var h in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),y.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[h].setEventedParent(null);for(var g in this.sourceCaches)this.sourceCaches[g].clearTiles(),this.sourceCaches[g].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},d.prototype._clearSource=function(h){this.sourceCaches[h].clearTiles()},d.prototype._reloadSource=function(h){this.sourceCaches[h].resume(),this.sourceCaches[h].reload()},d.prototype._updateSources=function(h){for(var g in this.sourceCaches)this.sourceCaches[g].update(h)},d.prototype._generateCollisionBoxes=function(){for(var h in this.sourceCaches)this._reloadSource(h)},d.prototype._updatePlacement=function(h,g,w,M,I){I===void 0&&(I=!1);for(var O=!1,G=!1,Q={},ge=0,xe=this._order;ge<xe.length;ge+=1){var Ee=this._layers[xe[ge]];if(Ee.type==="symbol"){if(!Q[Ee.source]){var je=this.sourceCaches[Ee.source];Q[Ee.source]=je.getRenderableIds(!0).map(function(yt){return je.getTileByID(yt)}).sort(function(yt,Bt){return Bt.tileID.overscaledZ-yt.tileID.overscaledZ||(yt.tileID.isLessThan(Bt.tileID)?-1:1)})}var Ve=this.crossTileSymbolIndex.addLayer(Ee,Q[Ee.source],h.center.lng);O=O||Ve}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((I=I||this._layerOrderChanged||w===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.browser.now(),h.zoom))&&(this.pauseablePlacement=new Ya(h,this._order,I,g,w,M,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Q),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.browser.now()),G=!0),O&&this.pauseablePlacement.placement.setStale()),G||O)for(var nt=0,Fe=this._order;nt<Fe.length;nt+=1){var it=this._layers[Fe[nt]];it.type==="symbol"&&this.placement.updateLayerOpacities(it,Q[it.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.browser.now())},d.prototype._releaseSymbolFadeTiles=function(){for(var h in this.sourceCaches)this.sourceCaches[h].releaseSymbolFadeTiles()},d.prototype.getImages=function(h,g,w){this.imageManager.getImages(g.icons,w),this._updateTilesForChangedImages();var M=this.sourceCaches[g.source];M&&M.setDependencies(g.tileID.key,g.type,g.icons)},d.prototype.getGlyphs=function(h,g,w){this.glyphManager.getGlyphs(g.stacks,w)},d.prototype.getResource=function(h,g,w){return y.makeRequest(g,w)},d}(y.Evented);_s.getSourceType=function(f){return hr[f]},_s.setSourceType=function(f,d){hr[f]=d},_s.registerForPluginStateChange=y.registerForPluginStateChange;var ya=y.createLayout([{name:"a_pos",type:"Int16",components:2}]),bo=ea(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Gu=ea(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),fc=ea(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Hu=ea(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Bc=ea("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Il=ea(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),ol=ea(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),vu=ea("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),sl=ea("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),b=ea("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),k=ea(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Z=ea(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),R=ea(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),te=ea(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Me=ea(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),at=ea(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Rt=ea(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Lt=ea(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Ar=ea(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Tr=ea(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Fn=ea(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Ai=ea(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),_i=ea(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Di=ea(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Ia=ea(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Da=ea(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function ea(f,d){var h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=d.match(/attribute ([\w]+) ([\w]+)/g),w=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=M?M.concat(w):w,O={};return{fragmentSource:f=f.replace(h,function(G,Q,ge,xe,Ee){return O[Ee]=!0,Q==="define"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
varying `+ge+" "+xe+" "+Ee+`;
#else
uniform `+ge+" "+xe+" u_"+Ee+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Ee+`
    `+ge+" "+xe+" "+Ee+" = u_"+Ee+`;
#endif
`}),vertexSource:d=d.replace(h,function(G,Q,ge,xe,Ee){var je=xe==="float"?"vec2":"vec4",Ve=Ee.match(/color/)?"color":je;return O[Ee]?Q==="define"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
uniform lowp float u_`+Ee+`_t;
attribute `+ge+" "+je+" a_"+Ee+`;
varying `+ge+" "+xe+" "+Ee+`;
#else
uniform `+ge+" "+xe+" u_"+Ee+`;
#endif
`:Ve==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+Ee+" = a_"+Ee+`;
#else
    `+ge+" "+xe+" "+Ee+" = u_"+Ee+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+Ee+" = unpack_mix_"+Ve+"(a_"+Ee+", u_"+Ee+`_t);
#else
    `+ge+" "+xe+" "+Ee+" = u_"+Ee+`;
#endif
`:Q==="define"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
uniform lowp float u_`+Ee+`_t;
attribute `+ge+" "+je+" a_"+Ee+`;
#else
uniform `+ge+" "+xe+" u_"+Ee+`;
#endif
`:Ve==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+ge+" "+xe+" "+Ee+" = a_"+Ee+`;
#else
    `+ge+" "+xe+" "+Ee+" = u_"+Ee+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+ge+" "+xe+" "+Ee+" = unpack_mix_"+Ve+"(a_"+Ee+", u_"+Ee+`_t);
#else
    `+ge+" "+xe+" "+Ee+" = u_"+Ee+`;
#endif
`}),staticAttributes:g,staticUniforms:I}}var xs=Object.freeze({__proto__:null,prelude:bo,background:Gu,backgroundPattern:fc,circle:Hu,clippingMask:Bc,heatmap:Il,heatmapTexture:ol,collisionBox:vu,collisionCircle:sl,debug:b,fill:k,fillOutline:Z,fillOutlinePattern:R,fillPattern:te,fillExtrusion:Me,fillExtrusionPattern:at,hillshadePrepare:Rt,hillshade:Lt,line:Ar,lineGradient:Tr,linePattern:Fn,lineSDF:Ai,raster:_i,symbolIcon:Di,symbolSDF:Ia,symbolTextAndIcon:Da}),bu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function ul(f){for(var d=[],h=0;h<f.length;h++)if(f[h]!==null){var g=f[h].split(" ");d.push(g.pop())}return d}bu.prototype.bind=function(f,d,h,g,w,M,I,O){this.context=f;for(var G=this.boundPaintVertexBuffers.length!==g.length,Q=0;!G&&Q<g.length;Q++)this.boundPaintVertexBuffers[Q]!==g[Q]&&(G=!0);f.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===h&&!G&&this.boundIndexBuffer===w&&this.boundVertexOffset===M&&this.boundDynamicVertexBuffer===I&&this.boundDynamicVertexBuffer2===O?(f.bindVertexArrayOES.set(this.vao),I&&I.bind(),w&&w.dynamicDraw&&w.bind(),O&&O.bind()):this.freshBind(d,h,g,w,M,I,O)},bu.prototype.freshBind=function(f,d,h,g,w,M,I){var O,G=f.numAttributes,Q=this.context,ge=Q.gl;if(Q.extVertexArrayObject)this.vao&&this.destroy(),this.vao=Q.extVertexArrayObject.createVertexArrayOES(),Q.bindVertexArrayOES.set(this.vao),O=0,this.boundProgram=f,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=g,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=M,this.boundDynamicVertexBuffer2=I;else{O=Q.currentNumAttributes||0;for(var xe=G;xe<O;xe++)ge.disableVertexAttribArray(xe)}d.enableAttributes(ge,f);for(var Ee=0,je=h;Ee<je.length;Ee+=1)je[Ee].enableAttributes(ge,f);M&&M.enableAttributes(ge,f),I&&I.enableAttributes(ge,f),d.bind(),d.setVertexAttribPointers(ge,f,w);for(var Ve=0,nt=h;Ve<nt.length;Ve+=1){var Fe=nt[Ve];Fe.bind(),Fe.setVertexAttribPointers(ge,f,w)}M&&(M.bind(),M.setVertexAttribPointers(ge,f,w)),g&&g.bind(),I&&(I.bind(),I.setVertexAttribPointers(ge,f,w)),Q.currentNumAttributes=G},bu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var vf=function(f,d,h,g,w,M){var I=f.gl;this.program=I.createProgram();for(var O=ul(h.staticAttributes),G=g?g.getBinderAttributes():[],Q=O.concat(G),ge=h.staticUniforms?ul(h.staticUniforms):[],xe=g?g.getBinderUniforms():[],Ee=[],je=0,Ve=ge.concat(xe);je<Ve.length;je+=1){var nt=Ve[je];Ee.indexOf(nt)<0&&Ee.push(nt)}var Fe=g?g.defines():[];M&&Fe.push("#define OVERDRAW_INSPECTOR;");var it=Fe.concat(bo.fragmentSource,h.fragmentSource).join(`
`),yt=Fe.concat(bo.vertexSource,h.vertexSource).join(`
`),Bt=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(Bt,it),I.compileShader(Bt),I.attachShader(this.program,Bt);var fr=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(fr,yt),I.compileShader(fr),I.attachShader(this.program,fr),this.attributes={};var ir={};this.numAttributes=Q.length;for(var mr=0;mr<this.numAttributes;mr++)Q[mr]&&(I.bindAttribLocation(this.program,mr,Q[mr]),this.attributes[Q[mr]]=mr);I.linkProgram(this.program),I.deleteShader(fr),I.deleteShader(Bt);for(var Or=0;Or<Ee.length;Or++){var on=Ee[Or];if(on&&!ir[on]){var jr=I.getUniformLocation(this.program,on);jr&&(ir[on]=jr)}}this.fixedUniforms=w(f,ir),this.binderUniforms=g?g.getUniforms(f,ir):[]}}};function mu(f,d,h){var g=1/wt(h,1,d.transform.tileZoom),w=Math.pow(2,h.tileID.overscaledZ),M=h.tileSize*Math.pow(2,d.transform.tileZoom)/w,I=M*(h.tileID.canonical.x+h.tileID.wrap*w),O=M*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[g,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[I>>16,O>>16],u_pixel_coord_lower:[65535&I,65535&O]}}vf.prototype.draw=function(f,d,h,g,w,M,I,O,G,Q,ge,xe,Ee,je,Ve,nt){var Fe,it=f.gl;if(!this.failedToCreate){for(var yt in f.program.set(this.program),f.setDepthMode(h),f.setStencilMode(g),f.setColorMode(w),f.setCullFace(M),this.fixedUniforms)this.fixedUniforms[yt].set(I[yt]);je&&je.setUniforms(f,this.binderUniforms,xe,{zoom:Ee});for(var Bt=(Fe={},Fe[it.LINES]=2,Fe[it.TRIANGLES]=3,Fe[it.LINE_STRIP]=1,Fe)[d],fr=0,ir=ge.get();fr<ir.length;fr+=1){var mr=ir[fr],Or=mr.vaos||(mr.vaos={});(Or[O]||(Or[O]=new bu)).bind(f,this,G,je?je.getPaintVertexBuffers():[],Q,mr.vertexOffset,Ve,nt),it.drawElements(d,mr.primitiveLength*Bt,it.UNSIGNED_SHORT,mr.primitiveOffset*Bt*2)}}};var Ds=function(f,d,h,g){var w=d.style.light,M=w.properties.get("position"),I=[M.x,M.y,M.z],O=y.create$1();w.properties.get("anchor")==="viewport"&&y.fromRotation(O,-d.transform.angle),y.transformMat3(I,I,O);var G=w.properties.get("color");return{u_matrix:f,u_lightpos:I,u_lightintensity:w.properties.get("intensity"),u_lightcolor:[G.r,G.g,G.b],u_vertical_gradient:+h,u_opacity:g}},Du=function(f,d,h,g,w,M,I){return y.extend(Ds(f,d,h,g),mu(M,d,I),{u_height_factor:-Math.pow(2,w.overscaledZ)/I.tileSize/8})},gu=function(f){return{u_matrix:f}},Bu=function(f,d,h,g){return y.extend(gu(f),mu(h,d,g))},Eo=function(f,d){return{u_matrix:f,u_world:d}},Nc=function(f,d,h,g,w){return y.extend(Bu(f,d,h,g),{u_world:w})},Is=function(f,d,h,g){var w,M,I=f.transform;if(g.paint.get("circle-pitch-alignment")==="map"){var O=wt(h,1,I.zoom);w=!0,M=[O,O]}else w=!1,M=I.pixelsToGLUnits;return{u_camera_to_center_distance:I.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(d.posMatrix,h,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+w,u_device_pixel_ratio:y.browser.devicePixelRatio,u_extrude_scale:M}},ns=function(f,d,h){var g=wt(h,1,d.zoom),w=Math.pow(2,d.zoom-h.tileID.overscaledZ),M=h.tileID.overscaleFactor();return{u_matrix:f,u_camera_to_center_distance:d.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[d.pixelsToGLUnits[0]/(g*w),d.pixelsToGLUnits[1]/(g*w)],u_overscale_factor:M}},hc=function(f,d,h){return{u_matrix:f,u_inv_matrix:d,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}},Po=function(f,d,h){return h===void 0&&(h=1),{u_matrix:f,u_color:d,u_overlay:0,u_overlay_scale:h}},nu=function(f){return{u_matrix:f}},zc=function(f,d,h,g){return{u_matrix:f,u_extrude_scale:wt(d,1,h),u_intensity:g}},ll=function(f,d,h){var g=f.transform;return{u_matrix:Hf(f,d,h),u_ratio:1/wt(d,1,g.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Pa=function(f,d,h,g){return y.extend(ll(f,d,h),{u_image:0,u_image_height:g})},Pl=function(f,d,h,g){var w=f.transform,M=Wu(d,w);return{u_matrix:Hf(f,d,h),u_texsize:d.imageAtlasTexture.size,u_ratio:1/wt(d,1,w.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_image:0,u_scale:[M,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},Gf=function(f,d,h,g,w){var M=f.lineAtlas,I=Wu(d,f.transform),O=h.layout.get("line-cap")==="round",G=M.getDash(g.from,O),Q=M.getDash(g.to,O),ge=G.width*w.fromScale,xe=Q.width*w.toScale;return y.extend(ll(f,d,h),{u_patternscale_a:[I/ge,-G.height/2],u_patternscale_b:[I/xe,-Q.height/2],u_sdfgamma:M.width/(256*Math.min(ge,xe)*y.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:Q.y,u_mix:w.t})};function Wu(f,d){return 1/wt(f,1,d.tileZoom)}function Hf(f,d,h){return f.translatePosMatrix(d.tileID.posMatrix,d,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}var tp=function(f,d,h,g,w){return{u_matrix:f,u_tl_parent:d,u_scale_parent:h,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(I=w.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(M=w.paint.get("raster-contrast"),M>0?1/(1-M):1+M),u_spin_weights:Eh(w.paint.get("raster-hue-rotate"))};var M,I};function Eh(f){f*=Math.PI/180;var d=Math.sin(f),h=Math.cos(f);return[(2*h+1)/3,(-Math.sqrt(3)*d-h+1)/3,(Math.sqrt(3)*d-h+1)/3]}var mf,pc=function(f,d,h,g,w,M,I,O,G,Q){var ge=w.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:d?d.uSizeT:0,u_size:d?d.uSize:0,u_camera_to_center_distance:ge.cameraToCenterDistance,u_pitch:ge.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:ge.width/ge.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:M,u_label_plane_matrix:I,u_coord_matrix:O,u_is_text:+G,u_pitch_with_map:+g,u_texsize:Q,u_texture:0}},Rl=function(f,d,h,g,w,M,I,O,G,Q,ge){var xe=w.transform;return y.extend(pc(f,d,h,g,w,M,I,O,G,Q),{u_gamma_scale:g?Math.cos(xe._pitch)*xe.cameraToCenterDistance:1,u_device_pixel_ratio:y.browser.devicePixelRatio,u_is_halo:+ge})},Ll=function(f,d,h,g,w,M,I,O,G,Q){return y.extend(Rl(f,d,h,g,w,M,I,O,!0,G,!0),{u_texsize_icon:Q,u_texture_icon:1})},Ol=function(f,d,h){return{u_matrix:f,u_opacity:d,u_color:h}},cl=function(f,d,h,g,w,M){return y.extend(function(I,O,G,Q){var ge=G.imageManager.getPattern(I.from.toString()),xe=G.imageManager.getPattern(I.to.toString()),Ee=G.imageManager.getPixelSize(),je=Ee.width,Ve=Ee.height,nt=Math.pow(2,Q.tileID.overscaledZ),Fe=Q.tileSize*Math.pow(2,G.transform.tileZoom)/nt,it=Fe*(Q.tileID.canonical.x+Q.tileID.wrap*nt),yt=Fe*Q.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ge.tl,u_pattern_br_a:ge.br,u_pattern_tl_b:xe.tl,u_pattern_br_b:xe.br,u_texsize:[je,Ve],u_mix:O.t,u_pattern_size_a:ge.displaySize,u_pattern_size_b:xe.displaySize,u_scale_a:O.fromScale,u_scale_b:O.toScale,u_tile_units_to_pixels:1/wt(Q,1,G.transform.tileZoom),u_pixel_coord_upper:[it>>16,yt>>16],u_pixel_coord_lower:[65535&it,65535&yt]}}(g,M,h,w),{u_matrix:f,u_opacity:d})},Xu={fillExtrusion:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_lightpos:new y.Uniform3f(f,d.u_lightpos),u_lightintensity:new y.Uniform1f(f,d.u_lightintensity),u_lightcolor:new y.Uniform3f(f,d.u_lightcolor),u_vertical_gradient:new y.Uniform1f(f,d.u_vertical_gradient),u_opacity:new y.Uniform1f(f,d.u_opacity)}},fillExtrusionPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_lightpos:new y.Uniform3f(f,d.u_lightpos),u_lightintensity:new y.Uniform1f(f,d.u_lightintensity),u_lightcolor:new y.Uniform3f(f,d.u_lightcolor),u_vertical_gradient:new y.Uniform1f(f,d.u_vertical_gradient),u_height_factor:new y.Uniform1f(f,d.u_height_factor),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade),u_opacity:new y.Uniform1f(f,d.u_opacity)}},fill:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},fillPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},fillOutline:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world)}},fillOutlinePattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world),u_image:new y.Uniform1i(f,d.u_image),u_texsize:new y.Uniform2f(f,d.u_texsize),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},circle:function(f,d){return{u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_scale_with_map:new y.Uniform1i(f,d.u_scale_with_map),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_extrude_scale:new y.Uniform2f(f,d.u_extrude_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},collisionBox:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pixels_to_tile_units:new y.Uniform1f(f,d.u_pixels_to_tile_units),u_extrude_scale:new y.Uniform2f(f,d.u_extrude_scale),u_overscale_factor:new y.Uniform1f(f,d.u_overscale_factor)}},collisionCircle:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_inv_matrix:new y.UniformMatrix4f(f,d.u_inv_matrix),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_viewport_size:new y.Uniform2f(f,d.u_viewport_size)}},debug:function(f,d){return{u_color:new y.UniformColor(f,d.u_color),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_overlay:new y.Uniform1i(f,d.u_overlay),u_overlay_scale:new y.Uniform1f(f,d.u_overlay_scale)}},clippingMask:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},heatmap:function(f,d){return{u_extrude_scale:new y.Uniform1f(f,d.u_extrude_scale),u_intensity:new y.Uniform1f(f,d.u_intensity),u_matrix:new y.UniformMatrix4f(f,d.u_matrix)}},heatmapTexture:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_world:new y.Uniform2f(f,d.u_world),u_image:new y.Uniform1i(f,d.u_image),u_color_ramp:new y.Uniform1i(f,d.u_color_ramp),u_opacity:new y.Uniform1f(f,d.u_opacity)}},hillshade:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_latrange:new y.Uniform2f(f,d.u_latrange),u_light:new y.Uniform2f(f,d.u_light),u_shadow:new y.UniformColor(f,d.u_shadow),u_highlight:new y.UniformColor(f,d.u_highlight),u_accent:new y.UniformColor(f,d.u_accent)}},hillshadePrepare:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_image:new y.Uniform1i(f,d.u_image),u_dimension:new y.Uniform2f(f,d.u_dimension),u_zoom:new y.Uniform1f(f,d.u_zoom),u_unpack:new y.Uniform4f(f,d.u_unpack)}},line:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels)}},lineGradient:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_image:new y.Uniform1i(f,d.u_image),u_image_height:new y.Uniform1f(f,d.u_image_height)}},linePattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_texsize:new y.Uniform2f(f,d.u_texsize),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_image:new y.Uniform1i(f,d.u_image),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_scale:new y.Uniform3f(f,d.u_scale),u_fade:new y.Uniform1f(f,d.u_fade)}},lineSDF:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_ratio:new y.Uniform1f(f,d.u_ratio),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(f,d.u_units_to_pixels),u_patternscale_a:new y.Uniform2f(f,d.u_patternscale_a),u_patternscale_b:new y.Uniform2f(f,d.u_patternscale_b),u_sdfgamma:new y.Uniform1f(f,d.u_sdfgamma),u_image:new y.Uniform1i(f,d.u_image),u_tex_y_a:new y.Uniform1f(f,d.u_tex_y_a),u_tex_y_b:new y.Uniform1f(f,d.u_tex_y_b),u_mix:new y.Uniform1f(f,d.u_mix)}},raster:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_tl_parent:new y.Uniform2f(f,d.u_tl_parent),u_scale_parent:new y.Uniform1f(f,d.u_scale_parent),u_buffer_scale:new y.Uniform1f(f,d.u_buffer_scale),u_fade_t:new y.Uniform1f(f,d.u_fade_t),u_opacity:new y.Uniform1f(f,d.u_opacity),u_image0:new y.Uniform1i(f,d.u_image0),u_image1:new y.Uniform1i(f,d.u_image1),u_brightness_low:new y.Uniform1f(f,d.u_brightness_low),u_brightness_high:new y.Uniform1f(f,d.u_brightness_high),u_saturation_factor:new y.Uniform1f(f,d.u_saturation_factor),u_contrast_factor:new y.Uniform1f(f,d.u_contrast_factor),u_spin_weights:new y.Uniform3f(f,d.u_spin_weights)}},symbolIcon:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texture:new y.Uniform1i(f,d.u_texture)}},symbolSDF:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texture:new y.Uniform1i(f,d.u_texture),u_gamma_scale:new y.Uniform1f(f,d.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(f,d.u_is_halo)}},symbolTextAndIcon:function(f,d){return{u_is_size_zoom_constant:new y.Uniform1i(f,d.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(f,d.u_is_size_feature_constant),u_size_t:new y.Uniform1f(f,d.u_size_t),u_size:new y.Uniform1f(f,d.u_size),u_camera_to_center_distance:new y.Uniform1f(f,d.u_camera_to_center_distance),u_pitch:new y.Uniform1f(f,d.u_pitch),u_rotate_symbol:new y.Uniform1i(f,d.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(f,d.u_aspect_ratio),u_fade_change:new y.Uniform1f(f,d.u_fade_change),u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(f,d.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(f,d.u_coord_matrix),u_is_text:new y.Uniform1i(f,d.u_is_text),u_pitch_with_map:new y.Uniform1i(f,d.u_pitch_with_map),u_texsize:new y.Uniform2f(f,d.u_texsize),u_texsize_icon:new y.Uniform2f(f,d.u_texsize_icon),u_texture:new y.Uniform1i(f,d.u_texture),u_texture_icon:new y.Uniform1i(f,d.u_texture_icon),u_gamma_scale:new y.Uniform1f(f,d.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(f,d.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(f,d.u_is_halo)}},background:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_opacity:new y.Uniform1f(f,d.u_opacity),u_color:new y.UniformColor(f,d.u_color)}},backgroundPattern:function(f,d){return{u_matrix:new y.UniformMatrix4f(f,d.u_matrix),u_opacity:new y.Uniform1f(f,d.u_opacity),u_image:new y.Uniform1i(f,d.u_image),u_pattern_tl_a:new y.Uniform2f(f,d.u_pattern_tl_a),u_pattern_br_a:new y.Uniform2f(f,d.u_pattern_br_a),u_pattern_tl_b:new y.Uniform2f(f,d.u_pattern_tl_b),u_pattern_br_b:new y.Uniform2f(f,d.u_pattern_br_b),u_texsize:new y.Uniform2f(f,d.u_texsize),u_mix:new y.Uniform1f(f,d.u_mix),u_pattern_size_a:new y.Uniform2f(f,d.u_pattern_size_a),u_pattern_size_b:new y.Uniform2f(f,d.u_pattern_size_b),u_scale_a:new y.Uniform1f(f,d.u_scale_a),u_scale_b:new y.Uniform1f(f,d.u_scale_b),u_pixel_coord_upper:new y.Uniform2f(f,d.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(f,d.u_pixel_coord_lower),u_tile_units_to_pixels:new y.Uniform1f(f,d.u_tile_units_to_pixels)}}};function $u(f,d,h,g,w,M,I){for(var O=f.context,G=O.gl,Q=f.useProgram("collisionBox"),ge=[],xe=0,Ee=0,je=0;je<g.length;je++){var Ve=g[je],nt=d.getTile(Ve),Fe=nt.getBucket(h);if(Fe){var it=Ve.posMatrix;w[0]===0&&w[1]===0||(it=f.translatePosMatrix(Ve.posMatrix,nt,w,M));var yt=I?Fe.textCollisionBox:Fe.iconCollisionBox,Bt=Fe.collisionCircleArray;if(Bt.length>0){var fr=y.create(),ir=it;y.mul(fr,Fe.placementInvProjMatrix,f.transform.glCoordMatrix),y.mul(fr,fr,Fe.placementViewportMatrix),ge.push({circleArray:Bt,circleOffset:Ee,transform:ir,invTransform:fr}),Ee=xe+=Bt.length/4}yt&&Q.draw(O,G.LINES,Ce.disabled,Be.disabled,f.colorModeForRenderPass(),dt.disabled,ns(it,f.transform,nt),h.id,yt.layoutVertexBuffer,yt.indexBuffer,yt.segments,null,f.transform.zoom,null,null,yt.collisionVertexBuffer)}}if(I&&ge.length){var mr=f.useProgram("collisionCircle"),Or=new y.StructArrayLayout2f1f2i16;Or.resize(4*xe),Or._trim();for(var on=0,jr=0,Cn=ge;jr<Cn.length;jr+=1)for(var ni=Cn[jr],ii=0;ii<ni.circleArray.length/4;ii++){var oi=4*ii,ta=ni.circleArray[oi+0],An=ni.circleArray[oi+1],Ci=ni.circleArray[oi+2],En=ni.circleArray[oi+3];Or.emplace(on++,ta,An,Ci,En,0),Or.emplace(on++,ta,An,Ci,En,1),Or.emplace(on++,ta,An,Ci,En,2),Or.emplace(on++,ta,An,Ci,En,3)}(!mf||mf.length<2*xe)&&(mf=function(co){var Oo=2*co,Fo=new y.StructArrayLayout3ui6;Fo.resize(Oo),Fo._trim();for(var qa=0;qa<Oo;qa++){var io=6*qa;Fo.uint16[io+0]=4*qa+0,Fo.uint16[io+1]=4*qa+1,Fo.uint16[io+2]=4*qa+2,Fo.uint16[io+3]=4*qa+2,Fo.uint16[io+4]=4*qa+3,Fo.uint16[io+5]=4*qa+0}return Fo}(xe));for(var li=O.createIndexBuffer(mf,!0),Jn=O.createVertexBuffer(Or,y.collisionCircleLayout.members,!0),Ti=0,di=ge;Ti<di.length;Ti+=1){var fi=di[Ti],Lo=hc(fi.transform,fi.invTransform,f.transform);mr.draw(O,G.TRIANGLES,Ce.disabled,Be.disabled,f.colorModeForRenderPass(),dt.disabled,Lo,h.id,Jn,li,y.SegmentVector.simpleSegment(0,2*fi.circleOffset,fi.circleArray.length,fi.circleArray.length/2),null,f.transform.zoom,null,null,null)}Jn.destroy(),li.destroy()}}var iu=y.identity(new Float32Array(16));function Wf(f,d,h,g,w,M){var I=y.getAnchorAlignment(f),O=-(I.horizontalAlign-.5)*d,G=-(I.verticalAlign-.5)*h,Q=y.evaluateVariableOffset(f,g);return new y.Point((O/w+Q[0])*M,(G/w+Q[1])*M)}function gf(f,d,h,g,w,M,I,O,G,Q,ge){var xe=f.text.placedSymbolArray,Ee=f.text.dynamicLayoutVertexArray,je=f.icon.dynamicLayoutVertexArray,Ve={};Ee.clear();for(var nt=0;nt<xe.length;nt++){var Fe=xe.get(nt),it=Fe.hidden||!Fe.crossTileID||f.allowVerticalPlacement&&!Fe.placedOrientation?null:g[Fe.crossTileID];if(it){var yt=new y.Point(Fe.anchorX,Fe.anchorY),Bt=zi(yt,h?O:I),fr=Ji(M.cameraToCenterDistance,Bt.signedDistanceFromCamera),ir=w.evaluateSizeForFeature(f.textSizeData,Q,Fe)*fr/y.ONE_EM;h&&(ir*=f.tilePixelRatio/G);for(var mr=Wf(it.anchor,it.width,it.height,it.textOffset,it.textBoxScale,ir),Or=h?zi(yt.add(mr),I).point:Bt.point.add(d?mr.rotate(-M.angle):mr),on=f.allowVerticalPlacement&&Fe.placedOrientation===y.WritingMode.vertical?Math.PI/2:0,jr=0;jr<Fe.numGlyphs;jr++)y.addDynamicAttributes(Ee,Or,on);ge&&Fe.associatedIconIndex>=0&&(Ve[Fe.associatedIconIndex]={shiftedAnchor:Or,angle:on})}else uo(Fe.numGlyphs,Ee)}if(ge){je.clear();for(var Cn=f.icon.placedSymbolArray,ni=0;ni<Cn.length;ni++){var ii=Cn.get(ni);if(ii.hidden)uo(ii.numGlyphs,je);else{var oi=Ve[ni];if(oi)for(var ta=0;ta<ii.numGlyphs;ta++)y.addDynamicAttributes(je,oi.shiftedAnchor,oi.angle);else uo(ii.numGlyphs,je)}}f.icon.dynamicLayoutVertexBuffer.updateData(je)}f.text.dynamicLayoutVertexBuffer.updateData(Ee)}function Sh(f,d,h){return h.iconsInText&&d?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Ys(f,d,h,g,w,M,I,O,G,Q,ge,xe){for(var Ee=f.context,je=Ee.gl,Ve=f.transform,nt=O==="map",Fe=G==="map",it=nt&&h.layout.get("symbol-placement")!=="point",yt=nt&&!Fe&&!it,Bt=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,fr=!1,ir=f.depthModeForSublayer(0,Ce.ReadOnly),mr=h.layout.get("text-variable-anchor"),Or=[],on=0,jr=g;on<jr.length;on+=1){var Cn=jr[on],ni=d.getTile(Cn),ii=ni.getBucket(h);if(ii){var oi=w?ii.text:ii.icon;if(oi&&oi.segments.get().length){var ta=oi.programConfigurations.get(h.id),An=w||ii.sdfIcons,Ci=w?ii.textSizeData:ii.iconSizeData,En=Fe||Ve.pitch!==0,li=f.useProgram(Sh(An,w,ii),ta),Jn=y.evaluateSizeForZoom(Ci,Ve.zoom),Ti=void 0,di=[0,0],fi=void 0,Lo=void 0,co=null,Oo=void 0;if(w)fi=ni.glyphAtlasTexture,Lo=je.LINEAR,Ti=ni.glyphAtlasTexture.size,ii.iconsInText&&(di=ni.imageAtlasTexture.size,co=ni.imageAtlasTexture,Oo=En||f.options.rotating||f.options.zooming||Ci.kind==="composite"||Ci.kind==="camera"?je.LINEAR:je.NEAREST);else{var Fo=h.layout.get("icon-size").constantOr(0)!==1||ii.iconsNeedLinear;fi=ni.imageAtlasTexture,Lo=An||f.options.rotating||f.options.zooming||Fo||En?je.LINEAR:je.NEAREST,Ti=ni.imageAtlasTexture.size}var qa=wt(ni,1,f.transform.zoom),io=Xa(Cn.posMatrix,Fe,nt,f.transform,qa),Ls=ga(Cn.posMatrix,Fe,nt,f.transform,qa),Hi=mr&&ii.hasTextData(),Wt=h.layout.get("icon-text-fit")!=="none"&&Hi&&ii.hasIconData();it&&tu(ii,Cn.posMatrix,f,w,io,Ls,Fe,Q);var Ss=f.translatePosMatrix(Cn.posMatrix,ni,M,I),be=it||w&&mr||Wt?iu:io,ws=f.translatePosMatrix(Ls,ni,M,I,!0),yu=An&&h.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Ec={program:li,buffers:oi,uniformValues:An?ii.iconsInText?Ll(Ci.kind,Jn,yt,Fe,f,Ss,be,ws,Ti,di):Rl(Ci.kind,Jn,yt,Fe,f,Ss,be,ws,w,Ti,!0):pc(Ci.kind,Jn,yt,Fe,f,Ss,be,ws,w,Ti),atlasTexture:fi,atlasTextureIcon:co,atlasInterpolation:Lo,atlasInterpolationIcon:Oo,isSDF:An,hasHalo:yu};if(Bt&&ii.canOverlap){fr=!0;for(var Ku=0,Sc=oi.segments.get();Ku<Sc.length;Ku+=1){var Wc=Sc[Ku];Or.push({segments:new y.SegmentVector([Wc]),sortKey:Wc.sortKey,state:Ec})}}else Or.push({segments:oi.segments,sortKey:0,state:Ec})}}}fr&&Or.sort(function(Qu,Ju){return Qu.sortKey-Ju.sortKey});for(var Au=0,Wl=Or;Au<Wl.length;Au+=1){var Tu=Wl[Au],Do=Tu.state;if(Ee.activeTexture.set(je.TEXTURE0),Do.atlasTexture.bind(Do.atlasInterpolation,je.CLAMP_TO_EDGE),Do.atlasTextureIcon&&(Ee.activeTexture.set(je.TEXTURE1),Do.atlasTextureIcon&&Do.atlasTextureIcon.bind(Do.atlasInterpolationIcon,je.CLAMP_TO_EDGE)),Do.isSDF){var _u=Do.uniformValues;Do.hasHalo&&(_u.u_is_halo=1,dc(Do.buffers,Tu.segments,h,f,Do.program,ir,ge,xe,_u)),_u.u_is_halo=0}dc(Do.buffers,Tu.segments,h,f,Do.program,ir,ge,xe,Do.uniformValues)}}function dc(f,d,h,g,w,M,I,O,G){var Q=g.context;w.draw(Q,Q.gl.TRIANGLES,M,I,O,dt.disabled,G,h.id,f.layoutVertexBuffer,f.indexBuffer,d,h.paint,g.transform.zoom,f.programConfigurations.get(h.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Zc(f,d,h,g,w,M,I){var O,G,Q,ge,xe,Ee=f.context.gl,je=h.paint.get("fill-pattern"),Ve=je&&je.constantOr(1),nt=h.getCrossfadeParameters();I?(G=Ve&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=Ee.LINES):(G=Ve?"fillPattern":"fill",O=Ee.TRIANGLES);for(var Fe=0,it=g;Fe<it.length;Fe+=1){var yt=it[Fe],Bt=d.getTile(yt);if(!Ve||Bt.patternsLoaded()){var fr=Bt.getBucket(h);if(fr){var ir=fr.programConfigurations.get(h.id),mr=f.useProgram(G,ir);Ve&&(f.context.activeTexture.set(Ee.TEXTURE0),Bt.imageAtlasTexture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE),ir.updatePaintBuffers(nt));var Or=je.constantOr(null);if(Or&&Bt.imageAtlas){var on=Bt.imageAtlas,jr=on.patternPositions[Or.to.toString()],Cn=on.patternPositions[Or.from.toString()];jr&&Cn&&ir.setConstantPatternPositions(jr,Cn)}var ni=f.translatePosMatrix(yt.posMatrix,Bt,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(I){ge=fr.indexBuffer2,xe=fr.segments2;var ii=[Ee.drawingBufferWidth,Ee.drawingBufferHeight];Q=G==="fillOutlinePattern"&&Ve?Nc(ni,f,nt,Bt,ii):Eo(ni,ii)}else ge=fr.indexBuffer,xe=fr.segments,Q=Ve?Bu(ni,f,nt,Bt):gu(ni);mr.draw(f.context,O,w,f.stencilModeForClipping(yt),M,dt.disabled,Q,h.id,fr.layoutVertexBuffer,ge,xe,h.paint,f.transform.zoom,ir)}}}}function yf(f,d,h,g,w,M,I){for(var O=f.context,G=O.gl,Q=h.paint.get("fill-extrusion-pattern"),ge=Q.constantOr(1),xe=h.getCrossfadeParameters(),Ee=h.paint.get("fill-extrusion-opacity"),je=0,Ve=g;je<Ve.length;je+=1){var nt=Ve[je],Fe=d.getTile(nt),it=Fe.getBucket(h);if(it){var yt=it.programConfigurations.get(h.id),Bt=f.useProgram(ge?"fillExtrusionPattern":"fillExtrusion",yt);ge&&(f.context.activeTexture.set(G.TEXTURE0),Fe.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),yt.updatePaintBuffers(xe));var fr=Q.constantOr(null);if(fr&&Fe.imageAtlas){var ir=Fe.imageAtlas,mr=ir.patternPositions[fr.to.toString()],Or=ir.patternPositions[fr.from.toString()];mr&&Or&&yt.setConstantPatternPositions(mr,Or)}var on=f.translatePosMatrix(nt.posMatrix,Fe,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),jr=h.paint.get("fill-extrusion-vertical-gradient"),Cn=ge?Du(on,f,jr,Ee,nt,xe,Fe):Ds(on,f,jr,Ee);Bt.draw(O,O.gl.TRIANGLES,w,M,I,dt.backCCW,Cn,h.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,h.paint,f.transform.zoom,yt)}}}function Fl(f,d,h,g,w,M){var I=f.context,O=I.gl,G=d.fbo;if(G){var Q=f.useProgram("hillshade");I.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,G.colorAttachment.get());var ge=function(xe,Ee,je){var Ve=je.paint.get("hillshade-shadow-color"),nt=je.paint.get("hillshade-highlight-color"),Fe=je.paint.get("hillshade-accent-color"),it=je.paint.get("hillshade-illumination-direction")*(Math.PI/180);je.paint.get("hillshade-illumination-anchor")==="viewport"&&(it-=xe.transform.angle);var yt,Bt,fr,ir=!xe.options.moving;return{u_matrix:xe.transform.calculatePosMatrix(Ee.tileID.toUnwrapped(),ir),u_image:0,u_latrange:(yt=Ee.tileID,Bt=Math.pow(2,yt.canonical.z),fr=yt.canonical.y,[new y.MercatorCoordinate(0,fr/Bt).toLngLat().lat,new y.MercatorCoordinate(0,(fr+1)/Bt).toLngLat().lat]),u_light:[je.paint.get("hillshade-exaggeration"),it],u_shadow:Ve,u_highlight:nt,u_accent:Fe}}(f,d,h);Q.draw(I,O.TRIANGLES,g,w,M,dt.disabled,ge,h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}}function _f(f,d,h,g,w,M){var I=f.context,O=I.gl,G=d.dem;if(G&&G.data){var Q=G.dim,ge=G.stride,xe=G.getPixels();if(I.activeTexture.set(O.TEXTURE1),I.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||f.getTileTexture(ge),d.demTexture){var Ee=d.demTexture;Ee.update(xe,{premultiply:!1}),Ee.bind(O.NEAREST,O.CLAMP_TO_EDGE)}else d.demTexture=new y.Texture(I,xe,O.RGBA,{premultiply:!1}),d.demTexture.bind(O.NEAREST,O.CLAMP_TO_EDGE);I.activeTexture.set(O.TEXTURE0);var je=d.fbo;if(!je){var Ve=new y.Texture(I,{width:Q,height:Q,data:null},O.RGBA);Ve.bind(O.LINEAR,O.CLAMP_TO_EDGE),(je=d.fbo=I.createFramebuffer(Q,Q,!0)).colorAttachment.set(Ve.texture)}I.bindFramebuffer.set(je.framebuffer),I.viewport.set([0,0,Q,Q]),f.useProgram("hillshadePrepare").draw(I,O.TRIANGLES,g,w,M,dt.disabled,function(nt,Fe){var it=Fe.stride,yt=y.create();return y.ortho(yt,0,y.EXTENT,-y.EXTENT,0,0,1),y.translate(yt,yt,[0,-y.EXTENT,0]),{u_matrix:yt,u_image:1,u_dimension:[it,it],u_zoom:nt.overscaledZ,u_unpack:Fe.getUnpackVector()}}(d.tileID,G),h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),d.needsHillshadePrepare=!1}}function Uc(f,d,h,g,w){var M=g.paint.get("raster-fade-duration");if(M>0){var I=y.browser.now(),O=(I-f.timeAdded)/M,G=d?(I-d.timeAdded)/M:-1,Q=h.getSource(),ge=w.coveringZoomLevel({tileSize:Q.tileSize,roundZoom:Q.roundZoom}),xe=!d||Math.abs(d.tileID.overscaledZ-ge)>Math.abs(f.tileID.overscaledZ-ge),Ee=xe&&f.refreshedUponExpiration?1:y.clamp(xe?O:1-G,0,1);return f.refreshedUponExpiration&&O>=1&&(f.refreshedUponExpiration=!1),d?{opacity:1,mix:1-Ee}:{opacity:Ee,mix:0}}return{opacity:1,mix:0}}var Dl=new y.Color(1,0,0,1),Xf=new y.Color(0,1,0,1),$f=new y.Color(0,0,1,1),Bl=new y.Color(1,0,1,1),Yf=new y.Color(0,1,1,1);function qf(f,d,h,g){fl(f,0,d+h/2,f.transform.width,h,g)}function Kf(f,d,h,g){fl(f,d-h/2,0,h,f.transform.height,g)}function fl(f,d,h,g,w,M){var I=f.context,O=I.gl;O.enable(O.SCISSOR_TEST),O.scissor(d*y.browser.devicePixelRatio,h*y.browser.devicePixelRatio,g*y.browser.devicePixelRatio,w*y.browser.devicePixelRatio),I.clear({color:M}),O.disable(O.SCISSOR_TEST)}function wh(f,d,h){var g=f.context,w=g.gl,M=h.posMatrix,I=f.useProgram("debug"),O=Ce.disabled,G=Be.disabled,Q=f.colorModeForRenderPass();g.activeTexture.set(w.TEXTURE0),f.emptyTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),I.draw(g,w.LINE_STRIP,O,G,Q,dt.disabled,Po(M,y.Color.red),"$debug",f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments);var ge=d.getTileByID(h.key).latestRawTileData,xe=Math.floor((ge&&ge.byteLength||0)/1024),Ee=d.getTile(h).tileSize,je=512/Math.min(Ee,512)*(h.overscaledZ/f.transform.zoom)*.5,Ve=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Ve+=" => "+h.overscaledZ),function(nt,Fe){nt.initDebugOverlayCanvas();var it=nt.debugOverlayCanvas,yt=nt.context.gl,Bt=nt.debugOverlayCanvas.getContext("2d");Bt.clearRect(0,0,it.width,it.height),Bt.shadowColor="white",Bt.shadowBlur=2,Bt.lineWidth=1.5,Bt.strokeStyle="white",Bt.textBaseline="top",Bt.font="bold 36px Open Sans, sans-serif",Bt.fillText(Fe,5,5),Bt.strokeText(Fe,5,5),nt.debugOverlayTexture.update(it),nt.debugOverlayTexture.bind(yt.LINEAR,yt.CLAMP_TO_EDGE)}(f,Ve+" "+xe+"kb"),I.draw(g,w.TRIANGLES,O,G,et.alphaBlended,dt.disabled,Po(M,y.Color.transparent,je),"$debug",f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments)}var Nl={symbol:function(f,d,h,g,w){if(f.renderPass==="translucent"){var M=Be.disabled,I=f.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(O,G,Q,ge,xe,Ee,je){for(var Ve=G.transform,nt=xe==="map",Fe=Ee==="map",it=0,yt=O;it<yt.length;it+=1){var Bt=yt[it],fr=ge.getTile(Bt),ir=fr.getBucket(Q);if(ir&&ir.text&&ir.text.segments.get().length){var mr=y.evaluateSizeForZoom(ir.textSizeData,Ve.zoom),Or=wt(fr,1,G.transform.zoom),on=Xa(Bt.posMatrix,Fe,nt,G.transform,Or),jr=Q.layout.get("icon-text-fit")!=="none"&&ir.hasIconData();if(mr){var Cn=Math.pow(2,Ve.zoom-fr.tileID.overscaledZ);gf(ir,nt,Fe,je,y.symbolSize,Ve,on,Bt.posMatrix,Cn,mr,jr)}}}}(g,f,h,d,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),w),h.paint.get("icon-opacity").constantOr(1)!==0&&Ys(f,d,h,g,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),M,I),h.paint.get("text-opacity").constantOr(1)!==0&&Ys(f,d,h,g,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),M,I),d.map.showCollisionBoxes&&($u(f,d,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),$u(f,d,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))}},circle:function(f,d,h,g){if(f.renderPass==="translucent"){var w=h.paint.get("circle-opacity"),M=h.paint.get("circle-stroke-width"),I=h.paint.get("circle-stroke-opacity"),O=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(w.constantOr(1)!==0||M.constantOr(1)!==0&&I.constantOr(1)!==0){for(var G=f.context,Q=G.gl,ge=f.depthModeForSublayer(0,Ce.ReadOnly),xe=Be.disabled,Ee=f.colorModeForRenderPass(),je=[],Ve=0;Ve<g.length;Ve++){var nt=g[Ve],Fe=d.getTile(nt),it=Fe.getBucket(h);if(it){var yt=it.programConfigurations.get(h.id),Bt={programConfiguration:yt,program:f.useProgram("circle",yt),layoutVertexBuffer:it.layoutVertexBuffer,indexBuffer:it.indexBuffer,uniformValues:Is(f,nt,Fe,h)};if(O)for(var fr=0,ir=it.segments.get();fr<ir.length;fr+=1){var mr=ir[fr];je.push({segments:new y.SegmentVector([mr]),sortKey:mr.sortKey,state:Bt})}else je.push({segments:it.segments,sortKey:0,state:Bt})}}O&&je.sort(function(ni,ii){return ni.sortKey-ii.sortKey});for(var Or=0,on=je;Or<on.length;Or+=1){var jr=on[Or],Cn=jr.state;Cn.program.draw(G,Q.TRIANGLES,ge,xe,Ee,dt.disabled,Cn.uniformValues,h.id,Cn.layoutVertexBuffer,Cn.indexBuffer,jr.segments,h.paint,f.transform.zoom,Cn.programConfiguration)}}}},heatmap:function(f,d,h,g){if(h.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){var w=f.context,M=w.gl,I=Be.disabled,O=new et([M.ONE,M.ONE],y.Color.transparent,[!0,!0,!0,!0]);(function(je,Ve,nt){var Fe=je.gl;je.activeTexture.set(Fe.TEXTURE1),je.viewport.set([0,0,Ve.width/4,Ve.height/4]);var it=nt.heatmapFbo;if(it)Fe.bindTexture(Fe.TEXTURE_2D,it.colorAttachment.get()),je.bindFramebuffer.set(it.framebuffer);else{var yt=Fe.createTexture();Fe.bindTexture(Fe.TEXTURE_2D,yt),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_WRAP_S,Fe.CLAMP_TO_EDGE),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_WRAP_T,Fe.CLAMP_TO_EDGE),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_MIN_FILTER,Fe.LINEAR),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_MAG_FILTER,Fe.LINEAR),it=nt.heatmapFbo=je.createFramebuffer(Ve.width/4,Ve.height/4,!1),function(Bt,fr,ir,mr){var Or=Bt.gl;Or.texImage2D(Or.TEXTURE_2D,0,Or.RGBA,fr.width/4,fr.height/4,0,Or.RGBA,Bt.extRenderToTextureHalfFloat?Bt.extTextureHalfFloat.HALF_FLOAT_OES:Or.UNSIGNED_BYTE,null),mr.colorAttachment.set(ir)}(je,Ve,yt,it)}})(w,f,h),w.clear({color:y.Color.transparent});for(var G=0;G<g.length;G++){var Q=g[G];if(!d.hasRenderableParent(Q)){var ge=d.getTile(Q),xe=ge.getBucket(h);if(xe){var Ee=xe.programConfigurations.get(h.id);f.useProgram("heatmap",Ee).draw(w,M.TRIANGLES,Ce.disabled,I,O,dt.disabled,zc(Q.posMatrix,ge,f.transform.zoom,h.paint.get("heatmap-intensity")),h.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,h.paint,f.transform.zoom,Ee)}}}w.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(je,Ve){var nt=je.context,Fe=nt.gl,it=Ve.heatmapFbo;if(it){nt.activeTexture.set(Fe.TEXTURE0),Fe.bindTexture(Fe.TEXTURE_2D,it.colorAttachment.get()),nt.activeTexture.set(Fe.TEXTURE1);var yt=Ve.colorRampTexture;yt||(yt=Ve.colorRampTexture=new y.Texture(nt,Ve.colorRamp,Fe.RGBA)),yt.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE),je.useProgram("heatmapTexture").draw(nt,Fe.TRIANGLES,Ce.disabled,Be.disabled,je.colorModeForRenderPass(),dt.disabled,function(Bt,fr,ir,mr){var Or=y.create();y.ortho(Or,0,Bt.width,Bt.height,0,0,1);var on=Bt.context.gl;return{u_matrix:Or,u_world:[on.drawingBufferWidth,on.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:fr.paint.get("heatmap-opacity")}}(je,Ve),Ve.id,je.viewportBuffer,je.quadTriangleIndexBuffer,je.viewportSegments,Ve.paint,je.transform.zoom)}}(f,h))},line:function(f,d,h,g){if(f.renderPass==="translucent"){var w=h.paint.get("line-opacity"),M=h.paint.get("line-width");if(w.constantOr(1)!==0&&M.constantOr(1)!==0)for(var I=f.depthModeForSublayer(0,Ce.ReadOnly),O=f.colorModeForRenderPass(),G=h.paint.get("line-dasharray"),Q=h.paint.get("line-pattern"),ge=Q.constantOr(1),xe=h.paint.get("line-gradient"),Ee=h.getCrossfadeParameters(),je=ge?"linePattern":G?"lineSDF":xe?"lineGradient":"line",Ve=f.context,nt=Ve.gl,Fe=!0,it=0,yt=g;it<yt.length;it+=1){var Bt=yt[it],fr=d.getTile(Bt);if(!ge||fr.patternsLoaded()){var ir=fr.getBucket(h);if(ir){var mr=ir.programConfigurations.get(h.id),Or=f.context.program.get(),on=f.useProgram(je,mr),jr=Fe||on.program!==Or,Cn=Q.constantOr(null);if(Cn&&fr.imageAtlas){var ni=fr.imageAtlas,ii=ni.patternPositions[Cn.to.toString()],oi=ni.patternPositions[Cn.from.toString()];ii&&oi&&mr.setConstantPatternPositions(ii,oi)}var ta=ge?Pl(f,fr,h,Ee):G?Gf(f,fr,h,G,Ee):xe?Pa(f,fr,h,ir.lineClipsArray.length):ll(f,fr,h);if(ge)Ve.activeTexture.set(nt.TEXTURE0),fr.imageAtlasTexture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE),mr.updatePaintBuffers(Ee);else if(G&&(jr||f.lineAtlas.dirty))Ve.activeTexture.set(nt.TEXTURE0),f.lineAtlas.bind(Ve);else if(xe){var An=ir.gradients[h.id],Ci=An.texture;if(h.gradientVersion!==An.version){var En=256;if(h.stepInterpolant){var li=d.getSource().maxzoom,Jn=Bt.canonical.z===li?Math.ceil(1<<f.transform.maxZoom-Bt.canonical.z):1;En=y.clamp(y.nextPowerOfTwo(ir.maxLineLength/y.EXTENT*1024*Jn),256,Ve.maxTextureSize)}An.gradient=y.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:En,image:An.gradient||void 0,clips:ir.lineClipsArray}),An.texture?An.texture.update(An.gradient):An.texture=new y.Texture(Ve,An.gradient,nt.RGBA),An.version=h.gradientVersion,Ci=An.texture}Ve.activeTexture.set(nt.TEXTURE0),Ci.bind(h.stepInterpolant?nt.NEAREST:nt.LINEAR,nt.CLAMP_TO_EDGE)}on.draw(Ve,nt.TRIANGLES,I,f.stencilModeForClipping(Bt),O,dt.disabled,ta,h.id,ir.layoutVertexBuffer,ir.indexBuffer,ir.segments,h.paint,f.transform.zoom,mr,ir.layoutVertexBuffer2),Fe=!1}}}}},fill:function(f,d,h,g){var w=h.paint.get("fill-color"),M=h.paint.get("fill-opacity");if(M.constantOr(1)!==0){var I=f.colorModeForRenderPass(),O=h.paint.get("fill-pattern"),G=f.opaquePassEnabledForLayer()&&!O.constantOr(1)&&w.constantOr(y.Color.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===G){var Q=f.depthModeForSublayer(1,f.renderPass==="opaque"?Ce.ReadWrite:Ce.ReadOnly);Zc(f,d,h,g,Q,I,!1)}if(f.renderPass==="translucent"&&h.paint.get("fill-antialias")){var ge=f.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,Ce.ReadOnly);Zc(f,d,h,g,ge,I,!0)}}},"fill-extrusion":function(f,d,h,g){var w=h.paint.get("fill-extrusion-opacity");if(w!==0&&f.renderPass==="translucent"){var M=new Ce(f.context.gl.LEQUAL,Ce.ReadWrite,f.depthRangeFor3D);if(w!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))yf(f,d,h,g,M,Be.disabled,et.disabled),yf(f,d,h,g,M,f.stencilModeFor3D(),f.colorModeForRenderPass());else{var I=f.colorModeForRenderPass();yf(f,d,h,g,M,Be.disabled,I)}}},hillshade:function(f,d,h,g){if(f.renderPass==="offscreen"||f.renderPass==="translucent"){for(var w=f.context,M=f.depthModeForSublayer(0,Ce.ReadOnly),I=f.colorModeForRenderPass(),O=f.renderPass==="translucent"?f.stencilConfigForOverlap(g):[{},g],G=O[0],Q=0,ge=O[1];Q<ge.length;Q+=1){var xe=ge[Q],Ee=d.getTile(xe);Ee.needsHillshadePrepare&&f.renderPass==="offscreen"?_f(f,Ee,h,M,Be.disabled,I):f.renderPass==="translucent"&&Fl(f,Ee,h,M,G[xe.overscaledZ],I)}w.viewport.set([0,0,f.width,f.height])}},raster:function(f,d,h,g){if(f.renderPass==="translucent"&&h.paint.get("raster-opacity")!==0&&g.length)for(var w=f.context,M=w.gl,I=d.getSource(),O=f.useProgram("raster"),G=f.colorModeForRenderPass(),Q=I instanceof lt?[{},g]:f.stencilConfigForOverlap(g),ge=Q[0],xe=Q[1],Ee=xe[xe.length-1].overscaledZ,je=!f.options.moving,Ve=0,nt=xe;Ve<nt.length;Ve+=1){var Fe=nt[Ve],it=f.depthModeForSublayer(Fe.overscaledZ-Ee,h.paint.get("raster-opacity")===1?Ce.ReadWrite:Ce.ReadOnly,M.LESS),yt=d.getTile(Fe),Bt=f.transform.calculatePosMatrix(Fe.toUnwrapped(),je);yt.registerFadeDuration(h.paint.get("raster-fade-duration"));var fr=d.findLoadedParent(Fe,0),ir=Uc(yt,fr,d,h,f.transform),mr=void 0,Or=void 0,on=h.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;w.activeTexture.set(M.TEXTURE0),yt.texture.bind(on,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),w.activeTexture.set(M.TEXTURE1),fr?(fr.texture.bind(on,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),mr=Math.pow(2,fr.tileID.overscaledZ-yt.tileID.overscaledZ),Or=[yt.tileID.canonical.x*mr%1,yt.tileID.canonical.y*mr%1]):yt.texture.bind(on,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST);var jr=tp(Bt,Or||[0,0],mr||1,ir,h);I instanceof lt?O.draw(w,M.TRIANGLES,it,Be.disabled,G,dt.disabled,jr,h.id,I.boundsBuffer,f.quadTriangleIndexBuffer,I.boundsSegments):O.draw(w,M.TRIANGLES,it,ge[Fe.overscaledZ],G,dt.disabled,jr,h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}},background:function(f,d,h){var g=h.paint.get("background-color"),w=h.paint.get("background-opacity");if(w!==0){var M=f.context,I=M.gl,O=f.transform,G=O.tileSize,Q=h.paint.get("background-pattern");if(!f.isPatternMissing(Q)){var ge=!Q&&g.a===1&&w===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass===ge){var xe=Be.disabled,Ee=f.depthModeForSublayer(0,ge==="opaque"?Ce.ReadWrite:Ce.ReadOnly),je=f.colorModeForRenderPass(),Ve=f.useProgram(Q?"backgroundPattern":"background"),nt=O.coveringTiles({tileSize:G});Q&&(M.activeTexture.set(I.TEXTURE0),f.imageManager.bind(f.context));for(var Fe=h.getCrossfadeParameters(),it=0,yt=nt;it<yt.length;it+=1){var Bt=yt[it],fr=f.transform.calculatePosMatrix(Bt.toUnwrapped()),ir=Q?cl(fr,w,f,Q,{tileID:Bt,tileSize:G},Fe):Ol(fr,w,g);Ve.draw(M,I.TRIANGLES,Ee,xe,je,dt.disabled,ir,h.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}}}},debug:function(f,d,h){for(var g=0;g<h.length;g++)wh(f,d,h[g])},custom:function(f,d,h){var g=f.context,w=h.implementation;if(f.renderPass==="offscreen"){var M=w.prerender;M&&(f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),M.call(w,g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),g.setStencilMode(Be.disabled);var I=w.renderingMode==="3d"?new Ce(f.context.gl.LEQUAL,Ce.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Ce.ReadOnly);g.setDepthMode(I),w.render(g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState(),g.bindFramebuffer.set(null)}}},ro=function(f,d){this.context=new me(f),this.transform=d,this._tileTextures={},this.setup(),this.numSublayers=Ge.maxUnderzooming+Ge.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new fs,this.gpuTimers={}};ro.prototype.resize=function(f,d){if(this.width=f*y.browser.devicePixelRatio,this.height=d*y.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var h=0,g=this.style._order;h<g.length;h+=1)this.style._layers[g[h]].resize()},ro.prototype.setup=function(){var f=this.context,d=new y.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(y.EXTENT,0),d.emplaceBack(0,y.EXTENT),d.emplaceBack(y.EXTENT,y.EXTENT),this.tileExtentBuffer=f.createVertexBuffer(d,ya.members),this.tileExtentSegments=y.SegmentVector.simpleSegment(0,0,4,2);var h=new y.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(y.EXTENT,0),h.emplaceBack(0,y.EXTENT),h.emplaceBack(y.EXTENT,y.EXTENT),this.debugBuffer=f.createVertexBuffer(h,ya.members),this.debugSegments=y.SegmentVector.simpleSegment(0,0,4,5);var g=new y.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(y.EXTENT,0,y.EXTENT,0),g.emplaceBack(0,y.EXTENT,0,y.EXTENT),g.emplaceBack(y.EXTENT,y.EXTENT,y.EXTENT,y.EXTENT),this.rasterBoundsBuffer=f.createVertexBuffer(g,Xe.members),this.rasterBoundsSegments=y.SegmentVector.simpleSegment(0,0,4,2);var w=new y.StructArrayLayout2i4;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=f.createVertexBuffer(w,ya.members),this.viewportSegments=y.SegmentVector.simpleSegment(0,0,4,2);var M=new y.StructArrayLayout1ui2;M.emplaceBack(0),M.emplaceBack(1),M.emplaceBack(3),M.emplaceBack(2),M.emplaceBack(0),this.tileBorderIndexBuffer=f.createIndexBuffer(M);var I=new y.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=f.createIndexBuffer(I),this.emptyTexture=new y.Texture(f,{width:1,height:1,data:new Uint8Array([0,0,0,0])},f.gl.RGBA);var O=this.context.gl;this.stencilClearMode=new Be({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO)},ro.prototype.clearStencil=function(){var f=this.context,d=f.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var h=y.create();y.ortho(h,0,this.width,this.height,0,0,1),y.scale(h,h,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(f,d.TRIANGLES,Ce.disabled,this.stencilClearMode,et.disabled,dt.disabled,nu(h),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},ro.prototype._renderTileClippingMasks=function(f,d){if(this.currentStencilSource!==f.source&&f.isTileClipped()&&d&&d.length){this.currentStencilSource=f.source;var h=this.context,g=h.gl;this.nextStencilID+d.length>256&&this.clearStencil(),h.setColorMode(et.disabled),h.setDepthMode(Ce.disabled);var w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var M=0,I=d;M<I.length;M+=1){var O=I[M],G=this._tileClippingMaskIDs[O.key]=this.nextStencilID++;w.draw(h,g.TRIANGLES,Ce.disabled,new Be({func:g.ALWAYS,mask:0},G,255,g.KEEP,g.KEEP,g.REPLACE),et.disabled,dt.disabled,nu(O.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},ro.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var f=this.nextStencilID++,d=this.context.gl;return new Be({func:d.NOTEQUAL,mask:255},f,255,d.KEEP,d.KEEP,d.REPLACE)},ro.prototype.stencilModeForClipping=function(f){var d=this.context.gl;return new Be({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[f.key],0,d.KEEP,d.KEEP,d.REPLACE)},ro.prototype.stencilConfigForOverlap=function(f){var d,h=this.context.gl,g=f.sort(function(G,Q){return Q.overscaledZ-G.overscaledZ}),w=g[g.length-1].overscaledZ,M=g[0].overscaledZ-w+1;if(M>1){this.currentStencilSource=void 0,this.nextStencilID+M>256&&this.clearStencil();for(var I={},O=0;O<M;O++)I[O+w]=new Be({func:h.GEQUAL,mask:255},O+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=M,[I,g]}return[(d={},d[w]=Be.disabled,d),g]},ro.prototype.colorModeForRenderPass=function(){var f=this.context.gl;return this._showOverdrawInspector?new et([f.CONSTANT_COLOR,f.ONE],new y.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?et.unblended:et.alphaBlended},ro.prototype.depthModeForSublayer=function(f,d,h){if(!this.opaquePassEnabledForLayer())return Ce.disabled;var g=1-((1+this.currentLayer)*this.numSublayers+f)*this.depthEpsilon;return new Ce(h||this.context.gl.LEQUAL,d,[g,g])},ro.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},ro.prototype.render=function(f,d){var h=this;this.style=f,this.options=d,this.lineAtlas=f.lineAtlas,this.imageManager=f.imageManager,this.glyphManager=f.glyphManager,this.symbolFadeChange=f.placement.symbolFadeChange(y.browser.now()),this.imageManager.beginFrame();var g=this.style._order,w=this.style.sourceCaches;for(var M in w){var I=w[M];I.used&&I.prepare(this.context)}var O,G,Q={},ge={},xe={};for(var Ee in w){var je=w[Ee];Q[Ee]=je.getVisibleCoordinates(),ge[Ee]=Q[Ee].slice().reverse(),xe[Ee]=je.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ve=0;Ve<g.length;Ve++)if(this.style._layers[g[Ve]].is3D()){this.opaquePassCutoff=Ve;break}this.renderPass="offscreen";for(var nt=0,Fe=g;nt<Fe.length;nt+=1){var it=this.style._layers[Fe[nt]];if(it.hasOffscreenPass()&&!it.isHidden(this.transform.zoom)){var yt=ge[it.source];(it.type==="custom"||yt.length)&&this.renderLayer(this,w[it.source],it,yt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?y.Color.black:y.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(f._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){var Bt=this.style._layers[g[this.currentLayer]],fr=w[Bt.source],ir=Q[Bt.source];this._renderTileClippingMasks(Bt,ir),this.renderLayer(this,fr,Bt,ir)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){var mr=this.style._layers[g[this.currentLayer]],Or=w[mr.source],on=(mr.type==="symbol"?xe:ge)[mr.source];this._renderTileClippingMasks(mr,Q[mr.source]),this.renderLayer(this,Or,mr,on)}this.options.showTileBoundaries&&(y.values(this.style._layers).forEach(function(jr){jr.source&&!jr.isHidden(h.transform.zoom)&&(jr.source!==(G&&G.id)&&(G=h.style.sourceCaches[jr.source]),(!O||O.getSource().maxzoom<G.getSource().maxzoom)&&(O=G))}),O&&Nl.debug(this,O,O.getVisibleCoordinates())),this.options.showPadding&&function(jr){var Cn=jr.transform.padding;qf(jr,jr.transform.height-(Cn.top||0),3,Dl),qf(jr,Cn.bottom||0,3,Xf),Kf(jr,Cn.left||0,3,$f),Kf(jr,jr.transform.width-(Cn.right||0),3,Bl);var ni=jr.transform.centerPoint;(function(ii,oi,ta,An){fl(ii,oi-1,ta-10,2,20,An),fl(ii,oi-10,ta-1,20,2,An)})(jr,ni.x,jr.transform.height-ni.y,Yf)}(this),this.context.setDefault()},ro.prototype.renderLayer=function(f,d,h,g){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||g.length)&&(this.id=h.id,this.gpuTimingStart(h),Nl[h.type](f,d,h,g,this.style.placement.variableOffsets),this.gpuTimingEnd())},ro.prototype.gpuTimingStart=function(f){if(this.options.gpuTiming){var d=this.context.extTimerQuery,h=this.gpuTimers[f.id];h||(h=this.gpuTimers[f.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),h.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,h.query)}},ro.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var f=this.context.extTimerQuery;f.endQueryEXT(f.TIME_ELAPSED_EXT)}},ro.prototype.collectGpuTimers=function(){var f=this.gpuTimers;return this.gpuTimers={},f},ro.prototype.queryGpuTimers=function(f){var d={};for(var h in f){var g=f[h],w=this.context.extTimerQuery,M=w.getQueryObjectEXT(g.query,w.QUERY_RESULT_EXT)/1e6;w.deleteQueryEXT(g.query),d[h]=M}return d},ro.prototype.translatePosMatrix=function(f,d,h,g,w){if(!h[0]&&!h[1])return f;var M=w?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(M){var I=Math.sin(M),O=Math.cos(M);h=[h[0]*O-h[1]*I,h[0]*I+h[1]*O]}var G=[w?h[0]:wt(d,h[0],this.transform.zoom),w?h[1]:wt(d,h[1],this.transform.zoom),0],Q=new Float32Array(16);return y.translate(Q,f,G),Q},ro.prototype.saveTileTexture=function(f){var d=this._tileTextures[f.size[0]];d?d.push(f):this._tileTextures[f.size[0]]=[f]},ro.prototype.getTileTexture=function(f){var d=this._tileTextures[f];return d&&d.length>0?d.pop():null},ro.prototype.isPatternMissing=function(f){if(!f)return!1;if(!f.from||!f.to)return!0;var d=this.imageManager.getPattern(f.from.toString()),h=this.imageManager.getPattern(f.to.toString());return!d||!h},ro.prototype.useProgram=function(f,d){this.cache=this.cache||{};var h=""+f+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[h]||(this.cache[h]=new vf(this.context,f,xs[f],d,Xu[f],this._showOverdrawInspector)),this.cache[h]},ro.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},ro.prototype.setBaseState=function(){var f=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(f.FUNC_ADD)},ro.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=y.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},ro.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var vc=function(f,d){this.points=f,this.planes=d};vc.fromInvProjectionMatrix=function(f,d,h){var g=Math.pow(2,h),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(I){return y.transformMat4([],I,f)}).map(function(I){return y.scale$1([],I,1/I[3]/d*g)}),M=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(I){var O=y.sub([],w[I[0]],w[I[1]]),G=y.sub([],w[I[2]],w[I[1]]),Q=y.normalize([],y.cross([],O,G)),ge=-y.dot(Q,w[I[1]]);return Q.concat(ge)});return new vc(w,M)};var Eu=function(f,d){this.min=f,this.max=d,this.center=y.scale$2([],y.add([],this.min,this.max),.5)};Eu.prototype.quadrant=function(f){for(var d=[f%2==0,f<2],h=y.clone$2(this.min),g=y.clone$2(this.max),w=0;w<d.length;w++)h[w]=d[w]?this.min[w]:this.center[w],g[w]=d[w]?this.center[w]:this.max[w];return g[2]=this.max[2],new Eu(h,g)},Eu.prototype.distanceX=function(f){return Math.max(Math.min(this.max[0],f[0]),this.min[0])-f[0]},Eu.prototype.distanceY=function(f){return Math.max(Math.min(this.max[1],f[1]),this.min[1])-f[1]},Eu.prototype.intersects=function(f){for(var d=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],h=!0,g=0;g<f.planes.length;g++){for(var w=f.planes[g],M=0,I=0;I<d.length;I++)M+=y.dot$1(w,d[I])>=0;if(M===0)return 0;M!==d.length&&(h=!1)}if(h)return 2;for(var O=0;O<3;O++){for(var G=Number.MAX_VALUE,Q=-Number.MAX_VALUE,ge=0;ge<f.points.length;ge++){var xe=f.points[ge][O]-this.min[O];G=Math.min(G,xe),Q=Math.max(Q,xe)}if(Q<0||G>this.max[O]-this.min[O])return 0}return 1};var Nu=function(f,d,h,g){if(f===void 0&&(f=0),d===void 0&&(d=0),h===void 0&&(h=0),g===void 0&&(g=0),isNaN(f)||f<0||isNaN(d)||d<0||isNaN(h)||h<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=f,this.bottom=d,this.left=h,this.right=g};Nu.prototype.interpolate=function(f,d,h){return d.top!=null&&f.top!=null&&(this.top=y.number(f.top,d.top,h)),d.bottom!=null&&f.bottom!=null&&(this.bottom=y.number(f.bottom,d.bottom,h)),d.left!=null&&f.left!=null&&(this.left=y.number(f.left,d.left,h)),d.right!=null&&f.right!=null&&(this.right=y.number(f.right,d.right,h)),this},Nu.prototype.getCenter=function(f,d){var h=y.clamp((this.left+f-this.right)/2,0,f),g=y.clamp((this.top+d-this.bottom)/2,0,d);return new y.Point(h,g)},Nu.prototype.equals=function(f){return this.top===f.top&&this.bottom===f.bottom&&this.left===f.left&&this.right===f.right},Nu.prototype.clone=function(){return new Nu(this.top,this.bottom,this.left,this.right)},Nu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var aa=function(f,d,h,g,w){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=w===void 0||w,this._minZoom=f||0,this._maxZoom=d||22,this._minPitch=h==null?0:h,this._maxPitch=g==null?60:g,this.setMaxBounds(),this.width=0,this.height=0,this._center=new y.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Nu,this._posMatrixCache={},this._alignedPosMatrixCache={}},ja={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};aa.prototype.clone=function(){var f=new aa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return f.tileSize=this.tileSize,f.latRange=this.latRange,f.width=this.width,f.height=this.height,f._center=this._center,f.zoom=this.zoom,f.angle=this.angle,f._fov=this._fov,f._pitch=this._pitch,f._unmodified=this._unmodified,f._edgeInsets=this._edgeInsets.clone(),f._calcMatrices(),f},ja.minZoom.get=function(){return this._minZoom},ja.minZoom.set=function(f){this._minZoom!==f&&(this._minZoom=f,this.zoom=Math.max(this.zoom,f))},ja.maxZoom.get=function(){return this._maxZoom},ja.maxZoom.set=function(f){this._maxZoom!==f&&(this._maxZoom=f,this.zoom=Math.min(this.zoom,f))},ja.minPitch.get=function(){return this._minPitch},ja.minPitch.set=function(f){this._minPitch!==f&&(this._minPitch=f,this.pitch=Math.max(this.pitch,f))},ja.maxPitch.get=function(){return this._maxPitch},ja.maxPitch.set=function(f){this._maxPitch!==f&&(this._maxPitch=f,this.pitch=Math.min(this.pitch,f))},ja.renderWorldCopies.get=function(){return this._renderWorldCopies},ja.renderWorldCopies.set=function(f){f===void 0?f=!0:f===null&&(f=!1),this._renderWorldCopies=f},ja.worldSize.get=function(){return this.tileSize*this.scale},ja.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},ja.size.get=function(){return new y.Point(this.width,this.height)},ja.bearing.get=function(){return-this.angle/Math.PI*180},ja.bearing.set=function(f){var d=-y.wrap(f,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=y.create$2(),y.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},ja.pitch.get=function(){return this._pitch/Math.PI*180},ja.pitch.set=function(f){var d=y.clamp(f,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())},ja.fov.get=function(){return this._fov/Math.PI*180},ja.fov.set=function(f){f=Math.max(.01,Math.min(60,f)),this._fov!==f&&(this._unmodified=!1,this._fov=f/180*Math.PI,this._calcMatrices())},ja.zoom.get=function(){return this._zoom},ja.zoom.set=function(f){var d=Math.min(Math.max(f,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom,this._constrain(),this._calcMatrices())},ja.center.get=function(){return this._center},ja.center.set=function(f){f.lat===this._center.lat&&f.lng===this._center.lng||(this._unmodified=!1,this._center=f,this._constrain(),this._calcMatrices())},ja.padding.get=function(){return this._edgeInsets.toJSON()},ja.padding.set=function(f){this._edgeInsets.equals(f)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,f,1),this._calcMatrices())},ja.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},aa.prototype.isPaddingEqual=function(f){return this._edgeInsets.equals(f)},aa.prototype.interpolatePadding=function(f,d,h){this._unmodified=!1,this._edgeInsets.interpolate(f,d,h),this._constrain(),this._calcMatrices()},aa.prototype.coveringZoomLevel=function(f){var d=(f.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/f.tileSize));return Math.max(0,d)},aa.prototype.getVisibleUnwrappedCoordinates=function(f){var d=[new y.UnwrappedTileID(0,f)];if(this._renderWorldCopies)for(var h=this.pointCoordinate(new y.Point(0,0)),g=this.pointCoordinate(new y.Point(this.width,0)),w=this.pointCoordinate(new y.Point(this.width,this.height)),M=this.pointCoordinate(new y.Point(0,this.height)),I=Math.floor(Math.min(h.x,g.x,w.x,M.x)),O=Math.floor(Math.max(h.x,g.x,w.x,M.x)),G=I-1;G<=O+1;G++)G!==0&&d.push(new y.UnwrappedTileID(G,f));return d},aa.prototype.coveringTiles=function(f){var d=this.coveringZoomLevel(f),h=d;if(f.minzoom!==void 0&&d<f.minzoom)return[];f.maxzoom!==void 0&&d>f.maxzoom&&(d=f.maxzoom);var g=y.MercatorCoordinate.fromLngLat(this.center),w=Math.pow(2,d),M=[w*g.x,w*g.y,0],I=vc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d),O=f.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(O=d);var G=function(jr){return{aabb:new Eu([jr*w,0,0],[(jr+1)*w,w,0]),zoom:0,x:0,y:0,wrap:jr,fullyVisible:!1}},Q=[],ge=[],xe=d,Ee=f.reparseOverscaled?h:d;if(this._renderWorldCopies)for(var je=1;je<=3;je++)Q.push(G(-je)),Q.push(G(je));for(Q.push(G(0));Q.length>0;){var Ve=Q.pop(),nt=Ve.x,Fe=Ve.y,it=Ve.fullyVisible;if(!it){var yt=Ve.aabb.intersects(I);if(yt===0)continue;it=yt===2}var Bt=Ve.aabb.distanceX(M),fr=Ve.aabb.distanceY(M),ir=Math.max(Math.abs(Bt),Math.abs(fr));if(Ve.zoom===xe||ir>3+(1<<xe-Ve.zoom)-2&&Ve.zoom>=O)ge.push({tileID:new y.OverscaledTileID(Ve.zoom===xe?Ee:Ve.zoom,Ve.wrap,Ve.zoom,nt,Fe),distanceSq:y.sqrLen([M[0]-.5-nt,M[1]-.5-Fe])});else for(var mr=0;mr<4;mr++){var Or=(nt<<1)+mr%2,on=(Fe<<1)+(mr>>1);Q.push({aabb:Ve.aabb.quadrant(mr),zoom:Ve.zoom+1,x:Or,y:on,wrap:Ve.wrap,fullyVisible:it})}}return ge.sort(function(jr,Cn){return jr.distanceSq-Cn.distanceSq}).map(function(jr){return jr.tileID})},aa.prototype.resize=function(f,d){this.width=f,this.height=d,this.pixelsToGLUnits=[2/f,-2/d],this._constrain(),this._calcMatrices()},ja.unmodified.get=function(){return this._unmodified},aa.prototype.zoomScale=function(f){return Math.pow(2,f)},aa.prototype.scaleZoom=function(f){return Math.log(f)/Math.LN2},aa.prototype.project=function(f){var d=y.clamp(f.lat,-this.maxValidLatitude,this.maxValidLatitude);return new y.Point(y.mercatorXfromLng(f.lng)*this.worldSize,y.mercatorYfromLat(d)*this.worldSize)},aa.prototype.unproject=function(f){return new y.MercatorCoordinate(f.x/this.worldSize,f.y/this.worldSize).toLngLat()},ja.point.get=function(){return this.project(this.center)},aa.prototype.setLocationAtPoint=function(f,d){var h=this.pointCoordinate(d),g=this.pointCoordinate(this.centerPoint),w=this.locationCoordinate(f),M=new y.MercatorCoordinate(w.x-(h.x-g.x),w.y-(h.y-g.y));this.center=this.coordinateLocation(M),this._renderWorldCopies&&(this.center=this.center.wrap())},aa.prototype.locationPoint=function(f){return this.coordinatePoint(this.locationCoordinate(f))},aa.prototype.pointLocation=function(f){return this.coordinateLocation(this.pointCoordinate(f))},aa.prototype.locationCoordinate=function(f){return y.MercatorCoordinate.fromLngLat(f)},aa.prototype.coordinateLocation=function(f){return f.toLngLat()},aa.prototype.pointCoordinate=function(f){var d=[f.x,f.y,0,1],h=[f.x,f.y,1,1];y.transformMat4(d,d,this.pixelMatrixInverse),y.transformMat4(h,h,this.pixelMatrixInverse);var g=d[3],w=h[3],M=d[1]/g,I=h[1]/w,O=d[2]/g,G=h[2]/w,Q=O===G?0:(0-O)/(G-O);return new y.MercatorCoordinate(y.number(d[0]/g,h[0]/w,Q)/this.worldSize,y.number(M,I,Q)/this.worldSize)},aa.prototype.coordinatePoint=function(f){var d=[f.x*this.worldSize,f.y*this.worldSize,0,1];return y.transformMat4(d,d,this.pixelMatrix),new y.Point(d[0]/d[3],d[1]/d[3])},aa.prototype.getBounds=function(){return new y.LngLatBounds().extend(this.pointLocation(new y.Point(0,0))).extend(this.pointLocation(new y.Point(this.width,0))).extend(this.pointLocation(new y.Point(this.width,this.height))).extend(this.pointLocation(new y.Point(0,this.height)))},aa.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new y.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},aa.prototype.setMaxBounds=function(f){f?(this.lngRange=[f.getWest(),f.getEast()],this.latRange=[f.getSouth(),f.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},aa.prototype.calculatePosMatrix=function(f,d){d===void 0&&(d=!1);var h=f.key,g=d?this._alignedPosMatrixCache:this._posMatrixCache;if(g[h])return g[h];var w=f.canonical,M=this.worldSize/this.zoomScale(w.z),I=w.x+Math.pow(2,w.z)*f.wrap,O=y.identity(new Float64Array(16));return y.translate(O,O,[I*M,w.y*M,0]),y.scale(O,O,[M/y.EXTENT,M/y.EXTENT,1]),y.multiply(O,d?this.alignedProjMatrix:this.projMatrix,O),g[h]=new Float32Array(O),g[h]},aa.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},aa.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var f,d,h,g,w=-90,M=90,I=-180,O=180,G=this.size,Q=this._unmodified;if(this.latRange){var ge=this.latRange;w=y.mercatorYfromLat(ge[1])*this.worldSize,f=(M=y.mercatorYfromLat(ge[0])*this.worldSize)-w<G.y?G.y/(M-w):0}if(this.lngRange){var xe=this.lngRange;I=y.mercatorXfromLng(xe[0])*this.worldSize,d=(O=y.mercatorXfromLng(xe[1])*this.worldSize)-I<G.x?G.x/(O-I):0}var Ee=this.point,je=Math.max(d||0,f||0);if(je)return this.center=this.unproject(new y.Point(d?(O+I)/2:Ee.x,f?(M+w)/2:Ee.y)),this.zoom+=this.scaleZoom(je),this._unmodified=Q,void(this._constraining=!1);if(this.latRange){var Ve=Ee.y,nt=G.y/2;Ve-nt<w&&(g=w+nt),Ve+nt>M&&(g=M-nt)}if(this.lngRange){var Fe=Ee.x,it=G.x/2;Fe-it<I&&(h=I+it),Fe+it>O&&(h=O-it)}h===void 0&&g===void 0||(this.center=this.unproject(new y.Point(h!==void 0?h:Ee.x,g!==void 0?g:Ee.y))),this._unmodified=Q,this._constraining=!1}},aa.prototype._calcMatrices=function(){if(this.height){var f=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var d=Math.PI/2+this._pitch,h=this._fov*(.5+f.y/this.height),g=Math.sin(h)*this.cameraToCenterDistance/Math.sin(y.clamp(Math.PI-d-h,.01,Math.PI-.01)),w=this.point,M=w.x,I=w.y,O=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),G=this.height/50,Q=new Float64Array(16);y.perspective(Q,this._fov,this.width/this.height,G,O),Q[8]=2*-f.x/this.width,Q[9]=2*f.y/this.height,y.scale(Q,Q,[1,-1,1]),y.translate(Q,Q,[0,0,-this.cameraToCenterDistance]),y.rotateX(Q,Q,this._pitch),y.rotateZ(Q,Q,this.angle),y.translate(Q,Q,[-M,-I,0]),this.mercatorMatrix=y.scale([],Q,[this.worldSize,this.worldSize,this.worldSize]),y.scale(Q,Q,[1,1,y.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=Q,this.invProjMatrix=y.invert([],this.projMatrix);var ge=this.width%2/2,xe=this.height%2/2,Ee=Math.cos(this.angle),je=Math.sin(this.angle),Ve=M-Math.round(M)+Ee*ge+je*xe,nt=I-Math.round(I)+Ee*xe+je*ge,Fe=new Float64Array(Q);if(y.translate(Fe,Fe,[Ve>.5?Ve-1:Ve,nt>.5?nt-1:nt,0]),this.alignedProjMatrix=Fe,Q=y.create(),y.scale(Q,Q,[this.width/2,-this.height/2,1]),y.translate(Q,Q,[1,-1,0]),this.labelPlaneMatrix=Q,Q=y.create(),y.scale(Q,Q,[1,-1,1]),y.translate(Q,Q,[-1,-1,0]),y.scale(Q,Q,[2/this.width,2/this.height,1]),this.glCoordMatrix=Q,this.pixelMatrix=y.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(Q=y.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=Q,this._posMatrixCache={},this._alignedPosMatrixCache={}}},aa.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var f=this.pointCoordinate(new y.Point(0,0)),d=[f.x*this.worldSize,f.y*this.worldSize,0,1];return y.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance},aa.prototype.getCameraPoint=function(){var f=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.Point(0,f))},aa.prototype.getCameraQueryGeometry=function(f){var d=this.getCameraPoint();if(f.length===1)return[f[0],d];for(var h=d.x,g=d.y,w=d.x,M=d.y,I=0,O=f;I<O.length;I+=1){var G=O[I];h=Math.min(h,G.x),g=Math.min(g,G.y),w=Math.max(w,G.x),M=Math.max(M,G.y)}return[new y.Point(h,g),new y.Point(w,g),new y.Point(w,M),new y.Point(h,M),new y.Point(h,g)]},Object.defineProperties(aa.prototype,ja);var bs=function(f){var d,h,g,w;this._hashName=f&&encodeURIComponent(f),y.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(d=this._updateHashUnthrottled.bind(this),h=!1,g=null,w=function(){g=null,h&&(d(),g=setTimeout(w,300),h=!1)},function(){return h=!0,g||w(),g})};bs.prototype.addTo=function(f){return this._map=f,y.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},bs.prototype.remove=function(){return y.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},bs.prototype.getHashString=function(f){var d=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,g=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,g),M=Math.round(d.lng*w)/w,I=Math.round(d.lat*w)/w,O=this._map.getBearing(),G=this._map.getPitch(),Q="";if(Q+=f?"/"+M+"/"+I+"/"+h:h+"/"+I+"/"+M,(O||G)&&(Q+="/"+Math.round(10*O)/10),G&&(Q+="/"+Math.round(G)),this._hashName){var ge=this._hashName,xe=!1,Ee=y.window.location.hash.slice(1).split("&").map(function(je){var Ve=je.split("=")[0];return Ve===ge?(xe=!0,Ve+"="+Q):je}).filter(function(je){return je});return xe||Ee.push(ge+"="+Q),"#"+Ee.join("&")}return"#"+Q},bs.prototype._getCurrentHash=function(){var f,d=this,h=y.window.location.hash.replace("#","");return this._hashName?(h.split("&").map(function(g){return g.split("=")}).forEach(function(g){g[0]===d._hashName&&(f=g)}),(f&&f[1]||"").split("/")):h.split("/")},bs.prototype._onHashChange=function(){var f=this._getCurrentHash();if(f.length>=3&&!f.some(function(h){return isNaN(h)})){var d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:d,pitch:+(f[4]||0)}),!0}return!1},bs.prototype._updateHashUnthrottled=function(){var f=y.window.location.href.replace(/(#.+)?$/,this.getHashString());try{y.window.history.replaceState(y.window.history.state,null,f)}catch(d){}};var xf={linearity:.3,easing:y.bezier(0,0,.3,1)},hl=y.extend({deceleration:2500,maxSpeed:1400},xf),bf=y.extend({deceleration:20,maxSpeed:1400},xf),rp=y.extend({deceleration:1e3,maxSpeed:360},xf),np=y.extend({deceleration:1e3,maxSpeed:90},xf),Ef=function(f){this._map=f,this.clear()};function zl(f,d){(!f.duration||f.duration<d.duration)&&(f.duration=d.duration,f.easing=d.easing)}function pl(f,d,h){var g=h.maxSpeed,w=h.linearity,M=h.deceleration,I=y.clamp(f*w/(d/1e3),-g,g),O=Math.abs(I)/(M*w);return{easing:h.easing,duration:1e3*O,amount:I*(O/2)}}Ef.prototype.clear=function(){this._inertiaBuffer=[]},Ef.prototype.record=function(f){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.browser.now(),settings:f})},Ef.prototype._drainInertiaBuffer=function(){for(var f=this._inertiaBuffer,d=y.browser.now();f.length>0&&d-f[0].time>160;)f.shift()},Ef.prototype._onMoveEnd=function(f){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var d={zoom:0,bearing:0,pitch:0,pan:new y.Point(0,0),pinchAround:void 0,around:void 0},h=0,g=this._inertiaBuffer;h<g.length;h+=1){var w=g[h].settings;d.zoom+=w.zoomDelta||0,d.bearing+=w.bearingDelta||0,d.pitch+=w.pitchDelta||0,w.panDelta&&d.pan._add(w.panDelta),w.around&&(d.around=w.around),w.pinchAround&&(d.pinchAround=w.pinchAround)}var M=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,I={};if(d.pan.mag()){var O=pl(d.pan.mag(),M,y.extend({},hl,f||{}));I.offset=d.pan.mult(O.amount/d.pan.mag()),I.center=this._map.transform.center,zl(I,O)}if(d.zoom){var G=pl(d.zoom,M,bf);I.zoom=this._map.transform.zoom+G.amount,zl(I,G)}if(d.bearing){var Q=pl(d.bearing,M,rp);I.bearing=this._map.transform.bearing+y.clamp(Q.amount,-179,179),zl(I,Q)}if(d.pitch){var ge=pl(d.pitch,M,np);I.pitch=this._map.transform.pitch+ge.amount,zl(I,ge)}if(I.zoom||I.bearing){var xe=d.pinchAround===void 0?d.around:d.pinchAround;I.around=xe?this._map.unproject(xe):this._map.getCenter()}return this.clear(),y.extend(I,{noMoveStart:!0})}};var Yo=function(f){function d(g,w,M,I){I===void 0&&(I={});var O=X.mousePos(w.getCanvasContainer(),M),G=w.unproject(O);f.call(this,g,y.extend({point:O,lngLat:G,originalEvent:M},I)),this._defaultPrevented=!1,this.target=w}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),Vc=function(f){function d(g,w,M){var I=g==="touchend"?M.changedTouches:M.touches,O=X.touchPos(w.getCanvasContainer(),I),G=O.map(function(xe){return w.unproject(xe)}),Q=O.reduce(function(xe,Ee,je,Ve){return xe.add(Ee.div(Ve.length))},new y.Point(0,0)),ge=w.unproject(Q);f.call(this,g,{points:O,point:Q,lngLats:G,lngLat:ge,originalEvent:M}),this._defaultPrevented=!1}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),Zl=function(f){function d(g,w,M){f.call(this,g,{originalEvent:M}),this._defaultPrevented=!1}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(y.Event),Ro=function(f,d){this._map=f,this._clickTolerance=d.clickTolerance};Ro.prototype.reset=function(){delete this._mousedownPos},Ro.prototype.wheel=function(f){return this._firePreventable(new Zl(f.type,this._map,f))},Ro.prototype.mousedown=function(f,d){return this._mousedownPos=d,this._firePreventable(new Yo(f.type,this._map,f))},Ro.prototype.mouseup=function(f){this._map.fire(new Yo(f.type,this._map,f))},Ro.prototype.click=function(f,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Yo(f.type,this._map,f))},Ro.prototype.dblclick=function(f){return this._firePreventable(new Yo(f.type,this._map,f))},Ro.prototype.mouseover=function(f){this._map.fire(new Yo(f.type,this._map,f))},Ro.prototype.mouseout=function(f){this._map.fire(new Yo(f.type,this._map,f))},Ro.prototype.touchstart=function(f){return this._firePreventable(new Vc(f.type,this._map,f))},Ro.prototype.touchmove=function(f){this._map.fire(new Vc(f.type,this._map,f))},Ro.prototype.touchend=function(f){this._map.fire(new Vc(f.type,this._map,f))},Ro.prototype.touchcancel=function(f){this._map.fire(new Vc(f.type,this._map,f))},Ro.prototype._firePreventable=function(f){if(this._map.fire(f),f.defaultPrevented)return{}},Ro.prototype.isEnabled=function(){return!0},Ro.prototype.isActive=function(){return!1},Ro.prototype.enable=function(){},Ro.prototype.disable=function(){};var Dn=function(f){this._map=f};Dn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Dn.prototype.mousemove=function(f){this._map.fire(new Yo(f.type,this._map,f))},Dn.prototype.mousedown=function(){this._delayContextMenu=!0},Dn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Yo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Dn.prototype.contextmenu=function(f){this._delayContextMenu?this._contextMenuEvent=f:this._map.fire(new Yo(f.type,this._map,f)),this._map.listens("contextmenu")&&f.preventDefault()},Dn.prototype.isEnabled=function(){return!0},Dn.prototype.isActive=function(){return!1},Dn.prototype.enable=function(){},Dn.prototype.disable=function(){};var mo=function(f,d){this._map=f,this._el=f.getCanvasContainer(),this._container=f.getContainer(),this._clickTolerance=d.clickTolerance||1};function jo(f,d){for(var h={},g=0;g<f.length;g++)h[f[g].identifier]=d[g];return h}mo.prototype.isEnabled=function(){return!!this._enabled},mo.prototype.isActive=function(){return!!this._active},mo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},mo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},mo.prototype.mousedown=function(f,d){this.isEnabled()&&f.shiftKey&&f.button===0&&(X.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)},mo.prototype.mousemoveWindow=function(f,d){if(this._active){var h=d;if(!(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)){var g=this._startPos;this._lastPos=h,this._box||(this._box=X.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",f));var w=Math.min(g.x,h.x),M=Math.max(g.x,h.x),I=Math.min(g.y,h.y),O=Math.max(g.y,h.y);X.setTransform(this._box,"translate("+w+"px,"+I+"px)"),this._box.style.width=M-w+"px",this._box.style.height=O-I+"px"}}},mo.prototype.mouseupWindow=function(f,d){var h=this;if(this._active&&f.button===0){var g=this._startPos,w=d;if(this.reset(),X.suppressClick(),g.x!==w.x||g.y!==w.y)return this._map.fire(new y.Event("boxzoomend",{originalEvent:f})),{cameraAnimation:function(M){return M.fitScreenCoordinates(g,w,h._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",f)}},mo.prototype.keydown=function(f){this._active&&f.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",f))},mo.prototype.blur=function(){this.reset()},mo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(X.remove(this._box),this._box=null),X.enableDrag(),delete this._startPos,delete this._lastPos},mo.prototype._fireEvent=function(f,d){return this._map.fire(new y.Event(f,{originalEvent:d}))};var Ul=function(f){this.reset(),this.numTouches=f.numTouches};Ul.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Ul.prototype.touchstart=function(f,d,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=f.timeStamp),h.length===this.numTouches&&(this.centroid=function(g){for(var w=new y.Point(0,0),M=0,I=g;M<I.length;M+=1)w._add(I[M]);return w.div(g.length)}(d),this.touches=jo(h,d)))},Ul.prototype.touchmove=function(f,d,h){if(!this.aborted&&this.centroid){var g=jo(h,d);for(var w in this.touches){var M=g[w];(!M||M.dist(this.touches[w])>30)&&(this.aborted=!0)}}},Ul.prototype.touchend=function(f,d,h){if((!this.centroid||f.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){var g=!this.aborted&&this.centroid;if(this.reset(),g)return g}};var Xi=function(f){this.singleTap=new Ul(f),this.numTaps=f.numTaps,this.reset()};Xi.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Xi.prototype.touchstart=function(f,d,h){this.singleTap.touchstart(f,d,h)},Xi.prototype.touchmove=function(f,d,h){this.singleTap.touchmove(f,d,h)},Xi.prototype.touchend=function(f,d,h){var g=this.singleTap.touchend(f,d,h);if(g){var w=f.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(g)<30;if(w&&M||this.reset(),this.count++,this.lastTime=f.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}};var Bs=function(){this._zoomIn=new Xi({numTouches:1,numTaps:2}),this._zoomOut=new Xi({numTouches:2,numTaps:1}),this.reset()};Bs.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Bs.prototype.touchstart=function(f,d,h){this._zoomIn.touchstart(f,d,h),this._zoomOut.touchstart(f,d,h)},Bs.prototype.touchmove=function(f,d,h){this._zoomIn.touchmove(f,d,h),this._zoomOut.touchmove(f,d,h)},Bs.prototype.touchend=function(f,d,h){var g=this,w=this._zoomIn.touchend(f,d,h),M=this._zoomOut.touchend(f,d,h);return w?(this._active=!0,f.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(I){return I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(w)},{originalEvent:f})}}):M?(this._active=!0,f.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(I){return I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(M)},{originalEvent:f})}}):void 0},Bs.prototype.touchcancel=function(){this.reset()},Bs.prototype.enable=function(){this._enabled=!0},Bs.prototype.disable=function(){this._enabled=!1,this.reset()},Bs.prototype.isEnabled=function(){return this._enabled},Bs.prototype.isActive=function(){return this._active};var Qf={0:1,2:2},vn=function(f){this.reset(),this._clickTolerance=f.clickTolerance||1};vn.prototype.blur=function(){this.reset()},vn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},vn.prototype._correctButton=function(f,d){return!1},vn.prototype._move=function(f,d){return{}},vn.prototype.mousedown=function(f,d){if(!this._lastPoint){var h=X.mouseButton(f);this._correctButton(f,h)&&(this._lastPoint=d,this._eventButton=h)}},vn.prototype.mousemoveWindow=function(f,d){var h=this._lastPoint;if(h){if(f.preventDefault(),function(g,w){var M=Qf[w];return g.buttons===void 0||(g.buttons&M)!==M}(f,this._eventButton))this.reset();else if(this._moved||!(d.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(h,d)}},vn.prototype.mouseupWindow=function(f){this._lastPoint&&X.mouseButton(f)===this._eventButton&&(this._moved&&X.suppressClick(),this.reset())},vn.prototype.enable=function(){this._enabled=!0},vn.prototype.disable=function(){this._enabled=!1,this.reset()},vn.prototype.isEnabled=function(){return this._enabled},vn.prototype.isActive=function(){return this._active};var jc=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.mousedown=function(h,g){f.prototype.mousedown.call(this,h,g),this._lastPoint&&(this._active=!0)},d.prototype._correctButton=function(h,g){return g===0&&!h.ctrlKey},d.prototype._move=function(h,g){return{around:g,panDelta:g.sub(h)}},d}(vn),Sf=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype._correctButton=function(h,g){return g===0&&h.ctrlKey||g===2},d.prototype._move=function(h,g){var w=.8*(g.x-h.x);if(w)return this._active=!0,{bearingDelta:w}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(vn),dl=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype._correctButton=function(h,g){return g===0&&h.ctrlKey||g===2},d.prototype._move=function(h,g){var w=-.5*(g.y-h.y);if(w)return this._active=!0,{pitchDelta:w}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(vn),ri=function(f){this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset()};ri.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new y.Point(0,0)},ri.prototype.touchstart=function(f,d,h){return this._calculateTransform(f,d,h)},ri.prototype.touchmove=function(f,d,h){if(this._active&&!(h.length<this._minTouches))return f.preventDefault(),this._calculateTransform(f,d,h)},ri.prototype.touchend=function(f,d,h){this._calculateTransform(f,d,h),this._active&&h.length<this._minTouches&&this.reset()},ri.prototype.touchcancel=function(){this.reset()},ri.prototype._calculateTransform=function(f,d,h){h.length>0&&(this._active=!0);var g=jo(h,d),w=new y.Point(0,0),M=new y.Point(0,0),I=0;for(var O in g){var G=g[O],Q=this._touches[O];Q&&(w._add(G),M._add(G.sub(Q)),I++,g[O]=G)}if(this._touches=g,!(I<this._minTouches)&&M.mag()){var ge=M.div(I);if(this._sum._add(ge),!(this._sum.mag()<this._clickTolerance))return{around:w.div(I),panDelta:ge}}},ri.prototype.enable=function(){this._enabled=!0},ri.prototype.disable=function(){this._enabled=!1,this.reset()},ri.prototype.isEnabled=function(){return this._enabled},ri.prototype.isActive=function(){return this._active};var no=function(){this.reset()};function Ns(f,d,h){for(var g=0;g<f.length;g++)if(f[g].identifier===h)return d[g]}function Ps(f,d){return Math.log(f/d)/Math.LN2}no.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},no.prototype._start=function(f){},no.prototype._move=function(f,d,h){return{}},no.prototype.touchstart=function(f,d,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([d[0],d[1]]))},no.prototype.touchmove=function(f,d,h){if(this._firstTwoTouches){f.preventDefault();var g=this._firstTwoTouches,w=g[1],M=Ns(h,d,g[0]),I=Ns(h,d,w);if(M&&I){var O=this._aroundCenter?null:M.add(I).div(2);return this._move([M,I],O,f)}}},no.prototype.touchend=function(f,d,h){if(this._firstTwoTouches){var g=this._firstTwoTouches,w=g[1],M=Ns(h,d,g[0]),I=Ns(h,d,w);M&&I||(this._active&&X.suppressClick(),this.reset())}},no.prototype.touchcancel=function(){this.reset()},no.prototype.enable=function(f){this._enabled=!0,this._aroundCenter=!!f&&f.around==="center"},no.prototype.disable=function(){this._enabled=!1,this.reset()},no.prototype.isEnabled=function(){return this._enabled},no.prototype.isActive=function(){return this._active};var zs=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),delete this._distance,delete this._startDistance},d.prototype._start=function(h){this._startDistance=this._distance=h[0].dist(h[1])},d.prototype._move=function(h,g){var w=this._distance;if(this._distance=h[0].dist(h[1]),this._active||!(Math.abs(Ps(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ps(this._distance,w),pinchAround:g}},d}(no);function Su(f,d){return 180*f.angleWith(d)/Math.PI}var wf=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},d.prototype._start=function(h){this._startVector=this._vector=h[0].sub(h[1]),this._minDiameter=h[0].dist(h[1])},d.prototype._move=function(h,g){var w=this._vector;if(this._vector=h[0].sub(h[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Su(this._vector,w),pinchAround:g}},d.prototype._isBelowThreshold=function(h){this._minDiameter=Math.min(this._minDiameter,h.mag());var g=25/(Math.PI*this._minDiameter)*360,w=Su(h,this._startVector);return Math.abs(w)<g},d}(no);function Cf(f){return Math.abs(f.y)>Math.abs(f.x)}var Jf=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.reset=function(){f.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},d.prototype._start=function(h){this._lastPoints=h,Cf(h[0].sub(h[1]))&&(this._valid=!1)},d.prototype._move=function(h,g,w){var M=h[0].sub(this._lastPoints[0]),I=h[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(M,I,w.timeStamp),this._valid)return this._lastPoints=h,this._active=!0,{pitchDelta:(M.y+I.y)/2*-.5}},d.prototype.gestureBeginsVertically=function(h,g,w){if(this._valid!==void 0)return this._valid;var M=h.mag()>=2,I=g.mag()>=2;if(M||I){if(!M||!I)return this._firstMove===void 0&&(this._firstMove=w),w-this._firstMove<100&&void 0;var O=h.y>0==g.y>0;return Cf(h)&&Cf(g)&&O}},d}(no),Af={panStep:100,bearingStep:15,pitchStep:10},au=function(){var f=Af;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1};function ou(f){return f*(2-f)}au.prototype.blur=function(){this.reset()},au.prototype.reset=function(){this._active=!1},au.prototype.keydown=function(f){var d=this;if(!(f.altKey||f.ctrlKey||f.metaKey)){var h=0,g=0,w=0,M=0,I=0;switch(f.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:f.shiftKey?g=-1:(f.preventDefault(),M=-1);break;case 39:f.shiftKey?g=1:(f.preventDefault(),M=1);break;case 38:f.shiftKey?w=1:(f.preventDefault(),I=-1);break;case 40:f.shiftKey?w=-1:(f.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(g=0,w=0),{cameraAnimation:function(O){var G=O.getZoom();O.easeTo({duration:300,easeId:"keyboardHandler",easing:ou,zoom:h?Math.round(G)+h*(f.shiftKey?2:1):G,bearing:O.getBearing()+g*d._bearingStep,pitch:O.getPitch()+w*d._pitchStep,offset:[-M*d._panStep,-I*d._panStep],center:O.getCenter()},{originalEvent:f})}}}},au.prototype.enable=function(){this._enabled=!0},au.prototype.disable=function(){this._enabled=!1,this.reset()},au.prototype.isEnabled=function(){return this._enabled},au.prototype.isActive=function(){return this._active},au.prototype.disableRotation=function(){this._rotationDisabled=!0},au.prototype.enableRotation=function(){this._rotationDisabled=!1};var Vi=function(f,d){this._map=f,this._el=f.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,y.bindAll(["_onTimeout"],this)};Vi.prototype.setZoomRate=function(f){this._defaultZoomRate=f},Vi.prototype.setWheelZoomRate=function(f){this._wheelZoomRate=f},Vi.prototype.isEnabled=function(){return!!this._enabled},Vi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Vi.prototype.isZooming=function(){return!!this._zooming},Vi.prototype.enable=function(f){this.isEnabled()||(this._enabled=!0,this._aroundCenter=f&&f.around==="center")},Vi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Vi.prototype.wheel=function(f){if(this.isEnabled()){var d=f.deltaMode===y.window.WheelEvent.DOM_DELTA_LINE?40*f.deltaY:f.deltaY,h=y.browser.now(),g=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,d!==0&&d%4.000244140625==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,f)):this._type||(this._type=Math.abs(g*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),f.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=f,this._delta-=d,this._active||this._start(f)),f.preventDefault()}},Vi.prototype._onTimeout=function(f){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},Vi.prototype._start=function(f){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var d=X.mousePos(this._el,f);this._around=y.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Vi.prototype.renderFrame=function(){var f=this;if(this._frameId&&(this._frameId=null,this.isActive())){var d=this._map.transform;if(this._delta!==0){var h=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,g=2/(1+Math.exp(-Math.abs(this._delta*h)));this._delta<0&&g!==0&&(g=1/g);var w=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):d.scale;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(w*g))),this._type==="wheel"&&(this._startZoom=d.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var M,I=typeof this._targetZoom=="number"?this._targetZoom:d.zoom,O=this._startZoom,G=this._easing,Q=!1;if(this._type==="wheel"&&O&&G){var ge=Math.min((y.browser.now()-this._lastWheelEventTime)/200,1),xe=G(ge);M=y.number(O,I,xe),ge<1?this._frameId||(this._frameId=!0):Q=!0}else M=I,Q=!0;return this._active=!0,Q&&(this._active=!1,this._finishTimeout=setTimeout(function(){f._zooming=!1,f._handler._triggerRenderFrame(),delete f._targetZoom,delete f._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!Q,zoomDelta:M-d.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Vi.prototype._smoothOutEasing=function(f){var d=y.ease;if(this._prevEase){var h=this._prevEase,g=(y.browser.now()-h.start)/h.duration,w=h.easing(g+.01)-h.easing(g),M=.27/Math.sqrt(w*w+1e-4)*.01,I=Math.sqrt(.0729-M*M);d=y.bezier(M,I,.25,1)}return this._prevEase={start:y.browser.now(),duration:f,easing:d},d},Vi.prototype.blur=function(){this.reset()},Vi.prototype.reset=function(){this._active=!1};var Ra=function(f,d){this._clickZoom=f,this._tapZoom=d};Ra.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Ra.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Ra.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Ra.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var su=function(){this.reset()};su.prototype.reset=function(){this._active=!1},su.prototype.blur=function(){this.reset()},su.prototype.dblclick=function(f,d){return f.preventDefault(),{cameraAnimation:function(h){h.easeTo({duration:300,zoom:h.getZoom()+(f.shiftKey?-1:1),around:h.unproject(d)},{originalEvent:f})}}},su.prototype.enable=function(){this._enabled=!0},su.prototype.disable=function(){this._enabled=!1,this.reset()},su.prototype.isEnabled=function(){return this._enabled},su.prototype.isActive=function(){return this._active};var qo=function(){this._tap=new Xi({numTouches:1,numTaps:1}),this.reset()};qo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},qo.prototype.touchstart=function(f,d,h){this._swipePoint||(this._tapTime&&f.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=d[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(f,d,h))},qo.prototype.touchmove=function(f,d,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;var g=d[0],w=g.y-this._swipePoint.y;return this._swipePoint=g,f.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(f,d,h)},qo.prototype.touchend=function(f,d,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(f,d,h)&&(this._tapTime=f.timeStamp)},qo.prototype.touchcancel=function(){this.reset()},qo.prototype.enable=function(){this._enabled=!0},qo.prototype.disable=function(){this._enabled=!1,this.reset()},qo.prototype.isEnabled=function(){return this._enabled},qo.prototype.isActive=function(){return this._active};var Vl=function(f,d,h){this._el=f,this._mousePan=d,this._touchPan=h};Vl.prototype.enable=function(f){this._inertiaOptions=f||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Vl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Vl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Vl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var vl=function(f,d,h){this._pitchWithRotate=f.pitchWithRotate,this._mouseRotate=d,this._mousePitch=h};vl.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},vl.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},vl.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},vl.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var qs=function(f,d,h,g){this._el=f,this._touchZoom=d,this._touchRotate=h,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0};qs.prototype.enable=function(f){this._touchZoom.enable(f),this._rotationDisabled||this._touchRotate.enable(f),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},qs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},qs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},qs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},qs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},qs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var ps=function(f){return f.zoom||f.drag||f.pitch||f.rotate},Rs=function(f){function d(){f.apply(this,arguments)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d}(y.Event);function Qn(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}var Bn=function(f,d){this._map=f,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ef(f),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d),y.bindAll(["handleEvent","handleWindowEvent"],this);var h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[y.window.document,"mousemove",{capture:!0}],[y.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[y.window,"blur",void 0]];for(var g=0,w=this._listeners;g<w.length;g+=1){var M=w[g],I=M[0];X.addEventListener(I,M[1],I===y.window.document?this.handleWindowEvent:this.handleEvent,M[2])}};Bn.prototype.destroy=function(){for(var f=0,d=this._listeners;f<d.length;f+=1){var h=d[f],g=h[0];X.removeEventListener(g,h[1],g===y.window.document?this.handleWindowEvent:this.handleEvent,h[2])}},Bn.prototype._addDefaultHandlers=function(f){var d=this._map,h=d.getCanvasContainer();this._add("mapEvent",new Ro(d,f));var g=d.boxZoom=new mo(d,f);this._add("boxZoom",g);var w=new Bs,M=new su;d.doubleClickZoom=new Ra(M,w),this._add("tapZoom",w),this._add("clickZoom",M);var I=new qo;this._add("tapDragZoom",I);var O=d.touchPitch=new Jf;this._add("touchPitch",O);var G=new Sf(f),Q=new dl(f);d.dragRotate=new vl(f,G,Q),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",Q,["mouseRotate"]);var ge=new jc(f),xe=new ri(f);d.dragPan=new Vl(h,ge,xe),this._add("mousePan",ge),this._add("touchPan",xe,["touchZoom","touchRotate"]);var Ee=new wf,je=new zs;d.touchZoomRotate=new qs(h,je,Ee,I),this._add("touchRotate",Ee,["touchPan","touchZoom"]),this._add("touchZoom",je,["touchPan","touchRotate"]);var Ve=d.scrollZoom=new Vi(d,this);this._add("scrollZoom",Ve,["mousePan"]);var nt=d.keyboard=new au;this._add("keyboard",nt),this._add("blockableMapEvent",new Dn(d));for(var Fe=0,it=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Fe<it.length;Fe+=1){var yt=it[Fe];f.interactive&&f[yt]&&d[yt].enable(f[yt])}},Bn.prototype._add=function(f,d,h){this._handlers.push({handlerName:f,handler:d,allowed:h}),this._handlersById[f]=d},Bn.prototype.stop=function(f){if(!this._updatingCamera){for(var d=0,h=this._handlers;d<h.length;d+=1)h[d].handler.reset();this._inertia.clear(),this._fireEvents({},{},f),this._changes=[]}},Bn.prototype.isActive=function(){for(var f=0,d=this._handlers;f<d.length;f+=1)if(d[f].handler.isActive())return!0;return!1},Bn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Bn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Bn.prototype.isMoving=function(){return Boolean(ps(this._eventsInProgress))||this.isZooming()},Bn.prototype._blockedByActive=function(f,d,h){for(var g in f)if(g!==h&&(!d||d.indexOf(g)<0))return!0;return!1},Bn.prototype.handleWindowEvent=function(f){this.handleEvent(f,f.type+"Window")},Bn.prototype._getMapTouches=function(f){for(var d=[],h=0,g=f;h<g.length;h+=1){var w=g[h];this._el.contains(w.target)&&d.push(w)}return d},Bn.prototype.handleEvent=function(f,d){this._updatingCamera=!0;for(var h=f.type==="renderFrame"?void 0:f,g={needsRenderFrame:!1},w={},M={},I=f.touches?this._getMapTouches(f.touches):void 0,O=I?X.touchPos(this._el,I):X.mousePos(this._el,f),G=0,Q=this._handlers;G<Q.length;G+=1){var ge=Q[G],xe=ge.handlerName,Ee=ge.handler,je=ge.allowed;if(Ee.isEnabled()){var Ve=void 0;this._blockedByActive(M,je,xe)?Ee.reset():Ee[d||f.type]&&(Ve=Ee[d||f.type](f,O,I),this.mergeHandlerResult(g,w,Ve,xe,h),Ve&&Ve.needsRenderFrame&&this._triggerRenderFrame()),(Ve||Ee.isActive())&&(M[xe]=Ee)}}var nt={};for(var Fe in this._previousActiveHandlers)M[Fe]||(nt[Fe]=h);this._previousActiveHandlers=M,(Object.keys(nt).length||Qn(g))&&(this._changes.push([g,w,nt]),this._triggerRenderFrame()),(Object.keys(M).length||Qn(g))&&this._map._stop(!0),this._updatingCamera=!1;var it=g.cameraAnimation;it&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],it(this._map))},Bn.prototype.mergeHandlerResult=function(f,d,h,g,w){if(h){y.extend(f,h);var M={handlerName:g,originalEvent:h.originalEvent||w};h.zoomDelta!==void 0&&(d.zoom=M),h.panDelta!==void 0&&(d.drag=M),h.pitchDelta!==void 0&&(d.pitch=M),h.bearingDelta!==void 0&&(d.rotate=M)}},Bn.prototype._applyChanges=function(){for(var f={},d={},h={},g=0,w=this._changes;g<w.length;g+=1){var M=w[g],I=M[0],O=M[1],G=M[2];I.panDelta&&(f.panDelta=(f.panDelta||new y.Point(0,0))._add(I.panDelta)),I.zoomDelta&&(f.zoomDelta=(f.zoomDelta||0)+I.zoomDelta),I.bearingDelta&&(f.bearingDelta=(f.bearingDelta||0)+I.bearingDelta),I.pitchDelta&&(f.pitchDelta=(f.pitchDelta||0)+I.pitchDelta),I.around!==void 0&&(f.around=I.around),I.pinchAround!==void 0&&(f.pinchAround=I.pinchAround),I.noInertia&&(f.noInertia=I.noInertia),y.extend(d,O),y.extend(h,G)}this._updateMapTransform(f,d,h),this._changes=[]},Bn.prototype._updateMapTransform=function(f,d,h){var g=this._map,w=g.transform;if(!Qn(f))return this._fireEvents(d,h,!0);var M=f.panDelta,I=f.zoomDelta,O=f.bearingDelta,G=f.pitchDelta,Q=f.around,ge=f.pinchAround;ge!==void 0&&(Q=ge),g._stop(!0),Q=Q||g.transform.centerPoint;var xe=w.pointLocation(M?Q.sub(M):Q);O&&(w.bearing+=O),G&&(w.pitch+=G),I&&(w.zoom+=I),w.setLocationAtPoint(xe,Q),this._map._update(),f.noInertia||this._inertia.record(f),this._fireEvents(d,h,!0)},Bn.prototype._fireEvents=function(f,d,h){var g=this,w=ps(this._eventsInProgress),M=ps(f),I={};for(var O in f)this._eventsInProgress[O]||(I[O+"start"]=f[O].originalEvent),this._eventsInProgress[O]=f[O];for(var G in!w&&M&&this._fireEvent("movestart",M.originalEvent),I)this._fireEvent(G,I[G]);for(var Q in M&&this._fireEvent("move",M.originalEvent),f)this._fireEvent(Q,f[Q].originalEvent);var ge,xe={};for(var Ee in this._eventsInProgress){var je=this._eventsInProgress[Ee],Ve=je.handlerName,nt=je.originalEvent;this._handlersById[Ve].isActive()||(delete this._eventsInProgress[Ee],xe[Ee+"end"]=ge=d[Ve]||nt)}for(var Fe in xe)this._fireEvent(Fe,xe[Fe]);var it=ps(this._eventsInProgress);if(h&&(w||M)&&!it){this._updatingCamera=!0;var yt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Bt=function(fr){return fr!==0&&-g._bearingSnap<fr&&fr<g._bearingSnap};yt?(Bt(yt.bearing||this._map.getBearing())&&(yt.bearing=0),this._map.easeTo(yt,{originalEvent:ge})):(this._map.fire(new y.Event("moveend",{originalEvent:ge})),Bt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Bn.prototype._fireEvent=function(f,d){this._map.fire(new y.Event(f,d?{originalEvent:d}:{}))},Bn.prototype._requestFrame=function(){var f=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(d){delete f._frameId,f.handleEvent(new Rs("renderFrame",{timeStamp:d})),f._applyChanges()})},Bn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Gc=function(f){function d(h,g){f.call(this),this._moving=!1,this._zooming=!1,this.transform=h,this._bearingSnap=g.bearingSnap,y.bindAll(["_renderFrameCallback"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.getCenter=function(){return new y.LngLat(this.transform.center.lng,this.transform.center.lat)},d.prototype.setCenter=function(h,g){return this.jumpTo({center:h},g)},d.prototype.panBy=function(h,g,w){return h=y.Point.convert(h).mult(-1),this.panTo(this.transform.center,y.extend({offset:h},g),w)},d.prototype.panTo=function(h,g,w){return this.easeTo(y.extend({center:h},g),w)},d.prototype.getZoom=function(){return this.transform.zoom},d.prototype.setZoom=function(h,g){return this.jumpTo({zoom:h},g),this},d.prototype.zoomTo=function(h,g,w){return this.easeTo(y.extend({zoom:h},g),w)},d.prototype.zoomIn=function(h,g){return this.zoomTo(this.getZoom()+1,h,g),this},d.prototype.zoomOut=function(h,g){return this.zoomTo(this.getZoom()-1,h,g),this},d.prototype.getBearing=function(){return this.transform.bearing},d.prototype.setBearing=function(h,g){return this.jumpTo({bearing:h},g),this},d.prototype.getPadding=function(){return this.transform.padding},d.prototype.setPadding=function(h,g){return this.jumpTo({padding:h},g),this},d.prototype.rotateTo=function(h,g,w){return this.easeTo(y.extend({bearing:h},g),w)},d.prototype.resetNorth=function(h,g){return this.rotateTo(0,y.extend({duration:1e3},h),g),this},d.prototype.resetNorthPitch=function(h,g){return this.easeTo(y.extend({bearing:0,pitch:0,duration:1e3},h),g),this},d.prototype.snapToNorth=function(h,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(h,g):this},d.prototype.getPitch=function(){return this.transform.pitch},d.prototype.setPitch=function(h,g){return this.jumpTo({pitch:h},g),this},d.prototype.cameraForBounds=function(h,g){h=y.LngLatBounds.convert(h);var w=g&&g.bearing||0;return this._cameraForBoxAndBearing(h.getNorthWest(),h.getSouthEast(),w,g)},d.prototype._cameraForBoxAndBearing=function(h,g,w,M){var I={top:0,bottom:0,right:0,left:0};if(typeof(M=y.extend({padding:I,offset:[0,0],maxZoom:this.transform.maxZoom},M)).padding=="number"){var O=M.padding;M.padding={top:O,bottom:O,right:O,left:O}}M.padding=y.extend(I,M.padding);var G=this.transform,Q=G.padding,ge=G.project(y.LngLat.convert(h)),xe=G.project(y.LngLat.convert(g)),Ee=ge.rotate(-w*Math.PI/180),je=xe.rotate(-w*Math.PI/180),Ve=new y.Point(Math.max(Ee.x,je.x),Math.max(Ee.y,je.y)),nt=new y.Point(Math.min(Ee.x,je.x),Math.min(Ee.y,je.y)),Fe=Ve.sub(nt),it=(G.width-(Q.left+Q.right+M.padding.left+M.padding.right))/Fe.x,yt=(G.height-(Q.top+Q.bottom+M.padding.top+M.padding.bottom))/Fe.y;if(!(yt<0||it<0)){var Bt=Math.min(G.scaleZoom(G.scale*Math.min(it,yt)),M.maxZoom),fr=typeof M.offset.x=="number"?new y.Point(M.offset.x,M.offset.y):y.Point.convert(M.offset),ir=new y.Point((M.padding.left-M.padding.right)/2,(M.padding.top-M.padding.bottom)/2).rotate(w*Math.PI/180),mr=fr.add(ir).mult(G.scale/G.zoomScale(Bt));return{center:G.unproject(ge.add(xe).div(2).sub(mr)),zoom:Bt,bearing:w}}y.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},d.prototype.fitBounds=function(h,g,w){return this._fitInternal(this.cameraForBounds(h,g),g,w)},d.prototype.fitScreenCoordinates=function(h,g,w,M,I){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(y.Point.convert(h)),this.transform.pointLocation(y.Point.convert(g)),w,M),M,I)},d.prototype._fitInternal=function(h,g,w){return h?(delete(g=y.extend(h,g)).padding,g.linear?this.easeTo(g,w):this.flyTo(g,w)):this},d.prototype.jumpTo=function(h,g){this.stop();var w=this.transform,M=!1,I=!1,O=!1;return"zoom"in h&&w.zoom!==+h.zoom&&(M=!0,w.zoom=+h.zoom),h.center!==void 0&&(w.center=y.LngLat.convert(h.center)),"bearing"in h&&w.bearing!==+h.bearing&&(I=!0,w.bearing=+h.bearing),"pitch"in h&&w.pitch!==+h.pitch&&(O=!0,w.pitch=+h.pitch),h.padding==null||w.isPaddingEqual(h.padding)||(w.padding=h.padding),this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),M&&this.fire(new y.Event("zoomstart",g)).fire(new y.Event("zoom",g)).fire(new y.Event("zoomend",g)),I&&this.fire(new y.Event("rotatestart",g)).fire(new y.Event("rotate",g)).fire(new y.Event("rotateend",g)),O&&this.fire(new y.Event("pitchstart",g)).fire(new y.Event("pitch",g)).fire(new y.Event("pitchend",g)),this.fire(new y.Event("moveend",g))},d.prototype.easeTo=function(h,g){var w=this;this._stop(!1,h.easeId),((h=y.extend({offset:[0,0],duration:500,easing:y.ease},h)).animate===!1||!h.essential&&y.browser.prefersReducedMotion)&&(h.duration=0);var M=this.transform,I=this.getZoom(),O=this.getBearing(),G=this.getPitch(),Q=this.getPadding(),ge="zoom"in h?+h.zoom:I,xe="bearing"in h?this._normalizeBearing(h.bearing,O):O,Ee="pitch"in h?+h.pitch:G,je="padding"in h?h.padding:M.padding,Ve=y.Point.convert(h.offset),nt=M.centerPoint.add(Ve),Fe=M.pointLocation(nt),it=y.LngLat.convert(h.center||Fe);this._normalizeCenter(it);var yt,Bt,fr=M.project(Fe),ir=M.project(it).sub(fr),mr=M.zoomScale(ge-I);h.around&&(yt=y.LngLat.convert(h.around),Bt=M.locationPoint(yt));var Or={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ge!==I,this._rotating=this._rotating||O!==xe,this._pitching=this._pitching||Ee!==G,this._padding=!M.isPaddingEqual(je),this._easeId=h.easeId,this._prepareEase(g,h.noMoveStart,Or),this._ease(function(on){if(w._zooming&&(M.zoom=y.number(I,ge,on)),w._rotating&&(M.bearing=y.number(O,xe,on)),w._pitching&&(M.pitch=y.number(G,Ee,on)),w._padding&&(M.interpolatePadding(Q,je,on),nt=M.centerPoint.add(Ve)),yt)M.setLocationAtPoint(yt,Bt);else{var jr=M.zoomScale(M.zoom-I),Cn=ge>I?Math.min(2,mr):Math.max(.5,mr),ni=Math.pow(Cn,1-on),ii=M.unproject(fr.add(ir.mult(on*ni)).mult(jr));M.setLocationAtPoint(M.renderWorldCopies?ii.wrap():ii,nt)}w._fireMoveEvents(g)},function(on){w._afterEase(g,on)},h),this},d.prototype._prepareEase=function(h,g,w){w===void 0&&(w={}),this._moving=!0,g||w.moving||this.fire(new y.Event("movestart",h)),this._zooming&&!w.zooming&&this.fire(new y.Event("zoomstart",h)),this._rotating&&!w.rotating&&this.fire(new y.Event("rotatestart",h)),this._pitching&&!w.pitching&&this.fire(new y.Event("pitchstart",h))},d.prototype._fireMoveEvents=function(h){this.fire(new y.Event("move",h)),this._zooming&&this.fire(new y.Event("zoom",h)),this._rotating&&this.fire(new y.Event("rotate",h)),this._pitching&&this.fire(new y.Event("pitch",h))},d.prototype._afterEase=function(h,g){if(!this._easeId||!g||this._easeId!==g){delete this._easeId;var w=this._zooming,M=this._rotating,I=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,w&&this.fire(new y.Event("zoomend",h)),M&&this.fire(new y.Event("rotateend",h)),I&&this.fire(new y.Event("pitchend",h)),this.fire(new y.Event("moveend",h))}},d.prototype.flyTo=function(h,g){var w=this;if(!h.essential&&y.browser.prefersReducedMotion){var M=y.pick(h,["center","zoom","bearing","pitch","around"]);return this.jumpTo(M,g)}this.stop(),h=y.extend({offset:[0,0],speed:1.2,curve:1.42,easing:y.ease},h);var I=this.transform,O=this.getZoom(),G=this.getBearing(),Q=this.getPitch(),ge=this.getPadding(),xe="zoom"in h?y.clamp(+h.zoom,I.minZoom,I.maxZoom):O,Ee="bearing"in h?this._normalizeBearing(h.bearing,G):G,je="pitch"in h?+h.pitch:Q,Ve="padding"in h?h.padding:I.padding,nt=I.zoomScale(xe-O),Fe=y.Point.convert(h.offset),it=I.centerPoint.add(Fe),yt=I.pointLocation(it),Bt=y.LngLat.convert(h.center||yt);this._normalizeCenter(Bt);var fr=I.project(yt),ir=I.project(Bt).sub(fr),mr=h.curve,Or=Math.max(I.width,I.height),on=Or/nt,jr=ir.mag();if("minZoom"in h){var Cn=y.clamp(Math.min(h.minZoom,O,xe),I.minZoom,I.maxZoom),ni=Or/I.zoomScale(Cn-O);mr=Math.sqrt(ni/jr*2)}var ii=mr*mr;function oi(di){var fi=(on*on-Or*Or+(di?-1:1)*ii*ii*jr*jr)/(2*(di?on:Or)*ii*jr);return Math.log(Math.sqrt(fi*fi+1)-fi)}function ta(di){return(Math.exp(di)-Math.exp(-di))/2}function An(di){return(Math.exp(di)+Math.exp(-di))/2}var Ci=oi(0),En=function(di){return An(Ci)/An(Ci+mr*di)},li=function(di){return Or*((An(Ci)*(ta(fi=Ci+mr*di)/An(fi))-ta(Ci))/ii)/jr;var fi},Jn=(oi(1)-Ci)/mr;if(Math.abs(jr)<1e-6||!isFinite(Jn)){if(Math.abs(Or-on)<1e-6)return this.easeTo(h,g);var Ti=on<Or?-1:1;Jn=Math.abs(Math.log(on/Or))/mr,li=function(){return 0},En=function(di){return Math.exp(Ti*mr*di)}}return h.duration="duration"in h?+h.duration:1e3*Jn/("screenSpeed"in h?+h.screenSpeed/mr:+h.speed),h.maxDuration&&h.duration>h.maxDuration&&(h.duration=0),this._zooming=!0,this._rotating=G!==Ee,this._pitching=je!==Q,this._padding=!I.isPaddingEqual(Ve),this._prepareEase(g,!1),this._ease(function(di){var fi=di*Jn,Lo=1/En(fi);I.zoom=di===1?xe:O+I.scaleZoom(Lo),w._rotating&&(I.bearing=y.number(G,Ee,di)),w._pitching&&(I.pitch=y.number(Q,je,di)),w._padding&&(I.interpolatePadding(ge,Ve,di),it=I.centerPoint.add(Fe));var co=di===1?Bt:I.unproject(fr.add(ir.mult(li(fi))).mult(Lo));I.setLocationAtPoint(I.renderWorldCopies?co.wrap():co,it),w._fireMoveEvents(g)},function(){return w._afterEase(g)},h),this},d.prototype.isEasing=function(){return!!this._easeFrameId},d.prototype.stop=function(){return this._stop()},d.prototype._stop=function(h,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var w=this._onEaseEnd;delete this._onEaseEnd,w.call(this,g)}if(!h){var M=this.handlers;M&&M.stop(!1)}return this},d.prototype._ease=function(h,g,w){w.animate===!1||w.duration===0?(h(1),g()):(this._easeStart=y.browser.now(),this._easeOptions=w,this._onEaseFrame=h,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},d.prototype._renderFrameCallback=function(){var h=Math.min((y.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},d.prototype._normalizeBearing=function(h,g){h=y.wrap(h,-180,180);var w=Math.abs(h-g);return Math.abs(h-360-g)<w&&(h-=360),Math.abs(h+360-g)<w&&(h+=360),h},d.prototype._normalizeCenter=function(h){var g=this.transform;if(g.renderWorldCopies&&!g.lngRange){var w=h.lng-g.center.lng;h.lng+=w>180?-360:w<-180?360:0}},d}(y.Evented),Es=function(f){f===void 0&&(f={}),this.options=f,y.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Es.prototype.getDefaultPosition=function(){return"bottom-right"},Es.prototype.onAdd=function(f){var d=this.options&&this.options.compact;return this._map=f,this._container=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=X.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=X.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Es.prototype.onRemove=function(){X.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Es.prototype._setElementTitle=function(f,d){var h=this._map._getUIString("AttributionControl."+d);f.title=h,f.setAttribute("aria-label",h)},Es.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Es.prototype._updateEditLink=function(){var f=this._editLink;f||(f=this._editLink=this._container.querySelector(".mapbox-improve-map"));var d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||y.config.ACCESS_TOKEN}];if(f){var h=d.reduce(function(g,w,M){return w.value&&(g+=w.key+"="+w.value+(M<d.length-1?"&":"")),g},"?");f.href=y.config.FEEDBACK_URL+"/"+h+(this._map._hash?this._map._hash.getHashString(!0):""),f.rel="noopener nofollow",this._setElementTitle(f,"MapFeedback")}},Es.prototype._updateData=function(f){!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},Es.prototype._updateAttributions=function(){if(this._map.style){var f=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?f=f.concat(this.options.customAttribution.map(function(O){return typeof O!="string"?"":O})):typeof this.options.customAttribution=="string"&&f.push(this.options.customAttribution)),this._map.style.stylesheet){var d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}var h=this._map.style.sourceCaches;for(var g in h){var w=h[g];if(w.used){var M=w.getSource();M.attribution&&f.indexOf(M.attribution)<0&&f.push(M.attribution)}}f.sort(function(O,G){return O.length-G.length});var I=(f=f.filter(function(O,G){for(var Q=G+1;Q<f.length;Q++)if(f[Q].indexOf(O)>=0)return!1;return!0})).join(" | ");I!==this._attribHTML&&(this._attribHTML=I,f.length?(this._innerContainer.innerHTML=I,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Es.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var uu=function(){y.bindAll(["_updateLogo"],this),y.bindAll(["_updateCompact"],this)};uu.prototype.onAdd=function(f){this._map=f,this._container=X.create("div","mapboxgl-ctrl");var d=X.create("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},uu.prototype.onRemove=function(){X.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},uu.prototype.getDefaultPosition=function(){return"bottom-left"},uu.prototype._updateLogo=function(f){f&&f.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},uu.prototype._logoRequired=function(){if(this._map.style){var f=this._map.style.sourceCaches;for(var d in f)if(f[d].getSource().mapbox_logo)return!0;return!1}},uu.prototype._updateCompact=function(){var f=this._container.children;if(f.length){var d=f[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}};var is=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};is.prototype.add=function(f){var d=++this._id;return this._queue.push({callback:f,id:d,cancelled:!1}),d},is.prototype.remove=function(f){for(var d=this._currentlyRunning,h=0,g=d?this._queue.concat(d):this._queue;h<g.length;h+=1){var w=g[h];if(w.id===f)return void(w.cancelled=!0)}},is.prototype.run=function(f){f===void 0&&(f=0);var d=this._currentlyRunning=this._queue;this._queue=[];for(var h=0,g=d;h<g.length;h+=1){var w=g[h];if(!w.cancelled&&(w.callback(f),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},is.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var wu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},mc=y.window.HTMLImageElement,jl=y.window.HTMLElement,wa=y.window.ImageBitmap,Ga={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},eh=function(f){function d(g){var w=this;if((g=y.extend({},Ga,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var M=new aa(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies);if(f.call(this,M,g),this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new is,this._controls=[],this._mapId=y.uniqueId(),this._locale=y.extend({},wu,g.locale),this._clickTolerance=g.clickTolerance,this._requestManager=new y.RequestManager(g.transformRequest,g.accessToken),typeof g.container=="string"){if(this._container=y.window.document.getElementById(g.container),!this._container)throw new Error("Container '"+g.container+"' not found.")}else{if(!(g.container instanceof jl))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),y.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return w._update(!1)}),this.on("moveend",function(){return w._update(!1)}),this.on("zoom",function(){return w._update(!0)}),y.window!==void 0&&(y.window.addEventListener("online",this._onWindowOnline,!1),y.window.addEventListener("resize",this._onWindowResize,!1),y.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Bn(this,g),this._hash=g.hash&&new bs(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,y.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new Es({customAttribution:g.customAttribution})),this.addControl(new uu,g.logoPosition),this.on("style.load",function(){w.transform.unmodified&&w.jumpTo(w.style.stylesheet)}),this.on("data",function(I){w._update(I.dataType==="style"),w.fire(new y.Event(I.dataType+"data",I))}),this.on("dataloading",function(I){w.fire(new y.Event(I.dataType+"dataloading",I))})}f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d;var h={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return d.prototype._getMapId=function(){return this._mapId},d.prototype.addControl=function(g,w){if(w===void 0&&(w=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var M=g.onAdd(this);this._controls.push(g);var I=this._controlPositions[w];return w.indexOf("bottom")!==-1?I.insertBefore(M,I.firstChild):I.appendChild(M),this},d.prototype.removeControl=function(g){if(!g||!g.onRemove)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var w=this._controls.indexOf(g);return w>-1&&this._controls.splice(w,1),g.onRemove(this),this},d.prototype.hasControl=function(g){return this._controls.indexOf(g)>-1},d.prototype.resize=function(g){var w=this._containerDimensions(),M=w[0],I=w[1];if(M===this.transform.width&&I===this.transform.height)return this;this._resizeCanvas(M,I),this.transform.resize(M,I),this.painter.resize(M,I);var O=!this._moving;return O&&this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),this.fire(new y.Event("resize",g)),O&&this.fire(new y.Event("moveend",g)),this},d.prototype.getBounds=function(){return this.transform.getBounds()},d.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},d.prototype.setMaxBounds=function(g){return this.transform.setMaxBounds(y.LngLatBounds.convert(g)),this._update()},d.prototype.setMinZoom=function(g){if((g=g==null?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},d.prototype.getMinZoom=function(){return this.transform.minZoom},d.prototype.setMaxZoom=function(g){if((g=g==null?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")},d.prototype.getMaxZoom=function(){return this.transform.maxZoom},d.prototype.setMinPitch=function(g){if((g=g==null?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},d.prototype.getMinPitch=function(){return this.transform.minPitch},d.prototype.setMaxPitch=function(g){if((g=g==null?60:g)>60)throw new Error("maxPitch must be less than or equal to 60");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")},d.prototype.getMaxPitch=function(){return this.transform.maxPitch},d.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},d.prototype.setRenderWorldCopies=function(g){return this.transform.renderWorldCopies=g,this._update()},d.prototype.project=function(g){return this.transform.locationPoint(y.LngLat.convert(g))},d.prototype.unproject=function(g){return this.transform.pointLocation(y.Point.convert(g))},d.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},d.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},d.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},d.prototype._createDelegatedListener=function(g,w,M){var I,O=this;if(g==="mouseenter"||g==="mouseover"){var G=!1;return{layer:w,listener:M,delegates:{mousemove:function(ge){var xe=O.getLayer(w)?O.queryRenderedFeatures(ge.point,{layers:[w]}):[];xe.length?G||(G=!0,M.call(O,new Yo(g,O,ge.originalEvent,{features:xe}))):G=!1},mouseout:function(){G=!1}}}}if(g==="mouseleave"||g==="mouseout"){var Q=!1;return{layer:w,listener:M,delegates:{mousemove:function(ge){(O.getLayer(w)?O.queryRenderedFeatures(ge.point,{layers:[w]}):[]).length?Q=!0:Q&&(Q=!1,M.call(O,new Yo(g,O,ge.originalEvent)))},mouseout:function(ge){Q&&(Q=!1,M.call(O,new Yo(g,O,ge.originalEvent)))}}}}return{layer:w,listener:M,delegates:(I={},I[g]=function(ge){var xe=O.getLayer(w)?O.queryRenderedFeatures(ge.point,{layers:[w]}):[];xe.length&&(ge.features=xe,M.call(O,ge),delete ge.features)},I)}},d.prototype.on=function(g,w,M){if(M===void 0)return f.prototype.on.call(this,g,w);var I=this._createDelegatedListener(g,w,M);for(var O in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(I),I.delegates)this.on(O,I.delegates[O]);return this},d.prototype.once=function(g,w,M){if(M===void 0)return f.prototype.once.call(this,g,w);var I=this._createDelegatedListener(g,w,M);for(var O in I.delegates)this.once(O,I.delegates[O]);return this},d.prototype.off=function(g,w,M){var I=this;return M===void 0?f.prototype.off.call(this,g,w):(this._delegatedListeners&&this._delegatedListeners[g]&&function(O){for(var G=O[g],Q=0;Q<G.length;Q++){var ge=G[Q];if(ge.layer===w&&ge.listener===M){for(var xe in ge.delegates)I.off(xe,ge.delegates[xe]);return G.splice(Q,1),I}}}(this._delegatedListeners),this)},d.prototype.queryRenderedFeatures=function(g,w){if(!this.style)return[];var M;if(w!==void 0||g===void 0||g instanceof y.Point||Array.isArray(g)||(w=g,g=void 0),w=w||{},(g=g||[[0,0],[this.transform.width,this.transform.height]])instanceof y.Point||typeof g[0]=="number")M=[y.Point.convert(g)];else{var I=y.Point.convert(g[0]),O=y.Point.convert(g[1]);M=[I,new y.Point(O.x,I.y),O,new y.Point(I.x,O.y),I]}return this.style.queryRenderedFeatures(M,w,this.transform)},d.prototype.querySourceFeatures=function(g,w){return this.style.querySourceFeatures(g,w)},d.prototype.setStyle=function(g,w){return(w=y.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},w)).diff!==!1&&w.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,w),this):(this._localIdeographFontFamily=w.localIdeographFontFamily,this._updateStyle(g,w))},d.prototype._getUIString=function(g){var w=this._locale[g];if(w==null)throw new Error("Missing UI string '"+g+"'");return w},d.prototype._updateStyle=function(g,w){return this.style&&(this.style.setEventedParent(null),this.style._remove()),g?(this.style=new _s(this,w||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g),this):(delete this.style,this)},d.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new _s(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},d.prototype._diffStyle=function(g,w){var M=this;if(typeof g=="string"){var I=this._requestManager.normalizeStyleURL(g),O=this._requestManager.transformRequest(I,y.ResourceType.Style);y.getJSON(O,function(G,Q){G?M.fire(new y.ErrorEvent(G)):Q&&M._updateDiff(Q,w)})}else typeof g=="object"&&this._updateDiff(g,w)},d.prototype._updateDiff=function(g,w){try{this.style.setState(g)&&this._update(!0)}catch(M){y.warnOnce("Unable to perform style diff: "+(M.message||M.error||M)+".  Rebuilding the style from scratch."),this._updateStyle(g,w)}},d.prototype.getStyle=function(){if(this.style)return this.style.serialize()},d.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():y.warnOnce("There is no style added to the map.")},d.prototype.addSource=function(g,w){return this._lazyInitEmptyStyle(),this.style.addSource(g,w),this._update(!0)},d.prototype.isSourceLoaded=function(g){var w=this.style&&this.style.sourceCaches[g];if(w!==void 0)return w.loaded();this.fire(new y.ErrorEvent(new Error("There is no source with ID '"+g+"'")))},d.prototype.areTilesLoaded=function(){var g=this.style&&this.style.sourceCaches;for(var w in g){var M=g[w]._tiles;for(var I in M){var O=M[I];if(O.state!=="loaded"&&O.state!=="errored")return!1}}return!0},d.prototype.addSourceType=function(g,w,M){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,w,M)},d.prototype.removeSource=function(g){return this.style.removeSource(g),this._update(!0)},d.prototype.getSource=function(g){return this.style.getSource(g)},d.prototype.addImage=function(g,w,M){M===void 0&&(M={});var I=M.pixelRatio;I===void 0&&(I=1);var O=M.sdf;O===void 0&&(O=!1);var G=M.stretchX,Q=M.stretchY,ge=M.content;if(this._lazyInitEmptyStyle(),w instanceof mc||wa&&w instanceof wa){var xe=y.browser.getImageData(w);this.style.addImage(g,{data:new y.RGBAImage({width:xe.width,height:xe.height},xe.data),pixelRatio:I,stretchX:G,stretchY:Q,content:ge,sdf:O,version:0})}else{if(w.width===void 0||w.height===void 0)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Ee=w;this.style.addImage(g,{data:new y.RGBAImage({width:w.width,height:w.height},new Uint8Array(w.data)),pixelRatio:I,stretchX:G,stretchY:Q,content:ge,sdf:O,version:0,userImage:Ee}),Ee.onAdd&&Ee.onAdd(this,g)}},d.prototype.updateImage=function(g,w){var M=this.style.getImage(g);if(!M)return this.fire(new y.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var I=w instanceof mc||wa&&w instanceof wa?y.browser.getImageData(w):w,O=I.width,G=I.height,Q=I.data;return O===void 0||G===void 0?this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):O!==M.data.width||G!==M.data.height?this.fire(new y.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(M.data.replace(Q,!(w instanceof mc||wa&&w instanceof wa)),void this.style.updateImage(g,M))},d.prototype.hasImage=function(g){return g?!!this.style.getImage(g):(this.fire(new y.ErrorEvent(new Error("Missing required image id"))),!1)},d.prototype.removeImage=function(g){this.style.removeImage(g)},d.prototype.loadImage=function(g,w){y.getImage(this._requestManager.transformRequest(g,y.ResourceType.Image),w)},d.prototype.listImages=function(){return this.style.listImages()},d.prototype.addLayer=function(g,w){return this._lazyInitEmptyStyle(),this.style.addLayer(g,w),this._update(!0)},d.prototype.moveLayer=function(g,w){return this.style.moveLayer(g,w),this._update(!0)},d.prototype.removeLayer=function(g){return this.style.removeLayer(g),this._update(!0)},d.prototype.getLayer=function(g){return this.style.getLayer(g)},d.prototype.setLayerZoomRange=function(g,w,M){return this.style.setLayerZoomRange(g,w,M),this._update(!0)},d.prototype.setFilter=function(g,w,M){return M===void 0&&(M={}),this.style.setFilter(g,w,M),this._update(!0)},d.prototype.getFilter=function(g){return this.style.getFilter(g)},d.prototype.setPaintProperty=function(g,w,M,I){return I===void 0&&(I={}),this.style.setPaintProperty(g,w,M,I),this._update(!0)},d.prototype.getPaintProperty=function(g,w){return this.style.getPaintProperty(g,w)},d.prototype.setLayoutProperty=function(g,w,M,I){return I===void 0&&(I={}),this.style.setLayoutProperty(g,w,M,I),this._update(!0)},d.prototype.getLayoutProperty=function(g,w){return this.style.getLayoutProperty(g,w)},d.prototype.setLight=function(g,w){return w===void 0&&(w={}),this._lazyInitEmptyStyle(),this.style.setLight(g,w),this._update(!0)},d.prototype.getLight=function(){return this.style.getLight()},d.prototype.setFeatureState=function(g,w){return this.style.setFeatureState(g,w),this._update()},d.prototype.removeFeatureState=function(g,w){return this.style.removeFeatureState(g,w),this._update()},d.prototype.getFeatureState=function(g){return this.style.getFeatureState(g)},d.prototype.getContainer=function(){return this._container},d.prototype.getCanvasContainer=function(){return this._canvasContainer},d.prototype.getCanvas=function(){return this._canvas},d.prototype._containerDimensions=function(){var g=0,w=0;return this._container&&(g=this._container.clientWidth||400,w=this._container.clientHeight||300),[g,w]},d.prototype._detectMissingCSS=function(){y.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&y.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},d.prototype._setupContainer=function(){var g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=X.create("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();var w=this._canvasContainer=X.create("div","mapboxgl-canvas-container",g);this._interactive&&w.classList.add("mapboxgl-interactive"),this._canvas=X.create("canvas","mapboxgl-canvas",w),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var M=this._containerDimensions();this._resizeCanvas(M[0],M[1]);var I=this._controlContainer=X.create("div","mapboxgl-control-container",g),O=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(G){O[G]=X.create("div","mapboxgl-ctrl-"+G,I)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},d.prototype._resizeCanvas=function(g,w){var M=y.browser.devicePixelRatio||1;this._canvas.width=M*g,this._canvas.height=M*w,this._canvas.style.width=g+"px",this._canvas.style.height=w+"px"},d.prototype._setupPainter=function(){var g=y.extend({},Ie.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),w=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);w?(this.painter=new ro(w,this.transform),y.webpSupported.testSupport(w)):this.fire(new y.ErrorEvent(new Error("Failed to initialize WebGL")))},d.prototype._contextLost=function(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new y.Event("webglcontextlost",{originalEvent:g}))},d.prototype._contextRestored=function(g){this._setupPainter(),this.resize(),this._update(),this.fire(new y.Event("webglcontextrestored",{originalEvent:g}))},d.prototype._onMapScroll=function(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},d.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},d.prototype._update=function(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this},d.prototype._requestRenderFrame=function(g){return this._update(),this._renderTaskQueue.add(g)},d.prototype._cancelRenderFrame=function(g){this._renderTaskQueue.remove(g)},d.prototype._render=function(g){var w,M=this,I=0,O=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(w=O.createQueryEXT(),O.beginQueryEXT(O.TIME_ELAPSED_EXT,w),I=y.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),!this._removed){var G=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var Q=this.transform.zoom,ge=y.browser.now();this.style.zoomHistory.update(Q,ge);var xe=new y.EvaluationParameters(Q,{now:ge,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Ee=xe.crossFadingFactor();Ee===1&&Ee===this._crossFadingFactor||(G=!0,this._crossFadingFactor=Ee),this.style.update(xe)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new y.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new y.Event("load"))),this.style&&(this.style.hasTransitions()||G)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var je=y.browser.now()-I;O.endQueryEXT(O.TIME_ELAPSED_EXT,w),setTimeout(function(){var Fe=O.getQueryObjectEXT(w,O.QUERY_RESULT_EXT)/1e6;O.deleteQueryEXT(w),M.fire(new y.Event("gpu-timing-frame",{cpuTime:je,gpuTime:Fe}))},50)}if(this.listens("gpu-timing-layer")){var Ve=this.painter.collectGpuTimers();setTimeout(function(){var Fe=M.painter.queryGpuTimers(Ve);M.fire(new y.Event("gpu-timing-layer",{layerTimes:Fe}))},50)}var nt=this._sourcesDirty||this._styleDirty||this._placementDirty;return nt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.Event("idle")),!this._loaded||this._fullyLoaded||nt||(this._fullyLoaded=!0),this}},d.prototype.remove=function(){this._hash&&this._hash.remove();for(var g=0,w=this._controls;g<w.length;g+=1)w[g].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),y.window!==void 0&&(y.window.removeEventListener("resize",this._onWindowResize,!1),y.window.removeEventListener("orientationchange",this._onWindowResize,!1),y.window.removeEventListener("online",this._onWindowOnline,!1));var M=this.painter.context.gl.getExtension("WEBGL_lose_context");M&&M.loseContext(),Gl(this._canvasContainer),Gl(this._controlContainer),Gl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new y.Event("remove"))},d.prototype.triggerRepaint=function(){var g=this;this.style&&!this._frame&&(this._frame=y.browser.frame(function(w){g._frame=null,g._render(w)}))},d.prototype._onWindowOnline=function(){this._update()},d.prototype._onWindowResize=function(g){this._trackResize&&this.resize({originalEvent:g})._update()},h.showTileBoundaries.get=function(){return!!this._showTileBoundaries},h.showTileBoundaries.set=function(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())},h.showPadding.get=function(){return!!this._showPadding},h.showPadding.set=function(g){this._showPadding!==g&&(this._showPadding=g,this._update())},h.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},h.showCollisionBoxes.set=function(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())},h.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},h.showOverdrawInspector.set=function(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())},h.repaint.get=function(){return!!this._repaint},h.repaint.set=function(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())},h.vertices.get=function(){return!!this._vertices},h.vertices.set=function(g){this._vertices=g,this._update()},d.prototype._setCacheLimits=function(g,w){y.setCacheLimits(g,w)},h.version.get=function(){return y.version},Object.defineProperties(d.prototype,h),d}(Gc);function Gl(f){f.parentNode&&f.parentNode.removeChild(f)}var Ks={showCompass:!0,showZoom:!0,visualizePitch:!1},lu=function(f){var d=this;this.options=y.extend({},Ks,f),this._container=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(h){return h.preventDefault()}),this.options.showZoom&&(y.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(h){return d._map.zoomIn({},{originalEvent:h})}),X.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(h){return d._map.zoomOut({},{originalEvent:h})}),X.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(y.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(h){d.options.visualizePitch?d._map.resetNorthPitch({},{originalEvent:h}):d._map.resetNorth({},{originalEvent:h})}),this._compassIcon=X.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};lu.prototype._updateZoomButtons=function(){var f=this._map.getZoom(),d=f===this._map.getMaxZoom(),h=f===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},lu.prototype._rotateCompassArrow=function(){var f=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=f},lu.prototype.onAdd=function(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ko(this._map,this._compass,this.options.visualizePitch)),this._container},lu.prototype.onRemove=function(){X.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},lu.prototype._createButton=function(f,d){var h=X.create("button",f,this._container);return h.type="button",h.addEventListener("click",d),h},lu.prototype._setButtonTitle=function(f,d){var h=this._map._getUIString("NavigationControl."+d);f.title=h,f.setAttribute("aria-label",h)};var Ko=function(f,d,h){h===void 0&&(h=!1),this._clickTolerance=10,this.element=d,this.mouseRotate=new Sf({clickTolerance:f.dragRotate._mouseRotate._clickTolerance}),this.map=f,h&&(this.mousePitch=new dl({clickTolerance:f.dragRotate._mousePitch._clickTolerance})),y.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),X.addEventListener(d,"mousedown",this.mousedown),X.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),X.addEventListener(d,"touchmove",this.touchmove),X.addEventListener(d,"touchend",this.touchend),X.addEventListener(d,"touchcancel",this.reset)};function Yu(f,d,h){if(f=new y.LngLat(f.lng,f.lat),d){var g=new y.LngLat(f.lng-360,f.lat),w=new y.LngLat(f.lng+360,f.lat),M=h.locationPoint(f).distSqr(d);h.locationPoint(g).distSqr(d)<M?f=g:h.locationPoint(w).distSqr(d)<M&&(f=w)}for(;Math.abs(f.lng-h.center.lng)>180;){var I=h.locationPoint(f);if(I.x>=0&&I.y>=0&&I.x<=h.width&&I.y<=h.height)break;f.lng>h.center.lng?f.lng-=360:f.lng+=360}return f}Ko.prototype.down=function(f,d){this.mouseRotate.mousedown(f,d),this.mousePitch&&this.mousePitch.mousedown(f,d),X.disableDrag()},Ko.prototype.move=function(f,d){var h=this.map,g=this.mouseRotate.mousemoveWindow(f,d);if(g&&g.bearingDelta&&h.setBearing(h.getBearing()+g.bearingDelta),this.mousePitch){var w=this.mousePitch.mousemoveWindow(f,d);w&&w.pitchDelta&&h.setPitch(h.getPitch()+w.pitchDelta)}},Ko.prototype.off=function(){var f=this.element;X.removeEventListener(f,"mousedown",this.mousedown),X.removeEventListener(f,"touchstart",this.touchstart,{passive:!1}),X.removeEventListener(f,"touchmove",this.touchmove),X.removeEventListener(f,"touchend",this.touchend),X.removeEventListener(f,"touchcancel",this.reset),this.offTemp()},Ko.prototype.offTemp=function(){X.enableDrag(),X.removeEventListener(y.window,"mousemove",this.mousemove),X.removeEventListener(y.window,"mouseup",this.mouseup)},Ko.prototype.mousedown=function(f){this.down(y.extend({},f,{ctrlKey:!0,preventDefault:function(){return f.preventDefault()}}),X.mousePos(this.element,f)),X.addEventListener(y.window,"mousemove",this.mousemove),X.addEventListener(y.window,"mouseup",this.mouseup)},Ko.prototype.mousemove=function(f){this.move(f,X.mousePos(this.element,f))},Ko.prototype.mouseup=function(f){this.mouseRotate.mouseupWindow(f),this.mousePitch&&this.mousePitch.mouseupWindow(f),this.offTemp()},Ko.prototype.touchstart=function(f){f.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=X.touchPos(this.element,f.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return f.preventDefault()}},this._startPos))},Ko.prototype.touchmove=function(f){f.targetTouches.length!==1?this.reset():(this._lastPos=X.touchPos(this.element,f.targetTouches)[0],this.move({preventDefault:function(){return f.preventDefault()}},this._lastPos))},Ko.prototype.touchend=function(f){f.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Ko.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Cu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function gc(f,d,h){var g=f.classList;for(var w in Cu)g.remove("mapboxgl-"+h+"-anchor-"+w);g.add("mapboxgl-"+h+"-anchor-"+d)}var Hl,ml=function(f){function d(h,g){if(f.call(this),(h instanceof y.window.HTMLElement||g)&&(h=y.extend({element:h},g)),y.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=h&&h.anchor||"center",this._color=h&&h.color||"#3FB1CE",this._scale=h&&h.scale||1,this._draggable=h&&h.draggable||!1,this._clickTolerance=h&&h.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=h&&h.rotation||0,this._rotationAlignment=h&&h.rotationAlignment||"auto",this._pitchAlignment=h&&h.pitchAlignment&&h.pitchAlignment!=="auto"?h.pitchAlignment:this._rotationAlignment,h&&h.element)this._element=h.element,this._offset=y.Point.convert(h&&h.offset||[0,0]);else{this._defaultMarker=!0,this._element=X.create("div"),this._element.setAttribute("aria-label","Map marker");var w=X.createNS("http://www.w3.org/2000/svg","svg");w.setAttributeNS(null,"display","block"),w.setAttributeNS(null,"height","41px"),w.setAttributeNS(null,"width","27px"),w.setAttributeNS(null,"viewBox","0 0 27 41");var M=X.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"stroke","none"),M.setAttributeNS(null,"stroke-width","1"),M.setAttributeNS(null,"fill","none"),M.setAttributeNS(null,"fill-rule","evenodd");var I=X.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");var O=X.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(3.0, 29.0)"),O.setAttributeNS(null,"fill","#000000");for(var G=0,Q=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];G<Q.length;G+=1){var ge=Q[G],xe=X.createNS("http://www.w3.org/2000/svg","ellipse");xe.setAttributeNS(null,"opacity","0.04"),xe.setAttributeNS(null,"cx","10.5"),xe.setAttributeNS(null,"cy","5.80029008"),xe.setAttributeNS(null,"rx",ge.rx),xe.setAttributeNS(null,"ry",ge.ry),O.appendChild(xe)}var Ee=X.createNS("http://www.w3.org/2000/svg","g");Ee.setAttributeNS(null,"fill",this._color);var je=X.createNS("http://www.w3.org/2000/svg","path");je.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Ee.appendChild(je);var Ve=X.createNS("http://www.w3.org/2000/svg","g");Ve.setAttributeNS(null,"opacity","0.25"),Ve.setAttributeNS(null,"fill","#000000");var nt=X.createNS("http://www.w3.org/2000/svg","path");nt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ve.appendChild(nt);var Fe=X.createNS("http://www.w3.org/2000/svg","g");Fe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Fe.setAttributeNS(null,"fill","#FFFFFF");var it=X.createNS("http://www.w3.org/2000/svg","g");it.setAttributeNS(null,"transform","translate(8.0, 8.0)");var yt=X.createNS("http://www.w3.org/2000/svg","circle");yt.setAttributeNS(null,"fill","#000000"),yt.setAttributeNS(null,"opacity","0.25"),yt.setAttributeNS(null,"cx","5.5"),yt.setAttributeNS(null,"cy","5.5"),yt.setAttributeNS(null,"r","5.4999962");var Bt=X.createNS("http://www.w3.org/2000/svg","circle");Bt.setAttributeNS(null,"fill","#FFFFFF"),Bt.setAttributeNS(null,"cx","5.5"),Bt.setAttributeNS(null,"cy","5.5"),Bt.setAttributeNS(null,"r","5.4999962"),it.appendChild(yt),it.appendChild(Bt),I.appendChild(O),I.appendChild(Ee),I.appendChild(Ve),I.appendChild(Fe),I.appendChild(it),w.appendChild(I),w.setAttributeNS(null,"height",41*this._scale+"px"),w.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(w),this._offset=y.Point.convert(h&&h.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(fr){fr.preventDefault()}),this._element.addEventListener("mousedown",function(fr){fr.preventDefault()}),gc(this._element,this._anchor,"marker"),this._popup=null}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.addTo=function(h){return this.remove(),this._map=h,h.getCanvasContainer().appendChild(this._element),h.on("move",this._update),h.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},d.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),X.remove(this._element),this._popup&&this._popup.remove(),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=y.LngLat.convert(h),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},d.prototype.getElement=function(){return this._element},d.prototype.setPopup=function(h){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),h){if(!("offset"in h.options)){var g=Math.sqrt(Math.pow(13.5,2)/2);h.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=h,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},d.prototype._onKeyPress=function(h){var g=h.code,w=h.charCode||h.keyCode;g!=="Space"&&g!=="Enter"&&w!==32&&w!==13||this.togglePopup()},d.prototype._onMapClick=function(h){var g=h.originalEvent.target,w=this._element;this._popup&&(g===w||w.contains(g))&&this.togglePopup()},d.prototype.getPopup=function(){return this._popup},d.prototype.togglePopup=function(){var h=this._popup;return h?(h.isOpen()?h.remove():h.addTo(this._map),this):this},d.prototype._update=function(h){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Yu(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(g="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w="rotateX("+this._map.getPitch()+"deg)"),h&&h.type!=="moveend"||(this._pos=this._pos.round()),X.setTransform(this._element,Cu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+w+" "+g)}},d.prototype.getOffset=function(){return this._offset},d.prototype.setOffset=function(h){return this._offset=y.Point.convert(h),this._update(),this},d.prototype._onMove=function(h){if(!this._isDragging){var g=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new y.Event("dragstart"))),this.fire(new y.Event("drag")))},d.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new y.Event("dragend")),this._state="inactive"},d.prototype._addDragHandler=function(h){this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},d.prototype.setDraggable=function(h){return this._draggable=!!h,this._map&&(h?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},d.prototype.isDraggable=function(){return this._draggable},d.prototype.setRotation=function(h){return this._rotation=h||0,this._update(),this},d.prototype.getRotation=function(){return this._rotation},d.prototype.setRotationAlignment=function(h){return this._rotationAlignment=h||"auto",this._update(),this},d.prototype.getRotationAlignment=function(){return this._rotationAlignment},d.prototype.setPitchAlignment=function(h){return this._pitchAlignment=h&&h!=="auto"?h:this._rotationAlignment,this._update(),this},d.prototype.getPitchAlignment=function(){return this._pitchAlignment},d}(y.Evented),Tf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},gl=0,yc=!1,Ch=function(f){function d(h){f.call(this),this.options=y.extend({},Tf,h),y.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.onAdd=function(h){var g;return this._map=h,this._container=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),g=this._setupUI,Hl!==void 0?g(Hl):y.window.navigator.permissions!==void 0?y.window.navigator.permissions.query({name:"geolocation"}).then(function(w){g(Hl=w.state!=="denied")}):g(Hl=!!y.window.navigator.geolocation),this._container},d.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),X.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,gl=0,yc=!1},d.prototype._isOutOfMapMaxBounds=function(h){var g=this._map.getMaxBounds(),w=h.coords;return g&&(w.longitude<g.getWest()||w.longitude>g.getEast()||w.latitude<g.getSouth()||w.latitude>g.getNorth())},d.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},d.prototype._onSuccess=function(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new y.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("geolocate",h)),this._finish()}},d.prototype._updateCamera=function(h){var g=new y.LngLat(h.coords.longitude,h.coords.latitude),w=h.coords.accuracy,M=this._map.getBearing(),I=y.extend({bearing:M},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(w),I,{geolocateSource:!0})},d.prototype._updateMarker=function(h){if(h){var g=new y.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},d.prototype._updateCircleRadius=function(){var h=this._map._container.clientHeight/2,g=this._map.unproject([0,h]),w=this._map.unproject([1,h]),M=g.distanceTo(w),I=Math.ceil(2*this._accuracy/M);this._circleElement.style.width=I+"px",this._circleElement.style.height=I+"px"},d.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},d.prototype._onError=function(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&yc)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("error",h)),this._finish()}},d.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},d.prototype._setupUI=function(h){var g=this;if(this._container.addEventListener("contextmenu",function(I){return I.preventDefault()}),this._geolocateButton=X.create("button","mapboxgl-ctrl-geolocate",this._container),X.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",h===!1){y.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var w=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}else{var M=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=M,this._geolocateButton.setAttribute("aria-label",M)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=X.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new ml(this._dotElement),this._circleElement=X.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ml({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(I){I.geolocateSource||g._watchState!=="ACTIVE_LOCK"||I.originalEvent&&I.originalEvent.type==="resize"||(g._watchState="BACKGROUND",g._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),g._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),g.fire(new y.Event("trackuserlocationend")))})},d.prototype.trigger=function(){if(!this._setup)return y.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":gl--,yc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new y.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++gl>1?(h={maximumAge:6e5,timeout:0},yc=!0):(h=this.options.positionOptions,yc=!1),this._geolocationWatchID=y.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else y.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},d.prototype._clearWatch=function(){y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},d}(y.Evented),qu={maxWidth:100,unit:"metric"},yl=function(f){this.options=y.extend({},qu,f),y.bindAll(["_onMove","setUnit"],this)};function Mf(f,d,h){var g=h&&h.maxWidth||100,w=f._container.clientHeight/2,M=f.unproject([0,w]),I=f.unproject([g,w]),O=M.distanceTo(I);if(h&&h.unit==="imperial"){var G=3.2808*O;G>5280?zu(d,g,G/5280,f._getUIString("ScaleControl.Miles")):zu(d,g,G,f._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?zu(d,g,O/1852,f._getUIString("ScaleControl.NauticalMiles")):O>=1e3?zu(d,g,O/1e3,f._getUIString("ScaleControl.Kilometers")):zu(d,g,O,f._getUIString("ScaleControl.Meters"))}function zu(f,d,h,g){var w,M,I,O=(w=h,(M=Math.pow(10,(""+Math.floor(w)).length-1))*(I=(I=w/M)>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(G){var Q=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*Q)/Q}(I)));f.style.width=d*(O/h)+"px",f.innerHTML=O+"&nbsp;"+g}yl.prototype.getDefaultPosition=function(){return"bottom-left"},yl.prototype._onMove=function(){Mf(this._map,this._container,this.options)},yl.prototype.onAdd=function(f){return this._map=f,this._container=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},yl.prototype.onRemove=function(){X.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},yl.prototype.setUnit=function(f){this.options.unit=f,Mf(this._map,this._container,this.options)};var Zs=function(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof y.window.HTMLElement?this._container=f.container:y.warnOnce("Full screen control 'container' must be a DOM element.")),y.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in y.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in y.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in y.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in y.window.document&&(this._fullscreenchange="MSFullscreenChange")};Zs.prototype.onAdd=function(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",y.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Zs.prototype.onRemove=function(){X.remove(this._controlContainer),this._map=null,y.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Zs.prototype._checkFullscreenSupport=function(){return!!(y.window.document.fullscreenEnabled||y.window.document.mozFullScreenEnabled||y.window.document.msFullscreenEnabled||y.window.document.webkitFullscreenEnabled)},Zs.prototype._setupUI=function(){var f=this._fullscreenButton=X.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);X.create("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden",!0),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),y.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Zs.prototype._updateTitle=function(){var f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f},Zs.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Zs.prototype._isFullscreen=function(){return this._fullscreen},Zs.prototype._changeIcon=function(){(y.window.document.fullscreenElement||y.window.document.mozFullScreenElement||y.window.document.webkitFullscreenElement||y.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Zs.prototype._onClickFullscreen=function(){this._isFullscreen()?y.window.document.exitFullscreen?y.window.document.exitFullscreen():y.window.document.mozCancelFullScreen?y.window.document.mozCancelFullScreen():y.window.document.msExitFullscreen?y.window.document.msExitFullscreen():y.window.document.webkitCancelFullScreen&&y.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var _c={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Hc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),xc=function(f){function d(h){f.call(this),this.options=y.extend(Object.create(_c),h),y.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return f&&(d.__proto__=f),(d.prototype=Object.create(f&&f.prototype)).constructor=d,d.prototype.addTo=function(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new y.Event("open")),this},d.prototype.isOpen=function(){return!!this._map},d.prototype.remove=function(){return this._content&&X.remove(this._content),this._container&&(X.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new y.Event("close")),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=y.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},d.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},d.prototype.getElement=function(){return this._container},d.prototype.setText=function(h){return this.setDOMContent(y.window.document.createTextNode(h))},d.prototype.setHTML=function(h){var g,w=y.window.document.createDocumentFragment(),M=y.window.document.createElement("body");for(M.innerHTML=h;g=M.firstChild;)w.appendChild(g);return this.setDOMContent(w)},d.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},d.prototype.setMaxWidth=function(h){return this.options.maxWidth=h,this._update(),this},d.prototype.setDOMContent=function(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=X.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this},d.prototype.addClassName=function(h){this._container&&this._container.classList.add(h)},d.prototype.removeClassName=function(h){this._container&&this._container.classList.remove(h)},d.prototype.setOffset=function(h){return this.options.offset=h,this._update(),this},d.prototype.toggleClassName=function(h){if(this._container)return this._container.classList.toggle(h)},d.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=X.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},d.prototype._onMouseUp=function(h){this._update(h.point)},d.prototype._onMouseMove=function(h){this._update(h.point)},d.prototype._onDrag=function(h){this._update(h.point)},d.prototype._update=function(h){var g=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=X.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=X.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(xe){return g._container.classList.add(xe)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Yu(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||h)){var w=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat),M=this.options.anchor,I=function xe(Ee){if(Ee){if(typeof Ee=="number"){var je=Math.round(Math.sqrt(.5*Math.pow(Ee,2)));return{center:new y.Point(0,0),top:new y.Point(0,Ee),"top-left":new y.Point(je,je),"top-right":new y.Point(-je,je),bottom:new y.Point(0,-Ee),"bottom-left":new y.Point(je,-je),"bottom-right":new y.Point(-je,-je),left:new y.Point(Ee,0),right:new y.Point(-Ee,0)}}if(Ee instanceof y.Point||Array.isArray(Ee)){var Ve=y.Point.convert(Ee);return{center:Ve,top:Ve,"top-left":Ve,"top-right":Ve,bottom:Ve,"bottom-left":Ve,"bottom-right":Ve,left:Ve,right:Ve}}return{center:y.Point.convert(Ee.center||[0,0]),top:y.Point.convert(Ee.top||[0,0]),"top-left":y.Point.convert(Ee["top-left"]||[0,0]),"top-right":y.Point.convert(Ee["top-right"]||[0,0]),bottom:y.Point.convert(Ee.bottom||[0,0]),"bottom-left":y.Point.convert(Ee["bottom-left"]||[0,0]),"bottom-right":y.Point.convert(Ee["bottom-right"]||[0,0]),left:y.Point.convert(Ee.left||[0,0]),right:y.Point.convert(Ee.right||[0,0])}}return xe(new y.Point(0,0))}(this.options.offset);if(!M){var O,G=this._container.offsetWidth,Q=this._container.offsetHeight;O=w.y+I.bottom.y<Q?["top"]:w.y>this._map.transform.height-Q?["bottom"]:[],w.x<G/2?O.push("left"):w.x>this._map.transform.width-G/2&&O.push("right"),M=O.length===0?"bottom":O.join("-")}var ge=w.add(I[M]).round();X.setTransform(this._container,Cu[M]+" translate("+ge.x+"px,"+ge.y+"px)"),gc(this._container,M,"popup")}},d.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var h=this._container.querySelector(Hc);h&&h.focus()}},d.prototype._onClose=function(){this.remove()},d}(y.Evented),bc={version:y.version,supported:Ie,setRTLTextPlugin:y.setRTLTextPlugin,getRTLTextPluginStatus:y.getRTLTextPluginStatus,Map:eh,NavigationControl:lu,GeolocateControl:Ch,AttributionControl:Es,ScaleControl:yl,FullscreenControl:Zs,Popup:xc,Marker:ml,Style:_s,LngLat:y.LngLat,LngLatBounds:y.LngLatBounds,Point:y.Point,MercatorCoordinate:y.MercatorCoordinate,Evented:y.Evented,config:y.config,prewarm:function(){$t().acquire(tr)},clearPrewarmedResources:function(){var f=In;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(tr),In=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return y.config.ACCESS_TOKEN},set accessToken(f){y.config.ACCESS_TOKEN=f},get baseApiUrl(){return y.config.API_URL},set baseApiUrl(f){y.config.API_URL=f},get workerCount(){return Fr.workerCount},set workerCount(f){Fr.workerCount=f},get maxParallelImageRequests(){return y.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){y.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage:function(f){y.clearTileCache(f)},workerUrl:""};return bc}),Le})},3614:function(sn,pe,ee){"use strict";sn.exports=Te;var Le=ee(80645);function Te(ae){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ae)?ae:new Uint8Array(ae||0),this.pos=0,this.type=0,this.length=this.buf.length}Te.Varint=0,Te.Fixed64=1,Te.Bytes=2,Te.Fixed32=5;var y=(1<<16)*(1<<16),Ie=1/y,X=12,Se=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");Te.prototype={destroy:function(){this.buf=null},readFields:function(ae,Ze,Y){for(Y=Y||this.length;this.pos<Y;){var ce=this.readVarint(),ue=ce>>3,Xe=this.pos;this.type=ce&7,ae(ue,Ze,this),this.pos===Xe&&this.skip(ce)}return Ze},readMessage:function(ae,Ze){return this.readFields(ae,Ze,this.readVarint()+this.pos)},readFixed32:function(){var ae=Ct(this.buf,this.pos);return this.pos+=4,ae},readSFixed32:function(){var ae=Ht(this.buf,this.pos);return this.pos+=4,ae},readFixed64:function(){var ae=Ct(this.buf,this.pos)+Ct(this.buf,this.pos+4)*y;return this.pos+=8,ae},readSFixed64:function(){var ae=Ct(this.buf,this.pos)+Ht(this.buf,this.pos+4)*y;return this.pos+=8,ae},readFloat:function(){var ae=Le.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ae},readDouble:function(){var ae=Le.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ae},readVarint:function(ae){var Ze=this.buf,Y,ce;return ce=Ze[this.pos++],Y=ce&127,ce<128||(ce=Ze[this.pos++],Y|=(ce&127)<<7,ce<128)||(ce=Ze[this.pos++],Y|=(ce&127)<<14,ce<128)||(ce=Ze[this.pos++],Y|=(ce&127)<<21,ce<128)?Y:(ce=Ze[this.pos],Y|=(ce&15)<<28,se(Y,ae,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ae=this.readVarint();return ae%2==1?(ae+1)/-2:ae/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var ae=this.readVarint()+this.pos,Ze=this.pos;return this.pos=ae,ae-Ze>=X&&Se?sr(this.buf,Ze,ae):vt(this.buf,Ze,ae)},readBytes:function(){var ae=this.readVarint()+this.pos,Ze=this.buf.subarray(this.pos,ae);return this.pos=ae,Ze},readPackedVarint:function(ae,Ze){if(this.type!==Te.Bytes)return ae.push(this.readVarint(Ze));var Y=rt(this);for(ae=ae||[];this.pos<Y;)ae.push(this.readVarint(Ze));return ae},readPackedSVarint:function(ae){if(this.type!==Te.Bytes)return ae.push(this.readSVarint());var Ze=rt(this);for(ae=ae||[];this.pos<Ze;)ae.push(this.readSVarint());return ae},readPackedBoolean:function(ae){if(this.type!==Te.Bytes)return ae.push(this.readBoolean());var Ze=rt(this);for(ae=ae||[];this.pos<Ze;)ae.push(this.readBoolean());return ae},readPackedFloat:function(ae){if(this.type!==Te.Bytes)return ae.push(this.readFloat());var Ze=rt(this);for(ae=ae||[];this.pos<Ze;)ae.push(this.readFloat());return ae},readPackedDouble:function(ae){if(this.type!==Te.Bytes)return ae.push(this.readDouble());var Ze=rt(this);for(ae=ae||[];this.pos<Ze;)ae.push(this.readDouble());return ae},readPackedFixed32:function(ae){if(this.type!==Te.Bytes)return ae.push(this.readFixed32());var Ze=rt(this);for(ae=ae||[];this.pos<Ze;)ae.push(this.readFixed32());return ae},readPackedSFixed32:function(ae){if(this.type!==Te.Bytes)return ae.push(this.readSFixed32());var Ze=rt(this);for(ae=ae||[];this.pos<Ze;)ae.push(this.readSFixed32());return ae},readPackedFixed64:function(ae){if(this.type!==Te.Bytes)return ae.push(this.readFixed64());var Ze=rt(this);for(ae=ae||[];this.pos<Ze;)ae.push(this.readFixed64());return ae},readPackedSFixed64:function(ae){if(this.type!==Te.Bytes)return ae.push(this.readSFixed64());var Ze=rt(this);for(ae=ae||[];this.pos<Ze;)ae.push(this.readSFixed64());return ae},skip:function(ae){var Ze=ae&7;if(Ze===Te.Varint)for(;this.buf[this.pos++]>127;);else if(Ze===Te.Bytes)this.pos=this.readVarint()+this.pos;else if(Ze===Te.Fixed32)this.pos+=4;else if(Ze===Te.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+Ze)},writeTag:function(ae,Ze){this.writeVarint(ae<<3|Ze)},realloc:function(ae){for(var Ze=this.length||16;Ze<this.pos+ae;)Ze*=2;if(Ze!==this.length){var Y=new Uint8Array(Ze);Y.set(this.buf),this.buf=Y,this.length=Ze}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ae){this.realloc(4),pt(this.buf,ae,this.pos),this.pos+=4},writeSFixed32:function(ae){this.realloc(4),pt(this.buf,ae,this.pos),this.pos+=4},writeFixed64:function(ae){this.realloc(8),pt(this.buf,ae&-1,this.pos),pt(this.buf,Math.floor(ae*Ie),this.pos+4),this.pos+=8},writeSFixed64:function(ae){this.realloc(8),pt(this.buf,ae&-1,this.pos),pt(this.buf,Math.floor(ae*Ie),this.pos+4),this.pos+=8},writeVarint:function(ae){if(ae=+ae||0,ae>268435455||ae<0){ot(ae,this);return}this.realloc(4),this.buf[this.pos++]=ae&127|(ae>127?128:0),!(ae<=127)&&(this.buf[this.pos++]=(ae>>>=7)&127|(ae>127?128:0),!(ae<=127)&&(this.buf[this.pos++]=(ae>>>=7)&127|(ae>127?128:0),!(ae<=127)&&(this.buf[this.pos++]=ae>>>7&127)))},writeSVarint:function(ae){this.writeVarint(ae<0?-ae*2-1:ae*2)},writeBoolean:function(ae){this.writeVarint(Boolean(ae))},writeString:function(ae){ae=String(ae),this.realloc(ae.length*4),this.pos++;var Ze=this.pos;this.pos=Ir(this.buf,ae,this.pos);var Y=this.pos-Ze;Y>=128&&Ot(Ze,Y,this),this.pos=Ze-1,this.writeVarint(Y),this.pos+=Y},writeFloat:function(ae){this.realloc(4),Le.write(this.buf,ae,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ae){this.realloc(8),Le.write(this.buf,ae,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ae){var Ze=ae.length;this.writeVarint(Ze),this.realloc(Ze);for(var Y=0;Y<Ze;Y++)this.buf[this.pos++]=ae[Y]},writeRawMessage:function(ae,Ze){this.pos++;var Y=this.pos;ae(Ze,this);var ce=this.pos-Y;ce>=128&&Ot(Y,ce,this),this.pos=Y-1,this.writeVarint(ce),this.pos+=ce},writeMessage:function(ae,Ze,Y){this.writeTag(ae,Te.Bytes),this.writeRawMessage(Ze,Y)},writePackedVarint:function(ae,Ze){Ze.length&&this.writeMessage(ae,vr,Ze)},writePackedSVarint:function(ae,Ze){Ze.length&&this.writeMessage(ae,Ft,Ze)},writePackedBoolean:function(ae,Ze){Ze.length&&this.writeMessage(ae,It,Ze)},writePackedFloat:function(ae,Ze){Ze.length&&this.writeMessage(ae,gr,Ze)},writePackedDouble:function(ae,Ze){Ze.length&&this.writeMessage(ae,qt,Ze)},writePackedFixed32:function(ae,Ze){Ze.length&&this.writeMessage(ae,Zt,Ze)},writePackedSFixed32:function(ae,Ze){Ze.length&&this.writeMessage(ae,br,Ze)},writePackedFixed64:function(ae,Ze){Ze.length&&this.writeMessage(ae,J,Ze)},writePackedSFixed64:function(ae,Ze){Ze.length&&this.writeMessage(ae,Et,Ze)},writeBytesField:function(ae,Ze){this.writeTag(ae,Te.Bytes),this.writeBytes(Ze)},writeFixed32Field:function(ae,Ze){this.writeTag(ae,Te.Fixed32),this.writeFixed32(Ze)},writeSFixed32Field:function(ae,Ze){this.writeTag(ae,Te.Fixed32),this.writeSFixed32(Ze)},writeFixed64Field:function(ae,Ze){this.writeTag(ae,Te.Fixed64),this.writeFixed64(Ze)},writeSFixed64Field:function(ae,Ze){this.writeTag(ae,Te.Fixed64),this.writeSFixed64(Ze)},writeVarintField:function(ae,Ze){this.writeTag(ae,Te.Varint),this.writeVarint(Ze)},writeSVarintField:function(ae,Ze){this.writeTag(ae,Te.Varint),this.writeSVarint(Ze)},writeStringField:function(ae,Ze){this.writeTag(ae,Te.Bytes),this.writeString(Ze)},writeFloatField:function(ae,Ze){this.writeTag(ae,Te.Fixed32),this.writeFloat(Ze)},writeDoubleField:function(ae,Ze){this.writeTag(ae,Te.Fixed64),this.writeDouble(Ze)},writeBooleanField:function(ae,Ze){this.writeVarintField(ae,Boolean(Ze))}};function se(ae,Ze,Y){var ce=Y.buf,ue,Xe;if(Xe=ce[Y.pos++],ue=(Xe&112)>>4,Xe<128||(Xe=ce[Y.pos++],ue|=(Xe&127)<<3,Xe<128)||(Xe=ce[Y.pos++],ue|=(Xe&127)<<10,Xe<128)||(Xe=ce[Y.pos++],ue|=(Xe&127)<<17,Xe<128)||(Xe=ce[Y.pos++],ue|=(Xe&127)<<24,Xe<128)||(Xe=ce[Y.pos++],ue|=(Xe&1)<<31,Xe<128))return ye(ae,ue,Ze);throw new Error("Expected varint not more than 10 bytes")}function rt(ae){return ae.type===Te.Bytes?ae.readVarint()+ae.pos:ae.pos+1}function ye(ae,Ze,Y){return Y?Ze*4294967296+(ae>>>0):(Ze>>>0)*4294967296+(ae>>>0)}function ot(ae,Ze){var Y,ce;if(ae>=0?(Y=ae%4294967296|0,ce=ae/4294967296|0):(Y=~(-ae%4294967296),ce=~(-ae/4294967296),Y^4294967295?Y=Y+1|0:(Y=0,ce=ce+1|0)),ae>=18446744073709552e3||ae<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Ze.realloc(10),ct(Y,ce,Ze),bt(ce,Ze)}function ct(ae,Ze,Y){Y.buf[Y.pos++]=ae&127|128,ae>>>=7,Y.buf[Y.pos++]=ae&127|128,ae>>>=7,Y.buf[Y.pos++]=ae&127|128,ae>>>=7,Y.buf[Y.pos++]=ae&127|128,ae>>>=7,Y.buf[Y.pos]=ae&127}function bt(ae,Ze){var Y=(ae&7)<<4;Ze.buf[Ze.pos++]|=Y|((ae>>>=3)?128:0),!!ae&&(Ze.buf[Ze.pos++]=ae&127|((ae>>>=7)?128:0),!!ae&&(Ze.buf[Ze.pos++]=ae&127|((ae>>>=7)?128:0),!!ae&&(Ze.buf[Ze.pos++]=ae&127|((ae>>>=7)?128:0),!!ae&&(Ze.buf[Ze.pos++]=ae&127|((ae>>>=7)?128:0),!!ae&&(Ze.buf[Ze.pos++]=ae&127)))))}function Ot(ae,Ze,Y){var ce=Ze<=16383?1:Ze<=2097151?2:Ze<=268435455?3:Math.floor(Math.log(Ze)/(Math.LN2*7));Y.realloc(ce);for(var ue=Y.pos-1;ue>=ae;ue--)Y.buf[ue+ce]=Y.buf[ue]}function vr(ae,Ze){for(var Y=0;Y<ae.length;Y++)Ze.writeVarint(ae[Y])}function Ft(ae,Ze){for(var Y=0;Y<ae.length;Y++)Ze.writeSVarint(ae[Y])}function gr(ae,Ze){for(var Y=0;Y<ae.length;Y++)Ze.writeFloat(ae[Y])}function qt(ae,Ze){for(var Y=0;Y<ae.length;Y++)Ze.writeDouble(ae[Y])}function It(ae,Ze){for(var Y=0;Y<ae.length;Y++)Ze.writeBoolean(ae[Y])}function Zt(ae,Ze){for(var Y=0;Y<ae.length;Y++)Ze.writeFixed32(ae[Y])}function br(ae,Ze){for(var Y=0;Y<ae.length;Y++)Ze.writeSFixed32(ae[Y])}function J(ae,Ze){for(var Y=0;Y<ae.length;Y++)Ze.writeFixed64(ae[Y])}function Et(ae,Ze){for(var Y=0;Y<ae.length;Y++)Ze.writeSFixed64(ae[Y])}function Ct(ae,Ze){return(ae[Ze]|ae[Ze+1]<<8|ae[Ze+2]<<16)+ae[Ze+3]*16777216}function pt(ae,Ze,Y){ae[Y]=Ze,ae[Y+1]=Ze>>>8,ae[Y+2]=Ze>>>16,ae[Y+3]=Ze>>>24}function Ht(ae,Ze){return(ae[Ze]|ae[Ze+1]<<8|ae[Ze+2]<<16)+(ae[Ze+3]<<24)}function vt(ae,Ze,Y){for(var ce="",ue=Ze;ue<Y;){var Xe=ae[ue],lt=null,_t=Xe>239?4:Xe>223?3:Xe>191?2:1;if(ue+_t>Y)break;var Xt,hr,Yr;_t===1?Xe<128&&(lt=Xe):_t===2?(Xt=ae[ue+1],(Xt&192)==128&&(lt=(Xe&31)<<6|Xt&63,lt<=127&&(lt=null))):_t===3?(Xt=ae[ue+1],hr=ae[ue+2],(Xt&192)==128&&(hr&192)==128&&(lt=(Xe&15)<<12|(Xt&63)<<6|hr&63,(lt<=2047||lt>=55296&&lt<=57343)&&(lt=null))):_t===4&&(Xt=ae[ue+1],hr=ae[ue+2],Yr=ae[ue+3],(Xt&192)==128&&(hr&192)==128&&(Yr&192)==128&&(lt=(Xe&15)<<18|(Xt&63)<<12|(hr&63)<<6|Yr&63,(lt<=65535||lt>=1114112)&&(lt=null))),lt===null?(lt=65533,_t=1):lt>65535&&(lt-=65536,ce+=String.fromCharCode(lt>>>10&1023|55296),lt=56320|lt&1023),ce+=String.fromCharCode(lt),ue+=_t}return ce}function sr(ae,Ze,Y){return Se.decode(ae.subarray(Ze,Y))}function Ir(ae,Ze,Y){for(var ce=0,ue,Xe;ce<Ze.length;ce++){if(ue=Ze.charCodeAt(ce),ue>55295&&ue<57344)if(Xe)if(ue<56320){ae[Y++]=239,ae[Y++]=191,ae[Y++]=189,Xe=ue;continue}else ue=Xe-55296<<10|ue-56320|65536,Xe=null;else{ue>56319||ce+1===Ze.length?(ae[Y++]=239,ae[Y++]=191,ae[Y++]=189):Xe=ue;continue}else Xe&&(ae[Y++]=239,ae[Y++]=191,ae[Y++]=189,Xe=null);ue<128?ae[Y++]=ue:(ue<2048?ae[Y++]=ue>>6|192:(ue<65536?ae[Y++]=ue>>12|224:(ae[Y++]=ue>>18|240,ae[Y++]=ue>>12&63|128),ae[Y++]=ue>>6&63|128),ae[Y++]=ue&63|128)}return Y}},32676:function(sn,pe,ee){var Le=ee(34155);(function(Te,y){sn.exports=y()})(this,function(){"use strict";function Te(gt,he){if(!(gt instanceof he))throw new TypeError("Cannot call a class as a function")}function y(gt,he){for(var ie=0;ie<he.length;ie++){var _e=he[ie];_e.enumerable=_e.enumerable||!1,_e.configurable=!0,"value"in _e&&(_e.writable=!0),Object.defineProperty(gt,_e.key,_e)}}function Ie(gt,he,ie){return he&&y(gt.prototype,he),ie&&y(gt,ie),gt}/**
 * splaytree v3.1.0
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */var X=function(){function gt(he,ie){this.next=null,this.key=he,this.data=ie,this.left=null,this.right=null}return gt}();function Se(gt,he){return gt>he?1:gt<he?-1:0}function se(gt,he,ie){for(var _e=new X(null,null),N=_e,qe=_e;;){var Qt=ie(gt,he.key);if(Qt<0){if(he.left===null)break;if(ie(gt,he.left.key)<0){var Nr=he.left;if(he.left=Nr.right,Nr.right=he,he=Nr,he.left===null)break}qe.left=he,qe=he,he=he.left}else if(Qt>0){if(he.right===null)break;if(ie(gt,he.right.key)>0){var Nr=he.right;if(he.right=Nr.left,Nr.left=he,he=Nr,he.right===null)break}N.right=he,N=he,he=he.right}else break}return N.right=he.left,qe.left=he.right,he.left=_e.right,he.right=_e.left,he}function rt(gt,he,ie,_e){var N=new X(gt,he);if(ie===null)return N.left=N.right=null,N;ie=se(gt,ie,_e);var qe=_e(gt,ie.key);return qe<0?(N.left=ie.left,N.right=ie,ie.left=null):qe>=0&&(N.right=ie.right,N.left=ie,ie.right=null),N}function ye(gt,he,ie){var _e=null,N=null;if(he){he=se(gt,he,ie);var qe=ie(he.key,gt);qe===0?(_e=he.left,N=he.right):qe<0?(N=he.right,he.right=null,_e=he):(_e=he.left,he.left=null,N=he)}return{left:_e,right:N}}function ot(gt,he,ie){return he===null?gt:(gt===null||(he=se(gt.key,he,ie),he.left=gt),he)}function ct(gt,he,ie,_e,N){if(gt){_e(""+he+(ie?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+N(gt)+`
`);var qe=he+(ie?"    ":"\u2502   ");gt.left&&ct(gt.left,qe,!1,_e,N),gt.right&&ct(gt.right,qe,!0,_e,N)}}var bt=function(){function gt(he){he===void 0&&(he=Se),this._root=null,this._size=0,this._comparator=he}return gt.prototype.insert=function(he,ie){return this._size++,this._root=rt(he,ie,this._root,this._comparator)},gt.prototype.add=function(he,ie){var _e=new X(he,ie);this._root===null&&(_e.left=_e.right=null,this._size++,this._root=_e);var N=this._comparator,qe=se(he,this._root,N),Qt=N(he,qe.key);return Qt===0?this._root=qe:(Qt<0?(_e.left=qe.left,_e.right=qe,qe.left=null):Qt>0&&(_e.right=qe.right,_e.left=qe,qe.right=null),this._size++,this._root=_e),this._root},gt.prototype.remove=function(he){this._root=this._remove(he,this._root,this._comparator)},gt.prototype._remove=function(he,ie,_e){var N;if(ie===null)return null;ie=se(he,ie,_e);var qe=_e(he,ie.key);return qe===0?(ie.left===null?N=ie.right:(N=se(he,ie.left,_e),N.right=ie.right),this._size--,N):ie},gt.prototype.pop=function(){var he=this._root;if(he){for(;he.left;)he=he.left;return this._root=se(he.key,this._root,this._comparator),this._root=this._remove(he.key,this._root,this._comparator),{key:he.key,data:he.data}}return null},gt.prototype.findStatic=function(he){for(var ie=this._root,_e=this._comparator;ie;){var N=_e(he,ie.key);if(N===0)return ie;N<0?ie=ie.left:ie=ie.right}return null},gt.prototype.find=function(he){return this._root&&(this._root=se(he,this._root,this._comparator),this._comparator(he,this._root.key)!==0)?null:this._root},gt.prototype.contains=function(he){for(var ie=this._root,_e=this._comparator;ie;){var N=_e(he,ie.key);if(N===0)return!0;N<0?ie=ie.left:ie=ie.right}return!1},gt.prototype.forEach=function(he,ie){for(var _e=this._root,N=[],qe=!1;!qe;)_e!==null?(N.push(_e),_e=_e.left):N.length!==0?(_e=N.pop(),he.call(ie,_e),_e=_e.right):qe=!0;return this},gt.prototype.range=function(he,ie,_e,N){for(var qe=[],Qt=this._comparator,Nr=this._root,Ye;qe.length!==0||Nr;)if(Nr)qe.push(Nr),Nr=Nr.left;else{if(Nr=qe.pop(),Ye=Qt(Nr.key,ie),Ye>0)break;if(Qt(Nr.key,he)>=0&&_e.call(N,Nr))return this;Nr=Nr.right}return this},gt.prototype.keys=function(){var he=[];return this.forEach(function(ie){var _e=ie.key;return he.push(_e)}),he},gt.prototype.values=function(){var he=[];return this.forEach(function(ie){var _e=ie.data;return he.push(_e)}),he},gt.prototype.min=function(){return this._root?this.minNode(this._root).key:null},gt.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},gt.prototype.minNode=function(he){if(he===void 0&&(he=this._root),he)for(;he.left;)he=he.left;return he},gt.prototype.maxNode=function(he){if(he===void 0&&(he=this._root),he)for(;he.right;)he=he.right;return he},gt.prototype.at=function(he){for(var ie=this._root,_e=!1,N=0,qe=[];!_e;)if(ie)qe.push(ie),ie=ie.left;else if(qe.length>0){if(ie=qe.pop(),N===he)return ie;N++,ie=ie.right}else _e=!0;return null},gt.prototype.next=function(he){var ie=this._root,_e=null;if(he.right){for(_e=he.right;_e.left;)_e=_e.left;return _e}for(var N=this._comparator;ie;){var qe=N(he.key,ie.key);if(qe===0)break;qe<0?(_e=ie,ie=ie.left):ie=ie.right}return _e},gt.prototype.prev=function(he){var ie=this._root,_e=null;if(he.left!==null){for(_e=he.left;_e.right;)_e=_e.right;return _e}for(var N=this._comparator;ie;){var qe=N(he.key,ie.key);if(qe===0)break;qe<0?ie=ie.left:(_e=ie,ie=ie.right)}return _e},gt.prototype.clear=function(){return this._root=null,this._size=0,this},gt.prototype.toList=function(){return Ft(this._root)},gt.prototype.load=function(he,ie,_e){ie===void 0&&(ie=[]),_e===void 0&&(_e=!1);var N=he.length,qe=this._comparator;if(_e&&It(he,ie,0,N-1,qe),this._root===null)this._root=Ot(he,ie,0,N),this._size=N;else{var Qt=qt(this.toList(),vr(he,ie),qe);N=this._size+N,this._root=gr({head:Qt},0,N)}return this},gt.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(gt.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(gt.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),gt.prototype.toString=function(he){he===void 0&&(he=function(N){return String(N.key)});var ie=[];return ct(this._root,"",!0,function(_e){return ie.push(_e)},he),ie.join("")},gt.prototype.update=function(he,ie,_e){var N=this._comparator,qe=ye(he,this._root,N),Qt=qe.left,Nr=qe.right;N(he,ie)<0?Nr=rt(ie,_e,Nr,N):Qt=rt(ie,_e,Qt,N),this._root=ot(Qt,Nr,N)},gt.prototype.split=function(he){return ye(he,this._root,this._comparator)},gt}();function Ot(gt,he,ie,_e){var N=_e-ie;if(N>0){var qe=ie+Math.floor(N/2),Qt=gt[qe],Nr=he[qe],Ye=new X(Qt,Nr);return Ye.left=Ot(gt,he,ie,qe),Ye.right=Ot(gt,he,qe+1,_e),Ye}return null}function vr(gt,he){for(var ie=new X(null,null),_e=ie,N=0;N<gt.length;N++)_e=_e.next=new X(gt[N],he[N]);return _e.next=null,ie.next}function Ft(gt){for(var he=gt,ie=[],_e=!1,N=new X(null,null),qe=N;!_e;)he?(ie.push(he),he=he.left):ie.length>0?(he=qe=qe.next=ie.pop(),he=he.right):_e=!0;return qe.next=null,N.next}function gr(gt,he,ie){var _e=ie-he;if(_e>0){var N=he+Math.floor(_e/2),qe=gr(gt,he,N),Qt=gt.head;return Qt.left=qe,gt.head=gt.head.next,Qt.right=gr(gt,N+1,ie),Qt}return null}function qt(gt,he,ie){for(var _e=new X(null,null),N=_e,qe=gt,Qt=he;qe!==null&&Qt!==null;)ie(qe.key,Qt.key)<0?(N.next=qe,qe=qe.next):(N.next=Qt,Qt=Qt.next),N=N.next;return qe!==null?N.next=qe:Qt!==null&&(N.next=Qt),_e.next}function It(gt,he,ie,_e,N){if(!(ie>=_e)){for(var qe=gt[ie+_e>>1],Qt=ie-1,Nr=_e+1;;){do Qt++;while(N(gt[Qt],qe)<0);do Nr--;while(N(gt[Nr],qe)>0);if(Qt>=Nr)break;var Ye=gt[Qt];gt[Qt]=gt[Nr],gt[Nr]=Ye,Ye=he[Qt],he[Qt]=he[Nr],he[Nr]=Ye}It(gt,he,ie,Nr,N),It(gt,he,Nr+1,_e,N)}}var Zt=function(he,ie){return he.ll.x<=ie.x&&ie.x<=he.ur.x&&he.ll.y<=ie.y&&ie.y<=he.ur.y},br=function(he,ie){if(ie.ur.x<he.ll.x||he.ur.x<ie.ll.x||ie.ur.y<he.ll.y||he.ur.y<ie.ll.y)return null;var _e=he.ll.x<ie.ll.x?ie.ll.x:he.ll.x,N=he.ur.x<ie.ur.x?he.ur.x:ie.ur.x,qe=he.ll.y<ie.ll.y?ie.ll.y:he.ll.y,Qt=he.ur.y<ie.ur.y?he.ur.y:ie.ur.y;return{ll:{x:_e,y:qe},ur:{x:N,y:Qt}}},J=Number.EPSILON;J===void 0&&(J=Math.pow(2,-52));var Et=J*J,Ct=function(he,ie){if(-J<he&&he<J&&-J<ie&&ie<J)return 0;var _e=he-ie;return _e*_e<Et*he*ie?0:he<ie?-1:1},pt=function(){function gt(){Te(this,gt),this.reset()}return Ie(gt,[{key:"reset",value:function(){this.xRounder=new Ht,this.yRounder=new Ht}},{key:"round",value:function(ie,_e){return{x:this.xRounder.round(ie),y:this.yRounder.round(_e)}}}]),gt}(),Ht=function(){function gt(){Te(this,gt),this.tree=new bt,this.round(0)}return Ie(gt,[{key:"round",value:function(ie){var _e=this.tree.add(ie),N=this.tree.prev(_e);if(N!==null&&Ct(_e.key,N.key)===0)return this.tree.remove(ie),N.key;var qe=this.tree.next(_e);return qe!==null&&Ct(_e.key,qe.key)===0?(this.tree.remove(ie),qe.key):ie}}]),gt}(),vt=new pt,sr=function(he,ie){return he.x*ie.y-he.y*ie.x},Ir=function(he,ie){return he.x*ie.x+he.y*ie.y},ae=function(he,ie,_e){var N={x:ie.x-he.x,y:ie.y-he.y},qe={x:_e.x-he.x,y:_e.y-he.y},Qt=sr(N,qe);return Ct(Qt,0)},Ze=function(he){return Math.sqrt(Ir(he,he))},Y=function(he,ie,_e){var N={x:ie.x-he.x,y:ie.y-he.y},qe={x:_e.x-he.x,y:_e.y-he.y};return sr(qe,N)/Ze(qe)/Ze(N)},ce=function(he,ie,_e){var N={x:ie.x-he.x,y:ie.y-he.y},qe={x:_e.x-he.x,y:_e.y-he.y};return Ir(qe,N)/Ze(qe)/Ze(N)},ue=function(he,ie,_e){return ie.y===0?null:{x:he.x+ie.x/ie.y*(_e-he.y),y:_e}},Xe=function(he,ie,_e){return ie.x===0?null:{x:_e,y:he.y+ie.y/ie.x*(_e-he.x)}},lt=function(he,ie,_e,N){if(ie.x===0)return Xe(_e,N,he.x);if(N.x===0)return Xe(he,ie,_e.x);if(ie.y===0)return ue(_e,N,he.y);if(N.y===0)return ue(he,ie,_e.y);var qe=sr(ie,N);if(qe==0)return null;var Qt={x:_e.x-he.x,y:_e.y-he.y},Nr=sr(Qt,ie)/qe,Ye=sr(Qt,N)/qe,Pt=he.x+Ye*ie.x,pr=_e.x+Nr*N.x,Pr=he.y+Ye*ie.y,Wr=_e.y+Nr*N.y,tn=(Pt+pr)/2,Yn=(Pr+Wr)/2;return{x:tn,y:Yn}},_t=function(){Ie(gt,null,[{key:"compare",value:function(ie,_e){var N=gt.comparePoints(ie.point,_e.point);return N!==0?N:(ie.point!==_e.point&&ie.link(_e),ie.isLeft!==_e.isLeft?ie.isLeft?1:-1:hr.compare(ie.segment,_e.segment))}},{key:"comparePoints",value:function(ie,_e){return ie.x<_e.x?-1:ie.x>_e.x?1:ie.y<_e.y?-1:ie.y>_e.y?1:0}}]);function gt(he,ie){Te(this,gt),he.events===void 0?he.events=[this]:he.events.push(this),this.point=he,this.isLeft=ie}return Ie(gt,[{key:"link",value:function(ie){if(ie.point===this.point)throw new Error("Tried to link already linked events");for(var _e=ie.point.events,N=0,qe=_e.length;N<qe;N++){var Qt=_e[N];this.point.events.push(Qt),Qt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var ie=this.point.events.length,_e=0;_e<ie;_e++){var N=this.point.events[_e];if(N.segment.consumedBy===void 0)for(var qe=_e+1;qe<ie;qe++){var Qt=this.point.events[qe];Qt.consumedBy===void 0&&N.otherSE.point.events===Qt.otherSE.point.events&&N.segment.consume(Qt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var ie=[],_e=0,N=this.point.events.length;_e<N;_e++){var qe=this.point.events[_e];qe!==this&&!qe.segment.ringOut&&qe.segment.isInResult()&&ie.push(qe)}return ie}},{key:"getLeftmostComparator",value:function(ie){var _e=this,N=new Map,qe=function(Nr){var Ye=Nr.otherSE;N.set(Nr,{sine:Y(_e.point,ie.point,Ye.point),cosine:ce(_e.point,ie.point,Ye.point)})};return function(Qt,Nr){N.has(Qt)||qe(Qt),N.has(Nr)||qe(Nr);var Ye=N.get(Qt),Pt=Ye.sine,pr=Ye.cosine,Pr=N.get(Nr),Wr=Pr.sine,tn=Pr.cosine;return Pt>=0&&Wr>=0?pr<tn?1:pr>tn?-1:0:Pt<0&&Wr<0?pr<tn?-1:pr>tn?1:0:Wr<Pt?-1:Wr>Pt?1:0}}}]),gt}(),Xt=0,hr=function(){Ie(gt,null,[{key:"compare",value:function(ie,_e){var N=ie.leftSE.point.x,qe=_e.leftSE.point.x,Qt=ie.rightSE.point.x,Nr=_e.rightSE.point.x;if(Nr<N)return 1;if(Qt<qe)return-1;var Ye=ie.leftSE.point.y,Pt=_e.leftSE.point.y,pr=ie.rightSE.point.y,Pr=_e.rightSE.point.y;if(N<qe){if(Pt<Ye&&Pt<pr)return 1;if(Pt>Ye&&Pt>pr)return-1;var Wr=ie.comparePoint(_e.leftSE.point);if(Wr<0)return 1;if(Wr>0)return-1;var tn=_e.comparePoint(ie.rightSE.point);return tn!==0?tn:-1}if(N>qe){if(Ye<Pt&&Ye<Pr)return-1;if(Ye>Pt&&Ye>Pr)return 1;var Yn=_e.comparePoint(ie.leftSE.point);if(Yn!==0)return Yn;var jn=ie.comparePoint(_e.rightSE.point);return jn<0?1:jn>0?-1:1}if(Ye<Pt)return-1;if(Ye>Pt)return 1;if(Qt<Nr){var an=_e.comparePoint(ie.rightSE.point);if(an!==0)return an}if(Qt>Nr){var gi=ie.comparePoint(_e.rightSE.point);if(gi<0)return 1;if(gi>0)return-1}if(Qt!==Nr){var ci=pr-Ye,fa=Qt-N,ka=Pr-Pt,Ua=Nr-qe;if(ci>fa&&ka<Ua)return 1;if(ci<fa&&ka>Ua)return-1}return Qt>Nr?1:Qt<Nr||pr<Pr?-1:pr>Pr?1:ie.id<_e.id?-1:ie.id>_e.id?1:0}}]);function gt(he,ie,_e,N){Te(this,gt),this.id=++Xt,this.leftSE=he,he.segment=this,he.otherSE=ie,this.rightSE=ie,ie.segment=this,ie.otherSE=he,this.rings=_e,this.windings=N}return Ie(gt,[{key:"replaceRightSE",value:function(ie){this.rightSE=ie,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var ie=this.leftSE.point.y,_e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:ie<_e?ie:_e},ur:{x:this.rightSE.point.x,y:ie>_e?ie:_e}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(ie){return ie.x===this.leftSE.point.x&&ie.y===this.leftSE.point.y||ie.x===this.rightSE.point.x&&ie.y===this.rightSE.point.y}},{key:"comparePoint",value:function(ie){if(this.isAnEndpoint(ie))return 0;var _e=this.leftSE.point,N=this.rightSE.point,qe=this.vector();if(_e.x===N.x)return ie.x===_e.x?0:ie.x<_e.x?1:-1;var Qt=(ie.y-_e.y)/qe.y,Nr=_e.x+Qt*qe.x;if(ie.x===Nr)return 0;var Ye=(ie.x-_e.x)/qe.x,Pt=_e.y+Ye*qe.y;return ie.y===Pt?0:ie.y<Pt?-1:1}},{key:"getIntersection",value:function(ie){var _e=this.bbox(),N=ie.bbox(),qe=br(_e,N);if(qe===null)return null;var Qt=this.leftSE.point,Nr=this.rightSE.point,Ye=ie.leftSE.point,Pt=ie.rightSE.point,pr=Zt(_e,Ye)&&this.comparePoint(Ye)===0,Pr=Zt(N,Qt)&&ie.comparePoint(Qt)===0,Wr=Zt(_e,Pt)&&this.comparePoint(Pt)===0,tn=Zt(N,Nr)&&ie.comparePoint(Nr)===0;if(Pr&&pr)return tn&&!Wr?Nr:!tn&&Wr?Pt:null;if(Pr)return Wr&&Qt.x===Pt.x&&Qt.y===Pt.y?null:Qt;if(pr)return tn&&Nr.x===Ye.x&&Nr.y===Ye.y?null:Ye;if(tn&&Wr)return null;if(tn)return Nr;if(Wr)return Pt;var Yn=lt(Qt,this.vector(),Ye,ie.vector());return Yn===null||!Zt(qe,Yn)?null:vt.round(Yn.x,Yn.y)}},{key:"split",value:function(ie){var _e=[],N=ie.events!==void 0,qe=new _t(ie,!0),Qt=new _t(ie,!1),Nr=this.rightSE;this.replaceRightSE(Qt),_e.push(Qt),_e.push(qe);var Ye=new gt(qe,Nr,this.rings.slice(),this.windings.slice());return _t.comparePoints(Ye.leftSE.point,Ye.rightSE.point)>0&&Ye.swapEvents(),_t.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),N&&(qe.checkForConsuming(),Qt.checkForConsuming()),_e}},{key:"swapEvents",value:function(){var ie=this.rightSE;this.rightSE=this.leftSE,this.leftSE=ie,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var _e=0,N=this.windings.length;_e<N;_e++)this.windings[_e]*=-1}},{key:"consume",value:function(ie){for(var _e=this,N=ie;_e.consumedBy;)_e=_e.consumedBy;for(;N.consumedBy;)N=N.consumedBy;var qe=gt.compare(_e,N);if(qe!==0){if(qe>0){var Qt=_e;_e=N,N=Qt}if(_e.prev===N){var Nr=_e;_e=N,N=Nr}for(var Ye=0,Pt=N.rings.length;Ye<Pt;Ye++){var pr=N.rings[Ye],Pr=N.windings[Ye],Wr=_e.rings.indexOf(pr);Wr===-1?(_e.rings.push(pr),_e.windings.push(Pr)):_e.windings[Wr]+=Pr}N.rings=null,N.windings=null,N.consumedBy=_e,N.leftSE.consumedBy=_e.leftSE,N.rightSE.consumedBy=_e.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var ie=this.prev.consumedBy||this.prev;this._beforeState=ie.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var ie=this.beforeState();this._afterState={rings:ie.rings.slice(0),windings:ie.windings.slice(0),multiPolys:[]};for(var _e=this._afterState.rings,N=this._afterState.windings,qe=this._afterState.multiPolys,Qt=0,Nr=this.rings.length;Qt<Nr;Qt++){var Ye=this.rings[Qt],Pt=this.windings[Qt],pr=_e.indexOf(Ye);pr===-1?(_e.push(Ye),N.push(Pt)):N[pr]+=Pt}for(var Pr=[],Wr=[],tn=0,Yn=_e.length;tn<Yn;tn++)if(N[tn]!==0){var jn=_e[tn],an=jn.poly;if(Wr.indexOf(an)===-1)if(jn.isExterior)Pr.push(an);else{Wr.indexOf(an)===-1&&Wr.push(an);var gi=Pr.indexOf(jn.poly);gi!==-1&&Pr.splice(gi,1)}}for(var ci=0,fa=Pr.length;ci<fa;ci++){var ka=Pr[ci].multiPoly;qe.indexOf(ka)===-1&&qe.push(ka)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var ie=this.beforeState().multiPolys,_e=this.afterState().multiPolys;switch(Si.type){case"union":{var N=ie.length===0,qe=_e.length===0;this._isInResult=N!==qe;break}case"intersection":{var Qt,Nr;ie.length<_e.length?(Qt=ie.length,Nr=_e.length):(Qt=_e.length,Nr=ie.length),this._isInResult=Nr===Si.numMultiPolys&&Qt<Nr;break}case"xor":{var Ye=Math.abs(ie.length-_e.length);this._isInResult=Ye%2==1;break}case"difference":{var Pt=function(Pr){return Pr.length===1&&Pr[0].isSubject};this._isInResult=Pt(ie)!==Pt(_e);break}default:throw new Error("Unrecognized operation type found ".concat(Si.type))}return this._isInResult}}],[{key:"fromRing",value:function(ie,_e,N){var qe,Qt,Nr,Ye=_t.comparePoints(ie,_e);if(Ye<0)qe=ie,Qt=_e,Nr=1;else if(Ye>0)qe=_e,Qt=ie,Nr=-1;else throw new Error("Tried to create degenerate segment at [".concat(ie.x,", ").concat(ie.y,"]"));var Pt=new _t(qe,!0),pr=new _t(Qt,!1);return new gt(Pt,pr,[N],[Nr])}}]),gt}(),Yr=function(){function gt(he,ie,_e){if(Te(this,gt),!Array.isArray(he)||he.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=ie,this.isExterior=_e,this.segments=[],typeof he[0][0]!="number"||typeof he[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var N=vt.round(he[0][0],he[0][1]);this.bbox={ll:{x:N.x,y:N.y},ur:{x:N.x,y:N.y}};for(var qe=N,Qt=1,Nr=he.length;Qt<Nr;Qt++){if(typeof he[Qt][0]!="number"||typeof he[Qt][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Ye=vt.round(he[Qt][0],he[Qt][1]);Ye.x===qe.x&&Ye.y===qe.y||(this.segments.push(hr.fromRing(qe,Ye,this)),Ye.x<this.bbox.ll.x&&(this.bbox.ll.x=Ye.x),Ye.y<this.bbox.ll.y&&(this.bbox.ll.y=Ye.y),Ye.x>this.bbox.ur.x&&(this.bbox.ur.x=Ye.x),Ye.y>this.bbox.ur.y&&(this.bbox.ur.y=Ye.y),qe=Ye)}(N.x!==qe.x||N.y!==qe.y)&&this.segments.push(hr.fromRing(qe,N,this))}return Ie(gt,[{key:"getSweepEvents",value:function(){for(var ie=[],_e=0,N=this.segments.length;_e<N;_e++){var qe=this.segments[_e];ie.push(qe.leftSE),ie.push(qe.rightSE)}return ie}}]),gt}(),Hr=function(){function gt(he,ie){if(Te(this,gt),!Array.isArray(he))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Yr(he[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var _e=1,N=he.length;_e<N;_e++){var qe=new Yr(he[_e],this,!1);qe.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=qe.bbox.ll.x),qe.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=qe.bbox.ll.y),qe.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=qe.bbox.ur.x),qe.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=qe.bbox.ur.y),this.interiorRings.push(qe)}this.multiPoly=ie}return Ie(gt,[{key:"getSweepEvents",value:function(){for(var ie=this.exteriorRing.getSweepEvents(),_e=0,N=this.interiorRings.length;_e<N;_e++)for(var qe=this.interiorRings[_e].getSweepEvents(),Qt=0,Nr=qe.length;Qt<Nr;Qt++)ie.push(qe[Qt]);return ie}}]),gt}(),vi=function(){function gt(he,ie){if(Te(this,gt),!Array.isArray(he))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof he[0][0][0]=="number"&&(he=[he])}catch(Qt){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var _e=0,N=he.length;_e<N;_e++){var qe=new Hr(he[_e],this);qe.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=qe.bbox.ll.x),qe.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=qe.bbox.ll.y),qe.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=qe.bbox.ur.x),qe.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=qe.bbox.ur.y),this.polys.push(qe)}this.isSubject=ie}return Ie(gt,[{key:"getSweepEvents",value:function(){for(var ie=[],_e=0,N=this.polys.length;_e<N;_e++)for(var qe=this.polys[_e].getSweepEvents(),Qt=0,Nr=qe.length;Qt<Nr;Qt++)ie.push(qe[Qt]);return ie}}]),gt}(),Vn=function(){Ie(gt,null,[{key:"factory",value:function(ie){for(var _e=[],N=0,qe=ie.length;N<qe;N++){var Qt=ie[N];if(!(!Qt.isInResult()||Qt.ringOut)){for(var Nr=null,Ye=Qt.leftSE,Pt=Qt.rightSE,pr=[Ye],Pr=Ye.point,Wr=[];Nr=Ye,Ye=Pt,pr.push(Ye),Ye.point!==Pr;)for(;;){var tn=Ye.getAvailableLinkedEvents();if(tn.length===0){var Yn=pr[0].point,jn=pr[pr.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(Yn.x,",")+" ".concat(Yn.y,"]. Last matching segment found ends at")+" [".concat(jn.x,", ").concat(jn.y,"]."))}if(tn.length===1){Pt=tn[0].otherSE;break}for(var an=null,gi=0,ci=Wr.length;gi<ci;gi++)if(Wr[gi].point===Ye.point){an=gi;break}if(an!==null){var fa=Wr.splice(an)[0],ka=pr.splice(fa.index);ka.unshift(ka[0].otherSE),_e.push(new gt(ka.reverse()));continue}Wr.push({index:pr.length,point:Ye.point});var Ua=Ye.getLeftmostComparator(Nr);Pt=tn.sort(Ua)[0].otherSE;break}_e.push(new gt(pr))}}return _e}}]);function gt(he){Te(this,gt),this.events=he;for(var ie=0,_e=he.length;ie<_e;ie++)he[ie].segment.ringOut=this;this.poly=null}return Ie(gt,[{key:"getGeom",value:function(){for(var ie=this.events[0].point,_e=[ie],N=1,qe=this.events.length-1;N<qe;N++){var Qt=this.events[N].point,Nr=this.events[N+1].point;ae(Qt,ie,Nr)!==0&&(_e.push(Qt),ie=Qt)}if(_e.length===1)return null;var Ye=_e[0],Pt=_e[1];ae(Ye,ie,Pt)===0&&_e.shift(),_e.push(_e[0]);for(var pr=this.isExteriorRing()?1:-1,Pr=this.isExteriorRing()?0:_e.length-1,Wr=this.isExteriorRing()?_e.length:-1,tn=[],Yn=Pr;Yn!=Wr;Yn+=pr)tn.push([_e[Yn].x,_e[Yn].y]);return tn}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var ie=this.enclosingRing();this._isExteriorRing=ie?!ie.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var ie=this.events[0],_e=1,N=this.events.length;_e<N;_e++){var qe=this.events[_e];_t.compare(ie,qe)>0&&(ie=qe)}for(var Qt=ie.segment.prevInResult(),Nr=Qt?Qt.prevInResult():null;;){if(!Qt)return null;if(!Nr)return Qt.ringOut;if(Nr.ringOut!==Qt.ringOut)return Nr.ringOut.enclosingRing()!==Qt.ringOut?Qt.ringOut:Qt.ringOut.enclosingRing();Qt=Nr.prevInResult(),Nr=Qt?Qt.prevInResult():null}}}]),gt}(),Xn=function(){function gt(he){Te(this,gt),this.exteriorRing=he,he.poly=this,this.interiorRings=[]}return Ie(gt,[{key:"addInterior",value:function(ie){this.interiorRings.push(ie),ie.poly=this}},{key:"getGeom",value:function(){var ie=[this.exteriorRing.getGeom()];if(ie[0]===null)return null;for(var _e=0,N=this.interiorRings.length;_e<N;_e++){var qe=this.interiorRings[_e].getGeom();qe!==null&&ie.push(qe)}return ie}}]),gt}(),ma=function(){function gt(he){Te(this,gt),this.rings=he,this.polys=this._composePolys(he)}return Ie(gt,[{key:"getGeom",value:function(){for(var ie=[],_e=0,N=this.polys.length;_e<N;_e++){var qe=this.polys[_e].getGeom();qe!==null&&ie.push(qe)}return ie}},{key:"_composePolys",value:function(ie){for(var _e=[],N=0,qe=ie.length;N<qe;N++){var Qt=ie[N];if(!Qt.poly)if(Qt.isExteriorRing())_e.push(new Xn(Qt));else{var Nr=Qt.enclosingRing();Nr.poly||_e.push(new Xn(Nr)),Nr.poly.addInterior(Qt)}}return _e}}]),gt}(),Pi=function(){function gt(he){var ie=arguments.length>1&&arguments[1]!==void 0?arguments[1]:hr.compare;Te(this,gt),this.queue=he,this.tree=new bt(ie),this.segments=[]}return Ie(gt,[{key:"process",value:function(ie){var _e=ie.segment,N=[];if(ie.consumedBy)return ie.isLeft?this.queue.remove(ie.otherSE):this.tree.remove(_e),N;var qe=ie.isLeft?this.tree.insert(_e):this.tree.find(_e);if(!qe)throw new Error("Unable to find segment #".concat(_e.id," ")+"[".concat(_e.leftSE.point.x,", ").concat(_e.leftSE.point.y,"] -> ")+"[".concat(_e.rightSE.point.x,", ").concat(_e.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var Qt=qe,Nr=qe,Ye=void 0,Pt=void 0;Ye===void 0;)Qt=this.tree.prev(Qt),Qt===null?Ye=null:Qt.key.consumedBy===void 0&&(Ye=Qt.key);for(;Pt===void 0;)Nr=this.tree.next(Nr),Nr===null?Pt=null:Nr.key.consumedBy===void 0&&(Pt=Nr.key);if(ie.isLeft){var pr=null;if(Ye){var Pr=Ye.getIntersection(_e);if(Pr!==null&&(_e.isAnEndpoint(Pr)||(pr=Pr),!Ye.isAnEndpoint(Pr)))for(var Wr=this._splitSafely(Ye,Pr),tn=0,Yn=Wr.length;tn<Yn;tn++)N.push(Wr[tn])}var jn=null;if(Pt){var an=Pt.getIntersection(_e);if(an!==null&&(_e.isAnEndpoint(an)||(jn=an),!Pt.isAnEndpoint(an)))for(var gi=this._splitSafely(Pt,an),ci=0,fa=gi.length;ci<fa;ci++)N.push(gi[ci])}if(pr!==null||jn!==null){var ka=null;if(pr===null)ka=jn;else if(jn===null)ka=pr;else{var Ua=_t.comparePoints(pr,jn);ka=Ua<=0?pr:jn}this.queue.remove(_e.rightSE),N.push(_e.rightSE);for(var Ea=_e.split(ka),Wi=0,q=Ea.length;Wi<q;Wi++)N.push(Ea[Wi])}N.length>0?(this.tree.remove(_e),N.push(ie)):(this.segments.push(_e),_e.prev=Ye)}else{if(Ye&&Pt){var re=Ye.getIntersection(Pt);if(re!==null){if(!Ye.isAnEndpoint(re))for(var le=this._splitSafely(Ye,re),Ce=0,Be=le.length;Ce<Be;Ce++)N.push(le[Ce]);if(!Pt.isAnEndpoint(re))for(var et=this._splitSafely(Pt,re),dt=0,me=et.length;dt<me;dt++)N.push(et[dt])}}this.tree.remove(_e)}return N}},{key:"_splitSafely",value:function(ie,_e){this.tree.remove(ie);var N=ie.rightSE;this.queue.remove(N);var qe=ie.split(_e);return qe.push(N),ie.consumedBy===void 0&&this.tree.insert(ie),qe}}]),gt}(),mi=typeof Le!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ca=typeof Le!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Gi=function(){function gt(){Te(this,gt)}return Ie(gt,[{key:"run",value:function(ie,_e,N){Si.type=ie,vt.reset();for(var qe=[new vi(_e,!0)],Qt=0,Nr=N.length;Qt<Nr;Qt++)qe.push(new vi(N[Qt],!1));if(Si.numMultiPolys=qe.length,Si.type==="difference")for(var Ye=qe[0],Pt=1;Pt<qe.length;)br(qe[Pt].bbox,Ye.bbox)!==null?Pt++:qe.splice(Pt,1);if(Si.type==="intersection"){for(var pr=0,Pr=qe.length;pr<Pr;pr++)for(var Wr=qe[pr],tn=pr+1,Yn=qe.length;tn<Yn;tn++)if(br(Wr.bbox,qe[tn].bbox)===null)return[]}for(var jn=new bt(_t.compare),an=0,gi=qe.length;an<gi;an++)for(var ci=qe[an].getSweepEvents(),fa=0,ka=ci.length;fa<ka;fa++)if(jn.insert(ci[fa]),jn.size>mi)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var Ua=new Pi(jn),Ea=jn.size,Wi=jn.pop();Wi;){var q=Wi.key;if(jn.size===Ea){var re=q.segment;throw new Error("Unable to pop() ".concat(q.isLeft?"left":"right"," SweepEvent ")+"[".concat(q.point.x,", ").concat(q.point.y,"] from segment #").concat(re.id," ")+"[".concat(re.leftSE.point.x,", ").concat(re.leftSE.point.y,"] -> ")+"[".concat(re.rightSE.point.x,", ").concat(re.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(jn.size>mi)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(Ua.segments.length>ca)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var le=Ua.process(q),Ce=0,Be=le.length;Ce<Be;Ce++){var et=le[Ce];et.consumedBy===void 0&&jn.insert(et)}Ea=jn.size,Wi=jn.pop()}vt.reset();var dt=Vn.factory(Ua.segments),me=new ma(dt);return me.getGeom()}}]),gt}(),Si=new Gi,ei=function(he){for(var ie=arguments.length,_e=new Array(ie>1?ie-1:0),N=1;N<ie;N++)_e[N-1]=arguments[N];return Si.run("union",he,_e)},cr=function(he){for(var ie=arguments.length,_e=new Array(ie>1?ie-1:0),N=1;N<ie;N++)_e[N-1]=arguments[N];return Si.run("intersection",he,_e)},mt=function(he){for(var ie=arguments.length,_e=new Array(ie>1?ie-1:0),N=1;N<ie;N++)_e[N-1]=arguments[N];return Si.run("xor",he,_e)},Wa=function(he){for(var ie=arguments.length,_e=new Array(ie>1?ie-1:0),N=1;N<ie;N++)_e[N-1]=arguments[N];return Si.run("difference",he,_e)},xa={union:ei,intersection:cr,xor:mt,difference:Wa};return xa})},28660:function(sn,pe,ee){var Le=ee(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Te;(function(y){(function(Ie){var X=typeof ee.g=="object"?ee.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),Se=se(y);typeof X.Reflect=="undefined"?X.Reflect=y:Se=se(X.Reflect,Se),Ie(Se);function se(rt,ye){return function(ot,ct){typeof rt[ot]!="function"&&Object.defineProperty(rt,ot,{configurable:!0,writable:!0,value:ct}),ye&&ye(ot,ct)}}})(function(Ie){var X=Object.prototype.hasOwnProperty,Se=typeof Symbol=="function",se=Se&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",rt=Se&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ye=typeof Object.create=="function",ot={__proto__:[]}instanceof Array,ct=!ye&&!ot,bt={create:ye?function(){return Nr(Object.create(null))}:ot?function(){return Nr({__proto__:null})}:function(){return Nr({})},has:ct?function(Ye,Pt){return X.call(Ye,Pt)}:function(Ye,Pt){return Pt in Ye},get:ct?function(Ye,Pt){return X.call(Ye,Pt)?Ye[Pt]:void 0}:function(Ye,Pt){return Ye[Pt]}},Ot=Object.getPrototypeOf(Function),vr=typeof Le=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Ft=!vr&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:N(),gr=!vr&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:qe(),qt=!vr&&typeof WeakMap=="function"?WeakMap:Qt(),It=new qt;function Zt(Ye,Pt,pr,Pr){if(Hr(pr)){if(!Si(Ye))throw new TypeError;if(!cr(Pt))throw new TypeError;return ae(Ye,Pt)}else{if(!Si(Ye))throw new TypeError;if(!Xn(Pt))throw new TypeError;if(!Xn(Pr)&&!Hr(Pr)&&!vi(Pr))throw new TypeError;return vi(Pr)&&(Pr=void 0),pr=Gi(pr),Ze(Ye,Pt,pr,Pr)}}Ie("decorate",Zt);function br(Ye,Pt){function pr(Pr,Wr){if(!Xn(Pr))throw new TypeError;if(!Hr(Wr)&&!mt(Wr))throw new TypeError;_t(Ye,Pt,Pr,Wr)}return pr}Ie("metadata",br);function J(Ye,Pt,pr,Pr){if(!Xn(pr))throw new TypeError;return Hr(Pr)||(Pr=Gi(Pr)),_t(Ye,Pt,pr,Pr)}Ie("defineMetadata",J);function Et(Ye,Pt,pr){if(!Xn(Pt))throw new TypeError;return Hr(pr)||(pr=Gi(pr)),ce(Ye,Pt,pr)}Ie("hasMetadata",Et);function Ct(Ye,Pt,pr){if(!Xn(Pt))throw new TypeError;return Hr(pr)||(pr=Gi(pr)),ue(Ye,Pt,pr)}Ie("hasOwnMetadata",Ct);function pt(Ye,Pt,pr){if(!Xn(Pt))throw new TypeError;return Hr(pr)||(pr=Gi(pr)),Xe(Ye,Pt,pr)}Ie("getMetadata",pt);function Ht(Ye,Pt,pr){if(!Xn(Pt))throw new TypeError;return Hr(pr)||(pr=Gi(pr)),lt(Ye,Pt,pr)}Ie("getOwnMetadata",Ht);function vt(Ye,Pt){if(!Xn(Ye))throw new TypeError;return Hr(Pt)||(Pt=Gi(Pt)),Xt(Ye,Pt)}Ie("getMetadataKeys",vt);function sr(Ye,Pt){if(!Xn(Ye))throw new TypeError;return Hr(Pt)||(Pt=Gi(Pt)),hr(Ye,Pt)}Ie("getOwnMetadataKeys",sr);function Ir(Ye,Pt,pr){if(!Xn(Pt))throw new TypeError;Hr(pr)||(pr=Gi(pr));var Pr=Y(Pt,pr,!1);if(Hr(Pr)||!Pr.delete(Ye))return!1;if(Pr.size>0)return!0;var Wr=It.get(Pt);return Wr.delete(pr),Wr.size>0||It.delete(Pt),!0}Ie("deleteMetadata",Ir);function ae(Ye,Pt){for(var pr=Ye.length-1;pr>=0;--pr){var Pr=Ye[pr],Wr=Pr(Pt);if(!Hr(Wr)&&!vi(Wr)){if(!cr(Wr))throw new TypeError;Pt=Wr}}return Pt}function Ze(Ye,Pt,pr,Pr){for(var Wr=Ye.length-1;Wr>=0;--Wr){var tn=Ye[Wr],Yn=tn(Pt,pr,Pr);if(!Hr(Yn)&&!vi(Yn)){if(!Xn(Yn))throw new TypeError;Pr=Yn}}return Pr}function Y(Ye,Pt,pr){var Pr=It.get(Ye);if(Hr(Pr)){if(!pr)return;Pr=new Ft,It.set(Ye,Pr)}var Wr=Pr.get(Pt);if(Hr(Wr)){if(!pr)return;Wr=new Ft,Pr.set(Pt,Wr)}return Wr}function ce(Ye,Pt,pr){var Pr=ue(Ye,Pt,pr);if(Pr)return!0;var Wr=_e(Pt);return vi(Wr)?!1:ce(Ye,Wr,pr)}function ue(Ye,Pt,pr){var Pr=Y(Pt,pr,!1);return Hr(Pr)?!1:mi(Pr.has(Ye))}function Xe(Ye,Pt,pr){var Pr=ue(Ye,Pt,pr);if(Pr)return lt(Ye,Pt,pr);var Wr=_e(Pt);if(!vi(Wr))return Xe(Ye,Wr,pr)}function lt(Ye,Pt,pr){var Pr=Y(Pt,pr,!1);if(!Hr(Pr))return Pr.get(Ye)}function _t(Ye,Pt,pr,Pr){var Wr=Y(pr,Pr,!0);Wr.set(Ye,Pt)}function Xt(Ye,Pt){var pr=hr(Ye,Pt),Pr=_e(Ye);if(Pr===null)return pr;var Wr=Xt(Pr,Pt);if(Wr.length<=0)return pr;if(pr.length<=0)return Wr;for(var tn=new gr,Yn=[],jn=0,an=pr;jn<an.length;jn++){var gi=an[jn],ci=tn.has(gi);ci||(tn.add(gi),Yn.push(gi))}for(var fa=0,ka=Wr;fa<ka.length;fa++){var gi=ka[fa],ci=tn.has(gi);ci||(tn.add(gi),Yn.push(gi))}return Yn}function hr(Ye,Pt){var pr=[],Pr=Y(Ye,Pt,!1);if(Hr(Pr))return pr;for(var Wr=Pr.keys(),tn=xa(Wr),Yn=0;;){var jn=he(tn);if(!jn)return pr.length=Yn,pr;var an=gt(jn);try{pr[Yn]=an}catch(gi){try{ie(tn)}finally{throw gi}}Yn++}}function Yr(Ye){if(Ye===null)return 1;switch(typeof Ye){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Ye===null?1:6;default:return 6}}function Hr(Ye){return Ye===void 0}function vi(Ye){return Ye===null}function Vn(Ye){return typeof Ye=="symbol"}function Xn(Ye){return typeof Ye=="object"?Ye!==null:typeof Ye=="function"}function ma(Ye,Pt){switch(Yr(Ye)){case 0:return Ye;case 1:return Ye;case 2:return Ye;case 3:return Ye;case 4:return Ye;case 5:return Ye}var pr=Pt===3?"string":Pt===5?"number":"default",Pr=Wa(Ye,se);if(Pr!==void 0){var Wr=Pr.call(Ye,pr);if(Xn(Wr))throw new TypeError;return Wr}return Pi(Ye,pr==="default"?"number":pr)}function Pi(Ye,Pt){if(Pt==="string"){var pr=Ye.toString;if(ei(pr)){var Pr=pr.call(Ye);if(!Xn(Pr))return Pr}var Wr=Ye.valueOf;if(ei(Wr)){var Pr=Wr.call(Ye);if(!Xn(Pr))return Pr}}else{var Wr=Ye.valueOf;if(ei(Wr)){var Pr=Wr.call(Ye);if(!Xn(Pr))return Pr}var tn=Ye.toString;if(ei(tn)){var Pr=tn.call(Ye);if(!Xn(Pr))return Pr}}throw new TypeError}function mi(Ye){return!!Ye}function ca(Ye){return""+Ye}function Gi(Ye){var Pt=ma(Ye,3);return Vn(Pt)?Pt:ca(Pt)}function Si(Ye){return Array.isArray?Array.isArray(Ye):Ye instanceof Object?Ye instanceof Array:Object.prototype.toString.call(Ye)==="[object Array]"}function ei(Ye){return typeof Ye=="function"}function cr(Ye){return typeof Ye=="function"}function mt(Ye){switch(Yr(Ye)){case 3:return!0;case 4:return!0;default:return!1}}function Wa(Ye,Pt){var pr=Ye[Pt];if(pr!=null){if(!ei(pr))throw new TypeError;return pr}}function xa(Ye){var Pt=Wa(Ye,rt);if(!ei(Pt))throw new TypeError;var pr=Pt.call(Ye);if(!Xn(pr))throw new TypeError;return pr}function gt(Ye){return Ye.value}function he(Ye){var Pt=Ye.next();return Pt.done?!1:Pt}function ie(Ye){var Pt=Ye.return;Pt&&Pt.call(Ye)}function _e(Ye){var Pt=Object.getPrototypeOf(Ye);if(typeof Ye!="function"||Ye===Ot||Pt!==Ot)return Pt;var pr=Ye.prototype,Pr=pr&&Object.getPrototypeOf(pr);if(Pr==null||Pr===Object.prototype)return Pt;var Wr=Pr.constructor;return typeof Wr!="function"||Wr===Ye?Pt:Wr}function N(){var Ye={},Pt=[],pr=function(){function Yn(jn,an,gi){this._index=0,this._keys=jn,this._values=an,this._selector=gi}return Yn.prototype["@@iterator"]=function(){return this},Yn.prototype[rt]=function(){return this},Yn.prototype.next=function(){var jn=this._index;if(jn>=0&&jn<this._keys.length){var an=this._selector(this._keys[jn],this._values[jn]);return jn+1>=this._keys.length?(this._index=-1,this._keys=Pt,this._values=Pt):this._index++,{value:an,done:!1}}return{value:void 0,done:!0}},Yn.prototype.throw=function(jn){throw this._index>=0&&(this._index=-1,this._keys=Pt,this._values=Pt),jn},Yn.prototype.return=function(jn){return this._index>=0&&(this._index=-1,this._keys=Pt,this._values=Pt),{value:jn,done:!0}},Yn}();return function(){function Yn(){this._keys=[],this._values=[],this._cacheKey=Ye,this._cacheIndex=-2}return Object.defineProperty(Yn.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Yn.prototype.has=function(jn){return this._find(jn,!1)>=0},Yn.prototype.get=function(jn){var an=this._find(jn,!1);return an>=0?this._values[an]:void 0},Yn.prototype.set=function(jn,an){var gi=this._find(jn,!0);return this._values[gi]=an,this},Yn.prototype.delete=function(jn){var an=this._find(jn,!1);if(an>=0){for(var gi=this._keys.length,ci=an+1;ci<gi;ci++)this._keys[ci-1]=this._keys[ci],this._values[ci-1]=this._values[ci];return this._keys.length--,this._values.length--,jn===this._cacheKey&&(this._cacheKey=Ye,this._cacheIndex=-2),!0}return!1},Yn.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Ye,this._cacheIndex=-2},Yn.prototype.keys=function(){return new pr(this._keys,this._values,Pr)},Yn.prototype.values=function(){return new pr(this._keys,this._values,Wr)},Yn.prototype.entries=function(){return new pr(this._keys,this._values,tn)},Yn.prototype["@@iterator"]=function(){return this.entries()},Yn.prototype[rt]=function(){return this.entries()},Yn.prototype._find=function(jn,an){return this._cacheKey!==jn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=jn)),this._cacheIndex<0&&an&&(this._cacheIndex=this._keys.length,this._keys.push(jn),this._values.push(void 0)),this._cacheIndex},Yn}();function Pr(Yn,jn){return Yn}function Wr(Yn,jn){return jn}function tn(Yn,jn){return[Yn,jn]}}function qe(){return function(){function Ye(){this._map=new Ft}return Object.defineProperty(Ye.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Ye.prototype.has=function(Pt){return this._map.has(Pt)},Ye.prototype.add=function(Pt){return this._map.set(Pt,Pt),this},Ye.prototype.delete=function(Pt){return this._map.delete(Pt)},Ye.prototype.clear=function(){this._map.clear()},Ye.prototype.keys=function(){return this._map.keys()},Ye.prototype.values=function(){return this._map.values()},Ye.prototype.entries=function(){return this._map.entries()},Ye.prototype["@@iterator"]=function(){return this.keys()},Ye.prototype[rt]=function(){return this.keys()},Ye}()}function Qt(){var Ye=16,Pt=bt.create(),pr=Pr();return function(){function an(){this._key=Pr()}return an.prototype.has=function(gi){var ci=Wr(gi,!1);return ci!==void 0?bt.has(ci,this._key):!1},an.prototype.get=function(gi){var ci=Wr(gi,!1);return ci!==void 0?bt.get(ci,this._key):void 0},an.prototype.set=function(gi,ci){var fa=Wr(gi,!0);return fa[this._key]=ci,this},an.prototype.delete=function(gi){var ci=Wr(gi,!1);return ci!==void 0?delete ci[this._key]:!1},an.prototype.clear=function(){this._key=Pr()},an}();function Pr(){var an;do an="@@WeakMap@@"+jn();while(bt.has(Pt,an));return Pt[an]=!0,an}function Wr(an,gi){if(!X.call(an,pr)){if(!gi)return;Object.defineProperty(an,pr,{value:bt.create()})}return an[pr]}function tn(an,gi){for(var ci=0;ci<gi;++ci)an[ci]=Math.random()*255|0;return an}function Yn(an){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(an)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(an)):tn(new Uint8Array(an),an):tn(new Array(an),an)}function jn(){var an=Yn(Ye);an[6]=an[6]&79|64,an[8]=an[8]&191|128;for(var gi="",ci=0;ci<Ye;++ci){var fa=an[ci];(ci===4||ci===6||ci===8)&&(gi+="-"),fa<16&&(gi+="0"),gi+=fa.toString(16).toLowerCase()}return gi}}function Nr(Ye){return Ye.__=void 0,delete Ye.__,Ye}})})(Te||(Te={}))},69848:function(sn){(function(pe,ee){sn.exports=ee()})(this,function(){"use strict";function pe(Ct,pt,Ht,vt,sr,Ir){if(!(sr-vt<=Ht)){var ae=vt+sr>>1;ee(Ct,pt,ae,vt,sr,Ir%2),pe(Ct,pt,Ht,vt,ae-1,Ir+1),pe(Ct,pt,Ht,ae+1,sr,Ir+1)}}function ee(Ct,pt,Ht,vt,sr,Ir){for(;sr>vt;){if(sr-vt>600){var ae=sr-vt+1,Ze=Ht-vt+1,Y=Math.log(ae),ce=.5*Math.exp(2*Y/3),ue=.5*Math.sqrt(Y*ce*(ae-ce)/ae)*(Ze-ae/2<0?-1:1),Xe=Math.max(vt,Math.floor(Ht-Ze*ce/ae+ue)),lt=Math.min(sr,Math.floor(Ht+(ae-Ze)*ce/ae+ue));ee(Ct,pt,Ht,Xe,lt,Ir)}var _t=pt[2*Ht+Ir],Xt=vt,hr=sr;for(Le(Ct,pt,vt,Ht),pt[2*sr+Ir]>_t&&Le(Ct,pt,vt,sr);Xt<hr;){for(Le(Ct,pt,Xt,hr),Xt++,hr--;pt[2*Xt+Ir]<_t;)Xt++;for(;pt[2*hr+Ir]>_t;)hr--}pt[2*vt+Ir]===_t?Le(Ct,pt,vt,hr):(hr++,Le(Ct,pt,hr,sr)),hr<=Ht&&(vt=hr+1),Ht<=hr&&(sr=hr-1)}}function Le(Ct,pt,Ht,vt){Te(Ct,Ht,vt),Te(pt,2*Ht,2*vt),Te(pt,2*Ht+1,2*vt+1)}function Te(Ct,pt,Ht){var vt=Ct[pt];Ct[pt]=Ct[Ht],Ct[Ht]=vt}function y(Ct,pt,Ht,vt,sr,Ir,ae){for(var Ze=[0,Ct.length-1,0],Y=[],ce,ue;Ze.length;){var Xe=Ze.pop(),lt=Ze.pop(),_t=Ze.pop();if(lt-_t<=ae){for(var Xt=_t;Xt<=lt;Xt++)ce=pt[2*Xt],ue=pt[2*Xt+1],ce>=Ht&&ce<=sr&&ue>=vt&&ue<=Ir&&Y.push(Ct[Xt]);continue}var hr=Math.floor((_t+lt)/2);ce=pt[2*hr],ue=pt[2*hr+1],ce>=Ht&&ce<=sr&&ue>=vt&&ue<=Ir&&Y.push(Ct[hr]);var Yr=(Xe+1)%2;(Xe===0?Ht<=ce:vt<=ue)&&(Ze.push(_t),Ze.push(hr-1),Ze.push(Yr)),(Xe===0?sr>=ce:Ir>=ue)&&(Ze.push(hr+1),Ze.push(lt),Ze.push(Yr))}return Y}function Ie(Ct,pt,Ht,vt,sr,Ir){for(var ae=[0,Ct.length-1,0],Ze=[],Y=sr*sr;ae.length;){var ce=ae.pop(),ue=ae.pop(),Xe=ae.pop();if(ue-Xe<=Ir){for(var lt=Xe;lt<=ue;lt++)X(pt[2*lt],pt[2*lt+1],Ht,vt)<=Y&&Ze.push(Ct[lt]);continue}var _t=Math.floor((Xe+ue)/2),Xt=pt[2*_t],hr=pt[2*_t+1];X(Xt,hr,Ht,vt)<=Y&&Ze.push(Ct[_t]);var Yr=(ce+1)%2;(ce===0?Ht-sr<=Xt:vt-sr<=hr)&&(ae.push(Xe),ae.push(_t-1),ae.push(Yr)),(ce===0?Ht+sr>=Xt:vt+sr>=hr)&&(ae.push(_t+1),ae.push(ue),ae.push(Yr))}return Ze}function X(Ct,pt,Ht,vt){var sr=Ct-Ht,Ir=pt-vt;return sr*sr+Ir*Ir}var Se=function(Ct){return Ct[0]},se=function(Ct){return Ct[1]},rt=function(pt,Ht,vt,sr,Ir){Ht===void 0&&(Ht=Se),vt===void 0&&(vt=se),sr===void 0&&(sr=64),Ir===void 0&&(Ir=Float64Array),this.nodeSize=sr,this.points=pt;for(var ae=pt.length<65536?Uint16Array:Uint32Array,Ze=this.ids=new ae(pt.length),Y=this.coords=new Ir(pt.length*2),ce=0;ce<pt.length;ce++)Ze[ce]=ce,Y[2*ce]=Ht(pt[ce]),Y[2*ce+1]=vt(pt[ce]);pe(Ze,Y,sr,0,Ze.length-1,0)};rt.prototype.range=function(pt,Ht,vt,sr){return y(this.ids,this.coords,pt,Ht,vt,sr,this.nodeSize)},rt.prototype.within=function(pt,Ht,vt){return Ie(this.ids,this.coords,pt,Ht,vt,this.nodeSize)};var ye={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Ct){return Ct}},ot=Math.fround||function(Ct){return function(pt){return Ct[0]=+pt,Ct[0]}}(new Float32Array(1)),ct=function(pt){this.options=br(Object.create(ye),pt),this.trees=new Array(this.options.maxZoom+1)};ct.prototype.load=function(pt){var Ht=this.options,vt=Ht.log,sr=Ht.minZoom,Ir=Ht.maxZoom,ae=Ht.nodeSize;vt&&console.time("total time");var Ze="prepare "+pt.length+" points";vt&&console.time(Ze),this.points=pt;for(var Y=[],ce=0;ce<pt.length;ce++)!pt[ce].geometry||Y.push(Ot(pt[ce],ce));this.trees[Ir+1]=new rt(Y,J,Et,ae,Float32Array),vt&&console.timeEnd(Ze);for(var ue=Ir;ue>=sr;ue--){var Xe=+Date.now();Y=this._cluster(Y,ue),this.trees[ue]=new rt(Y,J,Et,ae,Float32Array),vt&&console.log("z%d: %d clusters in %dms",ue,Y.length,+Date.now()-Xe)}return vt&&console.timeEnd("total time"),this},ct.prototype.getClusters=function(pt,Ht){var vt=((pt[0]+180)%360+360)%360-180,sr=Math.max(-90,Math.min(90,pt[1])),Ir=pt[2]===180?180:((pt[2]+180)%360+360)%360-180,ae=Math.max(-90,Math.min(90,pt[3]));if(pt[2]-pt[0]>=360)vt=-180,Ir=180;else if(vt>Ir){var Ze=this.getClusters([vt,sr,180,ae],Ht),Y=this.getClusters([-180,sr,Ir,ae],Ht);return Ze.concat(Y)}for(var ce=this.trees[this._limitZoom(Ht)],ue=ce.range(gr(vt),qt(ae),gr(Ir),qt(sr)),Xe=[],lt=0,_t=ue;lt<_t.length;lt+=1){var Xt=_t[lt],hr=ce.points[Xt];Xe.push(hr.numPoints?vr(hr):this.points[hr.index])}return Xe},ct.prototype.getChildren=function(pt){var Ht=this._getOriginId(pt),vt=this._getOriginZoom(pt),sr="No cluster with the specified id.",Ir=this.trees[vt];if(!Ir)throw new Error(sr);var ae=Ir.points[Ht];if(!ae)throw new Error(sr);for(var Ze=this.options.radius/(this.options.extent*Math.pow(2,vt-1)),Y=Ir.within(ae.x,ae.y,Ze),ce=[],ue=0,Xe=Y;ue<Xe.length;ue+=1){var lt=Xe[ue],_t=Ir.points[lt];_t.parentId===pt&&ce.push(_t.numPoints?vr(_t):this.points[_t.index])}if(ce.length===0)throw new Error(sr);return ce},ct.prototype.getLeaves=function(pt,Ht,vt){Ht=Ht||10,vt=vt||0;var sr=[];return this._appendLeaves(sr,pt,Ht,vt,0),sr},ct.prototype.getTile=function(pt,Ht,vt){var sr=this.trees[this._limitZoom(pt)],Ir=Math.pow(2,pt),ae=this.options,Ze=ae.extent,Y=ae.radius,ce=Y/Ze,ue=(vt-ce)/Ir,Xe=(vt+1+ce)/Ir,lt={features:[]};return this._addTileFeatures(sr.range((Ht-ce)/Ir,ue,(Ht+1+ce)/Ir,Xe),sr.points,Ht,vt,Ir,lt),Ht===0&&this._addTileFeatures(sr.range(1-ce/Ir,ue,1,Xe),sr.points,Ir,vt,Ir,lt),Ht===Ir-1&&this._addTileFeatures(sr.range(0,ue,ce/Ir,Xe),sr.points,-1,vt,Ir,lt),lt.features.length?lt:null},ct.prototype.getClusterExpansionZoom=function(pt){for(var Ht=this._getOriginZoom(pt)-1;Ht<=this.options.maxZoom;){var vt=this.getChildren(pt);if(Ht++,vt.length!==1)break;pt=vt[0].properties.cluster_id}return Ht},ct.prototype._appendLeaves=function(pt,Ht,vt,sr,Ir){for(var ae=this.getChildren(Ht),Ze=0,Y=ae;Ze<Y.length;Ze+=1){var ce=Y[Ze],ue=ce.properties;if(ue&&ue.cluster?Ir+ue.point_count<=sr?Ir+=ue.point_count:Ir=this._appendLeaves(pt,ue.cluster_id,vt,sr,Ir):Ir<sr?Ir++:pt.push(ce),pt.length===vt)break}return Ir},ct.prototype._addTileFeatures=function(pt,Ht,vt,sr,Ir,ae){for(var Ze=0,Y=pt;Ze<Y.length;Ze+=1){var ce=Y[Ze],ue=Ht[ce],Xe=ue.numPoints,lt=void 0,_t=void 0,Xt=void 0;if(Xe)lt=Ft(ue),_t=ue.x,Xt=ue.y;else{var hr=this.points[ue.index];lt=hr.properties,_t=gr(hr.geometry.coordinates[0]),Xt=qt(hr.geometry.coordinates[1])}var Yr={type:1,geometry:[[Math.round(this.options.extent*(_t*Ir-vt)),Math.round(this.options.extent*(Xt*Ir-sr))]],tags:lt},Hr=void 0;Xe?Hr=ue.id:this.options.generateId?Hr=ue.index:this.points[ue.index].id&&(Hr=this.points[ue.index].id),Hr!==void 0&&(Yr.id=Hr),ae.features.push(Yr)}},ct.prototype._limitZoom=function(pt){return Math.max(this.options.minZoom,Math.min(Math.floor(+pt),this.options.maxZoom+1))},ct.prototype._cluster=function(pt,Ht){for(var vt=[],sr=this.options,Ir=sr.radius,ae=sr.extent,Ze=sr.reduce,Y=sr.minPoints,ce=Ir/(ae*Math.pow(2,Ht)),ue=0;ue<pt.length;ue++){var Xe=pt[ue];if(!(Xe.zoom<=Ht)){Xe.zoom=Ht;for(var lt=this.trees[Ht+1],_t=lt.within(Xe.x,Xe.y,ce),Xt=Xe.numPoints||1,hr=Xt,Yr=0,Hr=_t;Yr<Hr.length;Yr+=1){var vi=Hr[Yr],Vn=lt.points[vi];Vn.zoom>Ht&&(hr+=Vn.numPoints||1)}if(hr>Xt&&hr>=Y){for(var Xn=Xe.x*Xt,ma=Xe.y*Xt,Pi=Ze&&Xt>1?this._map(Xe,!0):null,mi=(ue<<5)+(Ht+1)+this.points.length,ca=0,Gi=_t;ca<Gi.length;ca+=1){var Si=Gi[ca],ei=lt.points[Si];if(!(ei.zoom<=Ht)){ei.zoom=Ht;var cr=ei.numPoints||1;Xn+=ei.x*cr,ma+=ei.y*cr,ei.parentId=mi,Ze&&(Pi||(Pi=this._map(Xe,!0)),Ze(Pi,this._map(ei)))}}Xe.parentId=mi,vt.push(bt(Xn/hr,ma/hr,mi,hr,Pi))}else if(vt.push(Xe),hr>1)for(var mt=0,Wa=_t;mt<Wa.length;mt+=1){var xa=Wa[mt],gt=lt.points[xa];gt.zoom<=Ht||(gt.zoom=Ht,vt.push(gt))}}}return vt},ct.prototype._getOriginId=function(pt){return pt-this.points.length>>5},ct.prototype._getOriginZoom=function(pt){return(pt-this.points.length)%32},ct.prototype._map=function(pt,Ht){if(pt.numPoints)return Ht?br({},pt.properties):pt.properties;var vt=this.points[pt.index].properties,sr=this.options.map(vt);return Ht&&sr===vt?br({},sr):sr};function bt(Ct,pt,Ht,vt,sr){return{x:ot(Ct),y:ot(pt),zoom:Infinity,id:Ht,parentId:-1,numPoints:vt,properties:sr}}function Ot(Ct,pt){var Ht=Ct.geometry.coordinates,vt=Ht[0],sr=Ht[1];return{x:ot(gr(vt)),y:ot(qt(sr)),zoom:Infinity,index:pt,parentId:-1}}function vr(Ct){return{type:"Feature",id:Ct.id,properties:Ft(Ct),geometry:{type:"Point",coordinates:[It(Ct.x),Zt(Ct.y)]}}}function Ft(Ct){var pt=Ct.numPoints,Ht=pt>=1e4?Math.round(pt/1e3)+"k":pt>=1e3?Math.round(pt/100)/10+"k":pt;return br(br({},Ct.properties),{cluster:!0,cluster_id:Ct.id,point_count:pt,point_count_abbreviated:Ht})}function gr(Ct){return Ct/360+.5}function qt(Ct){var pt=Math.sin(Ct*Math.PI/180),Ht=.5-.25*Math.log((1+pt)/(1-pt))/Math.PI;return Ht<0?0:Ht>1?1:Ht}function It(Ct){return(Ct-.5)*360}function Zt(Ct){var pt=(180-Ct*360)*Math.PI/180;return 360*Math.atan(Math.exp(pt))/Math.PI-90}function br(Ct,pt){for(var Ht in pt)Ct[Ht]=pt[Ht];return Ct}function J(Ct){return Ct.x}function Et(Ct){return Ct.y}return ct})}}]);
